(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[3632],{64335:function(hi,Ae,fe){"use strict";var We=fe(67294),de=(0,We.createContext)({});Ae.Z=de},21349:function(hi,Ae,fe){"use strict";var We=fe(84305),de=fe(75901),y=fe(85893),Ne=fe(94184),K=fe.n(Ne),Re=fe(67294),pe=fe(64335),lt=fe(53645),we=fe.n(lt),Xe=function(Pt){var tr=(0,Re.useContext)(pe.Z),Yt=Pt.children,Wt=Pt.contentWidth,br=Pt.className,lr=Pt.style,kt=(0,Re.useContext)(de.ZP.ConfigContext),zt=kt.getPrefixCls,Pr=Pt.prefixCls||zt("pro"),re=Wt||tr.contentWidth,yr="".concat(Pr,"-grid-content");return(0,y.jsx)("div",{className:K()(yr,br,{wide:re==="Fixed"}),style:lr,children:(0,y.jsx)("div",{className:"".concat(Pr,"-grid-content-children"),children:Yt})})};Ae.Z=Xe},62714:function(hi,Ae,fe){"use strict";fe.d(Ae,{zP:function(){return Dk},JE:function(){return XI},ns:function(){return Fk}});var We={};fe.r(We),fe.d(We,{add:function(){return wp},adjoint:function(){return ju},clone:function(){return gs},copy:function(){return jo},create:function(){return ko},determinant:function(){return Os},equals:function(){return Mh},exactEquals:function(){return fd},frob:function(){return Dd},fromQuat:function(){return Th},fromQuat2:function(){return Ss},fromRotation:function(){return Lu},fromRotationTranslation:function(){return al},fromRotationTranslationScale:function(){return Cp},fromRotationTranslationScaleOrigin:function(){return od},fromScaling:function(){return Xs},fromTranslation:function(){return Do},fromValues:function(){return ys},fromXRotation:function(){return Xa},fromYRotation:function(){return wl},fromZRotation:function(){return uc},frustum:function(){return sd},getRotation:function(){return ad},getScaling:function(){return zc},getTranslation:function(){return Nc},identity:function(){return nu},invert:function(){return ts},lookAt:function(){return Ap},mul:function(){return hd},multiply:function(){return Go},multiplyScalar:function(){return ld},multiplyScalarAndAdd:function(){return cd},ortho:function(){return hf},orthoNO:function(){return ud},orthoZO:function(){return Fd},perspective:function(){return ap},perspectiveFromFieldOfView:function(){return op},perspectiveNO:function(){return ip},perspectiveZO:function(){return Sp},rotate:function(){return bo},rotateX:function(){return Ua},rotateY:function(){return Gu},rotateZ:function(){return fu},scale:function(){return so},set:function(){return cu},str:function(){return sh},sub:function(){return pd},subtract:function(){return Tp},targetTo:function(){return sp},translate:function(){return Sa},transpose:function(){return il}});var de=fe(67294),y=(0,de.createContext)({});function Ne(){return(0,de.useContext)(y)}var K={},Re={},pe=function(a){return Re[a]},lt=function(a,t){Re[a]=t},we=function(a){return K[a]},Xe=function(a,t){K[a]=t},Ct={},Pt={},tr=34,Yt=10,Wt=13;function br(e){return new Function("d","return {"+e.map(function(a,t){return JSON.stringify(a)+": d["+t+'] || ""'}).join(",")+"}")}function lr(e,a){var t=br(e);return function(i,r){return a(t(i),r,e)}}function kt(e){var a=Object.create(null),t=[];return e.forEach(function(i){for(var r in i)r in a||t.push(a[r]=r)}),t}function zt(e,a){var t=e+"",i=t.length;return i<a?new Array(a-i+1).join(0)+t:t}function Pr(e){return e<0?"-"+zt(-e,6):e>9999?"+"+zt(e,6):zt(e,4)}function re(e){var a=e.getUTCHours(),t=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Pr(e.getUTCFullYear(),4)+"-"+zt(e.getUTCMonth()+1,2)+"-"+zt(e.getUTCDate(),2)+(r?"T"+zt(a,2)+":"+zt(t,2)+":"+zt(i,2)+"."+zt(r,3)+"Z":i?"T"+zt(a,2)+":"+zt(t,2)+":"+zt(i,2)+"Z":t||a?"T"+zt(a,2)+":"+zt(t,2)+"Z":"")}function yr(e){var a=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function i(A,P){var F,N,V=r(A,function(Y,ie){if(F)return F(Y,ie-1);N=Y,F=P?lr(Y,P):br(Y)});return V.columns=N||[],V}function r(A,P){var F=[],N=A.length,V=0,Y=0,ie,ye=N<=0,Pe=!1;A.charCodeAt(N-1)===Yt&&--N,A.charCodeAt(N-1)===Wt&&--N;function tt(){if(ye)return Pt;if(Pe)return Pe=!1,Ct;var vt,Xt=V,er;if(A.charCodeAt(Xt)===tr){for(;V++<N&&A.charCodeAt(V)!==tr||A.charCodeAt(++V)===tr;);return(vt=V)>=N?ye=!0:(er=A.charCodeAt(V++))===Yt?Pe=!0:er===Wt&&(Pe=!0,A.charCodeAt(V)===Yt&&++V),A.slice(Xt+1,vt-1).replace(/""/g,'"')}for(;V<N;){if((er=A.charCodeAt(vt=V++))===Yt)Pe=!0;else if(er===Wt)Pe=!0,A.charCodeAt(V)===Yt&&++V;else if(er!==t)continue;return A.slice(Xt,vt)}return ye=!0,A.slice(Xt,N)}for(;(ie=tt())!==Pt;){for(var pt=[];ie!==Ct&&ie!==Pt;)pt.push(ie),ie=tt();P&&(pt=P(pt,Y++))==null||F.push(pt)}return F}function o(A,P){return A.map(function(F){return P.map(function(N){return E(F[N])}).join(e)})}function u(A,P){return P==null&&(P=kt(A)),[P.map(E).join(e)].concat(o(A,P)).join(`
`)}function p(A,P){return P==null&&(P=kt(A)),o(A,P).join(`
`)}function v(A){return A.map(g).join(`
`)}function g(A){return A.map(E).join(e)}function E(A){return A==null?"":A instanceof Date?re(A):a.test(A+="")?'"'+A.replace(/"/g,'""')+'"':A}return{parse:i,parseRows:r,format:u,formatBody:p,formatRows:v,formatRow:g,formatValue:E}}var Rt=yr(","),_t=Rt.parse,Kt=Rt.parseRows,Ue=Rt.format,Er=Rt.formatBody,an=Rt.formatRows,ue=Rt.formatRow,rt=Rt.formatValue,Z=fe(28991),_e=fe(85061),ze=fe(38163),St=fe.n(ze);function Ut(e,a){var t=a.x,i=a.y,r=a.x1,o=a.y1,u=a.coordinates,p=[];return Array.isArray(e)?(e.forEach(function(v,g){var E=[];if(t&&i&&(E=[parseFloat(v[t]),parseFloat(v[i])]),t&&i&&r&&o){var A=[parseFloat(v[t]),parseFloat(v[i])],P=[parseFloat(v[r]),parseFloat(v[o])];E=[A,P]}if(u){var F="Polygon";Array.isArray(u[0])||(F="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(F="LineString");var N={type:F,coordinates:(0,_e.Z)(v[u])};St()(N,!0),E=N.coordinates}var V=(0,Z.Z)((0,Z.Z)({},v),{},{_id:g,coordinates:E});p.push(V)}),{dataArray:p}):{dataArray:[]}}var cr={PointLayer:{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}},LineLayer:{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}},wt=[{lng1:100,lat1:30,lng2:130,lat2:30}],Or={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function Xn(e,a){var t=_t(e);return Ut(t,a)}var Qr=63710088e-1,Pi={centimeters:Qr*100,centimetres:Qr*100,degrees:Qr/111325,feet:Qr*3.28084,inches:Qr*39.37,kilometers:Qr/1e3,kilometres:Qr/1e3,meters:Qr,metres:Qr,miles:Qr/1609.344,millimeters:Qr*1e3,millimetres:Qr*1e3,nauticalmiles:Qr/1852,radians:1,yards:Qr*1.0936},mi={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Qr,yards:1.0936133},ln={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ba(e,a,t){t===void 0&&(t={});var i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=a||{},i.geometry=e,i}function ua(e,a,t){switch(t===void 0&&(t={}),e){case"Point":return Li(a).geometry;case"LineString":return ci(a).geometry;case"Polygon":return ai(a).geometry;case"MultiPoint":return no(a).geometry;case"MultiLineString":return go(a).geometry;case"MultiPolygon":return It(a).geometry;default:throw new Error(e+" is invalid")}}function Li(e,a,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_r(e[0])||!_r(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return ba(i,a,t)}function Ma(e,a,t){return t===void 0&&(t={}),zo(e.map(function(i){return Li(i,a)}),t)}function ai(e,a,t){t===void 0&&(t={});for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var p={type:"Polygon",coordinates:e};return ba(p,a,t)}function Ki(e,a,t){return t===void 0&&(t={}),zo(e.map(function(i){return ai(i,a)}),t)}function ci(e,a,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return ba(i,a,t)}function gi(e,a,t){return t===void 0&&(t={}),zo(e.map(function(i){return ci(i,a)}),t)}function zo(e,a){a===void 0&&(a={});var t={type:"FeatureCollection"};return a.id&&(t.id=a.id),a.bbox&&(t.bbox=a.bbox),t.features=e,t}function go(e,a,t){t===void 0&&(t={});var i={type:"MultiLineString",coordinates:e};return ba(i,a,t)}function no(e,a,t){t===void 0&&(t={});var i={type:"MultiPoint",coordinates:e};return ba(i,a,t)}function It(e,a,t){t===void 0&&(t={});var i={type:"MultiPolygon",coordinates:e};return ba(i,a,t)}function ge(e,a,t){t===void 0&&(t={});var i={type:"GeometryCollection",geometries:e};return ba(i,a,t)}function oe(e,a){if(a===void 0&&(a=0),a&&!(a>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,a||0);return Math.round(e*t)/t}function Te(e,a){a===void 0&&(a="kilometers");var t=Pi[a];if(!t)throw new Error(a+" units is invalid");return e*t}function j(e,a){a===void 0&&(a="kilometers");var t=Pi[a];if(!t)throw new Error(a+" units is invalid");return e/t}function ot(e,a){return Yr(j(e,a))}function sr(e){var a=e%360;return a<0&&(a+=360),a}function Yr(e){var a=e%(2*Math.PI);return a*180/Math.PI}function Ke(e){var a=e%360;return a*Math.PI/180}function Dt(e,a,t){if(a===void 0&&(a="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Te(j(e,a),t)}function Cr(e,a,t){if(a===void 0&&(a="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=ln[a];if(!i)throw new Error("invalid original units");var r=ln[t];if(!r)throw new Error("invalid final units");return e/i*r}function _r(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Rr(e){return!!e&&e.constructor===Object}function mn(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(a){if(!_r(a))throw new Error("bbox must only contain numbers")})}function vi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ni(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function bn(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Oi(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Oi(e[0]);throw new Error("coordinates must only contain numbers")}function Ni(e,a,t){if(!a||!t)throw new Error("type and name required");if(!e||e.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.type)}function Ha(e,a,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.geometry.type)}function oa(e,a,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var i=0,r=e.features;i<r.length;i++){var o=r[i];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!o.geometry||o.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+o.geometry.type)}}function Wa(e){return e.type==="Feature"?e.geometry:e}function Ci(e,a){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function la(e,a,t){if(e!==null)for(var i,r,o,u,p,v,g,E=0,A=0,P,F=e.type,N=F==="FeatureCollection",V=F==="Feature",Y=N?e.features.length:1,ie=0;ie<Y;ie++){g=N?e.features[ie].geometry:V?e.geometry:e,P=g?g.type==="GeometryCollection":!1,p=P?g.geometries.length:1;for(var ye=0;ye<p;ye++){var Pe=0,tt=0;if(u=P?g.geometries[ye]:g,u!==null){v=u.coordinates;var pt=u.type;switch(E=t&&(pt==="Polygon"||pt==="MultiPolygon")?1:0,pt){case null:break;case"Point":if(a(v,A,ie,Pe,tt)===!1)return!1;A++,Pe++;break;case"LineString":case"MultiPoint":for(i=0;i<v.length;i++){if(a(v[i],A,ie,Pe,tt)===!1)return!1;A++,pt==="MultiPoint"&&Pe++}pt==="LineString"&&Pe++;break;case"Polygon":case"MultiLineString":for(i=0;i<v.length;i++){for(r=0;r<v[i].length-E;r++){if(a(v[i][r],A,ie,Pe,tt)===!1)return!1;A++}pt==="MultiLineString"&&Pe++,pt==="Polygon"&&tt++}pt==="Polygon"&&Pe++;break;case"MultiPolygon":for(i=0;i<v.length;i++){for(tt=0,r=0;r<v[i].length;r++){for(o=0;o<v[i][r].length-E;o++){if(a(v[i][r][o],A,ie,Pe,tt)===!1)return!1;A++}tt++}Pe++}break;case"GeometryCollection":for(i=0;i<u.geometries.length;i++)if(la(u.geometries[i],a,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Q(e,a,t,i){var r=t;return la(e,function(o,u,p,v,g){u===0&&t===void 0?r=o:r=a(r,o,u,p,v,g)},i),r}function ae(e,a){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&a(e.features[t].properties,t)!==!1;t++);break;case"Feature":a(e.properties,0);break}}function me(e,a,t){var i=t;return ae(e,function(r,o){o===0&&t===void 0?i=r:i=a(i,r,o)}),i}function ke(e,a){if(e.type==="Feature")a(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&a(e.features[t],t)!==!1;t++);}function qe(e,a,t){var i=t;return ke(e,function(r,o){o===0&&t===void 0?i=r:i=a(i,r,o)}),i}function st(e){var a=[];return la(e,function(t){a.push(t)}),a}function xt(e,a){var t,i,r,o,u,p,v,g,E,A,P=0,F=e.type==="FeatureCollection",N=e.type==="Feature",V=F?e.features.length:1;for(t=0;t<V;t++){for(p=F?e.features[t].geometry:N?e.geometry:e,g=F?e.features[t].properties:N?e.properties:{},E=F?e.features[t].bbox:N?e.bbox:void 0,A=F?e.features[t].id:N?e.id:void 0,v=p?p.type==="GeometryCollection":!1,u=v?p.geometries.length:1,r=0;r<u;r++){if(o=v?p.geometries[r]:p,o===null){if(a(null,P,g,E,A)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(a(o,P,g,E,A)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<o.geometries.length;i++)if(a(o.geometries[i],P,g,E,A)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}P++}}function Me(e,a,t){var i=t;return xt(e,function(r,o,u,p,v){o===0&&t===void 0?i=r:i=a(i,r,o,u,p,v)}),i}function it(e,a){xt(e,function(t,i,r,o,u){var p=t===null?null:t.type;switch(p){case null:case"Point":case"LineString":case"Polygon":return a(ba(t,r,{bbox:o,id:u}),i,0)===!1?!1:void 0}var v;switch(p){case"MultiPoint":v="Point";break;case"MultiLineString":v="LineString";break;case"MultiPolygon":v="Polygon";break}for(var g=0;g<t.coordinates.length;g++){var E=t.coordinates[g],A={type:v,coordinates:E};if(a(ba(A,r),i,g)===!1)return!1}})}function Gt(e,a,t){var i=t;return it(e,function(r,o,u){o===0&&u===0&&t===void 0?i=r:i=a(i,r,o,u)}),i}function Zr(e,a){it(e,function(t,i,r){var o=0;if(!!t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var p,v=0,g=0,E=0;if(la(t,function(A,P,F,N,V){if(p===void 0||i>v||N>g||V>E){p=A,v=i,g=N,E=V,o=0;return}var Y=lineString([p,A],t.properties);if(a(Y,i,r,V,o)===!1)return!1;o++,p=A})===!1)return!1}}})}function or(e,a,t){var i=t,r=!1;return Zr(e,function(o,u,p,v,g){r===!1&&t===void 0?i=o:i=a(i,o,u,p,v,g),r=!0}),i}function hr(e,a){if(!e)throw new Error("geojson is required");it(e,function(t,i,r){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(a(t,i,r,0,0)===!1)return!1;break;case"Polygon":for(var p=0;p<u.length;p++)if(a(lineString(u[p],t.properties),i,r,p)===!1)return!1;break}}})}function jr(e,a,t){var i=t;return hr(e,function(r,o,u,p){o===0&&t===void 0?i=r:i=a(i,r,o,u,p)}),i}function oi(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,i=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.segmentIndex||0,u=a.properties,p;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,p=e.features[t].geometry;break;case"Feature":u=u||e.properties,p=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":p=e;break;default:throw new Error("geojson is invalid")}if(p===null)return null;var v=p.coordinates;switch(p.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=v.length+o-1),lineString([v[o],v[o+1]],u,a);case"Polygon":return r<0&&(r=v.length+r),o<0&&(o=v[r].length+o-1),lineString([v[r][o],v[r][o+1]],u,a);case"MultiLineString":return i<0&&(i=v.length+i),o<0&&(o=v[i].length+o-1),lineString([v[i][o],v[i][o+1]],u,a);case"MultiPolygon":return i<0&&(i=v.length+i),r<0&&(r=v[i].length+r),o<0&&(o=v[i][r].length-o-1),lineString([v[i][r][o],v[i][r][o+1]],u,a)}throw new Error("geojson is invalid")}function Sn(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,i=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.coordIndex||0,u=a.properties,p;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,p=e.features[t].geometry;break;case"Feature":u=u||e.properties,p=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":p=e;break;default:throw new Error("geojson is invalid")}if(p===null)return null;var v=p.coordinates;switch(p.type){case"Point":return point(v,u,a);case"MultiPoint":return i<0&&(i=v.length+i),point(v[i],u,a);case"LineString":return o<0&&(o=v.length+o),point(v[o],u,a);case"Polygon":return r<0&&(r=v.length+r),o<0&&(o=v[r].length+o),point(v[r][o],u,a);case"MultiLineString":return i<0&&(i=v.length+i),o<0&&(o=v[i].length+o),point(v[i][o],u,a);case"MultiPolygon":return i<0&&(i=v.length+i),r<0&&(r=v[i].length+r),o<0&&(o=v[i][r].length-o),point(v[i][r][o],u,a)}throw new Error("geojson is invalid")}function Jt(e){for(var a=e.toString(),t=5381,i=a.length;i;)t=t*33^a.charCodeAt(--i);return t>>>0}function Hn(e,a){return a===void 0?null:a==="id"&&e.id?e.id:e[a]?e[a]:e.properties&&e.properties[a]?Jt(e.properties[a]+"")%1000019:null}function wn(e,a){var t=[],i={};return e.features?(e.features=e.features.filter(function(r){var o=r.geometry;return r!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),St()(e,!0),e.features.length===0?{dataArray:[],featureKeys:i}:(it(e,function(r,o){var u=Hn(r,a==null?void 0:a.featureId);u===null&&(u=o);var p=u,v=bn(r),g=(0,Z.Z)((0,Z.Z)({},r.properties),{},{coordinates:v,_id:p});t.push(g)}),{dataArray:t,featureKeys:i})):(e.features=[],{dataArray:[]})}function Tn(e){var a=131,t=137,i=0;e+="x";for(var r=Math.floor(9007199254740991/t),o=0;o<e.length;o++)i>r&&(i=Math.floor(i/t)),i=i*a+e.charCodeAt(o);return i}function sa(e){e=e.toString();for(var a=5381,t=e.length;t;)a=a*33^e.charCodeAt(--t);return a>>>0}var Ir=fe(28481),qi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function La(e){this.message=e}La.prototype=new Error,La.prototype.name="InvalidCharacterError";function na(e){var a=String(e).replace(/=+$/,"");if(a.length%4==1)throw new La("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",i=0,r,o,u=0;o=a.charAt(u++);~o&&(r=i%4?r*64+o:o,i++%4)?t+=String.fromCharCode(255&r>>(-2*i&6)):0)o=qi.indexOf(o);return t}function pa(e){e=String(e);for(var a,t,i,r,o="",u=0,p=e.length%3;u<e.length;){if((t=e.charCodeAt(u++))>255||(i=e.charCodeAt(u++))>255||(r=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");a=t<<16|i<<8|r,o+=qi.charAt(a>>18&63)+qi.charAt(a>>12&63)+qi.charAt(a>>6&63)+qi.charAt(a&63)}return p?o.slice(0,p-3)+"===".substring(p):o}var Lt=fe(6610),At=fe(5991),Qi=function(){function e(a,t){(0,Lt.Z)(this,e),this.buffers=a,this.type=t}return(0,At.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,i,r){throw new Error("not implemented")}}]),e}(),fo,Ba=function(){return fo||(fo=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof fe.g!="undefined"?fe.g:{})};fo=Ba();var zi;typeof window=="undefined"?zi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(a){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,i){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(a){return!0},Event:function(a,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:zi=window;var Ea=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Co=Ea?my.getSystemInfoSync().pixelRatio:zi.devicePixelRatio,sn=fe(10379),Wr=fe(46070),bt=fe(77608),Ds=(0,At.Z)(function e(a,t){(0,Lt.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=a,this.timeStamp=Date.now()}),jt=fe(63349);function Xi(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Yl(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function Yl(e,a){if(!!e){if(typeof e=="string")return Oa(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Oa(e,a)}}function Oa(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var po=new WeakMap,Oo=function(){function e(){(0,Lt.Z)(this,e),po.set(this,{})}return(0,At.Z)(e,[{key:"addEventListener",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=po.get(this);o||(o={}),o[t]||(o[t]=[]),o[t].push(i),po.set(this,o),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=po.get(this);if(o){var u=o[t];if(u&&u.length>0){for(var p=u.length;p--;p>0)if(u[p]===i){u.splice(p,1);break}}}}},{key:"dispatchEvent",value:function(t){var i=po.get(this)[t.type];if(i){var r=Xi(i),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u(t)}}catch(p){r.e(p)}finally{r.f()}}}}]),e}();function _a(e){var a=Bs();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Bs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ns=function(e){(0,sn.Z)(t,e);var a=_a(t);function t(){var i;return(0,Lt.Z)(this,t),i=a.call(this),i.childNodes=[],i}return(0,At.Z)(t,[{key:"appendChild",value:function(r){this.childNodes.push(r)}},{key:"cloneNode",value:function(){var r=Object.create(this);return Object.assign(r,this),r}},{key:"removeChild",value:function(r){var o=this.childNodes.findIndex(function(u){return u===r});return o>-1?this.childNodes.splice(o,1):null}}]),t}(Oo);function ql(e){var a=So();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function So(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ts=function(e){(0,sn.Z)(t,e);var a=ql(t);function t(){var i;return(0,Lt.Z)(this,t),i=a.call(this),i.className="",i.children=[],i}return(0,At.Z)(t,[{key:"setAttribute",value:function(r,o){this[r]=o}},{key:"getAttribute",value:function(r){return this[r]}},{key:"setAttributeNS",value:function(r,o){this[r]=o}},{key:"getAttributeNS",value:function(r){return this[r]}}]),t}(Ns),Ka=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Uo,Ms,Fo,Xu;if(Ka){var sl=my.getSystemInfoSync();Uo=sl.screenWidth,Ms=sl.screenHeight,Fo=sl.windowWidth,Xu=sl.windowHeight}else{var ns=zi.innerWidth,ve=zi.innerHeight;Uo=ns,Ms=ve,Fo=ns,Xu=ve}var Be={width:Uo,height:Ms,availWidth:Fo,availHeight:Xu,availLeft:0,availTop:0},yt=Be.availWidth,ir=Be.availHeight,gn={style:[]};function ei(e,a){if(!("parentNode"in e)){var t;a===0?t=function(){return null}:a===1?t=function(){return gn}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var i;a===0?i=function(){return null}:a===1?i=function(){return gn}:i=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:i})}}function ga(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:yt+"px",height:ir+"px",margin:"0px",padding:"0px"})}function Jo(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=yt,e.clientHeight=ir),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var a={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return a})}function Fa(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=yt,e.offsetHeight=ir)}function Zo(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=yt,e.scrollHeight=ir)}function Ho(e){var a=function(){return!0};e.classList=[],e.classList.add=a,e.classList.remove=a,e.classList.contains=a,e.classList.toggle=a}function Ro(e){var a=zs();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function zs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function hs(){}var Is=function(e){(0,sn.Z)(t,e);var a=Ro(t);function t(){var i,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,Lt.Z)(this,t),i=a.call(this),i.className="",i.children=[],i.focus=hs,i.blur=hs,i.insertBefore=hs,i.appendChild=hs,i.removeChild=hs,i.remove=hs,i.innerHTML="",i.tagName=r.toUpperCase(),ei((0,jt.Z)(i),o),ga((0,jt.Z)(i)),Ho((0,jt.Z)(i)),Jo((0,jt.Z)(i)),Fa((0,jt.Z)(i)),Zo((0,jt.Z)(i)),i}return(0,At.Z)(t)}(Ts);function bu(e){var a=Yu();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Yu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eu=function(e){(0,sn.Z)(t,e);var a=bu(t);function t(i){return(0,Lt.Z)(this,t),a.call(this,i)}return(0,At.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(Is);function Cu(e){var a=Za();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Za(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ps=function(e){(0,sn.Z)(t,e);var a=Cu(t);function t(){return(0,Lt.Z)(this,t),a.call(this,"video")}return(0,At.Z)(t)}(Eu),iu={},Su={};function mf(e,a){iu=e,iu.id=a,"tagName"in iu||(iu.tagName="CANVAS"),iu.type="canvas",Mixin.parentNode(iu),Mixin.style(iu),Mixin.classList(iu),Mixin.clientRegion(iu),Mixin.offsetRegion(iu),iu.focus=function(){},iu.blur=function(){}}function zh(e,a){var t=1024,i=1024;Su={width:t,height:i,clientWidth:t/devicePixelRatio,clientHeight:i/devicePixelRatio,id:a,type:"canvas"},"tagName"in Su||(Su.tagName="CANVAS"),Mixin.parentNode(Su),Mixin.style(Su),Mixin.classList(Su),Mixin.clientRegion(Su),Mixin.offsetRegion(Su),Su.getContext=function(r){if(r==="2d")return e},Su.focus=function(){},Su.blur=function(){}}function qs(){return iu}function gf(){return Su}var ul=(0,At.Z)(function e(){(0,Lt.Z)(this,e);var a=qs(),t=a.createImage&&a.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),ei(t),Ho(t),Object.assign(t,{addEventListener:function(r,o){t["on".concat(r)]=o.bind(t)},removeEventListener:function(r){t["on".concat(r)]=null}}),t}),jc={href:"",protocol:"",host:""};function b(e){var a=k();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G=function(e){(0,sn.Z)(t,e);var a=b(t);function t(){return(0,Lt.Z)(this,t),a.call(this,"body",0)}return(0,At.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o,u){}},{key:"dispatchEvent",value:function(r){}}]),t}(Is),D=function(e){(0,sn.Z)(t,e);var a=b(t);function t(){return(0,Lt.Z)(this,t),a.call(this,"html",0)}return(0,At.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o){}},{key:"dispatchEvent",value:function(r){}}]),t}(Is),ne={},Oe={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:jc,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(a){return a=a.toLowerCase(),a==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):a==="img"?new ul:a==="video"?new ps:new Is(a)},createElementNS:function(a,t){return this.createElement(t)},createTextNode:function(a){return a},getElementById:function(a){return null},getElementsByTagName:function(a){return a=a.toLowerCase(),[]},getElementsByTagNameNS:function(a,t){return this.getElementsByTagName(t)},getElementsByName:function(a){return[]},querySelector:function(a){return null},querySelectorAll:function(a){return[]},addEventListener:function(a,t,i){ne[a]||(ne[a]=[]),ne[a].push(t)},removeEventListener:function(a,t){var i=ne[a];if(i&&i.length>0){for(var r=i.length;r--;r>0)if(i[r]===t){i.splice(r,1);break}}},dispatchEvent:function(a){var t=a.type,i=ne[t];if(i)for(var r=0;r<i.length;r++)i[r](a);a.target&&typeof a.target["on"+t]=="function"&&a.target["on"+t](a)},createEvent:function(a){return new Ds(a)}};Oe.documentElement=new D,Oe.head=new Is("head"),Oe.body=new G;var dt=Object,Mt=fe(90484),Zt=function(){function e(){(0,Lt.Z)(this,e);var a=arguments.length;if(a===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else a===3&&(0,Mt.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,At.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Br=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Gr,Yn,ji;if(Br){var Ui=my.getSystemInfoSync();Gr=Ui.system,Yn=Ui.platform,ji=Ui.language}else{var Fi={versions:function(){var e=zi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(zi.navigator.browserLanguage||zi.navigator.language).toLowerCase()};Fi.versions.android?Yn="android":Fi.versions.trident?Yn="IE":Fi.versions.presto?Yn="Opera":Fi.versions.webKit?Yn="webKit":Fi.versions.gecko?Yn="Firefox":Fi.versions.mobile?Yn="mobile":Fi.versions.ios?Yn="ios":Fi.versions.iPhone?Yn="iPhone":Fi.versions.iPad?Yn="ipad":Fi.versions.webApp?Yn="webApp":Fi.versions.weixin?Yn="weixin":Fi.versions.qq&&(Yn="qq"),Gr=zi.navigator.userAgent,ji=Fi.language}var io=Gr.toLowerCase().indexOf("android")!==-1,vo=io?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ia="Mozilla/5.0 (".concat(vo,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(ji),au={platform:Yn,language:ji,appVersion:"5.0 (".concat(vo,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ia},Ll={mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,i){return{duration:0}},now:function(){}},hc=0,pc=0;function dc(e){var a=Date.now(),t=Math.max(hc+23,a);return pc=setTimeout(function(){e(hc=t)},t-a),pc}function vc(e){var a=qs();return a.requestAnimationFrame?a.requestAnimationFrame(e):dc(e)}function Du(e){var a=qs();return a.cancelAnimationFrame?a.cancelAnimationFrame(e):clearTimeout(e)}var Ol=function(){function e(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Lt.Z)(this,e),a.indexOf("http://")==0||a.indexOf("https://")==0){this.href=a;return}this.href=t+a}return(0,At.Z)(e,null,[{key:"createObjectURL",value:function(t){var i=t.buffers[0],r=t.type,o=gl(i),u="data:".concat(r,";base64, ");return u+o}}]),e}();function gl(e){for(var a="",t=new Uint8Array(e),i=t.byteLength,r=0;r<i;r++)a+=String.fromCharCode(t[r]);return pa(a)}var Wo={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},dp={};function Uh(e){var a=Au();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Au(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yf=new Map,yl=new Map,qu=new Map,Zh={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function _l(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,a)}function mo(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,_l.call(this,"readystatechange",a)}var $s=function(e){(0,sn.Z)(t,e);var a=Uh(t);function t(){var i;return(0,Lt.Z)(this,t),i=a.call(this),i.onabort=null,i.onerror=null,i.onload=null,i.onloadstart=null,i.onprogress=null,i.ontimeout=null,i.onloadend=null,i.onreadystatechange=null,i.readyState=0,i.response=null,i.responseText=null,i._responseType="text",i.responseXML=null,i.status=0,i.statusText="",i.upload={},i.withCredentials=!1,yf.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),i}return(0,At.Z)(t,[{key:"responseType",set:function(r){this._responseType=r}},{key:"abort",value:function(){var r=qu.get("requestTask");r&&r.abort()}},{key:"getAllResponseHeaders",value:function(){var r=yl.get("responseHeader");return Object.keys(r).map(function(o){return"".concat(o,": ").concat(r[o])}).join(`
`)}},{key:"getResponseHeader",value:function(r){return yl.get("responseHeader")[r]}},{key:"open",value:function(r,o,u){this._method=r,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(r,o){var u=yf.get("requestHeader");u[r]=o,yf.set("requestHeader",u)}},{key:"addEventListener",value:function(r,o){var u=this;typeof o=="function"&&(this["on"+r]=function(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};p.target=p.target||u,o.call(u,p)})}},{key:"removeEventListener",value:function(r,o){this["on"+r]===o&&(this["on"+r]=null)}}]),t}(Oo);$s.UNSEND=0,$s.OPENED=1,$s.HEADERS_RECEIVED=2,$s.LOADING=3,$s.DONE=4;function Vh(e){var a=xl();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function xl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vp=function(e){(0,sn.Z)(t,e);var a=Vh(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=qs(),r.currentTarget=qs(),r}return(0,At.Z)(t)}(Ds);function mp(e){var a=e||{},t=a.x,i=t===void 0?0:t,r=a.y,o=r===void 0?0:r,u=a.clientX,p=u===void 0?0:u,v=a.clientY,g=v===void 0?0:v;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=i,e.pageY=e.clientY=o):(e.x=p,e.y=g)}function ch(e){return function(a){var t=new vp(e);t.changedTouches=a.changedTouches,t.touches=a.touches,t.targetTouches=Array.prototype.slice.call(a.touches),t.timeStamp=a.timeStamp,t.changedTouches.forEach(function(i){return mp(i)}),t.touches.forEach(function(i){return mp(i)}),t.targetTouches.forEach(function(i){return mp(i)}),Oe.dispatchEvent(t)}}function jf(e){return function(a){a.type=e,Oe.dispatchEvent(a)}}var _f=ch("touchstart"),Gf=ch("touchmove"),Gc=ch("touchend"),Hf=jf("mapCameaParams");function mc(e){var a=xf();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function xf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $l=function(e){(0,sn.Z)(t,e);var a=mc(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),r.target=qs(),r.currentTarget=qs(),r}return(0,At.Z)(t)}(Ds),ou=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Wf=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Xf="touch";function jh(e,a,t){for(var i=new $l(e),r=0;r<ou.length;r++){var o=ou[r];i[o]=a[o]||Wf[r]}return i.type=e,i.target=qs(),i.currentTarget=qs(),i.buttons=gc(e),i.which=i.buttons,i.pointerId=(a.identifier||0)+2,i.bubbles=!0,i.cancelable=!0,i.button=0,i.width=(a.radiusX||.5)*2,i.height=(a.radiusY||.5)*2,i.pressure=a.force||.5,i.isPrimary=Fl(a),i.pointerType=Xf,i.altKey=t.altKey,i.ctrlKey=t.ctrlKey,i.metaKey=t.metaKey,i.shiftKey=t.shiftKey,t.preventDefault&&(i.preventDefault=function(){t.preventDefault()}),i}function gc(e){var a=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(a=1),a}var $u=null;function Fl(e){return $u===e.identifier}function Hc(e){$u===null&&($u=e.identifier)}function Kl(e){$u===e.identifier&&($u=null)}function Yf(e){return function(a){for(var t=a.changedTouches,i=0;i<t.length;i++){var r=t[i];i===0&&e==="pointerdown"?Hc(r):(e==="pointerup"||e==="pointercancel")&&Kl(r);var o=jh(e,r,a);Oe.dispatchEvent(o)}}}var qf=Yf("pointerdown"),yc=Yf("pointermove"),Gh=Yf("pointerup");function fh(e){var a=Wc();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Wc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vp=function(e){(0,sn.Z)(t,e);var a=fh(t);function t(i){return(0,Lt.Z)(this,t),a.call(this,i)}return(0,At.Z)(t)}(Ds);function hh(e){return function(a){a.type=e,Oe.dispatchEvent(a)}}var Hh=hh("mousedown"),bf=hh("mousemove"),jp=hh("mouseup"),Xc=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ao=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Us=Xc||Ao,Yc={atob:na,btoa:pa,devicePixelRatio:Co,Blob:Qi,document:Oe,Element:Ts,Event:Ds,EventTarget:Oo,HTMLCanvasElement:dt,HTMLElement:Is,HTMLMediaElement:Eu,HTMLVideoElement:ps,Image:ul,ImageData:Zt,navigator:au,Node:Ns,requestAnimationFrame:vc,cancelAnimationFrame:Du,screen:Be,XMLHttpRequest:$s,performance:Ll,URL:Ol,WebGLRenderingContext:Wo,WebGL2RenderingContext:dp,addEventListener:function(a,t){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Oe.addEventListener(a,t,i)},removeEventListener:function(a,t,i){Oe.removeEventListener(a,t)},dispatchEvent:function(a){Oe.dispatchEvent(a)},innerWidth:Be.availWidth,innerHeight:Be.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ka=Us?Yc:zi,Aa=Us?$s:zi.XMLHttpRequest,wo=Us?jc:zi.location;function pu(e){var a=e;return typeof e=="string"&&(a=ka.document.getElementById(e)),a}function Ef(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ql(e){return Ef(e).split(/\s+/)}function ph(e){var a,t,i=ka==null||(a=ka.document)===null||a===void 0||(t=a.documentElement)===null||t===void 0?void 0:t.style;if(!i)return e[0];for(var r in e)if(e[r]&&e[r]in i)return e[r];return e[0]}function Qa(e,a,t){var i=ka.document.createElement(e);return i.className=a||"",t&&t.appendChild(i),i}function Cf(e){var a=e.parentNode;a&&a.removeChild(e)}function Dl(e,a){if(e.classList!==void 0)for(var t=Ql(a),i=0,r=t.length;i<r;i++)e.classList.add(t[i]);else if(!Jl(e,a)){var o=Ku(e);ds(e,(o?o+" ":"")+a)}}function _c(e,a){e.classList!==void 0?e.classList.remove(a):ds(e,Ef((" "+Ku(e)+" ").replace(" "+a+" "," ")))}function Jl(e,a){if(e.classList!==void 0)return e.classList.contains(a);var t=Ku(e);return t.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(t)}function ds(e,a){e instanceof HTMLElement?e.className=a:e.className.baseVal=a}function Ku(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Sf(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Vo=ph(["transform","WebkitTransform"]);function ti(e,a){e.style[Vo]=a}function Xo(){if(typeof Event=="function")ka.dispatchEvent(new Event("resize"));else{var e=ka.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ka,0),ka.dispatchEvent(e)}}function qc(e){var a=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,a.join(""))}function Af(){var e,a=ka.document.querySelector('meta[name="viewport"]');if(!a)return 1;var t=(e=a.content)===null||e===void 0?void 0:e.split(","),i=t.find(function(r){var o=r.split("="),u=(0,Ir.Z)(o,2),p=u[0],v=u[1];return p==="initial-scale"});return i?i.split("=")[1]*1:1}var Ja=Af()<1?1:ka.devicePixelRatio;function Bu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a*1}function xc(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a*1}function Mn(e){if(e.length===0)return 0;for(var a=e[0]*1,t=1;t<e.length;t++)a+=e[t]*1;return a}function wf(e){if(e.length===0)throw new Error("mean requires at least one data point");return Mn(e)/e.length}function dh(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var a=e[0],t=NaN,i=0,r=1,o=1;o<e.length+1;o++)e[o]!==a?(r>i&&(i=r,t=a),r=1,a=e[o]):r++;return t*1}var bl={min:xc,max:Bu,mean:wf,sum:Mn,mode:dh};function ho(e,a){return e.map(function(t){return t[a]})}function du(e,a){return bl[e](a)}var Va=fe(92137),Bl=fe(14665);function wu(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Nl=fe(51814);function $f(e,a,t){return(0,Nl.Z)()?$f=Reflect.construct.bind():$f=function(r,o,u){var p=[null];p.push.apply(p,o);var v=Function.bind.apply(r,p),g=new v;return u&&(0,Bl.Z)(g,u.prototype),g},$f.apply(null,arguments)}function $c(e){var a=typeof Map=="function"?new Map:void 0;return $c=function(i){if(i===null||!wu(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(i))return a.get(i);a.set(i,r)}function r(){return $f(i,arguments,(0,bt.Z)(this).constructor)}return r.prototype=Object.create(i.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,Bl.Z)(r,i)},$c(e)}var gp=fe(87757),yi=fe.n(gp);function ll(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Ks(){return typeof importScripts=="function"}var ha=Ks()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function cl(e){var a=vu();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zs=function(e){(0,sn.Z)(t,e);var a=cl(t);function t(i,r,o,u){var p;return(0,Lt.Z)(this,t),p=a.call(this,"AJAXError: ".concat(r," (").concat(i,"): ").concat(o)),p.status=i,p.statusText=r,p.url=o,p.body=u,p}return(0,At.Z)(t)}($c(Error));function Tf(e,a){var t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:getReferrer(),signal:e==null?void 0:e.signal});return e.type==="json"&&t.headers.set("Accept","application/json"),fetch(t).then(function(i){return i.ok?(e.type==="arrayBuffer"?i.arrayBuffer():e.type==="json"?i.json():i.text()).then(function(r){a(null,r,i.headers.get("Cache-Control"),i.headers.get("Expires"))}).catch(function(r){a(new Error(r.message))}):i.blob().then(function(r){return a(new Zs(i.status,i.statusText,e.url,r))})}).catch(function(i){a(new Error(i.message))})}function bc(e,a){var t=new Aa;t.open(e.method||"GET",e.url,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){a(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var r=t.response;if(e.type==="json")try{r=JSON.parse(t.response)}catch(u){return a(u)}a(null,r,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"))}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});a(new Zs(t.status,t.statusText,e.url,o))}},t.send(e.body),t}function Tu(e,a){return bc(e,a)}var mu=function(a,t){return Tu(_objectSpread(_objectSpread({},a),{},{type:"json"}),t)},Qu=function(a,t){return Tu((0,Z.Z)((0,Z.Z)({},a),{},{type:"arrayBuffer"}),t)},bi=function(a,t){return Tu(_objectSpread(_objectSpread({},a),{},{method:"POST"}),t)};function pi(e){var a=$window.document.createElement("a");return a.href=e,a.protocol===$window.document.location.protocol&&a.host===$window.document.location.host}var Kf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Vs(e,a){var t=new ka.Image,i=ka.URL||ka.webkitURL;t.crossOrigin="anonymous",t.onload=function(){a(null,t),i.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Kf})},t.onerror=function(){return a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var r=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?i.createObjectURL(r):Kf}function fl(e,a){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(i){a(null,i)}).catch(function(i){a(new Error("Could not load image because of ".concat(i.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var es=function(a,t){return Qu(a,function(i,r){if(i)t(i);else if(r){var o=typeof createImageBitmap=="function";o?fl(r,t):Vs(r,t)}})},El=function(){var e=(0,Va.Z)(yi().mark(function a(t,i,r){var o,u,p,v,g,E;return yi().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.prev=0,P.next=3,r(t);case 3:o=P.sent,u=o.rasterData,p=o.width,v=o.height,g=0,E=8e3,i(null,{data:u,width:p,height:v,min:g,max:E}),P.next=15;break;case 12:P.prev=12,P.t0=P.catch(0),i(null,new Error(""+P.t0));case 15:case"end":return P.stop()}},a,null,[[0,12]])}));return function(t,i,r){return e.apply(this,arguments)}}(),vh=function(a,t,i){return Qu(a,function(r,o){r?t(r):o&&El(o,t,i)})};function Mf(e){return typeof e=="number"}var ja=2*Math.PI*6378137/2;function yo(e){var a=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var i=t.coordinates;mh(a,i)}),a}function mh(e,a){return Array.isArray(a[0])?a.forEach(function(t){mh(e,t)}):(e[0]>a[0]&&(e[0]=a[0]),e[1]>a[1]&&(e[1]=a[1]),e[2]<a[0]&&(e[2]=a[0]),e[3]<a[1]&&(e[3]=a[1])),e}function Qf(e,a){return hl(e,a)}function hl(e,a){return Array.isArray(e[0])?e.map(function(t){return hl(t,a)}):a(e)}function Ju(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=gh(e,a);var i=e[0],r=e[1],o=i*ja/180,u=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return u=u*ja/180,t.enable&&(o=Number(o.toFixed(t.decimal)),u=Number(u.toFixed(t.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function Qs(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],i=e[1],r=t/ja*180,o=i/ja*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),a!=null&&(r=Number(r.toFixed(a)),o=Number(o.toFixed(a))),e.length===3?[r,o,e[2]]:[r,o]}function pl(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function zl(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function gh(e,a){if(a===!1)return e;var t=pl(e[0]),i=zl(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[t,i,e[2]]:[t,i]}function Yo(e){var a=85.0511287798,t=Math.max(Math.min(a,e[1]),-a),i=256<<20,r=Math.PI/180,o=e[0]*r,u=t*r;u=Math.log(Math.tan(Math.PI/4+u/2));var p=.5/Math.PI,v=.5,g=-.5/Math.PI;return r=.5,o=i*(p*o+v),u=i*(g*u+r),[Math.floor(o),Math.floor(u)]}function yh(e){var a=.5/Math.PI,t=.5,i=-.5/Math.PI,r=.5,o=256<<20,u=_slicedToArray(e,2),p=u[0],v=u[1];p=(p/o-t)/a,v=(v/o-r)/i,v=(Math.atan(Math.pow(Math.E,v))-Math.PI/4)*2,r=Math.PI/180;var g=v/r,E=p/r;return[E,g]}function Wh(e,a){var t=85.0511287798,i=Math.PI/180,r=6378137;return a=Math.max(Math.min(t,a),-t),e*=i,a*=i,a=Math.log(Math.tan(Math.PI/4+a/2)),[e*r,a*r]}function If(e,a){var t=Math.PI/180,i=6378137,r=e/i/t,o=2*(Math.atan(Math.exp(a/i))-Math.PI/4)/t;return[r,o]}function Kc(e,a,t){var i=Ke(a[1]-e[1]),r=Ke(a[0]-e[0]),o=Ke(e[1]),u=Ke(a[1]),p=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(r/2),2)*Math.cos(o)*Math.cos(u);return Te(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t="meters")}function Xh(e){var a=Math.PI/180,t=85.0511287798,i=6378137,r=Math.max(Math.min(t,e[1]),-t),o=Math.sin(r*a),u=i*e[0]*a,p=i*Math.log((1+o)/(1-o))/2;return[u,p]}function dl(e,a){var t=Math.abs(e[1][1]-e[0][1])*a,i=Math.abs(e[1][0]-e[0][0])*a;return[[e[0][0]-i,e[0][1]-t],[e[1][0]+i,e[1][1]+t]]}function Cl(e,a){return e[0][0]<=a[0][0]&&e[0][1]<=a[0][1]&&e[1][0]>=a[1][0]&&e[1][1]>=a[1][1]}function Qc(e){return[[e[0],e[1]],[e[2],e[3]]]}function ec(e){var a=el(e,[0,0]);return[e[0]/a,e[1]/a]}function el(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function kf(e,a){return e[0]*a[0]+e[1]*a[1]}function Pf(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Gp(e,a){return Math.acos(kf(e,a)/(Pf(e)*Pf(a)))*180/Math.PI}function Jc(e,a){return a[0]>0?a[1]>0?90-Math.atan(a[1]/a[0])*180/Math.PI:90+Math.atan(-a[1]/a[0])*180/Math.PI:a[1]<0?180+(90-Math.atan(a[1]/a[0])*180/Math.PI):270+Math.atan(a[1]/-a[0])*180/Math.PI}function c(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],i=0,r=[],o=0;o<e.length-1;o++){var u=e[o],p=e[o+1],v=el(u,p);i+=v;var g=[u[0]-p[0],u[1]-p[1]],E=Jc(t,g);if(o>0){var A=r[o-1].rotation;A-E>360-A+E&&(E=E+360)}r.push({start:u,end:p,dis:v,rotation:E,duration:0})}return r.map(function(P){P.duration=a*(P.dis/i)}),r}}function h(e){if(Mf(e[0]))return e;if(Mf(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Mf(e[0][0][0])){var a=e,t=0,i=0,r=0;return a.forEach(function(o){o.forEach(function(u){t+=u[0],i+=u[1],r++})}),[t/r,i/r,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function f(e){for(var a=e[0],t=e[1],i=e[0],r=e[1],o=0,u=0,p=0,v=0;v<e.length;v+=2){var g=e[v],E=e[v+1];g&&E&&(a=Math.max(g,a),t=Math.max(E,t),i=Math.min(g,i),r=Math.min(E,r),o+=g,u+=E,p++)}return{center:[o/p,u/p],radius:Math.sqrt(Math.pow(a-i,2)+Math.pow(t-r,2))/2}}var m=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,Lt.Z)(this,e),this.limit=a,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,At.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(i){t.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var i=this.cache[t];return i&&(this.deleteOrder(t),this.appendOrder(t)),i}},{key:"set",value:function(t,i){this.cache[t]?(this.delete(t),this.cache[t]=i,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=i,this.appendOrder(t))}},{key:"delete",value:function(t){var i=this.cache[t];i&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(i,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var i=this.order.findIndex(function(r){return r===t});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,i){return null}}]),e}();function S(e,a){e.forEach(function(t){!a[t]||(a[t]=a[t].bind(a))})}var I=null,R=fe(2650);function z(e){return typeof e=="string"?!!R.ZP(e):!1}function W(e){var a=R.ZP(e),t=[0,0,0,0];return a!=null&&(t[0]=a.r/255,t[1]=a.g/255,t[2]=a.b/255,t[3]=a.opacity),t}function te(e){var a=e&&e[0],t=e&&e[1],i=e&&e[2],r=a+t*256+i*65536-1;return r}function be(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Se(e){var a=ka.document.createElement("canvas"),t=a.getContext("2d");a.width=256,a.height=1;var i=null;if(e.weights){var r=0;e.weights.map(function(P,F){var N=e.colors[F]||"rgba(0, 0, 0, 0)",V=r+P;t.fillStyle=N,t.fillRect(r*256,0,V*256,1),r=V})}else{for(var o=t.createLinearGradient(0,0,256,1),u=e.positions[0],p=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-u)/(p-u);o.addColorStop(g,e.colors[v])}t.fillStyle=o,t.fillRect(0,0,256,1)}if(Us)return i=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),a=null,t=null,{data:i,width:256,height:1};i=t.getImageData(0,0,256,1).data;for(var E=t.createImageData(256,1),A=0;A<E.data.length;A+=4)E.data[A+0]=i[A+0],E.data[A+1]=i[A+1],E.data[A+2]=i[A+2],E.data[A+3]=i[A+3];return a=null,t=null,E}var Ie;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Ie||(Ie={}));var Je={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Qe(e,a,t){var i=e.classList;for(var r in Je)Je.hasOwnProperty(r)&&i.remove("l7-".concat(t,"-anchor-").concat(r));i.add("l7-".concat(t,"-anchor-").concat(a))}function nt(e,a){return{enable:e,mask:255,func:{cmp:514,ref:a?1:0,mask:255}}}function He(e,a){if(!e)throw new Error(a||"web worker helper assertion failed.")}var ft={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},Et=ft.self||ft.window||{},Ht=ft.window||ft.self||{},vr=ft.self||ft.window||{},rr=ft.document||{},Ar=typeof importScripts=="function",Hr=typeof window!="undefined"&&typeof window.orientation!="undefined",xn=function(){function e(a,t){var i=this;this.name=a,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(r,o){i.resolve=r,i.reject=o})}return e.prototype.postMessage=function(a,t){this.workerThread.postMessage({source:"Main thread",type:a,payload:t})},e.prototype.done=function(a){He(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(a)},e.prototype.error=function(a){He(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(a)},e}(),yn=xn,Zn=new Map;function _i(e){He(e.source&&!e.url||!e.source&&e.url);var a=Zn.get(e.source||e.url);return a||(e.url&&(a=wi(e.url),Zn.set(e.url,a)),e.source&&(a=Ei(e.source),Zn.set(e.source,a))),He(a),a}function wi(e){if(!e.startsWith("http"))return e;var a=wa(e);return Ei(a)}function Ei(e){var a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)}function wa(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Wn(e,a,t){a===void 0&&(a=!0);var i=t||new Set;if(e){if(Gi(e))i.add(e);else if(Gi(e.buffer))i.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(a&&typeof e=="object")for(var r in e)Wn(e[r],a,i)}}return t===void 0?Array.from(i):[]}function Gi(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Ji=function(){},Yi=function(){function e(a){this.terminated=!1,this.loadableURL="";var t=a.name,i=a.source,r=a.url;He(i||r),this.name=t,this.source=i,this.url=r,this.onMessage=Ji,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Ji,this.onError=Ji,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(a,t){t=t||Wn(a),this.worker.postMessage(a,t)},e.prototype.getErrorFromErrorEvent=function(a){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",a.message&&(t+=a.message+" in "),a.lineno&&(t+=":"+a.lineno+":"+a.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var a=this;this.loadableURL=_i({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(i){i.data?a.onMessage(i.data):a.onError(new Error("No data received"))},t.onerror=function(i){a.onError(a.getErrorFromErrorEvent(i)),a.terminated=!0},t.onmessageerror=function(i){return console.error("worker "+a.name+", message error: "+i)},t},e}(),Ri=Yi,ea=function(){return ea=Object.assign||function(e){for(var a,t=1,i=arguments.length;t<i;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},ea.apply(this,arguments)},Di=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(A){u(A)}}function v(E){try{g(i.throw(E))}catch(A){u(A)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},ki=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},xs=function(){function e(a){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=a.source,this.url=a.url,this.setProps(a)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(a){return a.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(a){this.props=ea(ea({},this.props),a),a.name!==void 0&&(this.name=a.name),a.maxConcurrency!==void 0&&(this.maxConcurrency=a.maxConcurrency),a.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=a.maxMobileConcurrency),a.reuseWorkers!==void 0&&(this.reuseWorkers=a.reuseWorkers),a.onDebug!==void 0&&(this.onDebug=a.onDebug)},e.prototype.startJob=function(a,t,i){return t===void 0&&(t=function(r,o,u){return r.done(u)}),i===void 0&&(i=function(r,o){return r.error(o)}),Di(this,void 0,void 0,function(){var r,o=this;return ki(this,function(u){switch(u.label){case 0:return r=new Promise(function(p){return o.jobQueue.push({name:a,onMessage:t,onError:i,onStart:p}),o}),this.startQueuedJob(),[4,r];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Di(this,void 0,void 0,function(){var a,t,i;return ki(this,function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(a=this.getAvailableWorker(),!a)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:a}),i=new yn(t.name,a),a.onMessage=function(o){return t.onMessage(i,o.type,o.payload)},a.onError=function(o){return t.onError(i,o)},t.onStart(i),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,i.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(a),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(a){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(a.destroy(),this.count--):this.idleQueue.push(a),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var a=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Ri({name:a,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Hr?this.maxMobileConcurrency:this.maxConcurrency},e}(),qo=xs,is=function(){return is=Object.assign||function(e){for(var a,t=1,i=arguments.length;t<i;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},is.apply(this,arguments)},as=function(e){var a=typeof Symbol=="function"&&Symbol.iterator,t=a&&e[a],i=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},_o={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},os=function(){function e(a){this.workerPools=new Map,this.props=is({},_o),this.setProps(a),this.workerPools=new Map}return e.isSupported=function(){return Ri.isSupported()},e.getWorkerFarm=function(a){return a===void 0&&(a={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(a),e.workerFarm},e.prototype.destroy=function(){var a,t;try{for(var i=as(this.workerPools.values()),r=i.next();!r.done;r=i.next()){var o=r.value;o.destroy()}}catch(u){a={error:u}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(a)throw a.error}}},e.prototype.setProps=function(a){var t,i;this.props=is(is({},this.props),a);try{for(var r=as(this.workerPools.values()),o=r.next();!o.done;o=r.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(p){t={error:p}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(a){var t=a.name,i=a.source,r=a.url,o=this.workerPools.get(t);return o||(o=new qo({name:t,source:i,url:r}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Mu=os,ks=new Map,Ul=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(a){self.onmessage=function(t){if(!!Iu(t)){var i=t.data,r=i.type,o=i.payload;a(r,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(a){var t=ks.get(a);t||(t=function(i){if(!!Iu(i)){var r=i.data,o=r.type,u=r.payload;a(o,u)}}),self.addEventListener("message",t)},e.removeEventListener=function(a){var t=ks.get(a);ks.delete(a),self.removeEventListener("message",t)},e.postMessage=function(a,t){if(self){var i={source:"Worker thread",type:a,payload:t},r=Wn(t);self.postMessage(i,r)}},e}(),$o=Ul;function Iu(e){var a=e.type,t=e.data;return a==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function ku(e){return JSON.parse(Jf(e))}function Jf(e){var a=new Set;return JSON.stringify(e,function(t,i){if(typeof i=="object"&&i!==null){if(a.has(i))try{return JSON.parse(JSON.stringify(i))}catch(r){return}a.add(i)}return i})}function ef(e){return""+e.name}function Zl(e,a){a===void 0&&(a={});var t=a[e.id]||{},i=e.name+".worker.js",r=t.workerUrl;return a._workerType==="test"&&(r=e.module+"/dist/"+i),r||(r="https://unpkg.com/"+e.module+"/dist/"+i),assert(r),r}var tl=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(A){u(A)}}function v(E){try{g(i.throw(E))}catch(A){u(A)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},tf=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};function Sl(e,a){return WorkerFarm.isSupported()?e.worker&&(a==null?void 0:a.worker):!1}function Ec(e,a,t,i){return t===void 0&&(t={}),i===void 0&&(i={}),tl(this,void 0,void 0,function(){var r,o,u,p,v,g,E,A;return tf(this,function(P){switch(P.label){case 0:return r=getWorkerName(e),o=getWorkerURL(e,t),u=WorkerFarm.getWorkerFarm(t),p=u.getWorkerPool({name:r,url:o}),v=t.jobName||e.name,[4,p.startJob(v,Vl.bind(null,i))];case 1:return g=P.sent(),E=removeNontransferableOptions(t),g.postMessage("process",{input:a,options:E}),[4,g.result];case 2:return A=P.sent(),[2,A.result]}})})}function Vl(e,a,t,i){return tl(this,void 0,void 0,function(){var r,o,u,p,v,g,E;return tf(this,function(A){switch(A.label){case 0:switch(r=t,r){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return a.done(i),[3,9];case 2:return a.error(new Error(i.error)),[3,9];case 3:o=i.id,u=i.input,p=i.options,A.label=4;case 4:return A.trys.push([4,6,,7]),e.process?[4,e.process(u,p)]:(a.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return v=A.sent(),a.postMessage("done",{id:o,result:v}),[3,7];case 6:return g=A.sent(),E=g instanceof Error?g.message:"unknown error",a.postMessage("error",{id:o,error:E}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),A.label=9;case 9:return[2]}})})}var vs=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(a){return this.enqueue(a)},e.prototype.enqueue=function(a){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();a instanceof Error?t.reject(a):t.resolve({value:a})}else this._values.push(a)},e.prototype.close=function(){for(;this._settlers.length>0;){var a=this._settlers.shift();a.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var a=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(i,r){a._settlers.push({resolve:i,reject:r})})},e}(),Al=vs,Cc=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(A){u(A)}}function v(E){try{g(i.throw(E))}catch(A){u(A)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},gu=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},Ga=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=e[Symbol.asyncIterator],t;return a?a.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(o){t[o]=e[o]&&function(u){return new Promise(function(p,v){u=e[o](u),r(p,v,u.done,u.value)})}}function r(o,u,p,v){Promise.resolve(v).then(function(g){o({value:g,done:p})},u)}},Nu=0,bs,tc;function _h(e,a){var t=this;if(typeof self!="undefined"){var i={process:xh};$o.onmessage=function(r,o){return Cc(t,void 0,void 0,function(){var u,p,v,g,E,A,P,F,N,V,Y;return gu(this,function(ie){switch(ie.label){case 0:switch(ie.trys.push([0,19,,20]),u=r,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},i)];case 2:return p=ie.sent(),$o.postMessage("done",{result:p}),[3,18];case 3:if(!a)throw new Error("Worker does not support batched processing");bs=new Al,tc=o.options||{},v=a(bs,tc,i),ie.label=4;case 4:ie.trys.push([4,9,10,15]),g=Ga(v),ie.label=5;case 5:return[4,g.next()];case 6:if(E=ie.sent(),!!E.done)return[3,8];A=E.value,$o.postMessage("output-batch",{result:A}),ie.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return P=ie.sent(),V={error:P},[3,15];case 10:return ie.trys.push([10,,13,14]),E&&!E.done&&(Y=g.return)?[4,Y.call(g)]:[3,12];case 11:ie.sent(),ie.label=12;case 12:return[3,14];case 13:if(V)throw V.error;return[7];case 14:return[7];case 15:return $o.postMessage("done",{}),[3,18];case 16:return bs.push(o.input),[3,18];case 17:return bs.close(),[3,18];case 18:return[3,20];case 19:return F=ie.sent(),N=F instanceof Error?F.message:"",$o.postMessage("error",{error:N}),[3,20];case 20:return[2]}})})}}}function xh(e,a){return a===void 0&&(a={}),new Promise(function(t,i){var r=Nu++,o=function(p,v){if(v.id===r)switch(p){case"done":$o.removeEventListener(o),t(v.result);break;case"error":$o.removeEventListener(o),i(v.error);break;default:}};$o.addEventListener(o);var u={id:r,input:e,options:a};$o.postMessage("process",u)})}var bh=function(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(A){u(A)}}function v(E){try{g(i.throw(E))}catch(A){u(A)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})},zu=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},jl={};function Uu(e,a,t){return a===void 0&&(a=null),t===void 0&&(t={}),bh(this,void 0,void 0,function(){return zu(this,function(i){switch(i.label){case 0:return a&&(e=rf(e,a,t)),jl[e]=jl[e]||Rf(e),[4,jl[e]];case 1:return[2,i.sent()]}})})}function rf(e,a,t){if(e.startsWith("http"))return e;var i=t.modules||{};return i[e]?i[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+a+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+a+"/src/libs/"+e}function Rf(e){return bh(this,void 0,void 0,function(){var a,t,i;return zu(this,function(r){switch(r.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return a=r.sent(),[4,a.arrayBuffer()];case 2:return[2,r.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=r.sent(),[4,t.text()];case 5:return i=r.sent(),[2,Gl(i,e)]}})})}function Gl(e,a){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=a;try{t.appendChild(document.createTextNode(e))}catch(i){t.text=e}return document.body.appendChild(t),null}var Js="0.0.3",Yh={id:"null",name:"null",module:"web-worker-helper",options:{}},rc=fe(75174),yp=fe.n(rc);function su(e,a){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function nf(e,a,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function eh(e,a){var t=e.filter;return t?[1]:[0]}function Sc(e,a,t,i){return[a]}var qh=fe(9187),rl=fe.n(qh),xe=fe(96156),$r=fe(31437),Ac=$r.create(),Qd=$r.create(),eu=$r.create(),js=$r.create(),Pu=$r.create();function Td(e,a,t,i,r){$r.add(e,t,i),$r.normalize(e,e),a=$r.fromValues(-e[1],e[0]);var o=$r.fromValues(-t[1],t[0]);return[r/$r.dot(a,o),a]}function af(e,a){return $r.set(e,-a[1],a[0])}function th(e,a,t){return $r.sub(e,a,t),$r.normalize(e,e),e}function Eh(e,a){return e[0]===a[0]&&e[1]===a[1]}function rh(e){for(var a=new Map,t=0;t<e.length;t++){var i=e[0].toString()+"-"+e[1].toString();a.get(i)?(e.splice(t,1),t++):a.set(i,i)}return e}var Ch=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Lt.Z)(this,e),(0,xe.Z)(this,"lastFlip",-1),(0,xe.Z)(this,"miter",$r.fromValues(0,0)),(0,xe.Z)(this,"started",!1),(0,xe.Z)(this,"dash",!1),(0,xe.Z)(this,"totalDistance",0),(0,xe.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,At.Z)(e,[{key:"extrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,A=t[p-1];A.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var P=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var N=i[p],V=p<t.length-1?[].concat((0,_e.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,Y=p<i.length-1?i[p+1]:null,ie=this.segment_gaode2(r,u,A,F,V,P,N,Y);u+=ie}if(this.dash)for(var ye=0;ye<r.positions.length/6;ye++)r.positions[ye*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,A=t[p-1];A.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var P=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var N=i[p],V=p<t.length-1?[].concat((0,_e.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,Y=p<i.length-1?i[p+1]:null,ie=this.simpleSegment(r,u,A,F,V,P,N,Y);u+=ie}if(this.dash)for(var ye=0;ye<r.positions.length/6;ye++)r.positions[ye*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.segment(i,o,p,v,g);o+=E}if(this.dash)for(var A=0;A<i.positions.length/6;A++)i.positions[A*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.simpleSegment(i,o,p,v,g);o+=E}if(this.dash)for(var A=0;A<i.positions.length/6;A++)i.positions[A*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(t,i,r,o,u,p,v,g){var E=0,A=t.indices,P=t.positions,F=t.normals,N=this.cap==="square",V=this.join==="bevel",Y=Yo([v[0],v[1]]),ie=Yo([p[0],p[1]]);th(eu,o,r);var ye=0;if(this.dash&&(ye=this.lineSegmentDistance(Y,ie),this.totalDistance+=ye),this.normal||(this.normal=$r.create(),af(this.normal,eu)),!this.started)if(this.started=!0,N){var Pe=$r.create(),tt=$r.create();$r.add(Pe,this.normal,eu),$r.add(tt,this.normal,eu),F.push(tt[0],tt[1],0),F.push(Pe[0],Pe[1],0),P.push(r[0],r[1],r[2]|0,this.totalDistance-ye,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),P.push(r[0],r[1],r[2]|0,this.totalDistance-ye,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(P,F,r,this.normal,this.thickness,this.totalDistance-ye);if(A.push(i+0,i+1,i+2),u){Eh(o,u)&&$r.add(u,o,$r.normalize(u,$r.subtract(u,o,r))),th(js,u,o);var Xt=Td(Pu,$r.create(),eu,js,this.thickness),er=(0,Ir.Z)(Xt,2),wr=er[0],kr=er[1],Sr=$r.dot(Pu,this.normal)<0?-1:1,un=V;if(!un&&this.join==="miter"){var Dn=wr;Dn>this.miterLimit&&(un=!0)}un?(F.push(this.normal[0],this.normal[1],0),F.push(kr[0],kr[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Sr,o[2]|0),this.complex.indexes.push(this.currentIndex),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Sr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push.apply(A,(0,_e.Z)(this.lastFlip!==-Sr?[i,i+2,i+3]:[i+2,i+1,i+3])),A.push(i+2,i+3,i+4),af(Ac,js),$r.copy(this.normal,Ac),F.push(this.normal[0],this.normal[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Sr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(P,F,o,kr,wr,this.totalDistance),A.push.apply(A,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Sr=-1,$r.copy(this.normal,kr),E+=2),this.lastFlip=Sr}else{if(af(this.normal,eu),N){var pt=$r.create(),vt=$r.create();$r.sub(vt,eu,this.normal),$r.add(pt,eu,this.normal),F.push(vt[0],vt[1],0),F.push(pt[0],pt[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(P,F,o,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),E+=2}return E}},{key:"simpleSegment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,A=Yo([o[0],o[1]]),P=Yo([r[0],r[1]]);th(eu,A,P);var F=0;if(this.dash&&(F=this.lineSegmentDistance(A,P),this.totalDistance+=F),this.normal||(this.normal=$r.create(),af(this.normal,eu)),this.started||(this.started=!0,this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-F)),v.push(i+0,i+1,i+2),!u)af(this.normal,eu),this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2;else{var N=Yo([u[0],u[1]]);Eh(A,N)&&$r.add(N,A,$r.normalize(N,$r.subtract(N,A,P))),th(js,N,A);var V=Td(Pu,$r.create(),eu,js,this.thickness),Y=(0,Ir.Z)(V,2),ie=Y[0],ye=Y[1],Pe=$r.dot(Pu,this.normal)<0?-1:1;this.extrusions(g,E,o,ye,ie,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Pe=-1,$r.copy(this.normal,ye),p+=2,this.lastFlip=Pe}return p}},{key:"segment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,A=this.cap==="square",P=this.join==="bevel",F=Yo([o[0],o[1]]),N=Yo([r[0],r[1]]);th(eu,F,N);var V=0;if(this.dash&&(V=this.lineSegmentDistance(F,N),this.totalDistance+=V),this.normal||(this.normal=$r.create(),af(this.normal,eu)),!this.started)if(this.started=!0,A){var Y=$r.create(),ie=$r.create();$r.add(Y,this.normal,eu),$r.add(ie,this.normal,eu),E.push(ie[0],ie[1],0),E.push(Y[0],Y[1],0),g.push(r[0],r[1],r[2]|0,this.totalDistance-V,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),g.push(r[0],r[1],r[2]|0,this.totalDistance-V,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-V);if(v.push(i+0,i+1,i+2),u){var tt=Yo([u[0],u[1]]);Eh(F,tt)&&$r.add(tt,F,$r.normalize(tt,$r.subtract(tt,F,N))),th(js,tt,F);var pt=Td(Pu,$r.create(),eu,js,this.thickness),vt=(0,Ir.Z)(pt,2),Xt=vt[0],er=vt[1],wr=$r.dot(Pu,this.normal)<0?-1:1,kr=P;if(!kr&&this.join==="miter"){var Sr=Xt;Sr>this.miterLimit&&(kr=!0)}kr?(E.push(this.normal[0],this.normal[1],0),E.push(er[0],er[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v.push.apply(v,(0,_e.Z)(this.lastFlip!==-wr?[i,i+2,i+3]:[i+2,i+1,i+3])),v.push(i+2,i+3,i+4),af(Ac,js),$r.copy(this.normal,Ac),E.push(this.normal[0],this.normal[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p+=3):(this.extrusions(g,E,o,er,Xt,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),wr=-1,$r.copy(this.normal,er),p+=2),this.lastFlip=wr}else{if(af(this.normal,eu),A){var ye=$r.create(),Pe=$r.create();$r.sub(Pe,eu,this.normal),$r.add(ye,eu,this.normal),E.push(Pe[0],Pe[1],0),E.push(ye[0],ye[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance);v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2}return p}},{key:"extrusions",value:function(t,i,r,o,u,p){i.push(o[0],o[1],0),i.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,p,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,p,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,i){var r=i[0]-t[0],o=i[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}();function wc(e){var a=e.coordinates,t=e.originCoordinates,i=e.version,r=new Ch({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var p=0;p<o.length;p++){var v=o[p],g=u[p];r.extrude_gaode2(v,g)}}else{var E=a;E[0]&&!Array.isArray(E[0][0])&&(E=[a]),E.forEach(function(P){r.extrude(P)})}var A=r.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,indexes:A.indexes,size:6}}function Ko(e){var a=h(e.coordinates);return{vertices:[].concat((0,_e.Z)(a),(0,_e.Z)(a),(0,_e.Z)(a),(0,_e.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function $h(e){var a=e.coordinates,t=rl().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:rl()(i,o,r),vertices:i,size:r}}var Md=function(){var e=(0,Va.Z)(yi().mark(function a(t){var i,r,o,u,p,v,g,E,A;return yi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u=t.iconMap,p={a_Color:su,a_Position:nf,filter:eh,a_vertexId:Sc,a_PickingColor:function(V,Y){var ie=V.id;return o?be(ie):[0,0,0]},a_DistanceAndIndex:function(V,Y,ie,ye,Pe,tt){return tt===void 0?[ie[3],10]:[ie[3],tt]},a_Total_Distance:function(V,Y,ie,ye){return[ie[5]]},a_Size:function(V,Y,ie,ye){var Pe=V.size,tt=Pe===void 0?1:Pe;return Array.isArray(tt)?[tt[0],tt[1]]:[tt,0]},a_Normal:function(V,Y,ie,ye,Pe){return Pe},a_Miter:function(V,Y,ie,ye){return[ie[4]]},a_iconMapUV:function(V,Y,ie,ye){var Pe=V.texture,tt=u[Pe]||{x:0,y:0},pt=tt.x,vt=tt.y;return[pt,vt]}},v={sizePerElement:0,elements:[]},g=0,E=[],A=3,r.forEach(function(N,V){var Y=wc(N),ie=Y.indices,ye=Y.vertices,Pe=Y.normals,tt=Y.size,pt=Y.indexes;ie.forEach(function(wr){E.push(wr+g)}),A=tt;var vt=ye.length/tt;v.sizePerElement=A,v.elements.push({featureIdx:V,vertices:ye,normals:Pe,offset:g}),g+=vt;for(var Xt=function(kr){var Sr=(Pe==null?void 0:Pe.slice(kr*3,kr*3+3))||[],un=ye.slice(kr*tt,kr*tt+tt),Dn=0;pt&&pt[kr]!==void 0&&(Dn=pt[kr]),i.forEach(function(li,Da){if(li&&p[li.name]){var $a;($a=li.buffer.data).push.apply($a,(0,_e.Z)(p[li.name](N,V,un,kr,Sr,Dn)))}})},er=0;er<vt;er++)Xt(er)}),F.abrupt("return",{descriptors:i,featureLayout:v,indices:E});case 8:case"end":return F.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),$i=function(){var e=(0,Va.Z)(yi().mark(function a(t){var i,r,o,u,p,v,g,E,A;return yi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u=t.shape2d,p={a_Color:su,a_Position:nf,filter:eh,a_vertexId:Sc,a_PickingColor:function(V,Y){var ie=V.id;return o?be(ie):[0,0,0]},a_Shape:function(V,Y,ie,ye){var Pe=V.shape,tt=Pe===void 0?2:Pe,pt=u.indexOf(tt);return[pt]},a_Extrude:function(V,Y,ie,ye){var Pe=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],tt=ye%4*3;return[Pe[tt],Pe[tt+1],Pe[tt+2]]},a_Size:function(V,Y,ie,ye){var Pe=V.size,tt=Pe===void 0?5:Pe;return Array.isArray(tt)?[tt[0]]:[tt]}},v={sizePerElement:0,elements:[]},g=0,E=[],A=3,r.forEach(function(N,V){var Y=Ko(N),ie=Y.indices,ye=Y.vertices,Pe=Y.normals,tt=Y.size,pt=Y.indexes;ie.forEach(function(wr){E.push(wr+g)}),A=tt;var vt=ye.length/tt;v.sizePerElement=A,v.elements.push({featureIdx:V,vertices:ye,normals:Pe,offset:g}),g+=vt;for(var Xt=function(kr){var Sr=(Pe==null?void 0:Pe.slice(kr*3,kr*3+3))||[],un=ye.slice(kr*tt,kr*tt+tt),Dn=0;pt&&pt[kr]!==void 0&&(Dn=pt[kr]),i.forEach(function(li,Da){if(li&&p[li.name]){var $a;($a=li.buffer.data).push.apply($a,(0,_e.Z)(p[li.name](N,V,un,kr,Sr,Dn)))}})},er=0;er<vt;er++)Xt(er)}),F.abrupt("return",{descriptors:i,featureLayout:v,indices:E});case 8:case"end":return F.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),Hp=function(){var e=(0,Va.Z)(yi().mark(function a(t){var i,r,o,u,p,v,g,E;return yi().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return i=t.descriptors,r=t.features,o=t.enablePicking,u={a_Color:su,a_Position:nf,filter:eh,a_vertexId:Sc,a_PickingColor:function(N,V){var Y=N.id;return o?be(Y):[0,0,0]}},p={sizePerElement:0,elements:[]},v=0,g=[],E=3,r.forEach(function(F,N){var V=$h(F),Y=V.indices,ie=V.vertices,ye=V.normals,Pe=V.size,tt=V.indexes;Y.forEach(function(er){g.push(er+v)}),E=Pe;var pt=ie.length/Pe;p.sizePerElement=E,p.elements.push({featureIdx:N,vertices:ie,normals:ye,offset:v}),v+=pt;for(var vt=function(wr){var kr=(ye==null?void 0:ye.slice(wr*3,wr*3+3))||[],Sr=ie.slice(wr*Pe,wr*Pe+Pe),un=0;tt&&tt[wr]!==void 0&&(un=tt[wr]),i.forEach(function(Dn,li){if(Dn&&u[Dn.name]){var Da;(Da=Dn.buffer.data).push.apply(Da,(0,_e.Z)(u[Dn.name](F,N,Sr,wr,kr,un)))}})},Xt=0;Xt<pt;Xt++)vt(Xt)}),P.abrupt("return",{descriptors:i,featureLayout:p,indices:g});case 8:case"end":return P.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),Kh={pointFill:$i,line:Md,polygonFill:Hp},Tc=(0,Z.Z)({},Kh);function _p(e){return nl.apply(this,arguments)}function nl(){return nl=(0,Va.Z)(yi().mark(function e(a){var t,i;return yi().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=a.workerType,i=a.data,!Tc[t]){o.next=3;break}return o.abrupt("return",Tc[t](i));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),nl.apply(this,arguments)}_h(_p);var Sh=new Map;function of(e,a){Sh.set(e,a)}function Wp(e){var a=Sh.get(e);return a}var nc="l7-worker",ic=3,xp=!0;function Xp(e){of(nc,e)}function Qh(){var e=Wp(nc);if(!e)throw new Error("get worker failed by workerName: ".concat(nc,"."));return e}function Jh(e,a){return Zu.apply(this,arguments)}function Zu(){return Zu=(0,Va.Z)(yi().mark(function e(a,t){var i,r,o,u,p;return yi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return i=Qh(),r=Mu.getWorkerFarm({maxConcurrency:ic,reuseWorkers:xp}),o=r.getWorkerPool({name:nc,source:i}),g.next=5,o.startJob(nc,function(E,A,P){return E.done(P)});case 5:return u=g.sent,u.postMessage("process",{input:{workerType:a,data:t}}),g.next=9,u.result;case 9:return p=g.sent,g.abrupt("return",p.result);case 11:case"end":return g.stop()}},e)})),Zu.apply(this,arguments)}Xp(yp());var ac={BACK:1029,FRONT:1028};function Lf(e){switch(e){case"GAODE1.x":return ac.BACK;case"GAODE2.x":return ac.BACK;case"MAPBOX":return ac.FRONT;case"SIMPLE":return ac.FRONT;case"GLOBEL":return ac.BACK;case"L7MAP":return ac.FRONT;default:return ac.FRONT}}function Yp(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function sf(e,a){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=a.x,i=a.y,r=a.z;if(Array.isArray(e)){var o=Math.abs(t+i)%e.length;e=e[o]}return e.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,i.toString()).replace(/\{z\}/g,r.toString()).replace(/\{-y\}/g,(Math.pow(2,r)-i-1).toString())}var Of;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(Of||(Of={}));var Gs;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Gs||(Gs={}));function Ah(e,a){a===void 0&&(a={});var t=Number(e[0]),i=Number(e[1]),r=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[t,i],p=[t,o],v=[r,o],g=[r,i];return ai([[u,g,v,p,u]],a.properties,{bbox:e,id:a.id})}var qp=0,uf=1,ep=2;function Mc(e){e.forEach(function(a){a.isCurrent&&(a.isVisible=a.isLoaded)})}function Ic(e){e.forEach(function(a){a.properties.state=qp}),e.forEach(function(a){a.isCurrent&&!kc(a)&&oc(a)}),e.forEach(function(a){a.isVisible=Boolean(a.properties.state&ep)})}function Ru(e){e.forEach(function(t){t.properties.state=qp}),e.forEach(function(t){t.isCurrent&&kc(t)});var a=e.slice().sort(function(t,i){return t.z-i.z});a.forEach(function(t){t.isVisible=Boolean(t.properties.state&ep),t.children.length&&(t.isVisible||t.properties.state&uf)?t.children.forEach(function(i){i.properties.state=uf}):t.isCurrent&&oc(t)})}function kc(e){for(;e;){if(e.isLoaded)return e.properties.state|=ep,!0;e=e.parent}return!1}function oc(e){e.children.forEach(function(a){a.isLoaded?a.properties.state|=ep:oc(a)})}var Pc,lf=256,tp=[-Infinity,-Infinity,Infinity,Infinity],w0=.2,cf=5,wh=(Pc={},(0,xe.Z)(Pc,Of.Realtime,Mc),(0,xe.Z)(Pc,Of.Overlap,Ic),(0,xe.Z)(Pc,Of.Replace,Ru),Pc),nh=function(){};function Rc(e,a,t){var i=Math.floor((e+180)/360*Math.pow(2,t)),r=Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[i,r]}function $p(e,a,t){var i=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,o]}var Kp=function(a,t,i){var r=$p(a,t,i),o=(0,Ir.Z)(r,2),u=o[0],p=o[1],v=$p(a+1,t+1,i),g=(0,Ir.Z)(v,2),E=g[0],A=g[1];return[u,A,E,p]};function bp(e){var a=e.zoom,t=e.latLonBounds,i=e.maxZoom,r=i===void 0?Infinity:i,o=e.minZoom,u=o===void 0?0:o,p=e.zoomOffset,v=p===void 0?0:p,g=e.extent,E=g===void 0?tp:g,A=Math.ceil(a)+v;if(Number.isFinite(u)&&A<u)return[];Number.isFinite(r)&&A>r&&(A=r);for(var P=(0,Ir.Z)(t,4),F=P[0],N=P[1],V=P[2],Y=P[3],ie=[Math.max(F,E[0]),Math.max(N,E[1]),Math.min(V,E[2]),Math.min(Y,E[3])],ye=[],Pe=Rc(ie[0],ie[1],A),tt=(0,Ir.Z)(Pe,2),pt=tt[0],vt=tt[1],Xt=Rc(ie[2],ie[3],A),er=(0,Ir.Z)(Xt,2),wr=er[0],kr=er[1],Sr=pt;Sr<=wr;Sr++)for(var un=kr;un<=vt;un++)ye.push({x:Sr,y:un,z:A});var Dn=(wr+pt)/2,li=(vt+kr)/2,Da=function(Fs,Fu){return Math.abs(Fs-Dn)+Math.abs(Fu-li)};return ye.sort(function($a,Fs){return Da($a.x,$a.y)-Da(Fs.x,Fs.y)}),ye}var Id=function(a,t,i){var r=Math.pow(2,i),o=r-1,u=r,p=a,v=t;return p<0?p=p+u:p>o&&(p=p%u),{warpX:p,warpY:v}},oo=function(){function e(a){(0,Lt.Z)(this,e),(0,xe.Z)(this,"tileSize",256),(0,xe.Z)(this,"isVisible",!1),(0,xe.Z)(this,"isCurrent",!1),(0,xe.Z)(this,"isVisibleChange",!1),(0,xe.Z)(this,"parentLayerIDList",[]),(0,xe.Z)(this,"layerIDList",[]),(0,xe.Z)(this,"parent",null),(0,xe.Z)(this,"children",[]),(0,xe.Z)(this,"data",null),(0,xe.Z)(this,"properties",{}),(0,xe.Z)(this,"loadDataId",0);var t=a.x,i=a.y,r=a.z,o=a.tileSize;this.x=t,this.y=i,this.z=r,this.tileSize=o}return(0,At.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===Gs.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Gs.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Gs.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Gs.Cancelled}},{key:"isDone",get:function(){return[Gs.Loaded,Gs.Cancelled,Gs.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Kp(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,Ir.Z)(this.bounds,4),i=t[0],r=t[1],o=t[2],u=t[3],p=[(o-i)/2,(u-r)/2],v=Ah(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:p,meta:`
      `.concat(this.key,`
      `)}});return v}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"loadData",value:function(){var a=(0,Va.Z)(yi().mark(function i(r){var o,u,p,v,g,E,A,P,F,N,V,Y,ie,ye,Pe,tt;return yi().wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:return o=r.getData,u=r.onLoad,p=r.onError,this.loadDataId++,v=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Gs.Loading,g=null,vt.prev=7,A=this.x,P=this.y,F=this.z,N=this.bounds,V=this.tileSize,Y=Id(A,P,F),ie=Y.warpX,ye=Y.warpY,Pe=this.abortController.signal,tt={x:ie,y:ye,z:F,bounds:N,tileSize:V,signal:Pe},vt.next=14,o(tt,this);case 14:g=vt.sent,vt.next=20;break;case 17:vt.prev=17,vt.t0=vt.catch(7),E=vt.t0;case 20:if(v===this.loadDataId){vt.next=22;break}return vt.abrupt("return");case 22:if(!(this.isCancelled&&!g)){vt.next=24;break}return vt.abrupt("return");case 24:if(!(E||!g)){vt.next=28;break}return this.loadStatus=Gs.Failure,p(E,this),vt.abrupt("return");case 28:this.loadStatus=Gs.Loaded,this.data=g,u(this);case 31:case"end":return vt.stop()}},i,this,[[7,17]])}));function t(i){return a.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Gs.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),e}(),Hs=fe(26729),To=fe.n(Hs),Ws=function(a,t){var i=Qc(a),r=dl(i,t),o=360*3-180,u=85.0511287798065,p=[Math.max(r[0][0],-o),Math.max(r[0][1],-u),Math.min(r[1][0],o),Math.min(r[1][1],u)];return p},kd=function(a,t){var i=Qc(a),r=Qc(t),o=Cl(i,r);return o};function Lc(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Jd(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function Jd(e,a){if(!!e){if(typeof e=="string")return Pd(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Pd(e,a)}}function Pd(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function Qp(e){var a=Jp();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Jp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e0=function(e){(0,sn.Z)(t,e);var a=Qp(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this),(0,xe.Z)((0,jt.Z)(r),"currentTiles",[]),(0,xe.Z)((0,jt.Z)(r),"cacheTiles",new Map),(0,xe.Z)((0,jt.Z)(r),"onTileLoad",function(o){r.emit("tile-loaded",o),r.updateTileVisible()}),(0,xe.Z)((0,jt.Z)(r),"onTileError",function(o,u){r.emit("tile-error",{error:o,tile:u}),r.updateTileVisible()}),(0,xe.Z)((0,jt.Z)(r),"onTileUnload",function(o){r.emit("tile-unload",o)}),r.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:tp,getTileData:nh,updateStrategy:Of.Replace},r.updateOptions(i),r}return(0,At.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(r){return r.isDone})}},{key:"tiles",get:function(){var r=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return r}},{key:"updateOptions",value:function(r){var o=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),u=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},this.options),r),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(r,o){var u=this,p=Math.ceil(r);if(!(this.lastViewStates&&this.lastViewStates.zoom===p&&kd(this.lastViewStates.latLonBoundsBuffer,o))){var v=Ws(o,w0);this.lastViewStates={zoom:p,latLonBounds:o,latLonBoundsBuffer:v};var g=!1,E=this.getTileIndices(p,v);this.currentTiles=E.map(function(A){var P=A.x,F=A.y,N=A.z,V=u.getTile(P,F,N);if(V){var Y,ie,ye=((Y=V)===null||Y===void 0?void 0:Y.isFailure)||((ie=V)===null||ie===void 0?void 0:ie.isCancelled);return ye&&V.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),V}return V=u.createTile(P,F,N),g=!0,V}),g&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var r=Lc(this.cacheTiles),o;try{for(r.s();!(o=r.n()).done;){var u=(0,Ir.Z)(o.value,2),p=u[0],v=u[1];this.currentTiles.includes(v)||(this.cacheTiles.delete(p),this.onTileUnload(v)),this.onTileUnload(v),v.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(g){r.e(g)}finally{r.f()}}},{key:"pruneRequests",value:function(){var r=[],o=Lc(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var p=u.value;p.isLoading&&!p.isCurrent&&!p.isVisible&&r.push(p)}}catch(g){o.e(g)}finally{o.f()}for(;r.length>0;){var v=r.shift();v.abortLoad()}}},{key:"destroy",value:function(){var r=Lc(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(p){r.e(p)}finally{r.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var r=this.options.updateStrategy,o=new Map,u=Lc(this.cacheTiles.values()),p;try{for(u.s();!(p=u.n()).done;){var v=p.value;o.set(v.key,v.isVisible),v.isCurrent=!1,v.isVisible=!1}}catch(N){u.e(N)}finally{u.f()}var g=Lc(this.currentTiles),E;try{for(g.s();!(E=g.n()).done;){var A=E.value;A.isCurrent=!0,A.isVisible=!0}}catch(N){g.e(N)}finally{g.f()}var P=Array.from(this.cacheTiles.values());typeof r=="function"?r(P):wh[r](P);var F=!1;Array.from(this.cacheTiles.values()).forEach(function(N){N.isVisible!==o.get(N.key)?(N.isVisibleChange=!0,F=!0):N.isVisibleChange=!1}),F&&this.emit("tile-update")}},{key:"getTileIndices",value:function(r,o){var u=this.options,p=u.tileSize,v=u.extent,g=u.zoomOffset,E=Math.floor(this.options.maxZoom),A=Math.ceil(this.options.minZoom),P=bp({maxZoom:E,minZoom:A,zoomOffset:g,tileSize:p,zoom:r,latLonBounds:o,extent:v});return P}},{key:"getTileId",value:function(r,o,u){var p="".concat(r,",").concat(o,",").concat(u);return p}},{key:"getTile",value:function(r,o,u){var p=this.getTileId(r,o,u),v=this.cacheTiles.get(p);return v}},{key:"createTile",value:function(r,o,u){var p=this.getTileId(r,o,u),v=new oo({x:r,y:o,z:u,tileSize:this.options.tileSize});return this.cacheTiles.set(p,v),v.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),v}},{key:"resizeCacheTiles",value:function(){var r=cf*this.currentTiles.length,o=this.cacheTiles.size>r;if(o){var u=Lc(this.cacheTiles),p;try{for(u.s();!(p=u.n()).done;){var v=(0,Ir.Z)(p.value,2),g=v[0],E=v[1];if(!E.isVisible&&!this.currentTiles.includes(E)&&(this.cacheTiles.delete(g),this.onTileUnload(E)),this.cacheTiles.size<=r)break}}catch(A){u.e(A)}finally{u.f()}}}},{key:"rebuildTileTree",value:function(){var r=Lc(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(A){r.e(A)}finally{r.f()}var p=Lc(this.cacheTiles.values()),v;try{for(p.s();!(v=p.n()).done;){var g=v.value,E=this.getNearestAncestor(g.x,g.y,g.z);g.parent=E,E!=null&&E.children&&E.children.push(g)}}catch(A){p.e(A)}finally{p.f()}}},{key:"getNearestAncestor",value:function(r,o,u){for(;u>this.options.minZoom;){r=Math.floor(r/2),o=Math.floor(o/2),u=u-1;var p=this.getTile(r,o,u);if(p)return p}return null}}]),t}(To()),t0;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(t0||(t0={}));function ed(e,a,t,i,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,p=t;return u&&(p=Math.round(t*(o-1))/(o-1)),i?xo(e,a,p,i,r):xo(e,a,p,.314,r)}function Ep(e,a){var t=1-a;return(e[0]*t+e[1]*a)*t+(e[1]*t+e[2]*a)*a}function r0(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function Ff(e,a,t){var i=[a[0]-e[0],a[1]-e[1]],r=r0(i,[0,0]),o=Math.atan2(i[1],i[0]),u=r/2/Math.cos(t),p=o+t,v=[u*Math.cos(p)+e[0],u*Math.sin(p)+e[1]];return v}function xo(e,a,t,i,r){if(r===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(a[0],a[1]),p=Ff(o,u,i),v=[o[0],p[0],u[0]],g=[o[1],p[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(Ep(v,t),Ep(g,t))),[0])}else{var E=Ff(e,a,i),A=[e[0],E[0],a[0]],P=[e[1],E[1],a[1]];return[Ep(A,t),Ep(P,t),0]}}function Rd(e,a,t,i,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,p=t;return u&&(p=Math.round(t*29)/29),td(e,a,p,r)}function Oc(e,a){var t=[a[0]-e[0],a[1]-e[1]],i=calDistance(t,[0,0]),r=Math.atan2(t[1],t[0]),o=.314,u=i/2/Math.cos(o),p=r+o,v=[u*Math.cos(p)+e[0],u*Math.sin(p)+e[1]];return v}function ih(e,a){var t=1-a;return(e[0]*t+e[1]*a)*t+(e[1]*t+e[2]*a)*a}function Ld(e,a){var t=[e[0]-a[0],e[1]-a[1]],i=[Math.sin(t[0]/2),Math.sin(t[1]/2)],r=i[1]*i[1]+Math.cos(e[1])*Math.cos(a[1])*i[0]*i[0];return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}function td(e,a,t,i){var r=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(a[0]),degreesToRadians(a[1])];if(i==="GAODE2.x"){var u=Oc(r,o),p=[r[0],u[0],o[0]],v=[r[1],u[1],o[1]];return[ih(p,t),ih(v,t),0]}else{var g=Ld(r,o);if(Math.abs(g-Math.PI)<.001)return[(1-t)*r[0]+t*o[0],(1-t)*r[1]+t*o[1]];var E=Math.sin((1-t)*g)/Math.sin(g),A=Math.sin(t*g)/Math.sin(g),P=[Math.sin(r[0]),Math.sin(r[1])],F=[Math.cos(r[0]),Math.cos(r[1])],N=[Math.sin(o[0]),Math.sin(o[1])],V=[Math.cos(o[0]),Math.cos(o[1])],Y=E*F[1]*F[0]+A*V[1]*V[0],ie=E*F[1]*P[0]+A*V[1]*N[0],ye=E*P[1]+A*N[1];return[radiansToDegrees(Math.atan2(ie,Y)),radiansToDegrees(Math.atan2(ye,Math.sqrt(Y*Y+ie*ie)))]}}function H(e,a){for(var t=0,i=[],r=0;r<e.length-1;r++){var o=e[r],u=e[r+1],p=at(o,u),v=t;t+=p,i.push({p1:o,p2:u,totalDistance:t,distance:p,lastTotalDistance:v})}for(var g=t*a,E,A,P=0;P<i.length;P++){var F=i[P].totalDistance;if(F>g){var N=i[P].p1,V=i[P].p2,Y=(g-i[P].lastTotalDistance)/i[P].distance,ie=Le(V,N,Y);E=ie[0],A=ie[1];break}}return{_lng:E,_lat:A,_height:0}}function Le(e,a,t){return[e[0]*t+a[0]*(1-t),e[1]*t+a[1]*(1-t)]}function at(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function fr(e,a){var t=a.featureId,i=e.data.dataArray;return typeof t=="number"&&(i=i.filter(function(r){var o=r._id;return o===t})),i.map(function(r){var o=ur(r,a);return _objectSpread(_objectSpread({},r),o)})}function Nr(e,a){return new Promise(function(t,i){e.inited?t(fr(e,a)):e.once("sourceUpdate",function(){t(fr(e,a))})})}function ur(e,a){var t=a.offset,i=a.shape,r=a.thetaOffset,o=a.mapVersion,u=a.segmentNumber,p=u===void 0?30:u,v=a.autoFit,g=v===void 0?!0:v,E=e.coordinates;if(i==="line")return pathLineAtOffset(E,t);var A=E[0],P=E[1],F;typeof r=="string"?F=e[r]||0:F=r;var N;switch(i){case"arc":N=arcLineAtOffset;break;case"greatcircle":N=greatCircleLineAtOffset;break;default:N=arcLineAtOffset}var V=N(A,P,t,F,o,p,g),Y=_slicedToArray(V,3),ie=Y[0],ye=Y[1],Pe=Y[2];return{_lng:ie,_lat:ye,_height:Pe}}function Tr(e,a){var t=a.extent,i=t===void 0?[121.168,30.2828,121.384,30.4219]:t,r=new Promise(function(u){e instanceof HTMLImageElement||ll(e)?u([e]):Vr(e,function(p){u(p)})}),o={originData:e,images:r,_id:1,dataArray:[{_id:0,coordinates:[[i[0],i[1]],[i[2],i[3]]]}]};return o}function Vr(e,a){var t=e,i=[];if(typeof t=="string")es({url:t},function(u,p){p&&(i.push(p),a(i))});else{var r=t.length,o=0;t.forEach(function(u){es({url:u},function(p,v){o++,v&&i.push(v),o===r&&a(i)})})}return Tr}var qr=fe(38929),rn=fe(3614),pn=fe.n(rn),dn={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},An=512;function en(e,a,t){var i=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[i,o]}function fn(e){for(var a=0,t=0,i=e.length,r=i-1,o,u;t<i;r=t++)o=e[t],u=e[r],a+=(u.x-o.x)*(o.y+u.y);return a}function Ft(e){var a=e.length;if(a<=1)return[e];for(var t=[],i,r,o=0;o<a;o++){var u=fn(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(i&&t.push(i),i=[e[o]]):i.push(e[o]))}return i&&t.push(i),t}var mr=["Unknown","Point","LineString","Polygon"];function nn(e,a){var t=a.extent,i=a.loadGeometry(),r=a.type,o=a.properties,u=a.id,p=t*Math.pow(2,e),v=mr[r],g,E;function A(N){for(var V=0;V<N.length;V++){var Y=N[V];N[V]=[Y.x/p*An,Y.y/p*An]}}switch(r){case 1:var P=[];for(g=0;g<i.length;g++)P[g]=i[g][0];i=P,A(i);break;case 2:for(g=0;g<i.length;g++)A(i[g]);break;case 3:for(i=Ft(i),g=0;g<i.length;g++)for(E=0;E<i[g].length;E++)A(i[g][E]);break}i.length===1?i=i[0]:v="Multi"+v;var F={type:"Feature",geometry:{type:v,coordinates:i},properties:o,id:u,tileOrigin:[0,0],coord:""};return F}var kn=function(){var e=(0,Va.Z)(yi().mark(function a(t,i,r,o){var u;return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=sf(t,i),v.abrupt("return",new Promise(function(g){var E=Qu({url:u},function(A,P){if(A||!P)g({layers:{}});else{for(var F=new qr.VectorTile(new(pn())(P)),N=en(i.x,i.y,i.z),V=i.z,Y=0,ie=Object.keys(F.layers);Y<ie.length;Y++){for(var ye=ie[Y],Pe=[],tt=F.layers[ye],pt=0;pt<F.layers[ye].length;pt++){var vt=F.layers[ye].feature(pt),Xt=void 0;o==="lnglat"?Xt=vt.toGeoJSON(i.x,i.y,i.z):(Xt=nn(V,vt),tt.l7TileOrigin=N,tt.l7TileCoord=o),Pe.push(Xt)}tt.features=Pe}g(F)}});r.xhrCancel=function(){return E.abort()}}));case 2:case"end":return v.stop()}},a)}));return function(t,i,r,o){return e.apply(this,arguments)}}();function zr(e,a){var t=(a==null?void 0:a.coord)||"lnglat",i=function(u,p){return kn(e,u,p,t)},r=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},dn),a),{},{getTileData:i});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}function _n(e,a){var t=a.extent,i=a.width,r=a.height,o=a.min,u=a.max,p={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:r,min:o,max:u,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return p}var On;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer"})(On||(On={}));var Ti=function(){var e=(0,Va.Z)(yi().mark(function a(t,i,r,o){var u;return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=sf(t,i),v.abrupt("return",new Promise(function(g,E){var A=vh({url:u},function(P,F){P?E(P):F&&g(F)},o);r.xhrCancel=function(){return A.abort()}}));case 2:case"end":return v.stop()}},a)}));return function(t,i,r,o){return e.apply(this,arguments)}}(),Mr=function(){var e=(0,Va.Z)(yi().mark(function a(t,i,r){var o;return yi().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o=sf(t,i),p.abrupt("return",new Promise(function(v,g){var E=es({url:o},function(A,P){A?g(A):P&&v(P)});r.xhrCancel=function(){return E.abort()}}));case 2:case"end":return p.stop()}},a)}));return function(t,i,r){return e.apply(this,arguments)}}(),Lr=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},si={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function Ln(e,a){var t=(a==null?void 0:a.dataType)||On.IMAGE,i=function(u,p){return t===On.IMAGE?Mr(e,u,p):Ti(e,u,p,(a==null?void 0:a.format)||Lr)},r=(0,Z.Z)((0,Z.Z)((0,Z.Z)({},si),a),{},{getTileData:i});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}var tn=fe(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Bn(e,a,t,i){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function p(E){try{g(i.next(E))}catch(A){u(A)}}function v(E){try{g(i.throw(E))}catch(A){u(A)}}function g(E){E.done?o(E.value):r(E.value).then(p,v)}g((i=i.apply(e,a||[])).next())})}function Un(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},i,r,o,u;return u={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function p(g){return function(E){return v([g,E])}}function v(g){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,r&&(o=g[0]&2?r.return:g[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,g[1])).done)return o;switch(r=0,o&&(g=[g[0]&2,o.value]),g[0]){case 0:case 1:o=g;break;case 4:return t.label++,{value:g[1],done:!1};case 5:t.label++,r=g[1],g=[0];continue;case 7:g=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(g[0]===6||g[0]===2)){t=0;continue}if(g[0]===3&&(!o||g[1]>o[0]&&g[1]<o[3])){t.label=g[1];break}if(g[0]===6&&t.label<o[1]){t.label=o[1],o=g;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(g);break}o[2]&&t.ops.pop(),t.trys.pop();continue}g=a.call(e,t)}catch(E){g=[6,E],r=0}finally{i=o=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}}function ca(e,a){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var i=t.call(e),r,o=[],u;try{for(;(a===void 0||a-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(p){u={error:p}}finally{try{r&&!r.done&&(t=i.return)&&t.call(i)}finally{if(u)throw u.error}}return o}function Hi(){for(var e=[],a=0;a<arguments.length;a++)e=e.concat(ca(arguments[a]));return e}function Jr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function on(e,a){return a={exports:{}},e(a,a.exports),a.exports}var Ii=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1==0}e.exports=a.default});Jr(Ii);var ta=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return function(){for(var i=[],r=arguments.length;r--;)i[r]=arguments[r];var o=i.pop();return t.call(this,i,o)}},e.exports=a.default});Jr(ta);var da=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.fallback=r,a.wrap=o;var t=a.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=a.hasNextTick=typeof tn=="object"&&typeof tn.nextTick=="function";function r(p){setTimeout(p,0)}function o(p){return function(v){for(var g=[],E=arguments.length-1;E-- >0;)g[E]=arguments[E+1];return p(function(){return v.apply(void 0,g)})}}var u;t?u=setImmediate:i?u=tn.nextTick:u=r,a.default=o(u)});Jr(da);var ss=da.fallback,ms=da.wrap,Pa=da.hasSetImmediate,yu=da.hasNextTick,Mo=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(ta),i=r(da);function r(v){return v&&v.__esModule?v:{default:v}}function o(v){return(0,Io.isAsync)(v)?function(){for(var g=[],E=arguments.length;E--;)g[E]=arguments[E];var A=g.pop(),P=v.apply(this,g);return u(P,A)}:(0,t.default)(function(g,E){var A;try{A=v.apply(this,g)}catch(P){return E(P)}if(A&&typeof A.then=="function")return u(A,E);E(null,A)})}function u(v,g){return v.then(function(E){p(g,null,E)},function(E){p(g,E&&E.message?E:new Error(E))})}function p(v,g,E){try{v(g,E)}catch(A){(0,i.default)(function(P){throw P},A)}}e.exports=a.default});Jr(Mo);var Io=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.isAsyncIterable=a.isAsyncGenerator=a.isAsync=void 0;var t=i(Mo);function i(v){return v&&v.__esModule?v:{default:v}}function r(v){return v[Symbol.toStringTag]==="AsyncFunction"}function o(v){return v[Symbol.toStringTag]==="AsyncGenerator"}function u(v){return typeof v[Symbol.asyncIterator]=="function"}function p(v){if(typeof v!="function")throw new Error("expected a function");return r(v)?(0,t.default)(v):v}a.default=p,a.isAsync=r,a.isAsyncGenerator=o,a.isAsyncIterable=u});Jr(Io);var Ps=Io.isAsyncIterable,uu=Io.isAsyncGenerator,tu=Io.isAsync,Es=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i,r){if(r===void 0&&(r=i.length),!r)throw new Error("arity is undefined");function o(){for(var u=this,p=[],v=arguments.length;v--;)p[v]=arguments[v];return typeof p[r-1]=="function"?i.apply(this,p):new Promise(function(g,E){p[r-1]=function(A){for(var P=[],F=arguments.length-1;F-- >0;)P[F]=arguments[F+1];if(A)return E(A);g(P.length>1?P:P[0])},i.apply(u,p)})}return Object.defineProperty(o,"name",{configurable:!0,value:"awaitable("+i.name+")"}),o}e.exports=a.default});Jr(Es);var Qo=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=o(Ii),i=o(Io),r=o(Es);function o(u){return u&&u.__esModule?u:{default:u}}a.default=(0,r.default)(function(u,p,v){var g=(0,t.default)(p)?[]:{};u(p,function(E,A,P){(0,i.default)(E)(function(F){for(var N,V=[],Y=arguments.length-1;Y-- >0;)V[Y]=arguments[Y+1];V.length<2&&(N=V,V=N[0]),g[A]=V,P(F)})},function(E){return v(E,g)})},3),e.exports=a.default});Jr(Qo);var ia=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){function r(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(i!==null){var p=i;i=null,p.apply(this,o)}}return Object.assign(r,i),r}e.exports=a.default});Jr(ia);var Cs=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=a.default});Jr(Cs);var Na=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=v;var t=r(Ii),i=r(Cs);function r(g){return g&&g.__esModule?g:{default:g}}function o(g){var E=-1,A=g.length;return function(){return++E<A?{value:g[E],key:E}:null}}function u(g){var E=-1;return function(){var P=g.next();return P.done?null:(E++,{value:P.value,key:E})}}function p(g){var E=g?Object.keys(g):[],A=-1,P=E.length;return function(){var N=E[++A];return A<P?{value:g[N],key:N}:null}}function v(g){if((0,t.default)(g))return o(g);var E=(0,i.default)(g);return E?u(E):p(g)}e.exports=a.default});Jr(Na);var Rs=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(i){return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];if(i===null)throw new Error("Callback was already called.");var u=i;i=null,u.apply(this,r)}}e.exports=a.default});Jr(Rs);var Zi=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t={};a.default=t,e.exports=a.default});Jr(Zi);var Ca=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=r;var t=i(Zi);function i(o){return o&&o.__esModule?o:{default:o}}function r(o,u,p,v){var g=!1,E=!1,A=!1,P=0,F=0;function N(){P>=u||A||g||(A=!0,o.next().then(function(ie){var ye=ie.value,Pe=ie.done;if(!(E||g)){if(A=!1,Pe){g=!0,P<=0&&v(null);return}P++,p(ye,F,V),F++,N()}}).catch(Y))}function V(ie,ye){if(P-=1,!E){if(ie)return Y(ie);if(ie===!1){g=!0,E=!0;return}if(ye===t.default||g&&P<=0)return g=!0,v(null);N()}}function Y(ie){E||(A=!1,g=!0,v(ie))}N()}e.exports=a.default});Jr(Ca);var eo=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=p(ia),i=p(Na),r=p(Rs),o=p(Ca),u=p(Zi);function p(v){return v&&v.__esModule?v:{default:v}}a.default=function(v){return function(g,E,A){if(A=(0,t.default)(A),v<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!g)return A(null);if((0,Io.isAsyncGenerator)(g))return(0,o.default)(g,v,E,A);if((0,Io.isAsyncIterable)(g))return(0,o.default)(g[Symbol.asyncIterator](),v,E,A);var P=(0,i.default)(g),F=!1,N=!1,V=0,Y=!1;function ie(Pe,tt){if(!N)if(V-=1,Pe)F=!0,A(Pe);else if(Pe===!1)F=!0,N=!0;else{if(tt===u.default||F&&V<=0)return F=!0,A(null);Y||ye()}}function ye(){for(Y=!0;V<v&&!F;){var Pe=P();if(Pe===null){F=!0,V<=0&&A(null);return}V+=1,E(Pe.value,Pe.key,(0,r.default)(ie))}Y=!1}ye()}},e.exports=a.default});Jr(eo);var us=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=o(eo),i=o(Io),r=o(Es);function o(p){return p&&p.__esModule?p:{default:p}}function u(p,v,g,E){return(0,t.default)(v)(p,(0,i.default)(g),E)}a.default=(0,r.default)(u,4),e.exports=a.default});Jr(us);var Fc=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=r(us),i=r(Es);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p,v){return(0,t.default)(u,1,p,v)}a.default=(0,i.default)(o,3),e.exports=a.default});Jr(Fc);var Ye=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(Qo),i=r(Fc);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p){return(0,t.default)(i.default,u,p)}e.exports=a.default}),pr=Jr(Ye),Vt=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return this.args=t,pr(this.tasks)},e.prototype.tap=function(a,t){var i=this;this.tasks.push(function(r){t.apply(void 0,Hi(i.args)),r(null,a)})},e}(),qn=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=g(Ii),i=g(Zi),r=g(us),o=g(ia),u=g(Rs),p=g(Io),v=g(Es);function g(F){return F&&F.__esModule?F:{default:F}}function E(F,N,V){V=(0,o.default)(V);var Y=0,ie=0,ye=F.length,Pe=!1;ye===0&&V(null);function tt(pt,vt){pt===!1&&(Pe=!0),Pe!==!0&&(pt?V(pt):(++ie===ye||vt===i.default)&&V(null))}for(;Y<ye;Y++)N(F[Y],Y,(0,u.default)(tt))}function A(F,N,V){return(0,r.default)(F,Infinity,N,V)}function P(F,N,V){var Y=(0,t.default)(F)?E:A;return Y(F,(0,p.default)(N),V)}a.default=(0,v.default)(P,3),e.exports=a.default});Jr(qn);var Ta=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=r(qn),i=r(Qo);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,p){return(0,i.default)(t.default,u,p)}e.exports=a.default}),Ve=Jr(Ta),Ce=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.promise=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return Ve(this.tasks)},e.prototype.tapPromise=function(a,t){var i=this;this.tasks.push(function(r){return Bn(i,void 0,void 0,function(){return Un(this,function(o){switch(o.label){case 0:return[4,t()];case 1:return o.sent(),r(null,a),[2]}})})})},e}(),ht=on(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=u(ia),i=u(Rs),r=u(Io),o=u(Es);function u(v){return v&&v.__esModule?v:{default:v}}function p(v,g){if(g=(0,t.default)(g),!Array.isArray(v))return g(new Error("First argument to waterfall must be an array of functions"));if(!v.length)return g();var E=0;function A(F){var N=(0,r.default)(v[E++]);N.apply(void 0,F.concat([(0,i.default)(P)]))}function P(F){for(var N=[],V=arguments.length-1;V-- >0;)N[V]=arguments[V+1];if(F!==!1){if(F||E===v.length)return g.apply(void 0,[F].concat(N));A(N)}}A([])}a.default=(0,o.default)(p),e.exports=a.default}),Bt=Jr(ht),ar=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return Bt(this.tasks)},e.prototype.tap=function(a,t){this.tasks.length===0?this.tasks.push(function(i){var r=t();i(r?null:!1,r)}):this.tasks.push(function(i,r){var o=t();r(o?null:!1,a)})},e}(),gt=function(){function e(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],i=0;i<arguments.length;i++)t[i]=a[i];return pr(this.tasks)},e.prototype.tap=function(a,t){this.tasks.push(function(i){var r=t();i(r,a)})},e}(),he=fe(96486),Tt=fe(69848),Fe=fe.n(Tt);function ct(e,a){var t=a.radius,i=t===void 0?40:t,r=a.maxZoom,o=r===void 0?18:r,u=a.minZoom,p=u===void 0?0:u,v=a.zoom,g=v===void 0?2:v;if(e.pointIndex){var E=e.pointIndex.getClusters(e.extent,Math.floor(g));return e.dataArray=Ge(E),e}var A=new(Fe())({radius:i,minZoom:p,maxZoom:o}),P={type:"FeatureCollection",features:[]};return P.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:(0,Z.Z)({},F)}}),A.load(P.features),A}function Ge(e){return e.map(function(a,t){return(0,Z.Z)({coordinates:a.geometry.coordinates,_id:t+1},a.properties)})}function Nt(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a}function qt(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a}function Ur(e){if(e.length===0)return 0;for(var a=e[0],t=0,i,r=1;r<e.length;r++)i=a+e[r]*1,Math.abs(a)>=Math.abs(e[r])?t+=a-i+e[r]:t+=e[r]-i+a,a=i;return a+t*1}function Pn(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ur(e)/e.length}var In={min:qt,max:Nt,mean:Pn,sum:Ur};function Vn(e,a){return e.map(function(t){return t[a]*1})}function En(e){var a=fi();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function fi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function jn(e,a){if(Array.isArray(a))return a}var $n=function(e){(0,sn.Z)(t,e);var a=En(t);function t(i,r){var o;return(0,Lt.Z)(this,t),o=a.call(this),(0,xe.Z)((0,jt.Z)(o),"inited",!1),(0,xe.Z)((0,jt.Z)(o),"hooks",{init:new Vt}),(0,xe.Z)((0,jt.Z)(o),"parser",{type:"geojson"}),(0,xe.Z)((0,jt.Z)(o),"transforms",[]),(0,xe.Z)((0,jt.Z)(o),"cluster",!1),(0,xe.Z)((0,jt.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,xe.Z)((0,jt.Z)(o),"invalidExtent",!1),(0,xe.Z)((0,jt.Z)(o),"dataArrayChanged",!1),(0,xe.Z)((0,jt.Z)(o),"cfg",{}),o.originData=i,o.initCfg(r),o.init(),o}return(0,At.Z)(t,[{key:"getClusters",value:function(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}},{key:"getClustersLeaves",value:function(r){return this.clusterIndex.getLeaves(r,Infinity)}},{key:"updateClusterData",value:function(r){var o=this,u=this.clusterOptions,p=u.method,v=p===void 0?"sum":p,g=u.field,E=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,E.forEach(function(A){A.id||(A.properties.point_count=1)}),(g||(0,he.isFunction)(v))&&(E=E.map(function(A){var P=A.id;if(P){var F=o.clusterIndex.getLeaves(P,Infinity),N=F.map(function(ie){return ie.properties}),V;if((0,he.isString)(v)&&g){var Y=Vn(N,g);V=In[v](Y)}(0,he.isFunction)(v)&&(V=v(N)),A.properties.stat=V}else A.properties.point_count=1;return A})),this.data=pe("geojson")({type:"FeatureCollection",features:E}),this.executeTrans()}},{key:"getFeatureById",value:function(r){var o=this.parser.type,u=o===void 0?"geojson":o;if(u==="geojson"&&!this.cluster){var p=r<this.originData.features.length?this.originData.features[r]:"null",v=(0,he.cloneDeep)(p);if(v!=null&&v.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var g=this.data.dataArray.find(function(E){return E._id===r});v.properties=g}return v}else return r<this.data.dataArray.length?this.data.dataArray[r]:"null"}},{key:"updateFeaturePropertiesById",value:function(r,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===r?(0,Z.Z)((0,Z.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(r,o){var u=this.data.dataArray.find(function(p){return p[r]===o});return u==null?void 0:u._id}},{key:"setData",value:function(r,o){this.originData=r,this.dataArrayChanged=!1,this.initCfg(o),this.init()}},{key:"destroy",value:function(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)===null||r===void 0||r.destroy()}},{key:"handleData",value:function(){var r=this;return new Promise(function(o,u){try{r.excuteParser(),r.initCluster(),r.executeTrans(),o({})}catch(p){u(p)}})}},{key:"initCfg",value:function(r){this.cfg=(0,he.mergeWith)(this.cfg,r,jn);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,Z.Z)((0,Z.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var r=this;this.inited=!1,this.handleData().then(function(){r.inited=!0,r.emit("sourceUpdate")})}},{key:"excuteParser",value:function(){var r=this.parser,o=r.type||"geojson",u=pe(o);this.data=u(this.originData,r),this.extent=yo(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var r=this.data.tilesetOptions;if(!!r){if(this.tileset)return this.tileset.updateOptions(r),this.tileset;var o=new e0((0,Z.Z)({},r));return o}}},{key:"executeTrans",value:function(){var r=this,o=this.transforms;o.forEach(function(u){var p=u.type,v=we(p)(r.data,u);Object.assign(r.data,v)})}},{key:"initCluster",value:function(){if(!!this.cluster){var r=this.clusterOptions||{};this.clusterIndex=ct(this.data,r)}}},{key:"caculClusterExtent",value:function(r){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=dl(Qc(this.extent),r)),o[0].concat(o[1])}}]),t}(Hs.EventEmitter);function ii(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function Kn(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Vi(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function Vi(e,a){if(!!e){if(typeof e=="string")return Ya(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ya(e,a)}}function Ya(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Ls=6378e3;function Lo(e,a){var t=e.dataArray,i=a.size,r=i===void 0?10:i,o=r/(2*Math.PI*Ls)*(256<<20)/2,u=to(t,r),p=u.gridHash,v=u.gridOffset,g=Hl(p,v,a);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:g}}function to(e,a){var t=Infinity,i=-Infinity,r,o=Kn(e),u;try{for(o.s();!(u=o.n()).done;){var p=u.value;r=p.coordinates[1],Number.isFinite(r)&&(t=r<t?r:t,i=r>i?r:i)}}catch(Pe){o.e(Pe)}finally{o.f()}var v=(t+i)/2,g=ff(a,v);if(g.xOffset<=0||g.yOffset<=0)return{gridHash:{},gridOffset:g};var E={},A=Kn(e),P;try{for(A.s();!(P=A.n()).done;){var F=P.value,N=F.coordinates[1],V=F.coordinates[0];if(Number.isFinite(N)&&Number.isFinite(V)){var Y=Math.floor((N+90)/g.yOffset),ie=Math.floor((V+180)/g.xOffset),ye="".concat(Y,"-").concat(ie);E[ye]=E[ye]||{count:0,points:[]},E[ye].count+=1,E[ye].points.push(F)}}}catch(Pe){A.e(Pe)}finally{A.f()}return{gridHash:E,gridOffset:g}}function ff(e,a){var t=Vu(e),i=sc(a,e);return{yOffset:t,xOffset:i}}function Vu(e){return e/Ls*(180/Math.PI)}function sc(e,a){return a/Ls*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Hl(e,a,t){return Object.keys(e).reduce(function(i,r,o){var u=r.split("-"),p=parseInt(u[0],10),v=parseInt(u[1],10),g={};if(t.field&&t.method){var E=ho(e[r].points,t.field);g[t.method]=bl[t.method](E)}return Object.assign(g,{_id:o,coordinates:Yo([-180+a.xOffset*(v+.5),-90+a.yOffset*(p+.5)]),rawData:e[r].points,count:e[r].count}),i.push(g),i},[])}var Dc=Math.PI/3,Wl=[0,Dc,2*Dc,3*Dc,4*Dc,5*Dc];function ah(e){return e[0]}function rp(e){return e[1]}function n0(){var e=0,a=0,t=1,i=1,r=ah,o=rp,u,p,v;function g(A){var P={},F=[],N,V=A.length;for(N=0;N<V;++N)if(!(isNaN(ie=+r.call(null,Y=A[N],N,A))||isNaN(ye=+o.call(null,Y,N,A)))){var Y,ie,ye,Pe=Math.round(ye=ye/v),tt=Math.round(ie=ie/p-(Pe&1)/2),pt=ye-Pe;if(Math.abs(pt)*3>1){var vt=ie-tt,Xt=tt+(ie<tt?-1:1)/2,er=Pe+(ye<Pe?-1:1),wr=ie-Xt,kr=ye-er;vt*vt+pt*pt>wr*wr+kr*kr&&(tt=Xt+(Pe&1?1:-1)/2,Pe=er)}var Sr=tt+"-"+Pe,un=P[Sr];un?un.push(Y):(F.push(un=P[Sr]=[Y]),un.x=(tt+(Pe&1)/2)*p,un.y=Pe*v)}return F}function E(A){var P=0,F=0;return Wl.map(function(N){var V=Math.sin(N)*A,Y=-Math.cos(N)*A,ie=V-P,ye=Y-F;return P=V,F=Y,[ie,ye]})}return g.hexagon=function(A){return"m"+E(A==null?u:+A).join("l")+"z"},g.centers=function(){for(var A=[],P=Math.round(a/v),F=Math.round(e/p),N=P*v;N<i+u;N+=v,++P)for(var V=F*p+(P&1)*p/2;V<t+p/2;V+=p)A.push([V,N]);return A},g.mesh=function(){var A=E(u).slice(0,4).join("l");return g.centers().map(function(P){return"M"+P+"m"+A}).join("")},g.x=function(A){return arguments.length?(r=A,g):r},g.y=function(A){return arguments.length?(o=A,g):o},g.radius=function(A){return arguments.length?(u=+A,p=u*2*Math.sin(Dc),v=u*1.5,g):u},g.size=function(A){return arguments.length?(e=a=0,t=+A[0],i=+A[1],g):[t-e,i-a]},g.extent=function(A){return arguments.length?(e=+A[0][0],a=+A[0][1],t=+A[1][0],i=+A[1][1],g):[[e,a],[t,i]]},g.radius(1)}var ru=6378e3;function lu(e,a){var t=e.dataArray,i=a.size,r=i===void 0?10:i,o=a.method,u=o===void 0?"sum":o,p=r/(2*Math.PI*ru)*(256<<20)/2,v=t.map(function(P){var F=Yo(P.coordinates),N=(0,Ir.Z)(F,2),V=N[0],Y=N[1];return(0,Z.Z)((0,Z.Z)({},P),{},{coordinates:[V,Y]})}),g=n0().radius(p).x(function(P){return P.coordinates[0]}).y(function(P){return P.coordinates[1]}),E=g(v),A={dataArray:E.map(function(P,F){var N;if(a.field&&u){var V=ho(P,a.field);P[u]=bl[u](V)}return N={},(0,xe.Z)(N,a.method,P[u]),(0,xe.Z)(N,"count",P.length),(0,xe.Z)(N,"rawData",P),(0,xe.Z)(N,"coordinates",[P.x,P.y]),(0,xe.Z)(N,"_id",F),N}),radius:p,xOffset:p,yOffset:p,type:"hexagon"};return A}function oh(e,a){var t=a.sourceField,i=a.targetField,r=a.data,o={};return r.forEach(function(u){o[u[t]]=u}),e.dataArray=e.dataArray.map(function(u){var p=u[i];return(0,Z.Z)((0,Z.Z)({},u),o[p])}),e}function rd(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}lt("rasterTile",Ln),lt("mvt",zr),lt("geojson",wn),lt("image",Tr),lt("csv",Xn),lt("json",Ut),lt("raster",_n),Xe("cluster",ct),Xe("filter",ii),Xe("join",oh),Xe("map",rd),Xe("grid",Lo),Xe("hexagon",lu);var nd=cr,T0=wt,id=Or,Bc=$n,Hv=fe(28660),Nn=fe(86700),Wv=fe(84879),nr={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},np=fe(31745),Od=fe.n(np);function n(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=s(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function s(e,a){if(!!e){if(typeof e=="string")return l(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return l(e,a)}}function l(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var d=30;function x(e){var a=e.characterSet,t=e.getFontWidth,i=e.fontHeight,r=e.buffer,o=e.maxCanvasWidth,u=e.mapping,p=u===void 0?{}:u,v=e.xOffset,g=v===void 0?0:v,E=e.yOffset,A=E===void 0?0:E,P=0,F=g;Array.from(a).forEach(function(V,Y){if(!p[V]){var ie=t(V,Y);F+d>o&&(F=0,P++),p[V]={x:F,y:A+P*d,width:d,height:d,advance:ie},F+=d}});var N=i+r*2;return{mapping:p,xOffset:F,yOffset:A+P*N,canvasHeight:L(A+(P+1)*N)}}function C(e,a,t){var i=0,r=0,o=0,u=[],p={},v=n(e),g;try{for(v.s();!(g=v.n()).done;){var E=g.value;if(!p[E.id]){var A=E.size;i+A+a>t&&(T(p,u,r),i=0,r=o+r+a,o=0,u=[]),u.push({icon:E,xOffset:i}),i=i+A+a,o=Math.max(o,A)}}}catch(F){v.e(F)}finally{v.f()}u.length>0&&T(p,u,r);var P=L(o+r+a);return{mapping:p,canvasHeight:P}}function T(e,a,t){var i=n(a),r;try{for(i.s();!(r=i.n()).done;){var o=r.value,u=o.icon,p=o.xOffset;e[u.id]=(0,Z.Z)((0,Z.Z)({},u),{},{x:p,y:t,image:u.image,width:u.width,height:u.height})}}catch(v){i.e(v)}finally{i.f()}}function L(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var U,X;function $(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ee(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function ee(e,a){if(!!e){if(typeof e=="string")return le(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return le(e,a)}}function le(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Ee=Ai(),$e="sans-serif",et="normal",mt=24,ut=3,Ot=.25,$t=8,dr=1024,gr=1,Dr=1,hn=3,zn=null;function Ai(){for(var e=[],a=32;a<128;a++)e.push(String.fromCharCode(a));return e}function Qn(e,a,t,i){e.font="".concat(i," ").concat(t,"px ").concat(a),e.fillStyle="black",e.textBaseline="middle"}function Mi(e,a){for(var t=0;t<e.length;t++)a.data[4*t+3]=e[t]}var Jn=(U=(0,Nn.b2)(),U(X=function(){function e(){(0,Lt.Z)(this,e),(0,xe.Z)(this,"iconFontGlyphs",{}),(0,xe.Z)(this,"cache",new m(hn))}return(0,At.Z)(e,[{key:"scale",get:function(){return Dr}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:$e,fontWeight:et,characterSet:Ee,fontSize:mt,buffer:ut,sdf:!0,cutoff:Ot,radius:$t,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var i=this;t.forEach(function(r){i.iconFontGlyphs[r.name]=r.unicode})}},{key:"addIconFont",value:function(t,i){this.iconFontMap.set(t,i)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,Z.Z)((0,Z.Z)({},this.fontOptions),t),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),r=this.cache.get(this.key);if(!(r&&i.length===0)){var o=this.generateFontAtlas(this.key,i,r);this.fontAtlas=o,this.cache.set(this.key,o)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,i,r){var o=this.fontOptions,u=o.fontFamily,p=o.fontWeight,v=o.fontSize,g=o.buffer,E=o.sdf,A=o.radius,P=o.cutoff,F=o.iconfont,N=r&&r.data;N||(N=ka.document.createElement("canvas"),N.width=dr);var V=N.getContext("2d");Qn(V,u,v,p);var Y=x((0,Z.Z)({getFontWidth:function(Fs){return V.measureText(Fs).width},fontHeight:v*Dr,buffer:g,characterSet:i,maxCanvasWidth:dr},r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset})),ie=Y.mapping,ye=Y.canvasHeight,Pe=Y.xOffset,tt=Y.yOffset,pt=V.getImageData(0,0,N.width,N.height);if(N.height=ye,V.putImageData(pt,0,0),Qn(V,u,v,p),E){var vt=new(Od())(v,g,A,P,u,p),Xt=V.getImageData(0,0,vt.size,vt.size),er=$(i),wr;try{for(er.s();!(wr=er.n()).done;){var kr=wr.value;if(F){var Sr=String.fromCharCode(parseInt(kr.replace("&#x","").replace(";",""),16)),un=vt.draw(Sr);Mi(un,Xt)}else Mi(vt.draw(kr),Xt);V.putImageData(Xt,ie[kr].x,ie[kr].y)}}catch($a){er.e($a)}finally{er.f()}}else{var Dn=$(i),li;try{for(Dn.s();!(li=Dn.n()).done;){var Da=li.value;V.fillText(Da,ie[Da].x,ie[Da].y+v*gr)}}catch($a){Dn.e($a)}finally{Dn.f()}}return{xOffset:Pe,yOffset:tt,mapping:ie,data:N,width:N.width,height:N.height}}},{key:"getKey",value:function(){return"key";var t,i,r,o,u,p,v,g}},{key:"getNewChars",value:function(t,i){var r=this.cache.get(t);if(!r)return i;var o=[],u=r.mapping,p=new Set(Object.keys(u)),v=new Set(i);return v.forEach(function(g){p.has(g)||o.push(g)}),o}}]),e}())||X),va,Wi;function di(e){var a=Ra();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Ra(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fa=3,za=1024,Si=64,ao=(va=(0,Nn.b2)(),va(Wi=function(e){(0,sn.Z)(t,e);var a=di(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"canvasHeight",128),(0,xe.Z)((0,jt.Z)(i),"loadingImageCount",0),i}return(0,At.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ka.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(r,o){var u=this,p=new Image;if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:Si}),this.updateIconMap(),this.loadImage(o).then(function(v){p=v;var g=u.iconData.find(function(E){return E.id===r});g&&(g.image=p,g.width=p.width,g.height=p.height),u.update()})}},{key:"addImageMini",value:function(r,o,u){var p=this,v=u.getSceneConfig().canvas,g=v.createImage();if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:Si}),this.updateIconMap(),this.loadImageMini(o,v).then(function(E){g=E;var A=p.iconData.find(function(P){return P.id===r});A&&(A.image=g,A.width=g.width,A.height=g.height),p.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(r){return this.iconMap.hasOwnProperty(r)}},{key:"removeImage",value:function(r){this.hasImage(r)&&(this.iconData=this.iconData.filter(function(o){return o.id!==r}),delete this.iconMap[r],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(r){return new Promise(function(o,u){if(r instanceof HTMLImageElement){o(r);return}var p=new Image;p.crossOrigin="anonymous",p.onload=function(){o(p)},p.onerror=function(){u(new Error("Could not load image at "+r))},p.src=r instanceof File?URL.createObjectURL(r):r})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var r=this;this.canvas.width=za,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=r.iconMap[o],p=u.x,v=u.y,g=u.image,E=u.width,A=E===void 0?64:E,P=u.height,F=P===void 0?64:P,N=Math.max(A,F),V=N/Si,Y=F/V,ie=A/V;g&&r.ctx.drawImage(g,p+(Si-ie)/2,v+(Si-Y)/2,ie,Y)})}},{key:"updateIconMap",value:function(){var r=C(this.iconData,fa,za),o=r.mapping,u=r.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(r,o){return new Promise(function(u,p){var v=o.createImage();v.crossOrigin="anonymous",v.onload=function(){u(v)},v.onerror=function(){p(new Error("Could not load image at "+r))},v.src=r})}}]),t}(Hs.EventEmitter))||Wi),ra=fe(49685);function ko(){var e=new ra.WT(16);return ra.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function gs(e){var a=new ra.WT(16);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function jo(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function ys(e,a,t,i,r,o,u,p,v,g,E,A,P,F,N,V){var Y=new ra.WT(16);return Y[0]=e,Y[1]=a,Y[2]=t,Y[3]=i,Y[4]=r,Y[5]=o,Y[6]=u,Y[7]=p,Y[8]=v,Y[9]=g,Y[10]=E,Y[11]=A,Y[12]=P,Y[13]=F,Y[14]=N,Y[15]=V,Y}function cu(e,a,t,i,r,o,u,p,v,g,E,A,P,F,N,V,Y){return e[0]=a,e[1]=t,e[2]=i,e[3]=r,e[4]=o,e[5]=u,e[6]=p,e[7]=v,e[8]=g,e[9]=E,e[10]=A,e[11]=P,e[12]=F,e[13]=N,e[14]=V,e[15]=Y,e}function nu(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function il(e,a){if(e===a){var t=a[1],i=a[2],r=a[3],o=a[6],u=a[7],p=a[11];e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=t,e[6]=a[9],e[7]=a[13],e[8]=i,e[9]=o,e[11]=a[14],e[12]=r,e[13]=u,e[14]=p}else e[0]=a[0],e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=a[1],e[5]=a[5],e[6]=a[9],e[7]=a[13],e[8]=a[2],e[9]=a[6],e[10]=a[10],e[11]=a[14],e[12]=a[3],e[13]=a[7],e[14]=a[11],e[15]=a[15];return e}function ts(e,a){var t=a[0],i=a[1],r=a[2],o=a[3],u=a[4],p=a[5],v=a[6],g=a[7],E=a[8],A=a[9],P=a[10],F=a[11],N=a[12],V=a[13],Y=a[14],ie=a[15],ye=t*p-i*u,Pe=t*v-r*u,tt=t*g-o*u,pt=i*v-r*p,vt=i*g-o*p,Xt=r*g-o*v,er=E*V-A*N,wr=E*Y-P*N,kr=E*ie-F*N,Sr=A*Y-P*V,un=A*ie-F*V,Dn=P*ie-F*Y,li=ye*Dn-Pe*un+tt*Sr+pt*kr-vt*wr+Xt*er;return li?(li=1/li,e[0]=(p*Dn-v*un+g*Sr)*li,e[1]=(r*un-i*Dn-o*Sr)*li,e[2]=(V*Xt-Y*vt+ie*pt)*li,e[3]=(P*vt-A*Xt-F*pt)*li,e[4]=(v*kr-u*Dn-g*wr)*li,e[5]=(t*Dn-r*kr+o*wr)*li,e[6]=(Y*tt-N*Xt-ie*Pe)*li,e[7]=(E*Xt-P*tt+F*Pe)*li,e[8]=(u*un-p*kr+g*er)*li,e[9]=(i*kr-t*un-o*er)*li,e[10]=(N*vt-V*tt+ie*ye)*li,e[11]=(A*tt-E*vt-F*ye)*li,e[12]=(p*wr-u*Sr-v*er)*li,e[13]=(t*Sr-i*wr+r*er)*li,e[14]=(V*Pe-N*pt-Y*ye)*li,e[15]=(E*pt-A*Pe+P*ye)*li,e):null}function ju(e,a){var t=a[0],i=a[1],r=a[2],o=a[3],u=a[4],p=a[5],v=a[6],g=a[7],E=a[8],A=a[9],P=a[10],F=a[11],N=a[12],V=a[13],Y=a[14],ie=a[15];return e[0]=p*(P*ie-F*Y)-A*(v*ie-g*Y)+V*(v*F-g*P),e[1]=-(i*(P*ie-F*Y)-A*(r*ie-o*Y)+V*(r*F-o*P)),e[2]=i*(v*ie-g*Y)-p*(r*ie-o*Y)+V*(r*g-o*v),e[3]=-(i*(v*F-g*P)-p*(r*F-o*P)+A*(r*g-o*v)),e[4]=-(u*(P*ie-F*Y)-E*(v*ie-g*Y)+N*(v*F-g*P)),e[5]=t*(P*ie-F*Y)-E*(r*ie-o*Y)+N*(r*F-o*P),e[6]=-(t*(v*ie-g*Y)-u*(r*ie-o*Y)+N*(r*g-o*v)),e[7]=t*(v*F-g*P)-u*(r*F-o*P)+E*(r*g-o*v),e[8]=u*(A*ie-F*V)-E*(p*ie-g*V)+N*(p*F-g*A),e[9]=-(t*(A*ie-F*V)-E*(i*ie-o*V)+N*(i*F-o*A)),e[10]=t*(p*ie-g*V)-u*(i*ie-o*V)+N*(i*g-o*p),e[11]=-(t*(p*F-g*A)-u*(i*F-o*A)+E*(i*g-o*p)),e[12]=-(u*(A*Y-P*V)-E*(p*Y-v*V)+N*(p*P-v*A)),e[13]=t*(A*Y-P*V)-E*(i*Y-r*V)+N*(i*P-r*A),e[14]=-(t*(p*Y-v*V)-u*(i*Y-r*V)+N*(i*v-r*p)),e[15]=t*(p*P-v*A)-u*(i*P-r*A)+E*(i*v-r*p),e}function Os(e){var a=e[0],t=e[1],i=e[2],r=e[3],o=e[4],u=e[5],p=e[6],v=e[7],g=e[8],E=e[9],A=e[10],P=e[11],F=e[12],N=e[13],V=e[14],Y=e[15],ie=a*u-t*o,ye=a*p-i*o,Pe=a*v-r*o,tt=t*p-i*u,pt=t*v-r*u,vt=i*v-r*p,Xt=g*N-E*F,er=g*V-A*F,wr=g*Y-P*F,kr=E*V-A*N,Sr=E*Y-P*N,un=A*Y-P*V;return ie*un-ye*Sr+Pe*kr+tt*wr-pt*er+vt*Xt}function Go(e,a,t){var i=a[0],r=a[1],o=a[2],u=a[3],p=a[4],v=a[5],g=a[6],E=a[7],A=a[8],P=a[9],F=a[10],N=a[11],V=a[12],Y=a[13],ie=a[14],ye=a[15],Pe=t[0],tt=t[1],pt=t[2],vt=t[3];return e[0]=Pe*i+tt*p+pt*A+vt*V,e[1]=Pe*r+tt*v+pt*P+vt*Y,e[2]=Pe*o+tt*g+pt*F+vt*ie,e[3]=Pe*u+tt*E+pt*N+vt*ye,Pe=t[4],tt=t[5],pt=t[6],vt=t[7],e[4]=Pe*i+tt*p+pt*A+vt*V,e[5]=Pe*r+tt*v+pt*P+vt*Y,e[6]=Pe*o+tt*g+pt*F+vt*ie,e[7]=Pe*u+tt*E+pt*N+vt*ye,Pe=t[8],tt=t[9],pt=t[10],vt=t[11],e[8]=Pe*i+tt*p+pt*A+vt*V,e[9]=Pe*r+tt*v+pt*P+vt*Y,e[10]=Pe*o+tt*g+pt*F+vt*ie,e[11]=Pe*u+tt*E+pt*N+vt*ye,Pe=t[12],tt=t[13],pt=t[14],vt=t[15],e[12]=Pe*i+tt*p+pt*A+vt*V,e[13]=Pe*r+tt*v+pt*P+vt*Y,e[14]=Pe*o+tt*g+pt*F+vt*ie,e[15]=Pe*u+tt*E+pt*N+vt*ye,e}function Sa(e,a,t){var i=t[0],r=t[1],o=t[2],u,p,v,g,E,A,P,F,N,V,Y,ie;return a===e?(e[12]=a[0]*i+a[4]*r+a[8]*o+a[12],e[13]=a[1]*i+a[5]*r+a[9]*o+a[13],e[14]=a[2]*i+a[6]*r+a[10]*o+a[14],e[15]=a[3]*i+a[7]*r+a[11]*o+a[15]):(u=a[0],p=a[1],v=a[2],g=a[3],E=a[4],A=a[5],P=a[6],F=a[7],N=a[8],V=a[9],Y=a[10],ie=a[11],e[0]=u,e[1]=p,e[2]=v,e[3]=g,e[4]=E,e[5]=A,e[6]=P,e[7]=F,e[8]=N,e[9]=V,e[10]=Y,e[11]=ie,e[12]=u*i+E*r+N*o+a[12],e[13]=p*i+A*r+V*o+a[13],e[14]=v*i+P*r+Y*o+a[14],e[15]=g*i+F*r+ie*o+a[15]),e}function so(e,a,t){var i=t[0],r=t[1],o=t[2];return e[0]=a[0]*i,e[1]=a[1]*i,e[2]=a[2]*i,e[3]=a[3]*i,e[4]=a[4]*r,e[5]=a[5]*r,e[6]=a[6]*r,e[7]=a[7]*r,e[8]=a[8]*o,e[9]=a[9]*o,e[10]=a[10]*o,e[11]=a[11]*o,e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function bo(e,a,t,i){var r=i[0],o=i[1],u=i[2],p=Math.hypot(r,o,u),v,g,E,A,P,F,N,V,Y,ie,ye,Pe,tt,pt,vt,Xt,er,wr,kr,Sr,un,Dn,li,Da;return p<ra.Ib?null:(p=1/p,r*=p,o*=p,u*=p,v=Math.sin(t),g=Math.cos(t),E=1-g,A=a[0],P=a[1],F=a[2],N=a[3],V=a[4],Y=a[5],ie=a[6],ye=a[7],Pe=a[8],tt=a[9],pt=a[10],vt=a[11],Xt=r*r*E+g,er=o*r*E+u*v,wr=u*r*E-o*v,kr=r*o*E-u*v,Sr=o*o*E+g,un=u*o*E+r*v,Dn=r*u*E+o*v,li=o*u*E-r*v,Da=u*u*E+g,e[0]=A*Xt+V*er+Pe*wr,e[1]=P*Xt+Y*er+tt*wr,e[2]=F*Xt+ie*er+pt*wr,e[3]=N*Xt+ye*er+vt*wr,e[4]=A*kr+V*Sr+Pe*un,e[5]=P*kr+Y*Sr+tt*un,e[6]=F*kr+ie*Sr+pt*un,e[7]=N*kr+ye*Sr+vt*un,e[8]=A*Dn+V*li+Pe*Da,e[9]=P*Dn+Y*li+tt*Da,e[10]=F*Dn+ie*li+pt*Da,e[11]=N*Dn+ye*li+vt*Da,a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e)}function Ua(e,a,t){var i=Math.sin(t),r=Math.cos(t),o=a[4],u=a[5],p=a[6],v=a[7],g=a[8],E=a[9],A=a[10],P=a[11];return a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[4]=o*r+g*i,e[5]=u*r+E*i,e[6]=p*r+A*i,e[7]=v*r+P*i,e[8]=g*r-o*i,e[9]=E*r-u*i,e[10]=A*r-p*i,e[11]=P*r-v*i,e}function Gu(e,a,t){var i=Math.sin(t),r=Math.cos(t),o=a[0],u=a[1],p=a[2],v=a[3],g=a[8],E=a[9],A=a[10],P=a[11];return a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*r-g*i,e[1]=u*r-E*i,e[2]=p*r-A*i,e[3]=v*r-P*i,e[8]=o*i+g*r,e[9]=u*i+E*r,e[10]=p*i+A*r,e[11]=v*i+P*r,e}function fu(e,a,t){var i=Math.sin(t),r=Math.cos(t),o=a[0],u=a[1],p=a[2],v=a[3],g=a[4],E=a[5],A=a[6],P=a[7];return a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*r+g*i,e[1]=u*r+E*i,e[2]=p*r+A*i,e[3]=v*r+P*i,e[4]=g*r-o*i,e[5]=E*r-u*i,e[6]=A*r-p*i,e[7]=P*r-v*i,e}function Do(e,a){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=1,e}function Xs(e,a){return e[0]=a[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lu(e,a,t){var i=t[0],r=t[1],o=t[2],u=Math.hypot(i,r,o),p,v,g;return u<ra.Ib?null:(u=1/u,i*=u,r*=u,o*=u,p=Math.sin(a),v=Math.cos(a),g=1-v,e[0]=i*i*g+v,e[1]=r*i*g+o*p,e[2]=o*i*g-r*p,e[3]=0,e[4]=i*r*g-o*p,e[5]=r*r*g+v,e[6]=o*r*g+i*p,e[7]=0,e[8]=i*o*g+r*p,e[9]=r*o*g-i*p,e[10]=o*o*g+v,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Xa(e,a){var t=Math.sin(a),i=Math.cos(a);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wl(e,a){var t=Math.sin(a),i=Math.cos(a);return e[0]=i,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function uc(e,a){var t=Math.sin(a),i=Math.cos(a);return e[0]=i,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function al(e,a,t){var i=a[0],r=a[1],o=a[2],u=a[3],p=i+i,v=r+r,g=o+o,E=i*p,A=i*v,P=i*g,F=r*v,N=r*g,V=o*g,Y=u*p,ie=u*v,ye=u*g;return e[0]=1-(F+V),e[1]=A+ye,e[2]=P-ie,e[3]=0,e[4]=A-ye,e[5]=1-(E+V),e[6]=N+Y,e[7]=0,e[8]=P+ie,e[9]=N-Y,e[10]=1-(E+F),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ss(e,a){var t=new ra.WT(3),i=-a[0],r=-a[1],o=-a[2],u=a[3],p=a[4],v=a[5],g=a[6],E=a[7],A=i*i+r*r+o*o+u*u;return A>0?(t[0]=(p*u+E*i+v*o-g*r)*2/A,t[1]=(v*u+E*r+g*i-p*o)*2/A,t[2]=(g*u+E*o+p*r-v*i)*2/A):(t[0]=(p*u+E*i+v*o-g*r)*2,t[1]=(v*u+E*r+g*i-p*o)*2,t[2]=(g*u+E*o+p*r-v*i)*2),al(e,a,t),e}function Nc(e,a){return e[0]=a[12],e[1]=a[13],e[2]=a[14],e}function zc(e,a){var t=a[0],i=a[1],r=a[2],o=a[4],u=a[5],p=a[6],v=a[8],g=a[9],E=a[10];return e[0]=Math.hypot(t,i,r),e[1]=Math.hypot(o,u,p),e[2]=Math.hypot(v,g,E),e}function ad(e,a){var t=new ra.WT(3);zc(t,a);var i=1/t[0],r=1/t[1],o=1/t[2],u=a[0]*i,p=a[1]*r,v=a[2]*o,g=a[4]*i,E=a[5]*r,A=a[6]*o,P=a[8]*i,F=a[9]*r,N=a[10]*o,V=u+E+N,Y=0;return V>0?(Y=Math.sqrt(V+1)*2,e[3]=.25*Y,e[0]=(A-F)/Y,e[1]=(P-v)/Y,e[2]=(p-g)/Y):u>E&&u>N?(Y=Math.sqrt(1+u-E-N)*2,e[3]=(A-F)/Y,e[0]=.25*Y,e[1]=(p+g)/Y,e[2]=(P+v)/Y):E>N?(Y=Math.sqrt(1+E-u-N)*2,e[3]=(P-v)/Y,e[0]=(p+g)/Y,e[1]=.25*Y,e[2]=(A+F)/Y):(Y=Math.sqrt(1+N-u-E)*2,e[3]=(p-g)/Y,e[0]=(P+v)/Y,e[1]=(A+F)/Y,e[2]=.25*Y),e}function Cp(e,a,t,i){var r=a[0],o=a[1],u=a[2],p=a[3],v=r+r,g=o+o,E=u+u,A=r*v,P=r*g,F=r*E,N=o*g,V=o*E,Y=u*E,ie=p*v,ye=p*g,Pe=p*E,tt=i[0],pt=i[1],vt=i[2];return e[0]=(1-(N+Y))*tt,e[1]=(P+Pe)*tt,e[2]=(F-ye)*tt,e[3]=0,e[4]=(P-Pe)*pt,e[5]=(1-(A+Y))*pt,e[6]=(V+ie)*pt,e[7]=0,e[8]=(F+ye)*vt,e[9]=(V-ie)*vt,e[10]=(1-(A+N))*vt,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function od(e,a,t,i,r){var o=a[0],u=a[1],p=a[2],v=a[3],g=o+o,E=u+u,A=p+p,P=o*g,F=o*E,N=o*A,V=u*E,Y=u*A,ie=p*A,ye=v*g,Pe=v*E,tt=v*A,pt=i[0],vt=i[1],Xt=i[2],er=r[0],wr=r[1],kr=r[2],Sr=(1-(V+ie))*pt,un=(F+tt)*pt,Dn=(N-Pe)*pt,li=(F-tt)*vt,Da=(1-(P+ie))*vt,$a=(Y+ye)*vt,Fs=(N+Pe)*Xt,Fu=(Y-ye)*Xt,xu=(1-(P+V))*Xt;return e[0]=Sr,e[1]=un,e[2]=Dn,e[3]=0,e[4]=li,e[5]=Da,e[6]=$a,e[7]=0,e[8]=Fs,e[9]=Fu,e[10]=xu,e[11]=0,e[12]=t[0]+er-(Sr*er+li*wr+Fs*kr),e[13]=t[1]+wr-(un*er+Da*wr+Fu*kr),e[14]=t[2]+kr-(Dn*er+$a*wr+xu*kr),e[15]=1,e}function Th(e,a){var t=a[0],i=a[1],r=a[2],o=a[3],u=t+t,p=i+i,v=r+r,g=t*u,E=i*u,A=i*p,P=r*u,F=r*p,N=r*v,V=o*u,Y=o*p,ie=o*v;return e[0]=1-A-N,e[1]=E+ie,e[2]=P-Y,e[3]=0,e[4]=E-ie,e[5]=1-g-N,e[6]=F+V,e[7]=0,e[8]=P+Y,e[9]=F-V,e[10]=1-g-A,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sd(e,a,t,i,r,o,u){var p=1/(t-a),v=1/(r-i),g=1/(o-u);return e[0]=o*2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*v,e[6]=0,e[7]=0,e[8]=(t+a)*p,e[9]=(r+i)*v,e[10]=(u+o)*g,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*g,e[15]=0,e}function ip(e,a,t,i,r){var o=1/Math.tan(a/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(i-r),e[10]=(r+i)*u,e[14]=2*r*i*u):(e[10]=-1,e[14]=-2*i),e}var ap=ip;function Sp(e,a,t,i,r){var o=1/Math.tan(a/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(i-r),e[10]=r*u,e[14]=r*i*u):(e[10]=-1,e[14]=-i),e}function op(e,a,t,i){var r=Math.tan(a.upDegrees*Math.PI/180),o=Math.tan(a.downDegrees*Math.PI/180),u=Math.tan(a.leftDegrees*Math.PI/180),p=Math.tan(a.rightDegrees*Math.PI/180),v=2/(u+p),g=2/(r+o);return e[0]=v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=g,e[6]=0,e[7]=0,e[8]=-((u-p)*v*.5),e[9]=(r-o)*g*.5,e[10]=i/(t-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*t/(t-i),e[15]=0,e}function ud(e,a,t,i,r,o,u){var p=1/(a-t),v=1/(i-r),g=1/(o-u);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*v,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*g,e[11]=0,e[12]=(a+t)*p,e[13]=(r+i)*v,e[14]=(u+o)*g,e[15]=1,e}var hf=ud;function Fd(e,a,t,i,r,o,u){var p=1/(a-t),v=1/(i-r),g=1/(o-u);return e[0]=-2*p,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*v,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=g,e[11]=0,e[12]=(a+t)*p,e[13]=(r+i)*v,e[14]=o*g,e[15]=1,e}function Ap(e,a,t,i){var r,o,u,p,v,g,E,A,P,F,N=a[0],V=a[1],Y=a[2],ie=i[0],ye=i[1],Pe=i[2],tt=t[0],pt=t[1],vt=t[2];return Math.abs(N-tt)<ra.Ib&&Math.abs(V-pt)<ra.Ib&&Math.abs(Y-vt)<ra.Ib?nu(e):(E=N-tt,A=V-pt,P=Y-vt,F=1/Math.hypot(E,A,P),E*=F,A*=F,P*=F,r=ye*P-Pe*A,o=Pe*E-ie*P,u=ie*A-ye*E,F=Math.hypot(r,o,u),F?(F=1/F,r*=F,o*=F,u*=F):(r=0,o=0,u=0),p=A*u-P*o,v=P*r-E*u,g=E*o-A*r,F=Math.hypot(p,v,g),F?(F=1/F,p*=F,v*=F,g*=F):(p=0,v=0,g=0),e[0]=r,e[1]=p,e[2]=E,e[3]=0,e[4]=o,e[5]=v,e[6]=A,e[7]=0,e[8]=u,e[9]=g,e[10]=P,e[11]=0,e[12]=-(r*N+o*V+u*Y),e[13]=-(p*N+v*V+g*Y),e[14]=-(E*N+A*V+P*Y),e[15]=1,e)}function sp(e,a,t,i){var r=a[0],o=a[1],u=a[2],p=i[0],v=i[1],g=i[2],E=r-t[0],A=o-t[1],P=u-t[2],F=E*E+A*A+P*P;F>0&&(F=1/Math.sqrt(F),E*=F,A*=F,P*=F);var N=v*P-g*A,V=g*E-p*P,Y=p*A-v*E;return F=N*N+V*V+Y*Y,F>0&&(F=1/Math.sqrt(F),N*=F,V*=F,Y*=F),e[0]=N,e[1]=V,e[2]=Y,e[3]=0,e[4]=A*Y-P*V,e[5]=P*N-E*Y,e[6]=E*V-A*N,e[7]=0,e[8]=E,e[9]=A,e[10]=P,e[11]=0,e[12]=r,e[13]=o,e[14]=u,e[15]=1,e}function sh(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Dd(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function wp(e,a,t){return e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e[3]=a[3]+t[3],e[4]=a[4]+t[4],e[5]=a[5]+t[5],e[6]=a[6]+t[6],e[7]=a[7]+t[7],e[8]=a[8]+t[8],e[9]=a[9]+t[9],e[10]=a[10]+t[10],e[11]=a[11]+t[11],e[12]=a[12]+t[12],e[13]=a[13]+t[13],e[14]=a[14]+t[14],e[15]=a[15]+t[15],e}function Tp(e,a,t){return e[0]=a[0]-t[0],e[1]=a[1]-t[1],e[2]=a[2]-t[2],e[3]=a[3]-t[3],e[4]=a[4]-t[4],e[5]=a[5]-t[5],e[6]=a[6]-t[6],e[7]=a[7]-t[7],e[8]=a[8]-t[8],e[9]=a[9]-t[9],e[10]=a[10]-t[10],e[11]=a[11]-t[11],e[12]=a[12]-t[12],e[13]=a[13]-t[13],e[14]=a[14]-t[14],e[15]=a[15]-t[15],e}function ld(e,a,t){return e[0]=a[0]*t,e[1]=a[1]*t,e[2]=a[2]*t,e[3]=a[3]*t,e[4]=a[4]*t,e[5]=a[5]*t,e[6]=a[6]*t,e[7]=a[7]*t,e[8]=a[8]*t,e[9]=a[9]*t,e[10]=a[10]*t,e[11]=a[11]*t,e[12]=a[12]*t,e[13]=a[13]*t,e[14]=a[14]*t,e[15]=a[15]*t,e}function cd(e,a,t,i){return e[0]=a[0]+t[0]*i,e[1]=a[1]+t[1]*i,e[2]=a[2]+t[2]*i,e[3]=a[3]+t[3]*i,e[4]=a[4]+t[4]*i,e[5]=a[5]+t[5]*i,e[6]=a[6]+t[6]*i,e[7]=a[7]+t[7]*i,e[8]=a[8]+t[8]*i,e[9]=a[9]+t[9]*i,e[10]=a[10]+t[10]*i,e[11]=a[11]+t[11]*i,e[12]=a[12]+t[12]*i,e[13]=a[13]+t[13]*i,e[14]=a[14]+t[14]*i,e[15]=a[15]+t[15]*i,e}function fd(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]&&e[4]===a[4]&&e[5]===a[5]&&e[6]===a[6]&&e[7]===a[7]&&e[8]===a[8]&&e[9]===a[9]&&e[10]===a[10]&&e[11]===a[11]&&e[12]===a[12]&&e[13]===a[13]&&e[14]===a[14]&&e[15]===a[15]}function Mh(e,a){var t=e[0],i=e[1],r=e[2],o=e[3],u=e[4],p=e[5],v=e[6],g=e[7],E=e[8],A=e[9],P=e[10],F=e[11],N=e[12],V=e[13],Y=e[14],ie=e[15],ye=a[0],Pe=a[1],tt=a[2],pt=a[3],vt=a[4],Xt=a[5],er=a[6],wr=a[7],kr=a[8],Sr=a[9],un=a[10],Dn=a[11],li=a[12],Da=a[13],$a=a[14],Fs=a[15];return Math.abs(t-ye)<=ra.Ib*Math.max(1,Math.abs(t),Math.abs(ye))&&Math.abs(i-Pe)<=ra.Ib*Math.max(1,Math.abs(i),Math.abs(Pe))&&Math.abs(r-tt)<=ra.Ib*Math.max(1,Math.abs(r),Math.abs(tt))&&Math.abs(o-pt)<=ra.Ib*Math.max(1,Math.abs(o),Math.abs(pt))&&Math.abs(u-vt)<=ra.Ib*Math.max(1,Math.abs(u),Math.abs(vt))&&Math.abs(p-Xt)<=ra.Ib*Math.max(1,Math.abs(p),Math.abs(Xt))&&Math.abs(v-er)<=ra.Ib*Math.max(1,Math.abs(v),Math.abs(er))&&Math.abs(g-wr)<=ra.Ib*Math.max(1,Math.abs(g),Math.abs(wr))&&Math.abs(E-kr)<=ra.Ib*Math.max(1,Math.abs(E),Math.abs(kr))&&Math.abs(A-Sr)<=ra.Ib*Math.max(1,Math.abs(A),Math.abs(Sr))&&Math.abs(P-un)<=ra.Ib*Math.max(1,Math.abs(P),Math.abs(un))&&Math.abs(F-Dn)<=ra.Ib*Math.max(1,Math.abs(F),Math.abs(Dn))&&Math.abs(N-li)<=ra.Ib*Math.max(1,Math.abs(N),Math.abs(li))&&Math.abs(V-Da)<=ra.Ib*Math.max(1,Math.abs(V),Math.abs(Da))&&Math.abs(Y-$a)<=ra.Ib*Math.max(1,Math.abs(Y),Math.abs($a))&&Math.abs(ie-Fs)<=ra.Ib*Math.max(1,Math.abs(ie),Math.abs(Fs))}var hd=Go,pd=Tp,Ih,Mp,up=(Ih=(0,Nn.b2)(),Ih(Mp=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=ko(),ts(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),i=(0,Ir.Z)(t,2),r=i[0],o=i[1];return[r,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,i){return this.viewport.projectFlat(t,i)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,i){var r=Do(ko(),[t,i,0]);this.jitteredProjectionMatrix=Go(ko(),r,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Go(ko(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Mp),lp,pf;function dd(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=vd(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function vd(e,a){if(!!e){if(typeof e=="string")return Ip(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ip(e,a)}}function Ip(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var M0=(lp=(0,Nn.b2)(),lp(pf=function(){function e(){(0,Lt.Z)(this,e),(0,xe.Z)(this,"controls",[]),(0,xe.Z)(this,"unAddControls",[])}return(0,At.Z)(e,[{key:"init",value:function(t,i){this.container=t.container,this.scene=i,this.mapsService=i.get(nr.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,i){var r=i.get(nr.IMapService);r.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(i){return i.controlOption.name===t})}},{key:"removeControl",value:function(t){var i=this.controls.indexOf(t);return i>-1&&this.controls.splice(i,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(i){i.addTo(t.scene),t.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=dd(this.controls),i;try{for(t.s();!(i=t.n()).done;){var r=i.value;r.remove()}}catch(o){t.e(o)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},i="l7-",r=this.controlContainer=Qa("div",i+"control-container",this.container);function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],p=u.map(function(v){return i+v}).join(" ");t[u.join("")]=Qa("div",p,r)}o(["top","left"]),o(["top","right"]),o(["bottom","left"]),o(["bottom","right"]),o(["top","center"]),o(["right","center"]),o(["left","center"]),o(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Cf(this.controlCorners[t]);this.controlContainer&&Cf(this.controlContainer)}}]),e}())||pf),Bd,i0,md=(Bd=(0,Nn.b2)(),Bd(i0=function(){function e(){(0,Lt.Z)(this,e),(0,xe.Z)(this,"markers",[]),(0,xe.Z)(this,"markerLayers",[]),(0,xe.Z)(this,"unAddMarkers",[]),(0,xe.Z)(this,"unAddMarkerLayers",[])}return(0,At.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var i=this.markerLayers.indexOf(t);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(i){i.addTo(t.scene),t.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(i){t.markerLayers.push(i),i.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var i=this.markers.indexOf(t);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(nr.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||i0),Nd,kp,As=(Nd=(0,Nn.b2)(),Nd(kp=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(nr.IMapService)}}]),e}())||kp),Df={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Xv=Df,kh,a0,I0={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ph={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},lc=(kh=(0,Nn.b2)(),kh(a0=function(){function e(){(0,Lt.Z)(this,e),(0,xe.Z)(this,"sceneConfigCache",{}),(0,xe.Z)(this,"layerConfigCache",{})}return(0,At.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Xv[t]}},{key:"setSceneConfig",value:function(t,i){this.sceneConfigCache[t]=(0,Z.Z)((0,Z.Z)({},I0),i)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,i,r){this.layerConfigCache[i]=(0,Z.Z)({},(0,he.merge)({},this.sceneConfigCache[t],Ph,r))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||a0);function ya(e,a,t,i){!t||Object.defineProperty(e,a,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(i):void 0})}function ma(e,a,t,i,r){var o={};return Object.keys(i).forEach(function(u){o[u]=i[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(u,p){return p(e,a,u)||u},o),r&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,a,o),o=null),o}function zd(){var e=new ra.WT(4);return ra.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function k0(e){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a}function P0(e,a,t,i){var r=new ra.WT(4);return r[0]=e,r[1]=a,r[2]=t,r[3]=i,r}function Yv(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e}function o0(e,a,t,i,r){return e[0]=a,e[1]=t,e[2]=i,e[3]=r,e}function Ud(e,a,t){return e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e[3]=a[3]+t[3],e}function R0(e,a,t){return e[0]=a[0]-t[0],e[1]=a[1]-t[1],e[2]=a[2]-t[2],e[3]=a[3]-t[3],e}function L0(e,a,t){return e[0]=a[0]*t[0],e[1]=a[1]*t[1],e[2]=a[2]*t[2],e[3]=a[3]*t[3],e}function Xl(e,a,t){return e[0]=a[0]/t[0],e[1]=a[1]/t[1],e[2]=a[2]/t[2],e[3]=a[3]/t[3],e}function sv(e,a){return e[0]=Math.ceil(a[0]),e[1]=Math.ceil(a[1]),e[2]=Math.ceil(a[2]),e[3]=Math.ceil(a[3]),e}function Uc(e,a){return e[0]=Math.floor(a[0]),e[1]=Math.floor(a[1]),e[2]=Math.floor(a[2]),e[3]=Math.floor(a[3]),e}function O0(e,a,t){return e[0]=Math.min(a[0],t[0]),e[1]=Math.min(a[1],t[1]),e[2]=Math.min(a[2],t[2]),e[3]=Math.min(a[3],t[3]),e}function qv(e,a,t){return e[0]=Math.max(a[0],t[0]),e[1]=Math.max(a[1],t[1]),e[2]=Math.max(a[2],t[2]),e[3]=Math.max(a[3],t[3]),e}function Bf(e,a){return e[0]=Math.round(a[0]),e[1]=Math.round(a[1]),e[2]=Math.round(a[2]),e[3]=Math.round(a[3]),e}function Zc(e,a,t){return e[0]=a[0]*t,e[1]=a[1]*t,e[2]=a[2]*t,e[3]=a[3]*t,e}function $v(e,a,t,i){return e[0]=a[0]+t[0]*i,e[1]=a[1]+t[1]*i,e[2]=a[2]+t[2]*i,e[3]=a[3]+t[3]*i,e}function Pp(e,a){var t=a[0]-e[0],i=a[1]-e[1],r=a[2]-e[2],o=a[3]-e[3];return Math.hypot(t,i,r,o)}function gd(e,a){var t=a[0]-e[0],i=a[1]-e[1],r=a[2]-e[2],o=a[3]-e[3];return t*t+i*i+r*r+o*o}function Rp(e){var a=e[0],t=e[1],i=e[2],r=e[3];return Math.hypot(a,t,i,r)}function Zd(e){var a=e[0],t=e[1],i=e[2],r=e[3];return a*a+t*t+i*i+r*r}function Vd(e,a){return e[0]=-a[0],e[1]=-a[1],e[2]=-a[2],e[3]=-a[3],e}function Kv(e,a){return e[0]=1/a[0],e[1]=1/a[1],e[2]=1/a[2],e[3]=1/a[3],e}function Qv(e,a){var t=a[0],i=a[1],r=a[2],o=a[3],u=t*t+i*i+r*r+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=t*u,e[1]=i*u,e[2]=r*u,e[3]=o*u,e}function F0(e,a){return e[0]*a[0]+e[1]*a[1]+e[2]*a[2]+e[3]*a[3]}function uv(e,a,t,i){var r=t[0]*i[1]-t[1]*i[0],o=t[0]*i[2]-t[2]*i[0],u=t[0]*i[3]-t[3]*i[0],p=t[1]*i[2]-t[2]*i[1],v=t[1]*i[3]-t[3]*i[1],g=t[2]*i[3]-t[3]*i[2],E=a[0],A=a[1],P=a[2],F=a[3];return e[0]=A*g-P*v+F*p,e[1]=-(E*g)+P*u-F*o,e[2]=E*v-A*u+F*r,e[3]=-(E*p)+A*o-P*r,e}function lv(e,a,t,i){var r=a[0],o=a[1],u=a[2],p=a[3];return e[0]=r+i*(t[0]-r),e[1]=o+i*(t[1]-o),e[2]=u+i*(t[2]-u),e[3]=p+i*(t[3]-p),e}function Nf(e,a){a=a||1;var t,i,r,o,u,p;do t=glMatrix.RANDOM()*2-1,i=glMatrix.RANDOM()*2-1,u=t*t+i*i;while(u>=1);do r=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,p=r*r+o*o;while(p>=1);var v=Math.sqrt((1-u)/p);return e[0]=a*t,e[1]=a*i,e[2]=a*r*v,e[3]=a*o*v,e}function zf(e,a,t){var i=a[0],r=a[1],o=a[2],u=a[3];return e[0]=t[0]*i+t[4]*r+t[8]*o+t[12]*u,e[1]=t[1]*i+t[5]*r+t[9]*o+t[13]*u,e[2]=t[2]*i+t[6]*r+t[10]*o+t[14]*u,e[3]=t[3]*i+t[7]*r+t[11]*o+t[15]*u,e}function Jv(e,a,t){var i=a[0],r=a[1],o=a[2],u=t[0],p=t[1],v=t[2],g=t[3],E=g*i+p*o-v*r,A=g*r+v*i-u*o,P=g*o+u*r-p*i,F=-u*i-p*r-v*o;return e[0]=E*g+F*-u+A*-v-P*-p,e[1]=A*g+F*-p+P*-u-E*-v,e[2]=P*g+F*-v+E*-p-A*-u,e[3]=a[3],e}function D0(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function s0(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function em(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]}function cv(e,a){var t=e[0],i=e[1],r=e[2],o=e[3],u=a[0],p=a[1],v=a[2],g=a[3];return Math.abs(t-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(u))&&Math.abs(i-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(o-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(g))}var B0=null,N0=null,u0=null,z0=null,yd=null,tm=null,_d=null,rm=function(){var e=zd();return function(a,t,i,r,o,u){var p,v;for(t||(t=4),i||(i=0),r?v=Math.min(r*t+i,a.length):v=a.length,p=i;p<v;p+=t)e[0]=a[p],e[1]=a[p+1],e[2]=a[p+2],e[3]=a[p+3],o(e,e,u),a[p]=e[0],a[p+1]=e[1],a[p+2]=e[2],a[p+3]=e[3];return a}}(),uh=Math.PI/180,jd=512,fv=4003e4;function hv(e){var a=e.latitude,t=a===void 0?0:a,i=e.zoom,r=i===void 0?0:i,o=e.scale,u=e.highPrecision,p=u===void 0?!1:u,v=e.flipY,g=v===void 0?!1:v;o=o!==void 0?o:Math.pow(2,r);var E={},A=jd*o,P=Math.cos(t*uh),F=A/360,N=F/P,V=A/fv/P;if(E.pixelsPerMeter=[V,-V,V],E.metersPerPixel=[1/V,-1/V,1/V],E.pixelsPerDegree=[F,-N,V],E.degreesPerPixel=[1/F,-1/N,1/V],p){var Y=uh*Math.tan(t*uh)/P,ie=F*Y/2,ye=A/fv*Y,Pe=ye/N*V;E.pixelsPerDegree2=[0,-ie,ye],E.pixelsPerMeter2=[Pe,0,Pe],g&&(E.pixelsPerDegree2[1]=-E.pixelsPerDegree2[1],E.pixelsPerMeter2[1]=-E.pixelsPerMeter2[1])}return g&&(E.pixelsPerMeter[1]=-E.pixelsPerMeter[1],E.metersPerPixel[1]=-E.metersPerPixel[1],E.pixelsPerDegree[1]=-E.pixelsPerDegree[1],E.degreesPerPixel[1]=-E.degreesPerPixel[1]),E}var cp;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(cp||(cp={}));var Lp={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},pv,dv,vv,cc,Gd,Op=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Hd=(pv=(0,Nn.b2)(),dv=(0,Nn.f3)(nr.ICameraService),pv(vv=(cc=function(){function e(){(0,Lt.Z)(this,e),(0,xe.Z)(this,"needRefresh",!0),ya(this,"cameraService",Gd,this)}return(0,At.Z)(e,[{key:"refresh",value:function(t){var i=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),o=t||this.cameraService.getCenter(),u=hv({latitude:o[1],zoom:i}),p=u.pixelsPerMeter,v=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===cp.LNGLAT||this.coordinateSystem===cp.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===cp.LNGLAT_OFFSET?this.calculateLnglatOffset(o,i):this.coordinateSystem===cp.P20_OFFSET&&this.calculateLnglatOffset(o,i,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,i,r,o){var u=hv({latitude:t[1],zoom:i,scale:r,flipY:o,highPrecision:!0}),p=u.pixelsPerMeter,v=u.pixelsPerDegree,g=u.pixelsPerDegree2,E=this.cameraService.getViewMatrix(),A=this.cameraService.getProjectionMatrix(),P=Go([],A,E),F=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,i));this.viewportCenterProjection=zf([],[F[0],F[1],0,1],P),E=this.cameraService.getViewMatrixUncentered()||E,P=Go([],A,E),P=Go([],P,Op),this.cameraService.setViewProjectionMatrix(P),this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=g}}]),e}(),Gd=ma(cc.prototype,"cameraService",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cc))||vv),Ys=fe(20396),xd=fe.n(Ys),Tl;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Tl||(Tl={}));var U0,Z0,l0,mv,nm;function V0(e){var a=im();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function im(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var am={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Nm=(U0=(0,Nn.b2)(),Z0=(0,Nn.f3)(nr.IMapService),U0(l0=(mv=function(e){(0,sn.Z)(t,e);var a=V0(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"indragging",!1),ya((0,jt.Z)(i),"mapService",nm,(0,jt.Z)(i)),(0,xe.Z)((0,jt.Z)(i),"lastClickTime",0),(0,xe.Z)((0,jt.Z)(i),"lastClickXY",[-1,-1]),(0,xe.Z)((0,jt.Z)(i),"onDrag",function(p){var v=i.interactionEvent(p);v.type=am[v.type],v.type==="dragging"?i.indragging=!0:i.indragging=!1,i.emit(Tl.Drag,v)}),(0,xe.Z)((0,jt.Z)(i),"onHammer",function(p){p.srcEvent.stopPropagation();var v=i.interactionEvent(p);i.emit(Tl.Hover,v)}),(0,xe.Z)((0,jt.Z)(i),"onTouch",function(p){var v=p.touches[0];i.onHover({x:v.pageX,y:v.pageY,type:"touch"})}),(0,xe.Z)((0,jt.Z)(i),"onHover",function(p){var v=p.clientX,g=p.clientY,E=v,A=g,P=p.type,F=i.mapService.getMapContainer();if(F)if(Us)E=E-F.left-0,A=A-F.top-0;else{var N=F.getBoundingClientRect(),V=N.top,Y=N.left;E=E-Y-F.clientLeft,A=A-V-F.clientTop}var ie=i.mapService.containerToLngLat([E,A]);if(P==="click"){if(!Us&&"ontouchstart"in document.documentElement)return;i.isDoubleTap(E,A,ie);return}if(P==="touch"){i.isDoubleTap(E,A,ie);return}P!=="click"&&P!=="dblclick"&&i.emit(Tl.Hover,{x:E,y:A,lngLat:ie,type:P,target:p})}),i}return(0,At.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Tl.Hover)}},{key:"triggerHover",value:function(r){var o=r.x,u=r.y;this.emit(Tl.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(r){this.emit(Tl.Select,{featureId:r})}},{key:"triggerActive",value:function(r){this.emit(Tl.Active,{featureId:r})}},{key:"handleMiniEvent",value:function(r){this.onHover({clientX:r.touches[0].pageX,clientY:r.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var r=this.mapService.getMapContainer();if(r)if(Us)ka.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(xd()).Manager(r);o.add(new(xd()).Tap({event:"dblclick",taps:2})),o.add(new(xd()).Tap({event:"click"})),o.add(new(xd()).Pan({threshold:0,pointers:0})),o.add(new(xd()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),r.addEventListener("mousemove",this.onHover),r.addEventListener("mousedown",this.onHover,!0),r.addEventListener("mouseup",this.onHover),r.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(Us)ka.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var r=this.mapService.getMapContainer();r&&(r.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),r.removeEventListener("mousedown",this.onHover),r.removeEventListener("mouseup",this.onHover),r.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(r){var o=r.type,u=r.pointerType,p,v;u==="touch"?(v=Math.floor(r.pointers[0].clientY),p=Math.floor(r.pointers[0].clientX)):(v=Math.floor(r.srcEvent.y),p=Math.floor(r.srcEvent.x));var g=this.mapService.getMapContainer();if(g){var E=g.getBoundingClientRect(),A=E.top,P=E.left;p-=P,v-=A}var F=this.mapService.containerToLngLat([p,v]);return{x:p,y:v,lngLat:F,type:o,target:r.srcEvent}}},{key:"isDoubleTap",value:function(r,o,u){var p=this,v=new Date().getTime(),g="click";v-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-r)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),g="dblclick",this.emit(Tl.Hover,{x:r,y:o,lngLat:u,type:g})):(this.lastClickTime=v,this.lastClickXY=[r,o],this.clickTimer=setTimeout(function(){g="click",p.emit(Tl.Hover,{x:r,y:o,lngLat:u,type:g})},400))}}]),t}(To()),nm=ma(mv.prototype,"mapService",[Z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mv))||l0),zm=0;function gv(e){if(Us)return null;var a=e;if(typeof e=="string"&&(a=document.getElementById(e)),a){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(zm++),t.classList.add("l7-scene"),a.appendChild(t),t}return null}function Hg(e){var a,t,i=!0;return e==null||(a=e.target)===null||a===void 0||(t=a.path)===null||t===void 0||t.map(function(r){if(r!=null&&r.classList){var o;r==null||(o=r.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(i=!1)})}}),i}var q;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(q||(q={}));var yv,Um,Zm,Vm,jm,Gm,Fp,Dp,Hm,Wm,j0,Xm,Ym,_v=(yv=(0,Nn.b2)(),Um=(0,Nn.f3)(nr.IMapService),Zm=(0,Nn.f3)(nr.IRendererService),Vm=(0,Nn.f3)(nr.IGlobalConfigService),jm=(0,Nn.f3)(nr.IInteractionService),Gm=(0,Nn.f3)(nr.ILayerService),yv(Fp=(Dp=function(){function e(){var a=this;(0,Lt.Z)(this,e),(0,xe.Z)(this,"pickedTileLayers",[]),ya(this,"mapService",Hm,this),ya(this,"rendererService",Wm,this),ya(this,"configService",j0,this),ya(this,"interactionService",Xm,this),ya(this,"layerService",Ym,this),(0,xe.Z)(this,"width",0),(0,xe.Z)(this,"height",0),(0,xe.Z)(this,"alreadyInPicking",!1),(0,xe.Z)(this,"pickBufferScale",1),(0,xe.Z)(this,"pickedLayers",[]),(0,xe.Z)(this,"pickFromPickingFBO",function(t,i){var r=i.x,o=i.y,u=i.lngLat,p=i.type,v=i.target,g=!1,E=a.rendererService,A=E.readPixels,P=E.getContainer,F=a.getContainerSize(P()),N=F.width,V=F.height;N*=Ja,V*=Ja;var Y=t.getLayerConfig(),ie=Y.enableHighlight,ye=Y.enableSelect,Pe=r*Ja,tt=o*Ja;if(Pe>N-1*Ja||Pe<0||tt>V-1*Ja||tt<0)return!1;var pt=A({x:Math.floor(Pe/a.pickBufferScale),y:Math.floor((V-(o+1)*Ja)/a.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:a.pickingFBO});if(a.pickedColors=pt,pt[0]!==0||pt[1]!==0||pt[2]!==0){var vt=te(pt),Xt=t.getSource().getFeatureById(vt);vt!==t.getCurrentPickId()&&p==="mousemove"&&(p="mouseenter");var er={x:r,y:o,type:p,lngLat:u,featureId:vt,feature:Xt,target:v};Xt&&(g=!0,t.setCurrentPickId(vt),a.pickedLayers=[t],a.triggerHoverOnLayer(t,er))}else{var wr={x:r,y:o,lngLat:u,type:t.getCurrentPickId()!==null&&p==="mousemove"?"mouseout":"un"+p,featureId:null,target:v,feature:null};a.triggerHoverOnLayer(t,(0,Z.Z)((0,Z.Z)({},wr),{},{type:"unpick"})),a.triggerHoverOnLayer(t,wr),t.setCurrentPickId(null),a.pickedLayers=[]}if(ie&&a.highlightPickedFeature(t,pt),ye&&p==="click"&&(pt==null?void 0:pt.toString())!==[0,0,0,0].toString()){var kr=te(pt);t.getCurrentSelectedId()===null||kr!==t.getCurrentSelectedId()?(a.selectFeature(t,pt),t.setCurrentSelectedId(kr)):(a.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||a.layerService.getLayers().filter(function(Sr){return Sr.tileLayer}).map(function(Sr){Sr.tileLayer.clearPickState()})}return g})}return(0,At.Z)(e,[{key:"init",value:function(t){var i=this.rendererService,r=i.createTexture2D,o=i.createFramebuffer,u=i.getContainer,p=this.getContainerSize(u()),v=p.width,g=p.height;v*=Ja,g*=Ja,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=o({color:r({width:Math.round(v/this.pickBufferScale),height:Math.round(g/this.pickBufferScale),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(Tl.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var a=(0,Va.Z)(yi().mark(function i(r,o,u){var p=this,v,g,E,A;return yi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:v=this.rendererService,g=v.useFramebuffer,E=v.clear,A=v.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){E({framebuffer:p.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),r.hooks.beforePickingEncode.call(),r.renderModels(),r.hooks.afterPickingEncode.call();var N=p.pickBox(r,o);u(N)});case 3:case"end":return F.stop()}},i,this)}));function t(i,r,o){return a.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,i){var r=this,o=i.map(function(kr){var Sr=kr<0?0:kr;return Math.floor(Sr*Ja/r.pickBufferScale)}),u=(0,Ir.Z)(o,4),p=u[0],v=u[1],g=u[2],E=u[3],A=this.rendererService,P=A.readPixels,F=A.getContainer,N=this.getContainerSize(F()),V=N.width,Y=N.height;if(V*=Ja,Y*=Ja,p>(V-1)*Ja/this.pickBufferScale||g<0||v>(Y-1)*Ja/this.pickBufferScale||E<0)return[];for(var ie=Math.min(V/this.pickBufferScale,g)-p,ye=Math.min(Y/this.pickBufferScale,E)-v,Pe=P({x:p,y:Math.floor(Y/this.pickBufferScale-(E+1)),width:ie,height:ye,data:new Uint8Array(ie*ye*4),framebuffer:this.pickingFBO}),tt=[],pt={},vt=0;vt<Pe.length/4;vt=vt+1){var Xt=Pe.slice(vt*4,vt*4+4),er=te(Xt);if(er!==-1&&!pt[er]){var wr=t.getSource().getFeatureById(er);tt.push((0,Z.Z)((0,Z.Z)({},wr),{},{pickedFeatureIdx:er})),pt[er]=!0}}return tt}},{key:"handleCursor",value:function(t,i){var r=t.getLayerConfig(),o=r.cursor,u=o===void 0?"":o,p=r.cursorEnabled;if(p){var v=this.mapService.version,g=v==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),E=g==null?void 0:g.style.getPropertyValue("cursor");i==="unmousemove"&&E!==""?g==null||g.style.setProperty("cursor",""):i==="mousemove"&&(g==null||g.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/Ja,height:t.height/Ja}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var a=(0,Va.Z)(yi().mark(function i(r){return yi().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(r);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,i=this.getContainerSize(t()),r=i.width,o=i.height;r*=Ja,o*=Ja,(this.width!==r||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=r,this.height=o)}},{key:"pickingLayers",value:function(){var a=(0,Va.Z)(yi().mark(function i(r){var o=this,u,p,v,g,E;return yi().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:u=this.rendererService,p=u.getViewportSize,v=u.useFramebuffer,g=u.clear,E=u.getContainer,this.resizePickingFBO(),v(this.pickingFBO,function(){var F=o.layerService.getRenderList();F.filter(function(N){return N.needPick(r.type)}).reverse().some(function(N){if(g({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedLayers.filter(function(Y){return!Y.isVector}).map(function(Y){o.selectFeature(Y,new Uint8Array([0,0,0,0]))}),o.pickedTileLayers.map(function(Y){var ie;return(ie=Y.tileLayer)===null||ie===void 0?void 0:ie.clearPick(r.type)}),N.tileLayer)return N.tileLayer.pickLayers(r);N.hooks.beforePickingEncode.call(),N.masks.length>0&&N.masks.map(function(Y){Y.hooks.beforeRenderData.call(),Y.hooks.beforeRender.call(),Y.render(),Y.hooks.afterRender.call()}),N.renderModels(!0),N.hooks.afterPickingEncode.call();var V=o.pickFromPickingFBO(N,r);return o.layerService.pickedLayerId=V?+N.id:-1,V&&!N.getLayerConfig().enablePropagation})});case 3:case"end":return P.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,i){Hg(i)&&(this.handleCursor(t,i.type),t.emit(i.type,i))}},{key:"highlightPickedFeature",value:function(t,i){var r=(0,Ir.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeHighlight.call([o,u,p])}},{key:"selectFeature",value:function(t,i){var r=(0,Ir.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeSelect.call([o,u,p])}}]),e}(),Hm=ma(Dp.prototype,"mapService",[Um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wm=ma(Dp.prototype,"rendererService",[Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j0=ma(Dp.prototype,"configService",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xm=ma(Dp.prototype,"interactionService",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ym=ma(Dp.prototype,"layerService",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp))||Fp),c0=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Lt.Z)(this,e),(0,xe.Z)(this,"startTime",0),(0,xe.Z)(this,"oldTime",0),(0,xe.Z)(this,"running",!1),(0,xe.Z)(this,"elapsedTime",0),this.autoStart=a}return(0,At.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance=="undefined"?Date:performance).now();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return t}}]),e}(),om,xv,qm,$m,sm,f0,bv,um,h0;function p0(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=d0(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function d0(e,a){if(!!e){if(typeof e=="string")return Ev(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ev(e,a)}}function Ev(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Km=(om=(0,Nn.b2)(),xv=(0,Nn.f3)(nr.IRendererService),qm=(0,Nn.f3)(nr.IMapService),$m=(0,Nn.f3)(nr.IGlobalConfigService),om(sm=(f0=function(){function e(){(0,Lt.Z)(this,e),(0,xe.Z)(this,"pickedLayerId",-1),(0,xe.Z)(this,"clock",new c0),(0,xe.Z)(this,"alreadyInRendering",!1),(0,xe.Z)(this,"layers",[]),(0,xe.Z)(this,"layerList",[]),(0,xe.Z)(this,"sceneInited",!1),(0,xe.Z)(this,"animateInstanceCount",0),(0,xe.Z)(this,"shaderPicking",!0),(0,xe.Z)(this,"enableRender",!0),ya(this,"renderService",bv,this),ya(this,"mapService",um,this),ya(this,"configService",h0,this)}return(0,At.Z)(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(i){return i.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(i){return i.name===t})}},{key:"cleanRemove",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1),i&&(this.updateLayerRenderList(),this.renderLayers())}},{key:"remove",value:function(t,i){if(i){var r=i.layerChildren.indexOf(t);r>-1&&i.layerChildren.splice(r,1)}else{var o=this.layers.indexOf(t);o>-1&&this.layers.splice(o,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var a=(0,Va.Z)(yi().mark(function i(){var r,o,u;return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){v.next=2;break}return v.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),r=p0(this.layerList),v.prev=5,r.s();case 7:if((o=r.n()).done){v.next=21;break}if(u=o.value,u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(g){g.hooks.beforeRenderData.call(),g.hooks.beforeRender.call(),g.render(),g.hooks.afterRender.call()})),!u.getLayerConfig().enableMultiPassRenderer){v.next=17;break}return v.next=15,u.renderMultiPass();case 15:v.next=18;break;case 17:u.render();case 18:u.hooks.afterRender.call();case 19:v.next=7;break;case 21:v.next=26;break;case 23:v.prev=23,v.t0=v.catch(5),r.e(v.t0);case 26:return v.prev=26,r.f(),v.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return v.stop()}},i,this,[[5,23,26,29]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).sort(function(i,r){return i.zIndex-r.zIndex}).forEach(function(i){t.layerList.push(i)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=W(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ka.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ka.cancelAnimationFrame(this.layerRenderID)}}]),e}(),bv=ma(f0.prototype,"renderService",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=ma(f0.prototype,"mapService",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h0=ma(f0.prototype,"configService",[$m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f0))||sm),bd=fe(81253),lm=function(){function e(a){var t=this;(0,Lt.Z)(this,e),(0,xe.Z)(this,"featureBufferLayout",[]),(0,xe.Z)(this,"needRescale",!1),(0,xe.Z)(this,"needRemapping",!1),(0,xe.Z)(this,"needRegenerateVertices",!1),(0,xe.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,xe.Z)(this,"defaultCallback",function(i){if(i.length===0){var r;return((r=t.scale)===null||r===void 0?void 0:r.defaultValues)||[]}return i.map(function(o,u){var p,v=(p=t.scale)===null||p===void 0?void 0:p.scalers[u].func,g=v(o);return g})}),this.setProps(a)}return(0,At.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var r,o=(r=this.scale)===null||r===void 0?void 0:r.callback.apply(r,(0,_e.Z)(t));if(!(0,he.isNil)(o))return[o]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Ed=["modelType"],Qm=["buffer","update","name"],Wg=["buffer","update","name"],Xg=["buffer","update","name"],v0,Jm,cm,eg,fm,Cv;function vl(e){return new Promise(function(a){return setTimeout(a,e)})}var hm=(v0={},(0,xe.Z)(v0,q.FLOAT,4),(0,xe.Z)(v0,q.UNSIGNED_BYTE,1),(0,xe.Z)(v0,q.UNSIGNED_SHORT,2),v0),G0=(Jm=(0,Nn.b2)(),cm=(0,Nn.f3)(nr.IRendererService),Jm(eg=(fm=function(){function e(){(0,Lt.Z)(this,e),ya(this,"rendererService",Cv,this),(0,xe.Z)(this,"attributes",[]),(0,xe.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,At.Z)(e,[{key:"registerStyleAttribute",value:function(t){var i=this.getLayerStyleAttribute(t.name||"");return i?i.setProps(t):(i=new lm(t),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(t,i,r){var o=this.getLayerStyleAttribute(t);o||(o=this.registerStyleAttribute((0,Z.Z)((0,Z.Z)({},i),{},{name:t})));var u=i.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,r&&r.featureRange&&(o.featureRange=r.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(i){return i.name===t})}},{key:"getLayerAttributeScale",value:function(t){var i,r=this.getLayerStyleAttribute(t),o=r==null||(i=r.scale)===null||i===void 0?void 0:i.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=this.attributes.find(function(tt){return tt.name===t});if(u&&u.descriptor){var p=u.descriptor,v=p.update,g=p.buffer,E=p.size,A=E===void 0?0:E,P=hm[g.type||q.FLOAT];if(v){var F=this.featureLayout,N=F.elements,V=F.sizePerElement,Y=N.slice(r,o);if(!Y.length)return;var ie=Y[0].offset,ye=ie*A*P,Pe=Y.map(function(tt,pt){for(var vt=tt.featureIdx,Xt=tt.vertices,er=tt.normals,wr=Xt.length/V,kr=[],Sr=0;Sr<wr;Sr++){var un=er?er.slice(Sr*3,Sr*3+3):[];kr.push.apply(kr,(0,_e.Z)(v(i[vt],vt,Xt.slice(Sr*V,Sr*V+V),pt,un)))}return kr}).reduce(function(tt,pt){return tt.push.apply(tt,(0,_e.Z)(pt)),tt},[]);u.vertexAttribute.updateBuffer({data:Pe,offset:ye})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,i,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(N){return N.resetDescriptor(),N.descriptor}).filter(function(N){return N}),p=r.modelType,v=(0,bd.Z)(r,Ed),g=this.rendererService,E=g.createAttribute,A=g.createBuffer,P=g.createElements,F={};return new Promise(function(N,V){Jh(p,(0,Z.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:t,segmentNumber:i},v)).then(function(Y){Y.descriptors.forEach(function(ye,Pe){if(ye){var tt=ye.buffer,pt=ye.update,vt=ye.name,Xt=(0,bd.Z)(ye,Qm),er=E((0,Z.Z)({buffer:A(tt)},Xt));F[ye.name||""]=er,o.attributes[Pe].vertexAttribute=er}}),o.featureLayout=Y.featureLayout;var ie=P({data:Y.indices,type:q.UNSIGNED_INT,count:Y.indices.length});o.attributesAndIndices={attributes:F,elements:ie,count:null},N(o.attributesAndIndices)}).catch(function(Y){console.warn(Y),V(Y)})})}},{key:"createAttributesAndIndices",value:function(t,i,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var u=this.attributes.map(function(Pe){return Pe.resetDescriptor(),Pe.descriptor}),p=0,v=0,g=[],E=[],A=[],P=3;t.forEach(function(Pe,tt){var pt=o.triangulation(Pe,r),vt=pt.indices,Xt=pt.vertices,er=pt.normals,wr=pt.size,kr=pt.indexes,Sr=pt.count;typeof Sr=="number"&&(v+=Sr),vt.forEach(function(Da){E.push(Da+p)}),P=wr;var un=Xt.length/wr;o.featureLayout.sizePerElement=P,o.featureLayout.elements.push({featureIdx:tt,vertices:Xt,normals:er,offset:p}),p+=un;for(var Dn=function($a){var Fs=(er==null?void 0:er.slice($a*3,$a*3+3))||[],Fu=Xt.slice($a*wr,$a*wr+wr),xu=0;kr&&kr[$a]!==void 0&&(xu=kr[$a]),u.forEach(function(vf,S0){if(vf&&vf.update){var A0;(A0=vf.buffer.data).push.apply(A0,(0,_e.Z)(vf.update(Pe,tt,Fu,$a,Fs,xu)))}})},li=0;li<un;li++)Dn(li)});var F=this.rendererService,N=F.createAttribute,V=F.createBuffer,Y=F.createElements,ie={};u.forEach(function(Pe,tt){if(Pe){var pt=Pe.buffer,vt=Pe.update,Xt=Pe.name,er=(0,bd.Z)(Pe,Wg),wr=N((0,Z.Z)({buffer:V(pt)},er));ie[Pe.name||""]=wr,o.attributes[tt].vertexAttribute=wr}});var ye=Y({data:E,type:q.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:ie,elements:ye,count:v},this.attributesAndIndices}},{key:"createAttributes",value:function(t,i){var r=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var o=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),u=0,p=[],v=3;t.forEach(function(F,N){var V=r.triangulation(F),Y=V.indices,ie=V.vertices,ye=V.normals,Pe=V.size,tt=V.indexes;Y.forEach(function(er){p.push(er+u)}),v=Pe;var pt=ie.length/Pe;r.featureLayout.sizePerElement=v,r.featureLayout.elements.push({featureIdx:N,vertices:ie,normals:ye,offset:u}),u+=pt;for(var vt=function(wr){var kr=(ye==null?void 0:ye.slice(wr*3,wr*3+3))||[],Sr=ie.slice(wr*Pe,wr*Pe+Pe),un=0;tt&&tt[wr]!==void 0&&(un=tt[wr]),o.forEach(function(Dn,li){if(Dn&&Dn.update){var Da;(Da=Dn.buffer.data).push.apply(Da,(0,_e.Z)(Dn.update(F,N,Sr,wr,kr,un)))}})},Xt=0;Xt<pt;Xt++)vt(Xt)});var g=this.rendererService,E=g.createAttribute,A=g.createBuffer,P={};return o.forEach(function(F,N){if(F){var V=F.buffer,Y=F.update,ie=F.name,ye=(0,bd.Z)(F,Xg),Pe=E((0,Z.Z)({buffer:A(V)},ye));P[F.name||""]=Pe,r.attributes[N].vertexAttribute=Pe}}),{attributes:P}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(i){return{buffer:i.buffer,name:i.name,size:i.size}})}}]),e}(),Cv=ma(fm.prototype,"rendererService",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm))||eg),Rh=fe(67709),Sv=fe.n(Rh),m0,H0,tg,Av,W0,Hu,Bp,Wd,wv,Np,Xd,Tv,rg,ng,ig,ag,og,Ml,pm,dm,vm,_,w,M,O,B,J,ce,se,De,je,Ze,Qt;function xr(e){var a=Fr();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Fr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xr=(m0=(0,Nn.b2)(),H0=(0,Nn.f3)(nr.SceneID),tg=(0,Nn.f3)(nr.IIconService),Av=(0,Nn.f3)(nr.IFontService),W0=(0,Nn.f3)(nr.IControlService),Hu=(0,Nn.f3)(nr.IGlobalConfigService),Bp=(0,Nn.f3)(nr.IMapService),Wd=(0,Nn.f3)(nr.ICoordinateSystemService),wv=(0,Nn.f3)(nr.IRendererService),Np=(0,Nn.f3)(nr.ILayerService),Xd=(0,Nn.f3)(nr.ICameraService),Tv=(0,Nn.f3)(nr.IInteractionService),rg=(0,Nn.f3)(nr.IPickingService),ng=(0,Nn.f3)(nr.IShaderModuleService),ig=(0,Nn.f3)(nr.IMarkerService),ag=(0,Nn.f3)(nr.IPopupService),m0(og=(Ml=function(e){(0,sn.Z)(t,e);var a=xr(t);function t(){var i;return(0,Lt.Z)(this,t),i=a.call(this),(0,xe.Z)((0,jt.Z)(i),"destroyed",!1),(0,xe.Z)((0,jt.Z)(i),"loaded",!1),(0,xe.Z)((0,jt.Z)(i),"loadFont",!1),(0,xe.Z)((0,jt.Z)(i),"fontFamily",""),ya((0,jt.Z)(i),"id",pm,(0,jt.Z)(i)),ya((0,jt.Z)(i),"iconService",dm,(0,jt.Z)(i)),ya((0,jt.Z)(i),"fontService",vm,(0,jt.Z)(i)),ya((0,jt.Z)(i),"controlService",_,(0,jt.Z)(i)),ya((0,jt.Z)(i),"configService",w,(0,jt.Z)(i)),ya((0,jt.Z)(i),"map",M,(0,jt.Z)(i)),ya((0,jt.Z)(i),"coordinateSystemService",O,(0,jt.Z)(i)),ya((0,jt.Z)(i),"rendererService",B,(0,jt.Z)(i)),ya((0,jt.Z)(i),"layerService",J,(0,jt.Z)(i)),ya((0,jt.Z)(i),"cameraService",ce,(0,jt.Z)(i)),ya((0,jt.Z)(i),"interactionService",se,(0,jt.Z)(i)),ya((0,jt.Z)(i),"pickingService",De,(0,jt.Z)(i)),ya((0,jt.Z)(i),"shaderModuleService",je,(0,jt.Z)(i)),ya((0,jt.Z)(i),"markerService",Ze,(0,jt.Z)(i)),ya((0,jt.Z)(i),"popupService",Qt,(0,jt.Z)(i)),(0,xe.Z)((0,jt.Z)(i),"inited",!1),(0,xe.Z)((0,jt.Z)(i),"rendering",!1),(0,xe.Z)((0,jt.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),Xo(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,xe.Z)((0,jt.Z)(i),"handleMapCameraChanged",function(r){i.cameraService.update(r),i.render()}),i.hooks={init:new Ce},i}return(0,At.Z)(t,[{key:"init",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Va.Z)(yi().mark(function u(){return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,new Promise(function(g){o.map.onCameraChanged(function(E){o.cameraService.init(),o.cameraService.update(E),o.map.version!=="GAODE2.x"&&g()}),o.map.version!=="GAODE2.x"?o.map.init():g()});case 2:if(!(o.map.version==="GAODE2.x"&&o.map.initViewPort)){v.next=6;break}return v.next=5,o.map.init();case 5:o.map.initViewPort();case 6:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Tl.Drag,o.addSceneEvent.bind(o));case 13:case"end":return v.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Va.Z)(yi().mark(function u(){var p,v;return yi().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(p=gv(o.configService.getSceneConfig(o.id).id||""),o.$container=p,!p){E.next=12;break}return o.canvas=Qa("canvas","",p),o.setCanvas(),E.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),r.gl);case 7:o.initContainer(),Sv()(o.$container,o.handleWindowResized),ka.matchMedia&&((v=ka.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||v===void 0||v.addListener(o.handleWindowResized)),E.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return E.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Va.Z)(yi().mark(function u(){return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,new Promise(function(g){o.map.onCameraChanged(function(E){o.cameraService.init(),o.cameraService.update(E),o.map.version!=="GAODE2.x"&&g()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Tl.Drag,o.addSceneEvent.bind(o));case 5:case"end":return v.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,Va.Z)(yi().mark(function u(){var p;return yi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(p=r.canvas,o.$container=p||null,!o.$container){g.next=7;break}return g.next=5,o.rendererService.init(r.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:g.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return g.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(r){this.layerService.sceneService=this,this.layerService.add(r)}},{key:"addMask",value:function(r){this.layerService.sceneService=this,this.layerService.addMask(r)}},{key:"render",value:function(){var i=(0,Va.Z)(yi().mark(function o(){return yi().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this.rendering||this.destroyed)){p.next=2;break}return p.abrupt("return");case 2:if(this.rendering=!0,this.inited){p.next=23;break}return p.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){p.next=18;break}return p.prev=8,p.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:p.next=18;break;case 13:p.prev=13,p.t0=p.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(p.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return p.stop()}},o,this,[[8,13]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"addFontFace",value:function(r,o){this.fontFamily=r;var u=document.createElement("style");u.type="text/css",u.innerText=`
        @font-face{
            font-family: '`.concat(r,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(u),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(r){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var p=r==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return p}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var r=this.$container.parentElement;r!==null&&(this.markerContainer=Qa("div","l7-marker-container",r))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var r=this,o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var v;(v=r.$container)===null||v===void 0||v.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Rh.unbind)(this.$container,this.handleWindowResized),ka.matchMedia){var p;(p=ka.matchMedia("screen and (min-resolution: 2dppx)"))===null||p===void 0||p.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var r,o,u=Ja,p=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,v=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,g=this.canvas;g&&(g.width=p*u,g.height=v*u),this.rendererService.viewport({x:0,y:0,width:u*p,height:u*v})}},{key:"setCanvas",value:function(){var r,o,u=Ja,p=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,v=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,g=this.canvas;g.width=p*u,g.height=v*u,g.style.width="100%",g.style.height="100%"}},{key:"addSceneEvent",value:function(r){this.emit(r.type,r)}}]),t}(Hs.EventEmitter),pm=ma(Ml.prototype,"id",[H0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm=ma(Ml.prototype,"iconService",[tg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=ma(Ml.prototype,"fontService",[Av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=ma(Ml.prototype,"controlService",[W0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=ma(Ml.prototype,"configService",[Hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=ma(Ml.prototype,"map",[Bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=ma(Ml.prototype,"coordinateSystemService",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=ma(Ml.prototype,"rendererService",[wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=ma(Ml.prototype,"layerService",[Np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ce=ma(Ml.prototype,"cameraService",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),se=ma(Ml.prototype,"interactionService",[Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),De=ma(Ml.prototype,"pickingService",[rg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),je=ma(Ml.prototype,"shaderModuleService",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ze=ma(Ml.prototype,"markerService",[ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qt=ma(Ml.prototype,"popupService",[ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ml))||og);function Rn(e){var a=0;switch(e){case"vec2":case"ivec2":a=2;break;case"vec3":case"ivec3":a=3;break;case"vec4":case"ivec4":case"mat2":a=4;break;case"mat3":a=9;break;case"mat4":a=16;break;default:}return a}var Cn=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Fn(e){var a={};return e=e.replace(Cn,function(t,i,r){var o=r.split(":"),u=o[0].trim(),p="";switch(o.length>1&&(p=o[1].trim()),i){case"bool":p=p==="true";break;case"float":case"int":p=Number(p);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":p?p=p.replace("[","").replace("]","").split(",").reduce(function(v,g){return v.push(Number(g.trim())),v},[]):p=new Array(Rn(i)).fill(0);break;default:}return a[u]=p,"uniform ".concat(i," ").concat(u,`;
`)}),{content:e,uniforms:a}}var vn,ri,xi="#define PI 3.14159265359",Eo=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,uo=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,ro=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,lo=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,co=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Kr=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,cn=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Bi=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,qa=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,xa=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,ml=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Il=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,_s=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,kl=/precision\s+(high|low|medium)p\s+float/,ws=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Lh=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,zp=(vn=(0,Nn.b2)(),vn(ri=function(){function e(){(0,Lt.Z)(this,e),(0,xe.Z)(this,"moduleCache",{}),(0,xe.Z)(this,"rawContentCache",{})}return(0,At.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:xi,fs:xi}),this.registerModule("decode",{vs:Eo,fs:""}),this.registerModule("projection",{vs:cn,fs:""}),this.registerModule("project",{vs:Kr,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Bi}),this.registerModule("lighting",{vs:ro,fs:""}),this.registerModule("light",{vs:uo,fs:""}),this.registerModule("picking",{vs:co,fs:lo}),this.registerModule("styleMapping",{vs:qa,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:_s,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:xa,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:ml,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Il,fs:""})}},{key:"registerModule",value:function(t,i){if(!this.rawContentCache[t]){var r=i.vs,o=i.fs,u=i.uniforms,p=Fn(r),v=p.content,g=p.uniforms,E=Fn(o),A=E.content,P=E.uniforms;this.rawContentCache[t]={fs:A,uniforms:(0,Z.Z)((0,Z.Z)((0,Z.Z)({},g),P),u),vs:v}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var i=this;if(this.moduleCache[t])return this.moduleCache[t];var r=this.rawContentCache[t].vs,o=this.rawContentCache[t].fs,u=this.processModule(r,[],"vs"),p=u.content,v=u.includeList,g=this.processModule(o,[],"fs"),E=g.content,A=g.includeList,P=E,F=(0,he.uniq)(v.concat(A).concat(t)).reduce(function(N,V){return(0,Z.Z)((0,Z.Z)({},N),i.rawContentCache[V].uniforms)},{});return kl.test(E)||(P=ws+E),this.moduleCache[t]={fs:P.trim(),uniforms:F,vs:p.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,i,r){var o=this,u=t.replace(Lh,function(p,v){var g=v.split(" "),E=g[0].replace(/"/g,"");if(i.indexOf(E)>-1)return"";var A=o.rawContentCache[E][r];i.push(E);var P=o.processModule(A,i,r),F=P.content;return F});return{content:u,includeList:i}}}]),e}())||ri),_u=fe(66213),Po;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Po||(Po={}));var Pl,Ou,ol=(Pl=(0,Nn.b2)(),Pl(Ou=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Po.Normal}},{key:"init",value:function(t,i){this.config=i,this.rendererService=t.getContainer().get(nr.IRendererService),this.cameraService=t.getContainer().get(nr.ICameraService),this.mapService=t.getContainer().get(nr.IMapService),this.interactionService=t.getContainer().get(nr.IInteractionService),this.layerService=t.getContainer().get(nr.ILayerService),this.shaderModuleService=t.getContainer().get(nr.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||Ou),Uf,Up;function sg(e){var a=Mv();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Mv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mm=(Uf=(0,Nn.b2)(),Uf(Up=function(e){(0,sn.Z)(t,e);var a=sg(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(r,o){(0,_u.Z)((0,bt.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(ol))||Up),Xy,Yy,qy,Yg,$y;function $2(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=K2(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function K2(e,a){if(!!e){if(typeof e=="string")return Ky(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ky(e,a)}}function Ky(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Q2=(Xy=(0,Nn.b2)(),Yy=(0,Nn.f3)(nr.IPostProcessor),Xy(qy=(Yg=function(){function e(){(0,Lt.Z)(this,e),(0,xe.Z)(this,"passes",[]),ya(this,"postProcessor",$y,this),(0,xe.Z)(this,"width",0),(0,xe.Z)(this,"height",0)}return(0,At.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var a=(0,Va.Z)(yi().mark(function i(){var r,o,u;return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r=$2(this.passes),v.prev=1,r.s();case 3:if((o=r.n()).done){v.next=9;break}return u=o.value,v.next=7,u.render(this.layer);case 7:v.next=3;break;case 9:v.next=14;break;case 11:v.prev=11,v.t0=v.catch(1),r.e(v.t0);case 14:return v.prev=14,r.f(),v.finish(14);case 17:return v.next=19,this.postProcessor.render(this.layer);case 19:case"end":return v.stop()}},i,this,[[1,11,14,17]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,i){(this.width!==t||this.height!==i)&&(this.postProcessor.resize(t,i),this.width=t,this.height=i)}},{key:"add",value:function(t,i){t.getType()===Po.PostProcessing?this.postProcessor.add(t,this.layer,i):(t.init(this.layer,i),this.passes.push(t))}},{key:"insert",value:function(t,i,r){t.init(this.layer,i),this.passes.splice(r,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),$y=ma(Yg.prototype,"postProcessor",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg))||qy),Qy,Jy;function J2(e){var a=eE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function eE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tE=(Qy=(0,Nn.b2)(),Qy(Jy=function(e){(0,sn.Z)(t,e);var a=J2(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"width",0),(0,xe.Z)((0,jt.Z)(i),"height",0),(0,xe.Z)((0,jt.Z)(i),"alreadyInRendering",!1),(0,xe.Z)((0,jt.Z)(i),"pickFromPickingFBO",function(p){var v=p.x,g=p.y,E=p.lngLat,A=p.type;if(!(!i.layer.isVisible()||!i.layer.needPick(A))){var P=i.rendererService,F=P.getViewportSize,N=P.readPixels,V=P.useFramebuffer,Y=F(),ie=Y.width,ye=Y.height,Pe=i.layer.getLayerConfig(),tt=Pe.enableHighlight,pt=Pe.enableSelect,vt=v*Ja,Xt=g*Ja;if(!(vt>ie||vt<0||Xt>ye||Xt<0)){var er;V(i.pickingFBO,function(){var wr;if(er=N({x:Math.round(vt),y:Math.round(ye-(g+1)*Ja),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),er[0]!==0||er[1]!==0||er[2]!==0){var kr=te(er),Sr=i.layer.getSource().getFeatureById(kr),un={x:v,y:g,type:A,lngLat:E,featureId:kr,feature:Sr};Sr&&(i.layer.setCurrentPickId(kr),i.triggerHoverOnLayer(un))}else{var Dn={x:v,y:g,lngLat:E,type:i.layer.getCurrentPickId()===null?"un"+A:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer((0,Z.Z)((0,Z.Z)({},Dn),{},{type:"unpick"})),i.triggerHoverOnLayer(Dn),i.layer.setCurrentPickId(null)}tt&&i.highlightPickedFeature(er),pt&&A==="click"&&((wr=er)===null||wr===void 0?void 0:wr.toString())!==[0,0,0,0].toString()&&i.selectFeature(er)})}}}),i}return(0,At.Z)(t,[{key:"getType",value:function(){return Po.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(r,o){(0,_u.Z)((0,bt.Z)(t.prototype),"init",this).call(this,r,o),this.layer=r;var u=this.rendererService,p=u.createTexture2D,v=u.createFramebuffer,g=u.getViewportSize,E=g(),A=E.width,P=E.height;this.pickingFBO=v({color:p({width:A,height:P,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.interactionService.on(Tl.Hover,this.pickFromPickingFBO),this.interactionService.on(Tl.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Tl.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(r){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,p=u.getViewportSize,v=u.useFramebuffer,g=u.clear,E=p(),A=E.width,P=E.height;this.alreadyInRendering=!0,(this.width!==A||this.height!==P)&&(this.pickingFBO.resize({width:A,height:P}),this.width=A,this.height=P),v(this.pickingFBO,function(){g({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),r.hooks.beforePickingEncode.call(),r.render(),r.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(F),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(r){this.layer.emit(r.type,r)}},{key:"highlightPickedFeature",value:function(r){var o=(0,Ir.Z)(r,3),u=o[0],p=o[1],v=o[2];this.layer.hooks.beforeHighlight.call([u,p,v]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(r){var o=(0,Ir.Z)(r,3),u=o[0],p=o[1],v=o[2];this.layer.hooks.beforeSelect.call([u,p,v]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(r){var o=r.featureId,u=be(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(r){var o=r.featureId,u=be(o);this.highlightPickedFeature(new Uint8Array(u))}}]),t}(ol))||Jy),e_,t_,r_,qg,n_,rE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Yd=(e_=(0,Nn.b2)(),t_=(0,Nn.f3)(nr.IShaderModuleService),e_(r_=(qg=function(){function e(){(0,Lt.Z)(this,e),ya(this,"shaderModuleService",n_,this),(0,xe.Z)(this,"quad",rE),(0,xe.Z)(this,"enabled",!0),(0,xe.Z)(this,"renderToScreen",!1),(0,xe.Z)(this,"optionsToUpdate",{})}return(0,At.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Po.PostProcessing}},{key:"init",value:function(t,i){this.config=i,this.rendererService=t.getContainer().get(nr.IRendererService),this.shaderModuleService=t.getContainer().get(nr.IShaderModuleService);var r=this.rendererService,o=r.createAttribute,u=r.createBuffer,p=r.createModel,v=this.setupShaders(),g=v.vs,E=v.fs,A=v.uniforms;this.model=p({vs:g,fs:E,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:(0,Z.Z)((0,Z.Z)({u_Texture:null},A),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,i){var r=this,o=t.multiPassRenderer.getPostProcessor(),u=this.rendererService,p=u.useFramebuffer,v=u.getViewportSize,g=u.clear,E=v(),A=E.width,P=E.height;p(this.renderToScreen?null:o.getWriteFBO(),function(){g({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=(0,Z.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[A,P]},r.convertOptionsToUniforms(r.optionsToUpdate));i&&(F.u_BloomFinal=1,F.u_Texture2=i),r.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,Z.Z)((0,Z.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var i={};return Object.keys(t).forEach(function(r){(0,he.isNil)(t[r])||(i["u_".concat((0,he.upperFirst)((0,he.camelCase)(r)))]=t[r])}),i}}]),e}(),n_=ma(qg.prototype,"shaderModuleService",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qg))||r_),i_,a_;function nE(e){var a=iE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function iE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aE=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,oE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,sE=(i_=(0,Nn.b2)(),i_(a_=function(e){(0,sn.Z)(t,e);var a=nE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:oE,fs:aE});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,he.isNil)(r.bloomRadius)||(o.u_radius=r.bloomRadius),(0,he.isNil)(r.bloomIntensity)||(o.u_intensity=r.bloomIntensity),(0,he.isNil)(r.bloomBaseRadio)||(o.u_baseRadio=r.bloomBaseRadio),o}}]),t}(Yd))||a_),o_,s_;function uE(e){var a=lE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function lE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,fE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hE=(o_=(0,Nn.b2)(),o_(s_=function(e){(0,sn.Z)(t,e);var a=uE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:fE,fs:cE});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,he.isNil)(r.blurRadius)||(o.u_BlurDir=[r.blurRadius,0]),o}}]),t}(Yd))||s_),u_,l_;function pE(e){var a=dE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function dE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,mE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gE=(u_=(0,Nn.b2)(),u_(l_=function(e){(0,sn.Z)(t,e);var a=pE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:mE,fs:vE});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,he.isNil)(r.blurRadius)||(o.u_BlurDir=[0,r.blurRadius]),o}}]),t}(Yd))||l_),c_,f_;function yE(e){var a=_E();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function _E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xE=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,bE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,EE=(c_=(0,Nn.b2)(),c_(f_=function(e){(0,sn.Z)(t,e);var a=yE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:bE,fs:xE});var r=this.shaderModuleService.getModule("colorhalftone-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Yd))||f_),h_,p_;function CE(e){var a=SE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function SE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,wE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TE=(h_=(0,Nn.b2)(),h_(p_=function(e){(0,sn.Z)(t,e);var a=CE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:wE,fs:AE}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Yd))||p_),d_,v_;function ME(e){var a=IE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function IE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kE=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,PE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,RE=(d_=(0,Nn.b2)(),d_(v_=function(e){(0,sn.Z)(t,e);var a=ME(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:PE,fs:kE});var r=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Yd))||v_),m_,g_;function LE(e){var a=OE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function OE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FE=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,DE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,BE=(m_=(0,Nn.b2)(),m_(g_=function(e){(0,sn.Z)(t,e);var a=LE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:DE,fs:FE});var r=this.shaderModuleService.getModule("ink-pass"),o=r.vs,u=r.fs,p=r.uniforms,v=this.rendererService.getViewportSize(),g=v.width,E=v.height;return{vs:o,fs:u,uniforms:(0,Z.Z)((0,Z.Z)({},p),{},{u_ViewportSize:[g,E]})}}}]),t}(Yd))||g_),y_,__;function NE(e){var a=zE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function zE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UE=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,ZE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,VE=(y_=(0,Nn.b2)(),y_(__=function(e){(0,sn.Z)(t,e);var a=NE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:ZE,fs:UE}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Yd))||__),x_,b_;function jE(e){var a=GE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,WE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,XE=(x_=(0,Nn.b2)(),x_(b_=function(e){(0,sn.Z)(t,e);var a=jE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:HE,fs:WE}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Yd))||b_),E_,C_,S_,A_,Iv,w_,YE=(E_=(0,Nn.b2)(),C_=(0,Nn.f3)(nr.IRendererService),S_=(0,Nn.zY)(),E_(A_=(Iv=function(){function e(){(0,Lt.Z)(this,e),ya(this,"rendererService",w_,this),(0,xe.Z)(this,"passes",[])}return(0,At.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,i=t.getViewportSize,r=t.createTexture2D,o=i(),u=o.width,p=o.height;return r({x:0,y:0,width:u,height:p,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,i=this.rendererService.useFramebuffer;return new Promise(function(r,o){i(t.readFBO,(0,Va.Z)(yi().mark(function u(){return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r(t.getCurrentFBOTex());case 1:case"end":return v.stop()}},u)})))})}},{key:"renderBloomPass",value:function(){var a=(0,Va.Z)(yi().mark(function i(r,o){var u,p;return yi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.getReadFBOTex();case 2:u=g.sent,p=0;case 4:if(!(p<4)){g.next=11;break}return g.next=7,o.render(r,u);case 7:this.swap(),p++,g.next=4;break;case 11:case"end":return g.stop()}},i,this)}));function t(i,r){return a.apply(this,arguments)}return t}()},{key:"render",value:function(){var a=(0,Va.Z)(yi().mark(function i(r){var o,u;return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:o=0;case 1:if(!(o<this.passes.length)){v.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){v.next=9;break}return v.next=7,this.renderBloomPass(r,u);case 7:v.next=12;break;case 9:return v.next=11,u.render(r);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,v.next=1;break;case 15:case"end":return v.stop()}},i,this)}));function t(i){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,i){this.readFBO.resize({width:t,height:i}),this.writeFBO.resize({width:t,height:i})}},{key:"add",value:function(t,i,r){t.init(i,r),this.passes.push(t)}},{key:"insert",value:function(t,i,r,o){t.init(r,o),this.passes.splice(i,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(i){return i.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,i=t.createFramebuffer,r=t.createTexture2D;this.readFBO=i({color:r({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.writeFBO=i({color:r({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var i=t+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),w_=ma(Iv.prototype,"rendererService",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ma(Iv.prototype,"init",[S_],Object.getOwnPropertyDescriptor(Iv.prototype,"init"),Iv.prototype),Iv))||A_),T_,M_;function qE(e){var a=$E();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function $E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KE=(T_=(0,Nn.b2)(),T_(M_=function(e){(0,sn.Z)(t,e);var a=qE(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getType",value:function(){return Po.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(r,o){(0,_u.Z)((0,bt.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(r){var o=this.rendererService,u=o.useFramebuffer,p=o.clear,v=r.multiPassRenderer.getPostProcessor().getReadFBO();u(v,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:v}),r.multiPassRenderer.setRenderFlag(!1),r.models.forEach(function(g){g.draw({uniforms:r.layerModel.getUninforms()})}),r.multiPassRenderer.setRenderFlag(!0)})}}]),t}(ol))||M_),I_,k_,P_,$g,R_;function QE(e){var a=JE();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function JE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eC=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,L_=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,tC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function O_(e,a){for(var t=0,i=1/a,r=e;r>0;)t=t+i*(r%a),r=Math.floor(r/a),i=i/a;return t}var rC=1,nC=(I_=(0,Nn.b2)(),k_=(0,Nn.f3)(nr.IShaderModuleService),I_(P_=($g=function(e){(0,sn.Z)(t,e);var a=QE(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),ya((0,jt.Z)(i),"shaderModuleService",R_,(0,jt.Z)(i)),(0,xe.Z)((0,jt.Z)(i),"haltonSequence",[]),(0,xe.Z)((0,jt.Z)(i),"accumulatingId",0),(0,xe.Z)((0,jt.Z)(i),"frame",0),(0,xe.Z)((0,jt.Z)(i),"timer",void 0),i}return(0,At.Z)(t,[{key:"getType",value:function(){return Po.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(r,o){(0,_u.Z)((0,bt.Z)(t.prototype),"init",this).call(this,r,o);var u=this.rendererService,p=u.createFramebuffer,v=u.createTexture2D;this.sampleRenderTarget=p({color:v({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.prevRenderTarget=p({color:v({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.outputRenderTarget=p({color:v({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})}),this.copyRenderTarget=p({color:v({width:1,height:1,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE})});for(var g=0;g<30;g++)this.haltonSequence.push([O_(g,2),O_(g,3)]);this.blendModel=this.createTriangleModel("blend-pass",eC),this.outputModel=this.createTriangleModel("copy-pass",L_,{blend:{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:q.ONE,dstAlpha:q.ONE_MINUS_SRC_ALPHA},equation:{rgb:q.FUNC_ADD,alpha:q.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",L_)}},{key:"render",value:function(r){var o=this,u=this.rendererService,p=u.clear,v=u.getViewportSize,g=u.useFramebuffer,E=v(),A=E.width,P=E.height;this.sampleRenderTarget.resize({width:A,height:P}),this.prevRenderTarget.resize({width:A,height:P}),this.outputRenderTarget.resize({width:A,height:P}),this.copyRenderTarget.resize({width:A,height:P}),this.resetFrame(),this.stopAccumulating();var F=r.multiPassRenderer.getPostProcessor().getReadFBO();g(F,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),r.multiPassRenderer.setRenderFlag(!1),r.render(),r.multiPassRenderer.setRenderFlag(!0)});var N=function V(Y){!o.accumulatingId||Y!==o.accumulatingId||o.isFinished()||(o.doRender(r),ka.requestAnimationFrame(function(){V(Y)}))};this.accumulatingId=rC++,this.timer=ka.setTimeout(function(){N(o.accumulatingId)},50)}},{key:"doRender",value:function(r){var o=this,u=this.rendererService,p=u.clear,v=u.getViewportSize,g=u.useFramebuffer,E=v(),A=E.width,P=E.height,F=r.getLayerConfig(),N=F.jitterScale,V=N===void 0?1:N,Y=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((Y[0]*2-1)/A*V,(Y[1]*2-1)/P*V),r.multiPassRenderer.setRenderFlag(!1),r.hooks.beforeRender.call(),g(this.sampleRenderTarget,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),r.render()}),r.hooks.afterRender.call(),r.multiPassRenderer.setRenderFlag(!0);var ie=r.getLayerConfig();g(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:ie.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?r.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(g(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),g(r.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),r.multiPassRenderer.getPostProcessor().render(r));var ye=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ye,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ka.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(r,o,u){this.shaderModuleService.registerModule(r,{vs:tC,fs:o});var p=this.shaderModuleService.getModule(r),v=p.vs,g=p.fs,E=p.uniforms,A=this.rendererService,P=A.createAttribute,F=A.createBuffer,N=A.createModel;return N((0,Z.Z)({vs:v,fs:g,attributes:{a_Position:P({buffer:F({data:[-4,-4,4,-4,0,4],type:q.FLOAT}),size:2})},uniforms:(0,Z.Z)({},E),depth:{enable:!1},count:3},u))}}]),t}(ol),R_=ma($g.prototype,"shaderModuleService",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$g))||P_),gm=new Nn.W2;gm.bind(nr.IGlobalConfigService).to(lc).inSingletonScope(),(0,Nn.GW)((0,Nn.b2)(),Hs.EventEmitter),gm.bind(nr.IEventEmitter).to(Hs.EventEmitter);var F_=(0,Wv.Z)(gm,!1),Kg=function(a){var t=F_.lazyInject(a);return function(i,r,o){t.call(this,i,r),o&&(o.initializer=function(){return i[r]})}},Qk=function(a){var t=F_.lazyMultiInject(a);return function(i,r,o){t.call(this,i,r),o&&(o.initializer=function(){return i[r]})}},Oh=gm,iC=0;function aC(){var e=new Nn.W2;return e.parent=gm,e.bind(nr.SceneID).toConstantValue("".concat(iC++)),e.bind(nr.IShaderModuleService).to(zp).inSingletonScope(),e.bind(nr.ILayerService).to(Km).inSingletonScope(),e.bind(nr.ISceneService).to(Xr).inSingletonScope(),e.bind(nr.ICameraService).to(up).inSingletonScope(),e.bind(nr.ICoordinateSystemService).to(Hd).inSingletonScope(),e.bind(nr.IInteractionService).to(Nm).inSingletonScope(),e.bind(nr.IPickingService).to(_v).inSingletonScope(),e.bind(nr.IControlService).to(M0).inSingletonScope(),e.bind(nr.IMarkerService).to(md).inSingletonScope(),e.bind(nr.IIconService).to(ao).inSingletonScope(),e.bind(nr.IFontService).to(Jn).inSingletonScope(),e.bind(nr.IPopupService).to(As).inSingletonScope(),e.bind(nr.INormalPass).to(mm).whenTargetNamed("clear"),e.bind(nr.INormalPass).to(tE).whenTargetNamed("pixelPicking"),e.bind(nr.INormalPass).to(KE).whenTargetNamed("render"),e.bind(nr.INormalPass).to(nC).whenTargetNamed("taa"),e.bind(nr.IFactoryNormalPass).toFactory(function(a){return function(t){return a.container.getNamed(nr.INormalPass,t)}}),e.bind(nr.IPostProcessingPass).to(TE).whenTargetNamed("copy"),e.bind(nr.IPostProcessingPass).to(sE).whenTargetNamed("bloom"),e.bind(nr.IPostProcessingPass).to(hE).whenTargetNamed("blurH"),e.bind(nr.IPostProcessingPass).to(gE).whenTargetNamed("blurV"),e.bind(nr.IPostProcessingPass).to(VE).whenTargetNamed("noise"),e.bind(nr.IPostProcessingPass).to(XE).whenTargetNamed("sepia"),e.bind(nr.IPostProcessingPass).to(EE).whenTargetNamed("colorHalftone"),e.bind(nr.IPostProcessingPass).to(RE).whenTargetNamed("hexagonalPixelate"),e.bind(nr.IPostProcessingPass).to(BE).whenTargetNamed("ink"),e.bind(nr.IFactoryPostProcessingPass).toFactory(function(a){return function(t){var i=a.container.getNamed(nr.IPostProcessingPass,t);return i.setName(t),i}}),e}function Qg(e){var a=new Nn.W2;return a.parent=e,a.bind(nr.IStyleAttributeService).to(G0).inSingletonScope(),a.bind(nr.IMultiPassRenderer).to(Q2).inSingletonScope(),a.bind(nr.IPostProcessor).to(YE).inSingletonScope(),a}var oC=null;function Jk(e){return oC.indexOf(e)}var sC=2,eP=4,uC=64,tP=128,lC=256,cC=512,rP=8192,nP=16384,iP=32768,fC=null,D_=131072,aP=262144,hC=524288,oP=1048576,pC=2097152,sP=4194304,dC=8388608,vC=16777216,mC=null;function ug(e,a){return e=clamp(Math.floor(e),0,255),a=clamp(Math.floor(a),0,255),256*e+a}function uP(e){var a=e.color,t=e.radius,i=e.tileX,r=e.tileY,o=e.shape,u=e.opacity,p=e.stroke,v=e.strokeWidth,g=e.strokeOpacity,E=[],A=[],P=[],F=[ug(a[0],a[1]),ug(a[2],a[3])],N=[ug(p[0],p[1]),ug(p[2],p[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(V){var Y=_slicedToArray(V,2),ie=Y[0],ye=Y[1];E.push([].concat(F,[(ie+1)*dC+(ye+1)*pC+getShapeIndex(o)*D_+t,(i+512)*hC+(r+512)*uC])),A.push([].concat(N,[v,g])),P.push([u,0,0,0])}),{packedBuffer:E,packedBuffer2:A,packedBuffer3:P}}function lP(e,a){if(e===0&&!a)return 0;if(e===1&&a)return 4294967295;var t=a?1:0,i=Math.floor(e*127);return i*mC+t*vC+i*D_+t*fC+i*cC+t*lC+i*sC+t}var Fh;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Fh||(Fh={}));var ls;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(ls||(ls={}));var g0;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(g0||(g0={}));var Gn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Gn||(Gn={}));var gC=["mapload","mapchange","mapAfterFrameChange"],X0={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Jg=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],y0;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(y0||(y0={}));function yC(e){var a=_C();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function _C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xC=0,lg=function(e){(0,sn.Z)(t,e);var a=yC(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this),r.controlOption=(0,Z.Z)((0,Z.Z)({},r.getDefault()),i||{}),r}return(0,At.Z)(t,[{key:"getDefault",value:function(){return{position:y0.TOPRIGHT,name:"".concat(xC++)}}},{key:"setPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:y0.BOTTOMRIGHT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=r,o&&o.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(r){this.mapsService=r.get(nr.IMapService),this.renderService=r.get(nr.IRendererService),this.layerService=r.get(nr.ILayerService),this.controlService=r.get(nr.IControlService),this.sceneContainer=r,this.isShow=!0,this.container=this.onAdd();var o=this.container,u=this.controlOption.position,p=this.controlService.controlCorners[u];return Dl(o,"l7-control"),u.indexOf("bottom")!==-1?p.insertBefore(o,p.firstChild):p.appendChild(o),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var r=this.container;Dl(r,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var r=this.container;_c(r,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Cf(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(r){if(this.mapsService&&r&&r.screenX>0&&r.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}}]),t}(Hs.EventEmitter);function bC(e){var a=EC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function EC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cP=function(e){(0,sn.Z)(t,e);var a=bC(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),r.layerControlInputs=[],r.layers=[],r.lastZIndex=0,r.handlingClick=!1,r.initLayers(),S(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,jt.Z)(r)),r}return(0,At.Z)(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:y0.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var r=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(o){o.layer.on("remove",r.onLayerChange),o.layer.on("add",r.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(r,o){return this.addLayer(r,o,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var r=this.renderService.getViewportSize(),o=r.height;Dl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var u=o-(this.container.offsetTop+50);return u<this.form.clientHeight?(Dl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=u+"px"):_c(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return _c(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var r=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(o){o.layer.off("remove",r.onLayerChange),o.layer.off("add",r.onLayerChange)}))}},{key:"initLayout",value:function(){var r="l7-control-layers",o=this.container=Qa("div",r),u=this.controlOption.collapsed;o.setAttribute("aria-haspopup","true");var p=this.form=Qa("form",r+"-list");u&&(this.mapsService.on("click",this.collapse),o.addEventListener("mouseenter",this.expand),o.addEventListener("mouseleave",this.collapse)),this.layersLink=Qa("a",r+"-toggle",o);var v=this.layersLink;v.title="Layers",u||this.expand(),this.baseLayersList=Qa("div",r+"-base",p),this.separator=Qa("div",r+"-separator",p),this.overlaysList=Qa("div",r+"-overlays",p),o.appendChild(p)}},{key:"initLayers",value:function(){var r=this,o=this.controlOption,u=o.baseLayers,p=u===void 0?{}:u,v=o.overlayers,g=v===void 0?{}:v;Object.keys(p).forEach(function(E,A){r.addLayer(p[E],E,!1)}),Object.keys(g).forEach(function(E,A){r.addLayer(g[E],E,!0)})}},{key:"update",value:function(){if(!this.container)return this;Sf(this.baseLayersList),Sf(this.overlaysList),this.layerControlInputs=[];var r,o,u,p,v=0;for(u=0;u<this.layers.length;u++)p=this.layers[u],this.addItem(p),o=o||p.overlay,r=r||!p.overlay,v+=p.overlay?0:1;return this.controlOption.hideSingleBase&&(r=r&&v>1,this.baseLayersList.style.display=r?"":"none"),this.separator.style.display=o&&r?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var r=this.layerControlInputs,o,u,p=this.mapsService.getZoom(),v=r.length-1;v>=0;v--)if(o=r[v],u=this.layerService.getLayer(o.layerId),u&&u.inited){var g=u.getMinZoom(),E=u.getMaxZoom();o.disabled=p<g||p>E}}},{key:"addLayer",value:function(r,o,u){this.mapsService&&(r.on("add",this.onLayerChange),r.on("remove",this.onLayerChange)),this.layers.push({layer:r,name:o,overlay:u});var p=this.controlOption,v=p.sortLayers,g=p.sortFunction,E=p.autoZIndex;v&&this.layers.sort(function(A,P){return g(A.layer,P.layer,A.name,P.name)}),E&&r.setZIndex&&(this.lastZIndex++,r.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(r){this.handlingClick||this.update();var o=this.layerService.getLayer(r.target.layerId),u=o!=null&&o.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;u&&this.emit(u,o)}},{key:"createRadioElement",value:function(r,o){var u='<input type="radio" class="l7-control-layers-selector" name="'+r+'"'+(o?' checked="checked"':"")+"/>",p=document.createElement("div");return p.innerHTML=u,p.firstChild}},{key:"addItem",value:function(r){var o=document.createElement("label"),u=this.layerService.getLayer(r.layer.id),p=u&&u.inited&&r.layer.isVisible(),v;r.overlay?(v=document.createElement("input"),v.type="checkbox",v.className="l7-control-layers-selector",v.defaultChecked=p):v=this.createRadioElement("l7-base-layers",p),this.layerControlInputs.push(v),v.layerId=r.layer.id,v.addEventListener("click",this.onInputClick);var g=document.createElement("span");g.innerHTML=" "+r.name;var E=document.createElement("div");o.appendChild(E),E.appendChild(v),E.appendChild(g);var A=r.overlay?this.overlaysList:this.baseLayersList;return A.appendChild(o),this.checkDisabledLayers(),o}},{key:"onInputClick",value:function(){var r=this.layerControlInputs,o,u,p=[],v=[];this.handlingClick=!0;for(var g=r.length-1;g>=0;g--)o=r[g],u=this.layerService.getLayer(o.layerId),o.checked?p.push(u):o.checked||v.push(u);v.forEach(function(E){E.hide()}),p.forEach(function(E){E.show()}),this.handlingClick=!1}}]),t}(lg);function CC(e){var a=SC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function SC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AC=function(e){(0,sn.Z)(t,e);var a=CC(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getDefault",value:function(){return{position:y0.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var r="l7-control-logo",o=Qa("div",r),u=Qa("a","l7-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://antv.alipay.com/l7",u.setAttribute("aria-label","AntV logo"),u.setAttribute("rel","noopener nofollow"),o.appendChild(u),o}},{key:"onRemove",value:function(){return null}}]),t}(lg);function wC(e){var a=TC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fP=function(e){(0,sn.Z)(t,e);var a=wC(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),S(["update"],(0,jt.Z)(r)),r}return(0,At.Z)(t,[{key:"getDefault",value:function(){return{position:y0.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var r="l7-control-scale",o=Qa("div",r);this.addScales(r+"-line",o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),this.update(),o}},{key:"onRemove",value:function(){var r=this.controlOption.updateWhenIdle;this.mapsService.off(r?"zoomend":"zoomchange",this.update),this.mapsService.off(r?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var r=this.mapsService,o=this.controlOption.maxWidth,u=r.getSize()[1]/2,p=r.containerToLngLat([0,u]),v=r.containerToLngLat([o,u]),g=Kc([p.lng,p.lat],[v.lng,v.lat]);this.updateScales(g)}},{key:"updateScales",value:function(r){var o=this.controlOption,u=o.metric,p=o.imperial;u&&r&&this.updateMetric(r),p&&r&&this.updateImperial(r)}},{key:"updateMetric",value:function(r){var o=this.getRoundNum(r),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/r)}},{key:"updateImperial",value:function(r){var o=r*3.2808399,u,p,v;o>5280?(u=o/5280,p=this.getRoundNum(u),this.updateScale(this.iScale,p+" mi",p/u)):(v=this.getRoundNum(o),this.updateScale(this.iScale,v+" ft",v/o))}},{key:"updateScale",value:function(r,o,u){var p=this.controlOption.maxWidth;r.style.width=Math.round(p*u)+"px",r.innerHTML=o}},{key:"getRoundNum",value:function(r){var o=Math.pow(10,(Math.floor(r)+"").length-1),u=r/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"addScales",value:function(r,o){var u=this.controlOption,p=u.metric,v=u.imperial;p&&(this.mScale=Qa("div",r,o)),v&&(this.iScale=Qa("div",r,o))}}]),t}(lg);function MC(e){var a=IC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function IC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hP=function(e){(0,sn.Z)(t,e);var a=MC(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),S(["updateDisabled","zoomIn","zoomOut"],(0,jt.Z)(r)),r}return(0,At.Z)(t,[{key:"getDefault",value:function(){return{position:y0.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var r="l7-control-zoom",o=Qa("div",r+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,r+"-in",o,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,r+"-out",o,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),o}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(r,o,u,p,v){var g=Qa("a",u,p);return g.innerHTML=r,g.title=o,g.href="javascript:void(0)",g.addEventListener("click",v),g}},{key:"updateDisabled",value:function(){var r=this.mapsService,o="l7-disabled";_c(this.zoomInButton,o),_c(this.zoomOutButton,o),(this.disabled||r.getZoom()<=r.getMinZoom())&&Dl(this.zoomOutButton,o),(this.disabled||r.getZoom()>=r.getMaxZoom())&&Dl(this.zoomInButton,o)}}]),t}(lg);function kC(e){var a=PC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function PC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B_=function(e){(0,sn.Z)(t,e);var a=kC(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this),(0,xe.Z)((0,jt.Z)(r),"added",!1),(0,xe.Z)((0,jt.Z)(r),"eventHandle",function(o){r.emit(o.type,{target:o,data:r.markerOption.extData,lngLat:r.lngLat})}),r.markerOption=(0,Z.Z)((0,Z.Z)({},r.getDefault()),i),S(["update","onMove","onUp","addDragHandler","onMapClick"],(0,jt.Z)(r)),r.init(),r}return(0,At.Z)(t,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ie.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(r){this.scene=r,this.mapsService=r.get(nr.IMapService),this.sceneSerive=r.get(nr.ISceneService);var o=this.markerOption,u=o.element,p=o.draggable;return this.mapsService.getMarkerContainer().appendChild(u),this.registerMarkerEvent(u),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var r=this.markerOption.element;return r&&Cf(r),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(r){var o=this;if(!this.added)return this.once("added",function(){o.setElement(r)}),this;var u=this.markerOption.element;return u&&Cf(u),this.markerOption.element=r,this.init(),this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.update(),this}},{key:"openPopup",value:function(){var r=this;if(!this.added)return this.once("added",function(){r.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var r=this;this.added||this.once("added",function(){r.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(r){return this.popup=r,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var r=this.popup;if(r)r.isOpen()?r.remove():r.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(r){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(r){this.markerOption.extData=r}},{key:"update",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.anchor;this.updatePosition(),ti(o,"".concat(Je[u]))}}},{key:"onMapClick",value:function(r){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.offsets,p=this.lngLat,v=p.lng,g=p.lat,E=this.mapsService.getBounds(),A=this.mapsService.lngLatToContainer([v,g]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var P=this.mapsService.getContainer(),F=0,N=0;if(P&&(F=P.scrollWidth,N=P.scrollHeight),Math.abs(E[0][0])>180||Math.abs(E[1][0])>180){if(A.x>F){var V=this.mapsService.lngLatToContainer([v-360,g]);A.x=V.x}if(A.x<0){var Y=this.mapsService.lngLatToContainer([v+360,g]);A.x=Y.x}}(A.x>F||A.x<0||A.y>N||A.y<0)&&(o.style.display="none"),o.style.left=A.x+u[0]+"px",o.style.top=A.y-u[1]+"px"}}}},{key:"init",value:function(){var r=this,o=this.markerOption.element,u=this.markerOption,p=u.color,v=u.anchor;if(!o){this.defaultMarker=!0,o=Qa("div"),this.markerOption.element=o;var g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","48px"),g.setAttributeNS(null,"width","48px"),g.setAttributeNS(null,"viewBox","0 0 1024 1024");var E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),E.setAttributeNS(null,"fill",p),g.appendChild(E),o.appendChild(g)}Dl(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(A){var P,F,N=((P=r.markerOption)===null||P===void 0?void 0:P.style)&&((F=r.markerOption)===null||F===void 0?void 0:F.style[A]);o&&(o.style[A]=N)}),o.addEventListener("click",function(A){r.onMapClick(A)}),o.addEventListener("click",this.eventHandle),Qe(o,v,"marker")}},{key:"registerMarkerEvent",value:function(r){r.addEventListener("mousemove",this.eventHandle),r.addEventListener("click",this.eventHandle),r.addEventListener("mousedown",this.eventHandle),r.addEventListener("mouseup",this.eventHandle),r.addEventListener("dblclick",this.eventHandle),r.addEventListener("contextmenu",this.eventHandle),r.addEventListener("mouseover",this.eventHandle),r.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var r=this.getElement();r.removeEventListener("mousemove",this.eventHandle),r.removeEventListener("click",this.eventHandle),r.removeEventListener("mousedown",this.eventHandle),r.removeEventListener("mouseup",this.eventHandle),r.removeEventListener("dblclick",this.eventHandle),r.removeEventListener("contextmenu",this.eventHandle),r.removeEventListener("mouseover",this.eventHandle),r.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(r){throw new Error("Method not implemented.")}},{key:"onUp",value:function(r){throw new Error("Method not implemented.")}}]),t}(Hs.EventEmitter);function RC(e){var a=LC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function LC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pP=function(e){(0,sn.Z)(t,e);var a=RC(t);function t(i){var r,o;return(0,Lt.Z)(this,t),o=a.call(this),(0,xe.Z)((0,jt.Z)(o),"markers",[]),(0,xe.Z)((0,jt.Z)(o),"points",[]),(0,xe.Z)((0,jt.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,he.merge)(o.getDefault(),i),S(["update"],(0,jt.Z)(o)),o.zoom=((r=o.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99,o}return(0,At.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(r){return this.scene=r,this.mapsService=r.get(nr.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(r){var o=this.markerLayerOption.cluster;if(o&&(this.addPoint(r,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),p=this.mapsService.getBounds();this.bbox=dl(p,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(r)}},{key:"removeMarker",value:function(r){this.markers.indexOf(r);var o=this.markers.indexOf(r);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(r){r.getElement().style.opacity="0"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(r){r.getElement().style.opacity="1"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var r=this.markerLayerOption.cluster;return r?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var r=this;this.getMarkers().forEach(function(o){o.addTo(r.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(r){r.remove()}),this.clusterMarkers.forEach(function(r){r.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(r,o){var u=r.getLnglat(),p=u.lng,v=u.lat,g={geometry:{type:"Point",coordinates:[p,v]},properties:(0,Z.Z)((0,Z.Z)({},r.getExtData()),{},{marker_id:o})};this.points.push(g),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var r=this.markerLayerOption.clusterOption,o=r.radius,u=r.minZoom,p=u===void 0?0:u,v=r.maxZoom;this.clusterIndex=new(Fe())({radius:o,minZoom:p,maxZoom:v}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(r,o){var u=this,p=r[0].concat(r[1]),v=this.clusterIndex.getClusters(p,o);this.clusterMarkers.forEach(function(g){g.remove()}),this.clusterMarkers=[],v.forEach(function(g){var E,A=u.markerLayerOption.clusterOption,P=A.field,F=A.method;if(g.properties&&(E=g.properties)!==null&&E!==void 0&&E.cluster_id){var N,V=u.getLeaves((N=g.properties)===null||N===void 0?void 0:N.cluster_id);if(g.properties.clusterData=V,P&&F){var Y=V==null?void 0:V.map(function(pt){var vt=(0,xe.Z)({},P,pt.properties[P]);return vt}),ie=ho(Y,P),ye=du(F,ie),Pe="point_"+F;g.properties[Pe]=ye.toFixed(2)}}var tt=u.clusterMarker(g);u.clusterMarkers.push(tt),tt.addTo(u.scene)})}},{key:"getLeaves",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return r?this.clusterIndex.getLeaves(r,o,u):null}},{key:"clusterMarker",value:function(r){var o=this.markerLayerOption.clusterOption,u=o,p=u.element,v=p===void 0?this.generateElement.bind(this):p,g=new B_({element:v(r)}).setLnglat({lng:r.geometry.coordinates[0],lat:r.geometry.coordinates[1]});return g}},{key:"normalMarker",value:function(r){var o=r.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService){var r=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(r-this.zoom)>=1||!Cl(this.bbox,o))&&(this.bbox=dl(o,.5),this.zoom=Math.floor(r),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(r){var o=Qa("div","l7-marker-cluster"),u=Qa("div","",o),p=Qa("span","",u),v=this.markerLayerOption.clusterOption,g=v.field,E=v.method;r.properties.point_count=r.properties.point_count||1;var A=g&&E?r.properties["point_"+E]||r.properties[g]:r.properties.point_count;return p.textContent=A,o}}]),t}(Hs.EventEmitter);function OC(e){var a=FC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N_=function(e){(0,sn.Z)(t,e);var a=OC(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this),r.popupOption=(0,Z.Z)((0,Z.Z)({},r.getdefault()),i),S(["update","onClickClose","remove"],(0,jt.Z)(r)),r}return(0,At.Z)(t,[{key:"addTo",value:function(r){var o=this;return this.mapsService=r.get(nr.IMapService),this.sceneSerive=r.get(nr.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=r,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){o.mapsService.on("click",o.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(r){var o=window.document.createDocumentFragment(),u=window.document.createElement("body"),p;for(u.innerHTML=r;p=u.firstChild,!!p;)o.appendChild(p);return this.setDOMContent(o)}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(r){return this.setDOMContent(window.document.createTextNode(r))}},{key:"setMaxWidth",value:function(r){return this.popupOption.maxWidth=r,this.update(),this}},{key:"setDOMContent",value:function(r){return this.createContent(),this.content.appendChild(r),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Cf(this.content),this.content=Qa("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Qa("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(r,o,u){var p=window.document.createElement(r);return o!==void 0&&(p.className=o),u&&u.appendChild(p),p}},{key:"removeDom",value:function(r){r.parentNode&&r.parentNode.removeChild(r)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ie.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(r){r.stopPropagation&&r.stopPropagation(),this.remove()}},{key:"update",value:function(){var r=this,o=this.lngLat,u=this.popupOption,p=u.className,v=u.maxWidth,g=u.anchor;if(!(!this.mapsService||!o||!this.content)){var E=this.mapsService.getMarkerContainer();if(!this.container&&E){this.container=this.creatDom("div","l7-popup",E),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),p&&p.split(" ").forEach(function(P){return r.container.classList.add(P)});var A=this.popupOption.stopPropagation;A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(P){r.container.addEventListener(P,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}v&&this.container.style.maxWidth!==v&&(this.container.style.maxWidth=v),this.updatePosition(),ti(this.container,"".concat(Je[g])),Qe(this.container,g,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.lngLat,o=r.lng,u=r.lat,p=this.popupOption.offsets,v=this.mapsService.lngLatToContainer([o,u]);this.container.style.left=v.x+p[0]+"px",this.container.style.top=v.y-p[1]+"px"}}}]),t}(Hs.EventEmitter);function DC(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}DC(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var _0,ey=(_0={},(0,xe.Z)(_0,Fh.additive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:1,dstAlpha:1}}),(0,xe.Z)(_0,Fh.none,{enable:!1}),(0,xe.Z)(_0,Fh.normal,{enable:!0,func:{srcRGB:q.SRC_ALPHA,dstRGB:q.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,xe.Z)(_0,Fh.subtractive,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE,srcAlpha:q.ZERO,dstAlpha:q.ONE_MINUS_SRC_COLOR},equation:{rgb:q.FUNC_SUBTRACT,alpha:q.FUNC_SUBTRACT}}),(0,xe.Z)(_0,Fh.max,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MAX_EXT}}),(0,xe.Z)(_0,Fh.min,{enable:!0,func:{srcRGB:q.ONE,dstRGB:q.ONE},equation:{rgb:q.MIN_EXT}}),_0),dP=1024;function Zf(e,a,t,i,r){a.updateStyleAttribute(e,t,i,r)}function BC(e,a){e.opacity&&cg("opacity",a,e.opacity),e.strokeWidth&&cg("strokeWidth",a,e.strokeWidth),e.strokeOpacity&&cg("strokeOpacity",a,e.strokeOpacity),e.stroke&&NC("stroke",a,e.stroke),e.offsets&&z_("offsets",a,e.offsets),e.textOffset&&z_("textOffset",a,e.textOffset),e.thetaOffset&&cg("thetaOffset",a,e.thetaOffset)}function cg(e,a,t){(0,he.isString)(t)?Zf(e,a,t,function(i){return i}):(0,he.isNumber)(t)?Zf(e,a,[t],void 0):Array.isArray(t)&&t.length===2?(0,he.isString)(t[0])&&(0,he.isFunction)(t[1])||(0,he.isString)(t[0])&&Array.isArray(t[1])&&(0,he.isNumber)(t[1][0])&&(0,he.isNumber)(t[1][1])?Zf(e,a,t[0],t[1]):Zf(e,a,[1],void 0):Zf(e,a,[1],void 0)}function z_(e,a,t){(0,he.isString)(t)?Zf(e,a,t,function(i){return i}):Array.isArray(t)&&t.length===2&&(0,he.isString)(t[0])&&(0,he.isFunction)(t[1])?Zf(e,a,t[0],t[1]):Array.isArray(t)&&t.length===2&&(0,he.isNumber)(t[0])&&(0,he.isNumber)(t[1])?Zf(e,a,t,void 0):Zf(e,a,[0,0],void 0)}function NC(e,a,t){(0,he.isString)(t)?Zf(e,a,t,void 0):Array.isArray(t)&&t.length===2&&((0,he.isString)(t[0])&&(0,he.isFunction)(t[1])||(0,he.isString)(t[0])&&Array.isArray(t[1])&&t[1].length>0)?Zf(e,a,t[0],t[1]):Zf(e,a,"#fff",void 0)}var Wu;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Wu||(Wu={}));function zC(e,a){var t=[a[0]-e[0],a[1]-e[1]],i=ec(t),r=[e[0]+i[0]*1e-4,e[1]+i[1]*1e-4];return r}function UC(e,a){var t=this;e.length>0&&a.version===Wu["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=Wu["GAODE2.x"],i.originCoordinates=cloneDeep(i.coordinates),i.coordinates=t.mapService.lngLatToCoord(i.coordinates)}):e.filter(function(i){return!i.originCoordinates}).map(function(i){i.version=Wu["GAODE2.x"],i.originCoordinates=cloneDeep(i.coordinates),i.coordinates=t.mapService.lngLatToCoords(i.coordinates)}))}function ZC(e,a){e.length>0&&a.version===Wu.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=VC(t.coordinates,a),t.simpleCoordinate=!0)})}function VC(e,a){if(typeof e[0]=="number")return a.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(r){var o=[];r.map(function(u){o.push(a.simpleMapCoord.unproject(u))}),t.push(o)}),t}else{var i=[];return e.map(function(r){i.push(a.simpleMapCoord.unproject(r))}),i}}function jC(e,a,t){var i;if(!e.scale)return[];var r=(e==null||(i=e.scale)===null||i===void 0?void 0:i.scalers)||[],o=[];r.forEach(function(p){var v,g=p.field;(a.hasOwnProperty(g)||((v=e.scale)===null||v===void 0?void 0:v.type)==="variable")&&o.push(a[g])});var u=e.mapping?e.mapping(o):[];return e.name==="color"&&!z(u[0])?[t]:u}function GC(e,a,t,i,r,o){var u=o==null?void 0:o.getLayerConfig(),p=u.arrow,v=p===void 0?{enable:!1}:p,g=a.map(function(E){var A={id:E._id,coordinates:E.coordinates};if(e.filter(function(N){return N.scale!==void 0}).forEach(function(N){var V=jC(N,E,r);N.needRemapping=!1,N.name==="color"&&(V=V.map(function(Y){return W(Y)})),A[N.name]=Array.isArray(V)&&V.length===1?V[0]:V,N.name==="shape"&&(A.shape=t.getIconFontKey(A[N.name]))}),A.shape==="line"&&v.enable){var P=A.coordinates,F=zC(P[0],P[1]);A.coordinates.splice(1,0,F,F)}return A});return UC(g,i),ZC(g,i),g}function HC(e,a,t,i,r,o){var u=new Bc(r,o),p=e.getBottomColor(),v=i.getLayerStyleAttributes()||[],g=u.data.dataArray,E=g,A=GC(v,E,a,t,p,e);return u.destroy(),A}function U_(e){return e.map(function(a){return typeof a=="string"&&(a=[a,{}]),a})}function Z_(e,a,t,i){var r=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enablePicking,p=o.enableTAA;return p?r.add(i("taa")):r.add(i("render")),U_(a).forEach(function(v){var g=(0,Ir.Z)(v,2),E=g[0],A=g[1];r.add(t(E),A)}),r.add(t("copy")),r}var WC=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function XC(e,a,t){if(typeof a=="string"&&typeof t=="string"&&a!==t){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}WC.map(function(i){if(i.includes(a)&&i.includes(t)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var YC=["passes"],qC=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],V_,ty,j_;function $C(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=KC(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function KC(e,a){if(!!e){if(typeof e=="string")return G_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G_(e,a)}}function G_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function QC(e){var a=JC();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function JC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H_=0,Cd=(V_=Kg(nr.IGlobalConfigService),ty=function(e){(0,sn.Z)(t,e);var a=QC(t);function t(){var i,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Lt.Z)(this,t),i=a.call(this),(0,xe.Z)((0,jt.Z)(i),"id","".concat(H_++)),(0,xe.Z)((0,jt.Z)(i),"name","".concat(H_)),(0,xe.Z)((0,jt.Z)(i),"visible",!0),(0,xe.Z)((0,jt.Z)(i),"zIndex",0),(0,xe.Z)((0,jt.Z)(i),"inited",!1),(0,xe.Z)((0,jt.Z)(i),"layerModelNeedUpdate",!1),(0,xe.Z)((0,jt.Z)(i),"pickedFeatureID",null),(0,xe.Z)((0,jt.Z)(i),"selectedFeatureID",null),(0,xe.Z)((0,jt.Z)(i),"styleNeedUpdate",!1),(0,xe.Z)((0,jt.Z)(i),"clusterZoom",0),(0,xe.Z)((0,jt.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,xe.Z)((0,jt.Z)(i),"hooks",{init:new gt,afterInit:new gt,beforeRender:new gt,beforeRenderData:new ar,afterRender:new Vt,beforePickingEncode:new Vt,afterPickingEncode:new Vt,beforeHighlight:new Vt(["pickedColor"]),afterHighlight:new Vt,beforeSelect:new Vt(["pickedColor"]),afterSelect:new Vt,beforeDestroy:new Vt,afterDestroy:new Vt}),(0,xe.Z)((0,jt.Z)(i),"models",[]),(0,xe.Z)((0,jt.Z)(i),"layerChildren",[]),(0,xe.Z)((0,jt.Z)(i),"masks",[]),(0,xe.Z)((0,jt.Z)(i),"isVector",!1),ya((0,jt.Z)(i),"configService",j_,(0,jt.Z)(i)),(0,xe.Z)((0,jt.Z)(i),"animateOptions",{enable:!1}),(0,xe.Z)((0,jt.Z)(i),"currentPickId",null),(0,xe.Z)((0,jt.Z)(i),"pendingStyleAttributes",[]),(0,xe.Z)((0,jt.Z)(i),"scaleOptions",{}),(0,xe.Z)((0,jt.Z)(i),"aniamateStatus",!1),(0,xe.Z)((0,jt.Z)(i),"bottomColor","rgba(0, 0, 0, 0)"),(0,xe.Z)((0,jt.Z)(i),"isDestroied",!1),(0,xe.Z)((0,jt.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var o=i.getLayerConfig();o&&o.autoFit&&i.fitBounds(o.fitBoundsOptions),i.reRender()}),i.name=r.name||i.id,i.zIndex=r.zIndex||0,i.rawConfig=r,i}return(0,At.Z)(t,[{key:"addMaskLayer",value:function(r){this.masks.push(r)}},{key:"removeMaskLayer",value:function(r){var o=this.masks.indexOf(r);o>-1&&this.masks.splice(o,1),r.destroy()}},{key:"getAttribute",value:function(r){return this.styleAttributeService.getLayerStyleAttribute(r)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(r){var o=this;if(Object.keys(r).map(function(p){p in o.rawConfig&&(o.rawConfig[p]=r[p])}),!this.inited)this.needUpdateConfig=(0,Z.Z)((0,Z.Z)({},this.needUpdateConfig),r);else{var u=this.container.get(nr.SceneID);BC(r,this),this.configService.setLayerConfig(u,this.id,(0,Z.Z)((0,Z.Z)((0,Z.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),r)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(r,o){this.container=r,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(r){this.bottomColor=r}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(r){return this.plugins.push(r),this}},{key:"init",value:function(){var r=this,o=this.container.get(nr.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(nr.IIconService),this.fontService=this.container.get(nr.IFontService),this.rendererService=this.container.get(nr.IRendererService),this.layerService=this.container.get(nr.ILayerService),this.interactionService=this.container.get(nr.IInteractionService),this.pickingService=this.container.get(nr.IPickingService),this.mapService=this.container.get(nr.IMapService);var u=this.getLayerConfig(),p=u.enableMultiPassRenderer,v=u.passes;p&&v!==null&&v!==void 0&&v.length&&v.length>0&&this.mapService.on("mapAfterFrameChange",function(){r.renderLayers()}),this.cameraService=this.container.get(nr.ICameraService),this.coordinateService=this.container.get(nr.ICoordinateSystemService),this.shaderModuleService=this.container.get(nr.IShaderModuleService),this.postProcessingPassFactory=this.container.get(nr.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(nr.IFactoryNormalPass),this.styleAttributeService=this.container.get(nr.IStyleAttributeService),this.multiPassRenderer=this.container.get(nr.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(P){var F=P.attributeName,N=P.attributeField,V=P.attributeValues,Y=P.updateOptions;r.styleAttributeService.updateStyleAttribute(F,{scale:(0,Z.Z)({field:N},r.splitValuesAndCallbackInAttribute(V,r.getLayerConfig()[F]))},Y)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(nr.ILayerPlugin);var g=$C(this.plugins),E;try{for(g.s();!(E=g.n()).done;){var A=E.value;A.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(P){g.e(P)}finally{g.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models.map(function(o){o.updateAttributesAndElements(r.attributes,r.elements)}):console.warn("data error")}},{key:"createModelData",value:function(r,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var p=this.calculateEncodeData(r,o),v=this.triangulation;return p&&v?this.styleAttributeService.createAttributesAndIndices(p,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(r,o){return this.inited?HC(this,this.fontService,this.mapService,this.styleAttributeService,r,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,Z.Z)((0,Z.Z)({},this.getDefaultConfig()),this.rawConfig));var r=this.getLayerConfig(),o=r.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(r,o,u){return this.updateStyleAttribute("color",r,o,u),this}},{key:"texture",value:function(r,o,u){return this.updateStyleAttribute("texture",r,o,u),this}},{key:"rotate",value:function(r,o,u){return this.updateStyleAttribute("rotate",r,o,u),this}},{key:"size",value:function(r,o,u){return this.updateStyleAttribute("size",r,o,u),this}},{key:"filter",value:function(r,o,u){return this.updateStyleAttribute("filter",r,o,u),this}},{key:"shape",value:function(r,o,u){var p,v,g,E=(p=this.styleAttributeService)===null||p===void 0||(v=p.getLayerStyleAttribute("shape"))===null||v===void 0||(g=v.scale)===null||g===void 0?void 0:g.field,A=r;return this.shapeOption={field:r,values:o},this.updateStyleAttribute("shape",r,o,u),this.tileLayer||XC(this,E,A),this}},{key:"label",value:function(r,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:r,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(r){var o={};return(0,he.isObject)(r)?(o.enable=!0,o=(0,Z.Z)((0,Z.Z)({},o),r)):o.enable=r,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(r,o){return r!=null&&r.data?(this.setSource(r),this):(this.sourceOption={data:r,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(r,o){var u=this;return this.inited?this.layerSource.setData(r,o):this.on("inited",function(){var p=u.getSource();p?u.layerSource.setData(r,o):(u.source(new Bc(r,o)),u.sourceEvent())}),this}},{key:"style",value:function(r){var o=this,u=this.getLayerConfig(),p=r.passes,v=(0,bd.Z)(r,YC);return p&&U_(p).forEach(function(g){var E=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(g[0]);E&&E.updateOptions(g[1])}),this.rawConfig=(0,Z.Z)((0,Z.Z)({},this.rawConfig),v),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),u&&u.mask===!0&&r.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(g){o.models=g})),this}},{key:"scale",value:function(r,o){return(0,he.isObject)(r)?this.scaleOptions=(0,Z.Z)((0,Z.Z)({},this.scaleOptions),r):this.scaleOptions[r]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer!==void 0?(this.tileLayer.render(),this):(this.getEncodedData()&&this.getEncodedData().length!==0&&this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var i=(0,Va.Z)(yi().mark(function o(){return yi().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(this.getEncodedData()&&this.getEncodedData().length!==0)){p.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){p.next=6;break}return p.next=4,this.multiPassRenderer.render();case 4:p.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return p.stop()}},o,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"active",value:function(r){var o={};return o.enableHighlight=(0,he.isObject)(r)?!0:r,(0,he.isObject)(r)?(o.enableHighlight=!0,r.color&&(o.highlightColor=r.color),r.mix&&(o.activeMix=r.mix)):o.enableHighlight=!!r,this.updateLayerConfig(o),this}},{key:"setActive",value:function(r,o){var u=this;if((0,he.isObject)(r)){var p=r.x,v=p===void 0?0:p,g=r.y,E=g===void 0?0:g;this.updateLayerConfig({highlightColor:(0,he.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,he.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:v,y:E})}else this.updateLayerConfig({pickedFeatureID:r,highlightColor:(0,he.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,he.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(be(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(r){var o={};return o.enableSelect=(0,he.isObject)(r)?!0:r,(0,he.isObject)(r)?(o.enableSelect=!0,r.color&&(o.selectColor=r.color),r.mix&&(o.selectMix=r.mix)):o.enableSelect=!!r,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(r,o){var u=this;if((0,he.isObject)(r)){var p=r.x,v=p===void 0?0:p,g=r.y,E=g===void 0?0:g;this.updateLayerConfig({selectColor:(0,he.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,he.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:v,y:E})}else this.updateLayerConfig({pickedFeatureID:r,selectColor:(0,he.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,he.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(be(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(r){return this.updateLayerConfig({blend:r}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(r){return this.zIndex=r,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(r){this.currentPickId=r}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(r){this.selectedFeatureID=r}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var r=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,p=o.minZoom,v=p===void 0?-Infinity:p,g=o.maxZoom,E=g===void 0?Infinity:g;return!!u&&r>=v&&r<=E}},{key:"setMultiPass",value:function(r,o){if(this.updateLayerConfig({enableMultiPassRenderer:r}),o&&this.updateLayerConfig({passes:o}),r){var u=this.getLayerConfig(),p=u.passes,v=p===void 0?[]:p;this.multiPassRenderer=Z_(this,v,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var g=this.rendererService.getViewportSize(),E=g.width,A=g.height;this.multiPassRenderer.resize(E,A)}return this}},{key:"setMinZoom",value:function(r){return this.updateLayerConfig({minZoom:r}),this}},{key:"getMinZoom",value:function(){var r=this.getLayerConfig(),o=r.minZoom;return o}},{key:"getMaxZoom",value:function(){var r=this.getLayerConfig(),o=r.maxZoom;return o}},{key:"get",value:function(r){var o=this.getLayerConfig();return o[r]}},{key:"setMaxZoom",value:function(r){return this.updateLayerConfig({maxZoom:r}),this}},{key:"setAutoFit",value:function(r){return this.updateLayerConfig({autoFit:r}),this}},{key:"fitBounds",value:function(r){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,p=u.some(function(v){return Math.abs(v)===Infinity});return p?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],r),this)}},{key:"destroy",value:function(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroied||(this.layerChildren.map(function(u){return u.destroy()}),this.layerChildren=[],this.masks.map(function(u){return u.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("sourceUpdate",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[],this.layerService.cleanRemove(this,o),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var r;this.models.forEach(function(o){return o.destroy()}),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(r){return r.needRescale||r.needRemapping||r.needRegenerateVertices}).length}},{key:"setSource",value:function(r){var o=this;if(this.layerSource&&this.layerSource.off("sourceUpdate",this.sourceEvent),this.layerSource=r,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("sourceUpdate",function(){o.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(r){this.encodedData=r}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(r){return this.styleAttributeService.getLayerAttributeScale(r)}},{key:"getLegendItems",value:function(r){var o=this.styleAttributeService.getLayerAttributeScale(r);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(g){return(0,xe.Z)({value:o.invertExtent(g)},r,g)});return u}else if(o.ticks){var p=o.ticks().map(function(g){return(0,xe.Z)({value:g},r,o(g))});return p}else if(o!=null&&o.domain){var v=o.domain().filter(function(g){return!(0,he.isUndefined)(g)}).map(function(g){return(0,xe.Z)({value:g},r,o(g))});return v}return[]}},{key:"pick",value:function(r){var o=r.x,u=r.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(r,o){this.pickingService.boxPickLayer(this,r,o)}},{key:"buildLayerModel",value:function(r){var o=this,u=r.moduleName,p=r.vertexShader,v=r.fragmentShader,g=r.triangulation,E=r.segmentNumber,A=r.workerEnabled,P=A===void 0?!1:A,F=r.workerOptions,N=(0,bd.Z)(r,qC);this.shaderModuleService.registerModule(u,{vs:p,fs:v});var V=this.shaderModuleService.getModule(u),Y=V.vs,ie=V.fs,ye=V.uniforms,Pe=this.rendererService.createModel;return new Promise(function(tt,pt){if(F&&F.modelType in Kh&&P)o.styleAttributeService.createAttributesAndIndicesAscy(o.encodedData,E,F).then(function(un){var Dn=un.attributes,li=un.elements,Da=Pe((0,Z.Z)({attributes:Dn,uniforms:ye,fs:ie,vs:Y,elements:li,blend:ey[Fh.normal]},N));tt(Da)}).catch(function(un){return pt(un)});else{var vt=o.styleAttributeService.createAttributesAndIndices(o.encodedData,g,E),Xt=vt.attributes,er=vt.elements,wr=vt.count,kr=(0,Z.Z)({attributes:Xt,uniforms:ye,fs:ie,vs:Y,elements:er,blend:ey[Fh.normal]},N);wr&&(kr.count=wr);var Sr=Pe(kr);tt(Sr)}})}},{key:"createAttrubutes",value:function(r){var o=r.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),p=u.attributes;return p}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(r){var o=this.getLayerConfig(),u=o.enableHighlight,p=u===void 0?!0:u,v=o.enableSelect,g=v===void 0?!0:v,E=this.eventNames().indexOf(r)!==-1||this.eventNames().indexOf("un"+r)!==-1;return(r==="click"||r==="dblclick")&&g&&(E=!0),r==="mousemove"&&(p||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(E=!0),this.isVisible()&&E}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var i=(0,Va.Z)(yi().mark(function o(u){return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.render();case 2:case"end":return v.stop()}},o)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"renderModels",value:function(r){var o=this;if(this.getEncodedData()&&this.getEncodedData().length>0){var u;this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(p){o.models=p,o.hooks.beforeRender.call(),o.layerModelNeedUpdate=!1}),this!==null&&this!==void 0&&(u=this.layerModel)!==null&&u!==void 0&&u.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:o.layerModel.getUninforms()},r)})}return this}},{key:"updateStyleAttribute",value:function(r,o,u,p){this.inited?this.styleAttributeService.updateStyleAttribute(r,{scale:(0,Z.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},p):this.pendingStyleAttributes.push({attributeName:r,attributeField:o,attributeValues:u,updateOptions:p})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(r){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(r,o){return{values:(0,he.isFunction)(r)?void 0:r||o,callback:(0,he.isFunction)(r)?r:void 0}}}]),t}(Hs.EventEmitter),j_=ma(ty.prototype,"configService",[V_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ty),W_,ry,X_;function eS(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=tS(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function tS(e,a){if(!!e){if(typeof e=="string")return Y_(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Y_(e,a)}}function Y_(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var Bo=(W_=Kg(nr.IGlobalConfigService),ry=function(){function e(a){(0,Lt.Z)(this,e),ya(this,"configService",X_,this),this.layer=a,this.rendererService=a.getContainer().get(nr.IRendererService),this.pickingService=a.getContainer().get(nr.IPickingService),this.shaderModuleService=a.getContainer().get(nr.IShaderModuleService),this.styleAttributeService=a.getContainer().get(nr.IStyleAttributeService),this.mapService=a.getContainer().get(nr.IMapService),this.iconService=a.getContainer().get(nr.IIconService),this.fontService=a.getContainer().get(nr.IFontService),this.cameraService=a.getContainer().get(nr.ICameraService),this.layerService=a.getContainer().get(nr.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:q.NEAREST,min:q.NEAREST,width:1,height:1}))}return(0,At.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var i=!1;return(0,he.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(i=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,he.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=t.opacity),(0,he.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,he.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,he.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=t.stroke),(0,he.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!(0,he.isNumber)(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!(0,he.isNumber)(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!(0,he.isNumber)(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!(0,he.isNumber)(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return(0,he.isString)(t)?!!(0,R.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var i=W(t);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&(0,he.isNumber)(t[0])&&(0,he.isNumber)(t[1]))}},{key:"patchMod",value:function(t,i){for(var r=0;r<i;r++)t.push(-1)}},{key:"patchData",value:function(t,i,r){var o=eS(r),u;try{for(o.s();!(u=o.n()).done;){var p=u.value,v=p.attr,g=p.count,E=i[v];E!==void 0?v==="stroke"?t.push.apply(t,(0,_e.Z)(W(E))):v==="offsets"?this.isOffsetStatic(E)?t.push(-E[0],E[1]):t.push(0,0):t.push((0,he.isNumber)(E)?E:1):this.patchMod(t,g)}}catch(A){o.e(A)}finally{o.f()}}},{key:"calDataFrame",value:function(t,i,r){for(var o=i.length,u=Math.ceil(o*t/this.DATA_TEXTURE_WIDTH),p=u*this.DATA_TEXTURE_WIDTH,v=[],g=0;g<o;g++){var E=i[g];this.patchData(v,E,r)}for(var A=v.length;A<p;A++)v.push(-1);return{data:v,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),i=t.blend,r=i===void 0?"normal":i;return ey[Fh[r]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(t){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),i=t.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),X_=ma(ry.prototype,"configService",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ry),ny=100,vP=36,mP=40;function q_(e){return e/180*Math.acos(-1)}function $_(e){var a=q_(e[0])+Math.PI/2,t=q_(e[1]),i=ny+Math.random()*.4,r=i*Math.cos(t)*Math.cos(a),o=i*Math.cos(t)*Math.sin(a),u=i*Math.sin(t);return[o,u,r]}function gP(e,a){var t=mat4.create(),i=mat4.create(),r=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);a=a||{},e=typeof e!="undefined"?e:1;for(var u=typeof a.segments!="undefined"?a.segments:32,p=2+u,v=2*p,g=[],E=[],A=[],P=[],F=[],N=[],V=0;V<=p;V++){for(var Y=V/p,ie=Y*Math.PI,ye=0;ye<=v;ye++){var Pe=ye/v,tt=Pe*Math.PI*2;mat4.identity(i),mat4.rotateZ(i,i,-ie),mat4.identity(t),mat4.rotateY(t,t,tt),vec3.transformMat4(o,r,i),vec3.transformMat4(o,o,t),vec3.scale(o,o,-e),A.push(o.slice()),P.push.apply(P,_toConsumableArray(o.slice())),vec3.normalize(o,o),F.push.apply(F,_toConsumableArray(o.slice())),N.push([Pe,1-Y]),P.push(Pe,1-Y)}if(V>0)for(var pt=A.length,vt=pt-2*(v+1);vt+v+2<pt;vt++)g.push([vt,vt+1,vt+v+1]),E.push(vt,vt+1,vt+v+1),g.push([vt+v+1,vt+1,vt+v+2]),E.push(vt+v+1,vt+1,vt+v+2)}return{cells:g,positions:A,uvs:N,positionsArr:P,indicesArr:E,normalArr:F}}var fg=$r.create(),yP=$r.create(),Rl=$r.create(),x0=$r.create(),kv=$r.create();function iy(e,a,t,i,r){$r.add(e,t,i),$r.normalize(e,e),a=$r.fromValues(-e[1],e[0]);var o=$r.fromValues(-t[1],t[0]);return[r/$r.dot(a,o),a]}function b0(e,a){return $r.set(e,-a[1],a[0])}function Pv(e,a,t){return $r.sub(e,a,t),$r.normalize(e,e),e}function ay(e,a){return e[0]===a[0]&&e[1]===a[1]}function _P(e){for(var a=new Map,t=0;t<e.length;t++){var i=e[0].toString()+"-"+e[1].toString();a.get(i)?(e.splice(t,1),t++):a.set(i,i)}return e}var rS=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Lt.Z)(this,e),(0,xe.Z)(this,"lastFlip",-1),(0,xe.Z)(this,"miter",$r.fromValues(0,0)),(0,xe.Z)(this,"started",!1),(0,xe.Z)(this,"dash",!1),(0,xe.Z)(this,"totalDistance",0),(0,xe.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,At.Z)(e,[{key:"simpleExtrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.simpleSegment(i,o,p,v,g);o+=E}if(this.dash)for(var A=0;A<i.positions.length/6;A++)i.positions[A*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,A=t[p-1];A.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var P=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var N=i[p],V=p<t.length-1?[].concat((0,_e.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,Y=p<i.length-1?i[p+1]:null,ie=this.simpleSegment(r,u,A,F,V,P,N,Y);u+=ie}if(this.dash)for(var ye=0;ye<r.positions.length/6;ye++)r.positions[ye*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude_gaode2",value:function(t,i){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,p=1;p<o;p++){var v,g,E,A=t[p-1];A.push((v=i[p-1][2])!==null&&v!==void 0?v:0);var P=i[p-1],F=t[p];F.push((g=i[p][2])!==null&&g!==void 0?g:0);var N=i[p],V=p<t.length-1?[].concat((0,_e.Z)(t[p+1]),[(E=i[p+1][2])!==null&&E!==void 0?E:0]):null,Y=p<i.length-1?i[p+1]:null,ie=this.segment_gaode2(r,u,A,F,V,P,N,Y);u+=ie}if(this.dash)for(var ye=0;ye<r.positions.length/6;ye++)r.positions[ye*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=i.startIndex,u=1;u<r;u++){var p=t[u-1],v=t[u],g=u<t.length-1?t[u+1]:null,E=this.segment(i,o,p,v,g);o+=E}if(this.dash)for(var A=0;A<i.positions.length/6;A++)i.positions[A*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleSegment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,A=Yo([o[0],o[1]]),P=Yo([r[0],r[1]]);Pv(Rl,A,P);var F=0;if(this.dash&&(F=this.lineSegmentDistance(A,P),this.totalDistance+=F),this.normal||(this.normal=$r.create(),b0(this.normal,Rl)),this.started||(this.started=!0,this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-F)),v.push(i+0,i+1,i+2),!u)b0(this.normal,Rl),this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2;else{var N=Yo([u[0],u[1]]);ay(A,N)&&$r.add(N,A,$r.normalize(N,$r.subtract(N,A,P))),Pv(x0,N,A);var V=iy(kv,$r.create(),Rl,x0,this.thickness),Y=(0,Ir.Z)(V,2),ie=Y[0],ye=Y[1],Pe=$r.dot(kv,this.normal)<0?-1:1;this.extrusions(g,E,o,ye,ie,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Pe=-1,$r.copy(this.normal,ye),p+=2,this.lastFlip=Pe}return p}},{key:"segment_gaode2",value:function(t,i,r,o,u,p,v,g){var E=0,A=t.indices,P=t.positions,F=t.normals,N=this.cap==="square",V=this.join==="bevel",Y=Yo([v[0],v[1]]),ie=Yo([p[0],p[1]]);Pv(Rl,o,r);var ye=0;if(this.dash&&(ye=this.lineSegmentDistance(Y,ie),this.totalDistance+=ye),this.normal||(this.normal=$r.create(),b0(this.normal,Rl)),!this.started)if(this.started=!0,N){var Pe=$r.create(),tt=$r.create();$r.add(Pe,this.normal,Rl),$r.add(tt,this.normal,Rl),F.push(tt[0],tt[1],0),F.push(Pe[0],Pe[1],0),P.push(r[0],r[1],r[2]|0,this.totalDistance-ye,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),P.push(r[0],r[1],r[2]|0,this.totalDistance-ye,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(P,F,r,this.normal,this.thickness,this.totalDistance-ye);if(A.push(i+0,i+1,i+2),u){ay(o,u)&&$r.add(u,o,$r.normalize(u,$r.subtract(u,o,r))),Pv(x0,u,o);var Xt=iy(kv,$r.create(),Rl,x0,this.thickness),er=(0,Ir.Z)(Xt,2),wr=er[0],kr=er[1],Sr=$r.dot(kv,this.normal)<0?-1:1,un=V;if(!un&&this.join==="miter"){var Dn=wr;Dn>this.miterLimit&&(un=!0)}un?(F.push(this.normal[0],this.normal[1],0),F.push(kr[0],kr[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Sr,o[2]|0),this.complex.indexes.push(this.currentIndex),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Sr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push.apply(A,(0,_e.Z)(this.lastFlip!==-Sr?[i,i+2,i+3]:[i+2,i+1,i+3])),A.push(i+2,i+3,i+4),b0(fg,x0),$r.copy(this.normal,fg),F.push(this.normal[0],this.normal[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Sr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,E+=3):(this.extrusions(P,F,o,kr,wr,this.totalDistance),A.push.apply(A,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Sr=-1,$r.copy(this.normal,kr),E+=2),this.lastFlip=Sr}else{if(b0(this.normal,Rl),N){var pt=$r.create(),vt=$r.create();$r.sub(vt,Rl,this.normal),$r.add(pt,Rl,this.normal),F.push(vt[0],vt[1],0),F.push(pt[0],pt[1],0),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),P.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(P,F,o,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),E+=2}return E}},{key:"segment",value:function(t,i,r,o,u){var p=0,v=t.indices,g=t.positions,E=t.normals,A=this.cap==="square",P=this.join==="bevel",F=Yo([o[0],o[1]]),N=Yo([r[0],r[1]]);Pv(Rl,F,N);var V=0;if(this.dash&&(V=this.lineSegmentDistance(F,N),this.totalDistance+=V),this.normal||(this.normal=$r.create(),b0(this.normal,Rl)),!this.started)if(this.started=!0,A){var Y=$r.create(),ie=$r.create();$r.add(Y,this.normal,Rl),$r.add(ie,this.normal,Rl),E.push(ie[0],ie[1],0),E.push(Y[0],Y[1],0),g.push(r[0],r[1],r[2]|0,this.totalDistance-V,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),g.push(r[0],r[1],r[2]|0,this.totalDistance-V,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,r,this.normal,this.thickness,this.totalDistance-V);if(v.push(i+0,i+1,i+2),u){var tt=Yo([u[0],u[1]]);ay(F,tt)&&$r.add(tt,F,$r.normalize(tt,$r.subtract(tt,F,N))),Pv(x0,tt,F);var pt=iy(kv,$r.create(),Rl,x0,this.thickness),vt=(0,Ir.Z)(pt,2),Xt=vt[0],er=vt[1],wr=$r.dot(kv,this.normal)<0?-1:1,kr=P;if(!kr&&this.join==="miter"){var Sr=Xt;Sr>this.miterLimit&&(kr=!0)}kr?(E.push(this.normal[0],this.normal[1],0),E.push(er[0],er[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v.push.apply(v,(0,_e.Z)(this.lastFlip!==-wr?[i,i+2,i+3]:[i+2,i+1,i+3])),v.push(i+2,i+3,i+4),b0(fg,x0),$r.copy(this.normal,fg),E.push(this.normal[0],this.normal[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*wr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,p+=3):(this.extrusions(g,E,o,er,Xt,this.totalDistance),v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),wr=-1,$r.copy(this.normal,er),p+=2),this.lastFlip=wr}else{if(b0(this.normal,Rl),A){var ye=$r.create(),Pe=$r.create();$r.sub(Pe,Rl,this.normal),$r.add(ye,Rl,this.normal),E.push(Pe[0],Pe[1],0),E.push(ye[0],ye[1],0),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),g.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(g,E,o,this.normal,this.thickness,this.totalDistance);v.push.apply(v,(0,_e.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),p+=2}return p}},{key:"extrusions",value:function(t,i,r,o,u,p){i.push(o[0],o[1],0),i.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,p,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,p,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,i){var r=i[0]-t[0],o=i[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),rs=fe(77160);function nS(e){var a=e[0][0],t=e[0][e[0].length-1];a[0]===t[0]&&a[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,r=rl().flatten(e),o=r.vertices,u=r.dimensions,p=[],v=[],g=0;g<o.length/u;g++)u===2?p.push(o[g*2],o[g*2+1],1):p.push(o[g*3],o[g*3+1],1);var E=rl()(r.vertices,r.holes,r.dimensions);v.push.apply(v,(0,_e.Z)(E));for(var A=function(N){var V=r.vertices.slice(N*u,(N+1)*u),Y=r.vertices.slice((N+1)*u,(N+2)*u);Y.length===0&&(Y=r.vertices.slice(0,u));var ie=p.length/3;p.push(V[0],V[1],1,Y[0],Y[1],1,V[0],V[1],0,Y[0],Y[1],0),v.push.apply(v,(0,_e.Z)([0,2,1,2,3,1].map(function(ye){return ye+ie})))},P=0;P<i;P++)A(P);return{positions:p,index:v}}function iS(e){var a=rl().flatten(e),t=rl()(a.vertices,a.holes,a.dimensions);return{positions:a.vertices,index:t}}function K_(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],i=e[0][e[0].length-1];t[0]===i[0]&&t[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,o=rl().flatten(e),u=o.vertices,p=o.dimensions,v=[],g=[],E=[],A=0;A<u.length/p;A++)p===2?v.push(u[A*2],u[A*2+1],1,-1,-1):v.push(u[A*3],u[A*3+1],1,-1,-1),E.push(0,0,1);var P=rl()(o.vertices,o.holes,o.dimensions);g.push.apply(g,(0,_e.Z)(P));for(var F=function(Y){var ie=o.vertices.slice(Y*p,(Y+1)*p),ye=o.vertices.slice((Y+1)*p,(Y+2)*p);ye.length===0&&(ye=o.vertices.slice(0,p));var Pe=v.length/5;v.push(ie[0],ie[1],1,0,0,ye[0],ye[1],1,.1,0,ie[0],ie[1],0,0,.8,ye[0],ye[1],0,.1,.8);var tt=aS([ye[0],ye[1],1],[ie[0],ie[1],0],[ie[0],ie[1],1],a);E.push.apply(E,(0,_e.Z)(tt).concat((0,_e.Z)(tt),(0,_e.Z)(tt),(0,_e.Z)(tt))),g.push.apply(g,(0,_e.Z)([1,2,0,3,2,1].map(function(pt){return pt+Pe})))},N=0;N<r;N++)F(N);return{positions:v,index:g,normals:E}}function aS(e,a,t){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=rs.create(),o=rs.create(),u=rs.create();i&&(e=Ju(e),a=Ju(a),t=Ju(t));var p=rs.fromValues.apply(rs,(0,_e.Z)(e)),v=rs.fromValues.apply(rs,(0,_e.Z)(a)),g=rs.fromValues.apply(rs,(0,_e.Z)(t));rs.sub(r,g,v),rs.sub(o,p,v),rs.cross(u,r,o);var E=rs.create();return rs.normalize(E,u),E}var fp,Y0;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Y0||(Y0={}));var q0;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(q0||(q0={}));function ym(e){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,i=[],r=0;r<e;r++)i.push(t*r+a*Math.PI/12);var o=i.map(function(u){var p=Math.sin(u+Math.PI/4),v=Math.cos(u+Math.PI/4);return[p,v,0]});return o}function Q_(){return ym(30)}function J_(){return ym(4)}function e1(){return ym(3)}function t1(){return ym(6,1)}function r1(){return ym(5)}var Rv=(fp={},(0,xe.Z)(fp,q0.CIRCLE,Q_),(0,xe.Z)(fp,q0.HEXAGON,t1),(0,xe.Z)(fp,q0.TRIANGLE,e1),(0,xe.Z)(fp,q0.SQUARE,J_),(0,xe.Z)(fp,q0.PENTAGON,r1),(0,xe.Z)(fp,Y0.CYLINDER,Q_),(0,xe.Z)(fp,Y0.HEXAGONCOLUMN,t1),(0,xe.Z)(fp,Y0.TRIANGLECOLUMN,e1),(0,xe.Z)(fp,Y0.SQUARECOLUMN,J_),(0,xe.Z)(fp,Y0.PENTAGONCOLUMN,r1),fp),hg={};function $0(e){var a=h(e.coordinates);return{vertices:[].concat((0,_e.Z)(a),(0,_e.Z)(a),(0,_e.Z)(a),(0,_e.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function n1(e){var a=h(e.coordinates),t=$_(a);return{vertices:[].concat((0,_e.Z)(t),(0,_e.Z)(t),(0,_e.Z)(t),(0,_e.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function oy(e){var a=e.shape,t=fS(a,!1),i=t.positions,r=t.index,o=t.normals;return{vertices:i,indices:r,normals:o,size:5}}function oS(e){var a=h(e.coordinates);return{vertices:(0,_e.Z)(a),indices:[0],size:a.length}}function K0(e){var a=e.coordinates,t=e.originCoordinates,i=e.version,r=new rS({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var p=0;p<o.length;p++){var v=o[p],g=u[p];r.extrude_gaode2(v,g)}}else{var E=a;E[0]&&!Array.isArray(E[0][0])&&(E=[a]),E.forEach(function(P){r.extrude(P)})}var A=r.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,indexes:A.indexes,size:6}}function sS(e){var a=e.coordinates,t=[],i=uS(a),r=i.results,o=i.totalDistance;return r.map(function(u){t.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:t,indices:[],normals:[],size:6,count:r.length}}function i1(e,a){var t=a[0]-e[0],i=a[1]-e[1];return Math.sqrt(t*t+i*i)}function sy(e,a){return e.length<3&&e.push(0),e.push(a),e}function uS(e){var a=0;if(e.length<2)return{results:e,totalDistance:0};var t=[],i=sy(e[0],a);t.push(i);for(var r=1;r<e.length-1;r++){var o=i1(e[r-1],e[r]);a+=o;var u=sy(e[r],a);t.push(u),t.push(u)}var p=i1(e[e.length-2],e[e.length-1]);return a+=p,t.push(sy(e[e.length-1],a)),{results:t,totalDistance:a}}function _m(e){var a=e.coordinates,t=rl().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:rl()(i,o,r),vertices:i,size:r}}function lS(e){var a=e.coordinates,t=rl().flatten(a),i=t.vertices,r=t.dimensions,o=t.holes;return{indices:rl()(i,o,r),vertices:cS(i),size:r+4}}function cS(e){for(var a=[],t=f(e),i=t.center,r=t.radius,o=0;o<e.length;o+=2){var u=e[o],p=e[o+1];a.push.apply(a,[u,p,0].concat((0,_e.Z)(i),[r]))}return a}function a1(e){var a=e.coordinates,t=K_(a,!0),i=t.positions,r=t.index,o=t.normals;return{vertices:i,indices:r,normals:o,size:5}}function o1(e){var a=e.shape,t=pS(a),i=t.positions,r=t.index;return{vertices:i,indices:r,size:3}}function uy(e){var a=e.coordinates,t=[].concat((0,_e.Z)(a[0]),[0,0,1,a[1][0],a[0][1],0,1,1],(0,_e.Z)(a[1]),[0,1,0],(0,_e.Z)(a[0]),[0,0,1],(0,_e.Z)(a[1]),[0,1,0,a[0][0],a[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:t,indices:i,size:5}}function pg(e,a){for(var t=a||30,i=e.coordinates,r=[],o=[],u=function(g){r.push(g,1,g,i[0][0],i[0][1],i[1][0],i[1][1],g,-1,g,i[0][0],i[0][1],i[1][0],i[1][1]),g!==t-1&&o.push.apply(o,(0,_e.Z)([0,1,2,1,3,2].map(function(E){return g*2+E})))},p=0;p<t;p++)u(p);return{vertices:r,indices:o,size:7}}function s1(e){var a=e.coordinates;a.length===2&&a.push(0);var t=e.size,i=dg(-1,1),r=dg(1,1),o=dg(-1,-1),u=dg(1,-1),p=[].concat((0,_e.Z)(a),(0,_e.Z)(i),(0,_e.Z)(a),(0,_e.Z)(o),(0,_e.Z)(a),(0,_e.Z)(u),(0,_e.Z)(a),(0,_e.Z)(r)),v=[0,1,2,3,0,2];return{vertices:p,indices:v,size:5}}function fS(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(hg&&hg[e])return hg[e];var t=Rv[e]?Rv[e]():Rv.cylinder(),i=K_([t],a);return hg[e]=i,i}function xP(e,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=new Float32Array(e.length/t*3),o,u,p,v=vec3.create(),g=vec3.create(),E=vec3.create(),A=0,P=a.length;A<P;A+=3){o=a[A+0]*3,u=a[A+1]*3,p=a[A+2]*3;var F=[e[o],e[o+1]],N=[e[u],e[u+1]],V=[e[p],e[p+1]];i&&(F=lngLatToMeters(F),N=lngLatToMeters(N),V=lngLatToMeters(V));var Y=F,ie=_slicedToArray(Y,2),ye=ie[0],Pe=ie[1],tt=vec3.fromValues(ye,Pe,e[o+2]),pt=N,vt=_slicedToArray(pt,2),Xt=vt[0],er=vt[1],wr=vec3.fromValues(Xt,er,e[u+2]),kr=V,Sr=_slicedToArray(kr,2),un=Sr[0],Dn=Sr[1],li=vec3.fromValues(un,Dn,e[p+2]);vec3.sub(v,li,wr),vec3.sub(g,tt,wr),vec3.cross(E,v,g),r[o]+=v[0],r[o+1]+=v[1],r[o+2]+=v[2],r[u]+=v[0],r[u+1]+=v[1],r[u+2]+=v[2],r[p]+=v[0],r[p+1]+=v[1],r[p+2]+=v[2]}return hS(r),r}function hS(e){for(var a=0,t=e.length;a<t;a+=3){var i=vec3.fromValues(e[a],e[a+1],e[a+2]),r=vec3.create();vec3.normalize(r,i),e.set(r,a)}}function bP(e){var a=e[0][0],t=e[0][e[0].length-1];return a[0]===t[0]&&a[1]===t[1]}function pS(e){var a=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=Rv[e]?Rv[e]():Rv.circle(),i=a.indexOf(e)===-1?iS([t]):nS([t]);return i}function dg(e,a){var t=(e+1)/2,i=(a+1)/2;return[t,i]}function EP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,i=e.normalArr;return{vertices:a,indices:t,size:5,normals:i}}function CP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,i=e.normalArr;return{vertices:a,indices:t,size:5,normals:i}}function dS(e){var a=vS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function vS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,gS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,yS=function(e){(0,sn.Z)(t,e);var a=dS(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.baseColor,v=p===void 0?"rgb(16,16,16)":p,g=r.brightColor,E=g===void 0?"rgb(255,176,38)":g,A=r.windowColor,P=A===void 0?"rgb(30,60,89)":A,F=r.time,N=F===void 0?0:F,V=r.sweep,Y=V===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:V;return{u_cityCenter:Y.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*Y.sweepRadius,u_circleSweep:Y.enable?1:0,u_circleSweepColor:W(Y.sweepColor).slice(0,3),u_circleSweepSpeed:Y.sweepSpeed,u_opacity:u,u_baseColor:W(v),u_brightColor:W(E),u_windowColor:W(P),u_time:this.layer.getLayerAnimateTime()||N}}},{key:"calCityGeo",value:function(){var r=(0,Ir.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(p+o)/2,(v+u)/2]);var g=this.mapService.lngLatToCoord([p,v]),E=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(g[0]-E[0],2)+Math.pow(g[1]-E[1],2))/4}else{var A=p-o,P=v-u;this.cityCenter=[(p+o)/2,(v+u)/2],this.cityMinSize=Math.sqrt(Math.pow(A,2)+Math.pow(P,2))/4}}},{key:"initModels",value:function(r){this.calCityGeo(),this.startModelAnimate(),this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:gS,fragmentShader:mS,triangulation:a1,depth:{enable:!0},cull:{enable:!0,face:q.BACK}}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?10:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){var g=o.size;return[p[3],p[4]]}}})}}]),t}(Bo);function _S(e){var a=xS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function xS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bS=function(e){(0,sn.Z)(t,e);var a=_S(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","CityBuildingLayer"),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this;this.layerModel=new yS(this),this.layerModel.initModels(function(o){r.models=o,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"setLight",value:function(r){this.updateLayerConfig({time:r})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Cd);function ES(e){var a=CS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function CS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,AS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,wS=function(e){(0,sn.Z)(t,e);var a=ES(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:SS,fragmentShader:AS,triangulation:o1,primitive:q.TRIANGLES,depth:{enable:!1},stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(Bo);function TS(e){var a=MS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,kS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,PS=function(e){(0,sn.Z)(t,e);var a=TS(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:IS,fragmentShader:kS,triangulation:oy,primitive:q.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){var g=o.size;return Array.isArray(g)?[g[0]]:[g]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(Bo);function RS(e,a){for(var t=[],i=[],r=[],o=e+1,u=a+1,p=e/2,v=a/2,g=0;g<u;g++)for(var E=g-v,A=0;A<o;A++){var P=A-p;i.push(P/p,-E/v,0),r.push(A/e),r.push(1-g/a)}for(var F=0;F<a;F++)for(var N=0;N<e;N++){var V=N+o*F,Y=N+o*(F+1),ie=N+1+o*(F+1),ye=N+1+o*F;t.push(V,Y,ye),t.push(Y,ie,ye)}return{vertices:i,indices:t,uvs:r}}var u1,l1;function LS(e){var a=OS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,DS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,BS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,NS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,zS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,US=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,c1=(u1=(0,Nn.b2)(),u1(l1=function(e){(0,sn.Z)(t,e);var a=LS(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"render",value:function(){var r=this,o=this.rendererService,u=o.clear,p=o.useFramebuffer;p(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:r.heatmapFramerBuffer}),r.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var i=(0,Va.Z)(yi().mark(function o(u){var p,v,g,E,A,P,F,N,V,Y,ie,ye;return yi().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return v=this.rendererService,g=v.createFramebuffer,E=v.clear,A=v.getViewportSize,P=v.createTexture2D,F=v.useFramebuffer,N=this.styleAttributeService.getLayerStyleAttribute("shape"),V=(N==null||(p=N.scale)===null||p===void 0?void 0:p.field)||"heatmap",this.shapeType=V,tt.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=tt.sent,this.colorModel=V==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),Y=A(),ie=Y.width,ye=Y.height,this.heatmapFramerBuffer=g({color:P({width:Math.floor(ie/4),height:Math.floor(ye/4),wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),depth:!1}),this.updateColorTexture(),u([this.intensityModel,this.colorModel]);case 12:case"end":return tt.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Gn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return[E]}}})}},{key:"buildHeatMapIntensity",value:function(){var i=(0,Va.Z)(yi().mark(function o(){var u;return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.layer.triangulation=s1,v.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:US,fragmentShader:zS,triangulation:s1,depth:{enable:!1},cull:{enable:!0,face:Lf(this.mapService.version)},blend:{enable:!0,func:{srcRGB:q.ONE,srcAlpha:1,dstRGB:q.ONE,dstAlpha:1}}});case 3:return u=v.sent,v.abrupt("return",u);case 5:case"end":return v.stop()}},o,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"buildHeatmapColor",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,p=r.maskInside,v=p===void 0?!0:p;this.shaderModuleService.registerModule("heatmapColor",{vs:NS,fs:BS});var g=this.shaderModuleService.getModule("heatmapColor"),E=g.vs,A=g.fs,P=g.uniforms,F=this.rendererService,N=F.createAttribute,V=F.createElements,Y=F.createBuffer,ie=F.createModel;return ie({vs:E,fs:A,attributes:{a_Position:N({buffer:Y({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:q.FLOAT}),size:3}),a_Uv:N({buffer:Y({data:[0,1,1,1,0,0,1,0],type:q.FLOAT}),size:2})},uniforms:(0,Z.Z)({},P),depth:{enable:!1},blend:this.getBlend(),count:6,elements:V({data:[0,2,1,2,3,1],type:q.UNSIGNED_INT,count:6}),stencil:nt(u,v)})}},{key:"drawIntensityMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,p=o.intensity,v=p===void 0?10:p,g=o.radius,E=g===void 0?5:g;(r=this.intensityModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_radius:E,u_intensity:v}})}},{key:"drawColorMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity;(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,p=ko();ts(p,this.cameraService.getViewProjectionMatrixUncentered()),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,_e.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,p=r.maskInside,v=p===void 0?!0:p,g=this.rendererService.getViewportSize,E=g(),A=E.width,P=E.height,F=RS(A/4,P/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:DS,fs:FS});var N=this.shaderModuleService.getModule("heatmap3dColor"),V=N.vs,Y=N.fs,ie=N.uniforms,ye=this.rendererService,Pe=ye.createAttribute,tt=ye.createElements,pt=ye.createBuffer,vt=ye.createModel;return vt({vs:V,fs:Y,attributes:{a_Position:Pe({buffer:pt({data:F.vertices,type:q.FLOAT}),size:3}),a_Uv:Pe({buffer:pt({data:F.uvs,type:q.FLOAT}),size:2})},primitive:q.TRIANGLES,uniforms:(0,Z.Z)({},ie),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:q.SRC_ALPHA,srcAlpha:1,dstRGB:q.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:tt({data:F.indices,type:q.UNSIGNED_INT,count:F.indices.length}),stencil:nt(u,v)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var r=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,p=Se(u);this.colorTexture=r({data:new Uint8Array(p.data),width:p.width,height:p.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1})}}]),t}(Bo))||l1);function ZS(e){var a=VS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,GS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,HS=function(e){(0,sn.Z)(t,e);var a=ZS(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,p=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:p||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:GS,fragmentShader:jS,triangulation:o1,depth:{enable:!1},primitive:q.TRIANGLES,blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u){var p=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[p[0],p[1],0]}}})}}]),t}(Bo),WS={heatmap:c1,heatmap3d:c1,grid:wS,grid3d:PS,hexagon:HS},XS=WS;function YS(e){var a=qS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function qS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $S=function(e){(0,sn.Z)(t,e);var a=YS(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","HeatMapLayer"),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new XS[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"renderModels",value:function(){var r=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels(function(u){return r.models=u}),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){return u.draw({uniforms:r.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models[0].updateAttributesAndElements(r.attributes,r.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),p=u.shape3d,v=this.getSource(),g=v.data.type,E=(o==null||(r=o.scale)===null||r===void 0?void 0:r.field)||"heatmap";return E==="heatmap"||E==="heatmap3d"?"heatmap":g==="hexagon"?(p==null?void 0:p.indexOf(E))===-1?"hexagon":"grid3d":g==="grid"?(p==null?void 0:p.indexOf(E))===-1?"grid":"grid3d":"heatmap"}}]),t}(Cd);function KS(e){var a=QS();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function QS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,eA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,tA=function(e){(0,sn.Z)(t,e);var a=KS(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.clampLow,p=u===void 0?!0:u,v=r.clampHigh,g=v===void 0?!0:v,E=r.noDataValue,A=E===void 0?-9999999:E,P=r.domain,F=P===void 0?[0,1]:P,N=r.rampColors,V=r.pixelConstant,Y=V===void 0?0:V,ie=r.pixelConstantR,ye=ie===void 0?256*256:ie,Pe=r.pixelConstantG,tt=Pe===void 0?256:Pe,pt=r.pixelConstantB,vt=pt===void 0?1:pt,Xt=r.pixelConstantRGB,er=Xt===void 0?.1:Xt;return(0,he.isEqual)(this.rampColors,N)||(this.updateColorTexure(),this.rampColors=N),{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:Y,u_pixelConstantR:ye,u_pixelConstantG:tt,u_pixelConstantB:vt,u_pixelConstantRGB:er,u_domain:F,u_clampLow:p,u_clampHigh:typeof g!="undefined"?g:p,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),p=u.mask,v=p===void 0?!1:p,g=u.maskInside,E=g===void 0?!0:g,A=u.rampColorsData,P=u.rampColors,F=this.layer.getSource(),N=this.rendererService.createTexture2D;if(this.texture=N({height:0,width:0}),Us){var V=this.layerService.sceneService.getSceneConfig().canvas,Y=V.createImage();Y.crossOrigin="anonymous",Y.src=F.data.originData,Y.onload=function(){o.texture=N({data:Y,width:Y.width,height:Y.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else F.data.images.then(function(ye){o.texture=N({data:ye[0],width:ye[0].width,height:ye[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});var ie=A||Se(P);this.colorTexture=N({data:ie.data,width:ie.width,height:ie.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:eA,fragmentShader:JS,triangulation:uy,primitive:q.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:nt(v,E)}).then(function(ye){r([ye])}).catch(function(ye){console.warn(ye),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,p=Se(u);this.colorTexture=r({data:p.data,width:p.width,height:p.height,flipY:!1})}}]),t}(Bo);function rA(e){var a=nA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function nA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,aA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,oA=function(e){(0,sn.Z)(t,e);var a=rA(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),p=u.mask,v=p===void 0?!1:p,g=u.maskInside,E=g===void 0?!0:g,A=this.layer.getSource(),P=this.rendererService.createTexture2D;if(this.texture=P({height:0,width:0}),Us){var F=this.layerService.sceneService.getSceneConfig().canvas,N=F.createImage();N.crossOrigin="anonymous",N.src=A.data.originData,N.onload=function(){o.texture=P({data:N,width:N.width,height:N.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else A.data.images.then(function(V){o.texture=P({data:V[0],width:V[0].width,height:V[0].height,mag:q.LINEAR,min:q.LINEAR}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:aA,fragmentShader:iA,triangulation:uy,primitive:q.TRIANGLES,blend:{enable:!1},depth:{enable:!1},stencil:nt(v,E)}).then(function(V){r([V])}).catch(function(V){console.warn(V),r([])})}},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}}]),t}(Bo),sA={image:oA,dataImage:tA},uA=sA;function lA(e){var a=cA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function cA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f1=function(e){(0,sn.Z)(t,e);var a=lA(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","ImageLayer"),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new uA[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={image:{},dataImage:{}};return o[r]}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="dataImage"?"dataImage":(u==="image","image")}}]),t}(Cd);function fA(e){var a=hA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function hA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pA=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,dA=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,vA=function(e){(0,sn.Z)(t,e);var a=fA(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?0:o;return{u_opacity:(0,he.isNumber)(u)?u:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var i=(0,Va.Z)(yi().mark(function o(u){return yi().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:dA,fragmentShader:pA,triangulation:_m,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:q.ALWAYS,ref:1,mask:255},opFront:{fail:q.REPLACE,zfail:q.REPLACE,zpass:q.REPLACE}}}).then(function(g){u([g])}).catch(function(g){console.warn(g),u([])});case 1:case"end":return v.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Bo),mA={fill:vA},gA=mA;function yA(e){var a=_A();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function _A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h1=function(e){(0,sn.Z)(t,e);var a=yA(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","MaskLayer"),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new gA[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),t}(Cd);function p1(e,a){a.map(function(t){var i=Qg(e.sceneContainer);t.setContainer(i,e.sceneContainer),t.init()})}function d1(e,a){var t,i=a.getAttribute("shape");if(i&&(t=i.scale)!==null&&t!==void 0&&t.field){var r;return((r=i.scale)===null||r===void 0?void 0:r.values)==="text"?[i.scale.field,i.scale.values]:i.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function xA(e,a){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return a;default:return a}}function bA(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function EA(e,a,t,i){var r,o,u,p,v=(e==null||(r=e.bboxPolygon)===null||r===void 0?void 0:r.bbox)||[0,0,10,-10],g=(0,Ir.Z)(v,4),E=g[0],A=E===void 0?0:E,P=g[1],F=P===void 0?0:P,N=g[2],V=N===void 0?10:N,Y=g[3],ie=Y===void 0?-10:Y,ye=a.lngLatToContainer([A,F]),Pe=a.lngLatToContainer([V,ie]),tt=Pe.x-ye.x,pt=ye.y-Pe.y,vt=[(t-ye.x)/tt,(i-Pe.y)/pt],Xt=(e==null||(o=e.data)===null||o===void 0?void 0:o.width)||1,er=(e==null||(u=e.data)===null||u===void 0?void 0:u.height)||1,wr=Math.floor(vt[0]*Xt),kr=Math.floor(vt[1]*er),Sr=Math.max(0,kr-1)*Xt+wr,un=e==null||(p=e.data)===null||p===void 0?void 0:p.data[Sr];return un}function SP(e,a,t){var i=t.readPixels,r=t.getContainer,o=e*DOM.DPR,u=a*DOM.DPR,p=bA(r()),v=p.width,g=p.height;if(v*=DOM.DPR,g*=DOM.DPR,o>v-1*DOM.DPR||o<0||u>g-1*DOM.DPR||u<0)return!1;var E=i({x:Math.floor(o),y:Math.floor(g-(a+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return E}function CA(e){var a=SA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function SA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AA=`#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6


  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,wA=`
attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform vec2 u_tileOrigin;
uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }
} else {
  vec2 pointPos = a_Position.xy;
  vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  tileWorld.xy += pointOffset;

  tileWorld.xy += offset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    tileWorld.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);


}
`,ly=function(e){(0,sn.Z)(t,e);var a=CA(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.textureBlend,v=p===void 0?"normal":p,g=r.lineTexture,E=g===void 0?!1:g,A=r.iconStep,P=A===void 0?100:A,F=r.vertexHeightScale,N=F===void 0?20:F,V=r.borderWidth,Y=V===void 0?0:V,ie=r.borderColor,ye=ie===void 0?"#ccc":ie,Pe=r.heightfixed,tt=Pe===void 0?!1:Pe,pt=r.arrow,vt=pt===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:pt,Xt=r.coord,er=Xt===void 0?"lnglat":Xt,wr=r.tileOrigin;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var kr=this.layer.getEncodedData(),Sr=this.calDataFrame(this.cellLength,kr,this.cellProperties),un=Sr.data,Dn=Sr.width,li=Sr.height;this.rowCount=li,this.dataTexture=this.cellLength>0&&un.length>0?this.createTexture2D({flipY:!0,data:un,format:q.LUMINANCE,type:q.FLOAT,width:Dn,height:li}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_tileOrigin:wr||[0,0],u_coord:er==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_textureBlend:v==="normal"?0:1,u_texture:this.texture,u_line_texture:E?1:0,u_icon_step:P,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Y,u_borderColor:W(ye),u_heightfixed:Number(tt),u_vertexScale:N,u_arrow:Number(vt.enable),u_arrowHeight:vt.arrowHeight||3,u_arrowWidth:vt.arrowWidth||2,u_tailWidth:vt.tailWidth===void 0?1:vt.tailWidth}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=(0,Va.Z)(yi().mark(function o(u){var p,v,g,E,A,P,F;return yi().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,A=E===void 0?!0:E,P=p.depth,F=P===void 0?!1:P,this.layer.triangulation=K0,this.layer.buildLayerModel({moduleName:"lineTile",vertexShader:wA,fragmentShader:AA,triangulation:K0,blend:this.getBlend(),depth:{enable:F},stencil:nt(g,A)}).then(function(Y){u([Y])}).catch(function(Y){console.warn(Y),u([])});case 3:case"end":return V.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g,E,A){return A===void 0?[v[3],10]:[v[3],A]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.texture,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}})}}]),t}(Bo);function TA(e){var a=MA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function MA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IA=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,kA=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,v1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,m1=function(e){(0,sn.Z)(t,e);var a=TA(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.vertexHeightScale,E=g===void 0?20:g,A=0,P=[0,0,0,0],F=[0,0,0,0];if(p&&v&&(P=W(p),F=W(v),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var N=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,N,this.cellProperties),Y=V.data,ie=V.width,ye=V.height;this.rowCount=ye,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:q.LUMINANCE,type:q.FLOAT,width:ie,height:ye}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_linearColor:A,u_sourceColor:P,u_targetColor:F,u_vertexScale:E}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:kA,vert:v1,type:"lineSimpleLinear"}:{frag:IA,vert:v1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=this.getShaders(),A=E.frag,P=E.vert,F=E.type;this.layer.buildLayerModel({moduleName:F,vertexShader:P,fragmentShader:A,triangulation:sS,primitive:q.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:nt(p,g)}).then(function(N){r([N])}).catch(function(N){console.warn(N),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Gn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){return[p[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}})}}]),t}(Bo);function PA(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=RA(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function RA(e,a){if(!!e){if(typeof e=="string")return g1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return g1(e,a)}}function g1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}var LA=function(){function e(a,t,i){(0,Lt.Z)(this,e),(0,xe.Z)(this,"boxCells",[]);var r=this.boxCells;this.xCellCount=Math.ceil(a/i),this.yCellCount=Math.ceil(t/i);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=a,this.height=t,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,At.Z)(e,[{key:"insert",value:function(t,i,r,o,u){this.forEachCell(i,r,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(t,i,r,o,u){return this.queryHitTest(t,i,r,o,!1,u)}},{key:"hitTest",value:function(t,i,r,o,u){return this.queryHitTest(t,i,r,o,!0,u)}},{key:"insertBoxCell",value:function(t,i,r,o,u,p){this.boxCells[u].push(p)}},{key:"queryHitTest",value:function(t,i,r,o,u,p){if(r<0||t>this.width||o<0||i>this.height)return u?!1:[];var v=[];if(t<=0&&i<=0&&this.width<=r&&this.height<=o){if(u)return!0;for(var g=0;g<this.boxKeys.length;g++)v.push({key:this.boxKeys[g],x1:this.bboxes[g*4],y1:this.bboxes[g*4+1],x2:this.bboxes[g*4+2],y2:this.bboxes[g*4+3]});return p?v.filter(p):v}var E={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,i,r,o,this.queryCell,v,E,p),u?v.length>0:v}},{key:"queryCell",value:function(t,i,r,o,u,p,v,g){var E=v.seenUids,A=this.boxCells[u];if(A!==null){var P=this.bboxes,F=PA(A),N;try{for(F.s();!(N=F.n()).done;){var V=N.value;if(!E.box[V]){E.box[V]=!0;var Y=V*4;if(t<=P[Y+2]&&i<=P[Y+3]&&r>=P[Y+0]&&o>=P[Y+1]&&(!g||g(this.boxKeys[V]))){if(v.hitTest)return p.push(!0),!0;p.push({key:this.boxKeys[V],x1:P[Y],y1:P[Y+1],x2:P[Y+2],y2:P[Y+3]})}}}}catch(ie){F.e(ie)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(t,i,r,o,u,p,v,g){for(var E=this.convertToXCellCoord(t),A=this.convertToYCellCoord(i),P=this.convertToXCellCoord(r),F=this.convertToYCellCoord(o),N=E;N<=P;N++)for(var V=A;V<=F;V++){var Y=this.xCellCount*V+N;if(u.call(this,t,i,r,o,Y,p,v,g))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),OA=LA,FA=function(){function e(a,t){(0,Lt.Z)(this,e),(0,xe.Z)(this,"viewportPadding",100),this.width=a,this.height=t,this.viewportPadding=Math.max(a,t),this.grid=new OA(a+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=a+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=a+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,At.Z)(e,[{key:"placeCollisionBox",value:function(t){var i=t.x1+t.anchorPointX+this.viewportPadding,r=t.y1+t.anchorPointY+this.viewportPadding,o=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,r,o,u)||this.grid.hitTest(i,r,o,u)?{box:[]}:{box:[i,r,o,u]}}},{key:"insertCollisionBox",value:function(t,i){var r={featureIndex:i};this.grid.insert(r,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,i,r){var o=P0(i,r,0,1),u=zd(),p=ys.apply(We,(0,_e.Z)(t));return zf(u,o,p),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,i,r,o){return r>=0&&t<this.gridRightBoundary&&o>=0&&i<this.gridBottomBoundary}}]),e}();function y1(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=DA(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function DA(e,a){if(!!e){if(typeof e=="string")return _1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _1(e,a)}}function _1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function x1(e){var a=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0;break;default:a=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:a,verticalAlign:t}}function b1(e,a,t,i,r){if(!!r){var o=e[i],u=o.glyph;if(u)for(var p=a[u].advance*o.scale,v=(e[i].x+p)*r,g=t;g<=i;g++)e[g].x-=v}}function E1(e,a,t,i,r,o,u){var p=(a-t)*r,v=(-i*u+.5)*o,g=y1(e),E;try{for(g.s();!(E=g.n()).done;){var A=E.value;A.x+=p,A.y+=v}}catch(P){g.e(P)}finally{g.f()}}function BA(e,a,t,i,r,o,u){var p=-8,v=0,g=p,E=0,A=e.positionedGlyphs,P=o==="right"?1:o==="left"?0:.5,F=A.length;t.forEach(function(ye){if(ye.split("").forEach(function(tt){var pt=a[tt],vt=0;pt&&(A.push({glyph:tt,x:v,y:g+vt,vertical:!1,scale:1,metrics:pt}),v+=pt.advance+u)}),A.length!==F){var Pe=v-u;E=Math.max(Pe,E),b1(A,a,F,A.length-1,P)}v=0,g-=i+5});var N=x1(r),V=N.horizontalAlign,Y=N.verticalAlign;E1(A,P,V,Y,E,i,t.length);var ie=g-p;e.top+=-Y*ie,e.bottom=e.top-ie,e.left+=-V*E,e.right=e.left+E}function NA(e,a,t,i,r,o,u){var p=-8,v=0,g=p,E=0,A=e.positionedGlyphs,P=o==="right"?1:o==="left"?0:.5,F=A.length;t.forEach(function(ye){var Pe=a[ye],tt=0;if(Pe&&(A.push({glyph:ye,x:Pe.advance/2,y:g+tt,vertical:!1,scale:1,metrics:Pe}),v+=Pe.advance+u),A.length!==F){var pt=v-u;E=Math.max(pt,E),b1(A,a,F,A.length-1,P)}v=0,g-=i+5});var N=x1(r),V=N.horizontalAlign,Y=N.verticalAlign;E1(A,P,V,Y,E,i,t.length);var ie=g-p;e.top+=-Y*ie,e.bottom=e.top-ie,e.left+=-V*E,e.right=e.left+E}function zA(e,a,t,i,r,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],p=arguments.length>7?arguments[7]:void 0,v=e.split(`
`),g=[],E={positionedGlyphs:g,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:v.length,text:e};return p?NA(E,a,v,t,i,r,o):BA(E,a,v,t,i,r,o),g.length?E:!1}function UA(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,r=i===void 0?[]:i,o=[],u=y1(r),p;try{for(u.s();!(p=u.n()).done;){var v=p.value,g=v.metrics,E=4,A=g.advance*v.scale/2,P=t?[v.x+A,v.y]:[0,0],F=t?[0,0]:[v.x+A+a[0],v.y+a[1]],N=(0-E)*v.scale-A+F[0],V=(0-E)*v.scale+F[1],Y=N+g.width*v.scale,ie=V+g.height*v.scale,ye={x:N,y:V},Pe={x:Y,y:V},tt={x:N,y:ie},pt={x:Y,y:ie};o.push({tl:ye,tr:Pe,bl:tt,br:pt,tex:g,glyphOffset:P})}}catch(vt){u.e(vt)}finally{u.f()}return o}function ZA(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=VA(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function VA(e,a){if(!!e){if(typeof e=="string")return C1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return C1(e,a)}}function C1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function jA(e){var a=GA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function GA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,A1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function w1(e){var a=this,t=e.id,i=[],r=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[t].glyphQuads.forEach(function(p,v){i.push.apply(i,(0,_e.Z)(u).concat([p.tex.x,p.tex.y+p.tex.height,p.tl.x,p.tl.y],(0,_e.Z)(u),[p.tex.x+p.tex.width,p.tex.y+p.tex.height,p.tr.x,p.tr.y],(0,_e.Z)(u),[p.tex.x+p.tex.width,p.tex.y,p.br.x,p.br.y],(0,_e.Z)(u),[p.tex.x,p.tex.y,p.bl.x,p.bl.y])),r.push(0+v*4,1+v*4,2+v*4,2+v*4,3+v*4,0+v*4)}),{vertices:i,indices:r,size:7}}var cy=function(e){(0,sn.Z)(t,e);var a=jA(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"glyphInfoMap",{}),(0,xe.Z)((0,jt.Z)(i),"currentZoom",-1),(0,xe.Z)((0,jt.Z)(i),"textureHeight",0),(0,xe.Z)((0,jt.Z)(i),"textCount",0),(0,xe.Z)((0,jt.Z)(i),"preTextStyle",{}),(0,xe.Z)((0,jt.Z)(i),"buildModels",function(){var p=(0,Va.Z)(yi().mark(function v(g){var E,A,P,F,N;return yi().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:E=i.layer.getLayerConfig(),A=E.mask,P=A===void 0?!1:A,F=E.maskInside,N=F===void 0?!0:F,i.mapping(),i.layer.buildLayerModel({moduleName:"pointText",vertexShader:A1,fragmentShader:S1,triangulation:w1.bind((0,jt.Z)(i)),depth:{enable:!1},blend:i.getBlend(),stencil:nt(P,N)}).then(function(ie){g([ie])}).catch(function(ie){console.warn(ie),g([])});case 3:case"end":return Y.stop()}},v)}));return function(v){return p.apply(this,arguments)}}()),(0,xe.Z)((0,jt.Z)(i),"mapping",function(){i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel()}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.stroke,v=p===void 0?"#fff":p,g=r.strokeWidth,E=g===void 0?0:g,A=r.textAnchor,P=A===void 0?"center":A,F=r.textAllowOverlap,N=F===void 0?!1:F,V=r.halo,Y=V===void 0?.5:V,ie=r.gamma,ye=ie===void 0?2:ie,Pe=r.raisingHeight,tt=Pe===void 0?0:Pe,pt=this.fontService,vt=pt.canvas,Xt=pt.mapping;if(Object.keys(Xt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Xt).length),this.preTextStyle={textAnchor:P,textAllowOverlap:N},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:E,stroke:v})){this.judgeStyleAttributes({opacity:u,strokeWidth:E,stroke:v});var er=this.layer.getEncodedData(),wr=this.calDataFrame(this.cellLength,er,this.cellProperties),kr=wr.data,Sr=wr.width,un=wr.height;this.rowCount=un,this.dataTexture=this.cellLength>0&&kr.length>0?this.createTexture2D({flipY:!0,data:kr,format:q.LUMINANCE,type:q.FLOAT,width:Sr,height:un}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(tt),u_opacity:(0,he.isNumber)(u)?u:1,u_stroke_width:(0,he.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(v),u_sdf_map:this.texture,u_halo_blur:Y,u_gamma_scale:ye,u_sdf_map_size:[vt.width,vt.height]}}},{key:"initModels",value:function(r){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,p=u===void 0?"center":u,v=o.textAllowOverlap,g=v===void 0?!0:v;this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels(r)}},{key:"needUpdate",value:function(){var r=this.layer.getLayerConfig(),o=r.textAllowOverlap,u=o===void 0?!1:o,p=this.mapService.getZoom(),v=this.mapService.getBounds(),g=Cl(this.extent,v);return!u&&(Math.abs(this.currentZoom-p)>1||!g)||u!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Gn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){var g=o.rotate,E=g===void 0?0:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Gn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){return[p[5],p[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?12:g;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Gn.Attribute,descriptor:{name:"a_tex",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return dl(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,p=r.fontFamily,v=p===void 0?"sans-serif":p,g=this.layer.getEncodedData(),E=[];g.forEach(function(A){var P=A.shape,F=P===void 0?"":P;F=F.toString();var N=ZA(F),V;try{for(N.s();!(V=N.n()).done;){var Y=V.value;E.indexOf(Y)===-1&&E.push(Y)}}catch(ie){N.e(ie)}finally{N.f()}}),this.fontService.setFontOptions({characterSet:E,fontWeight:u,fontFamily:v,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,p=r.fontFamily,v=p===void 0?"sans-serif":p,g=this.layer.getEncodedData(),E=[];g.forEach(function(A){var P=A.shape,F=P===void 0?"":P;F="".concat(F),E.indexOf(F)===-1&&E.push(F)}),this.fontService.setFontOptions({characterSet:E,fontWeight:u,fontFamily:v,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,p=this.layer.getLayerConfig(),v=p.spacing,g=v===void 0?2:v,E=p.textAnchor,A=E===void 0?"center":E,P=this.layer.getEncodedData();this.glyphInfo=P.map(function(F){var N=F.shape,V=N===void 0?"":N,Y=F.id,ie=F.size,ye=ie===void 0?1:ie,Pe=F.textOffset,tt=Pe===void 0?[0,0]:Pe,pt=zA(V.toString(),u,ye,A,"left",g,tt,r),vt=UA(pt,tt,!1);return F.shaping=pt,F.glyphQuads=vt,F.centroid=h(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?h(F.originCoordinates):F.originCentroid=F.centroid,o.glyphInfoMap[Y]={shaping:pt,glyphQuads:vt,centroid:h(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,p=u===void 0?[4,4]:u,v=o.textAllowOverlap,g=v===void 0?!1:v;if(!g){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var E=this.rendererService.getViewportSize(),A=E.width,P=E.height,F=new FA(A,P),N=this.glyphInfo.filter(function(V){var Y=V.shaping,ie=V.id,ye=ie===void 0?0:ie,Pe=V.version==="GAODE2.x"?V.originCentroid:V.centroid,tt=V.size,pt=tt/24,vt=r.mapService.lngLatToContainer(Pe),Xt=F.placeCollisionBox({x1:Y.left*pt-p[0],x2:Y.right*pt+p[0],y1:Y.top*pt-p[1],y2:Y.bottom*pt+p[1],anchorPointX:vt.x,anchorPointY:vt.y}),er=Xt.box;return er&&er.length?(F.insertCollisionBox(er,ye),!0):!1});N.forEach(function(V){r.glyphInfoMap[V.id]=V})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:q.LINEAR,min:q.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:A1,fragmentShader:S1,triangulation:w1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r.layer.models=[E],r.layer.renderLayers()}).catch(function(E){console.warn(E),r.layer.models=[]})}}]),t}(Bo);function HA(e){var a=WA();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function WA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XA=`uniform float u_additive;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,YA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
} else {
  gl_PointSize = 24.0;
  vec2 pointPos = a_Position.xy;
  vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  world.xy += offset;
  world.xy += pointOffset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    world.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}

 
  setPickingColor(a_PickingColor);


}
`,vg=function(e){(0,sn.Z)(t,e);var a=HA(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"meter2coord",1),(0,xe.Z)((0,jt.Z)(i),"isMeter",!1),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,A=r.stroke,P=A===void 0?"rgba(0,0,0,0)":A,F=r.offsets,N=F===void 0?[0,0]:F,V=r.blend,Y=r.blur,ie=Y===void 0?0:Y,ye=r.coord,Pe=ye===void 0?"lnglat":ye,tt=r.tileOrigin;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:P,offsets:N})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:P,offsets:N});var pt=this.layer.getEncodedData(),vt=this.calDataFrame(this.cellLength,pt,this.cellProperties),Xt=vt.data,er=vt.width,wr=vt.height;this.rowCount=wr,this.dataTexture=this.cellLength>0&&Xt.length>0?this.createTexture2D({flipY:!0,data:Xt,format:q.LUMINANCE,type:q.FLOAT,width:er,height:wr}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_tileOrigin:tt||[0,0],u_coord:Pe==="lnglat"?1:0,u_isMeter:Number(this.isMeter),u_blur:ie,u_additive:V==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_stroke_opacity:Number(v),u_stroke_width:Number(E),u_stroke_color:this.getStrokeColor(P),u_offsets:this.isOffsetStatic(N)?N:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$0)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==Wu.L7MAP&&v!==Wu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Ir.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===Wu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),P=1,F=P*A.meterInMercatorCoordinateUnits(),N=new window.mapboxgl.MercatorCoordinate(A.x-F,A.y,A.z),V=N.toLngLat();this.meter2coord=g[0]-V.lng;return}var Y=this.mapService.meterToCoord(g,[o,u]),ie=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(Y+ie)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.workerEnabled,A=E===void 0?!1:E;this.layer.triangulation=$0,this.layer.buildLayerModel({moduleName:"pointTile",vertexShader:YA,fragmentShader:XA,triangulation:$0,depth:{enable:!1},cull:{enable:!0,face:Lf(this.mapService.version)},blend:this.getBlend(),stencil:nt(p,g),workerEnabled:A,workerOptions:{modelType:"pointTile"}}).then(function(P){r([P])}).catch(function(P){console.warn(P),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=g%4*3;return[E[A],E[A+1],E[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?5:E;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,A=E===void 0?2:E,P=r.layer.getLayerConfig().shape2d,F=P.indexOf(A);return[F]}}})}}]),t}(Bo);function qA(e){var a=$A();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function $A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,QA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
} else {
    vec2 pointPos = a_Position.xy;
    vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

    vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
    world.xy += pointOffset;

    if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // Needs to be divided with project_uCommonUnitsPerMeter
      world.w *= u_PixelsPerMeter.z;
    }

    gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);
}

`,T1=function(e){(0,sn.Z)(t,e);var a=qA(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.tileOrigin,v=r.coord,g=v===void 0?"lnglat":v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var E=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,E,this.cellProperties),P=A.data,F=A.width,N=A.height;this.rowCount=N,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:q.LUMINANCE,type:q.FLOAT,width:F,height:N}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_tileOrigin:p||[0,0],u_coord:g==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:u}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=_m,this.layer.buildLayerModel({moduleName:"polygonTile",vertexShader:QA,fragmentShader:KA,triangulation:_m,primitive:q.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(Bo);function JA(e){var a=ew();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tw=function(e){(0,sn.Z)(t,e);var a=JA(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"isVector",!0),(0,xe.Z)((0,jt.Z)(i),"type",i.layerType),(0,xe.Z)((0,jt.Z)(i),"pickedID",null),i}return(0,At.Z)(t,[{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return T1;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();default:return vg}}},{key:"getLineModel",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;switch(u){case"tileline":case"line":return ly;case"simple":return m1;default:return ly}}},{key:"getPointModel",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,p=r.find(function(g){return g.hasOwnProperty("shape")});if(p){var v=p.shape;return(u==null?void 0:u.indexOf(v))!==-1?vg:cy}else return vg}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Cd),rw=fe(32676);function nw(e,a,t){t===void 0&&(t={});var i=Wa(e),r=Wa(a),o=rw.union(i.coordinates,r.coordinates);return o.length===0?null:o.length===1?ai(o[0],t.properties):It(o,t.properties)}var iw=nw;function aw(e,a){a===void 0&&(a={});var t=Wa(e);switch(!a.properties&&e.type==="Feature"&&(a.properties=e.properties),t.type){case"Polygon":return ow(t,a);case"MultiPolygon":return sw(t,a);default:throw new Error("invalid poly")}}function ow(e,a){a===void 0&&(a={});var t=Wa(e),i=t.coordinates,r=a.properties?a.properties:e.type==="Feature"?e.properties:{};return M1(i,r)}function sw(e,a){a===void 0&&(a={});var t=Wa(e),i=t.coordinates,r=a.properties?a.properties:e.type==="Feature"?e.properties:{},o=[];return i.forEach(function(u){o.push(M1(u,r))}),zo(o)}function M1(e,a){return e.length>1?go(e,a):ci(e[0],a)}var xm=function(){function e(a){(0,Lt.Z)(this,e),(0,xe.Z)(this,"outSideEventTimer",null),(0,xe.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=a.parent,this.mapService=a.mapService,this.rendererService=a.rendererService;var t=this.parentLayer.getSource();this.zoomOffset=t.parser.zoomOffset||0,this.tilesetManager=t.tileset}return(0,At.Z)(e,[{key:"createTile",value:function(t,i){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,i){var r={features:[],featureId:null,vectorTileLayer:null,source:null},o=i.sourceLayer,u=i.featureId,p=i.transforms,v=i.layerType,g=i.shape;if(!o)return r;var E=t.data.layers[o],A=E==null?void 0:E.features;if(Array.isArray(A)&&A.length>0){var P=[];v==="LineLayer"&&g==="simple"?A.map(function(N){if(N.geometry.type==="MultiPolygon"){var V,Y=aw(N).features;(V=P).push.apply(V,(0,_e.Z)(Y))}else N.geometry.type==="Polygon"&&(N.geometry.type="MultiLineString"),P.push(N)}):P=A;var F=new Bc({type:"FeatureCollection",features:P},{parser:{type:"geojson",featureId:u},transforms:p});return{features:P,featureId:u,vectorTileLayer:E,source:F}}else return r}},{key:"createLayer",value:function(t){var i=t.L7Layer,r=t.tile,o=t.initOptions,u=t.vectorTileLayer,p=t.source,v=o.mask,g=o.color,E=o.layerType,A=o.size,P=o.shape,F=i||tw,N=new F((0,Z.Z)({visible:r.isVisible,tileOrigin:u==null?void 0:u.l7TileOrigin,coord:u==null?void 0:u.l7TileCoord},this.getLayerInitOption(o)));N.isVector&&(this.emitEvent([N]),N.type=E,N.select(!0)),N.source(p),this.setScale(N),this.setStyleAttributeField(N,"shape",P),this.setStyleAttributeField(N,"color",g),this.setStyleAttributeField(N,"size",A);var V=[N];if(v&&N.isVector){var Y=new h1().source({type:"FeatureCollection",features:[r.bboxPolygon]}).shape("fill");V.push(Y),N.addMaskLayer(Y)}return p1(this.parentLayer,V),this.layers=[N],N}},{key:"updateStyle",value:function(t){return""}},{key:"getDefautStyleAttributeField",value:function(t,i){switch(i){case"size":return 2;case"color":return"#fff";case"shape":return d1(this.parentLayer.type,t);default:return""}}},{key:"setStyleAttributeField",value:function(t,i,r){if(Array.isArray(r)){t[i].apply(t,(0,_e.Z)(r));return}if(typeof r=="string"){t[i](r);return}var o=this.getDefautStyleAttributeField(t,i);if(!r)return t[i](o),t;var u=this.parseScaleValue(r,i);u.length===0?t[i](o):t[i].apply(t,(0,_e.Z)(u))}},{key:"parseScaleValue",value:function(t,i){if(i==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var r=t,o=r.field,u=r.values,p=r.callback;return o&&u&&Array.isArray(u)?[o,u]:o&&p?[o,p]:o?[o]:[]}},{key:"getTile",value:function(t,i){var r=this.mapService.getZoom(),o=Math.ceil(r)+this.zoomOffset,u=Rc(t,i,o),p=this.tilesetManager.tiles.filter(function(g){return g.key==="".concat(u[0],",").concat(u[1],",").concat(o)}),v=p[0];return v}},{key:"emitEvent",value:function(t,i){var r=this;t.map(function(o){o.once("inited",function(){o.on("click",function(u){if(r.eventCache.click=1,r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerClick",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerClick",u)}),o.on("mousemove",function(u){if(r.eventCache.mousemove=1,r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u)}),o.on("mouseup",function(u){r.eventCache.mouseup=1,r.getFeatureAndEmitEvent(o,"subLayerMouseUp",u)}),o.on("mouseenter",function(u){if(r.parentLayer.type==="RasterLayer"){var p=u.lngLat,v=p.lng,g=p.lat,E=r.getTile(v,g);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,i,E)}else r.getFeatureAndEmitEvent(o,"subLayerMouseEnter",u)}),o.on("mouseout",function(u){r.getFeatureAndEmitEvent(o,"subLayerMouseOut",u)}),o.on("mousedown",function(u){r.eventCache.mousedown=1,r.getFeatureAndEmitEvent(o,"subLayerMouseDown",u)}),o.on("contextmenu",function(u){r.eventCache.contextmenu=1,r.getFeatureAndEmitEvent(o,"subLayerContextmenu",u)}),o.on("unclick",function(u){return r.handleOutsideEvent("click","subLayerUnClick",o,u)}),o.on("unmouseup",function(u){return r.handleOutsideEvent("mouseup","subLayerUnMouseUp",o,u)}),o.on("unmousedown",function(u){return r.handleOutsideEvent("mousedown","subLayerUnMouseDown",o,u)}),o.on("uncontextmenu",function(u){return r.handleOutsideEvent("contextmenu","subLayerUnContextmenu",o,u)})})})}},{key:"getCombineFeature",value:function(t){var i=null,r=t[0];return t.map(function(o){var u=ai(o.coordinates);i===null&&(i=u),i=iw(i,u)}),r&&(i.properties=(0,Z.Z)({},r)),i}},{key:"getFeatureAndEmitEvent",value:function(t,i,r,o,u){if(o===!1)r.value=EA(u,this.mapService,r.x,r.y);else{var p=r.featureId,v=this.getAllFeatures(p);try{r.feature=this.getCombineFeature(v)}catch(g){console.warn("Combine Featuer Err! Return First Feature!"),r.feature=v[0]}}this.parentLayer.emit(i,r)}},{key:"setScale",value:function(t){var i=this.parentLayer.tileLayer.scaleField,r=Object.keys(i);r.map(function(o){t.scale(o,i[o])})}},{key:"getAllFeatures",value:function(t){var i=this.parentLayer.tileLayer.children,r=[];return i.map(function(o){var u=o.getSource();u.data.dataArray.map(function(p){p._id===t&&r.push(p)})}),r}},{key:"getLayerInitOption",value:function(t){var i=(0,Z.Z)({},t);return delete i.color,delete i.shape,delete i.size,delete i.coords,delete i.sourceLayer,delete i.coords,i}},{key:"handleOutsideEvent",value:function(t,i,r,o){var u=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){u.eventCache[t]>0?u.eventCache[t]=0:u.getFeatureAndEmitEvent(r,i,o)},64)}}]),e}();function uw(e){var a=lw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cw=function(e){(0,sn.Z)(t,e);var a=uw(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,At.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(xm);function fw(e){var a=hw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pw=function(e){(0,sn.Z)(t,e);var a=fw(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,At.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(xm);function dw(e){var a=vw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mw=function(e){(0,sn.Z)(t,e);var a=dw(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,At.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),p=u.features,v=u.vectorTileLayer,g=u.source;if(p.length===0)return{layers:[],layerIDList:[]};var E=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:g});return{layers:[E],layerIDList:[E.id]}}}]),t}(xm);function gw(e){var a=yw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function yw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I1=function(e){(0,sn.Z)(t,e);var a=gw(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,At.Z)(t,[{key:"createTile",value:function(r,o){var u=new Bc(r.data,{parser:{type:"image",extent:r.bounds}}),p=this.createLayer({L7Layer:f1,tile:r,initOptions:o,source:u});return{layers:[p],layerIDList:[p.id]}}}]),t}(xm);function _w(e){var a=xw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function xw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Ew=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,fy=function(e){(0,sn.Z)(t,e);var a=_w(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.clampLow,v=p===void 0?!0:p,g=r.clampHigh,E=g===void 0?!0:g,A=r.noDataValue,P=A===void 0?-9999999:A,F=r.domain,N=F===void 0?[0,1]:F,V=r.rampColors;return(0,he.isEqual)(this.rampColors,V)||(this.updateColorTexure(),this.rampColors=V),{u_opacity:u||1,u_texture:this.texture,u_domain:N,u_clampLow:v,u_clampHigh:typeof E!="undefined"?E:v,u_noDataValue:P,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.rampColorsData,A=o.rampColors,P=this.layer.getSource(),F=this.rendererService.createTexture2D,N=P.data.dataArray[0];this.texture=F({data:N.data,width:N.width,height:N.height,format:q.LUMINANCE,type:q.FLOAT});var V=E||Se(A);this.colorTexture=F({data:V.data,width:V.width,height:V.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:Ew,fragmentShader:bw,triangulation:uy,primitive:q.TRIANGLES,depth:{enable:!1},stencil:nt(p,g)}).then(function(Y){r([Y])}).catch(function(Y){console.warn(Y),r([])})}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){return[p[3],p[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,p=Se(u);this.colorTexture=r({data:p.data,width:p.width,height:p.height,flipY:!1})}}]),t}(Bo);function Cw(e){var a=Sw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aw=function(e){(0,sn.Z)(t,e);var a=Cw(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type",i.layerType),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){return fy}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Cd);function ww(e){var a=Tw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mw=function(e){(0,sn.Z)(t,e);var a=ww(t);function t(i){var r;return(0,Lt.Z)(this,t),r=a.call(this,i),r.parentLayer=i.parent,r}return(0,At.Z)(t,[{key:"createTile",value:function(r,o){var u=o.opacity,p=o.domain,v=o.clampHigh,g=o.clampLow,E=o.rampColors,A=o.rampColorsData,P=o.mask,F=r.data;if(!F.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var N=new Aw({visible:r.isVisible,mask:P}).source(F.data,{parser:{type:"raster",width:F.width,height:F.height,extent:r.bboxPolygon.bbox}}).style({opacity:u,domain:p,clampHigh:v,clampLow:g,rampColors:E,rampColorsData:A});return this.emitEvent([N],!1),p1(this.parentLayer,[N]),{layers:[N],layerIDList:[N.id]}}}]),t}(xm);function Iw(e,a){switch(e){case"PolygonLayer":return mw;case"LineLayer":return cw;case"PointLayer":return pw;case"RasterLayer":return a.dataType==="arraybuffer"?Mw:I1;default:return console.warn("Current Tile Not Exist!"),I1}}function kw(e){var a=Pw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rw=function(e){(0,sn.Z)(t,e);var a=kw(t);function t(){var i;return(0,Lt.Z)(this,t),i=a.call(this),(0,xe.Z)((0,jt.Z)(i),"checkConfigList",[]),i.cacheConfig=new Map,i}return(0,At.Z)(t,[{key:"setConfig",value:function(r,o){this.checkConfigList.includes(r)||this.checkConfigList.push(r),this.cacheConfig.set(r,o)}},{key:"removeConfig",value:function(r){var o=this.checkConfigList.indexOf(r);o>-1&&(this.cacheConfig.delete(r),this.checkConfigList.splice(o,1))}},{key:"checkConfig",value:function(r){var o=this;if(!!r.inited){var u=r.getLayerConfig(),p=[];this.checkConfigList.map(function(v){var g=o.cacheConfig.get(v),E;if(["color","size","shape"].includes(v)){var A;E=(A=r.getAttribute(v))===null||A===void 0?void 0:A.scale}else{if(!(v in u))return;E=u[v]}(0,he.isEqual)(g,E)||(p.push(v),o.setConfig(v,E))}),p.length>0&&(console.warn("tile config cache update!",p),this.emit("updateConfig",p))}}},{key:"getAttributeScale",value:function(r,o){var u=r.getAttribute(o),p={field:void 0,values:void 0,callback:void 0};if(u&&u.scale){var v=u.scale,g=v.field,E=v.values,A=v.callback;p.field=g,p.values=E,p.callback=A}return p}}]),t}(To());function Lw(e){var a=Ow();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fw=function(e){(0,sn.Z)(t,e);var a=Lw(t);function t(i,r,o,u,p){var v;return(0,Lt.Z)(this,t),v=a.call(this),(0,xe.Z)((0,jt.Z)(v),"isLastPicked",!1),v.parent=i,v.rendererService=r,v.pickingService=o,v.layerService=p,v.children=u,v}return(0,At.Z)(t,[{key:"normalRender",value:function(r){var o=this;r.filter(function(u){return u.inited}).filter(function(u){return u.isVisible()}).map(function(u){u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(o.rendererService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(p){p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),p.render(),p.hooks.afterRender.call()})),u.render(),u.hooks.afterRender.call()})}},{key:"pickRender",value:function(r,o){var u=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var p=r.filter(function(v){return u.parent.needPick(o.type)&&v.inited&&v.isVisible()}).some(function(v){v.hooks.beforePickingEncode.call(),v.masks.length>0&&(u.rendererService.clear({stencil:0,depth:1,framebuffer:null}),v.masks.map(function(E){E.hooks.beforeRender.call(),E.render(),E.hooks.afterRender.call()})),v.renderModels(!0),v.hooks.afterPickingEncode.call();var g=u.pickingService.pickFromPickingFBO(v,o);return g&&u.parent.type!=="RasterLayer"&&(u.emit("pick",{type:o.type,pickedColors:u.pickingService.pickedColors,layer:v}),u.pickingService.pickedTileLayers=[u.parent]),g});return this.parent.type!=="RasterLayer"&&!p&&this.isLastPicked&&o.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=p,p}},{key:"clearPick",value:function(){this.children.filter(function(r){return r.inited&&r.isVisible()}).map(function(r){r.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(r)})}},{key:"beforeSelect",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeSelect.call(r)})}},{key:"renderMask",value:function(r){r.inited&&r.isVisible()&&(r.hooks.beforeRender.call(),r.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map(function(o){o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),r.hooks.afterRender.call())}}]),t}(Hs.EventEmitter),Dw=function(){function e(a,t,i,r,o,u){(0,Lt.Z)(this,e),this.parent=a,this.children=a.layerChildren,this.mapService=t,this.rendererService=i,this.transforms=u,this.tilePickManager=new Fw(a,i,r,this.children,o),this.tileConfigManager=new Rw,this.setSubLayerInitOptipn(),this.setConfigListener(),this.initTileFactory()}return(0,At.Z)(e,[{key:"createTile",value:function(t){return this.tileFactory.createTile(t,this.initOptions)}},{key:"updateLayersConfig",value:function(t,i,r){t.map(function(o){i==="mask"?o.style({mask:r}):o.updateLayerConfig((0,xe.Z)({},i,r))})}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChilds",value:function(t){var i;(i=this.children).push.apply(i,(0,_e.Z)(t))}},{key:"removeChilds",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=[],o=[];this.children.filter(function(u){t.includes(u.id)?r.push(u):o.push(u)}),r.map(function(u){return u.destroy(i)}),this.children=o}},{key:"removeChild",value:function(t){var i=this.children.indexOf(t);i>-1&&this.children.splice(i,1),t.destroy()}},{key:"getChilds",value:function(t){return this.children.filter(function(i){return t.includes(i.id)})}},{key:"getChild",value:function(t){return this.children.filter(function(i){return i.id===t})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(t){t.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"render",value:function(){var t,i;(t=this.tileConfigManager)===null||t===void 0||t.checkConfig(this.parent),(i=this.tilePickManager)===null||i===void 0||i.normalRender(this.children)}},{key:"pickLayers",value:function(t){var i;return(i=this.tilePickManager)===null||i===void 0?void 0:i.pickRender(this.children,t)}},{key:"setSubLayerInitOptipn",value:function(){var t,i=this.parent.getLayerConfig(),r=i.zIndex,o=r===void 0?0:r,u=i.opacity,p=u===void 0?1:u,v=i.mask,g=v===void 0?!1:v,E=i.stroke,A=E===void 0?"#fff":E,P=i.strokeWidth,F=P===void 0?0:P,N=i.strokeOpacity,V=N===void 0?1:N,Y=i.clampLow,ie=Y===void 0?!0:Y,ye=i.clampHigh,Pe=ye===void 0?!0:ye,tt=i.domain,pt=tt===void 0?[0,1]:tt,vt=i.rampColors,Xt=vt===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:vt,er=i.featureId,wr=er===void 0?"id":er,kr=i.workerEnabled,Sr=kr===void 0?!1:kr,un=i.sourceLayer,Dn=i.pixelConstant,li=Dn===void 0?0:Dn,Da=i.pixelConstantR,$a=Da===void 0?256*256:Da,Fs=i.pixelConstantG,Fu=Fs===void 0?256:Fs,xu=i.pixelConstantB,vf=xu===void 0?1:xu,S0=i.pixelConstantRGB,A0=S0===void 0?.1:S0,iv=this.tileConfigManager.getAttributeScale(this.parent,"color"),jv=this.tileConfigManager.getAttributeScale(this.parent,"size"),av=this.parent.getSource(),Gv=(av==null||(t=av.data)===null||t===void 0?void 0:t.tilesetOptions)||{},Hy=Gv.coords,Wy=d1(this.parent.type,this.parent);Xt&&(this.rampColorsData=Se(Xt)),this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:Wy,zIndex:o,opacity:p,sourceLayer:un,coords:Hy,featureId:wr,color:iv,size:jv,mask:xA(this.parent.type,g),stroke:A,strokeWidth:F,strokeOpacity:V,clampLow:ie,clampHigh:Pe,domain:pt,rampColors:Xt,rampColorsData:this.rampColorsData,workerEnabled:Sr,pixelConstant:li,pixelConstantR:$a,pixelConstantG:Fu,pixelConstantB:vf,pixelConstantRGB:A0}}},{key:"setConfigListener",value:function(){var t=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow),this.tileConfigManager.setConfig("pixelConstant",this.initOptions.pixelConstant),this.tileConfigManager.setConfig("pixelConstantR",this.initOptions.pixelConstantR),this.tileConfigManager.setConfig("pixelConstantG",this.initOptions.pixelConstantG),this.tileConfigManager.setConfig("pixelConstantB",this.initOptions.pixelConstantB),this.tileConfigManager.setConfig("pixelConstantRGB",this.initOptions.pixelConstantRGB);else{var i,r,o;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(i=this.parent.getAttribute("color"))===null||i===void 0?void 0:i.scale),this.tileConfigManager.setConfig("shape",(r=this.parent.getAttribute("shape"))===null||r===void 0?void 0:r.scale),this.tileConfigManager.setConfig("size",(o=this.parent.getAttribute("size"))===null||o===void 0?void 0:o.scale)}this.tileConfigManager.on("updateConfig",function(u){u.map(function(p){return t.updateStyle(p),""})})}},{key:"updateStyle",value:function(t){var i=this,r=null;if(["size","color","shape"].includes(t)){var o,u=(o=this.parent.getAttribute(t))===null||o===void 0?void 0:o.scale;if(!u)return;r=u,this.children.map(function(g){return i.tileFactory.setStyleAttributeField(g,t,u),""})}else{var p=this.parent.getLayerConfig();if(!(t in p))return;var v=p[t];r=v,this.updateLayersConfig(this.children,t,v),t==="rampColors"&&v&&(this.rampColorsData=Se(v))}this.initOptions[t]=r}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),i=Iw(this.parent.type,t.parser);this.tileFactory=new i({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}}]),e}(),Bw=function(){function e(a){var t,i=a.parent,r=a.rendererService,o=a.mapService,u=a.layerService,p=a.pickingService,v=a.transforms;(0,Lt.Z)(this,e),(0,xe.Z)(this,"type","baseTile"),(0,xe.Z)(this,"initedTileset",!1),(0,xe.Z)(this,"pickColors",{select:null,active:null});var g=i.getSource(),E=(g==null||(t=g.data)===null||t===void 0?void 0:t.tilesetOptions)||{},A=E.sourceLayer,P=E.coords,F=E.featureId;this.sourceLayer=A,this.parent=i,this.mapService=o,this.layerService=u,this.tileLayerManager=new Dw(i,o,r,p,u,v),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return(0,At.Z)(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var t=this;this.children.filter(function(i){return i.inited&&i.isVisible()}).filter(function(i){return i.getCurrentSelectedId()!==null}).map(function(i){t.selectFeature(i,new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(i){return i.isLoaded}).map(function(i){if(i.layerIDList.length===0){var r=t.tileLayerManager.createTile(i),o=r.layers,u=r.layerIDList;i.layerIDList=u,t.tileLayerManager.addChilds(o)}else{if(!i.isVisibleChange)return;var p=t.tileLayerManager.getChilds(i.layerIDList);t.tileLayerManager.updateLayersConfig(p,"visible",i.isVisible)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"setPickState",value:function(t){var i=this;if(this.pickColors.select){var r=te(this.pickColors.select);t.map(function(u){i.selectFeature(u,i.pickColors.select),u.setCurrentSelectedId(r)})}if(this.pickColors.active){var o=te(this.pickColors.active);t.filter(function(u){return u.inited&&u.isVisible()}).map(function(u){u.hooks.beforeHighlight.call(i.pickColors.active),u.setCurrentPickId(o)})}}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickManager.on("pick",function(i){var r=(0,Ir.Z)(i.pickedColors,3),o=r[0],u=r[1],p=r[2];if(i.type==="click"){var v=t.children.filter(function(g){return g.inited&&g.isVisible()&&g.isVector}).filter(function(g){return g!==i.layer});t.setSelect(v,[o,u,p])}else t.setHighlight([o,u,p])}),this.tileLayerManager.tilePickManager.on("unpick",function(){t.pickColors.active=null})}},{key:"setHighlight",value:function(t){var i=te(t);this.pickColors.active=t,this.children.filter(function(r){return r.inited&&r.isVisible()&&r.isVector}).filter(function(r){return r.getPickID()!==i}).map(function(r){r.setPickID(i),r.hooks.beforeHighlight.call(t)})}},{key:"setSelect",value:function(t,i){var r=this,o=te(i);t.map(function(p){p.getCurrentSelectedId()===null||o!==p.getCurrentSelectedId()?(r.selectFeature(p,i),p.setCurrentSelectedId(o),r.pickColors.select=i):(r.selectFeature(p,new Uint8Array([0,0,0,0])),p.setCurrentSelectedId(null),r.pickColors.select=null)});var u=this.layerService.getRenderList();u.filter(function(p){return p.inited&&!p.isVector&&p.isVisible()&&p.needPick("click")}).filter(function(p){return p.getCurrentSelectedId()!==null}).map(function(p){r.selectFeature(p,new Uint8Array([0,0,0,0])),p.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(t,i){var r=(0,Ir.Z)(i,3),o=r[0],u=r[1],p=r[2];t.hooks.beforeSelect.call([o,u,p])}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(i){t.parent.emit("click",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseMove",function(i){return t.parent.emit("mousemove",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseUp",function(i){return t.parent.emit("mouseup",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseEnter",function(i){return t.parent.emit("mouseenter",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseOut",function(i){return t.parent.emit("mouseout",(0,Z.Z)({},i))}),this.parent.on("subLayerMouseDown",function(i){return t.parent.emit("mousedown",(0,Z.Z)({},i))}),this.parent.on("subLayerContextmenu",function(i){return t.parent.emit("contextmenu",(0,Z.Z)({},i))}),this.parent.on("subLayerUnClick",function(i){return t.parent.emit("unclick",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseMove",function(i){return t.parent.emit("unmousemove",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseUp",function(i){return t.parent.emit("unmouseup",(0,Z.Z)({},i))}),this.parent.on("subLayerUnMouseDown",function(i){return t.parent.emit("unmousedown",(0,Z.Z)({},i))}),this.parent.on("subLayerUnContextmenu",function(i){return t.parent.emit("uncontextmenu",(0,Z.Z)({},i))})}},{key:"initTileSetManager",value:function(){var t,i=this.parent.getSource();this.tilesetManager=i.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var r=this.getCurrentView(),o=r.latLonBounds,u=r.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(u,o)}},{key:"mapchange",value:function(){var t,i=this.getCurrentView(),r=i.latLonBounds,o=i.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),p=u.visible;o<3&&p?(this.parent.updateLayerConfig({visible:!1}),this.layerService.updateLayerRenderList()):o>=3&&!p&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.updateLayerRenderList())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===r.toString()||(this.lastViewStates={zoom:o,latLonBounds:r},this.timer&&(clearTimeout(this.timer),this.timer=null),(t=this.tilesetManager)===null||t===void 0||t.update(o,r))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(i){}),this.tilesetManager.on("tile-unload",function(i){t.tileUnLoad(i)}),this.tilesetManager.on("tile-error",function(i,r){t.tileError(i)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.mapchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),i=[t[0][0],t[0][1],t[1][0],t[1][1]],r=this.mapService.getZoom();return{latLonBounds:i,zoom:r}}}]),e}();function Nw(e){var a=zw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uw=function(e){(0,sn.Z)(t,e);var a=Nw(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","TMS"),i}return(0,At.Z)(t,[{key:"tileUnLoad",value:function(r){this.tileLayerManager.removeChilds(r.layerIDList,!1)}},{key:"tileUpdate",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(o){return o.isLoaded}).map(function(o){var u;if((u=o.data)!==null&&u!==void 0&&u.layers&&r.sourceLayer){var p=o.data.layers[r.sourceLayer],v=p==null?void 0:p.features;if(!(Array.isArray(v)&&v.length>0))return}if(o.parentLayerIDList.includes(r.parent.id)){if(!o.isVisibleChange)return;var F=r.tileLayerManager.getChilds(o.layerIDList);r.tileLayerManager.updateLayersConfig(F,"visible",o.isVisible),r.setPickState(F)}else{var g,E=r.tileLayerManager.createTile(o),A=E.layers,P=E.layerIDList;o.parentLayerIDList.push(r.parent.id),(g=o.layerIDList).push.apply(g,(0,_e.Z)(P)),r.tileLayerManager.addChilds(A),r.setPickState(A)}}),this.parent.renderLayers(),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(Bw);function Zw(e){var a=Vw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Vw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mg=function(e){(0,sn.Z)(t,e);var a=Zw(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var r=this.layer.getSource();return r!=null&&r.data.isTile&&(this.layer.tileLayer=new Uw({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:r.transforms})),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(Bo);function jw(e){var a=Gw();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function Gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hw=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,Ww=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,Xw=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,Yw=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
     return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,qw=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,$w=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Kw={solid:0,dash:1},Qw=function(e){(0,sn.Z)(t,e);var a=jw(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,A=r.lineType,P=A===void 0?"solid":A,F=r.dashArray,N=F===void 0?[10,5]:F,V=r.forward,Y=V===void 0?!0:V,ie=r.lineTexture,ye=ie===void 0?!1:ie,Pe=r.iconStep,tt=Pe===void 0?100:Pe,pt=r.segmentNumber,vt=pt===void 0?30:pt,Xt=r.thetaOffset,er=Xt===void 0?.314:Xt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:er})){this.judgeStyleAttributes({opacity:u,thetaOffset:er});var wr=this.layer.getEncodedData(),kr=this.calDataFrame(this.cellLength,wr,this.cellProperties),Sr=kr.data,un=kr.width,Dn=kr.height;this.rowCount=Dn,this.dataTexture=this.cellLength>0&&Sr.length>0?this.createTexture2D({flipY:!0,data:Sr,format:q.LUMINANCE,type:q.FLOAT,width:un,height:Dn}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}N.length===2&&N.push(0,0);var li=0,Da=[0,0,0,0],$a=[0,0,0,0];return p&&v&&(Da=W(p),$a=W(v),li=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,he.isNumber)(er)?er:0,u_opacity:(0,he.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:vt,u_line_type:Kw[P||"solid"],u_dash_array:N,u_blur:.9,u_lineDir:Y?1:-1,u_texture:this.texture,u_line_texture:ye?1:0,u_icon_step:tt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:li,u_sourceColor:Da,u_targetColor:$a}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,p=r.lineType;return p==="dash"?{frag:Hw,vert:Ww,type:"Dash"}:o&&u?{frag:qw,vert:$w,type:"Linear"}:{frag:Xw,vert:Yw,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,A=E===void 0?!0:E,P=this.getShaders(),F=P.frag,N=P.vert,V=P.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+V,vertexShader:N,fragmentShader:F,triangulation:pg,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:nt(g,A)}).then(function(Y){r([Y])}).catch(function(Y){console.warn(Y),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.texture,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}})}}]),t}(Bo);function Jw(e){var a=eT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function eT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,rT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,nT=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,iT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,aT={solid:0,dash:1},oT=function(e){(0,sn.Z)(t,e);var a=Jw(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,A=r.lineType,P=A===void 0?"solid":A,F=r.dashArray,N=F===void 0?[10,5]:F,V=r.lineTexture,Y=V===void 0?!1:V,ie=r.iconStep,ye=ie===void 0?100:ie,Pe=r.segmentNumber,tt=Pe===void 0?30:Pe,pt=r.globalArcHeight,vt=pt===void 0?10:pt;N.length===2&&N.push(0,0);var Xt=0,er=[0,0,0,0],wr=[0,0,0,0];if(p&&v&&(er=W(p),wr=W(v),Xt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var kr=this.layer.getEncodedData(),Sr=this.calDataFrame(this.cellLength,kr,this.cellProperties),un=Sr.data,Dn=Sr.width,li=Sr.height;this.rowCount=li,this.dataTexture=this.cellLength>0&&un.length>0?this.createTexture2D({flipY:!0,data:un,format:q.LUMINANCE,type:q.FLOAT,width:Dn,height:li}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ny,u_global_height:vt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:tt,u_line_type:aT[P]||0,u_dash_array:N,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Xt,u_sourceColor:er,u_targetColor:wr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:nT,vert:iT,type:"Linear"}:{frag:tT,vert:rT,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,A=E===void 0?!0:E,P=this.getShaders(),F=P.frag,N=P.vert,V=P.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+V,vertexShader:N,fragmentShader:F,triangulation:pg,blend:this.getBlend(),segmentNumber:p,stencil:nt(g,A)}).then(function(Y){r([Y])}).catch(function(Y){console.warn(Y),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.texture,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}})}}]),t}(Bo);function sT(e){var a=uT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function uT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,cT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,fT=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,hT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,pT={solid:0,dash:1},dT=function(e){(0,sn.Z)(t,e);var a=sT(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,A=r.lineType,P=A===void 0?"solid":A,F=r.dashArray,N=F===void 0?[10,5]:F,V=r.lineTexture,Y=V===void 0?!1:V,ie=r.iconStep,ye=ie===void 0?100:ie,Pe=r.segmentNumber,tt=Pe===void 0?30:Pe,pt=r.globalArcHeight,vt=pt===void 0?10:pt;N.length===2&&N.push(0,0);var Xt=0,er=[0,0,0,0],wr=[0,0,0,0];if(p&&v&&(er=W(p),wr=W(v),Xt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var kr=this.layer.getEncodedData(),Sr=this.calDataFrame(this.cellLength,kr,this.cellProperties),un=Sr.data,Dn=Sr.width,li=Sr.height;this.rowCount=li,this.dataTexture=this.cellLength>0&&un.length>0?this.createTexture2D({flipY:!0,data:un,format:q.LUMINANCE,type:q.FLOAT,width:Dn,height:li}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:ny,u_global_height:vt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:tt,u_line_type:pT[P]||0,u_dash_array:N,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Xt,u_sourceColor:er,u_targetColor:wr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:fT,vert:hT,type:"Linear"}:{frag:lT,vert:cT,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,p=u===void 0?30:u,v=o.mask,g=v===void 0?!1:v,E=o.maskInside,A=E===void 0?!0:E,P=this.getShaders(),F=P.frag,N=P.vert,V=P.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+V,vertexShader:N,fragmentShader:F,triangulation:pg,depth:{enable:!0},blend:this.getBlend(),segmentNumber:p,stencil:nt(g,A)}).then(function(Y){r([Y])}).catch(function(Y){console.warn(Y),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.texture,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}})}}]),t}(Bo);function vT(e){var a=mT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function mT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,yT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,_T={solid:0,dash:1},xT=function(e){(0,sn.Z)(t,e);var a=vT(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,A=r.lineType,P=A===void 0?"solid":A,F=r.dashArray,N=F===void 0?[10,5]:F,V=r.lineTexture,Y=V===void 0?!1:V,ie=r.iconStep,ye=ie===void 0?100:ie,Pe=r.segmentNumber,tt=Pe===void 0?30:Pe;N.length===2&&N.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var pt=0,vt=[0,0,0,0],Xt=[0,0,0,0];if(p&&v&&(vt=W(p),Xt=W(v),pt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var er=this.layer.getEncodedData(),wr=this.calDataFrame(this.cellLength,er,this.cellProperties),kr=wr.data,Sr=wr.width,un=wr.height;this.rowCount=un,this.dataTexture=this.cellLength>0&&kr.length>0?this.createTexture2D({flipY:!0,data:kr,format:q.LUMINANCE,type:q.FLOAT,width:Sr,height:un}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,segmentNumber:tt,u_line_type:_T[P]||0,u_dash_array:N,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:pt,u_sourceColor:vt,u_targetColor:Xt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:yT,fragmentShader:gT,triangulation:pg,depth:{enable:!1},blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Gn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(u,p,v,g){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.texture,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}})}}]),t}(Bo);function bT(e){var a=ET();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CT=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,ST=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,AT=function(e){(0,sn.Z)(t,e);var a=bT(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.arrow,E=g===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:g,A=0,P=[0,0,0,0],F=[0,0,0,0];if(p&&v&&(P=W(p),F=W(v),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var N=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,N,this.cellProperties),Y=V.data,ie=V.width,ye=V.height;this.rowCount=ye,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:q.LUMINANCE,type:q.FLOAT,width:ie,height:ye}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_linearColor:A,u_sourceColor:P,u_targetColor:F,u_arrow:Number(E.enable),u_arrowHeight:E.arrowHeight||3,u_arrowWidth:E.arrowWidth||2,u_tailWidth:E.tailWidth===void 0?1:E.tailWidth}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var i=(0,Va.Z)(yi().mark(function o(u){var p,v,g,E,A,P,F,N,V,Y;return yi().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,A=E===void 0?!0:E,P=p.depth,F=P===void 0?!1:P,N=this.getShaders(),V=N.frag,Y=N.vert,this.layer.triangulation=K0,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:Y,fragmentShader:V,triangulation:K0,depth:{enable:F},blend:this.getBlend(),stencil:nt(g,A)}).then(function(Pe){u([Pe])}).catch(function(Pe){console.warn(Pe),u([])});case 4:case"end":return ye.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){return{frag:CT,vert:ST,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v,g,E){return E===void 0?[p[3],10,p[5]]:[p[3],E,p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:Gn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(o,u,p,v){var g=o.coordinates[0]||[0,0],E=o.coordinates[3]||[0,0];return[g[0],g[1],E[0],E[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){return[p[4]]}}})}}]),t}(Bo),k1;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(k1||(k1={}));var Lv;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Lv||(Lv={}));var hy;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(hy||(hy={}));var P1;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(P1||(P1={}));function wT(e){var a=TT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function TT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MT=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,IT=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,kT=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,R1=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,PT=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,RT={solid:0,dash:1},L1=function(e){(0,sn.Z)(t,e);var a=wT(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,A=r.lineType,P=A===void 0?"solid":A,F=r.dashArray,N=F===void 0?[10,5,0,0]:F,V=r.lineTexture,Y=V===void 0?!1:V,ie=r.iconStep,ye=ie===void 0?100:ie,Pe=r.vertexHeightScale,tt=Pe===void 0?20:Pe,pt=r.borderWidth,vt=pt===void 0?0:pt,Xt=r.borderColor,er=Xt===void 0?"#ccc":Xt,wr=r.raisingHeight,kr=wr===void 0?0:wr,Sr=r.heightfixed,un=Sr===void 0?!1:Sr,Dn=r.linearDir,li=Dn===void 0?Lv.VERTICAL:Dn,Da=r.blur,$a=Da===void 0?[1,1,1]:Da,Fs=r.arrow,Fu=Fs===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:Fs;N.length===2&&N.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var xu=0,vf=[0,0,0,0],S0=[0,0,0,0];if(p&&v&&(vf=W(p),S0=W(v),xu=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var A0=this.layer.getEncodedData(),iv=this.calDataFrame(this.cellLength,A0,this.cellProperties),jv=iv.data,av=iv.width,Gv=iv.height;this.rowCount=Gv,this.dataTexture=this.cellLength>0&&jv.length>0?this.createTexture2D({flipY:!0,data:jv,format:q.LUMINANCE,type:q.FLOAT,width:av,height:Gv}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_textureBlend:E===hy.NORMAL?0:1,u_line_type:RT[P],u_dash_array:N,u_blur:$a,u_texture:this.texture,u_line_texture:Y?1:0,u_icon_step:ye,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:vt,u_borderColor:W(er),u_linearDir:li===Lv.VERTICAL?1:0,u_linearColor:xu,u_sourceColor:vf,u_targetColor:S0,u_heightfixed:Number(un),u_vertexScale:tt,u_raisingHeight:Number(kr),u_arrow:Number(Fu.enable),u_arrowHeight:Fu.arrowHeight||3,u_arrowWidth:Fu.arrowWidth||2,u_tailWidth:Fu.tailWidth===void 0?1:Fu.tailWidth}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.depth,A=E===void 0?!1:E,P=o.workerEnabled,F=P===void 0?!1:P,N=o.enablePicking,V=this.getShaders(),Y=V.frag,ie=V.vert,ye=V.type;this.layer.triangulation=wc,this.layer.buildLayerModel({moduleName:"line"+ye,vertexShader:ie,fragmentShader:Y,triangulation:wc,depth:{enable:A},blend:this.getBlend(),stencil:nt(p,g),workerEnabled:F,workerOptions:{modelType:"line"+ye,enablePicking:N,iconMap:this.iconService.getIconMap()}}).then(function(Pe){r([Pe])}).catch(function(Pe){console.warn(Pe),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,p=r.lineType;return p==="dash"?{frag:MT,vert:IT,type:"Dash"}:o&&u?{frag:PT,vert:R1,type:"Linear"}:{frag:kT,vert:R1,type:""}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g,E,A){return A===void 0?[v[3],10]:[v[3],A]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.texture,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}})}}]),t}(Bo);function LT(e){var a=OT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function OT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FT=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,DT=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,BT=function(e){(0,sn.Z)(t,e);var a=LT(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;i.colorTexture&&i.colorTexture.destroy();var v=i.layer.getLayerConfig(),g=v.rampColors,E=Se(g);i.colorTexture=p({data:new Uint8Array(E.data),width:E.width,height:E.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.NEAREST,mag:q.NEAREST,flipY:!1})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.vertexHeightScale,v=p===void 0?20:p,g=r.raisingHeight,E=g===void 0?0:g,A=r.heightfixed,P=A===void 0?!1:A,F=r.linearDir,N=F===void 0?Lv.VERTICAL:F;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var V=this.layer.getEncodedData(),Y=this.calDataFrame(this.cellLength,V,this.cellProperties),ie=Y.data,ye=Y.width,Pe=Y.height;this.rowCount=Pe,this.dataTexture=this.cellLength>0&&ie.length>0?this.createTexture2D({flipY:!0,data:ie,format:q.LUMINANCE,type:q.FLOAT,width:ye,height:Pe}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:N===Lv.VERTICAL?1:0,u_opacity:(0,he.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(P),u_vertexScale:v,u_raisingHeight:Number(E)}}},{key:"initModels",value:function(r){this.updateTexture(),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.colorTexture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=o.depth,A=E===void 0?!1:E;this.layer.triangulation=K0,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:DT,fragmentShader:FT,triangulation:K0,depth:{enable:A},blend:this.getBlend(),stencil:nt(p,g)}).then(function(P){r([P])}).catch(function(P){console.warn(P),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Gn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v,g,E){return E===void 0?[p[3],10]:[p[3],E]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){return[p[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0],E[1]]:[E,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){return[p[4]]}}})}}]),t}(Bo);function NT(e){var a=zT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function zT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UT=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZT=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,VT=function(e){(0,sn.Z)(t,e);var a=NT(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.NEAREST,min:q.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.sourceColor,v=r.targetColor,g=r.textureBlend,E=g===void 0?"normal":g,A=r.heightfixed,P=A===void 0?!1:A,F=r.lineTexture,N=F===void 0?!1:F,V=r.iconStep,Y=V===void 0?100:V,ie=r.iconStepCount,ye=ie===void 0?1:ie;this.rendererService.getDirty()&&this.texture.bind();var Pe=0,tt=[0,0,0,0],pt=[0,0,0,0];if(p&&v&&(tt=W(p),pt=W(v),Pe=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var vt=this.layer.getEncodedData(),Xt=this.calDataFrame(this.cellLength,vt,this.cellProperties),er=Xt.data,wr=Xt.width,kr=Xt.height;this.rowCount=kr,this.dataTexture=this.cellLength>0&&er.length>0?this.createTexture2D({flipY:!0,data:er,format:q.LUMINANCE,type:q.FLOAT,width:wr,height:kr}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_heightfixed:Number(P),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_textureBlend:E==="normal"?0:1,u_texture:this.texture,u_line_texture:N?1:0,u_iconStepCount:ye,u_icon_step:Y,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Pe,u_sourceColor:tt,u_targetColor:pt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:ZT,fragmentShader:UT,triangulation:K0,depth:{enable:!1},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Gn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Gn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=u.size,A=E===void 0?1:E;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,p,v,g,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Gn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.texture,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}})}}]),t}(Bo),jT={arc:Qw,arc3d:oT,greatcircle:xT,wall:VT,line:L1,halfLine:AT,simple:m1,linearline:BT,vectorline:mg,tileLine:ly,earthArc3d:dT},GT=jT;function HT(e){var a=WT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XT=function(e){(0,sn.Z)(t,e);var a=HT(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","LineLayer"),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new GT[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return o[r]}},{key:"getModelType",value:function(){var r;if(this.layerType)return this.layerType;if(this.layerSource.parser.type==="mvt")return"vectorline";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u||"line"}}]),t}(Cd);function YT(e){var a=qT();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function qT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $T=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,KT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,QT=function(e){(0,sn.Z)(t,e);var a=YT(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"raiseCount",0),(0,xe.Z)((0,jt.Z)(i),"raiserepeat",0),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,p=r.opacity,v=p===void 0?1:p,g=r.sourceColor,E=r.targetColor,A=r.pickLight,P=A===void 0?!1:A,F=r.heightfixed,N=F===void 0?!1:F,V=r.opacityLinear,Y=V===void 0?{enable:!1,dir:"up"}:V,ie=r.lightEnable,ye=ie===void 0?!0:ie;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var Pe=this.layer.getEncodedData(),tt=this.calDataFrame(this.cellLength,Pe,this.cellProperties),pt=tt.data,vt=tt.width,Xt=tt.height;this.rowCount=Xt,this.dataTexture=this.cellLength>0&&pt.length>0?this.createTexture2D({flipY:!0,data:pt,format:q.LUMINANCE,type:q.FLOAT,width:vt,height:Xt}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}var er=0,wr=[0,0,0,0],kr=[0,0,0,0];if(g&&E&&(wr=W(g),kr=W(E),er=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var Sr=u.speed,un=Sr===void 0?.01:Sr,Dn=u.repeat,li=Dn===void 0?!1:Dn;this.raiseCount+=un,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(P),u_heightfixed:Number(N),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(v)?v:1,u_linearColor:er,u_sourceColor:wr,u_targetColor:kr,u_opacitylinear:Number(Y.enable),u_opacitylinear_dir:Y.dir==="up"?1:0,u_lightEnable:Number(ye)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.animateOption.repeat,p=u===void 0?1:u;this.raiserepeat=p,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:KT,fragmentShader:$T,triangulation:oy,depth:{enable:!0},cull:{enable:!0,face:Lf(this.mapService.version)},blend:this.getBlend()}).then(function(v){r([v])}).catch(function(v){console.warn(v),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v){var g=o.size;if(g){var E=[];return Array.isArray(g)&&(E=g.length===2?[g[0],g[0],g[1]]:g),Array.isArray(g)||(E=[g,g,g]),E}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u){var p=h(o.coordinates);return $_([p[0],p[1]])}}})}}]),t}(Bo);function JT(e){var a=e5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function e5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,r5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,n5=function(e){(0,sn.Z)(t,e);var a=JT(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,A=r.stroke,P=A===void 0?"rgba(0,0,0,0)":A,F=r.offsets,N=F===void 0?[0,0]:F,V=r.blend,Y=r.blur,ie=Y===void 0?0:Y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:P,offsets:N})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:P,offsets:N});var ye=this.layer.getEncodedData(),Pe=this.calDataFrame(this.cellLength,ye,this.cellProperties),tt=Pe.data,pt=Pe.width,vt=Pe.height;this.rowCount=vt,this.dataTexture=this.cellLength>0&&tt.length>0?this.createTexture2D({flipY:!0,data:tt,format:q.LUMINANCE,type:q.FLOAT,width:pt,height:vt}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_blur:ie,u_additive:V==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_stroke_opacity:(0,he.isNumber)(v)?v:1,u_stroke_width:(0,he.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(P),u_offsets:this.isOffsetStatic(N)?N:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.triangulation=n1,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:r5,fragmentShader:t5,triangulation:n1,depth:{enable:!0},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,p,v,g){var E=(0,Ir.Z)(v,3),A=E[0],P=E[1],F=E[2],N=rs.fromValues(0,0,1),V=rs.fromValues(A,0,F),Y=A>=0?rs.angle(N,V):Math.PI*2-rs.angle(N,V),ie=Math.PI*2-Math.asin(P/100),ye=ko();Gu(ye,ye,Y),Ua(ye,ye,ie);var Pe=rs.fromValues(1,1,0);rs.transformMat4(Pe,Pe,ye),rs.normalize(Pe,Pe);var tt=rs.fromValues(-1,1,0);rs.transformMat4(tt,tt,ye),rs.normalize(tt,tt);var pt=rs.fromValues(-1,-1,0);rs.transformMat4(pt,pt,ye),rs.normalize(pt,pt);var vt=rs.fromValues(1,-1,0);rs.transformMat4(vt,vt,ye),rs.normalize(vt,vt);var Xt=[].concat((0,_e.Z)(Pe),(0,_e.Z)(tt),(0,_e.Z)(pt),(0,_e.Z)(vt)),er=g%4*3;return[Xt[er],Xt[er+1],Xt[er+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?5:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,A=E===void 0?2:E,P=r.layer.getLayerConfig().shape2d,F=P.indexOf(A);return[F]}}})}}]),t}(Bo);function i5(e){var a=a5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function a5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,s5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,O1=function(e){(0,sn.Z)(t,e);var a=i5(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"raiseCount",0),(0,xe.Z)((0,jt.Z)(i),"raiserepeat",0),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,p=r.opacity,v=p===void 0?1:p,g=r.sourceColor,E=r.targetColor,A=r.pickLight,P=A===void 0?!1:A,F=r.heightfixed,N=F===void 0?!1:F,V=r.opacityLinear,Y=V===void 0?{enable:!1,dir:"up"}:V,ie=r.lightEnable,ye=ie===void 0?!0:ie;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var Pe=this.layer.getEncodedData(),tt=this.calDataFrame(this.cellLength,Pe,this.cellProperties),pt=tt.data,vt=tt.width,Xt=tt.height;this.rowCount=Xt,this.dataTexture=this.cellLength>0&&pt.length>0?this.createTexture2D({flipY:!0,data:pt,format:q.LUMINANCE,type:q.FLOAT,width:vt,height:Xt}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}var er=0,wr=[0,0,0,0],kr=[0,0,0,0];if(g&&E&&(wr=W(g),kr=W(E),er=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var Sr=u.speed,un=Sr===void 0?.01:Sr,Dn=u.repeat,li=Dn===void 0?!1:Dn;this.raiseCount+=un,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(P),u_heightfixed:Number(N),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(v)?v:1,u_linearColor:er,u_sourceColor:wr,u_targetColor:kr,u_opacitylinear:Number(Y.enable),u_opacitylinear_dir:Y.dir==="up"?1:0,u_lightEnable:Number(ye)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var i=(0,Va.Z)(yi().mark(function o(u){var p,v,g,E,A;return yi().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:p=this.layer.getLayerConfig(),v=p.depth,g=v===void 0?!0:v,E=p.animateOption.repeat,A=E===void 0?1:E,this.raiserepeat=A,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:s5,fragmentShader:o5,triangulation:oy,blend:this.getBlend(),cull:{enable:!0,face:Lf(this.mapService.version)},depth:{enable:g}}).then(function(N){u([N])}).catch(function(N){console.warn(N),u([])});case 3:case"end":return F.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v){var g=o.size;if(g){var E=[];return Array.isArray(g)&&(E=g.length===2?[g[0],g[0],g[1]]:g),Array.isArray(g)||(E=[g,g,g]),E}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u,p,v,g){return g}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Gn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(o,u){var p=h(o.coordinates);return[p[0],p[1],0]}}})}}]),t}(Bo);function u5(e){var a=l5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function l5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var F1=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,c5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,py=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,D1=function(e){(0,sn.Z)(t,e);var a=u5(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"meter2coord",1),(0,xe.Z)((0,jt.Z)(i),"meteryScale",1),(0,xe.Z)((0,jt.Z)(i),"isMeter",!1),(0,xe.Z)((0,jt.Z)(i),"unit","l7size"),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.strokeOpacity,v=p===void 0?1:p,g=r.strokeWidth,E=g===void 0?0:g,A=r.stroke,P=A===void 0?"rgba(0,0,0,0)":A,F=r.offsets,N=F===void 0?[0,0]:F,V=r.blend,Y=r.blur,ie=Y===void 0?0:Y,ye=r.raisingHeight,Pe=ye===void 0?0:ye,tt=r.heightfixed,pt=tt===void 0?!1:tt,vt=r.unit,Xt=vt===void 0?"l7size":vt;if(this.updateUnit(Xt),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:P,offsets:N})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:E,stroke:P,offsets:N});var er=this.layer.getEncodedData(),wr=this.calDataFrame(this.cellLength,er,this.cellProperties),kr=wr.data,Sr=wr.width,un=wr.height;this.rowCount=un,this.dataTexture=this.cellLength>0&&kr.length>0?this.createTexture2D({flipY:!0,data:kr,format:q.LUMINANCE,type:q.FLOAT,width:Sr,height:un}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Pe),u_heightfixed:Number(pt),u_meter2coord:this.meter2coord,u_meteryScale:this.meteryScale,u_isMeter:Number(this.isMeter),u_blur:ie,u_additive:V==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_stroke_opacity:(0,he.isNumber)(v)?v:1,u_stroke_width:(0,he.isNumber)(E)?E:1,u_stroke_color:this.getStrokeColor(P),u_offsets:this.isOffsetStatic(N)?N:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ko)}},{key:"initModels",value:function(r){this.updateUnit("l7size"),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Ir.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version,A=ka==null?void 0:ka.mapboxgl;if(E===Wu.MAPBOX&&A!==null&&A!==void 0&&A.MercatorCoordinate){var P=A.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),F=P.meterInMercatorCoordinateUnits(),N=new A.MercatorCoordinate(P.x-F,P.y,P.z),V=N.toLngLat(),Y=new A.MercatorCoordinate(P.x,P.y-F,P.z),ie=Y.toLngLat();this.meter2coord=g[0]-V.lng,this.meteryScale=(ie.lat-g[1])/this.meter2coord;return}var ye=this.mapService.meterToCoord(g,[o,u]),Pe=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(ye+Pe)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var i=(0,Va.Z)(yi().mark(function o(u){var p,v,g,E,A,P,F,N,V,Y,ie,ye,Pe,tt,pt;return yi().wrap(function(Xt){for(;;)switch(Xt.prev=Xt.next){case 0:p=this.layer.getLayerConfig(),v=p.mask,g=v===void 0?!1:v,E=p.maskInside,A=E===void 0?!0:E,P=p.animateOption,F=P===void 0?{enable:!1}:P,N=p.workerEnabled,V=N===void 0?!1:N,Y=p.enablePicking,ie=p.shape2d,ye=this.getShaders(F),Pe=ye.frag,tt=ye.vert,pt=ye.type,this.layer.triangulation=Ko,this.layer.buildLayerModel({moduleName:pt,vertexShader:tt,fragmentShader:Pe,triangulation:Ko,depth:{enable:!1},blend:this.getBlend(),stencil:nt(g,A),workerEnabled:V,workerOptions:{modelType:pt,enablePicking:Y,shape2d:ie}}).then(function(er){u([er])}).catch(function(er){console.warn(er),u([])});case 4:case"end":return Xt.stop()}},o,this)}));function r(o){return i.apply(this,arguments)}return r}()},{key:"getShaders",value:function(r){if(r.enable)switch(r.type){case"wave":return{frag:F1,vert:py,type:"pointWave"};default:return{frag:F1,vert:py,type:"pointWave"}}else return{frag:c5,vert:py,type:"pointFill"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=g%4*3;return[E[A],E[A+1],E[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?5:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,A=E===void 0?2:E,P=r.indexOf(A);return[P]}}})}},{key:"updateUnit",value:function(r){var o=this.mapService.version;this.unit!==r&&(this.unit!=="meter"&&r==="meter"&&o!==Wu.L7MAP&&o!==Wu.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&r!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=r)}}]),t}(Bo);function f5(e){var a=h5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function h5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p5=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,d5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,v5=function(e){(0,sn.Z)(t,e);var a=f5(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"meter2coord",1),(0,xe.Z)((0,jt.Z)(i),"isMeter",!1),(0,xe.Z)((0,jt.Z)(i),"radian",0),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.rotation,E=r.raisingHeight,A=E===void 0?0:E,P=r.heightfixed,F=P===void 0?!1:P;this.rendererService.getDirty()&&this.texture.bind();var N=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(N=-1),this.radian=g!==void 0?N*Math.PI*g/180:N*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var V=this.layer.getEncodedData(),Y=this.calDataFrame(this.cellLength,V,this.cellProperties),ie=Y.data,ye=Y.width,Pe=Y.height;this.rowCount=Pe,this.dataTexture=this.cellLength>0&&ie.length>0?this.createTexture2D({flipY:!0,data:ie,format:q.LUMINANCE,type:q.FLOAT,width:ye,height:Pe}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(A),u_heightfixed:Number(F),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,he.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$0)}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==Wu.L7MAP&&v!==Wu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Ir.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===Wu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),P=1,F=P*A.meterInMercatorCoordinateUnits(),N=new window.mapboxgl.MercatorCoordinate(A.x-F,A.y,A.z),V=N.toLngLat();this.meter2coord=g[0]-V.lng;return}var Y=this.mapService.meterToCoord(g,[o,u]),ie=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(Y+ie)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:d5,fragmentShader:p5,triangulation:$0,depth:{enable:!1},blend:this.getBlend(),stencil:nt(p,g),cull:{enable:!0,face:Lf(this.mapService.version)}}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o;this.iconService.off("imageUpdate",this.updateTexture),(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Gn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.rotate,A=E===void 0?0:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.shape,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=g%4*3;return[E[A],E[A+1],E[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?5:E;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}})}}]),t}(Bo);function m5(e){var a=g5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function g5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,_5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,B1=function(e){(0,sn.Z)(t,e);var a=m5(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"updateTexture",function(){var p=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),i.layer.renderLayers();return}i.texture=p({data:i.iconService.getCanvas(),mag:q.LINEAR,min:q.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128,mipmap:!0})}),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.raisingHeight,E=g===void 0?0:g,A=r.heightfixed,P=A===void 0?!1:A;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var F=this.layer.getEncodedData(),N=this.calDataFrame(this.cellLength,F,this.cellProperties),V=N.data,Y=N.width,ie=N.height;this.rowCount=ie,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:q.LUMINANCE,type:q.FLOAT,width:Y,height:ie}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(E),u_heightfixed:Number(P),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,he.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(r){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:_5,fragmentShader:y5,triangulation:oS,depth:{enable:!1},primitive:q.POINTS,blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?5:E;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Gn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(u,p,v,g){var E=r.iconService.getIconMap(),A=u.shape,P=E[A]||{x:0,y:0},F=P.x,N=P.y;return[F,N]}}})}}]),t}(Bo);function x5(e){var a=b5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function b5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,C5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function N1(e){var a=e.coordinates;return{vertices:(0,_e.Z)(a),indices:[0],size:a.length}}var z1=function(e){(0,sn.Z)(t,e);var a=x5(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var g=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,g,this.cellProperties),A=E.data,P=E.width,F=E.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:q.LUMINANCE,type:q.FLOAT,width:P,height:F}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=N1,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:C5,fragmentShader:E5,triangulation:N1,depth:{enable:!1},primitive:q.POINTS,blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0]]:[E]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Fh.additive}}}]),t}(Bo);function S5(e){var a=A5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function A5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w5=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,T5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,M5=function(e){(0,sn.Z)(t,e);var a=S5(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"meter2coord",1),(0,xe.Z)((0,jt.Z)(i),"isMeter",!1),i}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.blend,E=r.speed,A=E===void 0?1:E;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var P=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,P,this.cellProperties),N=F.data,V=F.width,Y=F.height;this.rowCount=Y,this.dataTexture=this.cellLength>0&&N.length>0?this.createTexture2D({flipY:!0,data:N,format:q.LUMINANCE,type:q.FLOAT,width:V,height:Y}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:A,u_additive:g==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$0)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,p=u===void 0?"l7size":u,v=this.mapService.version;p==="meter"&&v!==Wu.L7MAP&&v!==Wu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Ir.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],p=r[2],v=r[3],g=[(o+p)/2,(u+v)/2],E=this.mapService.version;if(E===Wu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:g[0],lat:g[1]},0),P=1,F=P*A.meterInMercatorCoordinateUnits(),N=new window.mapboxgl.MercatorCoordinate(A.x-F,A.y,A.z),V=N.toLngLat();this.meter2coord=g[0]-V.lng;return}var Y=this.mapService.meterToCoord(g,[o,u]),ie=this.mapService.meterToCoord(g,[p===o?p+.1:p,v===u?u+.1:v]);this.meter2coord=(Y+ie)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:T5,fragmentShader:w5,triangulation:$0,depth:{enable:!1},blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Gn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(u,p,v,g){var E=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=g%4*3;return[E[A],E[A+1],E[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.size,A=E===void 0?5:E;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Gn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(u,p,v,g){var E=u.shape,A=E===void 0?2:E,P=r.layer.getLayerConfig().shape2d,F=P.indexOf(A);return[F]}}})}}]),t}(Bo);function I5(e){var a=k5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function k5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,R5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function U1(e){var a=e.coordinates;return{vertices:(0,_e.Z)(a),indices:[0],size:a.length}}var L5=function(e){(0,sn.Z)(t,e);var a=I5(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.offsets,v=p===void 0?[0,0]:p,g=r.blend,E=r.strokeOpacity,A=E===void 0?1:E,P=r.strokeWidth,F=P===void 0?0:P,N=r.stroke,V=N===void 0?"#fff":N;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var Y=this.layer.getEncodedData(),ie=this.calDataFrame(this.cellLength,Y,this.cellProperties),ye=ie.data,Pe=ie.width,tt=ie.height;this.rowCount=tt,this.dataTexture=this.cellLength>0&&ye.length>0?this.createTexture2D({flipY:!0,data:ye,format:q.LUMINANCE,type:q.FLOAT,width:Pe,height:tt}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_additive:g==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0],u_stroke_opacity:(0,he.isNumber)(A)?A:1,u_stroke_width:(0,he.isNumber)(F)?F:1,u_stroke_color:this.getStrokeColor(V)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.triangulation=U1,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:R5,fragmentShader:P5,triangulation:U1,depth:{enable:!1},primitive:q.POINTS,blend:this.getBlend(),stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(o,u,p,v){var g=o.size,E=g===void 0?1:g;return Array.isArray(E)?[E[0]]:[E]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Fh.additive}}}]),t}(Bo),O5={fillImage:v5,fill:D1,radar:M5,image:B1,normal:z1,simplePoint:L5,extrude:O1,text:cy,vectorpoint:mg,tile:vg,earthFill:n5,earthExtrude:QT},F5=O5;function D5(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=B5(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(g){throw g},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,p;return{s:function(){t=t.call(e)},n:function(){var g=t.next();return o=g.done,g},e:function(g){u=!0,p=g},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw p}}}}function B5(e,a){if(!!e){if(typeof e=="string")return Z1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Z1(e,a)}}function Z1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function N5(e){var a=z5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function z5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U5=function(e){(0,sn.Z)(t,e);var a=N5(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","PointLayer"),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new F5[o](this),this.layerModel.initModels(function(u){r.models=u,r.layerService.updateLayerRenderList(),r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var r=this.shapeOption,o=r.field,u=r.values,p=this.getLayerConfig(),v=p.shape2d,g=p.shape3d,E=this.iconService.getIconMap();if(o&&(v==null?void 0:v.indexOf(o))!==-1)return"fill";if(u&&u instanceof Array){var A=D5(u),P;try{for(A.s();!(P=A.n()).done;){var F=P.value;if(typeof F=="string"&&E.hasOwnProperty(F))return"image"}}catch(N){A.e(N)}finally{A.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorpoint:{},tile:{},earthFill:{},earthExtrude:{}};return o[r]}},{key:"getModelType",value:function(){var r=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","vectorpoint","tile","earthFill","earthExtrude"];if(this.layerSource.parser.type==="mvt")return"vectorpoint";var o=this.getEncodedData(),u=this.getLayerConfig(),p=u.shape2d,v=u.shape3d,g=this.iconService.getIconMap(),E=o.find(function(P){return P.hasOwnProperty("shape")});if(E){var A=E.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(p==null?void 0:p.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(v==null?void 0:v.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":g.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Cd);function Z5(e){var a=V5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function V5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,G5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,H5=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,W5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,X5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,Y5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,q5=function(e){(0,sn.Z)(t,e);var a=Z5(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.heightfixed,v=p===void 0?!1:p,g=r.raisingHeight,E=g===void 0?0:g,A=r.topsurface,P=A===void 0?!0:A,F=r.sidesurface,N=F===void 0?!0:F,V=r.sourceColor,Y=r.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var ie=this.layer.getEncodedData(),ye=this.calDataFrame(this.cellLength,ie,this.cellProperties),Pe=ye.data,tt=ye.width,pt=ye.height;this.rowCount=pt,this.dataTexture=this.cellLength>0&&Pe.length>0?this.createTexture2D({flipY:!0,data:Pe,format:q.LUMINANCE,type:q.FLOAT,width:tt,height:pt}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}var vt=0,Xt=[1,1,1,1],er=[1,1,1,1];return V&&Y&&(Xt=W(V),er=W(Y),vt=1),{u_topsurface:Number(P),u_sidesurface:Number(N),u_heightfixed:Number(v),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(E),u_opacity:(0,he.isNumber)(u)?u:1,u_linearColor:vt,u_sourceColor:Xt,u_targetColor:er,u_texture:this.texture}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v,E=this.getShaders(),A=E.frag,P=E.vert,F=E.type;this.layer.buildLayerModel({moduleName:F,vertexShader:P,fragmentShader:A,triangulation:a1,stencil:nt(p,g)}).then(function(N){r([N])}).catch(function(N){console.warn(N),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.pickLight,u=r.mapTexture;return u?{frag:H5,vert:W5,type:"polygonExtrudeTexture"}:o?{frag:X5,vert:Y5,type:"polygonExtrudePickLight"}:{frag:j5,vert:G5,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var r,o;(r=this.dataTexture)===null||r===void 0||r.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Ir.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,A=g-p;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Gn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(F,N,V,Y,ie){var ye=V[0],Pe=V[1];return[(ye-u)/E,(Pe-p)/A,V[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Gn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(F,N,V,Y,ie){return ie}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Gn.Attribute,descriptor:{name:"a_Size",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(F,N,V,Y){var ie=F.size,ye=ie===void 0?10:ie;return Array.isArray(ye)?[ye[0]]:[ye]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mapTexture,p=this.rendererService.createTexture2D;if(this.texture=p({height:0,width:0}),u){var v=new Image;v.crossOrigin="",v.src=u,v.onload=function(){r.texture=p({data:v,width:v.width,height:v.height,wrapS:q.CLAMP_TO_EDGE,wrapT:q.CLAMP_TO_EDGE,min:q.LINEAR,mag:q.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}}]),t}(Bo);function $5(e){var a=K5();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function K5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q5=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,J5=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,eM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,tM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,rM=function(e){(0,sn.Z)(t,e);var a=$5(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.raisingHeight,u=o===void 0?0:o,p=r.opacity,v=p===void 0?1:p,g=r.opacityLinear,E=g===void 0?{enable:!1,dir:"in"}:g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var A=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,A,this.cellProperties),F=P.data,N=P.width,V=P.height;this.rowCount=V,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:q.LUMINANCE,type:q.FLOAT,width:N,height:V}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,he.isNumber)(v)?v:1,u_opacitylinear:Number(E.enable),u_dir:E.dir==="in"?1:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.getModelParams(),u=o.frag,p=o.vert,v=o.triangulation,g=o.type,E=this.layer.getLayerConfig(),A=E.mask,P=A===void 0?!1:A,F=E.maskInside,N=F===void 0?!0:F,V=E.workerEnabled,Y=V===void 0?!1:V,ie=E.enablePicking;this.layer.triangulation=v,this.layer.buildLayerModel({moduleName:g,vertexShader:p,fragmentShader:u,triangulation:v,primitive:q.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:nt(P,N),workerEnabled:Y,workerOptions:{modelType:g,enablePicking:ie}}).then(function(ye){r([ye])}).catch(function(ye){console.warn(ye),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Gn.Attribute,descriptor:{name:"a_linear",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:3,update:function(v,g,E,A,P){return[E[3],E[4],E[5]]}}})}},{key:"getModelParams",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:J5,vert:eM,type:"polygonLinear",triangulation:lS}:{frag:Q5,vert:tM,type:"polygonFill",triangulation:$h}}}]),t}(Bo);function nM(e){var a=iM();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function iM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aM=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,oM=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,sM=function(e){(0,sn.Z)(t,e);var a=nM(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.watercolor,v=p===void 0?"#6D99A8":p,g=r.watercolor2,E=g===void 0?"#0F121C":g;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var A=this.layer.getEncodedData(),P=this.calDataFrame(this.cellLength,A,this.cellProperties),F=P.data,N=P.width,V=P.height;this.rowCount=V,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:q.LUMINANCE,type:q.FLOAT,width:N,height:V}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:W(v),u_watercolor2:W(E),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,he.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:oM,fragmentShader:aM,triangulation:_m,primitive:q.TRIANGLES,depth:{enable:!1},stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o,u,p;(r=this.texture1)===null||r===void 0||r.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Ir.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,A=g-p;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Gn.Attribute,descriptor:{name:"a_uv",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(F,N,V,Y,ie){var ye=(0,Ir.Z)(V,2),Pe=ye[0],tt=ye[1];return[(Pe-u)/E,(tt-p)/A]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),p(function(g){r.texture1=v(g[0]),r.texture2=v(g[1]),r.texture3=v(g[2]),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()});function p(g){var E=0,A=[],P=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];P.map(function(F){var N=new Image;N.crossOrigin="",N.src=F,A.push(N),N.onload=function(){E++,E===3&&g(A)}})}function v(g){return o({data:g,width:g.width,height:g.height,wrapS:q.MIRRORED_REPEAT,wrapT:q.MIRRORED_REPEAT,min:q.LINEAR,mag:q.LINEAR})}}}]),t}(Bo);function uM(e){var a=lM();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,fM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,hM=function(e){(0,sn.Z)(t,e);var a=uM(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,p=r.speed,v=p===void 0?.5:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var g=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,g,this.cellProperties),A=E.data,P=E.width,F=E.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:q.LUMINANCE,type:q.FLOAT,width:P,height:F}):this.createTexture2D({flipY:!0,data:[1],format:q.LUMINANCE,type:q.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:v,u_opacity:(0,he.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,p=u===void 0?!1:u,v=o.maskInside,g=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:fM,fragmentShader:cM,triangulation:_m,primitive:q.TRIANGLES,depth:{enable:!1},stencil:nt(p,g)}).then(function(E){r([E])}).catch(function(E){console.warn(E),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Ir.Z)(r,4),u=o[0],p=o[1],v=o[2],g=o[3],E=v-u,A=g-p;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Gn.Attribute,descriptor:{name:"a_uv",buffer:{usage:q.STATIC_DRAW,data:[],type:q.FLOAT},size:2,update:function(F,N,V,Y,ie){var ye=(0,Ir.Z)(V,2),Pe=ye[0],tt=ye[1];return[(Pe-u)/E,(tt-p)/A]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.waterTexture,p=this.rendererService.createTexture2D;this.texture=p({height:0,width:0});var v=new Image;v.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),v.src=u):v.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",v.onload=function(){r.texture=p({data:v,width:v.width,height:v.height,wrapS:q.MIRRORED_REPEAT,wrapT:q.MIRRORED_REPEAT,min:q.LINEAR,mag:q.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}]),t}(Bo),pM={fill:rM,line:L1,extrude:q5,text:cy,point_fill:D1,point_image:B1,point_normal:z1,point_extrude:O1,water:hM,ocean:sM,vectorpolygon:mg,tile:T1},dM=pM;function vM(e){var a=mM();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function mM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V1=function(e){(0,sn.Z)(t,e);var a=vM(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","PolygonLayer"),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new dM[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r;if(this.layerSource.parser.type==="mvt")return"vectorpolygon";var o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="fill"?"fill":u==="extrude"?"extrude":u==="water"?"water":u==="ocean"?"ocean":u==="line"?"line":u==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,p=o.shape3d,v=this.iconService.getIconMap(),g=r.find(function(A){return A.hasOwnProperty("shape")});if(g){var E=g.shape;return E==="dot"?"point_normal":(u==null?void 0:u.indexOf(E))!==-1?"point_fill":(p==null?void 0:p.indexOf(E))!==-1?"point_extrude":v.hasOwnProperty(E)?"point_image":"text"}else return"fill"}}]),t}(Cd),gM={raster:fy,raster3d:fy,rasterTile:mg},yM=gM;function _M(e){var a=xM();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function xM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bM=function(e){(0,sn.Z)(t,e);var a=_M(t);function t(){var i;(0,Lt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return i=a.call.apply(a,[this].concat(o)),(0,xe.Z)((0,jt.Z)(i),"type","RasterLayer"),i}return(0,At.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new yM[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={raster:{},raster3d:{},rasterTile:{}};return o[r]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),t}(Cd),j1,G1,H1,W1,X1,bm,Y1,q1,$1,EM=(j1=(0,Nn.b2)(),G1=(0,Nn.f3)(nr.IGlobalConfigService),H1=(0,Nn.f3)(nr.IMapService),W1=(0,Nn.f3)(nr.IFontService),j1(X1=(bm=function(){function e(){(0,Lt.Z)(this,e),ya(this,"configService",Y1,this),ya(this,"mapService",q1,this),ya(this,"fontService",$1,this)}return(0,At.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){var u=t.getSource();u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){t.dataState.dataMappingNeedUpdate=!1;var u=t.getSource();return u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=t.getSource();if(!(t.layerModelNeedUpdate||!u||!u.inited)){var p=t.getBottomColor(),v=o.getLayerStyleAttributes()||[],g=o.getLayerStyleAttribute("filter"),E=u.data.dataArray,A=v.filter(function(F){return F.needRemapping}),P=E;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(P=E.filter(function(F){return r.applyAttributeMapping(g,F,p)[0]})),A.length&&(g!=null&&g.needRemapping?(t.setEncodedData(r.mapping(t,v,P,void 0,p)),g.needRemapping=!1):t.setEncodedData(r.mapping(t,A,P,t.getEncodedData(),p)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,i){var r=this,o=i.styleAttributeService,u=t.getBottomColor(),p=o.getLayerStyleAttributes()||[],v=o.getLayerStyleAttribute("filter"),g=t.getSource().data.dataArray,E=g;v!=null&&v.scale&&(E=g.filter(function(A){return r.applyAttributeMapping(v,A,u)[0]})),t.setEncodedData(this.mapping(t,p,E,void 0,u)),t.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(t,i){var r=[i[0]-t[0],i[1]-t[1]],o=ec(r),u=[t[0]+o[0]*1e-4,t[1]+o[1]*1e-4];return u}},{key:"mapping",value:function(t,i,r,o,u){var p=this,v=t.getLayerConfig(),g=v.arrow,E=g===void 0?{enable:!1}:g,A=r.map(function(P,F){var N=o?o[F]:{},V=(0,Z.Z)({id:P._id,coordinates:P.coordinates},N);if(i.filter(function(ye){return ye.scale!==void 0}).forEach(function(ye){var Pe=p.applyAttributeMapping(ye,P,u);ye.needRemapping=!1,ye.name==="color"&&(Pe=Pe.map(function(tt){return W(tt)})),V[ye.name]=Array.isArray(Pe)&&Pe.length===1?Pe[0]:Pe,ye.name==="shape"&&(V.shape=p.fontService.getIconFontKey(V[ye.name]))}),E.enable&&(V.shape==="line"||V.shape==="halfLine")){var Y=V.coordinates,ie=p.getArrowPoints(Y[0],Y[1]);V.coordinates.splice(1,0,ie,ie)}return V});return this.adjustData2Amap2Coordinates(A,t),this.adjustData2SimpleCoordinates(A),A}},{key:"adjustData2Amap2Coordinates",value:function(t,i){var r=this;if(t.length>0&&this.mapService.version===Wu["GAODE2.x"]){var o=this.getLayerCenter(i);typeof t[0].coordinates[0]=="number"?t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Wu["GAODE2.x"],u.originCoordinates=(0,he.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordByLayer(u.coordinates,o)}):t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Wu["GAODE2.x"],u.originCoordinates=(0,he.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"getLayerCenter",value:function(t){var i=t.getSource();return i.center}},{key:"adjustData2SimpleCoordinates",value:function(t){var i=this;t.length>0&&this.mapService.version===Wu.SIMPLE&&t.map(function(r){r.simpleCoordinate||(r.coordinates=i.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var i=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var r=[];return t.map(function(u){var p=[];u.map(function(v){p.push(i.mapService.simpleMapCoord.unproject(v))}),r.push(p)}),r}else{var o=[];return t.map(function(u){o.push(i.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(t,i,r){var o;if(!t.scale)return[];var u=(t==null||(o=t.scale)===null||o===void 0?void 0:o.scalers)||[],p=[];u.forEach(function(g){var E,A=g.field;(i.hasOwnProperty(A)||((E=t.scale)===null||E===void 0?void 0:E.type)==="variable")&&p.push(i[A])});var v=t.mapping?t.mapping(p):[];return t.name==="color"&&!z(v[0])?[r]:v}}]),e}(),Y1=ma(bm.prototype,"configService",[G1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q1=ma(bm.prototype,"mapService",[H1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$1=ma(bm.prototype,"fontService",[W1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm))||X1),K1,Q1,CM=(K1=(0,Nn.b2)(),K1(Q1=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"apply",value:function(t){var i=this;this.mapService=t.getContainer().get(nr.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var r=t.getSource();if(!r){var o=nd[t.type]||{data:T0,options:id},u=t.sourceOption||o,p=u.data,v=u.options;r=new Bc(p,v),t.setSource(r)}r.inited?i.updateClusterData(t):r.once("sourceUpdate",function(){i.updateClusterData(t)})}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=i.updateClusterData(t),o=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,r||o})}},{key:"updateClusterData",value:function(t){var i=t.getSource(),r=i.cluster,o=i.clusterOptions.zoom,u=o===void 0?0:o,p=this.mapService.getZoom()-1,v=t.dataState.dataSourceNeedUpdate;return r&&v&&i.updateClusterData(Math.floor(p)),r&&Math.abs(t.clusterZoom-p)>=1?(u!==Math.floor(p)&&i.updateClusterData(Math.floor(p)),t.clusterZoom=p,!0):!1}}]),e}())||Q1);function dy(e,a){return e<a?-1:e>a?1:e>=a?0:NaN}function J1(e){return e.length===1&&(e=SM(e)),{left:function(a,t,i,r){for(i==null&&(i=0),r==null&&(r=a.length);i<r;){var o=i+r>>>1;e(a[o],t)<0?i=o+1:r=o}return i},right:function(a,t,i,r){for(i==null&&(i=0),r==null&&(r=a.length);i<r;){var o=i+r>>>1;e(a[o],t)>0?r=o:i=o+1}return i}}}function SM(e){return function(a,t){return dy(e(a),t)}}var ex=J1(dy),AM=ex.right,AP=ex.left,gg=AM;function tx(e,a){var t=e.length,i=-1,r,o,u;if(a==null){for(;++i<t;)if((r=e[i])!=null&&r>=r)for(o=u=r;++i<t;)(r=e[i])!=null&&(o>r&&(o=r),u<r&&(u=r))}else for(;++i<t;)if((r=a(e[i],i,e))!=null&&r>=r)for(o=u=r;++i<t;)(r=a(e[i],i,e))!=null&&(o>r&&(o=r),u<r&&(u=r));return[o,u]}var rx=Array.prototype,wP=rx.slice,TP=rx.map,vy=Math.sqrt(50),gy=Math.sqrt(10),yy=Math.sqrt(2);function nx(e,a,t){var i,r=-1,o,u,p;if(a=+a,e=+e,t=+t,e===a&&t>0)return[e];if((i=a<e)&&(o=e,e=a,a=o),(p=yg(e,a,t))===0||!isFinite(p))return[];if(p>0)for(e=Math.ceil(e/p),a=Math.floor(a/p),u=new Array(o=Math.ceil(a-e+1));++r<o;)u[r]=(e+r)*p;else for(e=Math.floor(e*p),a=Math.ceil(a*p),u=new Array(o=Math.ceil(e-a+1));++r<o;)u[r]=(e-r)/p;return i&&u.reverse(),u}function yg(e,a,t){var i=(a-e)/Math.max(0,t),r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);return r>=0?(o>=vy?10:o>=gy?5:o>=yy?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=vy?10:o>=gy?5:o>=yy?2:1)}function _y(e,a,t){var i=Math.abs(a-e)/Math.max(0,t),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return o>=vy?r*=10:o>=gy?r*=5:o>=yy&&(r*=2),a<e?-r:r}function MP(){var e=identity,a=extent,t=sturges;function i(r){var o,u=r.length,p,v=new Array(u);for(o=0;o<u;++o)v[o]=e(r[o],o,r);var g=a(v),E=g[0],A=g[1],P=t(v,E,A);Array.isArray(P)||(P=tickStep(E,A,P),P=range(Math.ceil(E/P)*P,A,P));for(var F=P.length;P[0]<=E;)P.shift(),--F;for(;P[F-1]>A;)P.pop(),--F;var N=new Array(F+1),V;for(o=0;o<=F;++o)V=N[o]=[],V.x0=o>0?P[o-1]:E,V.x1=o<F?P[o]:A;for(o=0;o<u;++o)p=v[o],E<=p&&p<=A&&N[bisect(P,p,0,F)].push(r[o]);return N}return i.value=function(r){return arguments.length?(e=typeof r=="function"?r:constant(r),i):e},i.domain=function(r){return arguments.length?(a=typeof r=="function"?r:constant([r[0],r[1]]),i):a},i.thresholds=function(r){return arguments.length?(t=typeof r=="function"?r:Array.isArray(r)?constant(slice.call(r)):constant(r),i):t},i}function IP(e,a,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-a)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function wM(e){return e===null?NaN:+e}function TM(e,a,t){if(t==null&&(t=wM),!!(i=e.length)){if((a=+a)<=0||i<2)return+t(e[0],0,e);if(a>=1)return+t(e[i-1],i-1,e);var i,r=(i-1)*a,o=Math.floor(r),u=+t(e[o],o,e),p=+t(e[o+1],o+1,e);return u+(p-u)*(r-o)}}var MM=fe(87765),hp="$";function _g(){}_g.prototype=ix.prototype={constructor:_g,has:function(e){return hp+e in this},get:function(e){return this[hp+e]},set:function(e,a){return this[hp+e]=a,this},remove:function(e){var a=hp+e;return a in this&&delete this[a]},clear:function(){for(var e in this)e[0]===hp&&delete this[e]},keys:function(){var e=[];for(var a in this)a[0]===hp&&e.push(a.slice(1));return e},values:function(){var e=[];for(var a in this)a[0]===hp&&e.push(this[a]);return e},entries:function(){var e=[];for(var a in this)a[0]===hp&&e.push({key:a.slice(1),value:this[a]});return e},size:function(){var e=0;for(var a in this)a[0]===hp&&++e;return e},empty:function(){for(var e in this)if(e[0]===hp)return!1;return!0},each:function(e){for(var a in this)a[0]===hp&&e(this[a],a.slice(1),this)}};function ix(e,a){var t=new _g;if(e instanceof _g)e.each(function(p,v){t.set(v,p)});else if(Array.isArray(e)){var i=-1,r=e.length,o;if(a==null)for(;++i<r;)t.set(i,e[i]);else for(;++i<r;)t.set(a(o=e[i],i,e),o)}else if(e)for(var u in e)t.set(u,e[u]);return t}var xy=ix;function kP(){var e=[],a=[],t,i,r;function o(p,v,g,E){if(v>=e.length)return t!=null&&p.sort(t),i!=null?i(p):p;for(var A=-1,P=p.length,F=e[v++],N,V,Y=map(),ie,ye=g();++A<P;)(ie=Y.get(N=F(V=p[A])+""))?ie.push(V):Y.set(N,[V]);return Y.each(function(Pe,tt){E(ye,tt,o(Pe,v,g,E))}),ye}function u(p,v){if(++v>e.length)return p;var g,E=a[v-1];return i!=null&&v>=e.length?g=p.entries():(g=[],p.each(function(A,P){g.push({key:P,values:u(A,v)})})),E!=null?g.sort(function(A,P){return E(A.key,P.key)}):g}return r={object:function(p){return o(p,0,IM,kM)},map:function(p){return o(p,0,ax,ox)},entries:function(p){return u(o(p,0,ax,ox),0)},key:function(p){return e.push(p),r},sortKeys:function(p){return a[e.length-1]=p,r},sortValues:function(p){return t=p,r},rollup:function(p){return i=p,r}}}function IM(){return{}}function kM(e,a,t){e[a]=t}function ax(){return map()}function ox(e,a,t){e.set(a,t)}function xg(){}var Q0=xy.prototype;xg.prototype=PM.prototype={constructor:xg,has:Q0.has,add:function(e){return e+="",this[hp+e]=e,this},remove:Q0.remove,clear:Q0.clear,values:Q0.keys,size:Q0.size,empty:Q0.empty,each:Q0.each};function PM(e,a){var t=new xg;if(e instanceof xg)e.each(function(o){t.add(o)});else if(e){var i=-1,r=e.length;if(a==null)for(;++i<r;)t.add(e[i]);else for(;++i<r;)t.add(a(e[i],i,e))}return t}var PP=null,sx=Array.prototype,bg=sx.map,J0=sx.slice;function E0(e,a){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(a).domain(e);break}return this}function ux(e,a){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(a).domain(e);break}return this}var lx={name:"implicit"};function Eg(){var e=xy(),a=[],t=[],i=lx;function r(o){var u=o+"",p=e.get(u);if(!p){if(i!==lx)return i;e.set(u,p=a.push(o))}return t[(p-1)%t.length]}return r.domain=function(o){if(!arguments.length)return a.slice();a=[],e=xy();for(var u=-1,p=o.length,v,g;++u<p;)e.has(g=(v=o[u])+"")||e.set(g,a.push(v));return r},r.range=function(o){return arguments.length?(t=J0.call(o),r):t.slice()},r.unknown=function(o){return arguments.length?(i=o,r):i},r.copy=function(){return Eg(a,t).unknown(i)},E0.apply(r,arguments),r}function cx(){var e=ordinal().unknown(void 0),a=e.domain,t=e.range,i=[0,1],r,o,u=!1,p=0,v=0,g=.5;delete e.unknown;function E(){var A=a().length,P=i[1]<i[0],F=i[P-0],N=i[1-P];r=(N-F)/Math.max(1,A-p+v*2),u&&(r=Math.floor(r)),F+=(N-F-r*(A-p))*g,o=r*(1-p),u&&(F=Math.round(F),o=Math.round(o));var V=sequence(A).map(function(Y){return F+r*Y});return t(P?V.reverse():V)}return e.domain=function(A){return arguments.length?(a(A),E()):a()},e.range=function(A){return arguments.length?(i=[+A[0],+A[1]],E()):i.slice()},e.rangeRound=function(A){return i=[+A[0],+A[1]],u=!0,E()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(A){return arguments.length?(u=!!A,E()):u},e.padding=function(A){return arguments.length?(p=Math.min(1,v=+A),E()):p},e.paddingInner=function(A){return arguments.length?(p=Math.min(1,A),E()):p},e.paddingOuter=function(A){return arguments.length?(v=+A,E()):v},e.align=function(A){return arguments.length?(g=Math.max(0,Math.min(1,A)),E()):g},e.copy=function(){return cx(a(),i).round(u).paddingInner(p).paddingOuter(v).align(g)},initRange.apply(E(),arguments)}function fx(e){var a=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return fx(a())},e}function RP(){return fx(cx.apply(null,arguments).paddingInner(1))}var RM=fe(21775),LM=fe(73626);function OM(e,a){return e=+e,a=+a,function(t){return Math.round(e*(1-t)+a*t)}}function FM(e){return function(){return e}}function by(e){return+e}var hx=[0,1];function df(e){return e}function Ey(e,a){return(a-=e=+e)?function(t){return(t-e)/a}:FM(isNaN(a)?NaN:.5)}function px(e){var a=e[0],t=e[e.length-1],i;return a>t&&(i=a,a=t,t=i),function(r){return Math.max(a,Math.min(t,r))}}function DM(e,a,t){var i=e[0],r=e[1],o=a[0],u=a[1];return r<i?(i=Ey(r,i),o=t(u,o)):(i=Ey(i,r),o=t(o,u)),function(p){return o(i(p))}}function BM(e,a,t){var i=Math.min(e.length,a.length)-1,r=new Array(i),o=new Array(i),u=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),a=a.slice().reverse());++u<i;)r[u]=Ey(e[u],e[u+1]),o[u]=t(a[u],a[u+1]);return function(p){var v=gg(e,p,1,i)-1;return o[v](r[v](p))}}function Cg(e,a){return a.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Cy(){var e=hx,a=hx,t=RM.Z,i,r,o,u=df,p,v,g;function E(){return p=Math.min(e.length,a.length)>2?BM:DM,v=g=null,A}function A(P){return isNaN(P=+P)?o:(v||(v=p(e.map(i),a,t)))(i(u(P)))}return A.invert=function(P){return u(r((g||(g=p(a,e.map(i),LM.Z)))(P)))},A.domain=function(P){return arguments.length?(e=bg.call(P,by),u===df||(u=px(e)),E()):e.slice()},A.range=function(P){return arguments.length?(a=J0.call(P),E()):a.slice()},A.rangeRound=function(P){return a=J0.call(P),t=OM,E()},A.clamp=function(P){return arguments.length?(u=P?px(e):df,A):u!==df},A.interpolate=function(P){return arguments.length?(t=P,E()):t},A.unknown=function(P){return arguments.length?(o=P,A):o},function(P,F){return i=P,r=F,E()}}function dx(e,a){return Cy()(e,a)}var NM=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Sg(e){if(!(a=NM.exec(e)))throw new Error("invalid format: "+e);var a;return new Sy({fill:a[1],align:a[2],sign:a[3],symbol:a[4],zero:a[5],width:a[6],comma:a[7],precision:a[8]&&a[8].slice(1),trim:a[9],type:a[10]})}Sg.prototype=Sy.prototype;function Sy(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Sy.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function zM(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ag(e,a){if((t=(e=a?e.toExponential(a-1):e.toExponential()).indexOf("e"))<0)return null;var t,i=e.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+e.slice(t+1)]}function Ov(e){return e=Ag(Math.abs(e)),e?e[1]:NaN}function UM(e,a){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ov(a)/3)))*3-Ov(Math.abs(e)))}function ZM(e,a){return function(t,i){for(var r=t.length,o=[],u=0,p=e[0],v=0;r>0&&p>0&&(v+p+1>i&&(p=Math.max(1,i-v)),o.push(t.substring(r-=p,r+p)),!((v+=p+1)>i));)p=e[u=(u+1)%e.length];return o.reverse().join(a)}}function VM(e){return function(a){return a.replace(/[0-9]/g,function(t){return e[+t]})}}function jM(e){e:for(var a=e.length,t=1,i=-1,r;t<a;++t)switch(e[t]){case".":i=r=t;break;case"0":i===0&&(i=t),r=t;break;default:if(!+e[t])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var vx;function GM(e,a){var t=Ag(e,a);if(!t)return e+"";var i=t[0],r=t[1],o=r-(vx=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,u=i.length;return o===u?i:o>u?i+new Array(o-u+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Ag(e,Math.max(0,a+o-1))[0]}function mx(e,a){var t=Ag(e,a);if(!t)return e+"";var i=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}var gx={"%":function(e,a){return(e*100).toFixed(a)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:zM,e:function(e,a){return e.toExponential(a)},f:function(e,a){return e.toFixed(a)},g:function(e,a){return e.toPrecision(a)},o:function(e){return Math.round(e).toString(8)},p:function(e,a){return mx(e*100,a)},r:mx,s:GM,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function yx(e){return e}var _x=Array.prototype.map,xx=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function HM(e){var a=e.grouping===void 0||e.thousands===void 0?yx:ZM(_x.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?yx:VM(_x.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",p=e.minus===void 0?"-":e.minus+"",v=e.nan===void 0?"NaN":e.nan+"";function g(A){A=Sg(A);var P=A.fill,F=A.align,N=A.sign,V=A.symbol,Y=A.zero,ie=A.width,ye=A.comma,Pe=A.precision,tt=A.trim,pt=A.type;pt==="n"?(ye=!0,pt="g"):gx[pt]||(Pe===void 0&&(Pe=12),tt=!0,pt="g"),(Y||P==="0"&&F==="=")&&(Y=!0,P="0",F="=");var vt=V==="$"?t:V==="#"&&/[boxX]/.test(pt)?"0"+pt.toLowerCase():"",Xt=V==="$"?i:/[%p]/.test(pt)?u:"",er=gx[pt],wr=/[defgprs%]/.test(pt);Pe=Pe===void 0?6:/[gprs]/.test(pt)?Math.max(1,Math.min(21,Pe)):Math.max(0,Math.min(20,Pe));function kr(Sr){var un=vt,Dn=Xt,li,Da,$a;if(pt==="c")Dn=er(Sr)+Dn,Sr="";else{Sr=+Sr;var Fs=Sr<0||1/Sr<0;if(Sr=isNaN(Sr)?v:er(Math.abs(Sr),Pe),tt&&(Sr=jM(Sr)),Fs&&+Sr==0&&N!=="+"&&(Fs=!1),un=(Fs?N==="("?N:p:N==="-"||N==="("?"":N)+un,Dn=(pt==="s"?xx[8+vx/3]:"")+Dn+(Fs&&N==="("?")":""),wr){for(li=-1,Da=Sr.length;++li<Da;)if($a=Sr.charCodeAt(li),48>$a||$a>57){Dn=($a===46?r+Sr.slice(li+1):Sr.slice(li))+Dn,Sr=Sr.slice(0,li);break}}}ye&&!Y&&(Sr=a(Sr,Infinity));var Fu=un.length+Sr.length+Dn.length,xu=Fu<ie?new Array(ie-Fu+1).join(P):"";switch(ye&&Y&&(Sr=a(xu+Sr,xu.length?ie-Dn.length:Infinity),xu=""),F){case"<":Sr=un+Sr+Dn+xu;break;case"=":Sr=un+xu+Sr+Dn;break;case"^":Sr=xu.slice(0,Fu=xu.length>>1)+un+Sr+Dn+xu.slice(Fu);break;default:Sr=xu+un+Sr+Dn;break}return o(Sr)}return kr.toString=function(){return A+""},kr}function E(A,P){var F=g((A=Sg(A),A.type="f",A)),N=Math.max(-8,Math.min(8,Math.floor(Ov(P)/3)))*3,V=Math.pow(10,-N),Y=xx[8+N/3];return function(ie){return F(V*ie)+Y}}return{format:g,formatPrefix:E}}var wg,Ay,bx;WM({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function WM(e){return wg=HM(e),Ay=wg.format,bx=wg.formatPrefix,wg}function XM(e,a){return e=Math.abs(e),a=Math.abs(a)-e,Math.max(0,Ov(a)-Ov(e))+1}function YM(e){return Math.max(0,-Ov(Math.abs(e)))}function qM(e,a,t,i){var r=_y(e,a,t),o;switch(i=Sg(i==null?",f":i),i.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(a));return i.precision==null&&!isNaN(o=UM(r,u))&&(i.precision=o),bx(i,u)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(o=XM(r,Math.max(Math.abs(e),Math.abs(a))))&&(i.precision=o-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(o=YM(r))&&(i.precision=o-(i.type==="%")*2);break}}return Ay(i)}function Fv(e){var a=e.domain;return e.ticks=function(t){var i=a();return nx(i[0],i[i.length-1],t==null?10:t)},e.tickFormat=function(t,i){var r=a();return qM(r[0],r[r.length-1],t==null?10:t,i)},e.nice=function(t){t==null&&(t=10);var i=a(),r=0,o=i.length-1,u=i[r],p=i[o],v;return p<u&&(v=u,u=p,p=v,v=r,r=o,o=v),v=yg(u,p,t),v>0?(u=Math.floor(u/v)*v,p=Math.ceil(p/v)*v,v=yg(u,p,t)):v<0&&(u=Math.ceil(u*v)/v,p=Math.floor(p*v)/v,v=yg(u,p,t)),v>0?(i[r]=Math.floor(u/v)*v,i[o]=Math.ceil(p/v)*v,a(i)):v<0&&(i[r]=Math.ceil(u*v)/v,i[o]=Math.floor(p*v)/v,a(i)),e},e}function Ex(){var e=dx(df,df);return e.copy=function(){return Cg(e,Ex())},E0.apply(e,arguments),Fv(e)}function Cx(e){var a;function t(i){return isNaN(i=+i)?a:i}return t.invert=t,t.domain=t.range=function(i){return arguments.length?(e=bg.call(i,by),t):e.slice()},t.unknown=function(i){return arguments.length?(a=i,t):a},t.copy=function(){return Cx(e).unknown(a)},e=arguments.length?bg.call(e,by):[0,1],Fv(t)}function Sx(e,a){e=e.slice();var t=0,i=e.length-1,r=e[t],o=e[i],u;return o<r&&(u=t,t=i,i=u,u=r,r=o,o=u),e[t]=a.floor(r),e[i]=a.ceil(o),e}function Ax(e){return Math.log(e)}function Tx(e){return Math.exp(e)}function $M(e){return-Math.log(-e)}function KM(e){return-Math.exp(-e)}function QM(e){return isFinite(e)?+("1e"+e):e<0?0:e}function JM(e){return e===10?QM:e===Math.E?Math.exp:function(a){return Math.pow(e,a)}}function e3(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(a){return Math.log(a)/e})}function Mx(e){return function(a){return-e(-a)}}function t3(e){var a=e(Ax,Tx),t=a.domain,i=10,r,o;function u(){return r=e3(i),o=JM(i),t()[0]<0?(r=Mx(r),o=Mx(o),e($M,KM)):e(Ax,Tx),a}return a.base=function(p){return arguments.length?(i=+p,u()):i},a.domain=function(p){return arguments.length?(t(p),u()):t()},a.ticks=function(p){var v=t(),g=v[0],E=v[v.length-1],A;(A=E<g)&&(P=g,g=E,E=P);var P=r(g),F=r(E),N,V,Y,ie=p==null?10:+p,ye=[];if(!(i%1)&&F-P<ie){if(P=Math.round(P)-1,F=Math.round(F)+1,g>0){for(;P<F;++P)for(V=1,N=o(P);V<i;++V)if(Y=N*V,!(Y<g)){if(Y>E)break;ye.push(Y)}}else for(;P<F;++P)for(V=i-1,N=o(P);V>=1;--V)if(Y=N*V,!(Y<g)){if(Y>E)break;ye.push(Y)}}else ye=nx(P,F,Math.min(F-P,ie)).map(o);return A?ye.reverse():ye},a.tickFormat=function(p,v){if(v==null&&(v=i===10?".0e":","),typeof v!="function"&&(v=Ay(v)),p===Infinity)return v;p==null&&(p=10);var g=Math.max(1,i*p/a.ticks().length);return function(E){var A=E/o(Math.round(r(E)));return A*i<i-.5&&(A*=i),A<=g?v(E):""}},a.nice=function(){return t(Sx(t(),{floor:function(p){return o(Math.floor(r(p)))},ceil:function(p){return o(Math.ceil(r(p)))}}))},a}function Ix(){var e=t3(Cy()).domain([1,10]);return e.copy=function(){return Cg(e,Ix()).base(e.base())},E0.apply(e,arguments),e}function kx(e){return function(a){return Math.sign(a)*Math.log1p(Math.abs(a/e))}}function Px(e){return function(a){return Math.sign(a)*Math.expm1(Math.abs(a))*e}}function r3(e){var a=1,t=e(kx(a),Px(a));return t.constant=function(i){return arguments.length?e(kx(a=+i),Px(a)):a},linearish(t)}function n3(){var e=r3(transformer());return e.copy=function(){return copy(e,n3()).constant(e.constant())},initRange.apply(e,arguments)}function Rx(e){return function(a){return a<0?-Math.pow(-a,e):Math.pow(a,e)}}function i3(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function a3(e){return e<0?-e*e:e*e}function o3(e){var a=e(df,df),t=1;function i(){return t===1?e(df,df):t===.5?e(i3,a3):e(Rx(t),Rx(1/t))}return a.exponent=function(r){return arguments.length?(t=+r,i()):t},Fv(a)}function wy(){var e=o3(Cy());return e.copy=function(){return Cg(e,wy()).exponent(e.exponent())},E0.apply(e,arguments),e}function LP(){return wy.apply(null,arguments).exponent(.5)}function Lx(){var e=[],a=[],t=[],i;function r(){var u=0,p=Math.max(1,a.length);for(t=new Array(p-1);++u<p;)t[u-1]=TM(e,u/p);return o}function o(u){return isNaN(u=+u)?i:a[gg(t,u)]}return o.invertExtent=function(u){var p=a.indexOf(u);return p<0?[NaN,NaN]:[p>0?t[p-1]:e[0],p<t.length?t[p]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var p=0,v=u.length,g;p<v;++p)g=u[p],g!=null&&!isNaN(g=+g)&&e.push(g);return e.sort(dy),r()},o.range=function(u){return arguments.length?(a=J0.call(u),r()):a.slice()},o.unknown=function(u){return arguments.length?(i=u,o):i},o.quantiles=function(){return t.slice()},o.copy=function(){return Lx().domain(e).range(a).unknown(i)},E0.apply(o,arguments)}function Ox(){var e=0,a=1,t=1,i=[.5],r=[0,1],o;function u(v){return v<=v?r[gg(i,v,0,t)]:o}function p(){var v=-1;for(i=new Array(t);++v<t;)i[v]=((v+1)*a-(v-t)*e)/(t+1);return u}return u.domain=function(v){return arguments.length?(e=+v[0],a=+v[1],p()):[e,a]},u.range=function(v){return arguments.length?(t=(r=J0.call(v)).length-1,p()):r.slice()},u.invertExtent=function(v){var g=r.indexOf(v);return g<0?[NaN,NaN]:g<1?[e,i[0]]:g>=t?[i[t-1],a]:[i[g-1],i[g]]},u.unknown=function(v){return arguments.length&&(o=v),u},u.thresholds=function(){return i.slice()},u.copy=function(){return Ox().domain([e,a]).range(r).unknown(o)},E0.apply(Fv(u),arguments)}function Fx(){var e=[.5],a=[0,1],t,i=1;function r(o){return o<=o?a[gg(e,o,0,i)]:t}return r.domain=function(o){return arguments.length?(e=J0.call(o),i=Math.min(e.length,a.length-1),r):e.slice()},r.range=function(o){return arguments.length?(a=J0.call(o),i=Math.min(e.length,a.length-1),r):a.slice()},r.invertExtent=function(o){var u=a.indexOf(o);return[e[u-1],e[u]]},r.unknown=function(o){return arguments.length?(t=o,r):t},r.copy=function(){return Fx().domain(e).range(a).unknown(t)},E0.apply(r,arguments)}var Ty=new Date,My=new Date;function Vf(e,a,t,i){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=function(o){return e(o=new Date(+o)),o},r.ceil=function(o){return e(o=new Date(o-1)),a(o,1),e(o),o},r.round=function(o){var u=r(o),p=r.ceil(o);return o-u<p-o?u:p},r.offset=function(o,u){return a(o=new Date(+o),u==null?1:Math.floor(u)),o},r.range=function(o,u,p){var v=[],g;if(o=r.ceil(o),p=p==null?1:Math.floor(p),!(o<u)||!(p>0))return v;do v.push(g=new Date(+o)),a(o,p),e(o);while(g<o&&o<u);return v},r.filter=function(o){return Vf(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,p){if(u>=u)if(p<0)for(;++p<=0;)for(;a(u,-1),!o(u););else for(;--p>=0;)for(;a(u,1),!o(u););})},t&&(r.count=function(o,u){return Ty.setTime(+o),My.setTime(+u),e(Ty),e(My),Math.floor(t(Ty,My))},r.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(i?function(u){return i(u)%o==0}:function(u){return r.count(0,u)%o==0}):r}),r}var Iy=Vf(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,a){e.setFullYear(e.getFullYear()+a)},function(e,a){return a.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Iy.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Vf(function(a){a.setFullYear(Math.floor(a.getFullYear()/e)*e),a.setMonth(0,1),a.setHours(0,0,0,0)},function(a,t){a.setFullYear(a.getFullYear()+t*e)})};var Dv=Iy,OP=Iy.range,Dx=Vf(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,a){e.setMonth(e.getMonth()+a)},function(e,a){return a.getMonth()-e.getMonth()+(a.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),s3=Dx,FP=Dx.range,Tg=1e3,Em=6e4,Bx=36e5,Nx=864e5,zx=6048e5;function ev(e){return Vf(function(a){a.setDate(a.getDate()-(a.getDay()+7-e)%7),a.setHours(0,0,0,0)},function(a,t){a.setDate(a.getDate()+t*7)},function(a,t){return(t-a-(t.getTimezoneOffset()-a.getTimezoneOffset())*Em)/zx})}var ky=ev(0),Mg=ev(1),u3=ev(2),l3=ev(3),Bv=ev(4),c3=ev(5),f3=ev(6),DP=ky.range,BP=Mg.range,NP=u3.range,zP=l3.range,UP=Bv.range,ZP=c3.range,VP=f3.range,Ux=Vf(function(e){e.setHours(0,0,0,0)},function(e,a){e.setDate(e.getDate()+a)},function(e,a){return(a-e-(a.getTimezoneOffset()-e.getTimezoneOffset())*Em)/Nx},function(e){return e.getDate()-1}),Py=Ux,jP=Ux.range,Zx=Vf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Tg-e.getMinutes()*Em)},function(e,a){e.setTime(+e+a*Bx)},function(e,a){return(a-e)/Bx},function(e){return e.getHours()}),h3=Zx,GP=Zx.range,Vx=Vf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Tg)},function(e,a){e.setTime(+e+a*Em)},function(e,a){return(a-e)/Em},function(e){return e.getMinutes()}),p3=Vx,HP=Vx.range,jx=Vf(function(e){e.setTime(e-e.getMilliseconds())},function(e,a){e.setTime(+e+a*Tg)},function(e,a){return(a-e)/Tg},function(e){return e.getUTCSeconds()}),d3=jx,WP=jx.range,Ig=Vf(function(){},function(e,a){e.setTime(+e+a)},function(e,a){return a-e});Ig.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Vf(function(a){a.setTime(Math.floor(a/e)*e)},function(a,t){a.setTime(+a+t*e)},function(a,t){return(t-a)/e}):Ig};var v3=Ig,XP=Ig.range;function tv(e){return Vf(function(a){a.setUTCDate(a.getUTCDate()-(a.getUTCDay()+7-e)%7),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCDate(a.getUTCDate()+t*7)},function(a,t){return(t-a)/zx})}var Gx=tv(0),kg=tv(1),m3=tv(2),g3=tv(3),Nv=tv(4),y3=tv(5),_3=tv(6),YP=Gx.range,qP=kg.range,$P=m3.range,KP=g3.range,QP=Nv.range,JP=y3.range,eR=_3.range,Hx=Vf(function(e){e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCDate(e.getUTCDate()+a)},function(e,a){return(a-e)/Nx},function(e){return e.getUTCDate()-1}),Wx=Hx,tR=Hx.range,Ry=Vf(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCFullYear(e.getUTCFullYear()+a)},function(e,a){return a.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Ry.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Vf(function(a){a.setUTCFullYear(Math.floor(a.getUTCFullYear()/e)*e),a.setUTCMonth(0,1),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCFullYear(a.getUTCFullYear()+t*e)})};var Cm=Ry,rR=Ry.range;function Ly(e){if(0<=e.y&&e.y<100){var a=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return a.setFullYear(e.y),a}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Oy(e){if(0<=e.y&&e.y<100){var a=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return a.setUTCFullYear(e.y),a}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Sm(e,a,t){return{y:e,m:a,d:t,H:0,M:0,S:0,L:0}}function x3(e){var a=e.dateTime,t=e.date,i=e.time,r=e.periods,o=e.days,u=e.shortDays,p=e.months,v=e.shortMonths,g=Am(r),E=wm(r),A=Am(o),P=wm(o),F=Am(u),N=wm(u),V=Am(p),Y=wm(p),ie=Am(v),ye=wm(v),Pe={a:Fs,A:Fu,b:xu,B:vf,c:null,d:Qx,e:Qx,f:j3,g:J3,G:t4,H:U3,I:Z3,j:V3,L:Jx,m:G3,M:H3,p:S0,q:A0,Q:ab,s:ob,S:W3,u:X3,U:Y3,V:q3,w:$3,W:K3,x:null,X:null,y:Q3,Y:e4,Z:r4,"%":ib},tt={a:iv,A:jv,b:av,B:Gv,c:null,d:tb,e:tb,f:o4,g:m4,G:y4,H:n4,I:i4,j:a4,L:rb,m:s4,M:u4,p:Hy,q:Wy,Q:ab,s:ob,S:l4,u:c4,U:f4,V:h4,w:p4,W:d4,x:null,X:null,y:v4,Y:g4,Z:_4,"%":ib},pt={a:kr,A:Sr,b:un,B:Dn,c:li,d:$x,e:$x,f:D3,g:qx,G:Yx,H:Kx,I:Kx,j:R3,L:F3,m:P3,M:L3,p:wr,q:k3,Q:N3,s:z3,S:O3,u:A3,U:w3,V:T3,w:S3,W:M3,x:Da,X:$a,y:qx,Y:Yx,Z:I3,"%":B3};Pe.x=vt(t,Pe),Pe.X=vt(i,Pe),Pe.c=vt(a,Pe),tt.x=vt(t,tt),tt.X=vt(i,tt),tt.c=vt(a,tt);function vt(aa,No){return function(fs){var ui=[],lh=-1,hu=0,Bh=aa.length,Nh,ov,q2;for(fs instanceof Date||(fs=new Date(+fs));++lh<Bh;)aa.charCodeAt(lh)===37&&(ui.push(aa.slice(hu,lh)),(ov=Xx[Nh=aa.charAt(++lh)])!=null?Nh=aa.charAt(++lh):ov=Nh==="e"?" ":"0",(q2=No[Nh])&&(Nh=q2(fs,ov)),ui.push(Nh),hu=lh+1);return ui.push(aa.slice(hu,lh)),ui.join("")}}function Xt(aa,No){return function(fs){var ui=Sm(1900,void 0,1),lh=er(ui,aa,fs+="",0),hu,Bh;if(lh!=fs.length)return null;if("Q"in ui)return new Date(ui.Q);if("s"in ui)return new Date(ui.s*1e3+("L"in ui?ui.L:0));if(No&&!("Z"in ui)&&(ui.Z=0),"p"in ui&&(ui.H=ui.H%12+ui.p*12),ui.m===void 0&&(ui.m="q"in ui?ui.q:0),"V"in ui){if(ui.V<1||ui.V>53)return null;"w"in ui||(ui.w=1),"Z"in ui?(hu=Oy(Sm(ui.y,0,1)),Bh=hu.getUTCDay(),hu=Bh>4||Bh===0?kg.ceil(hu):kg(hu),hu=Wx.offset(hu,(ui.V-1)*7),ui.y=hu.getUTCFullYear(),ui.m=hu.getUTCMonth(),ui.d=hu.getUTCDate()+(ui.w+6)%7):(hu=Ly(Sm(ui.y,0,1)),Bh=hu.getDay(),hu=Bh>4||Bh===0?Mg.ceil(hu):Mg(hu),hu=Py.offset(hu,(ui.V-1)*7),ui.y=hu.getFullYear(),ui.m=hu.getMonth(),ui.d=hu.getDate()+(ui.w+6)%7)}else("W"in ui||"U"in ui)&&("w"in ui||(ui.w="u"in ui?ui.u%7:"W"in ui?1:0),Bh="Z"in ui?Oy(Sm(ui.y,0,1)).getUTCDay():Ly(Sm(ui.y,0,1)).getDay(),ui.m=0,ui.d="W"in ui?(ui.w+6)%7+ui.W*7-(Bh+5)%7:ui.w+ui.U*7-(Bh+6)%7);return"Z"in ui?(ui.H+=ui.Z/100|0,ui.M+=ui.Z%100,Oy(ui)):Ly(ui)}}function er(aa,No,fs,ui){for(var lh=0,hu=No.length,Bh=fs.length,Nh,ov;lh<hu;){if(ui>=Bh)return-1;if(Nh=No.charCodeAt(lh++),Nh===37){if(Nh=No.charAt(lh++),ov=pt[Nh in Xx?No.charAt(lh++):Nh],!ov||(ui=ov(aa,fs,ui))<0)return-1}else if(Nh!=fs.charCodeAt(ui++))return-1}return ui}function wr(aa,No,fs){var ui=g.exec(No.slice(fs));return ui?(aa.p=E[ui[0].toLowerCase()],fs+ui[0].length):-1}function kr(aa,No,fs){var ui=F.exec(No.slice(fs));return ui?(aa.w=N[ui[0].toLowerCase()],fs+ui[0].length):-1}function Sr(aa,No,fs){var ui=A.exec(No.slice(fs));return ui?(aa.w=P[ui[0].toLowerCase()],fs+ui[0].length):-1}function un(aa,No,fs){var ui=ie.exec(No.slice(fs));return ui?(aa.m=ye[ui[0].toLowerCase()],fs+ui[0].length):-1}function Dn(aa,No,fs){var ui=V.exec(No.slice(fs));return ui?(aa.m=Y[ui[0].toLowerCase()],fs+ui[0].length):-1}function li(aa,No,fs){return er(aa,a,No,fs)}function Da(aa,No,fs){return er(aa,t,No,fs)}function $a(aa,No,fs){return er(aa,i,No,fs)}function Fs(aa){return u[aa.getDay()]}function Fu(aa){return o[aa.getDay()]}function xu(aa){return v[aa.getMonth()]}function vf(aa){return p[aa.getMonth()]}function S0(aa){return r[+(aa.getHours()>=12)]}function A0(aa){return 1+~~(aa.getMonth()/3)}function iv(aa){return u[aa.getUTCDay()]}function jv(aa){return o[aa.getUTCDay()]}function av(aa){return v[aa.getUTCMonth()]}function Gv(aa){return p[aa.getUTCMonth()]}function Hy(aa){return r[+(aa.getUTCHours()>=12)]}function Wy(aa){return 1+~~(aa.getUTCMonth()/3)}return{format:function(aa){var No=vt(aa+="",Pe);return No.toString=function(){return aa},No},parse:function(aa){var No=Xt(aa+="",!1);return No.toString=function(){return aa},No},utcFormat:function(aa){var No=vt(aa+="",tt);return No.toString=function(){return aa},No},utcParse:function(aa){var No=Xt(aa+="",!0);return No.toString=function(){return aa},No}}}var Xx={"-":"",_:" ","0":"0"},fc=/^\s*\d+/,b3=/^%/,E3=/[\\^$*+?|[\]().{}]/g;function cs(e,a,t){var i=e<0?"-":"",r=(i?-e:e)+"",o=r.length;return i+(o<t?new Array(t-o+1).join(a)+r:r)}function C3(e){return e.replace(E3,"\\$&")}function Am(e){return new RegExp("^(?:"+e.map(C3).join("|")+")","i")}function wm(e){for(var a={},t=-1,i=e.length;++t<i;)a[e[t].toLowerCase()]=t;return a}function S3(e,a,t){var i=fc.exec(a.slice(t,t+1));return i?(e.w=+i[0],t+i[0].length):-1}function A3(e,a,t){var i=fc.exec(a.slice(t,t+1));return i?(e.u=+i[0],t+i[0].length):-1}function w3(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.U=+i[0],t+i[0].length):-1}function T3(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.V=+i[0],t+i[0].length):-1}function M3(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.W=+i[0],t+i[0].length):-1}function Yx(e,a,t){var i=fc.exec(a.slice(t,t+4));return i?(e.y=+i[0],t+i[0].length):-1}function qx(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),t+i[0].length):-1}function I3(e,a,t){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(a.slice(t,t+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),t+i[0].length):-1}function k3(e,a,t){var i=fc.exec(a.slice(t,t+1));return i?(e.q=i[0]*3-3,t+i[0].length):-1}function P3(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.m=i[0]-1,t+i[0].length):-1}function $x(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.d=+i[0],t+i[0].length):-1}function R3(e,a,t){var i=fc.exec(a.slice(t,t+3));return i?(e.m=0,e.d=+i[0],t+i[0].length):-1}function Kx(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.H=+i[0],t+i[0].length):-1}function L3(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.M=+i[0],t+i[0].length):-1}function O3(e,a,t){var i=fc.exec(a.slice(t,t+2));return i?(e.S=+i[0],t+i[0].length):-1}function F3(e,a,t){var i=fc.exec(a.slice(t,t+3));return i?(e.L=+i[0],t+i[0].length):-1}function D3(e,a,t){var i=fc.exec(a.slice(t,t+6));return i?(e.L=Math.floor(i[0]/1e3),t+i[0].length):-1}function B3(e,a,t){var i=b3.exec(a.slice(t,t+1));return i?t+i[0].length:-1}function N3(e,a,t){var i=fc.exec(a.slice(t));return i?(e.Q=+i[0],t+i[0].length):-1}function z3(e,a,t){var i=fc.exec(a.slice(t));return i?(e.s=+i[0],t+i[0].length):-1}function Qx(e,a){return cs(e.getDate(),a,2)}function U3(e,a){return cs(e.getHours(),a,2)}function Z3(e,a){return cs(e.getHours()%12||12,a,2)}function V3(e,a){return cs(1+Py.count(Dv(e),e),a,3)}function Jx(e,a){return cs(e.getMilliseconds(),a,3)}function j3(e,a){return Jx(e,a)+"000"}function G3(e,a){return cs(e.getMonth()+1,a,2)}function H3(e,a){return cs(e.getMinutes(),a,2)}function W3(e,a){return cs(e.getSeconds(),a,2)}function X3(e){var a=e.getDay();return a===0?7:a}function Y3(e,a){return cs(ky.count(Dv(e)-1,e),a,2)}function eb(e){var a=e.getDay();return a>=4||a===0?Bv(e):Bv.ceil(e)}function q3(e,a){return e=eb(e),cs(Bv.count(Dv(e),e)+(Dv(e).getDay()===4),a,2)}function $3(e){return e.getDay()}function K3(e,a){return cs(Mg.count(Dv(e)-1,e),a,2)}function Q3(e,a){return cs(e.getFullYear()%100,a,2)}function J3(e,a){return e=eb(e),cs(e.getFullYear()%100,a,2)}function e4(e,a){return cs(e.getFullYear()%1e4,a,4)}function t4(e,a){var t=e.getDay();return e=t>=4||t===0?Bv(e):Bv.ceil(e),cs(e.getFullYear()%1e4,a,4)}function r4(e){var a=e.getTimezoneOffset();return(a>0?"-":(a*=-1,"+"))+cs(a/60|0,"0",2)+cs(a%60,"0",2)}function tb(e,a){return cs(e.getUTCDate(),a,2)}function n4(e,a){return cs(e.getUTCHours(),a,2)}function i4(e,a){return cs(e.getUTCHours()%12||12,a,2)}function a4(e,a){return cs(1+Wx.count(Cm(e),e),a,3)}function rb(e,a){return cs(e.getUTCMilliseconds(),a,3)}function o4(e,a){return rb(e,a)+"000"}function s4(e,a){return cs(e.getUTCMonth()+1,a,2)}function u4(e,a){return cs(e.getUTCMinutes(),a,2)}function l4(e,a){return cs(e.getUTCSeconds(),a,2)}function c4(e){var a=e.getUTCDay();return a===0?7:a}function f4(e,a){return cs(Gx.count(Cm(e)-1,e),a,2)}function nb(e){var a=e.getUTCDay();return a>=4||a===0?Nv(e):Nv.ceil(e)}function h4(e,a){return e=nb(e),cs(Nv.count(Cm(e),e)+(Cm(e).getUTCDay()===4),a,2)}function p4(e){return e.getUTCDay()}function d4(e,a){return cs(kg.count(Cm(e)-1,e),a,2)}function v4(e,a){return cs(e.getUTCFullYear()%100,a,2)}function m4(e,a){return e=nb(e),cs(e.getUTCFullYear()%100,a,2)}function g4(e,a){return cs(e.getUTCFullYear()%1e4,a,4)}function y4(e,a){var t=e.getUTCDay();return e=t>=4||t===0?Nv(e):Nv.ceil(e),cs(e.getUTCFullYear()%1e4,a,4)}function _4(){return"+0000"}function ib(){return"%"}function ab(e){return+e}function ob(e){return Math.floor(+e/1e3)}var zv,sb,x4,b4,E4;C4({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function C4(e){return zv=x3(e),sb=zv.format,x4=zv.parse,b4=zv.utcFormat,E4=zv.utcParse,zv}var Tm=1e3,Mm=Tm*60,Im=Mm*60,km=Im*24,S4=km*7,ub=km*30,Fy=km*365;function A4(e){return new Date(e)}function w4(e){return e instanceof Date?+e:+new Date(+e)}function lb(e,a,t,i,r,o,u,p,v){var g=dx(df,df),E=g.invert,A=g.domain,P=v(".%L"),F=v(":%S"),N=v("%I:%M"),V=v("%I %p"),Y=v("%a %d"),ie=v("%b %d"),ye=v("%B"),Pe=v("%Y"),tt=[[u,1,Tm],[u,5,5*Tm],[u,15,15*Tm],[u,30,30*Tm],[o,1,Mm],[o,5,5*Mm],[o,15,15*Mm],[o,30,30*Mm],[r,1,Im],[r,3,3*Im],[r,6,6*Im],[r,12,12*Im],[i,1,km],[i,2,2*km],[t,1,S4],[a,1,ub],[a,3,3*ub],[e,1,Fy]];function pt(Xt){return(u(Xt)<Xt?P:o(Xt)<Xt?F:r(Xt)<Xt?N:i(Xt)<Xt?V:a(Xt)<Xt?t(Xt)<Xt?Y:ie:e(Xt)<Xt?ye:Pe)(Xt)}function vt(Xt,er,wr,kr){if(Xt==null&&(Xt=10),typeof Xt=="number"){var Sr=Math.abs(wr-er)/Xt,un=J1(function(Dn){return Dn[2]}).right(tt,Sr);un===tt.length?(kr=_y(er/Fy,wr/Fy,Xt),Xt=e):un?(un=tt[Sr/tt[un-1][2]<tt[un][2]/Sr?un-1:un],kr=un[1],Xt=un[0]):(kr=Math.max(_y(er,wr,Xt),1),Xt=p)}return kr==null?Xt:Xt.every(kr)}return g.invert=function(Xt){return new Date(E(Xt))},g.domain=function(Xt){return arguments.length?A(bg.call(Xt,w4)):A().map(A4)},g.ticks=function(Xt,er){var wr=A(),kr=wr[0],Sr=wr[wr.length-1],un=Sr<kr,Dn;return un&&(Dn=kr,kr=Sr,Sr=Dn),Dn=vt(Xt,kr,Sr,er),Dn=Dn?Dn.range(kr,Sr+1):[],un?Dn.reverse():Dn},g.tickFormat=function(Xt,er){return er==null?pt:v(er)},g.nice=function(Xt,er){var wr=A();return(Xt=vt(Xt,wr[0],wr[wr.length-1],er))?A(Sx(wr,Xt)):g},g.copy=function(){return Cg(g,lb(e,a,t,i,r,o,u,p,v))},g}function T4(){return E0.apply(lb(Dv,s3,ky,Py,h3,p3,d3,v3,sb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function nR(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Pg(){var e=0,a=1,t,i,r,o,u=df,p=!1,v;function g(E){return isNaN(E=+E)?v:u(r===0?.5:(E=(o(E)-t)*r,p?Math.max(0,Math.min(1,E)):E))}return g.domain=function(E){return arguments.length?(t=o(e=+E[0]),i=o(a=+E[1]),r=t===i?0:1/(i-t),g):[e,a]},g.clamp=function(E){return arguments.length?(p=!!E,g):p},g.interpolator=function(E){return arguments.length?(u=E,g):u},g.unknown=function(E){return arguments.length?(v=E,g):v},function(E){return o=E,t=E(e),i=E(a),r=t===i?0:1/(i-t),g}}function Pm(e,a){return a.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function cb(){var e=Fv(Pg()(df));return e.copy=function(){return Pm(e,cb())},ux.apply(e,arguments)}function M4(){var e=loggish(Pg()).domain([1,10]);return e.copy=function(){return Pm(e,M4()).base(e.base())},initInterpolator.apply(e,arguments)}function I4(){var e=symlogish(Pg());return e.copy=function(){return Pm(e,I4()).constant(e.constant())},initInterpolator.apply(e,arguments)}function fb(){var e=powish(Pg());return e.copy=function(){return Pm(e,fb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function iR(){return fb.apply(null,arguments).exponent(.5)}function k4(){var e=[],a=identity;function t(i){if(!isNaN(i=+i))return a((bisect(e,i)-1)/(e.length-1))}return t.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var r=0,o=i.length,u;r<o;++r)u=i[r],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),t},t.interpolator=function(i){return arguments.length?(a=i,t):a},t.copy=function(){return k4(a).domain(e)},initInterpolator.apply(t,arguments)}function Rg(){var e=0,a=.5,t=1,i,r,o,u,p,v=df,g,E=!1,A;function P(F){return isNaN(F=+F)?A:(F=.5+((F=+g(F))-r)*(F<r?u:p),v(E?Math.max(0,Math.min(1,F)):F))}return P.domain=function(F){return arguments.length?(i=g(e=+F[0]),r=g(a=+F[1]),o=g(t=+F[2]),u=i===r?0:.5/(r-i),p=r===o?0:.5/(o-r),P):[e,a,t]},P.clamp=function(F){return arguments.length?(E=!!F,P):E},P.interpolator=function(F){return arguments.length?(v=F,P):v},P.unknown=function(F){return arguments.length?(A=F,P):A},function(F){return g=F,i=F(e),r=F(a),o=F(t),u=i===r?0:.5/(r-i),p=r===o?0:.5/(o-r),P}}function hb(){var e=Fv(Rg()(df));return e.copy=function(){return Pm(e,hb())},ux.apply(e,arguments)}function P4(){var e=loggish(Rg()).domain([.1,1,10]);return e.copy=function(){return copy(e,P4()).base(e.base())},initInterpolator.apply(e,arguments)}function R4(){var e=symlogish(Rg());return e.copy=function(){return copy(e,R4()).constant(e.constant())},initInterpolator.apply(e,arguments)}function pb(){var e=powish(Rg());return e.copy=function(){return copy(e,pb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function aR(){return pb.apply(null,arguments).exponent(.5)}var Dh,db,vb,mb,Dy,gb,L4=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,O4=(Dh={},(0,xe.Z)(Dh,ls.LINEAR,Ex),(0,xe.Z)(Dh,ls.POWER,wy),(0,xe.Z)(Dh,ls.LOG,Ix),(0,xe.Z)(Dh,ls.IDENTITY,Cx),(0,xe.Z)(Dh,ls.SEQUENTIAL,cb),(0,xe.Z)(Dh,ls.TIME,T4),(0,xe.Z)(Dh,ls.QUANTILE,Lx),(0,xe.Z)(Dh,ls.QUANTIZE,Ox),(0,xe.Z)(Dh,ls.THRESHOLD,Fx),(0,xe.Z)(Dh,ls.CAT,Eg),(0,xe.Z)(Dh,ls.DIVERGING,hb),Dh),F4=(db=(0,Nn.b2)(),vb=(0,Nn.f3)(nr.IGlobalConfigService),db(mb=(Dy=function(){function e(){(0,Lt.Z)(this,e),ya(this,"configService",gb,this),(0,xe.Z)(this,"scaleCache",{}),(0,xe.Z)(this,"scaleOptions",{})}return(0,At.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes(),p=t.getSource().data.dataArray;p.length!==0&&r.caculateScalesForAttributes(u||[],p)}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes(),p=t.getSource().data.dataArray;return r.caculateScalesForAttributes(u||[],p),t.layerModelNeedUpdate=!0,!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();if(u){var p=t.getSource().data.dataArray;if(p.length===0)return;var v=u.filter(function(g){return g.needRescale});v.length&&r.caculateScalesForAttributes(v,p)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,i){var r=this;this.scaleCache={},t.forEach(function(o){if(o.scale){var u=o.scale,p=o.name;u.names=r.parseFields(o.scale.field||[]);var v=[];u.names.forEach(function(g){var E;v.push(r.createScale(g,o.name,(E=o.scale)===null||E===void 0?void 0:E.values,i))}),v.some(function(g){return g.type===g0.VARIABLE})?(u.type=g0.VARIABLE,v.forEach(function(g){var E;if(!u.callback&&u.values!=="text")switch((E=g.option)===null||E===void 0?void 0:E.type){case ls.LOG:case ls.LINEAR:case ls.POWER:if(u.values&&u.values.length>2){var A=g.scale.ticks(u.values.length);g.scale.domain(A)}u.values?g.scale.range(u.values):g.scale.range(g.option.domain);break;case ls.QUANTILE:case ls.QUANTIZE:case ls.THRESHOLD:g.scale.range(u.values);break;case ls.CAT:u.values?g.scale.range(u.values):g.scale.range(g.option.domain);break;case ls.DIVERGING:case ls.SEQUENTIAL:g.scale.interpolator(MM.hD(u.values));break}if(u.values==="text"){var P;g.scale.range((P=g.option)===null||P===void 0?void 0:P.domain)}})):(u.type=g0.CONSTANT,u.defaultValues=v.map(function(g,E){return g.scale(u.names[E])})),u.scalers=v.map(function(g){return{field:g.field,func:g.scale,option:g.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,he.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,i,r,o){var u,p,v=this.scaleOptions[i]&&((u=this.scaleOptions[i])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[i]:this.scaleOptions[t],g={field:t,scale:void 0,type:g0.VARIABLE,option:v};if(!o||!o.length)return v&&v.type?g.scale=this.createDefaultScale(v):(g.scale=Eg([t]),g.type=g0.CONSTANT),g;var E=(p=o.find(function(F){return!(0,he.isNil)(F[t])}))===null||p===void 0?void 0:p[t];if(this.isNumber(t)||(0,he.isNil)(E)&&!v)g.scale=Eg([t]),g.type=g0.CONSTANT;else{var A=v&&v.type||this.getDefaultType(E);r==="text"&&(A=ls.CAT);var P=this.createScaleConfig(A,t,v,o);g.scale=this.createDefaultScale(P),g.option=P}return g}},{key:"getDefaultType",value:function(t){var i=ls.LINEAR;return typeof t=="string"&&(i=L4.test(t)?ls.TIME:ls.CAT),i}},{key:"createScaleConfig",value:function(t,i,r,o){var u={type:t},p=(o==null?void 0:o.map(function(E){return E[i]}))||[];if(r!=null&&r.domain)u.domain=r==null?void 0:r.domain;else if(t!==ls.CAT&&t!==ls.QUANTILE&&t!==ls.DIVERGING)u.domain=tx(p);else if(t===ls.CAT)u.domain=(0,he.uniq)(p);else if(t===ls.QUANTILE)u.domain=p;else if(t===ls.DIVERGING){var v=tx(p),g=(r==null?void 0:r.neutral)!==void 0?r==null?void 0:r.neutral:(v[0]+v[1])/2;u.domain=[v[0],g,v[1]]}return(0,Z.Z)((0,Z.Z)({},u),r)}},{key:"createDefaultScale",value:function(t){var i=t.type,r=t.domain,o=t.unknown,u=t.clamp,p=t.nice,v=O4[i]();return r&&v.domain&&v.domain(r),o&&v.unknown(o),u!==void 0&&v.clamp&&v.clamp(u),p!==void 0&&v.nice&&v.nice(p),v}}]),e}(),gb=ma(Dy.prototype,"configService",[vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dy))||mb),yb,_b,xb,bb,Lg,Eb,Cb,D4=(yb=(0,Nn.b2)(),_b=(0,Nn.f3)(nr.ICameraService),xb=(0,Nn.f3)(nr.IRendererService),yb(bb=(Lg=function(){function e(){(0,Lt.Z)(this,e),ya(this,"cameraService",Eb,this),ya(this,"rendererService",Cb,this)}return(0,At.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(i){i.addUniforms((0,Z.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),Eb=ma(Lg.prototype,"cameraService",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cb=ma(Lg.prototype,"rendererService",[xb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lg))||bb),Sb,Ab,B4=(Sb=(0,Nn.b2)(),Sb(Ab=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"initLayerModel",value:function(t){t.prepareBuildModel(),t.buildModels(),t.emit("modelLoaded",null),t.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(t){t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.emit("modelLoaded",null),t.layerModelNeedUpdate=!1}},{key:"apply",value:function(t){var i=this;t.hooks.init.tap("LayerModelPlugin",function(){t.inited=!0;var r=t.getSource();r.inited&&i.initLayerModel(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=t.getSource();return r.inited?i.prepareLayerModel(t):r.once("sourceUpdate",function(){i.prepareLayerModel(t)}),!1})}}]),e}())||Ab),wb,Tb,N4=(wb=(0,Nn.b2)(),wb(Tb=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var i=t.getLayerConfig(),r=i.autoFit,o=i.fitBoundsOptions;r&&setTimeout(function(){t.fitBounds(o)},100)})}}]),e}())||Tb),Mb,Ib,z4=["type"],kb={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},U4={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Z4={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},V4={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},oR=null;function j4(e){var a={u_DirectionalLights:new Array(3).fill((0,Z.Z)({},Z4)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,Z.Z)({},V4)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[U4]),e.forEach(function(t,i){var r=t.type,o=r===void 0?"directional":r,u=(0,bd.Z)(t,z4),p=kb[o].lights,v=kb[o].num,g=a[v];a[p][g]=(0,Z.Z)((0,Z.Z)({},a[p][g]),u),a[v]++}),a}var G4=(Mb=(0,Nn.b2)(),Mb(Ib=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var i=t.getLayerConfig(),r=i.enableLighting;r&&t.models.forEach(function(o){return o.addUniforms((0,Z.Z)({},j4()))})})}}]),e}())||Ib),Pb,Rb,Lb,By,Ob,H4=(Pb=(0,Nn.b2)(),Rb=(0,Nn.f3)(nr.IGlobalConfigService),Pb(Lb=(By=function(){function e(){(0,Lt.Z)(this,e),ya(this,"configService",Ob,this)}return(0,At.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.rendererService,u=i.postProcessingPassFactory,p=i.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var v=t.getLayerConfig(),g=v.enableMultiPassRenderer,E=v.passes,A=E===void 0?[]:E;r.enabled=!!g&&t.getLayerConfig().enableMultiPassRenderer!==!1,r.enabled&&(t.multiPassRenderer=Z_(t,A,u,p),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(r.enabled){var v=o.getViewportSize(),g=v.width,E=v.height;t.multiPassRenderer.resize(g,E)}})}}]),e}(),Ob=ma(By.prototype,"configService",[Rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By))||Lb),Fb,Db,Og={NONE:0,ENCODE:1,HIGHLIGHT:2},W4=(Fb=(0,Nn.b2)(),Fb(Db=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"apply",value:function(t,i){var r=i.rendererService,o=i.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking,v=u.enableMultiPassRenderer;o.registerStyleAttribute({name:"pickingColor",type:Gn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:q.FLOAT},size:3,update:function(E,A){var P=E.id;return p?be(P):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking;p&&t.isVisible()&&t.models.forEach(function(v){return v.addUniforms({u_PickingStage:Og.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),p=u.enablePicking;p&&t.isVisible()&&t.models.forEach(function(v){return v.addUniforms({u_PickingStage:Og.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(u){var p=t.getLayerConfig(),v=p.highlightColor,g=p.activeMix,E=g===void 0?0:g,A=typeof v=="string"?W(v):v||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:te(new Uint8Array(u))}),t.models.forEach(function(P){return P.addUniforms({u_PickingStage:Og.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:A.map(function(F){return F*255}),u_activeMix:E})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(u){var p=t.getLayerConfig(),v=p.selectColor,g=p.selectMix,E=g===void 0?0:g,A=typeof v=="string"?W(v):v||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:te(new Uint8Array(u))}),t.models.forEach(function(P){return P.addUniforms({u_PickingStage:Og.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:A.map(function(F){return F*255}),u_activeMix:E,u_CurrentSelectedId:u,u_SelectColor:A.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||Db),Bb,Nb,X4=(Bb=(0,Nn.b2)(),Bb(Nb=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){r.registerBuiltinAttributes(o)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:Gn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:q.FLOAT},size:3,update:function(r,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}}),t.registerStyleAttribute({name:"filter",type:Gn.Attribute,descriptor:{name:"filter",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r,o){var u=r.filter;return u?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:Gn.Attribute,descriptor:{name:"a_Color",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:4,update:function(r,o){var u=r.color;return!u||!u.length?[1,1,1,1]:u}}}),t.registerStyleAttribute({name:"vertexId",type:Gn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:q.DYNAMIC_DRAW,data:[],type:q.FLOAT},size:1,update:function(r,o,u,p){return[o]}}})}}]),e}())||Nb),zb,Ub,Zb,Vb,jb,Gb,Uv,Hb,Wb,Xb,Yb,Y4=(zb=(0,Nn.b2)(),Ub=(0,Nn.f3)(nr.ICameraService),Zb=(0,Nn.f3)(nr.ICoordinateSystemService),Vb=(0,Nn.f3)(nr.IRendererService),jb=(0,Nn.f3)(nr.IMapService),zb(Gb=(Uv=function(){function e(){(0,Lt.Z)(this,e),ya(this,"cameraService",Hb,this),ya(this,"coordinateSystemService",Wb,this),ya(this,"rendererService",Xb,this),ya(this,"mapService",Yb,this)}return(0,At.Z)(e,[{key:"apply",value:function(t){var i=this,r=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var p=t.getLayerConfig().tileOrigin;if(i.coordinateSystemService.refresh(p),r==="GAODE2.x"){var v=i.getLayerCenter(t);i.mapService.map.customCoords.setCenter(v),i.mapService.setCustomCoordCenter(v),o=i.mapService.map.customCoords.getMVPMatrix(),u=i.mapService.getCustomCoordCenter()}var g=i.rendererService.getViewportSize(),E=g.width,A=g.height;t.models.forEach(function(P){var F;P.addUniforms((F={},(0,xe.Z)(F,X0.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,xe.Z)(F,X0.ViewMatrix,i.cameraService.getViewMatrix()),(0,xe.Z)(F,X0.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,xe.Z)(F,X0.Zoom,i.cameraService.getZoom()),(0,xe.Z)(F,X0.ZoomScale,i.cameraService.getZoomScale()),(0,xe.Z)(F,X0.FocalDistance,i.cameraService.getFocalDistance()),(0,xe.Z)(F,X0.CameraPosition,i.cameraService.getCameraPosition()),(0,xe.Z)(F,Lp.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,xe.Z)(F,Lp.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,xe.Z)(F,Lp.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,xe.Z)(F,Lp.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,xe.Z)(F,Lp.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,xe.Z)(F,Lp.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,xe.Z)(F,Lp.Mvp,o),(0,xe.Z)(F,"u_SceneCenterMKT",u),(0,xe.Z)(F,"u_ViewportSize",[E,A]),(0,xe.Z)(F,"u_ModelMatrix",i.cameraService.getModelMatrix()),(0,xe.Z)(F,"u_DevicePixelRatio",ka.devicePixelRatio),(0,xe.Z)(F,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,xe.Z)(F,"u_shaderPick",Number(t.getShaderPickStat())),F))})})}},{key:"getLayerCenter",value:function(t){var i=t.getSource();return i.center}}]),e}(),Hb=ma(Uv.prototype,"cameraService",[Ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wb=ma(Uv.prototype,"coordinateSystemService",[Zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xb=ma(Uv.prototype,"rendererService",[Vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yb=ma(Uv.prototype,"mapService",[jb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uv))||Gb),qb,$b,q4=(qb=(0,Nn.b2)(),qb($b=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||$b),Kb,Qb,$4=(Kb=(0,Nn.b2)(),Kb(Qb=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"apply",value:function(t,i){var r=this,o=i.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){r.initStyleAttribute(t,{styleAttributeService:o})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||r.updateStyleAtrribute(t,{styleAttributeService:o})})}},{key:"updateStyleAtrribute",value:function(t,i){var r=i.styleAttributeService,o=r.getLayerStyleAttributes()||[],u=r.getLayerStyleAttribute("filter"),p=r.getLayerStyleAttribute("shape");if(u&&u.needRegenerateVertices){t.layerModelNeedUpdate=!0,o.forEach(function(v){return v.needRegenerateVertices=!1});return}o.filter(function(v){return v.needRegenerateVertices}).forEach(function(v){r.updateAttributeByFeatureRange(v.name,t.getEncodedData(),v.featureRange.startIndex,v.featureRange.endIndex),v.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,i){var r=i.styleAttributeService,o=r.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||Qb);Oh.bind(nr.ILayerPlugin).to(CM).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(X4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(F4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(EM).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(N4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to($4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(q4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(H4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(Y4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(D4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(G4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(W4).inRequestScope(),Oh.bind(nr.ILayerPlugin).to(B4).inRequestScope();var K4=fe(88307),Q4=fe.n(K4),J4=function(){function e(a,t){(0,Lt.Z)(this,e);var i=t.buffer,r=t.offset,o=t.stride,u=t.normalized,p=t.size,v=t.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:r||0,stride:o||0,normalized:u||!1,divisor:v||0},p&&(this.attribute.size=p)}return(0,At.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),qd,Rm,$d,pp,Lm,C0,Om,Fg,Sd,rv,Vc,Ad,wd,Dg,eI=(qd={},(0,xe.Z)(qd,q.POINTS,"points"),(0,xe.Z)(qd,q.LINES,"lines"),(0,xe.Z)(qd,q.LINE_LOOP,"line loop"),(0,xe.Z)(qd,q.LINE_STRIP,"line strip"),(0,xe.Z)(qd,q.TRIANGLES,"triangles"),(0,xe.Z)(qd,q.TRIANGLE_FAN,"triangle fan"),(0,xe.Z)(qd,q.TRIANGLE_STRIP,"triangle strip"),qd),Jb=(Rm={},(0,xe.Z)(Rm,q.STATIC_DRAW,"static"),(0,xe.Z)(Rm,q.DYNAMIC_DRAW,"dynamic"),(0,xe.Z)(Rm,q.STREAM_DRAW,"stream"),Rm),Ny=($d={},(0,xe.Z)($d,q.BYTE,"int8"),(0,xe.Z)($d,q.UNSIGNED_INT,"int16"),(0,xe.Z)($d,q.INT,"int32"),(0,xe.Z)($d,q.UNSIGNED_BYTE,"uint8"),(0,xe.Z)($d,q.UNSIGNED_SHORT,"uint16"),(0,xe.Z)($d,q.UNSIGNED_INT,"uint32"),(0,xe.Z)($d,q.FLOAT,"float"),$d),tI=(pp={},(0,xe.Z)(pp,q.ALPHA,"alpha"),(0,xe.Z)(pp,q.LUMINANCE,"luminance"),(0,xe.Z)(pp,q.LUMINANCE_ALPHA,"luminance alpha"),(0,xe.Z)(pp,q.RGB,"rgb"),(0,xe.Z)(pp,q.RGBA,"rgba"),(0,xe.Z)(pp,q.RGBA4,"rgba4"),(0,xe.Z)(pp,q.RGB5_A1,"rgb5 a1"),(0,xe.Z)(pp,q.RGB565,"rgb565"),(0,xe.Z)(pp,q.DEPTH_COMPONENT,"depth"),(0,xe.Z)(pp,q.DEPTH_STENCIL,"depth stencil"),pp),rI=(Lm={},(0,xe.Z)(Lm,q.DONT_CARE,"dont care"),(0,xe.Z)(Lm,q.NICEST,"nice"),(0,xe.Z)(Lm,q.FASTEST,"fast"),Lm),e2=(C0={},(0,xe.Z)(C0,q.NEAREST,"nearest"),(0,xe.Z)(C0,q.LINEAR,"linear"),(0,xe.Z)(C0,q.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,xe.Z)(C0,q.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,xe.Z)(C0,q.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,xe.Z)(C0,q.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),C0),t2=(Om={},(0,xe.Z)(Om,q.REPEAT,"repeat"),(0,xe.Z)(Om,q.CLAMP_TO_EDGE,"clamp"),(0,xe.Z)(Om,q.MIRRORED_REPEAT,"mirror"),Om),nI=(Fg={},(0,xe.Z)(Fg,q.NONE,"none"),(0,xe.Z)(Fg,q.BROWSER_DEFAULT_WEBGL,"browser"),Fg),iI=(Sd={},(0,xe.Z)(Sd,q.NEVER,"never"),(0,xe.Z)(Sd,q.ALWAYS,"always"),(0,xe.Z)(Sd,q.LESS,"less"),(0,xe.Z)(Sd,q.LEQUAL,"lequal"),(0,xe.Z)(Sd,q.GREATER,"greater"),(0,xe.Z)(Sd,q.GEQUAL,"gequal"),(0,xe.Z)(Sd,q.EQUAL,"equal"),(0,xe.Z)(Sd,q.NOTEQUAL,"notequal"),Sd),r2=(rv={},(0,xe.Z)(rv,q.FUNC_ADD,"add"),(0,xe.Z)(rv,q.MIN_EXT,"min"),(0,xe.Z)(rv,q.MAX_EXT,"max"),(0,xe.Z)(rv,q.FUNC_SUBTRACT,"subtract"),(0,xe.Z)(rv,q.FUNC_REVERSE_SUBTRACT,"reverse subtract"),rv),Bg=(Vc={},(0,xe.Z)(Vc,q.ZERO,"zero"),(0,xe.Z)(Vc,q.ONE,"one"),(0,xe.Z)(Vc,q.SRC_COLOR,"src color"),(0,xe.Z)(Vc,q.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,xe.Z)(Vc,q.SRC_ALPHA,"src alpha"),(0,xe.Z)(Vc,q.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,xe.Z)(Vc,q.DST_COLOR,"dst color"),(0,xe.Z)(Vc,q.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,xe.Z)(Vc,q.DST_ALPHA,"dst alpha"),(0,xe.Z)(Vc,q.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,xe.Z)(Vc,q.CONSTANT_COLOR,"constant color"),(0,xe.Z)(Vc,q.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,xe.Z)(Vc,q.CONSTANT_ALPHA,"constant alpha"),(0,xe.Z)(Vc,q.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,xe.Z)(Vc,q.SRC_ALPHA_SATURATE,"src alpha saturate"),Vc),aI=(Ad={},(0,xe.Z)(Ad,q.NEVER,"never"),(0,xe.Z)(Ad,q.ALWAYS,"always"),(0,xe.Z)(Ad,q.LESS,"less"),(0,xe.Z)(Ad,q.LEQUAL,"lequal"),(0,xe.Z)(Ad,q.GREATER,"greater"),(0,xe.Z)(Ad,q.GEQUAL,"gequal"),(0,xe.Z)(Ad,q.EQUAL,"equal"),(0,xe.Z)(Ad,q.NOTEQUAL,"notequal"),Ad),Zv=(wd={},(0,xe.Z)(wd,q.ZERO,"zero"),(0,xe.Z)(wd,q.KEEP,"keep"),(0,xe.Z)(wd,q.REPLACE,"replace"),(0,xe.Z)(wd,q.INVERT,"invert"),(0,xe.Z)(wd,q.INCR,"increment"),(0,xe.Z)(wd,q.DECR,"decrement"),(0,xe.Z)(wd,q.INCR_WRAP,"increment wrap"),(0,xe.Z)(wd,q.DECR_WRAP,"decrement wrap"),wd),oI=(Dg={},(0,xe.Z)(Dg,q.FRONT,"front"),(0,xe.Z)(Dg,q.BACK,"back"),Dg),sI=function(){function e(a,t){(0,Lt.Z)(this,e);var i=t.data,r=t.usage,o=t.type;this.buffer=a.buffer({data:i,usage:Jb[r||q.STATIC_DRAW],type:Ny[o||q.UNSIGNED_BYTE]})}return(0,At.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var i=t.data,r=t.offset;this.buffer.subdata(i,r)}}]),e}(),uI=function(){function e(a,t){(0,Lt.Z)(this,e);var i=t.data,r=t.usage,o=t.type,u=t.count;this.elements=a.elements({data:i,usage:Jb[r||q.STATIC_DRAW],type:Ny[o||q.UNSIGNED_BYTE],count:u})}return(0,At.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var i=t.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),lI=function(){function e(a,t){(0,Lt.Z)(this,e);var i=t.width,r=t.height,o=t.color,u=t.colors,p=t.depth,v=t.stencil,g={width:i,height:r};Array.isArray(u)&&(g.colors=u.map(function(E){return E.get()})),o&&typeof o!="boolean"&&(g.color=o.get()),this.framebuffer=a.framebuffer(g)}return(0,At.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var i=t.width,r=t.height;this.framebuffer.resize(i,r)}}]),e}(),cI=function(){function e(a,t){(0,Lt.Z)(this,e),(0,xe.Z)(this,"destroyed",!1),(0,xe.Z)(this,"uniforms",{}),this.reGl=a;var i=t.vs,r=t.fs,o=t.attributes,u=t.uniforms,p=t.primitive,v=t.count,g=t.elements,E=t.depth,A=t.blend,P=t.stencil,F=t.cull,N=t.instances,V={};this.options=t,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(Pe){V[Pe]=a.prop(Pe)}));var Y={};Object.keys(o).forEach(function(Pe){Y[Pe]=o[Pe].get()});var ie={attributes:Y,frag:r,uniforms:V,vert:i,blend:{},primitive:eI[p===void 0?q.TRIANGLES:p]};N&&(ie.instances=N),v?ie.count=v:g&&(ie.elements=g.get()),this.initDepthDrawParams({depth:E},ie),this.initBlendDrawParams({blend:A},ie),this.initStencilDrawParams({stencil:P},ie),this.initCullDrawParams({cull:F},ie),this.drawCommand=a(ie);var ye=(0,he.cloneDeep)(ie);ye.blend=(0,Z.Z)((0,Z.Z)({},ye.blend),{},{enable:!1}),this.drawPickCommand=a(ye),this.drawParams=ie}return(0,At.Z)(e,[{key:"updateAttributesAndElements",value:function(t,i){var r={};Object.keys(t).forEach(function(u){r[u]=t[u].get()}),this.drawParams.attributes=r,this.drawParams.elements=i.get(),this.drawCommand=this.reGl(this.drawParams);var o=(0,he.cloneDeep)(this.drawParams);o.blend=(0,Z.Z)((0,Z.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}},{key:"updateAttributes",value:function(t){var i={};Object.keys(t).forEach(function(o){i[o]=t[o].get()}),this.drawParams.attributes=i,this.drawCommand=this.reGl(this.drawParams);var r=(0,he.cloneDeep)(this.drawParams);r.blend=(0,Z.Z)((0,Z.Z)({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}},{key:"addUniforms",value:function(t){this.uniforms=(0,Z.Z)((0,Z.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,i){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var r=(0,Z.Z)((0,Z.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),o={};Object.keys(r).forEach(function(u){var p=(0,Mt.Z)(r[u]);p==="boolean"||p==="number"||Array.isArray(r[u])||r[u].BYTES_PER_ELEMENT?o[u]=r[u]:o[u]=r[u].get()}),i?this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,i){var r=t.depth;r&&(i.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:iI[r.func||q.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,i){var r=t.blend;if(r){var o=r.enable,u=r.func,p=r.equation,v=r.color,g=v===void 0?[0,0,0,0]:v;i.blend={enable:!!o,func:{srcRGB:Bg[u&&u.srcRGB||q.SRC_ALPHA],srcAlpha:Bg[u&&u.srcAlpha||q.SRC_ALPHA],dstRGB:Bg[u&&u.dstRGB||q.ONE_MINUS_SRC_ALPHA],dstAlpha:Bg[u&&u.dstAlpha||q.ONE_MINUS_SRC_ALPHA]},equation:{rgb:r2[p&&p.rgb||q.FUNC_ADD],alpha:r2[p&&p.alpha||q.FUNC_ADD]},color:g}}}},{key:"initStencilDrawParams",value:function(t,i){var r=t.stencil;if(r){var o=r.enable,u=r.mask,p=u===void 0?-1:u,v=r.func,g=v===void 0?{cmp:q.ALWAYS,ref:0,mask:-1}:v,E=r.opFront,A=E===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:E,P=r.opBack,F=P===void 0?{fail:q.KEEP,zfail:q.KEEP,zpass:q.KEEP}:P;i.stencil={enable:!!o,mask:p,func:(0,Z.Z)((0,Z.Z)({},g),{},{cmp:aI[g.cmp]}),opFront:{fail:Zv[A.fail],zfail:Zv[A.zfail],zpass:Zv[A.zpass]},opBack:{fail:Zv[F.fail],zfail:Zv[F.zfail],zpass:Zv[F.zpass]}}}}},{key:"initCullDrawParams",value:function(t,i){var r=t.cull;if(r){var o=r.enable,u=r.face,p=u===void 0?q.BACK:u;i.cull={enable:!!o,face:oI[p]}}}},{key:"extractUniforms",value:function(t){var i=this,r={};return Object.keys(t).forEach(function(o){i.extractUniformsRecursively(o,t[o],r,"")}),r}},{key:"extractUniformsRecursively",value:function(t,i,r,o){var u=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||(0,he.isTypedArray)(i)||i===""||"resize"in i){r["".concat(o&&o+".").concat(t)]=i;return}(0,he.isPlainObject)(i)&&Object.keys(i).forEach(function(p){u.extractUniformsRecursively(p,i[p],r,"".concat(o&&o+".").concat(t))}),Array.isArray(i)&&i.forEach(function(p,v){Object.keys(p).forEach(function(g){u.extractUniformsRecursively(g,p[g],r,"".concat(o&&o+".").concat(t,"[").concat(v,"]"))})})}}]),e}(),fI=function(){function e(a,t){(0,Lt.Z)(this,e),(0,xe.Z)(this,"isDistroy",!1);var i=t.data,r=t.type,o=r===void 0?q.UNSIGNED_BYTE:r,u=t.width,p=t.height,v=t.flipY,g=v===void 0?!1:v,E=t.format,A=E===void 0?q.RGBA:E,P=t.mipmap,F=P===void 0?!1:P,N=t.wrapS,V=N===void 0?q.CLAMP_TO_EDGE:N,Y=t.wrapT,ie=Y===void 0?q.CLAMP_TO_EDGE:Y,ye=t.aniso,Pe=ye===void 0?0:ye,tt=t.alignment,pt=tt===void 0?1:tt,vt=t.premultiplyAlpha,Xt=vt===void 0?!1:vt,er=t.mag,wr=er===void 0?q.NEAREST:er,kr=t.min,Sr=kr===void 0?q.NEAREST:kr,un=t.colorSpace,Dn=un===void 0?q.BROWSER_DEFAULT_WEBGL:un,li=t.x,Da=li===void 0?0:li,$a=t.y,Fs=$a===void 0?0:$a,Fu=t.copy,xu=Fu===void 0?!1:Fu;this.width=u,this.height=p;var vf={width:u,height:p,type:Ny[o],format:tI[A],wrapS:t2[V],wrapT:t2[ie],mag:e2[wr],min:e2[Sr],alignment:pt,flipY:g,colorSpace:nI[Dn],premultiplyAlpha:Xt,aniso:Pe,x:Da,y:Fs,copy:xu};i&&(vf.data=i),typeof F=="number"?vf.mipmap=rI[F]:typeof F=="boolean"&&(vf.mipmap=F),this.texture=a.texture(vf)}return(0,At.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var i=t.width,r=t.height;this.texture.resize(i,r),this.width=i,this.height=r}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),e}(),n2,i2,hI=(n2=(0,Nn.b2)(),n2(i2=function(){function e(){var a=this;(0,Lt.Z)(this,e),(0,xe.Z)(this,"createModel",function(t){return new cI(a.gl,t)}),(0,xe.Z)(this,"createAttribute",function(t){return new J4(a.gl,t)}),(0,xe.Z)(this,"createBuffer",function(t){return new sI(a.gl,t)}),(0,xe.Z)(this,"createElements",function(t){return new uI(a.gl,t)}),(0,xe.Z)(this,"createTexture2D",function(t){return new fI(a.gl,t)}),(0,xe.Z)(this,"createFramebuffer",function(t){return new lI(a.gl,t)}),(0,xe.Z)(this,"useFramebuffer",function(t,i){a.gl({framebuffer:t?t.get():null})(i)}),(0,xe.Z)(this,"clear",function(t){var i,r=t.color,o=t.depth,u=t.stencil,p=t.framebuffer,v=p===void 0?null:p,g={color:r,depth:o,stencil:u};g.framebuffer=v===null?v:v.get(),(i=a.gl)===null||i===void 0||i.clear(g)}),(0,xe.Z)(this,"viewport",function(t){var i=t.x,r=t.y,o=t.width,u=t.height;a.gl._gl.viewport(i,r,o,u),a.width=o,a.height=u,a.gl._refresh()}),(0,xe.Z)(this,"readPixels",function(t){var i=t.framebuffer,r=t.x,o=t.y,u=t.width,p=t.height,v={x:r,y:o,width:u,height:p};return i&&(v.framebuffer=i.get()),a.gl.read(v)}),(0,xe.Z)(this,"getViewportSize",function(){return{width:a.gl._gl.drawingBufferWidth,height:a.gl._gl.drawingBufferHeight}}),(0,xe.Z)(this,"getContainer",function(){if(Us)return a.canvas;var t;return(t=a.canvas)===null||t===void 0?void 0:t.parentElement}),(0,xe.Z)(this,"getCanvas",function(){return a.canvas}),(0,xe.Z)(this,"getGLContext",function(){return a.gl._gl}),(0,xe.Z)(this,"destroy",function(){var t,i,r;a.canvas=null,(t=a.gl)===null||t===void 0||(i=t._gl)===null||i===void 0||(r=i.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),a.gl.destroy(),a.gl=null})}return(0,At.Z)(e,[{key:"init",value:function(){var a=(0,Va.Z)(yi().mark(function i(r,o,u){var p=this;return yi().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.canvas=r,!u){g.next=5;break}this.gl=u,g.next=8;break;case 5:return g.next=7,new Promise(function(E,A){Q4()({canvas:p.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(F,N){(F||!N)&&A(F),E(N)}})});case 7:this.gl=g.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return g.stop()}},i,this)}));function t(i,r,o){return a.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||i2),pI=function(){function e(a){(0,Lt.Z)(this,e);var t=a.id,i=a.map,r=a.canvas,o=a.hasBaseMap,u=aC();this.container=u,i.setContainer(u,t,r,o),u.bind(nr.IRendererService).to(hI).inSingletonScope(),this.sceneService=u.get(nr.ISceneService),this.mapService=u.get(nr.IMapService),this.iconService=u.get(nr.IIconService),this.fontService=u.get(nr.IFontService),this.controlService=u.get(nr.IControlService),this.layerService=u.get(nr.ILayerService),this.markerService=u.get(nr.IMarkerService),this.interactionService=u.get(nr.IInteractionService),this.popupService=u.get(nr.IPopupService),Us?this.sceneService.initMiniScene(a):(this.initComponent(t),this.sceneService.init(a),this.initControl())}return(0,At.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var i=this;if(this.sceneService.loaded){var r=new t(this);r.init()}else this.on("loaded",function(){var o=new t(i);o.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var i=Qg(this.container);t.setContainer(i,this.container),this.sceneService.addLayer(t);var r=t.getLayerConfig();if(r){var o=r.mask,u=r.maskfence,p=r.maskColor,v=p===void 0?"#000":p,g=r.maskOpacity,E=g===void 0?0:g;if(o&&u){var A=new h1().source(u).shape("fill").color(v).style({opacity:E});this.addMask(A,t.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,i){var r=this.getLayer(i);if(r){var o=Qg(this.container);t.setContainer(o,this.container),r.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,i){this.layerService.remove(t,i)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,i){this.fontService.addIconFont(t,i)}},{key:"addIconFonts",value:function(t){var i=this;t.forEach(function(r){var o=(0,Ir.Z)(r,2),u=o[0],p=o[1];i.fontService.addIconFont(u,p)})}},{key:"addFontFace",value:function(t,i){this.sceneService.addFontFace(t,i)}},{key:"addImage",value:function(t,i){Us?this.iconService.addImageMini(t,i,this.sceneService):this.iconService.addImage(t,i)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,i){Jg.indexOf(t)===-1?this.mapService.on(t,i):this.sceneService.on(t,i)}},{key:"once",value:function(t,i){Jg.indexOf(t)===-1?this.mapService.once(t,i):this.sceneService.once(t,i)}},{key:"off",value:function(t,i){Jg.indexOf(t)===-1?this.mapService.off(t,i):this.sceneService.off(t,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,i){return this.mapService.setCenter(t,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,i){this.mapService.panBy(t,i)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,i){var r=this.sceneService.getSceneConfig(),o=r.fitBoundsOptions,u=r.animate;this.mapService.fitBounds(t,i||(0,Z.Z)((0,Z.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(t,i){this.mapService.setZoomAndCenter(t,i)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,i){this.container.bind(nr.IPostProcessingPass).to(t).whenTargetNamed(i)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:pu(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),i=t.logoVisible,r=t.logoPosition;i&&this.addControl(new AC({position:r}))}}]),e}(),sR="2.9.24";function a2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function uR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?a2(Object(t),!0).forEach(function(i){dI(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function dI(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function lR(e,a){return yI(e)||gI(e,a)||mI(e,a)||vI()}function vI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mI(e,a){if(!!e){if(typeof e=="string")return o2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o2(e,a)}}function o2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function gI(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function yI(e){if(Array.isArray(e))return e}var cR=null,fR=null,s2,zy,u2,_I=(s2=Kg(nr.IGlobalConfigService),zy=function(){function e(a){(0,Lt.Z)(this,e),ya(this,"configService",u2,this),this.config=a}return(0,At.Z)(e,[{key:"setContainer",value:function(t,i,r,o){t.bind(nr.MapConfig).toConstantValue((0,Z.Z)((0,Z.Z)({},this.config),{},{id:i,canvas:r,hasBaseMap:o})),t.bind(nr.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),u2=ma(zy.prototype,"configService",[s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy),xI=fe(6158),Fm=fe.n(xI);function Dm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ng(e,a){var t=zf([],a,e);return Zc(t,t,1/t[3]),t}function hR(e,a){var t=e%a;return t<0?a+t:t}function pR(e,a,t){return t*a+(1-t)*e}function nv(e,a){if(!e)throw new Error(a||"viewport-mercator-project: assertion failed.")}var Zp=Math.PI,l2=Zp/4,Kd=Zp/180,c2=180/Zp,Uy=512,Zy=4003e4,bI=1.5;function f2(e){return Math.pow(2,e)}function EI(e){return Math.log2(e)}function zg(e,a){var t=(0,Ir.Z)(e,2),i=t[0],r=t[1];nv(Number.isFinite(i)&&Number.isFinite(a)),nv(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude"),a*=Uy;var o=i*Kd,u=r*Kd,p=a*(o+Zp)/(2*Zp),v=a*(Zp-Math.log(Math.tan(l2+u*.5)))/(2*Zp);return[p,v]}function Vy(e,a){var t=(0,Ir.Z)(e,2),i=t[0],r=t[1];a*=Uy;var o=i/a*(2*Zp)-Zp,u=2*(Math.atan(Math.exp(Zp-r/a*(2*Zp)))-l2);return[o*c2,u*c2]}function dR(e){var a=e.latitude;assert(Number.isFinite(a));var t=Math.cos(a*Kd);return EI(Zy*t)-9}function h2(e){var a=e.latitude,t=e.longitude,i=e.zoom,r=e.scale,o=e.highPrecision,u=o===void 0?!1:o;r=r!==void 0?r:f2(i),nv(Number.isFinite(a)&&Number.isFinite(t)&&Number.isFinite(r));var p={},v=Uy*r,g=Math.cos(a*Kd),E=v/360,A=E/g,P=v/Zy/g;if(p.pixelsPerMeter=[P,-P,P],p.metersPerPixel=[1/P,-1/P,1/P],p.pixelsPerDegree=[E,-A,P],p.degreesPerPixel=[1/E,-1/A,1/P],u){var F=Kd*Math.tan(a*Kd)/g,N=E*F/2,V=v/Zy*F,Y=V/A*P;p.pixelsPerDegree2=[0,-N,V],p.pixelsPerMeter2=[Y,0,Y]}return p}function vR(e,a){var t=_slicedToArray(e,3),i=t[0],r=t[1],o=t[2],u=_slicedToArray(a,3),p=u[0],v=u[1],g=u[2],E=1,A=h2({longitude:i,latitude:r,scale:E,highPrecision:!0}),P=A.pixelsPerMeter,F=A.pixelsPerMeter2,N=zg(e,E);N[0]+=p*(P[0]+F[0]*v),N[1]+=v*(P[1]+F[1]*v);var V=Vy(N,E),Y=(o||0)+(g||0);return Number.isFinite(o)||Number.isFinite(g)?[V[0],V[1],Y]:V}function CI(e){var a=e.height,t=e.pitch,i=e.bearing,r=e.altitude,o=e.center,u=o===void 0?null:o,p=e.flipY,v=p===void 0?!1:p,g=Dm();return Sa(g,g,[0,0,-r]),so(g,g,[1,1,1/a]),Ua(g,g,-t*Kd),fu(g,g,i*Kd),v&&so(g,g,[1,-1,1]),u&&Sa(g,g,rs.negate([],u)),g}function SI(e){var a=e.width,t=e.height,i=e.altitude,r=i===void 0?bI:i,o=e.pitch,u=o===void 0?0:o,p=e.nearZMultiplier,v=p===void 0?1:p,g=e.farZMultiplier,E=g===void 0?1:g,A=u*Kd,P=Math.atan(.5/r),F=Math.sin(P)*r/Math.sin(Math.PI/2-A-P),N=Math.cos(Math.PI/2-A)*F+r;return{fov:2*Math.atan(t/2/r),aspect:a/t,focalDistance:r,near:v,far:N*E}}function AI(e){var a=e.width,t=e.height,i=e.pitch,r=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,p=SI({width:a,height:t,altitude:r,pitch:i,nearZMultiplier:o,farZMultiplier:u}),v=p.fov,g=p.aspect,E=p.near,A=p.far,P=ap([],v,g,E,A);return P}function wI(e,a){var t=(0,Ir.Z)(e,3),i=t[0],r=t[1],o=t[2],u=o===void 0?0:o;return nv(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(u)),Ng(a,[i,r,u,1])}function p2(e,a){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,Ir.Z)(e,3),r=i[0],o=i[1],u=i[2];if(nv(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var p=Ng(a,[r,o,u,1]);return p}var v=Ng(a,[r,o,0,1]),g=Ng(a,[r,o,1,1]),E=v[2],A=g[2],P=E===A?0:((t||0)-E)/(A-E);return $r.lerp([],v,g,P)}var d2=Dm(),TI=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=a.width,i=a.height,r=a.viewMatrix,o=r===void 0?d2:r,u=a.projectionMatrix,p=u===void 0?d2:u;(0,Lt.Z)(this,e),this.width=t||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=p;var v=Dm();Go(v,v,this.projectionMatrix),Go(v,v,this.viewMatrix),this.viewProjectionMatrix=v;var g=Dm();so(g,g,[this.width/2,-this.height/2,1]),Sa(g,g,[1,-1,0]),Go(g,g,this.viewProjectionMatrix);var E=ts(Dm(),g);if(!E)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=g,this.pixelUnprojectionMatrix=E,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,At.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&Mh(t.projectionMatrix,this.projectionMatrix)&&Mh(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=i.topLeft,o=r===void 0?!0:r,u=this.projectPosition(t),p=wI(u,this.pixelProjectionMatrix),v=(0,Ir.Z)(p,2),g=v[0],E=v[1],A=o?E:this.height-E;return t.length===2?[g,A]:[g,A,p[2]]}},{key:"unproject",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=i.topLeft,o=r===void 0?!0:r,u=i.targetZ,p=(0,Ir.Z)(t,3),v=p[0],g=p[1],E=p[2],A=o?g:this.height-g,P=u&&u*this.pixelsPerMeter,F=p2([v,A,E],this.pixelUnprojectionMatrix,P),N=this.unprojectPosition(F),V=(0,Ir.Z)(N,3),Y=V[0],ie=V[1],ye=V[2];return Number.isFinite(E)?[Y,ie,ye]:Number.isFinite(u)?[Y,ie,u]:[Y,ie]}},{key:"projectPosition",value:function(t){var i=this.projectFlat(t),r=(0,Ir.Z)(i,2),o=r[0],u=r[1],p=(t[2]||0)*this.pixelsPerMeter;return[o,u,p]}},{key:"unprojectPosition",value:function(t){var i=this.unprojectFlat(t),r=(0,Ir.Z)(i,2),o=r[0],u=r[1],p=(t[2]||0)/this.pixelsPerMeter;return[o,u,p]}},{key:"projectFlat",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function MI(e){var a=e.width,t=e.height,i=e.bounds,r=e.minExtent,o=r===void 0?0:r,u=e.maxZoom,p=u===void 0?24:u,v=e.padding,g=v===void 0?0:v,E=e.offset,A=E===void 0?[0,0]:E,P=(0,Ir.Z)(i,2),F=(0,Ir.Z)(P[0],2),N=F[0],V=F[1],Y=(0,Ir.Z)(P[1],2),ie=Y[0],ye=Y[1];if(Number.isFinite(g)){var Pe=g;g={top:Pe,bottom:Pe,left:Pe,right:Pe}}else nv(Number.isFinite(g.top)&&Number.isFinite(g.bottom)&&Number.isFinite(g.left)&&Number.isFinite(g.right));var tt=new v2({width:a,height:t,longitude:0,latitude:0,zoom:0}),pt=tt.project([N,ye]),vt=tt.project([ie,V]),Xt=[Math.max(Math.abs(vt[0]-pt[0]),o),Math.max(Math.abs(vt[1]-pt[1]),o)],er=[a-g.left-g.right-Math.abs(A[0])*2,t-g.top-g.bottom-Math.abs(A[1])*2];nv(er[0]>0&&er[1]>0);var wr=er[0]/Xt[0],kr=er[1]/Xt[1],Sr=(g.right-g.left)/2/wr,un=(g.bottom-g.top)/2/kr,Dn=[(vt[0]+pt[0])/2+Sr,(vt[1]+pt[1])/2+un],li=tt.unproject(Dn),Da=tt.zoom+Math.log2(Math.abs(Math.min(wr,kr)));return{longitude:li[0],latitude:li[1],zoom:Math.min(Da,p)}}var v2=function(e){(0,sn.Z)(a,e);function a(){var t,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,o=i.height,u=i.latitude,p=u===void 0?0:u,v=i.longitude,g=v===void 0?0:v,E=i.zoom,A=E===void 0?0:E,P=i.pitch,F=P===void 0?0:P,N=i.bearing,V=N===void 0?0:N,Y=i.altitude,ie=Y===void 0?1.5:Y,ye=i.nearZMultiplier,Pe=i.farZMultiplier;(0,Lt.Z)(this,a),r=r||1,o=o||1;var tt=f2(A);ie=Math.max(.75,ie);var pt=zg([g,p],tt);pt[2]=0;var vt=AI({width:r,height:o,pitch:F,bearing:V,altitude:ie,nearZMultiplier:ye||1/o,farZMultiplier:Pe||1.01}),Xt=CI({height:o,center:pt,pitch:F,bearing:V,altitude:ie,flipY:!0});return t=(0,Wr.Z)(this,(0,bt.Z)(a).call(this,{width:r,height:o,viewMatrix:Xt,projectionMatrix:vt})),t.latitude=p,t.longitude=g,t.zoom=A,t.pitch=F,t.bearing=V,t.altitude=ie,t.scale=tt,t.center=pt,t.pixelsPerMeter=h2((0,jt.Z)((0,jt.Z)(t))).pixelsPerMeter[2],Object.freeze((0,jt.Z)((0,jt.Z)(t))),t}return(0,At.Z)(a,[{key:"projectFlat",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return zg(i,r)}},{key:"unprojectFlat",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Vy(i,r)}},{key:"getMapCenterByLngLatPosition",value:function(i){var r=i.lngLat,o=i.pos,u=p2(o,this.pixelUnprojectionMatrix),p=zg(r,this.scale),v=$r.add([],p,$r.negate([],u)),g=$r.add([],this.center,v);return Vy(g,this.scale)}},{key:"getLocationAtPoint",value:function(i){var r=i.lngLat,o=i.pos;return this.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"fitBounds",value:function(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,p=MI(Object.assign({width:o,height:u,bounds:i},r)),v=p.longitude,g=p.latitude,E=p.zoom;return new a({width:o,height:u,longitude:v,latitude:g,zoom:E})}}]),a}(TI),II=function(){function e(){(0,Lt.Z)(this,e)}return(0,At.Z)(e,[{key:"syncWithMapCamera",value:function(t){var i=t.center,r=t.zoom,o=t.pitch,u=t.bearing,p=t.viewportHeight,v=t.viewportWidth;this.viewport=new v2({width:v,height:p,longitude:i&&i[0],latitude:i&&i[1],zoom:r,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,i){return this.viewport.projectFlat(t,i)}}]),e}(),kI=function(){function e(a){(0,Lt.Z)(this,e),(0,xe.Z)(this,"size",1e4),this.size=a||1e4}return(0,At.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var i=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90}},{key:"project",value:function(t){var i=this.mercatorXfromLng(t[0]),r=this.mercatorYfromLat(t[1]);return[i,r]}},{key:"unproject",value:function(t){var i=this.lngFromMercatorX(t[0]),r=this.latFromMercatorY(t[1]);return[i,r]}}]),e}(),m2={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},PI=["id","attributionControl","style","token","rotation","mapInstance"],g2,y2,_2,x2,b2,E2,Vv,C2,S2,A2,w2;function RI(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}RI(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Fm();var T2={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},LI=0,OI=12,M2="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",FI=(g2=(0,Nn.b2)(),y2=(0,Nn.f3)(nr.MapConfig),_2=(0,Nn.f3)(nr.IGlobalConfigService),x2=(0,Nn.f3)(nr.ICoordinateSystemService),b2=(0,Nn.f3)(nr.IEventEmitter),g2(E2=(Vv=function(){function e(){var a=this;(0,Lt.Z)(this,e),(0,xe.Z)(this,"version",Wu.MAPBOX),(0,xe.Z)(this,"simpleMapCoord",new kI),(0,xe.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),ya(this,"config",C2,this),ya(this,"configService",S2,this),ya(this,"coordinateSystemService",A2,this),ya(this,"eventEmitter",w2,this),(0,xe.Z)(this,"handleCameraChanged",function(){var t=a.map.getCenter().wrap(),i=t.lat,r=t.lng;a.emit("mapchange"),a.viewport.syncWithMapCamera({bearing:a.map.getBearing(),center:[r,i],viewportHeight:a.map.transform.height,pitch:a.map.getPitch(),viewportWidth:a.map.transform.width,zoom:a.map.getZoom(),cameraHeight:0});var o=a.config.offsetZoom,u=o===void 0?OI:o;a.viewport.getZoom()>u?a.coordinateSystemService.setCoordinateSystem(cp.LNGLAT_OFFSET):a.coordinateSystemService.setCoordinateSystem(cp.LNGLAT),a.cameraChangedCallback(a.viewport)})}return(0,At.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Qa("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,i){gC.indexOf(t)!==-1?this.eventEmitter.on(t,i):this.map.on(T2[t]||t,i)}},{key:"off",value:function(t,i){this.map.off(T2[t]||t,i),this.eventEmitter.off(t,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,i){this.map.zoomIn(t,i)}},{key:"zoomOut",value:function(t,i){this.map.zoomOut(t,i)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,i){this.panTo([t,i])}},{key:"fitBounds",value:function(t,i){this.map.fitBounds(t,i)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,i){this.map.flyTo({zoom:t,center:i})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},r=this.lngLatToMercator(t,0),o=r.x,u=r.y;return[o-i.x,u-i.y]}},{key:"lngLatToMercator",value:function(t,i){var r=window.mapboxgl.MercatorCoordinate.fromLngLat(t,i),o=r.x,u=o===void 0?0:o,p=r.y,v=p===void 0?0:p,g=r.z,E=g===void 0?0:g;return{x:u,y:v,z:E}}},{key:"getModelMatrix",value:function(t,i,r){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},p=window.mapboxgl.MercatorCoordinate.fromLngLat(t,i),v=p.meterInMercatorCoordinateUnits(),g=ko();return Sa(g,g,rs.fromValues(p.x-u.x,p.y-u.y,p.z||0-u.z)),so(g,g,rs.fromValues(v*o[0],-v*o[1],v*o[2])),Ua(g,g,r[0]),Gu(g,g,r[1]),fu(g,g,r[2]),g}},{key:"init",value:function(){var a=(0,Va.Z)(yi().mark(function i(){var r,o,u,p,v,g,E,A,P,F,N,V,Y;return yi().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:r=this.config,o=r.id,u=o===void 0?"map":o,p=r.attributionControl,v=p===void 0?!1:p,g=r.style,E=g===void 0?"light":g,A=r.token,P=A===void 0?M2:A,F=r.rotation,N=F===void 0?0:F,V=r.mapInstance,Y=(0,bd.Z)(r,PI),this.viewport=new II,!V&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),P===M2&&E!=="blank"&&!window.mapboxgl.accessToken&&!V&&console.warn(this.configService.getSceneWarninfo("MapToken")),!V&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=P),V?(this.map=V,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(u),this.map=new window.mapboxgl.Map((0,Z.Z)({container:this.$mapContainer,style:this.getMapStyle(E),attributionControl:v,bearing:N},Y))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return ye.stop()}},i,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,i;(t=this.$mapContainer)===null||t===void 0||(i=t.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var i,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(i=this.eventEmitter).emit.apply(i,[t].concat(o))}},{key:"once",value:function(t){for(var i,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(i=this.eventEmitter).once.apply(i,[t].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,i){var r=new(Fm()).LngLat(t[0],t[1]),o=new(Fm()).LngLat(i[0],i[1]),u=r.distanceTo(o),p=Fm().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),v=Fm().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),g=p.x,E=p.y,A=v.x,P=v.y,F=Math.sqrt(Math.pow(g-A,2)+Math.pow(E-P,2))*4194304*2;return F/u}},{key:"exportMap",value:function(t){var i=this.map.getCanvas(),r=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return r}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var i=t;typeof t=="string"&&(i=document.getElementById(t));var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,r.id="l7_mapbox_div"+LI++,i.appendChild(r),r}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:m2[t]?m2[t]:t}}]),e}(),C2=ma(Vv.prototype,"config",[y2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S2=ma(Vv.prototype,"configService",[_2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A2=ma(Vv.prototype,"coordinateSystemService",[x2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w2=ma(Vv.prototype,"eventEmitter",[b2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vv))||E2);function DI(e){var a=BI();return function(){var i=(0,bt.Z)(e),r;if(a){var o=(0,bt.Z)(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return(0,Wr.Z)(this,r)}}function BI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function NI(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||i)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}NI(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var zI=function(e){(0,sn.Z)(t,e);var a=DI(t);function t(){return(0,Lt.Z)(this,t),a.apply(this,arguments)}return(0,At.Z)(t,[{key:"getServiceConstructor",value:function(){return FI}}]),t}(_I);function I2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function k2(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?I2(Object(t),!0).forEach(function(i){UI(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):I2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function UI(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function ZI(e,a){return HI(e)||GI(e,a)||jI(e,a)||VI()}function VI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jI(e,a){if(!!e){if(typeof e=="string")return P2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return P2(e,a)}}function P2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function GI(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function HI(e){if(Array.isArray(e))return e}var WI=de.memo(function(e){var a=e.style,t=e.className,i=e.map,r=e.option,o=e.onSceneLoaded,u=(0,de.createRef)(),p=(0,de.useState)(),v=ZI(p,2),g=v[0],E=v[1];return(0,de.useEffect)(function(){var A=new pI(k2(k2({id:u.current},r),{},{map:new zI(i)}));return A.on("loaded",function(){E(A),o&&o(A)}),function(){A.destroy()}},[]),(0,de.useEffect)(function(){g&&i.style&&g.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,de.useEffect)(function(){g&&i.zoom&&g.setZoom(i.zoom)},[i.zoom]),(0,de.useEffect)(function(){g&&i.center&&g.setCenter(i.center)},[JSON.stringify(i.center)]),(0,de.useEffect)(function(){g&&i.pitch!==void 0&&g.setPitch(i.pitch||0)},[i.pitch]),(0,de.useEffect)(function(){g&&i.rotation&&g.setRotation(i.rotation)},[i.rotation]),de.createElement(y.Provider,{value:g},(0,de.createElement)("div",{ref:u,style:a,className:t},g&&e.children))}),XI=WI;function R2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function mR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?R2(Object(t),!0).forEach(function(i){YI(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):R2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function YI(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function gR(e,a){return QI(e)||KI(e,a)||$I(e,a)||qI()}function qI(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $I(e,a){if(!!e){if(typeof e=="string")return L2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L2(e,a)}}function L2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function KI(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function QI(e){if(Array.isArray(e))return e}var yR=null,_R=null;function O2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function xR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?O2(Object(t),!0).forEach(function(i){JI(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function JI(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function bR(e,a){return nk(e)||rk(e,a)||tk(e,a)||ek()}function ek(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tk(e,a){if(!!e){if(typeof e=="string")return F2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return F2(e,a)}}function F2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function rk(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function nk(e){if(Array.isArray(e))return e}var ER=null,CR=null;function SR(e,a){return sk(e)||ok(e,a)||ak(e,a)||ik()}function ik(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ak(e,a){if(!!e){if(typeof e=="string")return D2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return D2(e,a)}}function D2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function ok(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function sk(e){if(Array.isArray(e))return e}var AR=null,wR=null;function B2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function TR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?B2(Object(t),!0).forEach(function(i){uk(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):B2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function uk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function MR(e,a){if(e==null)return{};var t=lk(e,a),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],!(a.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(t[i]=e[i]))}return t}function lk(e,a){if(e==null)return{};var t={},i=Object.keys(e),r,o;for(o=0;o<i.length;o++)r=i[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var IR=null,N2=fe(73935);function z2(e,a){return pk(e)||hk(e,a)||fk(e,a)||ck()}function ck(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fk(e,a){if(!!e){if(typeof e=="string")return U2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return U2(e,a)}}function U2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function hk(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function pk(e){if(Array.isArray(e))return e}var Z2=de.useEffect,V2=de.useState,dk=/\B([A-Z])/g,vk=function(a){return a.replace(dk,"-$1").toLowerCase()};function kR(e){var a=e.className,t=e.style,i=e.children,r=e.position,o=V2(),u=z2(o,2),p=u[0],v=u[1],g=useSceneValue(),E=V2(function(){return document.createElement("div")}),A=z2(E,1),P=A[0];return Z2(function(){var F=new Control({position:r});return F.onAdd=function(){if(a&&(P.className=a),t){var N=Object.keys(t).map(function(V){return"".concat(vk(V),":").concat(t[V])}).join(";");P.style.cssText=N}return P},F.onRemove=function(){},v(F),g.addControl(F),function(){g.removeControl(F)}},[]),Z2(function(){p&&p.setPosition(r||"bottomleft")},[r]),createPortal(i,P)}var j2=(0,de.createContext)({});function PR(){return useContext(j2)}var RR=de.useEffect,mk=de.memo(function(a){var t=a.layer,i=a.active;return t.active(i.option),null},he.isEqual),LR=de.useEffect,gk=de.memo(function(a){var t=a.layer,i=a.animate;return t.animate(i),null},he.isEqual),OR=de.useEffect,yk=de.memo(function(a){var t=a.layer,i=a.color;return i.field?t.color(i.field,i.values):t.color(i.values),null},he.isEqual),_k=de.memo(function(a){var t=a.layer,i=a.filter;return i.field&&t.filter(i.field,i.values),null},he.isEqual),xk=de.memo(function(a){var t=a.layer,i=a.scale;return t.scale(i.values),null},he.isEqual),FR=de.useEffect,bk=de.memo(function(a){var t=a.layer,i=a.select;return t.select(i.option),null},he.isEqual),Ek=de.memo(function(a){var t=a.layer,i=a.shape;return i.field?t.shape(i.field,i.values):t.shape(i.values),null},he.isEqual),Ck=de.memo(function(a){var t=a.layer,i=a.size;return i.field?t.size(i.field,i.values):t.size(i.values),null},he.isEqual),Sk=["data"];function Ak(e,a){if(e==null)return{};var t=wk(e,a),i,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)i=o[r],!(a.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(t[i]=e[i]))}return t}function wk(e,a){if(e==null)return{};var t={},i=Object.keys(e),r,o;for(o=0;o<i.length;o++)r=i[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var Tk=de.memo(function(a){var t=a.layer,i=a.source,r=i.data,o=Ak(i,Sk);return t.inited?t.setData(r,o):t.source(r,o),o.autoFit&&t.fitBounds(o&&o.fitBoundsOptions),null},he.isEqual),DR=de.useEffect,Mk=de.memo(function(a){var t=a.layer,i=a.style;return t.style(i),null},he.isEqual);function Ik(e,a){return Lk(e)||Rk(e,a)||Pk(e,a)||kk()}function kk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pk(e,a){if(!!e){if(typeof e=="string")return G2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G2(e,a)}}function G2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,i=new Array(a);t<a;t++)i[t]=e[t];return i}function Rk(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var i=[],r=!0,o=!1,u,p;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(i.push(u.value),!(a&&i.length===a));r=!0);}catch(v){o=!0,p=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw p}}return i}}function Lk(e){if(Array.isArray(e))return e}var Bm=de.useEffect,Ok=de.useState;function H2(e,a){var t=a.source,i=a.color,r=a.shape,o=a.style,u=a.size,p=a.scale,v=a.active,g=a.select,E=a.filter,A=a.animate,P=a.options,F=a.onLayerLoaded,N=Ne(),V=Ok(function(){var ye;switch(e){case"polygonLayer":ye=new V1(P);break;case"lineLayer":ye=new XT(P);break;case"pointLayer":ye=new U5(P);break;case"heatmapLayer":ye=new $S(P);break;case"rasterLayer":ye=new bM(P);break;case"imageLayer":ye=new f1(P);break;case"citybuildingLayer":ye=new bS(P);break;default:ye=new V1(P)}return ye.on("inited",function(){F&&F(ye,N)}),ye}),Y=Ik(V,1),ie=Y[0];return Bm(function(){return N.addLayer(ie),function(){N.removeLayer(ie)}},[]),Bm(function(){ie.inited&&P&&ie.updateLayerConfig(P)},[P==null?void 0:P.minZoom,P==null?void 0:P.maxZoom,P==null?void 0:P.visible]),Bm(function(){ie.inited&&(P==null?void 0:P.zIndex)&&ie.setIndex(P.zIndex)},[P==null?void 0:P.zIndex]),Bm(function(){ie.inited&&(P==null?void 0:P.blend)&&ie.setBlend(P.blend)},[P==null?void 0:P.blend]),Bm(function(){N.render()}),de.createElement(j2.Provider,{value:ie},de.createElement(Tk,{layer:ie,source:t}),p&&de.createElement(xk,{layer:ie,scale:p}),i&&de.createElement(yk,{layer:ie,color:i}),u&&de.createElement(Ck,{layer:ie,size:u}),r&&de.createElement(Ek,{layer:ie,shape:r}),o&&de.createElement(Mk,{layer:ie,style:o}),v&&de.createElement(mk,{layer:ie,active:v}),g&&de.createElement(bk,{layer:ie,select:g}),E&&de.createElement(_k,{layer:ie,filter:E}),A&&de.createElement(gk,{layer:ie,animate:A}),a.children)}var BR=null,NR=null,Fk=de.memo(function(a){return H2("pointLayer",a)}),Dk=de.memo(function(a){return H2("heatmapLayer",a)}),zR=null,UR=null,ZR=null,VR=de.useEffect,jR=null,GR=null;function Ug(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ug=function(t){return typeof t}:Ug=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ug(e)}function W2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);a&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,i)}return t}function Zg(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?W2(Object(t),!0).forEach(function(i){Bk(e,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):W2(Object(t)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(t,i))})}return e}function Bk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function Nk(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function X2(e,a){for(var t=0;t<a.length;t++){var i=a[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function zk(e,a,t){return a&&X2(e.prototype,a),t&&X2(e,t),e}function Uk(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&jy(e,a)}function jy(e,a){return jy=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},jy(e,a)}function Zk(e){var a=Gk();return function(){var i=Vg(e),r;if(a){var o=Vg(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return Vk(this,r)}}function Vk(e,a){if(a&&(Ug(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jk(e)}function jk(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Gk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Vg(e){return Vg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Vg(e)}var HR=function(e){Uk(t,e);var a=Zk(t);function t(i){var r;return Nk(this,t),r=a.call(this,i),r.el=void 0,r.scene=void 0,r.popup=void 0,r.el=document.createElement("div"),r}return zk(t,[{key:"componentDidMount",value:function(){var r,o=this.props,u=o.lnglat,p=o.children,v=o.option,g=o.lngLat,E=new N_(Zg(Zg({},v),{},{stopPropagation:(r=this.props.option)===null||r===void 0?void 0:r.stopPropagation}));u&&E.setLnglat(u),g&&E.setLnglat(g),p&&E.setDOMContent(this.el),this.popup=E,this.scene.addPopup(E)}},{key:"componentDidUpdate",value:function(r){var o,u,p,v,g,E,A=Array.isArray(r.lnglat)?r.lnglat:[r==null||(o=r.lnglat)===null||o===void 0?void 0:o.lng,r==null||(u=r.lnglat)===null||u===void 0?void 0:u.lat],P=Array.isArray(this.props.lnglat)?this.props.lnglat:[(p=this.props)===null||p===void 0||(v=p.lnglat)===null||v===void 0?void 0:v.lng,(g=this.props)===null||g===void 0||(E=g.lnglat)===null||E===void 0?void 0:E.lat],F=A.toString()!==P.toString();if(F){var N;this.popup.remove(),this.popup=new N_(Zg(Zg({},this.props.option),{},{stopPropagation:(N=this.props.option)===null||N===void 0?void 0:N.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var r=this;return de.createElement(y.Consumer,{},function(o){return o&&(r.scene=o),(0,N2.createPortal)(r.props.children,r.el)})}}]),t}(de.PureComponent);function jg(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?jg=function(t){return typeof t}:jg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jg(e)}function Hk(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function Y2(e,a){for(var t=0;t<a.length;t++){var i=a[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Wk(e,a,t){return a&&Y2(e.prototype,a),t&&Y2(e,t),e}function Xk(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&Gy(e,a)}function Gy(e,a){return Gy=Object.setPrototypeOf||function(i,r){return i.__proto__=r,i},Gy(e,a)}function Yk(e){var a=Kk();return function(){var i=Gg(e),r;if(a){var o=Gg(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return qk(this,r)}}function qk(e,a){if(a&&(jg(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $k(e)}function $k(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Gg(e){return Gg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Gg(e)}var WR=function(e){Xk(t,e);var a=Yk(t);function t(i){var r;return Hk(this,t),r=a.call(this,i),r.el=void 0,r.scene=void 0,r.marker=void 0,r.el=document.createElement("div"),r}return Wk(t,[{key:"componentDidMount",value:function(){var r=this.props,o=r.lnglat,u=r.children,p=r.option,v=r.onMarkerLoaded,g=new B_(p);o&&g.setLnglat(o),u&&g.setElement(this.el),this.marker=g,v&&v(g),this.scene.addMarker(g)}},{key:"componentDidUpdate",value:function(r){var o,u=(r==null?void 0:r.lnglat.toString())!==((o=this.props)===null||o===void 0?void 0:o.lnglat.toString());u&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var r=this;return de.createElement(y.Consumer,{},function(o){return o&&(r.scene=o),(0,N2.createPortal)(r.props.children,r.el)})}}]),t}(de.PureComponent),XR=de.useEffect,YR=null,qR=null,$R=de.useEffect,KR=null},75174:function(hi,Ae,fe){var We=function(de){"use strict";function y(_,w){var M=Object.keys(_);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(_);w&&(O=O.filter(function(B){return Object.getOwnPropertyDescriptor(_,B).enumerable})),M.push.apply(M,O)}return M}function Ne(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ne=function(){return _};var _={},w=Object.prototype,M=w.hasOwnProperty,O=typeof Symbol=="function"?Symbol:{},B=O.iterator||"@@iterator",J=O.asyncIterator||"@@asyncIterator",ce=O.toStringTag||"@@toStringTag";function se(Kr,cn,Bi){return Object.defineProperty(Kr,cn,{value:Bi,enumerable:!0,configurable:!0,writable:!0}),Kr[cn]}try{se({},"")}catch(Kr){se=function(cn,Bi,qa){return cn[Bi]=qa}}function De(Kr,cn,Bi,qa){var xa=cn&&cn.prototype instanceof Qt?cn:Qt,ml=Object.create(xa.prototype),Il=new ro(qa||[]);return ml._invoke=function(_s,kl,ws){var Lh="suspendedStart";return function(zp,_u){if(Lh==="executing")throw new Error("Generator is already running");if(Lh==="completed"){if(zp==="throw")throw _u;return co()}for(ws.method=zp,ws.arg=_u;;){var Po=ws.delegate;if(Po){var Pl=xi(Po,ws);if(Pl){if(Pl===Ze)continue;return Pl}}if(ws.method==="next")ws.sent=ws._sent=ws.arg;else if(ws.method==="throw"){if(Lh==="suspendedStart")throw Lh="completed",ws.arg;ws.dispatchException(ws.arg)}else ws.method==="return"&&ws.abrupt("return",ws.arg);Lh="executing";var Ou=je(_s,kl,ws);if(Ou.type==="normal"){if(Lh=ws.done?"completed":"suspendedYield",Ou.arg===Ze)continue;return{value:Ou.arg,done:ws.done}}Ou.type==="throw"&&(Lh="completed",ws.method="throw",ws.arg=Ou.arg)}}}(Kr,Bi,Il),ml}function je(Kr,cn,Bi){try{return{type:"normal",arg:Kr.call(cn,Bi)}}catch(qa){return{type:"throw",arg:qa}}}_.wrap=De;var Ze={};function Qt(){}function xr(){}function Fr(){}var Xr={};se(Xr,B,function(){return this});var Rn=Object.getPrototypeOf,Cn=Rn&&Rn(Rn(lo([])));Cn&&Cn!==w&&M.call(Cn,B)&&(Xr=Cn);var Fn=Fr.prototype=Qt.prototype=Object.create(Xr);function vn(Kr){["next","throw","return"].forEach(function(cn){se(Kr,cn,function(Bi){return this._invoke(cn,Bi)})})}function ri(Kr,cn){var Bi;this._invoke=function(qa,xa){function ml(){return new cn(function(Il,_s){(function kl(ws,Lh,zp,_u){var Po=je(Kr[ws],Kr,Lh);if(Po.type!=="throw"){var Pl=Po.arg,Ou=Pl.value;return Ou&&typeof Ou=="object"&&M.call(Ou,"__await")?cn.resolve(Ou.__await).then(function(ol){kl("next",ol,zp,_u)},function(ol){kl("throw",ol,zp,_u)}):cn.resolve(Ou).then(function(ol){Pl.value=ol,zp(Pl)},function(ol){return kl("throw",ol,zp,_u)})}_u(Po.arg)})(qa,xa,Il,_s)})}return Bi=Bi?Bi.then(ml,ml):ml()}}function xi(Kr,cn){var Bi=Kr.iterator[cn.method];if(Bi===void 0){if(cn.delegate=null,cn.method==="throw"){if(Kr.iterator.return&&(cn.method="return",cn.arg=void 0,xi(Kr,cn),cn.method==="throw"))return Ze;cn.method="throw",cn.arg=new TypeError("The iterator does not provide a 'throw' method")}return Ze}var qa=je(Bi,Kr.iterator,cn.arg);if(qa.type==="throw")return cn.method="throw",cn.arg=qa.arg,cn.delegate=null,Ze;var xa=qa.arg;return xa?xa.done?(cn[Kr.resultName]=xa.value,cn.next=Kr.nextLoc,cn.method!=="return"&&(cn.method="next",cn.arg=void 0),cn.delegate=null,Ze):xa:(cn.method="throw",cn.arg=new TypeError("iterator result is not an object"),cn.delegate=null,Ze)}function Eo(Kr){var cn={tryLoc:Kr[0]};1 in Kr&&(cn.catchLoc=Kr[1]),2 in Kr&&(cn.finallyLoc=Kr[2],cn.afterLoc=Kr[3]),this.tryEntries.push(cn)}function uo(Kr){var cn=Kr.completion||{};cn.type="normal",delete cn.arg,Kr.completion=cn}function ro(Kr){this.tryEntries=[{tryLoc:"root"}],Kr.forEach(Eo,this),this.reset(!0)}function lo(Kr){if(Kr){var cn=Kr[B];if(cn)return cn.call(Kr);if(typeof Kr.next=="function")return Kr;if(!isNaN(Kr.length)){var Bi=-1,qa=function xa(){for(;++Bi<Kr.length;)if(M.call(Kr,Bi))return xa.value=Kr[Bi],xa.done=!1,xa;return xa.value=void 0,xa.done=!0,xa};return qa.next=qa}}return{next:co}}function co(){return{value:void 0,done:!0}}return xr.prototype=Fr,se(Fn,"constructor",Fr),se(Fr,"constructor",xr),xr.displayName=se(Fr,ce,"GeneratorFunction"),_.isGeneratorFunction=function(Kr){var cn=typeof Kr=="function"&&Kr.constructor;return!!cn&&(cn===xr||(cn.displayName||cn.name)==="GeneratorFunction")},_.mark=function(Kr){return Object.setPrototypeOf?Object.setPrototypeOf(Kr,Fr):(Kr.__proto__=Fr,se(Kr,ce,"GeneratorFunction")),Kr.prototype=Object.create(Fn),Kr},_.awrap=function(Kr){return{__await:Kr}},vn(ri.prototype),se(ri.prototype,J,function(){return this}),_.AsyncIterator=ri,_.async=function(Kr,cn,Bi,qa,xa){xa===void 0&&(xa=Promise);var ml=new ri(De(Kr,cn,Bi,qa),xa);return _.isGeneratorFunction(cn)?ml:ml.next().then(function(Il){return Il.done?Il.value:ml.next()})},vn(Fn),se(Fn,ce,"Generator"),se(Fn,B,function(){return this}),se(Fn,"toString",function(){return"[object Generator]"}),_.keys=function(Kr){var cn=[];for(var Bi in Kr)cn.push(Bi);return cn.reverse(),function qa(){for(;cn.length;){var xa=cn.pop();if(xa in Kr)return qa.value=xa,qa.done=!1,qa}return qa.done=!0,qa}},_.values=lo,ro.prototype={constructor:ro,reset:function(Kr){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(uo),!Kr)for(var cn in this)cn.charAt(0)==="t"&&M.call(this,cn)&&!isNaN(+cn.slice(1))&&(this[cn]=void 0)},stop:function(){this.done=!0;var Kr=this.tryEntries[0].completion;if(Kr.type==="throw")throw Kr.arg;return this.rval},dispatchException:function(Kr){if(this.done)throw Kr;var cn=this;function Bi(kl,ws){return ml.type="throw",ml.arg=Kr,cn.next=kl,ws&&(cn.method="next",cn.arg=void 0),!!ws}for(var qa=this.tryEntries.length-1;qa>=0;--qa){var xa=this.tryEntries[qa],ml=xa.completion;if(xa.tryLoc==="root")return Bi("end");if(xa.tryLoc<=this.prev){var Il=M.call(xa,"catchLoc"),_s=M.call(xa,"finallyLoc");if(Il&&_s){if(this.prev<xa.catchLoc)return Bi(xa.catchLoc,!0);if(this.prev<xa.finallyLoc)return Bi(xa.finallyLoc)}else if(Il){if(this.prev<xa.catchLoc)return Bi(xa.catchLoc,!0)}else{if(!_s)throw new Error("try statement without catch or finally");if(this.prev<xa.finallyLoc)return Bi(xa.finallyLoc)}}}},abrupt:function(Kr,cn){for(var Bi=this.tryEntries.length-1;Bi>=0;--Bi){var qa=this.tryEntries[Bi];if(qa.tryLoc<=this.prev&&M.call(qa,"finallyLoc")&&this.prev<qa.finallyLoc){var xa=qa;break}}xa&&(Kr==="break"||Kr==="continue")&&xa.tryLoc<=cn&&cn<=xa.finallyLoc&&(xa=null);var ml=xa?xa.completion:{};return ml.type=Kr,ml.arg=cn,xa?(this.method="next",this.next=xa.finallyLoc,Ze):this.complete(ml)},complete:function(Kr,cn){if(Kr.type==="throw")throw Kr.arg;return Kr.type==="break"||Kr.type==="continue"?this.next=Kr.arg:Kr.type==="return"?(this.rval=this.arg=Kr.arg,this.method="return",this.next="end"):Kr.type==="normal"&&cn&&(this.next=cn),Ze},finish:function(Kr){for(var cn=this.tryEntries.length-1;cn>=0;--cn){var Bi=this.tryEntries[cn];if(Bi.finallyLoc===Kr)return this.complete(Bi.completion,Bi.afterLoc),uo(Bi),Ze}},catch:function(Kr){for(var cn=this.tryEntries.length-1;cn>=0;--cn){var Bi=this.tryEntries[cn];if(Bi.tryLoc===Kr){var qa=Bi.completion;if(qa.type==="throw"){var xa=qa.arg;uo(Bi)}return xa}}throw new Error("illegal catch attempt")},delegateYield:function(Kr,cn,Bi){return this.delegate={iterator:lo(Kr),resultName:cn,nextLoc:Bi},this.method==="next"&&(this.arg=void 0),Ze}},_}function K(_,w,M,O,B,J,ce){try{var se=_[J](ce),De=se.value}catch(je){return void M(je)}se.done?w(De):Promise.resolve(De).then(O,B)}function Re(_){return function(){var w=this,M=arguments;return new Promise(function(O,B){var J=_.apply(w,M);function ce(De){K(J,O,B,ce,se,"next",De)}function se(De){K(J,O,B,ce,se,"throw",De)}ce(void 0)})}}function pe(_,w){if(!(_ instanceof w))throw new TypeError("Cannot call a class as a function")}function lt(_,w){for(var M=0;M<w.length;M++){var O=w[M];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(_,O.key,O)}}function we(_,w,M){return w&&lt(_.prototype,w),M&&lt(_,M),Object.defineProperty(_,"prototype",{writable:!1}),_}function Xe(_,w,M){return w in _?Object.defineProperty(_,w,{value:M,enumerable:!0,configurable:!0,writable:!0}):_[w]=M,_}function Ct(_,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function");_.prototype=Object.create(w&&w.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),Object.defineProperty(_,"prototype",{writable:!1}),w&&tr(_,w)}function Pt(_){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(w){return w.__proto__||Object.getPrototypeOf(w)})(_)}function tr(_,w){return(tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(M,O){return M.__proto__=O,M})(_,w)}function Yt(_){if(_===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _}function Wt(_,w){if(w&&(typeof w=="object"||typeof w=="function"))return w;if(w!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yt(_)}function br(_){var w=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}();return function(){var M,O=Pt(_);if(w){var B=Pt(this).constructor;M=Reflect.construct(O,arguments,B)}else M=O.apply(this,arguments);return Wt(this,M)}}function lr(_,w){return function(M){if(Array.isArray(M))return M}(_)||function(M,O){var B=M==null?null:typeof Symbol!="undefined"&&M[Symbol.iterator]||M["@@iterator"];if(B!=null){var J,ce,se=[],De=!0,je=!1;try{for(B=B.call(M);!(De=(J=B.next()).done)&&(se.push(J.value),!O||se.length!==O);De=!0);}catch(Ze){je=!0,ce=Ze}finally{try{De||B.return==null||B.return()}finally{if(je)throw ce}}return se}}(_,w)||zt(_,w)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function kt(_){return function(w){if(Array.isArray(w))return Pr(w)}(_)||function(w){if(typeof Symbol!="undefined"&&w[Symbol.iterator]!=null||w["@@iterator"]!=null)return Array.from(w)}(_)||zt(_)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function zt(_,w){if(_){if(typeof _=="string")return Pr(_,w);var M=Object.prototype.toString.call(_).slice(8,-1);return M==="Object"&&_.constructor&&(M=_.constructor.name),M==="Map"||M==="Set"?Array.from(_):M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M)?Pr(_,w):void 0}}function Pr(_,w){(w==null||w>_.length)&&(w=_.length);for(var M=0,O=new Array(w);M<w;M++)O[M]=_[M];return O}var re=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof fe.g!="undefined"?fe.g:typeof self!="undefined"?self:{};function yr(_,w){return _(w={exports:{}},w.exports),w.exports}var Rt,_t,Kt=function(_){return _&&_.Math==Math&&_},Ue=Kt(typeof globalThis=="object"&&globalThis)||Kt(typeof window=="object"&&window)||Kt(typeof self=="object"&&self)||Kt(typeof re=="object"&&re)||function(){return this}()||Function("return this")(),Er=Object.defineProperty,an=function(_,w){try{Er(Ue,_,{value:w,configurable:!0,writable:!0})}catch(M){Ue[_]=w}return w},ue=Ue["__core-js_shared__"]||an("__core-js_shared__",{}),rt=yr(function(_){(_.exports=function(w,M){return ue[w]||(ue[w]=M!==void 0?M:{})})("versions",[]).push({version:"3.24.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})}),Z=function(_){try{return!!_()}catch(w){return!0}},_e=!Z(function(){var _=function(){}.bind();return typeof _!="function"||_.hasOwnProperty("prototype")}),ze=Function.prototype,St=ze.bind,Ut=ze.call,cr=_e&&St.bind(Ut,Ut),wt=_e?function(_){return _&&cr(_)}:function(_){return _&&function(){return Ut.apply(_,arguments)}},Or=TypeError,Xn=function(_){if(_==null)throw Or("Can't call method on "+_);return _},Qr=Object,Pi=function(_){return Qr(Xn(_))},mi=wt({}.hasOwnProperty),ln=Object.hasOwn||function(_,w){return mi(Pi(_),w)},ba=0,ua=Math.random(),Li=wt(1 .toString),Ma=function(_){return"Symbol("+(_===void 0?"":_)+")_"+Li(++ba+ua,36)},ai=function(_){return typeof _=="function"},Ki=function(_){return ai(_)?_:void 0},ci=function(_,w){return arguments.length<2?Ki(Ue[_]):Ue[_]&&Ue[_][w]},gi=ci("navigator","userAgent")||"",zo=Ue.process,go=Ue.Deno,no=zo&&zo.versions||go&&go.version,It=no&&no.v8;It&&(_t=(Rt=It.split("."))[0]>0&&Rt[0]<4?1:+(Rt[0]+Rt[1])),!_t&&gi&&(!(Rt=gi.match(/Edge\/(\d+)/))||Rt[1]>=74)&&(Rt=gi.match(/Chrome\/(\d+)/))&&(_t=+Rt[1]);var ge=_t,oe=!!Object.getOwnPropertySymbols&&!Z(function(){var _=Symbol();return!String(_)||!(Object(_)instanceof Symbol)||!Symbol.sham&&ge&&ge<41}),Te=oe&&!Symbol.sham&&typeof Symbol.iterator=="symbol",j=rt("wks"),ot=Ue.Symbol,sr=ot&&ot.for,Yr=Te?ot:ot&&ot.withoutSetter||Ma,Ke=function(_){if(!ln(j,_)||!oe&&typeof j[_]!="string"){var w="Symbol."+_;oe&&ln(ot,_)?j[_]=ot[_]:j[_]=Te&&sr?sr(w):Yr(w)}return j[_]},Dt={};Dt[Ke("toStringTag")]="z";var Cr=String(Dt)==="[object z]",_r=!Z(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Rr=function(_){return typeof _=="object"?_!==null:ai(_)},mn=Ue.document,vi=Rr(mn)&&Rr(mn.createElement),ni=function(_){return vi?mn.createElement(_):{}},bn=!_r&&!Z(function(){return Object.defineProperty(ni("div"),"a",{get:function(){return 7}}).a!=7}),Oi=_r&&Z(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Ni=String,Ha=TypeError,oa=function(_){if(Rr(_))return _;throw Ha(Ni(_)+" is not an object")},Wa=Function.prototype.call,Ci=_e?Wa.bind(Wa):function(){return Wa.apply(Wa,arguments)},la=wt({}.isPrototypeOf),Q=Object,ae=Te?function(_){return typeof _=="symbol"}:function(_){var w=ci("Symbol");return ai(w)&&la(w.prototype,Q(_))},me=String,ke=function(_){try{return me(_)}catch(w){return"Object"}},qe=TypeError,st=function(_){if(ai(_))return _;throw qe(ke(_)+" is not a function")},xt=function(_,w){var M=_[w];return M==null?void 0:st(M)},Me=TypeError,it=TypeError,Gt=Ke("toPrimitive"),Zr=function(_,w){if(!Rr(_)||ae(_))return _;var M,O=xt(_,Gt);if(O){if(w===void 0&&(w="default"),M=Ci(O,_,w),!Rr(M)||ae(M))return M;throw it("Can't convert object to primitive value")}return w===void 0&&(w="number"),function(B,J){var ce,se;if(J==="string"&&ai(ce=B.toString)&&!Rr(se=Ci(ce,B))||ai(ce=B.valueOf)&&!Rr(se=Ci(ce,B))||J!=="string"&&ai(ce=B.toString)&&!Rr(se=Ci(ce,B)))return se;throw Me("Can't convert object to primitive value")}(_,w)},or=function(_){var w=Zr(_,"string");return ae(w)?w:w+""},hr=TypeError,jr=Object.defineProperty,oi=Object.getOwnPropertyDescriptor,Sn={f:_r?Oi?function(_,w,M){if(oa(_),w=or(w),oa(M),typeof _=="function"&&w==="prototype"&&"value"in M&&"writable"in M&&!M.writable){var O=oi(_,w);O&&O.writable&&(_[w]=M.value,M={configurable:"configurable"in M?M.configurable:O.configurable,enumerable:"enumerable"in M?M.enumerable:O.enumerable,writable:!1})}return jr(_,w,M)}:jr:function(_,w,M){if(oa(_),w=or(w),oa(M),bn)try{return jr(_,w,M)}catch(O){}if("get"in M||"set"in M)throw hr("Accessors not supported");return"value"in M&&(_[w]=M.value),_}},Jt=Function.prototype,Hn=_r&&Object.getOwnPropertyDescriptor,wn=ln(Jt,"name"),Tn={EXISTS:wn,PROPER:wn&&function(){}.name==="something",CONFIGURABLE:wn&&(!_r||_r&&Hn(Jt,"name").configurable)},sa=wt(Function.toString);ai(ue.inspectSource)||(ue.inspectSource=function(_){return sa(_)});var Ir,qi,La,na=ue.inspectSource,pa=Ue.WeakMap,Lt=ai(pa)&&/native code/.test(na(pa)),At=function(_,w){return{enumerable:!(1&_),configurable:!(2&_),writable:!(4&_),value:w}},Qi=_r?function(_,w,M){return Sn.f(_,w,At(1,M))}:function(_,w,M){return _[w]=M,_},fo=rt("keys"),Ba=function(_){return fo[_]||(fo[_]=Ma(_))},zi={},Ea=Ue.TypeError,Co=Ue.WeakMap;if(Lt||ue.state){var sn=ue.state||(ue.state=new Co),Wr=wt(sn.get),bt=wt(sn.has),Ds=wt(sn.set);Ir=function(_,w){if(bt(sn,_))throw new Ea("Object already initialized");return w.facade=_,Ds(sn,_,w),w},qi=function(_){return Wr(sn,_)||{}},La=function(_){return bt(sn,_)}}else{var jt=Ba("state");zi[jt]=!0,Ir=function(_,w){if(ln(_,jt))throw new Ea("Object already initialized");return w.facade=_,Qi(_,jt,w),w},qi=function(_){return ln(_,jt)?_[jt]:{}},La=function(_){return ln(_,jt)}}var Xi={set:Ir,get:qi,has:La,enforce:function(_){return La(_)?qi(_):Ir(_,{})},getterFor:function(_){return function(w){var M;if(!Rr(w)||(M=qi(w)).type!==_)throw Ea("Incompatible receiver, "+_+" required");return M}}},Yl=yr(function(_){var w=Tn.CONFIGURABLE,M=Xi.enforce,O=Xi.get,B=Object.defineProperty,J=_r&&!Z(function(){return B(function(){},"length",{value:8}).length!==8}),ce=String(String).split("String"),se=_.exports=function(De,je,Ze){String(je).slice(0,7)==="Symbol("&&(je="["+String(je).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),Ze&&Ze.getter&&(je="get "+je),Ze&&Ze.setter&&(je="set "+je),(!ln(De,"name")||w&&De.name!==je)&&(_r?B(De,"name",{value:je,configurable:!0}):De.name=je),J&&Ze&&ln(Ze,"arity")&&De.length!==Ze.arity&&B(De,"length",{value:Ze.arity});try{Ze&&ln(Ze,"constructor")&&Ze.constructor?_r&&B(De,"prototype",{writable:!1}):De.prototype&&(De.prototype=void 0)}catch(xr){}var Qt=M(De);return ln(Qt,"source")||(Qt.source=ce.join(typeof je=="string"?je:"")),De};Function.prototype.toString=se(function(){return ai(this)&&O(this).source||na(this)},"toString")}),Oa=function(_,w,M,O){O||(O={});var B=O.enumerable,J=O.name!==void 0?O.name:w;if(ai(M)&&Yl(M,J,O),O.global)B?_[w]=M:an(w,M);else{try{O.unsafe?_[w]&&(B=!0):delete _[w]}catch(ce){}B?_[w]=M:Sn.f(_,w,{value:M,enumerable:!1,configurable:!O.nonConfigurable,writable:!O.nonWritable})}return _},po=wt({}.toString),Oo=wt("".slice),_a=function(_){return Oo(po(_),8,-1)},Bs=Ke("toStringTag"),Ns=Object,ql=_a(function(){return arguments}())=="Arguments",So=Cr?_a:function(_){var w,M,O;return _===void 0?"Undefined":_===null?"Null":typeof(M=function(B,J){try{return B[J]}catch(ce){}}(w=Ns(_),Bs))=="string"?M:ql?_a(w):(O=_a(w))=="Object"&&ai(w.callee)?"Arguments":O},Ts=Cr?{}.toString:function(){return"[object "+So(this)+"]"};Cr||Oa(Object.prototype,"toString",Ts,{unsafe:!0});var Ka={}.propertyIsEnumerable,Uo=Object.getOwnPropertyDescriptor,Ms={f:Uo&&!Ka.call({1:2},1)?function(_){var w=Uo(this,_);return!!w&&w.enumerable}:Ka},Fo=Object,Xu=wt("".split),sl=Z(function(){return!Fo("z").propertyIsEnumerable(0)})?function(_){return _a(_)=="String"?Xu(_,""):Fo(_)}:Fo,ns=function(_){return sl(Xn(_))},ve=Object.getOwnPropertyDescriptor,Be={f:_r?ve:function(_,w){if(_=ns(_),w=or(w),bn)try{return ve(_,w)}catch(M){}if(ln(_,w))return At(!Ci(Ms.f,_,w),_[w])}},yt=Math.ceil,ir=Math.floor,gn=Math.trunc||function(_){var w=+_;return(w>0?ir:yt)(w)},ei=function(_){var w=+_;return w!=w||w===0?0:gn(w)},ga=Math.max,Jo=Math.min,Fa=function(_,w){var M=ei(_);return M<0?ga(M+w,0):Jo(M,w)},Zo=Math.min,Ho=function(_){return _>0?Zo(ei(_),9007199254740991):0},Ro=function(_){return Ho(_.length)},zs=function(_){return function(w,M,O){var B,J=ns(w),ce=Ro(J),se=Fa(O,ce);if(_&&M!=M){for(;ce>se;)if((B=J[se++])!=B)return!0}else for(;ce>se;se++)if((_||se in J)&&J[se]===M)return _||se||0;return!_&&-1}},hs={includes:zs(!0),indexOf:zs(!1)},Is=hs.indexOf,bu=wt([].push),Yu=function(_,w){var M,O=ns(_),B=0,J=[];for(M in O)!ln(zi,M)&&ln(O,M)&&bu(J,M);for(;w.length>B;)ln(O,M=w[B++])&&(~Is(J,M)||bu(J,M));return J},Eu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Cu=Eu.concat("length","prototype"),Za={f:Object.getOwnPropertyNames||function(_){return Yu(_,Cu)}},ps={f:Object.getOwnPropertySymbols},iu=wt([].concat),Su=ci("Reflect","ownKeys")||function(_){var w=Za.f(oa(_)),M=ps.f;return M?iu(w,M(_)):w},mf=function(_,w,M){for(var O=Su(w),B=Sn.f,J=Be.f,ce=0;ce<O.length;ce++){var se=O[ce];ln(_,se)||M&&ln(M,se)||B(_,se,J(w,se))}},zh=/#|\.prototype\./,qs=function(_,w){var M=ul[gf(_)];return M==b||M!=jc&&(ai(w)?Z(w):!!w)},gf=qs.normalize=function(_){return String(_).replace(zh,".").toLowerCase()},ul=qs.data={},jc=qs.NATIVE="N",b=qs.POLYFILL="P",k=qs,G=Be.f,D=function(_,w){var M,O,B,J,ce,se=_.target,De=_.global,je=_.stat;if(M=De?Ue:je?Ue[se]||an(se,{}):(Ue[se]||{}).prototype)for(O in w){if(J=w[O],B=_.dontCallGetSet?(ce=G(M,O))&&ce.value:M[O],!k(De?O:se+(je?".":"#")+O,_.forced)&&B!==void 0){if(typeof J==typeof B)continue;mf(J,B)}(_.sham||B&&B.sham)&&Qi(J,"sham",!0),Oa(M,O,J,_)}},ne=_a(Ue.process)=="process",Oe=String,dt=TypeError,Mt=Object.setPrototypeOf||("__proto__"in{}?function(){var _,w=!1,M={};try{(_=wt(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(M,[]),w=M instanceof Array}catch(O){}return function(O,B){return oa(O),function(J){if(typeof J=="object"||ai(J))return J;throw dt("Can't set "+Oe(J)+" as a prototype")}(B),w?_(O,B):O.__proto__=B,O}}():void 0),Zt=Sn.f,Br=Ke("toStringTag"),Gr=function(_,w,M){_&&!M&&(_=_.prototype),_&&!ln(_,Br)&&Zt(_,Br,{configurable:!0,value:w})},Yn=Ke("species"),ji=function(_){var w=ci(_),M=Sn.f;_r&&w&&!w[Yn]&&M(w,Yn,{configurable:!0,get:function(){return this}})},Ui=TypeError,Fi=function(_,w){if(la(w,_))return _;throw Ui("Incorrect invocation")},io=function(){},vo=[],Ia=ci("Reflect","construct"),au=/^\s*(?:class|function)\b/,Ll=wt(au.exec),hc=!au.exec(io),pc=function(_){if(!ai(_))return!1;try{return Ia(io,vo,_),!0}catch(w){return!1}},dc=function(_){if(!ai(_))return!1;switch(So(_)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return hc||!!Ll(au,na(_))}catch(w){return!0}};dc.sham=!0;var vc,Du,Ol,gl,Wo=!Ia||Z(function(){var _;return pc(pc.call)||!pc(Object)||!pc(function(){_=!0})||_})?dc:pc,dp=TypeError,Uh=function(_){if(Wo(_))return _;throw dp(ke(_)+" is not a constructor")},Au=Ke("species"),yf=function(_,w){var M,O=oa(_).constructor;return O===void 0||(M=oa(O)[Au])==null?w:Uh(M)},yl=Function.prototype,qu=yl.apply,Zh=yl.call,_l=typeof Reflect=="object"&&Reflect.apply||(_e?Zh.bind(qu):function(){return Zh.apply(qu,arguments)}),mo=wt(wt.bind),$s=function(_,w){return st(_),w===void 0?_:_e?mo(_,w):function(){return _.apply(w,arguments)}},Vh=ci("document","documentElement"),xl=wt([].slice),vp=TypeError,mp=function(_,w){if(_<w)throw vp("Not enough arguments");return _},ch=/(?:ipad|iphone|ipod).*applewebkit/i.test(gi),jf=Ue.setImmediate,_f=Ue.clearImmediate,Gf=Ue.process,Gc=Ue.Dispatch,Hf=Ue.Function,mc=Ue.MessageChannel,xf=Ue.String,$l=0,ou={};try{vc=Ue.location}catch(_){}var Wf=function(_){if(ln(ou,_)){var w=ou[_];delete ou[_],w()}},Xf=function(_){return function(){Wf(_)}},jh=function(_){Wf(_.data)},gc=function(_){Ue.postMessage(xf(_),vc.protocol+"//"+vc.host)};jf&&_f||(jf=function(_){mp(arguments.length,1);var w=ai(_)?_:Hf(_),M=xl(arguments,1);return ou[++$l]=function(){_l(w,void 0,M)},Du($l),$l},_f=function(_){delete ou[_]},ne?Du=function(_){Gf.nextTick(Xf(_))}:Gc&&Gc.now?Du=function(_){Gc.now(Xf(_))}:mc&&!ch?(gl=(Ol=new mc).port2,Ol.port1.onmessage=jh,Du=$s(gl.postMessage,gl)):Ue.addEventListener&&ai(Ue.postMessage)&&!Ue.importScripts&&vc&&vc.protocol!=="file:"&&!Z(gc)?(Du=gc,Ue.addEventListener("message",jh,!1)):Du="onreadystatechange"in ni("script")?function(_){Vh.appendChild(ni("script")).onreadystatechange=function(){Vh.removeChild(this),Wf(_)}}:function(_){setTimeout(Xf(_),0)});var $u,Fl,Hc,Kl,Yf,qf,yc,Gh,fh={set:jf,clear:_f},Wc=/ipad|iphone|ipod/i.test(gi)&&Ue.Pebble!==void 0,Vp=/web0s(?!.*chrome)/i.test(gi),hh=Be.f,Hh=fh.set,bf=Ue.MutationObserver||Ue.WebKitMutationObserver,jp=Ue.document,Xc=Ue.process,Ao=Ue.Promise,Us=hh(Ue,"queueMicrotask"),Yc=Us&&Us.value;Yc||($u=function(){var _,w;for(ne&&(_=Xc.domain)&&_.exit();Fl;){w=Fl.fn,Fl=Fl.next;try{w()}catch(M){throw Fl?Kl():Hc=void 0,M}}Hc=void 0,_&&_.enter()},ch||ne||Vp||!bf||!jp?!Wc&&Ao&&Ao.resolve?((yc=Ao.resolve(void 0)).constructor=Ao,Gh=$s(yc.then,yc),Kl=function(){Gh($u)}):ne?Kl=function(){Xc.nextTick($u)}:(Hh=$s(Hh,Ue),Kl=function(){Hh($u)}):(Yf=!0,qf=jp.createTextNode(""),new bf($u).observe(qf,{characterData:!0}),Kl=function(){qf.data=Yf=!Yf}));var ka=Yc||function(_){var w={fn:_,next:void 0};Hc&&(Hc.next=w),Fl||(Fl=w,Kl()),Hc=w},Aa=function(_){try{return{error:!1,value:_()}}catch(w){return{error:!0,value:w}}},wo=function(){this.head=null,this.tail=null};wo.prototype={add:function(_){var w={item:_,next:null};this.head?this.tail.next=w:this.head=w,this.tail=w},get:function(){var _=this.head;if(_)return this.head=_.next,this.tail===_&&(this.tail=null),_.item}};var pu,Ef,Ql,ph=wo,Qa=Ue.Promise,Cf=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Dl=!Cf&&!ne&&typeof window=="object"&&typeof document=="object",_c=(Qa&&Qa.prototype,Ke("species")),Jl=!1,ds=ai(Ue.PromiseRejectionEvent),Ku={CONSTRUCTOR:k("Promise",function(){var _=na(Qa),w=_!==String(Qa);if(!w&&ge===66)return!0;if(!ge||ge<51||!/native code/.test(_)){var M=new Qa(function(B){B(1)}),O=function(B){B(function(){},function(){})};if((M.constructor={})[_c]=O,!(Jl=M.then(function(){})instanceof O))return!0}return!w&&(Dl||Cf)&&!ds}),REJECTION_EVENT:ds,SUBCLASSING:Jl},Sf=function(_){var w,M;this.promise=new _(function(O,B){if(w!==void 0||M!==void 0)throw TypeError("Bad Promise constructor");w=O,M=B}),this.resolve=st(w),this.reject=st(M)},Vo={f:function(_){return new Sf(_)}},ti=fh.set,Xo=Ku.CONSTRUCTOR,qc=Ku.REJECTION_EVENT,Af=Ku.SUBCLASSING,Ja=Xi.getterFor("Promise"),Bu=Xi.set,xc=Qa&&Qa.prototype,Mn=Qa,wf=xc,dh=Ue.TypeError,bl=Ue.document,ho=Ue.process,du=Vo.f,Va=du,Bl=!!(bl&&bl.createEvent&&Ue.dispatchEvent),wu=function(_){var w;return!(!Rr(_)||!ai(w=_.then))&&w},Nl=function(_,w){var M,O,B,J=w.value,ce=w.state==1,se=ce?_.ok:_.fail,De=_.resolve,je=_.reject,Ze=_.domain;try{se?(ce||(w.rejection===2&&ll(w),w.rejection=1),se===!0?M=J:(Ze&&Ze.enter(),M=se(J),Ze&&(Ze.exit(),B=!0)),M===_.promise?je(dh("Promise-chain cycle")):(O=wu(M))?Ci(O,M,De,je):De(M)):je(J)}catch(Qt){Ze&&!B&&Ze.exit(),je(Qt)}},$f=function(_,w){_.notified||(_.notified=!0,ka(function(){for(var M,O=_.reactions;M=O.get();)Nl(M,_);_.notified=!1,w&&!_.rejection&&gp(_)}))},$c=function(_,w,M){var O,B;Bl?((O=bl.createEvent("Event")).promise=w,O.reason=M,O.initEvent(_,!1,!0),Ue.dispatchEvent(O)):O={promise:w,reason:M},!qc&&(B=Ue["on"+_])?B(O):_==="unhandledrejection"&&function(J,ce){var se=Ue.console;se&&se.error&&(arguments.length==1?se.error(J):se.error(J,ce))}("Unhandled promise rejection",M)},gp=function(_){Ci(ti,Ue,function(){var w,M=_.facade,O=_.value;if(yi(_)&&(w=Aa(function(){ne?ho.emit("unhandledRejection",O,M):$c("unhandledrejection",M,O)}),_.rejection=ne||yi(_)?2:1,w.error))throw w.value})},yi=function(_){return _.rejection!==1&&!_.parent},ll=function(_){Ci(ti,Ue,function(){var w=_.facade;ne?ho.emit("rejectionHandled",w):$c("rejectionhandled",w,_.value)})},Ks=function(_,w,M){return function(O){_(w,O,M)}},ha=function(_,w,M){_.done||(_.done=!0,M&&(_=M),_.value=w,_.state=2,$f(_,!0))},cl=function(_,w,M){if(!_.done){_.done=!0,M&&(_=M);try{if(_.facade===w)throw dh("Promise can't be resolved itself");var O=wu(w);O?ka(function(){var B={done:!1};try{Ci(O,w,Ks(cl,B,_),Ks(ha,B,_))}catch(J){ha(B,J,_)}}):(_.value=w,_.state=1,$f(_,!1))}catch(B){ha({done:!1},B,_)}}};if(Xo&&(wf=(Mn=function(_){Fi(this,wf),st(_),Ci(pu,this);var w=Ja(this);try{_(Ks(cl,w),Ks(ha,w))}catch(M){ha(w,M)}}).prototype,(pu=function(_){Bu(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new ph,rejection:!1,state:0,value:void 0})}).prototype=Oa(wf,"then",function(_,w){var M=Ja(this),O=du(yf(this,Mn));return M.parent=!0,O.ok=!ai(_)||_,O.fail=ai(w)&&w,O.domain=ne?ho.domain:void 0,M.state==0?M.reactions.add(O):ka(function(){Nl(O,M)}),O.promise}),Ef=function(){var _=new pu,w=Ja(_);this.promise=_,this.resolve=Ks(cl,w),this.reject=Ks(ha,w)},Vo.f=du=function(_){return _===Mn||_===void 0?new Ef(_):Va(_)},ai(Qa)&&xc!==Object.prototype)){Ql=xc.then,Af||Oa(xc,"then",function(_,w){var M=this;return new Mn(function(O,B){Ci(Ql,M,O,B)}).then(_,w)},{unsafe:!0});try{delete xc.constructor}catch(_){}Mt&&Mt(xc,wf)}D({global:!0,constructor:!0,wrap:!0,forced:Xo},{Promise:Mn}),Gr(Mn,"Promise",!1),ji("Promise");var vu={},Zs=Ke("iterator"),Tf=Array.prototype,bc=function(_){return _!==void 0&&(vu.Array===_||Tf[Zs]===_)},Tu=Ke("iterator"),mu=function(_){if(_!=null)return xt(_,Tu)||xt(_,"@@iterator")||vu[So(_)]},Qu=TypeError,bi=function(_,w){var M=arguments.length<2?mu(_):w;if(st(M))return oa(Ci(M,_));throw Qu(ke(_)+" is not iterable")},pi=function(_,w,M){var O,B;oa(_);try{if(!(O=xt(_,"return"))){if(w==="throw")throw M;return M}O=Ci(O,_)}catch(J){B=!0,O=J}if(w==="throw")throw M;if(B)throw O;return oa(O),M},Kf=TypeError,Vs=function(_,w){this.stopped=_,this.result=w},fl=Vs.prototype,es=function(_,w,M){var O,B,J,ce,se,De,je,Ze=M&&M.that,Qt=!(!M||!M.AS_ENTRIES),xr=!(!M||!M.IS_RECORD),Fr=!(!M||!M.IS_ITERATOR),Xr=!(!M||!M.INTERRUPTED),Rn=$s(w,Ze),Cn=function(vn){return O&&pi(O,"normal",vn),new Vs(!0,vn)},Fn=function(vn){return Qt?(oa(vn),Xr?Rn(vn[0],vn[1],Cn):Rn(vn[0],vn[1])):Xr?Rn(vn,Cn):Rn(vn)};if(xr)O=_.iterator;else if(Fr)O=_;else{if(!(B=mu(_)))throw Kf(ke(_)+" is not iterable");if(bc(B)){for(J=0,ce=Ro(_);ce>J;J++)if((se=Fn(_[J]))&&la(fl,se))return se;return new Vs(!1)}O=bi(_,B)}for(De=xr?_.next:O.next;!(je=Ci(De,O)).done;){try{se=Fn(je.value)}catch(vn){pi(O,"throw",vn)}if(typeof se=="object"&&se&&la(fl,se))return se}return new Vs(!1)},El=Ke("iterator"),vh=!1;try{var Mf=0,ja={next:function(){return{done:!!Mf++}},return:function(){vh=!0}};ja[El]=function(){return this},Array.from(ja,function(){throw 2})}catch(_){}var yo=function(_,w){if(!w&&!vh)return!1;var M=!1;try{var O={};O[El]=function(){return{next:function(){return{done:M=!0}}}},_(O)}catch(B){}return M},mh=Ku.CONSTRUCTOR||!yo(function(_){Qa.all(_).then(void 0,function(){})});D({target:"Promise",stat:!0,forced:mh},{all:function(_){var w=this,M=Vo.f(w),O=M.resolve,B=M.reject,J=Aa(function(){var ce=st(w.resolve),se=[],De=0,je=1;es(_,function(Ze){var Qt=De++,xr=!1;je++,Ci(ce,w,Ze).then(function(Fr){xr||(xr=!0,se[Qt]=Fr,--je||O(se))},B)}),--je||O(se)});return J.error&&B(J.value),M.promise}});var Qf=Ku.CONSTRUCTOR,hl=Qa&&Qa.prototype;if(D({target:"Promise",proto:!0,forced:Qf,real:!0},{catch:function(_){return this.then(void 0,_)}}),ai(Qa)){var Ju=ci("Promise").prototype.catch;hl.catch!==Ju&&Oa(hl,"catch",Ju,{unsafe:!0})}D({target:"Promise",stat:!0,forced:mh},{race:function(_){var w=this,M=Vo.f(w),O=M.reject,B=Aa(function(){var J=st(w.resolve);es(_,function(ce){Ci(J,w,ce).then(M.resolve,O)})});return B.error&&O(B.value),M.promise}}),D({target:"Promise",stat:!0,forced:Ku.CONSTRUCTOR},{reject:function(_){var w=Vo.f(this);return Ci(w.reject,void 0,_),w.promise}});var Qs=Ku.CONSTRUCTOR;ci("Promise");function pl(_,w){if(!_)throw new Error(w||"web worker helper assertion failed.")}D({target:"Promise",stat:!0,forced:Qs},{resolve:function(_){return function(w,M){if(oa(w),Rr(M)&&M.constructor===w)return M;var O=Vo.f(w);return(0,O.resolve)(M),O.promise}(this,_)}});var zl=typeof window!="undefined"&&window.orientation!==void 0,gh=function(){function _(w,M){var O=this;this.name=w,this.workerThread=M,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(B,J){O.resolve=B,O.reject=J})}return _.prototype.postMessage=function(w,M){this.workerThread.postMessage({source:"Main thread",type:w,payload:M})},_.prototype.done=function(w){pl(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(w)},_.prototype.error=function(w){pl(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(w)},_}(),Yo=new Map;function yh(_){pl(_.source&&!_.url||!_.source&&_.url);var w=Yo.get(_.source||_.url);return w||(_.url&&(w=function(M){if(!M.startsWith("http"))return M;return Wh((O=M,`try {
  importScripts('`+O+`');
} catch (error) {
  console.error(error);
  throw error;
}`));var O}(_.url),Yo.set(_.url,w)),_.source&&(w=Wh(_.source),Yo.set(_.source,w))),pl(w),w}function Wh(_){var w=new Blob([_],{type:"application/javascript"});return URL.createObjectURL(w)}function If(_,w,M){w===void 0&&(w=!0);var O=M||new Set;if(_){if(Kc(_))O.add(_);else if(Kc(_.buffer))O.add(_.buffer);else if(!ArrayBuffer.isView(_)){if(w&&typeof _=="object")for(var B in _)If(_[B],w,O)}}return M===void 0?Array.from(O):[]}function Kc(_){return!!_&&(_ instanceof ArrayBuffer||typeof MessagePort!="undefined"&&_ instanceof MessagePort||typeof ImageBitmap!="undefined"&&_ instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&_ instanceof OffscreenCanvas)}var Xh=function(){},dl=function(){function _(w){this.terminated=!1,this.loadableURL="";var M=w.name,O=w.source,B=w.url;pl(O||B),this.name=M,this.source=O,this.url=B,this.onMessage=Xh,this.onError=function(J){return console.log(J)},this.worker=this.createBrowserWorker()}return _.isSupported=function(){return typeof Worker!="undefined"},_.prototype.destroy=function(){this.onMessage=Xh,this.onError=Xh,this.worker.terminate(),this.terminated=!0},Object.defineProperty(_.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),_.prototype.postMessage=function(w,M){M=M||If(w),this.worker.postMessage(w,M)},_.prototype.getErrorFromErrorEvent=function(w){var M="Failed to load ";return M+="worker "+this.name+" from "+this.url+". ",w.message&&(M+=w.message+" in "),w.lineno&&(M+=":"+w.lineno+":"+w.colno),new Error(M)},_.prototype.createBrowserWorker=function(){var w=this;this.loadableURL=yh({source:this.source,url:this.url});var M=new Worker(this.loadableURL,{name:this.name});return M.onmessage=function(O){O.data?w.onMessage(O.data):w.onError(new Error("No data received"))},M.onerror=function(O){w.onError(w.getErrorFromErrorEvent(O)),w.terminated=!0},M.onmessageerror=function(O){return console.error("worker "+w.name+", message error: "+O)},M},_}(),Cl=self&&self.__assign||function(){return(Cl=Object.assign||function(_){for(var w,M=1,O=arguments.length;M<O;M++)for(var B in w=arguments[M])Object.prototype.hasOwnProperty.call(w,B)&&(_[B]=w[B]);return _}).apply(this,arguments)},Qc=self&&self.__awaiter||function(_,w,M,O){return new(M||(M=Promise))(function(B,J){function ce(je){try{De(O.next(je))}catch(Ze){J(Ze)}}function se(je){try{De(O.throw(je))}catch(Ze){J(Ze)}}function De(je){var Ze;je.done?B(je.value):(Ze=je.value,Ze instanceof M?Ze:new M(function(Qt){Qt(Ze)})).then(ce,se)}De((O=O.apply(_,w||[])).next())})},ec=self&&self.__generator||function(_,w){var M,O,B,J,ce={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return J={next:se(0),throw:se(1),return:se(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function se(De){return function(je){return function(Ze){if(M)throw new TypeError("Generator is already executing.");for(;ce;)try{if(M=1,O&&(B=2&Ze[0]?O.return:Ze[0]?O.throw||((B=O.return)&&B.call(O),0):O.next)&&!(B=B.call(O,Ze[1])).done)return B;switch(O=0,B&&(Ze=[2&Ze[0],B.value]),Ze[0]){case 0:case 1:B=Ze;break;case 4:return ce.label++,{value:Ze[1],done:!1};case 5:ce.label++,O=Ze[1],Ze=[0];continue;case 7:Ze=ce.ops.pop(),ce.trys.pop();continue;default:if(B=ce.trys,!((B=B.length>0&&B[B.length-1])||Ze[0]!==6&&Ze[0]!==2)){ce=0;continue}if(Ze[0]===3&&(!B||Ze[1]>B[0]&&Ze[1]<B[3])){ce.label=Ze[1];break}if(Ze[0]===6&&ce.label<B[1]){ce.label=B[1],B=Ze;break}if(B&&ce.label<B[2]){ce.label=B[2],ce.ops.push(Ze);break}B[2]&&ce.ops.pop(),ce.trys.pop();continue}Ze=w.call(_,ce)}catch(Qt){Ze=[6,Qt],O=0}finally{M=B=0}if(5&Ze[0])throw Ze[1];return{value:Ze[0]?Ze[1]:void 0,done:!0}}([De,je])}}},el=function(){function _(w){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=w.source,this.url=w.url,this.setProps(w)}return _.prototype.destroy=function(){this.idleQueue.forEach(function(w){return w.destroy()}),this.isDestroyed=!0},_.prototype.setProps=function(w){this.props=Cl(Cl({},this.props),w),w.name!==void 0&&(this.name=w.name),w.maxConcurrency!==void 0&&(this.maxConcurrency=w.maxConcurrency),w.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=w.maxMobileConcurrency),w.reuseWorkers!==void 0&&(this.reuseWorkers=w.reuseWorkers),w.onDebug!==void 0&&(this.onDebug=w.onDebug)},_.prototype.startJob=function(w,M,O){return M===void 0&&(M=function(B,J,ce){return B.done(ce)}),O===void 0&&(O=function(B,J){return B.error(J)}),Qc(this,void 0,void 0,function(){var B,J=this;return ec(this,function(ce){switch(ce.label){case 0:return B=new Promise(function(se){return J.jobQueue.push({name:w,onMessage:M,onError:O,onStart:se}),J}),this.startQueuedJob(),[4,B];case 1:return[2,ce.sent()]}})})},_.prototype.startQueuedJob=function(){return Qc(this,void 0,void 0,function(){var w,M,O;return ec(this,function(B){switch(B.label){case 0:if(!this.jobQueue.length)return[2];if(!(w=this.getAvailableWorker()))return[2];if(!(M=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:M.name,backlog:this.jobQueue.length,workerThread:w}),O=new gh(M.name,w),w.onMessage=function(J){return M.onMessage(O,J.type,J.payload)},w.onError=function(J){return M.onError(O,J)},M.onStart(O),B.label=1;case 1:return B.trys.push([1,,3,4]),[4,O.result];case 2:return B.sent(),[3,4];case 3:return this.returnWorkerToQueue(w),[7];case 4:return[2]}})})},_.prototype.returnWorkerToQueue=function(w){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(w.destroy(),this.count--):this.idleQueue.push(w),this.isDestroyed||this.startQueuedJob()},_.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var w=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new dl({name:w,source:this.source,url:this.url})}return null},_.prototype.getMaxConcurrency=function(){return zl?this.maxMobileConcurrency:this.maxConcurrency},_}(),kf=self&&self.__assign||function(){return(kf=Object.assign||function(_){for(var w,M=1,O=arguments.length;M<O;M++)for(var B in w=arguments[M])Object.prototype.hasOwnProperty.call(w,B)&&(_[B]=w[B]);return _}).apply(this,arguments)},Pf=self&&self.__values||function(_){var w=typeof Symbol=="function"&&Symbol.iterator,M=w&&_[w],O=0;if(M)return M.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&O>=_.length&&(_=void 0),{value:_&&_[O++],done:!_}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},Gp={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Jc=(function(){function _(w){this.workerPools=new Map,this.props=kf({},Gp),this.setProps(w),this.workerPools=new Map}_.isSupported=function(){return dl.isSupported()},_.getWorkerFarm=function(w){return w===void 0&&(w={}),_.workerFarm=_.workerFarm||new _({}),_.workerFarm.setProps(w),_.workerFarm},_.prototype.destroy=function(){var w,M;try{for(var O=Pf(this.workerPools.values()),B=O.next();!B.done;B=O.next())B.value.destroy()}catch(J){w={error:J}}finally{try{B&&!B.done&&(M=O.return)&&M.call(O)}finally{if(w)throw w.error}}},_.prototype.setProps=function(w){var M,O;this.props=kf(kf({},this.props),w);try{for(var B=Pf(this.workerPools.values()),J=B.next();!J.done;J=B.next())J.value.setProps(this.getWorkerPoolProps())}catch(ce){M={error:ce}}finally{try{J&&!J.done&&(O=B.return)&&O.call(B)}finally{if(M)throw M.error}}},_.prototype.getWorkerPool=function(w){var M=w.name,O=w.source,B=w.url,J=this.workerPools.get(M);return J||((J=new el({name:M,source:O,url:B})).setProps(this.getWorkerPoolProps()),this.workerPools.set(M,J)),J},_.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),c=function(){function _(){}return Object.defineProperty(_,"onmessage",{set:function(w){self.onmessage=function(M){if(h(M)){var O=M.data,B=O.type,J=O.payload;w(B,J)}}},enumerable:!1,configurable:!0}),_.addEventListener=function(w){var M=Jc.get(w);M||(M=function(O){if(h(O)){var B=O.data,J=B.type,ce=B.payload;w(J,ce)}}),self.addEventListener("message",M)},_.removeEventListener=function(w){var M=Jc.get(w);Jc.delete(w),self.removeEventListener("message",M)},_.postMessage=function(w,M){if(self){var O={source:"Worker thread",type:w,payload:M},B=If(M);self.postMessage(O,B)}},_}();function h(_){var w=_.type,M=_.data;return w==="message"&&M&&typeof M.source=="string"&&M.source==="Main thread"}self&&self.__awaiter,self&&self.__generator;var f,m,S=function(){function _(){this._values=[],this._settlers=[],this._closed=!1}return _.prototype[Symbol.asyncIterator]=function(){return this},_.prototype.push=function(w){return this.enqueue(w)},_.prototype.enqueue=function(w){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var M=this._settlers.shift();w instanceof Error?M.reject(w):M.resolve({value:w})}else this._values.push(w)},_.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},_.prototype.next=function(){var w=this;if(this._values.length>0){var M=this._values.shift();return M instanceof Error?Promise.reject(M):Promise.resolve({done:!1,value:M})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(O,B){w._settlers.push({resolve:O,reject:B})})},_}(),I=self&&self.__awaiter||function(_,w,M,O){return new(M||(M=Promise))(function(B,J){function ce(je){try{De(O.next(je))}catch(Ze){J(Ze)}}function se(je){try{De(O.throw(je))}catch(Ze){J(Ze)}}function De(je){var Ze;je.done?B(je.value):(Ze=je.value,Ze instanceof M?Ze:new M(function(Qt){Qt(Ze)})).then(ce,se)}De((O=O.apply(_,w||[])).next())})},R=self&&self.__generator||function(_,w){var M,O,B,J,ce={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]};return J={next:se(0),throw:se(1),return:se(2)},typeof Symbol=="function"&&(J[Symbol.iterator]=function(){return this}),J;function se(De){return function(je){return function(Ze){if(M)throw new TypeError("Generator is already executing.");for(;ce;)try{if(M=1,O&&(B=2&Ze[0]?O.return:Ze[0]?O.throw||((B=O.return)&&B.call(O),0):O.next)&&!(B=B.call(O,Ze[1])).done)return B;switch(O=0,B&&(Ze=[2&Ze[0],B.value]),Ze[0]){case 0:case 1:B=Ze;break;case 4:return ce.label++,{value:Ze[1],done:!1};case 5:ce.label++,O=Ze[1],Ze=[0];continue;case 7:Ze=ce.ops.pop(),ce.trys.pop();continue;default:if(B=ce.trys,!((B=B.length>0&&B[B.length-1])||Ze[0]!==6&&Ze[0]!==2)){ce=0;continue}if(Ze[0]===3&&(!B||Ze[1]>B[0]&&Ze[1]<B[3])){ce.label=Ze[1];break}if(Ze[0]===6&&ce.label<B[1]){ce.label=B[1],B=Ze;break}if(B&&ce.label<B[2]){ce.label=B[2],ce.ops.push(Ze);break}B[2]&&ce.ops.pop(),ce.trys.pop();continue}Ze=w.call(_,ce)}catch(Qt){Ze=[6,Qt],O=0}finally{M=B=0}if(5&Ze[0])throw Ze[1];return{value:Ze[0]?Ze[1]:void 0,done:!0}}([De,je])}}},z=self&&self.__asyncValues||function(_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var w,M=_[Symbol.asyncIterator];return M?M.call(_):(_=typeof __values=="function"?__values(_):_[Symbol.iterator](),w={},O("next"),O("throw"),O("return"),w[Symbol.asyncIterator]=function(){return this},w);function O(B){w[B]=_[B]&&function(J){return new Promise(function(ce,se){(function(De,je,Ze,Qt){Promise.resolve(Qt).then(function(xr){De({value:xr,done:Ze})},je)})(ce,se,(J=_[B](J)).done,J.value)})}}},W=0;function te(_,w){var M=this;if(typeof self!="undefined"){var O={process:be};c.onmessage=function(B,J){return I(M,void 0,void 0,function(){var ce,se,De,je,Ze,Qt,xr,Fr,Xr,Rn;return R(this,function(Cn){switch(Cn.label){case 0:switch(Cn.trys.push([0,19,,20]),B){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!_)throw new Error("Worker does not support atomic processing");return[4,_(J.input,J.options||{},O)];case 2:return ce=Cn.sent(),c.postMessage("done",{result:ce}),[3,18];case 3:if(!w)throw new Error("Worker does not support batched processing");f=new S,m=J.options||{},se=w(f,m,O),Cn.label=4;case 4:Cn.trys.push([4,9,10,15]),De=z(se),Cn.label=5;case 5:return[4,De.next()];case 6:if((je=Cn.sent()).done)return[3,8];Ze=je.value,c.postMessage("output-batch",{result:Ze}),Cn.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return Qt=Cn.sent(),Xr={error:Qt},[3,15];case 10:return Cn.trys.push([10,,13,14]),je&&!je.done&&(Rn=De.return)?[4,Rn.call(De)]:[3,12];case 11:Cn.sent(),Cn.label=12;case 12:return[3,14];case 13:if(Xr)throw Xr.error;return[7];case 14:return[7];case 15:return c.postMessage("done",{}),[3,18];case 16:return f.push(J.input),[3,18];case 17:return f.close(),[3,18];case 18:return[3,20];case 19:return xr=Cn.sent(),Fr=xr instanceof Error?xr.message:"",c.postMessage("error",{error:Fr}),[3,20];case 20:return[2]}})})}}}function be(_,w){return w===void 0&&(w={}),new Promise(function(M,O){var B=W++,J=function(se,De){if(De.id===B)switch(se){case"done":c.removeEventListener(J),M(De.result);break;case"error":c.removeEventListener(J),O(De.error)}};c.addEventListener(J);var ce={id:B,input:_,options:w};c.postMessage("process",ce)})}self&&self.__awaiter,self&&self.__generator;var Se={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ie=ni("span").classList,Je=Ie&&Ie.constructor&&Ie.constructor.prototype,Qe=Je===Object.prototype?void 0:Je,nt=Array.isArray||function(_){return _a(_)=="Array"},He=Ke("species"),ft=Array,Et=function(_,w){return new(function(M){var O;return nt(M)&&(O=M.constructor,(Wo(O)&&(O===ft||nt(O.prototype))||Rr(O)&&(O=O[He])===null)&&(O=void 0)),O===void 0?ft:O}(_))(w===0?0:w)},Ht=wt([].push),vr=function(_){var w=_==1,M=_==2,O=_==3,B=_==4,J=_==6,ce=_==7,se=_==5||J;return function(De,je,Ze,Qt){for(var xr,Fr,Xr=Pi(De),Rn=sl(Xr),Cn=$s(je,Ze),Fn=Ro(Rn),vn=0,ri=Qt||Et,xi=w?ri(De,Fn):M||ce?ri(De,0):void 0;Fn>vn;vn++)if((se||vn in Rn)&&(Fr=Cn(xr=Rn[vn],vn,Xr),_))if(w)xi[vn]=Fr;else if(Fr)switch(_){case 3:return!0;case 5:return xr;case 6:return vn;case 2:Ht(xi,xr)}else switch(_){case 4:return!1;case 7:Ht(xi,xr)}return J?-1:O||B?B:xi}},rr={forEach:vr(0),map:vr(1),filter:vr(2),some:vr(3),every:vr(4),find:vr(5),findIndex:vr(6),filterReject:vr(7)},Ar=function(_,w){var M=[][_];return!!M&&Z(function(){M.call(null,w||function(){return 1},1)})},Hr=rr.forEach,xn=Ar("forEach")?[].forEach:function(_){return Hr(this,_,arguments.length>1?arguments[1]:void 0)},yn=function(_){if(_&&_.forEach!==xn)try{Qi(_,"forEach",xn)}catch(w){_.forEach=xn}};for(var Zn in Se)Se[Zn]&&yn(Ue[Zn]&&Ue[Zn].prototype);yn(Qe);var _i=function(_,w,M){var O=or(w);O in _?Sn.f(_,O,At(0,M)):_[O]=M},wi=Ke("species"),Ei=function(_){return ge>=51||!Z(function(){var w=[];return(w.constructor={})[wi]=function(){return{foo:1}},w[_](Boolean).foo!==1})},wa=Ei("slice"),Wn=Ke("species"),Gi=Array,Ji=Math.max;D({target:"Array",proto:!0,forced:!wa},{slice:function(_,w){var M,O,B,J=ns(this),ce=Ro(J),se=Fa(_,ce),De=Fa(w===void 0?ce:w,ce);if(nt(J)&&(M=J.constructor,(Wo(M)&&(M===Gi||nt(M.prototype))||Rr(M)&&(M=M[Wn])===null)&&(M=void 0),M===Gi||M===void 0))return xl(J,se,De);for(O=new(M===void 0?Gi:M)(Ji(De-se,0)),B=0;se<De;se++,B++)se in J&&_i(O,B,J[se]);return O.length=B,O}});var Yi=Tn.EXISTS,Ri=Sn.f,ea=Function.prototype,Di=wt(ea.toString),ki=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,xs=wt(ki.exec);_r&&!Yi&&Ri(ea,"name",{configurable:!0,get:function(){try{return xs(ki,Di(this))[1]}catch(_){return""}}});var qo=rr.map,is=Ei("map");D({target:"Array",proto:!0,forced:!is},{map:function(_){return qo(this,_,arguments.length>1?arguments[1]:void 0)}});var as,_o=Object.keys||function(_){return Yu(_,Eu)},os={f:_r&&!Oi?Object.defineProperties:function(_,w){oa(_);for(var M,O=ns(w),B=_o(w),J=B.length,ce=0;J>ce;)Sn.f(_,M=B[ce++],O[M]);return _}},Mu=Ba("IE_PROTO"),ks=function(){},Ul=function(_){return"<script>"+_+"</script>"},$o=function(_){_.write(Ul("")),_.close();var w=_.parentWindow.Object;return _=null,w},Iu=function(){try{as=new ActiveXObject("htmlfile")}catch(O){}var _,w;Iu=typeof document!="undefined"?document.domain&&as?$o(as):((w=ni("iframe")).style.display="none",Vh.appendChild(w),w.src=String("javascript:"),(_=w.contentWindow.document).open(),_.write(Ul("document.F=Object")),_.close(),_.F):$o(as);for(var M=Eu.length;M--;)delete Iu.prototype[Eu[M]];return Iu()};zi[Mu]=!0;var ku=Object.create||function(_,w){var M;return _!==null?(ks.prototype=oa(_),M=new ks,ks.prototype=null,M[Mu]=_):M=Iu(),w===void 0?M:os.f(M,w)},Jf=Sn.f,ef=Ke("unscopables"),Zl=Array.prototype;Zl[ef]==null&&Jf(Zl,ef,{configurable:!0,value:ku(null)});var tl,tf,Sl,Ec=function(_){Zl[ef][_]=!0},Vl=!Z(function(){function _(){}return _.prototype.constructor=null,Object.getPrototypeOf(new _)!==_.prototype}),vs=Ba("IE_PROTO"),Al=Object,Cc=Al.prototype,gu=Vl?Al.getPrototypeOf:function(_){var w=Pi(_);if(ln(w,vs))return w[vs];var M=w.constructor;return ai(M)&&w instanceof M?M.prototype:w instanceof Al?Cc:null},Ga=Ke("iterator"),Nu=!1;[].keys&&("next"in(Sl=[].keys())?(tf=gu(gu(Sl)))!==Object.prototype&&(tl=tf):Nu=!0),(tl==null||Z(function(){var _={};return tl[Ga].call(_)!==_}))&&(tl={}),ai(tl[Ga])||Oa(tl,Ga,function(){return this});var bs={IteratorPrototype:tl,BUGGY_SAFARI_ITERATORS:Nu},tc=bs.IteratorPrototype,_h=function(){return this},xh=Tn.PROPER,bh=Tn.CONFIGURABLE,zu=bs.IteratorPrototype,jl=bs.BUGGY_SAFARI_ITERATORS,Uu=Ke("iterator"),rf=function(){return this},Rf=function(_,w,M,O,B,J,ce){(function(Fn,vn,ri,xi){var Eo=vn+" Iterator";Fn.prototype=ku(tc,{next:At(+!xi,ri)}),Gr(Fn,Eo,!1),vu[Eo]=_h})(M,w,O);var se,De,je,Ze=function(Fn){if(Fn===B&&Rn)return Rn;if(!jl&&Fn in Fr)return Fr[Fn];switch(Fn){case"keys":case"values":case"entries":return function(){return new M(this,Fn)}}return function(){return new M(this)}},Qt=w+" Iterator",xr=!1,Fr=_.prototype,Xr=Fr[Uu]||Fr["@@iterator"]||B&&Fr[B],Rn=!jl&&Xr||Ze(B),Cn=w=="Array"&&Fr.entries||Xr;if(Cn&&(se=gu(Cn.call(new _)))!==Object.prototype&&se.next&&(gu(se)!==zu&&(Mt?Mt(se,zu):ai(se[Uu])||Oa(se,Uu,rf)),Gr(se,Qt,!0)),xh&&B=="values"&&Xr&&Xr.name!=="values"&&(bh?Qi(Fr,"name","values"):(xr=!0,Rn=function(){return Ci(Xr,this)})),B)if(De={values:Ze("values"),keys:J?Rn:Ze("keys"),entries:Ze("entries")},ce)for(je in De)(jl||xr||!(je in Fr))&&Oa(Fr,je,De[je]);else D({target:w,proto:!0,forced:jl||xr},De);return Fr[Uu]!==Rn&&Oa(Fr,Uu,Rn,{name:B}),vu[w]=Rn,De},Gl=Sn.f,Js=Xi.set,Yh=Xi.getterFor("Array Iterator"),rc=Rf(Array,"Array",function(_,w){Js(this,{type:"Array Iterator",target:ns(_),index:0,kind:w})},function(){var _=Yh(this),w=_.target,M=_.kind,O=_.index++;return!w||O>=w.length?(_.target=void 0,{value:void 0,done:!0}):M=="keys"?{value:O,done:!1}:M=="values"?{value:w[O],done:!1}:{value:[O,w[O]],done:!1}},"values"),yp=vu.Arguments=vu.Array;if(Ec("keys"),Ec("values"),Ec("entries"),_r&&yp.name!=="values")try{Gl(yp,"name",{value:"values"})}catch(_){}var su,nf,eh,Sc=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined",qh=Sn.f,rl=Xi.enforce,xe=Xi.get,$r=Ue.Int8Array,Ac=$r&&$r.prototype,Qd=Ue.Uint8ClampedArray,eu=Qd&&Qd.prototype,js=$r&&gu($r),Pu=Ac&&gu(Ac),Td=Object.prototype,af=Ue.TypeError,th=Ke("toStringTag"),Eh=Ma("TYPED_ARRAY_TAG"),rh=Sc&&!!Mt&&So(Ue.opera)!=="Opera",Ch=!1,wc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ko={BigInt64Array:8,BigUint64Array:8},$h=function(_){var w=gu(_);if(Rr(w)){var M=xe(w);return M&&ln(M,"TypedArrayConstructor")?M.TypedArrayConstructor:$h(w)}},Md=function(_){if(!Rr(_))return!1;var w=So(_);return ln(wc,w)||ln(Ko,w)};for(su in wc)(eh=(nf=Ue[su])&&nf.prototype)?rl(eh).TypedArrayConstructor=nf:rh=!1;for(su in Ko)(eh=(nf=Ue[su])&&nf.prototype)&&(rl(eh).TypedArrayConstructor=nf);if((!rh||!ai(js)||js===Function.prototype)&&(js=function(){throw af("Incorrect invocation")},rh))for(su in wc)Ue[su]&&Mt(Ue[su],js);if((!rh||!Pu||Pu===Td)&&(Pu=js.prototype,rh))for(su in wc)Ue[su]&&Mt(Ue[su].prototype,Pu);if(rh&&gu(eu)!==Pu&&Mt(eu,Pu),_r&&!ln(Pu,th))for(su in Ch=!0,qh(Pu,th,{get:function(){return Rr(this)?this[Eh]:void 0}}),wc)Ue[su]&&Qi(Ue[su],Eh,su);var $i={NATIVE_ARRAY_BUFFER_VIEWS:rh,TYPED_ARRAY_TAG:Ch&&Eh,aTypedArray:function(_){if(Md(_))return _;throw af("Target is not a typed array")},aTypedArrayConstructor:function(_){if(ai(_)&&(!Mt||la(js,_)))return _;throw af(ke(_)+" is not a typed array constructor")},exportTypedArrayMethod:function(_,w,M,O){if(_r){if(M)for(var B in wc){var J=Ue[B];if(J&&ln(J.prototype,_))try{delete J.prototype[_]}catch(ce){try{J.prototype[_]=w}catch(se){}}}Pu[_]&&!M||Oa(Pu,_,M?w:rh&&Ac[_]||w,O)}},exportTypedArrayStaticMethod:function(_,w,M){var O,B;if(_r){if(Mt){if(M){for(O in wc)if((B=Ue[O])&&ln(B,_))try{delete B[_]}catch(J){}}if(js[_]&&!M)return;try{return Oa(js,_,M?w:rh&&js[_]||w)}catch(J){}}for(O in wc)!(B=Ue[O])||B[_]&&!M||Oa(B,_,w)}},getTypedArrayConstructor:$h,isView:function(_){if(!Rr(_))return!1;var w=So(_);return w==="DataView"||ln(wc,w)||ln(Ko,w)},isTypedArray:Md,TypedArray:js,TypedArrayPrototype:Pu},Hp=$i.NATIVE_ARRAY_BUFFER_VIEWS,Kh=Ue.ArrayBuffer,Tc=Ue.Int8Array,_p=!Hp||!Z(function(){Tc(1)})||!Z(function(){new Tc(-1)})||!yo(function(_){new Tc,new Tc(null),new Tc(1.5),new Tc(_)},!0)||Z(function(){return new Tc(new Kh(2),1,void 0).length!==1}),nl=function(_,w,M){for(var O in w)Oa(_,O,w[O],M);return _},Sh=RangeError,of=function(_){if(_===void 0)return 0;var w=ei(_),M=Ho(w);if(w!==M)throw Sh("Wrong length or index");return M},Wp=Array,nc=Math.abs,ic=Math.pow,xp=Math.floor,Xp=Math.log,Qh=Math.LN2,Jh=function(_,w,M){var O,B,J,ce=Wp(M),se=8*M-w-1,De=(1<<se)-1,je=De>>1,Ze=w===23?ic(2,-24)-ic(2,-77):0,Qt=_<0||_===0&&1/_<0?1:0,xr=0;for((_=nc(_))!=_||_===1/0?(B=_!=_?1:0,O=De):(O=xp(Xp(_)/Qh),_*(J=ic(2,-O))<1&&(O--,J*=2),(_+=O+je>=1?Ze/J:Ze*ic(2,1-je))*J>=2&&(O++,J/=2),O+je>=De?(B=0,O=De):O+je>=1?(B=(_*J-1)*ic(2,w),O+=je):(B=_*ic(2,je-1)*ic(2,w),O=0));w>=8;)ce[xr++]=255&B,B/=256,w-=8;for(O=O<<w|B,se+=w;se>0;)ce[xr++]=255&O,O/=256,se-=8;return ce[--xr]|=128*Qt,ce},Zu=function(_,w){var M,O=_.length,B=8*O-w-1,J=(1<<B)-1,ce=J>>1,se=B-7,De=O-1,je=_[De--],Ze=127&je;for(je>>=7;se>0;)Ze=256*Ze+_[De--],se-=8;for(M=Ze&(1<<-se)-1,Ze>>=-se,se+=w;se>0;)M=256*M+_[De--],se-=8;if(Ze===0)Ze=1-ce;else{if(Ze===J)return M?NaN:je?-1/0:1/0;M+=ic(2,w),Ze-=ce}return(je?-1:1)*M*ic(2,Ze-w)},ac=function(_){for(var w=Pi(this),M=Ro(w),O=arguments.length,B=Fa(O>1?arguments[1]:void 0,M),J=O>2?arguments[2]:void 0,ce=J===void 0?M:Fa(J,M);ce>B;)w[B++]=_;return w},Lf=Array,Yp=Math.max,sf=function(_,w,M){for(var O=Ro(_),B=Fa(w,O),J=Fa(M===void 0?O:M,O),ce=Lf(Yp(J-B,0)),se=0;B<J;B++,se++)_i(ce,se,_[B]);return ce.length=se,ce},Of=Za.f,Gs=Sn.f,Ah=Tn.PROPER,qp=Tn.CONFIGURABLE,uf=Xi.get,ep=Xi.set,Mc=Ue.ArrayBuffer,Ic=Mc,Ru=Ic&&Ic.prototype,kc=Ue.DataView,oc=kc&&kc.prototype,Pc=Object.prototype,lf=Ue.Array,tp=Ue.RangeError,w0=wt(ac),cf=wt([].reverse),wh=Jh,nh=Zu,Rc=function(_){return[255&_]},$p=function(_){return[255&_,_>>8&255]},Kp=function(_){return[255&_,_>>8&255,_>>16&255,_>>24&255]},bp=function(_){return _[3]<<24|_[2]<<16|_[1]<<8|_[0]},Id=function(_){return wh(_,23,4)},oo=function(_){return wh(_,52,8)},Hs=function(_,w){Gs(_.prototype,w,{get:function(){return uf(this)[w]}})},To=function(_,w,M,O){var B=of(M),J=uf(_);if(B+w>J.byteLength)throw tp("Wrong index");var ce=uf(J.buffer).bytes,se=B+J.byteOffset,De=sf(ce,se,se+w);return O?De:cf(De)},Ws=function(_,w,M,O,B,J){var ce=of(M),se=uf(_);if(ce+w>se.byteLength)throw tp("Wrong index");for(var De=uf(se.buffer).bytes,je=ce+se.byteOffset,Ze=O(+B),Qt=0;Qt<w;Qt++)De[je+Qt]=Ze[J?Qt:w-Qt-1]};if(Sc){var kd=Ah&&Mc.name!=="ArrayBuffer";if(Z(function(){Mc(1)})&&Z(function(){new Mc(-1)})&&!Z(function(){return new Mc,new Mc(1.5),new Mc(NaN),kd&&!qp}))kd&&qp&&Qi(Mc,"name","ArrayBuffer");else{(Ic=function(_){return Fi(this,Ru),new Mc(of(_))}).prototype=Ru;for(var Lc,Jd=Of(Mc),Pd=0;Jd.length>Pd;)(Lc=Jd[Pd++])in Ic||Qi(Ic,Lc,Mc[Lc]);Ru.constructor=Ic}Mt&&gu(oc)!==Pc&&Mt(oc,Pc);var Qp=new kc(new Ic(2)),Jp=wt(oc.setInt8);Qp.setInt8(0,2147483648),Qp.setInt8(1,2147483649),!Qp.getInt8(0)&&Qp.getInt8(1)||nl(oc,{setInt8:function(_,w){Jp(this,_,w<<24>>24)},setUint8:function(_,w){Jp(this,_,w<<24>>24)}},{unsafe:!0})}else Ru=(Ic=function(_){Fi(this,Ru);var w=of(_);ep(this,{bytes:w0(lf(w),0),byteLength:w}),_r||(this.byteLength=w)}).prototype,oc=(kc=function(_,w,M){Fi(this,oc),Fi(_,Ru);var O=uf(_).byteLength,B=ei(w);if(B<0||B>O)throw tp("Wrong offset");if(B+(M=M===void 0?O-B:Ho(M))>O)throw tp("Wrong length");ep(this,{buffer:_,byteLength:M,byteOffset:B}),_r||(this.buffer=_,this.byteLength=M,this.byteOffset=B)}).prototype,_r&&(Hs(Ic,"byteLength"),Hs(kc,"buffer"),Hs(kc,"byteLength"),Hs(kc,"byteOffset")),nl(oc,{getInt8:function(_){return To(this,1,_)[0]<<24>>24},getUint8:function(_){return To(this,1,_)[0]},getInt16:function(_){var w=To(this,2,_,arguments.length>1?arguments[1]:void 0);return(w[1]<<8|w[0])<<16>>16},getUint16:function(_){var w=To(this,2,_,arguments.length>1?arguments[1]:void 0);return w[1]<<8|w[0]},getInt32:function(_){return bp(To(this,4,_,arguments.length>1?arguments[1]:void 0))},getUint32:function(_){return bp(To(this,4,_,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(_){return nh(To(this,4,_,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(_){return nh(To(this,8,_,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(_,w){Ws(this,1,_,Rc,w)},setUint8:function(_,w){Ws(this,1,_,Rc,w)},setInt16:function(_,w){Ws(this,2,_,$p,w,arguments.length>2?arguments[2]:void 0)},setUint16:function(_,w){Ws(this,2,_,$p,w,arguments.length>2?arguments[2]:void 0)},setInt32:function(_,w){Ws(this,4,_,Kp,w,arguments.length>2?arguments[2]:void 0)},setUint32:function(_,w){Ws(this,4,_,Kp,w,arguments.length>2?arguments[2]:void 0)},setFloat32:function(_,w){Ws(this,4,_,Id,w,arguments.length>2?arguments[2]:void 0)},setFloat64:function(_,w){Ws(this,8,_,oo,w,arguments.length>2?arguments[2]:void 0)}});Gr(Ic,"ArrayBuffer"),Gr(kc,"DataView");var e0={ArrayBuffer:Ic,DataView:kc},t0=Math.floor,ed=Number.isInteger||function(_){return!Rr(_)&&isFinite(_)&&t0(_)===_},Ep=RangeError,r0=RangeError,Ff=function(_,w){var M=function(O){var B=ei(O);if(B<0)throw Ep("The argument can't be less than 0");return B}(_);if(M%w)throw r0("Wrong offset");return M},xo=$i.aTypedArrayConstructor,Rd=function(_){var w,M,O,B,J,ce,se=Uh(this),De=Pi(_),je=arguments.length,Ze=je>1?arguments[1]:void 0,Qt=Ze!==void 0,xr=mu(De);if(xr&&!bc(xr))for(ce=(J=bi(De,xr)).next,De=[];!(B=Ci(ce,J)).done;)De.push(B.value);for(Qt&&je>2&&(Ze=$s(Ze,arguments[2])),M=Ro(De),O=new(xo(se))(M),w=0;M>w;w++)O[w]=Qt?Ze(De[w],w):De[w];return O},Oc=function(_,w,M){var O,B;return Mt&&ai(O=w.constructor)&&O!==M&&Rr(B=O.prototype)&&B!==M.prototype&&Mt(_,B),_},ih=yr(function(_){var w=Za.f,M=rr.forEach,O=Xi.get,B=Xi.set,J=Xi.enforce,ce=Sn.f,se=Be.f,De=Math.round,je=Ue.RangeError,Ze=e0.ArrayBuffer,Qt=Ze.prototype,xr=e0.DataView,Fr=$i.NATIVE_ARRAY_BUFFER_VIEWS,Xr=$i.TYPED_ARRAY_TAG,Rn=$i.TypedArray,Cn=$i.TypedArrayPrototype,Fn=$i.aTypedArrayConstructor,vn=$i.isTypedArray,ri=function(co,Kr){Fn(co);for(var cn=0,Bi=Kr.length,qa=new co(Bi);Bi>cn;)qa[cn]=Kr[cn++];return qa},xi=function(co,Kr){ce(co,Kr,{get:function(){return O(this)[Kr]}})},Eo=function(co){var Kr;return la(Qt,co)||(Kr=So(co))=="ArrayBuffer"||Kr=="SharedArrayBuffer"},uo=function(co,Kr){return vn(co)&&!ae(Kr)&&Kr in co&&ed(+Kr)&&Kr>=0},ro=function(co,Kr){return Kr=or(Kr),uo(co,Kr)?At(2,co[Kr]):se(co,Kr)},lo=function(co,Kr,cn){return Kr=or(Kr),!(uo(co,Kr)&&Rr(cn)&&ln(cn,"value"))||ln(cn,"get")||ln(cn,"set")||cn.configurable||ln(cn,"writable")&&!cn.writable||ln(cn,"enumerable")&&!cn.enumerable?ce(co,Kr,cn):(co[Kr]=cn.value,co)};_r?(Fr||(Be.f=ro,Sn.f=lo,xi(Cn,"buffer"),xi(Cn,"byteOffset"),xi(Cn,"byteLength"),xi(Cn,"length")),D({target:"Object",stat:!0,forced:!Fr},{getOwnPropertyDescriptor:ro,defineProperty:lo}),_.exports=function(co,Kr,cn){var Bi=co.match(/\d+$/)[0]/8,qa=co+(cn?"Clamped":"")+"Array",xa="get"+co,ml="set"+co,Il=Ue[qa],_s=Il,kl=_s&&_s.prototype,ws={},Lh=function(_u,Po){ce(_u,Po,{get:function(){return function(Pl,Ou){var ol=O(Pl);return ol.view[xa](Ou*Bi+ol.byteOffset,!0)}(this,Po)},set:function(Pl){return function(Ou,ol,Uf){var Up=O(Ou);cn&&(Uf=(Uf=De(Uf))<0?0:Uf>255?255:255&Uf),Up.view[ml](ol*Bi+Up.byteOffset,Uf,!0)}(this,Po,Pl)},enumerable:!0})};Fr?_p&&(_s=Kr(function(_u,Po,Pl,Ou){return Fi(_u,kl),Oc(Rr(Po)?Eo(Po)?Ou!==void 0?new Il(Po,Ff(Pl,Bi),Ou):Pl!==void 0?new Il(Po,Ff(Pl,Bi)):new Il(Po):vn(Po)?ri(_s,Po):Ci(Rd,_s,Po):new Il(of(Po)),_u,_s)}),Mt&&Mt(_s,Rn),M(w(Il),function(_u){_u in _s||Qi(_s,_u,Il[_u])}),_s.prototype=kl):(_s=Kr(function(_u,Po,Pl,Ou){Fi(_u,kl);var ol,Uf,Up,sg=0,Mv=0;if(Rr(Po)){if(!Eo(Po))return vn(Po)?ri(_s,Po):Ci(Rd,_s,Po);ol=Po,Mv=Ff(Pl,Bi);var mm=Po.byteLength;if(Ou===void 0){if(mm%Bi||(Uf=mm-Mv)<0)throw je("Wrong length")}else if((Uf=Ho(Ou)*Bi)+Mv>mm)throw je("Wrong length");Up=Uf/Bi}else Up=of(Po),ol=new Ze(Uf=Up*Bi);for(B(_u,{buffer:ol,byteOffset:Mv,byteLength:Uf,length:Up,view:new xr(ol)});sg<Up;)Lh(_u,sg++)}),Mt&&Mt(_s,Rn),kl=_s.prototype=ku(Cn)),kl.constructor!==_s&&Qi(kl,"constructor",_s),J(kl).TypedArrayConstructor=_s,Xr&&Qi(kl,Xr,qa);var zp=_s!=Il;ws[qa]=_s,D({global:!0,constructor:!0,forced:zp,sham:!Fr},ws),"BYTES_PER_ELEMENT"in _s||Qi(_s,"BYTES_PER_ELEMENT",Bi),"BYTES_PER_ELEMENT"in kl||Qi(kl,"BYTES_PER_ELEMENT",Bi),ji(qa)}):_.exports=function(){}});ih("Uint8",function(_){return function(w,M,O){return _(this,w,M,O)}},!0);var Ld=TypeError,td=function(_,w){if(!delete _[w])throw Ld("Cannot delete property "+ke(w)+" of "+ke(_))},H=Math.min,Le=wt([].copyWithin||function(_,w){var M=Pi(this),O=Ro(M),B=Fa(_,O),J=Fa(w,O),ce=arguments.length>2?arguments[2]:void 0,se=H((ce===void 0?O:Fa(ce,O))-J,O-B),De=1;for(J<B&&B<J+se&&(De=-1,J+=se-1,B+=se-1);se-- >0;)J in M?M[B]=M[J]:td(M,B),B+=De,J+=De;return M}),at=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("copyWithin",function(_,w){return Le(at(this),_,w,arguments.length>2?arguments[2]:void 0)});var fr=rr.every,Nr=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("every",function(_){return fr(Nr(this),_,arguments.length>1?arguments[1]:void 0)});var ur=TypeError,Tr=function(_){var w=Zr(_,"number");if(typeof w=="number")throw ur("Can't convert number to bigint");return BigInt(w)},Vr=$i.aTypedArray,qr=$i.exportTypedArrayMethod,rn=wt("".slice);qr("fill",function(_){var w=arguments.length;Vr(this);var M=rn(So(this),0,3)==="Big"?Tr(_):+_;return Ci(ac,this,M,w>1?arguments[1]:void 0,w>2?arguments[2]:void 0)},Z(function(){var _=0;return new Int8Array(2).fill({valueOf:function(){return _++}}),_!==1}));var pn=$i.aTypedArrayConstructor,dn=$i.getTypedArrayConstructor,An=function(_){return pn(yf(_,dn(_)))},en=function(_,w){return function(M,O){for(var B=0,J=Ro(O),ce=new M(J);J>B;)ce[B]=O[B++];return ce}(An(_),w)},fn=rr.filter,Ft=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("filter",function(_){var w=fn(Ft(this),_,arguments.length>1?arguments[1]:void 0);return en(this,w)});var mr=rr.find,nn=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("find",function(_){return mr(nn(this),_,arguments.length>1?arguments[1]:void 0)});var kn=rr.findIndex,zr=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("findIndex",function(_){return kn(zr(this),_,arguments.length>1?arguments[1]:void 0)});var _n=rr.forEach,On=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("forEach",function(_){_n(On(this),_,arguments.length>1?arguments[1]:void 0)});var Ti=hs.includes,Mr=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("includes",function(_){return Ti(Mr(this),_,arguments.length>1?arguments[1]:void 0)});var Lr=hs.indexOf,si=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("indexOf",function(_){return Lr(si(this),_,arguments.length>1?arguments[1]:void 0)});var Ln=Ke("iterator"),tn=Ue.Uint8Array,Bn=wt(rc.values),Un=wt(rc.keys),ca=wt(rc.entries),Hi=$i.aTypedArray,Jr=$i.exportTypedArrayMethod,on=tn&&tn.prototype,Ii=!Z(function(){on[Ln].call([1])}),ta=!!on&&on.values&&on[Ln]===on.values&&on.values.name==="values",da=function(){return Bn(Hi(this))};Jr("entries",function(){return ca(Hi(this))},Ii),Jr("keys",function(){return Un(Hi(this))},Ii),Jr("values",da,Ii||!ta,{name:"values"}),Jr(Ln,da,Ii||!ta,{name:"values"});var ss=$i.aTypedArray,ms=$i.exportTypedArrayMethod,Pa=wt([].join);ms("join",function(_){return Pa(ss(this),_)});var yu=Math.min,Mo=[].lastIndexOf,Io=!!Mo&&1/[1].lastIndexOf(1,-0)<0,Ps=Ar("lastIndexOf"),uu=Io||!Ps?function(_){if(Io)return _l(Mo,this,arguments)||0;var w=ns(this),M=Ro(w),O=M-1;for(arguments.length>1&&(O=yu(O,ei(arguments[1]))),O<0&&(O=M+O);O>=0;O--)if(O in w&&w[O]===_)return O||0;return-1}:Mo,tu=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("lastIndexOf",function(_){var w=arguments.length;return _l(uu,tu(this),w>1?[_,arguments[1]]:[_])});var Es=rr.map,Qo=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("map",function(_){return Es(Qo(this),_,arguments.length>1?arguments[1]:void 0,function(w,M){return new(An(w))(M)})});var ia=TypeError,Cs=function(_){return function(w,M,O,B){st(M);var J=Pi(w),ce=sl(J),se=Ro(J),De=_?se-1:0,je=_?-1:1;if(O<2)for(;;){if(De in ce){B=ce[De],De+=je;break}if(De+=je,_?De<0:se<=De)throw ia("Reduce of empty array with no initial value")}for(;_?De>=0:se>De;De+=je)De in ce&&(B=M(B,ce[De],De,J));return B}},Na={left:Cs(!1),right:Cs(!0)},Rs=Na.left,Zi=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("reduce",function(_){var w=arguments.length;return Rs(Zi(this),_,w,w>1?arguments[1]:void 0)});var Ca=Na.right,eo=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("reduceRight",function(_){var w=arguments.length;return Ca(eo(this),_,w,w>1?arguments[1]:void 0)});var us=$i.aTypedArray,Fc=$i.exportTypedArrayMethod,Ye=Math.floor;Fc("reverse",function(){for(var _,w=us(this).length,M=Ye(w/2),O=0;O<M;)_=this[O],this[O++]=this[--w],this[w]=_;return this});var pr=Ue.RangeError,Vt=Ue.Int8Array,qn=Vt&&Vt.prototype,Ta=qn&&qn.set,Ve=$i.aTypedArray,Ce=$i.exportTypedArrayMethod,ht=!Z(function(){var _=new Uint8ClampedArray(2);return Ci(Ta,_,{length:1,0:3},1),_[1]!==3}),Bt=ht&&$i.NATIVE_ARRAY_BUFFER_VIEWS&&Z(function(){var _=new Vt(2);return _.set(1),_.set("2",1),_[0]!==0||_[1]!==2});Ce("set",function(_){Ve(this);var w=Ff(arguments.length>1?arguments[1]:void 0,1),M=Pi(_);if(ht)return Ci(Ta,this,M,w);var O=this.length,B=Ro(M),J=0;if(B+w>O)throw pr("Wrong length");for(;J<B;)this[w+J]=M[J++]},!ht||Bt);var ar=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("slice",function(_,w){for(var M=xl(ar(this),_,w),O=An(this),B=0,J=M.length,ce=new O(J);J>B;)ce[B]=M[B++];return ce},Z(function(){new Int8Array(1).slice()}));var gt=rr.some,he=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("some",function(_){return gt(he(this),_,arguments.length>1?arguments[1]:void 0)});var Tt=Math.floor,Fe=function(_,w){var M=_.length,O=Tt(M/2);return M<8?ct(_,w):Ge(_,Fe(sf(_,0,O),w),Fe(sf(_,O),w),w)},ct=function(_,w){for(var M,O,B=_.length,J=1;J<B;){for(O=J,M=_[J];O&&w(_[O-1],M)>0;)_[O]=_[--O];O!==J++&&(_[O]=M)}return _},Ge=function(_,w,M,O){for(var B=w.length,J=M.length,ce=0,se=0;ce<B||se<J;)_[ce+se]=ce<B&&se<J?O(w[ce],M[se])<=0?w[ce++]:M[se++]:ce<B?w[ce++]:M[se++];return _},Nt=Fe,qt=gi.match(/firefox\/(\d+)/i),Ur=!!qt&&+qt[1],Pn=/MSIE|Trident/.test(gi),In=gi.match(/AppleWebKit\/(\d+)\./),Vn=!!In&&+In[1],En=$i.aTypedArray,fi=$i.exportTypedArrayMethod,jn=Ue.Uint16Array,$n=jn&&wt(jn.prototype.sort),ii=!(!$n||Z(function(){$n(new jn(2),null)})&&Z(function(){$n(new jn(2),{})})),Kn=!!$n&&!Z(function(){if(ge)return ge<74;if(Ur)return Ur<67;if(Pn)return!0;if(Vn)return Vn<602;var _,w,M=new jn(516),O=Array(516);for(_=0;_<516;_++)w=_%4,M[_]=515-_,O[_]=_-2*w+3;for($n(M,function(B,J){return(B/4|0)-(J/4|0)}),_=0;_<516;_++)if(M[_]!==O[_])return!0});fi("sort",function(_){return _!==void 0&&st(_),Kn?$n(this,_):Nt(En(this),function(w){return function(M,O){return w!==void 0?+w(M,O)||0:O!=O?-1:M!=M?1:M===0&&O===0?1/M>0&&1/O<0?1:-1:M>O}}(_))},!Kn||ii);var Vi=$i.aTypedArray;(0,$i.exportTypedArrayMethod)("subarray",function(_,w){var M=Vi(this),O=M.length,B=Fa(_,O);return new(An(M))(M.buffer,M.byteOffset+B*M.BYTES_PER_ELEMENT,Ho((w===void 0?O:Fa(w,O))-B))});var Ya=Ue.Int8Array,Ls=$i.aTypedArray,Lo=$i.exportTypedArrayMethod,to=[].toLocaleString,ff=!!Ya&&Z(function(){to.call(new Ya(1))});Lo("toLocaleString",function(){return _l(to,ff?xl(Ls(this)):Ls(this),xl(arguments))},Z(function(){return[1,2].toLocaleString()!=new Ya([1,2]).toLocaleString()})||!Z(function(){Ya.prototype.toLocaleString.call([1,2])}));var Vu=$i.exportTypedArrayMethod,sc=Ue.Uint8Array,Hl=sc&&sc.prototype||{},Dc=[].toString,Wl=wt([].join);Z(function(){Dc.call({})})&&(Dc=function(){return Wl(this)});var ah=Hl.toString!=Dc;Vu("toString",Dc,ah);var rp,n0,ru=String,lu=function(_){if(So(_)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return ru(_)},oh=function(){var _=oa(this),w="";return _.hasIndices&&(w+="d"),_.global&&(w+="g"),_.ignoreCase&&(w+="i"),_.multiline&&(w+="m"),_.dotAll&&(w+="s"),_.unicode&&(w+="u"),_.unicodeSets&&(w+="v"),_.sticky&&(w+="y"),w},rd=Ue.RegExp,nd=Z(function(){var _=rd("a","y");return _.lastIndex=2,_.exec("abcd")!=null}),T0=nd||Z(function(){return!rd("a","y").sticky}),id={BROKEN_CARET:nd||Z(function(){var _=rd("^r","gy");return _.lastIndex=2,_.exec("str")!=null}),MISSED_STICKY:T0,UNSUPPORTED_Y:nd},Bc=Ue.RegExp,Hv=Z(function(){var _=Bc(".","s");return!(_.dotAll&&_.exec(`
`)&&_.flags==="s")}),Nn=Ue.RegExp,Wv=Z(function(){var _=Nn("(?<a>b)","g");return _.exec("b").groups.a!=="b"||"b".replace(_,"$<a>c")!=="bc"}),nr=Xi.get,np=rt("native-string-replace",String.prototype.replace),Od=RegExp.prototype.exec,n=Od,s=wt("".charAt),l=wt("".indexOf),d=wt("".replace),x=wt("".slice),C=(n0=/b*/g,Ci(Od,rp=/a/,"a"),Ci(Od,n0,"a"),rp.lastIndex!==0||n0.lastIndex!==0),T=id.BROKEN_CARET,L=/()??/.exec("")[1]!==void 0;(C||L||T||Hv||Wv)&&(n=function(_){var w,M,O,B,J,ce,se,De=this,je=nr(De),Ze=lu(_),Qt=je.raw;if(Qt)return Qt.lastIndex=De.lastIndex,w=Ci(n,Qt,Ze),De.lastIndex=Qt.lastIndex,w;var xr=je.groups,Fr=T&&De.sticky,Xr=Ci(oh,De),Rn=De.source,Cn=0,Fn=Ze;if(Fr&&(Xr=d(Xr,"y",""),l(Xr,"g")===-1&&(Xr+="g"),Fn=x(Ze,De.lastIndex),De.lastIndex>0&&(!De.multiline||De.multiline&&s(Ze,De.lastIndex-1)!==`
`)&&(Rn="(?: "+Rn+")",Fn=" "+Fn,Cn++),M=new RegExp("^(?:"+Rn+")",Xr)),L&&(M=new RegExp("^"+Rn+"$(?!\\s)",Xr)),C&&(O=De.lastIndex),B=Ci(Od,Fr?M:De,Fn),Fr?B?(B.input=x(B.input,Cn),B[0]=x(B[0],Cn),B.index=De.lastIndex,De.lastIndex+=B[0].length):De.lastIndex=0:C&&B&&(De.lastIndex=De.global?B.index+B[0].length:O),L&&B&&B.length>1&&Ci(np,B[0],M,function(){for(J=1;J<arguments.length-2;J++)arguments[J]===void 0&&(B[J]=void 0)}),B&&xr)for(B.groups=ce=ku(null),J=0;J<xr.length;J++)ce[(se=xr[J])[0]]=B[se[1]];return B});var U=n;D({target:"RegExp",proto:!0,forced:/./.exec!==U},{exec:U});var X,$=Ke("species"),ee=RegExp.prototype,le=function(_,w,M,O){var B=Ke(_),J=!Z(function(){var je={};return je[B]=function(){return 7},""[_](je)!=7}),ce=J&&!Z(function(){var je=!1,Ze=/a/;return _==="split"&&((Ze={}).constructor={},Ze.constructor[$]=function(){return Ze},Ze.flags="",Ze[B]=/./[B]),Ze.exec=function(){return je=!0,null},Ze[B](""),!je});if(!J||!ce||M){var se=wt(/./[B]),De=w(B,""[_],function(je,Ze,Qt,xr,Fr){var Xr=wt(je),Rn=Ze.exec;return Rn===U||Rn===ee.exec?J&&!Fr?{done:!0,value:se(Ze,Qt,xr)}:{done:!0,value:Xr(Qt,Ze,xr)}:{done:!1}});Oa(String.prototype,_,De[0]),Oa(ee,B,De[1])}O&&Qi(ee[B],"sham",!0)},Ee=wt("".charAt),$e=wt("".charCodeAt),et=wt("".slice),mt=function(_){return function(w,M){var O,B,J=lu(Xn(w)),ce=ei(M),se=J.length;return ce<0||ce>=se?_?"":void 0:(O=$e(J,ce))<55296||O>56319||ce+1===se||(B=$e(J,ce+1))<56320||B>57343?_?Ee(J,ce):O:_?et(J,ce,ce+2):B-56320+(O-55296<<10)+65536}},ut={codeAt:mt(!1),charAt:mt(!0)},Ot=ut.charAt,$t=function(_,w,M){return w+(M?Ot(_,w).length:1)},dr=Math.floor,gr=wt("".charAt),Dr=wt("".replace),hn=wt("".slice),zn=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Ai=/\$([$&'`]|\d{1,2})/g,Qn=function(_,w,M,O,B,J){var ce=M+_.length,se=O.length,De=Ai;return B!==void 0&&(B=Pi(B),De=zn),Dr(J,De,function(je,Ze){var Qt;switch(gr(Ze,0)){case"$":return"$";case"&":return _;case"`":return hn(w,0,M);case"'":return hn(w,ce);case"<":Qt=B[hn(Ze,1,-1)];break;default:var xr=+Ze;if(xr===0)return je;if(xr>se){var Fr=dr(xr/10);return Fr===0?je:Fr<=se?O[Fr-1]===void 0?gr(Ze,1):O[Fr-1]+gr(Ze,1):je}Qt=O[xr-1]}return Qt===void 0?"":Qt})},Mi=TypeError,Jn=function(_,w){var M=_.exec;if(ai(M)){var O=Ci(M,_,w);return O!==null&&oa(O),O}if(_a(_)==="RegExp")return Ci(U,_,w);throw Mi("RegExp#exec called on incompatible receiver")},va=Ke("replace"),Wi=Math.max,di=Math.min,Ra=wt([].concat),fa=wt([].push),za=wt("".indexOf),Si=wt("".slice),ao="a".replace(/./,"$0")==="$0",ra=!!/./[va]&&/./[va]("a","$0")==="";function ko(_){this.message=_}le("replace",function(_,w,M){var O=ra?"$":"$0";return[function(B,J){var ce=Xn(this),se=B==null?void 0:xt(B,va);return se?Ci(se,B,ce,J):Ci(w,lu(ce),B,J)},function(B,J){var ce=oa(this),se=lu(B);if(typeof J=="string"&&za(J,O)===-1&&za(J,"$<")===-1){var De=M(w,ce,se,J);if(De.done)return De.value}var je=ai(J);je||(J=lu(J));var Ze=ce.global;if(Ze){var Qt=ce.unicode;ce.lastIndex=0}for(var xr=[];;){var Fr=Jn(ce,se);if(Fr===null||(fa(xr,Fr),!Ze))break;lu(Fr[0])===""&&(ce.lastIndex=$t(se,Ho(ce.lastIndex),Qt))}for(var Xr,Rn="",Cn=0,Fn=0;Fn<xr.length;Fn++){for(var vn=lu((Fr=xr[Fn])[0]),ri=Wi(di(ei(Fr.index),se.length),0),xi=[],Eo=1;Eo<Fr.length;Eo++)fa(xi,(Xr=Fr[Eo])===void 0?Xr:String(Xr));var uo=Fr.groups;if(je){var ro=Ra([vn],xi,ri,se);uo!==void 0&&fa(ro,uo);var lo=lu(_l(J,void 0,ro))}else lo=Qn(vn,se,ri,xi,uo,J);ri>=Cn&&(Rn+=Si(se,Cn,ri)+lo,Cn=ri+vn.length)}return Rn+Si(se,Cn)}]},!!Z(function(){var _=/./;return _.exec=function(){var w=[];return w.groups={a:"7"},w},"".replace(_,"$<a>")!=="7"})||!ao||ra),ko.prototype=new Error,ko.prototype.name="InvalidCharacterError",D({global:!0},{globalThis:Ue}),X=typeof window=="undefined"?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(_){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(_){return null},clearMeasures:function(_){return null},clearMarks:function(_){return null},measure:function(_,w,M){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(_){return!0},Event:function(_,w){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0?my.getSystemInfoSync().pixelRatio:X.devicePixelRatio;var gs=TypeError,jo=function(_){if(_>9007199254740991)throw gs("Maximum allowed index exceeded");return _},ys=Ei("splice"),cu=Math.max,nu=Math.min;D({target:"Array",proto:!0,forced:!ys},{splice:function(_,w){var M,O,B,J,ce,se,De=Pi(this),je=Ro(De),Ze=Fa(_,je),Qt=arguments.length;for(Qt===0?M=O=0:Qt===1?(M=0,O=je-Ze):(M=Qt-2,O=nu(cu(ei(w),0),je-Ze)),jo(je+M-O),B=Et(De,O),J=0;J<O;J++)(ce=Ze+J)in De&&_i(B,J,De[ce]);if(B.length=O,M<O){for(J=Ze;J<je-O;J++)se=J+M,(ce=J+O)in De?De[se]=De[ce]:td(De,se);for(J=je;J>je-O+M;J--)td(De,J-1)}else if(M>O)for(J=je-O;J>Ze;J--)se=J+M-1,(ce=J+O-1)in De?De[se]=De[ce]:td(De,se);for(J=0;J<M;J++)De[J+Ze]=arguments[J+2];return De.length=je-O+M,B}});var il=we(function _(w,M){pe(this,_),Xe(this,"cancelBubble",void 0),Xe(this,"cancelable",void 0),Xe(this,"target",void 0),Xe(this,"currentTarget",void 0),Xe(this,"preventDefault",void 0),Xe(this,"stopPropagation",void 0),Xe(this,"type",void 0),Xe(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=w,this.timeStamp=Date.now()}),ts=Object.assign,ju=Object.defineProperty,Os=wt([].concat),Go=!ts||Z(function(){if(_r&&ts({b:1},ts(ju({},"a",{enumerable:!0,get:function(){ju(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var _={},w={},M=Symbol();return _[M]=7,"abcdefghijklmnopqrst".split("").forEach(function(O){w[O]=O}),ts({},_)[M]!=7||_o(ts({},w)).join("")!="abcdefghijklmnopqrst"})?function(_,w){for(var M=Pi(_),O=arguments.length,B=1,J=ps.f,ce=Ms.f;O>B;)for(var se,De=sl(arguments[B++]),je=J?Os(_o(De),J(De)):_o(De),Ze=je.length,Qt=0;Ze>Qt;)se=je[Qt++],_r&&!Ci(ce,De,se)||(M[se]=De[se]);return M}:ts;D({target:"Object",stat:!0,arity:2,forced:Object.assign!==Go},{assign:Go});var Sa=rr.findIndex,so=!0;"findIndex"in[]&&Array(1).findIndex(function(){so=!1}),D({target:"Array",proto:!0,forced:so},{findIndex:function(_){return Sa(this,_,arguments.length>1?arguments[1]:void 0)}}),Ec("findIndex");var bo=ut.charAt,Ua=Xi.set,Gu=Xi.getterFor("String Iterator");Rf(String,"String",function(_){Ua(this,{type:"String Iterator",string:lu(_),index:0})},function(){var _,w=Gu(this),M=w.string,O=w.index;return O>=M.length?{value:void 0,done:!0}:(_=bo(M,O),w.index+=_.length,{value:_,done:!1})});var fu=Za.f,Do=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Xs={f:function(_){return Do&&_a(_)=="Window"?function(w){try{return fu(w)}catch(M){return sf(Do)}}(_):fu(ns(_))}},Lu=Z(function(){if(typeof ArrayBuffer=="function"){var _=new ArrayBuffer(8);Object.isExtensible(_)&&Object.defineProperty(_,"a",{value:8})}}),Xa=Object.isExtensible,wl=Z(function(){Xa(1)})||Lu?function(_){return!!Rr(_)&&(!Lu||_a(_)!="ArrayBuffer")&&(!Xa||Xa(_))}:Xa,uc=!Z(function(){return Object.isExtensible(Object.preventExtensions({}))}),al=yr(function(_){var w=Sn.f,M=!1,O=Ma("meta"),B=0,J=function(se){w(se,O,{value:{objectID:"O"+B++,weakData:{}}})},ce=_.exports={enable:function(){ce.enable=function(){},M=!0;var se=Za.f,De=wt([].splice),je={};je[O]=1,se(je).length&&(Za.f=function(Ze){for(var Qt=se(Ze),xr=0,Fr=Qt.length;xr<Fr;xr++)if(Qt[xr]===O){De(Qt,xr,1);break}return Qt},D({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Xs.f}))},fastKey:function(se,De){if(!Rr(se))return typeof se=="symbol"?se:(typeof se=="string"?"S":"P")+se;if(!ln(se,O)){if(!wl(se))return"F";if(!De)return"E";J(se)}return se[O].objectID},getWeakData:function(se,De){if(!ln(se,O)){if(!wl(se))return!0;if(!De)return!1;J(se)}return se[O].weakData},onFreeze:function(se){return uc&&M&&wl(se)&&!ln(se,O)&&J(se),se}};zi[O]=!0}),Ss=(al.enable,al.fastKey,al.getWeakData,al.onFreeze,function(_,w,M){var O=_.indexOf("Map")!==-1,B=_.indexOf("Weak")!==-1,J=O?"set":"add",ce=Ue[_],se=ce&&ce.prototype,De=ce,je={},Ze=function(Cn){var Fn=wt(se[Cn]);Oa(se,Cn,Cn=="add"?function(vn){return Fn(this,vn===0?0:vn),this}:Cn=="delete"?function(vn){return!(B&&!Rr(vn))&&Fn(this,vn===0?0:vn)}:Cn=="get"?function(vn){return B&&!Rr(vn)?void 0:Fn(this,vn===0?0:vn)}:Cn=="has"?function(vn){return!(B&&!Rr(vn))&&Fn(this,vn===0?0:vn)}:function(vn,ri){return Fn(this,vn===0?0:vn,ri),this})};if(k(_,!ai(ce)||!(B||se.forEach&&!Z(function(){new ce().entries().next()}))))De=M.getConstructor(w,_,O,J),al.enable();else if(k(_,!0)){var Qt=new De,xr=Qt[J](B?{}:-0,1)!=Qt,Fr=Z(function(){Qt.has(1)}),Xr=yo(function(Cn){new ce(Cn)}),Rn=!B&&Z(function(){for(var Cn=new ce,Fn=5;Fn--;)Cn[J](Fn,Fn);return!Cn.has(-0)});Xr||((De=w(function(Cn,Fn){Fi(Cn,se);var vn=Oc(new ce,Cn,De);return Fn!=null&&es(Fn,vn[J],{that:vn,AS_ENTRIES:O}),vn})).prototype=se,se.constructor=De),(Fr||Rn)&&(Ze("delete"),Ze("has"),O&&Ze("get")),(Rn||xr)&&Ze(J),B&&se.clear&&delete se.clear}return je[_]=De,D({global:!0,constructor:!0,forced:De!=ce},je),Gr(De,_),B||M.setStrong(De,_,O),De}),Nc=al.getWeakData,zc=Xi.set,ad=Xi.getterFor,Cp=rr.find,od=rr.findIndex,Th=wt([].splice),sd=0,ip=function(_){return _.frozen||(_.frozen=new ap)},ap=function(){this.entries=[]},Sp=function(_,w){return Cp(_.entries,function(M){return M[0]===w})};ap.prototype={get:function(_){var w=Sp(this,_);if(w)return w[1]},has:function(_){return!!Sp(this,_)},set:function(_,w){var M=Sp(this,_);M?M[1]=w:this.entries.push([_,w])},delete:function(_){var w=od(this.entries,function(M){return M[0]===_});return~w&&Th(this.entries,w,1),!!~w}};var op,ud={getConstructor:function(_,w,M,O){var B=_(function(De,je){Fi(De,J),zc(De,{type:w,id:sd++,frozen:void 0}),je!=null&&es(je,De[O],{that:De,AS_ENTRIES:M})}),J=B.prototype,ce=ad(w),se=function(De,je,Ze){var Qt=ce(De),xr=Nc(oa(je),!0);return xr===!0?ip(Qt).set(je,Ze):xr[Qt.id]=Ze,De};return nl(J,{delete:function(De){var je=ce(this);if(!Rr(De))return!1;var Ze=Nc(De);return Ze===!0?ip(je).delete(De):Ze&&ln(Ze,je.id)&&delete Ze[je.id]},has:function(De){var je=ce(this);if(!Rr(De))return!1;var Ze=Nc(De);return Ze===!0?ip(je).has(De):Ze&&ln(Ze,je.id)}}),nl(J,M?{get:function(De){var je=ce(this);if(Rr(De)){var Ze=Nc(De);return Ze===!0?ip(je).get(De):Ze?Ze[je.id]:void 0}},set:function(De,je){return se(this,De,je)}}:{add:function(De){return se(this,De,!0)}}),B}},hf=Xi.enforce,Fd=!Ue.ActiveXObject&&"ActiveXObject"in Ue,Ap=function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},sp=Ss("WeakMap",Ap,ud);if(Lt&&Fd){op=ud.getConstructor(Ap,"WeakMap",!0),al.enable();var sh=sp.prototype,Dd=wt(sh.delete),wp=wt(sh.has),Tp=wt(sh.get),ld=wt(sh.set);nl(sh,{delete:function(_){if(Rr(_)&&!wl(_)){var w=hf(this);return w.frozen||(w.frozen=new op),Dd(this,_)||w.frozen.delete(_)}return Dd(this,_)},has:function(_){if(Rr(_)&&!wl(_)){var w=hf(this);return w.frozen||(w.frozen=new op),wp(this,_)||w.frozen.has(_)}return wp(this,_)},get:function(_){if(Rr(_)&&!wl(_)){var w=hf(this);return w.frozen||(w.frozen=new op),wp(this,_)?Tp(this,_):w.frozen.get(_)}return Tp(this,_)},set:function(_,w){if(Rr(_)&&!wl(_)){var M=hf(this);M.frozen||(M.frozen=new op),wp(this,_)?ld(this,_,w):M.frozen.set(_,w)}else ld(this,_,w);return this}})}var cd=Ke("iterator"),fd=Ke("toStringTag"),Mh=rc.values,hd=function(_,w){if(_){if(_[cd]!==Mh)try{Qi(_,cd,Mh)}catch(O){_[cd]=Mh}if(_[fd]||Qi(_,fd,w),Se[w]){for(var M in rc)if(_[M]!==rc[M])try{Qi(_,M,rc[M])}catch(O){_[M]=rc[M]}}}};for(var pd in Se)hd(Ue[pd]&&Ue[pd].prototype,pd);hd(Qe,"DOMTokenList");var Ih,Mp,up,lp,pf=new WeakMap,dd=function(){function _(){pe(this,_),pf.set(this,{})}return we(_,[{key:"addEventListener",value:function(w,M){var O=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=pf.get(this);B||(B={}),B[w]||(B[w]=[]),B[w].push(M),pf.set(this,B),O.capture,O.once,O.passive}},{key:"removeEventListener",value:function(w,M){var O=pf.get(this);if(O){var B=O[w];if(B&&B.length>0){for(var J=B.length;J--;J>0)if(B[J]===M){B.splice(J,1);break}}}}},{key:"dispatchEvent",value:function(w){var M=pf.get(this)[w.type];if(M){var O,B=function(J,ce){var se=typeof Symbol!="undefined"&&J[Symbol.iterator]||J["@@iterator"];if(!se){if(Array.isArray(J)||(se=zt(J))||ce&&J&&typeof J.length=="number"){se&&(J=se);var De=0,je=function(){};return{s:je,n:function(){return De>=J.length?{done:!0}:{done:!1,value:J[De++]}},e:function(Fr){throw Fr},f:je}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ze,Qt=!0,xr=!1;return{s:function(){se=se.call(J)},n:function(){var Fr=se.next();return Qt=Fr.done,Fr},e:function(Fr){xr=!0,Ze=Fr},f:function(){try{Qt||se.return==null||se.return()}finally{if(xr)throw Ze}}}}(M);try{for(B.s();!(O=B.n()).done;)(0,O.value)(w)}catch(J){B.e(J)}finally{B.f()}}}}]),_}(),vd=function(_){Ct(M,_);var w=br(M);function M(){var O;return pe(this,M),Xe(Yt(O=w.call(this)),"className",void 0),Xe(Yt(O),"children",void 0),O.className="",O.children=[],O}return we(M,[{key:"setAttribute",value:function(O,B){this[O]=B}},{key:"getAttribute",value:function(O){return this[O]}},{key:"setAttributeNS",value:function(O,B){this[O]=B}},{key:"getAttributeNS",value:function(O){return this[O]}}]),M}(function(_){Ct(M,_);var w=br(M);function M(){var O;return pe(this,M),Xe(Yt(O=w.call(this)),"childNodes",void 0),O.childNodes=[],O}return we(M,[{key:"appendChild",value:function(O){this.childNodes.push(O)}},{key:"cloneNode",value:function(){var O=Object.create(this);return Object.assign(O,this),O}},{key:"removeChild",value:function(O){var B=this.childNodes.findIndex(function(J){return J===O});return B>-1?this.childNodes.splice(B,1):null}}]),M}(dd));if(typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var Ip=my.getSystemInfoSync();Ih=Ip.screenWidth,Mp=Ip.screenHeight,up=Ip.windowWidth,lp=Ip.windowHeight}else{var M0=X.innerWidth,Bd=X.innerHeight;Ih=M0,Mp=Bd,up=M0,lp=Bd}var i0={width:Ih,height:Mp,availWidth:up,availHeight:lp,availLeft:0,availTop:0},md=i0.availWidth,Nd=i0.availHeight,kp={style:[]};function As(_,w){var M,O;"parentNode"in _||(M=w===0?function(){return null}:w===1?function(){return kp}:function(){return null},Object.defineProperty(_,"parentNode",{enumerable:!0,get:M})),"parentElement"in _||(O=w===0?function(){return null}:w===1?function(){return kp}:function(){return null},Object.defineProperty(_,"parentElement",{enumerable:!0,get:O}))}function Df(_){_.style=_.style||{},Object.assign(_.style,{top:"0px",left:"0px",width:md+"px",height:Nd+"px",margin:"0px",padding:"0px"})}function Xv(_){"clientLeft"in _||(_.clientLeft=0,_.clientTop=0),"clientWidth"in _||(_.clientWidth=md,_.clientHeight=Nd),"getBoundingClientRect"in _||(_.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function kh(_){"offsetLeft"in _||(_.offsetLeft=0,_.offsetTop=0),"offsetWidth"in _||(_.offsetWidth=md,_.offsetHeight=Nd)}function a0(_){"scrollLeft"in _||(_.scrollLeft=0,_.scrollTop=0),"scrollWidth"in _||(_.scrollWidth=md,_.scrollHeight=Nd)}function I0(_){var w=function(){return!0};_.classList=[],_.classList.add=w,_.classList.remove=w,_.classList.contains=w,_.classList.toggle=w}function Ph(){}var lc=function(_){Ct(M,_);var w=br(M);function M(){var O,B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",J=arguments.length>1?arguments[1]:void 0;return pe(this,M),Xe(Yt(O=w.call(this)),"className",void 0),Xe(Yt(O),"children",void 0),Xe(Yt(O),"focus",void 0),Xe(Yt(O),"blur",void 0),Xe(Yt(O),"insertBefore",void 0),Xe(Yt(O),"appendChild",void 0),Xe(Yt(O),"removeChild",void 0),Xe(Yt(O),"remove",void 0),Xe(Yt(O),"innerHTML",void 0),Xe(Yt(O),"tagName",void 0),O.className="",O.children=[],O.focus=Ph,O.blur=Ph,O.insertBefore=Ph,O.appendChild=Ph,O.removeChild=Ph,O.remove=Ph,O.innerHTML="",O.tagName=B.toUpperCase(),As(Yt(O),J),Df(Yt(O)),I0(Yt(O)),Xv(Yt(O)),kh(Yt(O)),a0(Yt(O)),O}return we(M)}(vd),ya=function(_){Ct(M,_);var w=br(M);function M(){return pe(this,M),w.call(this,"video")}return we(M)}(function(_){Ct(M,_);var w=br(M);function M(O){return pe(this,M),w.call(this,O)}return we(M,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),M}(lc)),ma={};function zd(){return ma}var k0=we(function _(){pe(this,_);var w=zd(),M=w.createImage&&w.createImage()||{};return"tagName"in M||(M.tagName="IMG",M.__proto__=_.prototype),As(M),I0(M),Object.assign(M,{addEventListener:function(O,B){M["on".concat(O)]=B.bind(M)},removeEventListener:function(O){M["on".concat(O)]=null}}),M}),P0={href:"",protocol:"",host:""},Yv=function(_){Ct(M,_);var w=br(M);function M(){return pe(this,M),w.call(this,"body",0)}return we(M,[{key:"addEventListener",value:function(O,B){}},{key:"removeEventListener",value:function(O,B,J){}},{key:"dispatchEvent",value:function(O){}}]),M}(lc),o0=function(_){Ct(M,_);var w=br(M);function M(){return pe(this,M),w.call(this,"html",0)}return we(M,[{key:"addEventListener",value:function(O,B){}},{key:"removeEventListener",value:function(O,B){}},{key:"dispatchEvent",value:function(O){}}]),M}(lc),Ud={},R0={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:P0,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(_){return(_=_.toLowerCase())==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):_==="img"?new k0:_==="video"?new ya:new lc(_)},createElementNS:function(_,w){return this.createElement(w)},createTextNode:function(_){return _},getElementById:function(_){return null},getElementsByTagName:function(_){return _=_.toLowerCase(),[]},getElementsByTagNameNS:function(_,w){return this.getElementsByTagName(w)},getElementsByName:function(_){return[]},querySelector:function(_){return null},querySelectorAll:function(_){return[]},addEventListener:function(_,w,M){Ud[_]||(Ud[_]=[]),Ud[_].push(w)},removeEventListener:function(_,w){var M=Ud[_];if(M&&M.length>0){for(var O=M.length;O--;O>0)if(M[O]===w){M.splice(O,1);break}}},dispatchEvent:function(_){var w=_.type,M=Ud[w];if(M)for(var O=0;O<M.length;O++)M[O](_);_.target&&typeof _.target["on"+w]=="function"&&_.target["on"+w](_)},createEvent:function(_){return new il(_)}};R0.documentElement=new o0,R0.head=new lc("head"),R0.body=new Yv,le("match",function(_,w,M){return[function(O){var B=Xn(this),J=O==null?void 0:xt(O,_);return J?Ci(J,O,B):new RegExp(O)[_](lu(B))},function(O){var B=oa(this),J=lu(O),ce=M(w,B,J);if(ce.done)return ce.value;if(!B.global)return Jn(B,J);var se=B.unicode;B.lastIndex=0;for(var De,je=[],Ze=0;(De=Jn(B,J))!==null;){var Qt=lu(De[0]);je[Ze]=Qt,Qt===""&&(B.lastIndex=$t(J,Ho(B.lastIndex),se)),Ze++}return Ze===0?null:je}]});var L0,Xl,sv=Ke("isConcatSpreadable"),Uc=ge>=51||!Z(function(){var _=[];return _[sv]=!1,_.concat()[0]!==_}),O0=Ei("concat"),qv=function(_){if(!Rr(_))return!1;var w=_[sv];return w!==void 0?!!w:nt(_)};if(D({target:"Array",proto:!0,arity:1,forced:!Uc||!O0},{concat:function(_){var w,M,O,B,J,ce=Pi(this),se=Et(ce,0),De=0;for(w=-1,O=arguments.length;w<O;w++)if(qv(J=w===-1?ce:arguments[w]))for(B=Ro(J),jo(De+B),M=0;M<B;M++,De++)M in J&&_i(se,De,J[M]);else jo(De+1),_i(se,De++,J);return se.length=De,se}}),typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var Bf=my.getSystemInfoSync();L0=Bf.system,Bf.platform,Bf.language}else{var Zc={versions:(Xl=X.navigator.userAgent,{trident:Xl.indexOf("Trident")>-1,presto:Xl.indexOf("Presto")>-1,webKit:Xl.indexOf("AppleWebKit")>-1,gecko:Xl.indexOf("Gecko")>-1&&Xl.indexOf("KHTML")===-1,mobile:!!Xl.match(/AppleWebKit.*Mobile.*/),ios:!!Xl.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Xl.indexOf("Android")>-1||Xl.indexOf("Linux")>-1,iPhone:Xl.indexOf("iPhone")>-1,iPad:Xl.indexOf("iPad")>-1,webApp:Xl.indexOf("Safari")===-1,weixin:Xl.indexOf("MicroMessenger")>-1,qq:Xl.match(/\sQQ/i)===" qq"}),language:(X.navigator.browserLanguage||X.navigator.language).toLowerCase()};Zc.versions.android||Zc.versions.trident||Zc.versions.presto||Zc.versions.webKit||Zc.versions.gecko||Zc.versions.mobile||Zc.versions.ios||Zc.versions.iPhone||Zc.versions.iPad||Zc.versions.webApp||Zc.versions.weixin||Zc.versions.qq,L0=X.navigator.userAgent,Zc.language}L0.toLowerCase().indexOf("android"),ih("Uint8",function(_){return function(w,M,O){return _(this,w,M,O)}});var $v=Sn.f,Pp=al.fastKey,gd=Xi.set,Rp=Xi.getterFor;Ss("Map",function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(_,w,M,O){var B=_(function(je,Ze){Fi(je,J),gd(je,{type:w,index:ku(null),first:void 0,last:void 0,size:0}),_r||(je.size=0),Ze!=null&&es(Ze,je[O],{that:je,AS_ENTRIES:M})}),J=B.prototype,ce=Rp(w),se=function(je,Ze,Qt){var xr,Fr,Xr=ce(je),Rn=De(je,Ze);return Rn?Rn.value=Qt:(Xr.last=Rn={index:Fr=Pp(Ze,!0),key:Ze,value:Qt,previous:xr=Xr.last,next:void 0,removed:!1},Xr.first||(Xr.first=Rn),xr&&(xr.next=Rn),_r?Xr.size++:je.size++,Fr!=="F"&&(Xr.index[Fr]=Rn)),je},De=function(je,Ze){var Qt,xr=ce(je),Fr=Pp(Ze);if(Fr!=="F")return xr.index[Fr];for(Qt=xr.first;Qt;Qt=Qt.next)if(Qt.key==Ze)return Qt};return nl(J,{clear:function(){for(var je=ce(this),Ze=je.index,Qt=je.first;Qt;)Qt.removed=!0,Qt.previous&&(Qt.previous=Qt.previous.next=void 0),delete Ze[Qt.index],Qt=Qt.next;je.first=je.last=void 0,_r?je.size=0:this.size=0},delete:function(je){var Ze=ce(this),Qt=De(this,je);if(Qt){var xr=Qt.next,Fr=Qt.previous;delete Ze.index[Qt.index],Qt.removed=!0,Fr&&(Fr.next=xr),xr&&(xr.previous=Fr),Ze.first==Qt&&(Ze.first=xr),Ze.last==Qt&&(Ze.last=Fr),_r?Ze.size--:this.size--}return!!Qt},forEach:function(je){for(var Ze,Qt=ce(this),xr=$s(je,arguments.length>1?arguments[1]:void 0);Ze=Ze?Ze.next:Qt.first;)for(xr(Ze.value,Ze.key,this);Ze&&Ze.removed;)Ze=Ze.previous},has:function(je){return!!De(this,je)}}),nl(J,M?{get:function(je){var Ze=De(this,je);return Ze&&Ze.value},set:function(je,Ze){return se(this,je===0?0:je,Ze)}}:{add:function(je){return se(this,je=je===0?0:je,je)}}),_r&&$v(J,"size",{get:function(){return ce(this).size}}),B},setStrong:function(_,w,M){var O=w+" Iterator",B=Rp(w),J=Rp(O);Rf(_,w,function(ce,se){gd(this,{type:O,target:ce,state:B(ce),kind:se,last:void 0})},function(){for(var ce=J(this),se=ce.kind,De=ce.last;De&&De.removed;)De=De.previous;return ce.target&&(ce.last=De=De?De.next:ce.state.first)?se=="keys"?{value:De.key,done:!1}:se=="values"?{value:De.value,done:!1}:{value:[De.key,De.value],done:!1}:(ce.target=void 0,{value:void 0,done:!0})},M?"entries":"values",!M,!0),ji(w)}});var Zd=wt([].join),Vd=sl!=Object,Kv=Ar("join",",");D({target:"Array",proto:!0,forced:Vd||!Kv},{join:function(_){return Zd(ns(this),_===void 0?",":_)}});var Qv=Z(function(){_o(1)});D({target:"Object",stat:!0,forced:Qv},{keys:function(_){return _o(Pi(_))}});var F0=new Map,uv=new Map,lv=new Map,Nf=function(_){Ct(M,_);var w=br(M);function M(){var O;return pe(this,M),Xe(Yt(O=w.call(this)),"onabort",void 0),Xe(Yt(O),"onerror",void 0),Xe(Yt(O),"onload",void 0),Xe(Yt(O),"onloadstart",void 0),Xe(Yt(O),"onprogress",void 0),Xe(Yt(O),"ontimeout",void 0),Xe(Yt(O),"onloadend",void 0),Xe(Yt(O),"onreadystatechange",void 0),Xe(Yt(O),"readyState",void 0),Xe(Yt(O),"response",void 0),Xe(Yt(O),"responseText",void 0),Xe(Yt(O),"_responseType",void 0),Xe(Yt(O),"responseXML",void 0),Xe(Yt(O),"status",void 0),Xe(Yt(O),"statusText",void 0),Xe(Yt(O),"upload",void 0),Xe(Yt(O),"withCredentials",void 0),Xe(Yt(O),"timeout",void 0),Xe(Yt(O),"_url",void 0),Xe(Yt(O),"_method",void 0),O.onabort=null,O.onerror=null,O.onload=null,O.onloadstart=null,O.onprogress=null,O.ontimeout=null,O.onloadend=null,O.onreadystatechange=null,O.readyState=0,O.response=null,O.responseText=null,O._responseType="text",O.responseXML=null,O.status=0,O.statusText="",O.upload={},O.withCredentials=!1,F0.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),O}return we(M,[{key:"responseType",set:function(O){this._responseType=O}},{key:"abort",value:function(){var O=lv.get("requestTask");O&&O.abort()}},{key:"getAllResponseHeaders",value:function(){var O=uv.get("responseHeader");return Object.keys(O).map(function(B){return"".concat(B,": ").concat(O[B])}).join(`
`)}},{key:"getResponseHeader",value:function(O){return uv.get("responseHeader")[O]}},{key:"open",value:function(O,B,J){this._method=O,this._url=B}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(O,B){var J=F0.get("requestHeader");J[O]=B,F0.set("requestHeader",J)}},{key:"addEventListener",value:function(O,B){var J=this;typeof B=="function"&&(this["on"+O]=function(){var ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ce.target=ce.target||J,B.call(J,ce)})}},{key:"removeEventListener",value:function(O,B){this["on"+O]===B&&(this["on"+O]=null)}}]),M}(dd);Xe(Nf,"UNSEND",void 0),Xe(Nf,"OPENED",void 0),Xe(Nf,"HEADERS_RECEIVED",void 0),Xe(Nf,"LOADING",void 0),Xe(Nf,"DONE",void 0),Nf.UNSEND=0,Nf.OPENED=1,Nf.HEADERS_RECEIVED=2,Nf.LOADING=3,Nf.DONE=4;var zf=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Jv=typeof wx!="undefined"&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0),D0=zf||Jv;D0||X.XMLHttpRequest,D0||X.location;function s0(_){return[_+1&255,_+1>>8&255,_+1>>8>>8&255]}var em=rr.filter,cv=Ei("filter");function B0(_,w){var M=_.color;return M&&M.length?M:[1,1,1,1]}function N0(_,w,M){return M.length===2?[M[0],M[1],0]:[M[0],M[1],M[2]]}function u0(_,w){return _.filter?[1]:[0]}function z0(_,w,M,O){return[w]}D({target:"Array",proto:!0,forced:!cv},{filter:function(_){return em(this,_,arguments.length>1?arguments[1]:void 0)}});var yd=_d,tm=_d;function _d(_,w,M){M=M||2;var O,B,J,ce,se,De,je,Ze=w&&w.length,Qt=Ze?w[0]*M:_.length,xr=rm(_,0,Qt,M,!0),Fr=[];if(!xr||xr.next===xr.prev)return Fr;if(Ze&&(xr=function(Rn,Cn,Fn,vn){var ri,xi,Eo,uo,ro,lo=[];for(ri=0,xi=Cn.length;ri<xi;ri++)Eo=Cn[ri]*vn,uo=ri<xi-1?Cn[ri+1]*vn:Rn.length,(ro=rm(Rn,Eo,uo,vn,!1))===ro.next&&(ro.steiner=!0),lo.push(Gd(ro));for(lo.sort(pv),ri=0;ri<lo.length;ri++)Fn=dv(lo[ri],Fn);return Fn}(_,w,xr,M)),_.length>80*M){O=J=_[0],B=ce=_[1];for(var Xr=M;Xr<Qt;Xr+=M)(se=_[Xr])<O&&(O=se),(De=_[Xr+1])<B&&(B=De),se>J&&(J=se),De>ce&&(ce=De);je=(je=Math.max(J-O,ce-B))!==0?32767/je:0}return jd(xr,Fr,M,O,B,je,0),Fr}function rm(_,w,M,O,B){var J,ce;if(B===am(_,w,M,O)>0)for(J=w;J<M;J+=O)ce=nm(J,_[J],_[J+1],ce);else for(J=M-O;J>=w;J-=O)ce=nm(J,_[J],_[J+1],ce);return ce&&xd(ce,ce.next)&&(V0(ce),ce=ce.next),ce}function uh(_,w){if(!_)return _;w||(w=_);var M,O=_;do if(M=!1,O.steiner||!xd(O,O.next)&&Ys(O.prev,O,O.next)!==0)O=O.next;else{if(V0(O),(O=w=O.prev)===O.next)break;M=!0}while(M||O!==w);return w}function jd(_,w,M,O,B,J,ce){if(_){!ce&&J&&function(Ze,Qt,xr,Fr){var Xr=Ze;do Xr.z===0&&(Xr.z=cc(Xr.x,Xr.y,Qt,xr,Fr)),Xr.prevZ=Xr.prev,Xr.nextZ=Xr.next,Xr=Xr.next;while(Xr!==Ze);Xr.prevZ.nextZ=null,Xr.prevZ=null,function(Rn){var Cn,Fn,vn,ri,xi,Eo,uo,ro,lo=1;do{for(Fn=Rn,Rn=null,xi=null,Eo=0;Fn;){for(Eo++,vn=Fn,uo=0,Cn=0;Cn<lo&&(uo++,vn=vn.nextZ);Cn++);for(ro=lo;uo>0||ro>0&&vn;)uo!==0&&(ro===0||!vn||Fn.z<=vn.z)?(ri=Fn,Fn=Fn.nextZ,uo--):(ri=vn,vn=vn.nextZ,ro--),xi?xi.nextZ=ri:Rn=ri,ri.prevZ=xi,xi=ri;Fn=vn}xi.nextZ=null,lo*=2}while(Eo>1)}(Xr)}(_,O,B,J);for(var se,De,je=_;_.prev!==_.next;)if(se=_.prev,De=_.next,J?hv(_,O,B,J):fv(_))w.push(se.i/M|0),w.push(_.i/M|0),w.push(De.i/M|0),V0(_),_=De.next,je=De.next;else if((_=De)===je){ce?ce===1?jd(_=cp(uh(_),w,M),w,M,O,B,J,2):ce===2&&Lp(_,w,M,O,B,J):jd(uh(_),w,M,O,B,J,1);break}}}function fv(_){var w=_.prev,M=_,O=_.next;if(Ys(w,M,O)>=0)return!1;for(var B=w.x,J=M.x,ce=O.x,se=w.y,De=M.y,je=O.y,Ze=B<J?B<ce?B:ce:J<ce?J:ce,Qt=se<De?se<je?se:je:De<je?De:je,xr=B>J?B>ce?B:ce:J>ce?J:ce,Fr=se>De?se>je?se:je:De>je?De:je,Xr=O.next;Xr!==w;){if(Xr.x>=Ze&&Xr.x<=xr&&Xr.y>=Qt&&Xr.y<=Fr&&Op(B,se,J,De,ce,je,Xr.x,Xr.y)&&Ys(Xr.prev,Xr,Xr.next)>=0)return!1;Xr=Xr.next}return!0}function hv(_,w,M,O){var B=_.prev,J=_,ce=_.next;if(Ys(B,J,ce)>=0)return!1;for(var se=B.x,De=J.x,je=ce.x,Ze=B.y,Qt=J.y,xr=ce.y,Fr=se<De?se<je?se:je:De<je?De:je,Xr=Ze<Qt?Ze<xr?Ze:xr:Qt<xr?Qt:xr,Rn=se>De?se>je?se:je:De>je?De:je,Cn=Ze>Qt?Ze>xr?Ze:xr:Qt>xr?Qt:xr,Fn=cc(Fr,Xr,w,M,O),vn=cc(Rn,Cn,w,M,O),ri=_.prevZ,xi=_.nextZ;ri&&ri.z>=Fn&&xi&&xi.z<=vn;){if(ri.x>=Fr&&ri.x<=Rn&&ri.y>=Xr&&ri.y<=Cn&&ri!==B&&ri!==ce&&Op(se,Ze,De,Qt,je,xr,ri.x,ri.y)&&Ys(ri.prev,ri,ri.next)>=0||(ri=ri.prevZ,xi.x>=Fr&&xi.x<=Rn&&xi.y>=Xr&&xi.y<=Cn&&xi!==B&&xi!==ce&&Op(se,Ze,De,Qt,je,xr,xi.x,xi.y)&&Ys(xi.prev,xi,xi.next)>=0))return!1;xi=xi.nextZ}for(;ri&&ri.z>=Fn;){if(ri.x>=Fr&&ri.x<=Rn&&ri.y>=Xr&&ri.y<=Cn&&ri!==B&&ri!==ce&&Op(se,Ze,De,Qt,je,xr,ri.x,ri.y)&&Ys(ri.prev,ri,ri.next)>=0)return!1;ri=ri.prevZ}for(;xi&&xi.z<=vn;){if(xi.x>=Fr&&xi.x<=Rn&&xi.y>=Xr&&xi.y<=Cn&&xi!==B&&xi!==ce&&Op(se,Ze,De,Qt,je,xr,xi.x,xi.y)&&Ys(xi.prev,xi,xi.next)>=0)return!1;xi=xi.nextZ}return!0}function cp(_,w,M){var O=_;do{var B=O.prev,J=O.next.next;!xd(B,J)&&Tl(B,O,O.next,J)&&l0(B,J)&&l0(J,B)&&(w.push(B.i/M|0),w.push(O.i/M|0),w.push(J.i/M|0),V0(O),V0(O.next),O=_=J),O=O.next}while(O!==_);return uh(O)}function Lp(_,w,M,O,B,J){var ce=_;do{for(var se=ce.next.next;se!==ce.prev;){if(ce.i!==se.i&&Hd(ce,se)){var De=mv(ce,se);return ce=uh(ce,ce.next),De=uh(De,De.next),jd(ce,w,M,O,B,J,0),void jd(De,w,M,O,B,J,0)}se=se.next}ce=ce.next}while(ce!==_)}function pv(_,w){return _.x-w.x}function dv(_,w){var M=function(B,J){var ce,se=J,De=B.x,je=B.y,Ze=-1/0;do{if(je<=se.y&&je>=se.next.y&&se.next.y!==se.y){var Qt=se.x+(je-se.y)*(se.next.x-se.x)/(se.next.y-se.y);if(Qt<=De&&Qt>Ze&&(Ze=Qt,ce=se.x<se.next.x?se:se.next,Qt===De))return ce}se=se.next}while(se!==J);if(!ce)return null;var xr,Fr=ce,Xr=ce.x,Rn=ce.y,Cn=1/0;se=ce;do De>=se.x&&se.x>=Xr&&De!==se.x&&Op(je<Rn?De:Ze,je,Xr,Rn,je<Rn?Ze:De,je,se.x,se.y)&&(xr=Math.abs(je-se.y)/(De-se.x),l0(se,B)&&(xr<Cn||xr===Cn&&(se.x>ce.x||se.x===ce.x&&vv(ce,se)))&&(ce=se,Cn=xr)),se=se.next;while(se!==Fr);return ce}(_,w);if(!M)return w;var O=mv(M,_);return uh(O,O.next),uh(M,M.next)}function vv(_,w){return Ys(_.prev,_,w.prev)<0&&Ys(w.next,_,_.next)<0}function cc(_,w,M,O,B){return(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-M)*B|0)|_<<8))|_<<4))|_<<2))|_<<1))|(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w=(w-O)*B|0)|w<<8))|w<<4))|w<<2))|w<<1))<<1}function Gd(_){var w=_,M=_;do(w.x<M.x||w.x===M.x&&w.y<M.y)&&(M=w),w=w.next;while(w!==_);return M}function Op(_,w,M,O,B,J,ce,se){return(B-ce)*(w-se)>=(_-ce)*(J-se)&&(_-ce)*(O-se)>=(M-ce)*(w-se)&&(M-ce)*(J-se)>=(B-ce)*(O-se)}function Hd(_,w){return _.next.i!==w.i&&_.prev.i!==w.i&&!function(M,O){var B=M;do{if(B.i!==M.i&&B.next.i!==M.i&&B.i!==O.i&&B.next.i!==O.i&&Tl(B,B.next,M,O))return!0;B=B.next}while(B!==M);return!1}(_,w)&&(l0(_,w)&&l0(w,_)&&function(M,O){var B=M,J=!1,ce=(M.x+O.x)/2,se=(M.y+O.y)/2;do B.y>se!=B.next.y>se&&B.next.y!==B.y&&ce<(B.next.x-B.x)*(se-B.y)/(B.next.y-B.y)+B.x&&(J=!J),B=B.next;while(B!==M);return J}(_,w)&&(Ys(_.prev,_,w.prev)||Ys(_,w.prev,w))||xd(_,w)&&Ys(_.prev,_,_.next)>0&&Ys(w.prev,w,w.next)>0)}function Ys(_,w,M){return(w.y-_.y)*(M.x-w.x)-(w.x-_.x)*(M.y-w.y)}function xd(_,w){return _.x===w.x&&_.y===w.y}function Tl(_,w,M,O){var B=Z0(Ys(_,w,M)),J=Z0(Ys(_,w,O)),ce=Z0(Ys(M,O,_)),se=Z0(Ys(M,O,w));return B!==J&&ce!==se||!(B!==0||!U0(_,M,w))||!(J!==0||!U0(_,O,w))||!(ce!==0||!U0(M,_,O))||!(se!==0||!U0(M,w,O))}function U0(_,w,M){return w.x<=Math.max(_.x,M.x)&&w.x>=Math.min(_.x,M.x)&&w.y<=Math.max(_.y,M.y)&&w.y>=Math.min(_.y,M.y)}function Z0(_){return _>0?1:_<0?-1:0}function l0(_,w){return Ys(_.prev,_,_.next)<0?Ys(_,w,_.next)>=0&&Ys(_,_.prev,w)>=0:Ys(_,w,_.prev)<0||Ys(_,_.next,w)<0}function mv(_,w){var M=new im(_.i,_.x,_.y),O=new im(w.i,w.x,w.y),B=_.next,J=w.prev;return _.next=w,w.prev=_,M.next=B,B.prev=M,O.next=M,M.prev=O,J.next=O,O.prev=J,O}function nm(_,w,M,O){var B=new im(_,w,M);return O?(B.next=O.next,B.prev=O,O.next.prev=B,O.next=B):(B.prev=B,B.next=B),B}function V0(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function im(_,w,M){this.i=_,this.x=w,this.y=M,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function am(_,w,M,O){for(var B=0,J=w,ce=M-O;J<M;J+=O)B+=(_[ce]-_[J])*(_[J+1]+_[ce+1]),ce=J;return B}_d.deviation=function(_,w,M,O){var B=w&&w.length,J=B?w[0]*M:_.length,ce=Math.abs(am(_,0,J,M));if(B)for(var se=0,De=w.length;se<De;se++){var je=w[se]*M,Ze=se<De-1?w[se+1]*M:_.length;ce-=Math.abs(am(_,je,Ze,M))}var Qt=0;for(se=0;se<O.length;se+=3){var xr=O[se]*M,Fr=O[se+1]*M,Xr=O[se+2]*M;Qt+=Math.abs((_[xr]-_[Xr])*(_[Fr+1]-_[xr+1])-(_[xr]-_[Fr])*(_[Xr+1]-_[xr+1]))}return ce===0&&Qt===0?0:Math.abs((Qt-ce)/ce)},_d.flatten=function(_){for(var w=_[0][0].length,M={vertices:[],holes:[],dimensions:w},O=0,B=0;B<_.length;B++){for(var J=0;J<_[B].length;J++)for(var ce=0;ce<w;ce++)M.vertices.push(_[B][J][ce]);B>0&&(O+=_[B-1].length,M.holes.push(O))}return M},yd.default=tm;var Nm=wt(1 .valueOf),zm=wt("".replace),gv=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,Hg=RegExp("^"+gv+gv+"*"),q=RegExp(gv+gv+"*$"),yv=function(_){return function(w){var M=lu(Xn(w));return 1&_&&(M=zm(M,Hg,"")),2&_&&(M=zm(M,q,"")),M}},Um={start:yv(1),end:yv(2),trim:yv(3)},Zm=Za.f,Vm=Be.f,jm=Sn.f,Gm=Um.trim,Fp=Ue.Number,Dp=Fp.prototype,Hm=Ue.TypeError,Wm=wt("".slice),j0=wt("".charCodeAt),Xm=function(_){var w=Zr(_,"number");return typeof w=="bigint"?w:Ym(w)},Ym=function(_){var w,M,O,B,J,ce,se,De,je=Zr(_,"number");if(ae(je))throw Hm("Cannot convert a Symbol value to a number");if(typeof je=="string"&&je.length>2){if(je=Gm(je),(w=j0(je,0))===43||w===45){if((M=j0(je,2))===88||M===120)return NaN}else if(w===48){switch(j0(je,1)){case 66:case 98:O=2,B=49;break;case 79:case 111:O=8,B=55;break;default:return+je}for(ce=(J=Wm(je,2)).length,se=0;se<ce;se++)if((De=j0(J,se))<48||De>B)return NaN;return parseInt(J,O)}}return+je};if(k("Number",!Fp(" 0o1")||!Fp("0b1")||Fp("+0x1"))){for(var _v,c0=function(_){var w=arguments.length<1?0:Fp(Xm(_)),M=this;return la(Dp,M)&&Z(function(){Nm(M)})?Oc(Object(w),M,c0):w},om=_r?Zm(Fp):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),xv=0;om.length>xv;xv++)ln(Fp,_v=om[xv])&&!ln(c0,_v)&&jm(c0,_v,Vm(Fp,_v));c0.prototype=Dp,Dp.constructor=c0,Oa(Ue,"Number",c0,{constructor:!0})}var qm=RangeError,$m=RangeError,sm=String,f0=Math.floor,bv=wt(function(_){var w=lu(Xn(this)),M="",O=ei(_);if(O<0||O==1/0)throw qm("Wrong number of repetitions");for(;O>0;(O>>>=1)&&(w+=w))1&O&&(M+=w);return M}),um=wt("".slice),h0=wt(1 .toFixed),p0=function(_,w,M){return w===0?M:w%2==1?p0(_,w-1,M*_):p0(_*_,w/2,M)},d0=function(_,w,M){for(var O=-1,B=M;++O<6;)B+=w*_[O],_[O]=B%1e7,B=f0(B/1e7)},Ev=function(_,w){for(var M=6,O=0;--M>=0;)O+=_[M],_[M]=f0(O/w),O=O%w*1e7},Km=function(_){for(var w=6,M="";--w>=0;)if(M!==""||w===0||_[w]!==0){var O=sm(_[w]);M=M===""?O:M+bv("0",7-O.length)+O}return M},bd=Z(function(){return h0(8e-5,3)!=="0.000"||h0(.9,0)!=="1"||h0(1.255,2)!=="1.25"||h0(1000000000000000100,0)!=="1000000000000000128"})||!Z(function(){h0({})});function lm(_){return typeof _=="number"}function Ed(_){var w=Math.max(Math.min(85.0511287798,_[1]),-85.0511287798),M=Math.PI/180,O=_[0]*M,B=w*M;return B=Math.log(Math.tan(Math.PI/4+B/2)),O=(256<<20)*(.5/Math.PI*O+.5),B=(256<<20)*(-.5/Math.PI*B+(M=.5)),[Math.floor(O),Math.floor(B)]}D({target:"Number",proto:!0,forced:bd},{toFixed:function(_){var w,M,O,B,J=Nm(this),ce=ei(_),se=[0,0,0,0,0,0],De="",je="0";if(ce<0||ce>20)throw $m("Incorrect fraction digits");if(J!=J)return"NaN";if(J<=-1e21||J>=1e21)return sm(J);if(J<0&&(De="-",J=-J),J>1e-21)if(M=(w=function(Ze){for(var Qt=0,xr=Ze;xr>=4096;)Qt+=12,xr/=4096;for(;xr>=2;)Qt+=1,xr/=2;return Qt}(J*p0(2,69,1))-69)<0?J*p0(2,-w,1):J/p0(2,w,1),M*=4503599627370496,(w=52-w)>0){for(d0(se,0,M),O=ce;O>=7;)d0(se,1e7,0),O-=7;for(d0(se,p0(10,O,1),0),O=w-1;O>=23;)Ev(se,1<<23),O-=23;Ev(se,1<<O),d0(se,1,1),Ev(se,2),je=Km(se)}else d0(se,0,M),d0(se,1<<-w,0),je=Km(se)+bv("0",ce);return je=ce>0?De+((B=je.length)<=ce?"0."+bv("0",ce-B)+je:um(je,0,B-ce)+"."+um(je,B-ce)):De+je}});var Qm,Wg=/"/g,Xg=wt("".replace);D({target:"String",proto:!0,forced:(Qm="sub",Z(function(){var _=""[Qm]('"');return _!==_.toLowerCase()||_.split('"').length>3}))},{sub:function(){return _="sub",w="",M="",O=lu(Xn(this)),B="<"+_,w!==""&&(B+=" "+w+'="'+Xg(lu(M),Wg,"&quot;")+'"'),B+">"+O+"</"+_+">";var _,w,M,O,B}});var v0=RegExp.prototype,Jm=Tn.PROPER,cm=RegExp.prototype.toString,eg=Z(function(){return cm.call({source:"a",flags:"b"})!="/a/b"}),fm=Jm&&cm.name!="toString";(eg||fm)&&Oa(RegExp.prototype,"toString",function(){var _=oa(this);return"/"+lu(_.source)+"/"+lu(function(w){var M=w.flags;return M!==void 0||"flags"in v0||ln(w,"flags")||!la(v0,w)?M:Ci(oh,w)}(_))},{unsafe:!0});var Cv=typeof Float32Array!="undefined"?Float32Array:Array;function vl(){var _=new Cv(2);return Cv!=Float32Array&&(_[0]=0,_[1]=0),_}function hm(_,w){var M=new Cv(2);return M[0]=_,M[1]=w,M}function G0(_,w){return _[0]=w[0],_[1]=w[1],_}function Rh(_,w,M){return _[0]=w[0]+M[0],_[1]=w[1]+M[1],_}function Sv(_,w,M){return _[0]=w[0]-M[0],_[1]=w[1]-M[1],_}function m0(_,w){var M=w[0],O=w[1],B=M*M+O*O;return B>0&&(B=1/Math.sqrt(B)),_[0]=w[0]*B,_[1]=w[1]*B,_}function H0(_,w){return _[0]*w[0]+_[1]*w[1]}Math.hypot||(Math.hypot=function(){for(var _=0,w=arguments.length;w--;)_+=arguments[w]*arguments[w];return Math.sqrt(_)});var tg,Av=Sv,W0=(tg=vl(),vl()),Hu=(vl(),vl()),Bp=vl(),Wd=vl();function wv(_,w,M,O,B){return Rh(_,M,O),m0(_,_),[B/H0(w=hm(-_[1],_[0]),hm(-M[1],M[0])),w]}function Np(_,w){return function(M,O,B){return M[0]=O,M[1]=B,M}(_,-w[1],w[0])}function Xd(_,w,M){return Av(_,w,M),m0(_,_),_}function Tv(_,w){return _[0]===w[0]&&_[1]===w[1]}var rg=function(){function _(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};pe(this,_),Xe(this,"complex",void 0),Xe(this,"join",void 0),Xe(this,"cap",void 0),Xe(this,"miterLimit",void 0),Xe(this,"thickness",void 0),Xe(this,"normal",void 0),Xe(this,"lastFlip",-1),Xe(this,"miter",hm(0,0)),Xe(this,"started",!1),Xe(this,"dash",!1),Xe(this,"totalDistance",0),Xe(this,"currentIndex",0),this.join=w.join||"miter",this.cap=w.cap||"butt",this.miterLimit=w.miterLimit||10,this.thickness=w.thickness||1,this.dash=w.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return we(_,[{key:"extrude_gaode2",value:function(w,M){var O=this.complex;if(w.length<=1)return O;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var B=w.length,J=O.startIndex,ce=1;ce<B;ce++){var se,De,je,Ze=w[ce-1];Ze.push((se=M[ce-1][2])!==null&&se!==void 0?se:0);var Qt=M[ce-1],xr=w[ce];xr.push((De=M[ce][2])!==null&&De!==void 0?De:0);var Fr=M[ce],Xr=ce<w.length-1?[].concat(kt(w[ce+1]),[(je=M[ce+1][2])!==null&&je!==void 0?je:0]):null,Rn=ce<M.length-1?M[ce+1]:null;J+=this.segment_gaode2(O,J,Ze,xr,Xr,Qt,Fr,Rn)}if(this.dash)for(var Cn=0;Cn<O.positions.length/6;Cn++)O.positions[6*Cn+5]=this.totalDistance;return O.startIndex=O.positions.length/6,O}},{key:"simpleExtrude_gaode2",value:function(w,M){var O=this.complex;if(w.length<=1)return O;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var B=w.length,J=O.startIndex,ce=1;ce<B;ce++){var se,De,je,Ze=w[ce-1];Ze.push((se=M[ce-1][2])!==null&&se!==void 0?se:0);var Qt=M[ce-1],xr=w[ce];xr.push((De=M[ce][2])!==null&&De!==void 0?De:0);var Fr=M[ce],Xr=ce<w.length-1?[].concat(kt(w[ce+1]),[(je=M[ce+1][2])!==null&&je!==void 0?je:0]):null,Rn=ce<M.length-1?M[ce+1]:null;J+=this.simpleSegment(O,J,Ze,xr,Xr,Qt,Fr,Rn)}if(this.dash)for(var Cn=0;Cn<O.positions.length/6;Cn++)O.positions[6*Cn+5]=this.totalDistance;return O.startIndex=O.positions.length/6,O}},{key:"extrude",value:function(w){var M=this.complex;if(w.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var O=w.length,B=M.startIndex,J=1;J<O;J++){var ce=w[J-1],se=w[J],De=J<w.length-1?w[J+1]:null;B+=this.segment(M,B,ce,se,De)}if(this.dash)for(var je=0;je<M.positions.length/6;je++)M.positions[6*je+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"simpleExtrude",value:function(w){var M=this.complex;if(w.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var O=w.length,B=M.startIndex,J=1;J<O;J++){var ce=w[J-1],se=w[J],De=J<w.length-1?w[J+1]:null;B+=this.simpleSegment(M,B,ce,se,De)}if(this.dash)for(var je=0;je<M.positions.length/6;je++)M.positions[6*je+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"segment_gaode2",value:function(w,M,O,B,J,ce,se,De){var je=0,Ze=w.indices,Qt=w.positions,xr=w.normals,Fr=this.cap==="square",Xr=this.join==="bevel",Rn=Ed([se[0],se[1]]),Cn=Ed([ce[0],ce[1]]);Xd(Hu,B,O);var Fn=0;if(this.dash&&(Fn=this.lineSegmentDistance(Rn,Cn),this.totalDistance+=Fn),this.normal||(this.normal=vl(),Np(this.normal,Hu)),!this.started)if(this.started=!0,Fr){var vn=vl(),ri=vl();Rh(vn,this.normal,Hu),Rh(ri,this.normal,Hu),xr.push(ri[0],ri[1],0),xr.push(vn[0],vn[1],0),Qt.push(O[0],O[1],0|O[2],this.totalDistance-Fn,-this.thickness,0|O[2]),this.complex.indexes.push(this.currentIndex),Qt.push(O[0],O[1],0|O[2],this.totalDistance-Fn,this.thickness,0|O[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Qt,xr,O,this.normal,this.thickness,this.totalDistance-Fn);if(Ze.push(M+0,M+1,M+2),J){Tv(B,J)&&Rh(J,B,m0(J,Sv(J,B,O))),Xd(Bp,J,B);var xi=lr(wv(Wd,vl(),Hu,Bp,this.thickness),2),Eo=xi[0],uo=xi[1],ro=H0(Wd,this.normal)<0?-1:1,lo=Xr;!lo&&this.join==="miter"&&Eo>this.miterLimit&&(lo=!0),lo?(xr.push(this.normal[0],this.normal[1],0),xr.push(uo[0],uo[1],0),Qt.push(B[0],B[1],0|B[2],this.totalDistance,-this.thickness*ro,0|B[2]),this.complex.indexes.push(this.currentIndex),Qt.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness*ro,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Ze.push.apply(Ze,kt(this.lastFlip!==-ro?[M,M+2,M+3]:[M+2,M+1,M+3])),Ze.push(M+2,M+3,M+4),Np(W0,Bp),G0(this.normal,W0),xr.push(this.normal[0],this.normal[1],0),Qt.push(B[0],B[1],0|B[2],this.totalDistance,-this.thickness*ro,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,je+=3):(this.extrusions(Qt,xr,B,uo,Eo,this.totalDistance),Ze.push.apply(Ze,kt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),ro=-1,G0(this.normal,uo),je+=2),this.lastFlip=ro}else{if(Np(this.normal,Hu),Fr){var co=vl(),Kr=vl();Av(Kr,Hu,this.normal),Rh(co,Hu,this.normal),xr.push(Kr[0],Kr[1],0),xr.push(co[0],co[1],0),Qt.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness,0|B[2]),this.complex.indexes.push(this.currentIndex),Qt.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Qt,xr,B,this.normal,this.thickness,this.totalDistance);Ze.push.apply(Ze,kt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),je+=2}return je}},{key:"simpleSegment",value:function(w,M,O,B,J){var ce=0,se=w.indices,De=w.positions,je=w.normals,Ze=Ed([B[0],B[1]]),Qt=Ed([O[0],O[1]]);Xd(Hu,Ze,Qt);var xr=0;if(this.dash&&(xr=this.lineSegmentDistance(Ze,Qt),this.totalDistance+=xr),this.normal||(this.normal=vl(),Np(this.normal,Hu)),this.started||(this.started=!0,this.extrusions(De,je,O,this.normal,this.thickness,this.totalDistance-xr)),se.push(M+0,M+1,M+2),J){var Fr=Ed([J[0],J[1]]);Tv(Ze,Fr)&&Rh(Fr,Ze,m0(Fr,Sv(Fr,Ze,Qt))),Xd(Bp,Fr,Ze);var Xr=lr(wv(Wd,vl(),Hu,Bp,this.thickness),2),Rn=Xr[0],Cn=Xr[1];H0(Wd,this.normal),this.extrusions(De,je,B,Cn,Rn,this.totalDistance),se.push.apply(se,kt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),G0(this.normal,Cn),ce+=2,this.lastFlip=-1}else Np(this.normal,Hu),this.extrusions(De,je,B,this.normal,this.thickness,this.totalDistance),se.push.apply(se,kt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),ce+=2;return ce}},{key:"segment",value:function(w,M,O,B,J){var ce=0,se=w.indices,De=w.positions,je=w.normals,Ze=this.cap==="square",Qt=this.join==="bevel",xr=Ed([B[0],B[1]]),Fr=Ed([O[0],O[1]]);Xd(Hu,xr,Fr);var Xr=0;if(this.dash&&(Xr=this.lineSegmentDistance(xr,Fr),this.totalDistance+=Xr),this.normal||(this.normal=vl(),Np(this.normal,Hu)),!this.started)if(this.started=!0,Ze){var Rn=vl(),Cn=vl();Rh(Rn,this.normal,Hu),Rh(Cn,this.normal,Hu),je.push(Cn[0],Cn[1],0),je.push(Rn[0],Rn[1],0),De.push(O[0],O[1],0|O[2],this.totalDistance-Xr,-this.thickness,0|O[2]),this.complex.indexes.push(this.currentIndex),De.push(O[0],O[1],0|O[2],this.totalDistance-Xr,this.thickness,0|O[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(De,je,O,this.normal,this.thickness,this.totalDistance-Xr);if(se.push(M+0,M+1,M+2),J){var Fn=Ed([J[0],J[1]]);Tv(xr,Fn)&&Rh(Fn,xr,m0(Fn,Sv(Fn,xr,Fr))),Xd(Bp,Fn,xr);var vn=lr(wv(Wd,vl(),Hu,Bp,this.thickness),2),ri=vn[0],xi=vn[1],Eo=H0(Wd,this.normal)<0?-1:1,uo=Qt;!uo&&this.join==="miter"&&ri>this.miterLimit&&(uo=!0),uo?(je.push(this.normal[0],this.normal[1],0),je.push(xi[0],xi[1],0),De.push(B[0],B[1],0|B[2],this.totalDistance,-this.thickness*Eo,0|B[2]),this.complex.indexes.push(this.currentIndex),De.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness*Eo,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,se.push.apply(se,kt(this.lastFlip!==-Eo?[M,M+2,M+3]:[M+2,M+1,M+3])),se.push(M+2,M+3,M+4),Np(W0,Bp),G0(this.normal,W0),je.push(this.normal[0],this.normal[1],0),De.push(B[0],B[1],0|B[2],this.totalDistance,-this.thickness*Eo,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,ce+=3):(this.extrusions(De,je,B,xi,ri,this.totalDistance),se.push.apply(se,kt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Eo=-1,G0(this.normal,xi),ce+=2),this.lastFlip=Eo}else{if(Np(this.normal,Hu),Ze){var ro=vl(),lo=vl();Av(lo,Hu,this.normal),Rh(ro,Hu,this.normal),je.push(lo[0],lo[1],0),je.push(ro[0],ro[1],0),De.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness,0|B[2]),this.complex.indexes.push(this.currentIndex),De.push(B[0],B[1],0|B[2],this.totalDistance,this.thickness,0|B[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(De,je,B,this.normal,this.thickness,this.totalDistance);se.push.apply(se,kt(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),ce+=2}return ce}},{key:"extrusions",value:function(w,M,O,B,J,ce){M.push(B[0],B[1],0),M.push(B[0],B[1],0),w.push(O[0],O[1],0|O[2],ce,-J,0|O[2]),this.complex.indexes.push(this.currentIndex),w.push(O[0],O[1],0|O[2],ce,J,0|O[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(w,M){var O=M[0]-w[0],B=M[1]-w[1];return Math.sqrt(O*O+B*B)}}]),_}();function ng(_){var w=_.coordinates,M=_.originCoordinates,O=_.version,B=new rg({dash:!0,join:"bevel"});if(O==="GAODE2.x"){var J=w;Array.isArray(J[0][0])||(J=[w]);var ce=M;Array.isArray(ce[0][0])||(ce=[M]);for(var se=0;se<J.length;se++){var De=J[se],je=ce[se];B.extrude_gaode2(De,je)}}else{var Ze=w;Ze[0]&&!Array.isArray(Ze[0][0])&&(Ze=[w]),Ze.forEach(function(xr){B.extrude(xr)})}var Qt=B.complex;return{vertices:Qt.positions,indices:Qt.indices,normals:Qt.normals,indexes:Qt.indexes,size:6}}function ig(_){var w=function(M){if(lm(M[0]))return M;if(lm(M[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(lm(M[0][0][0])){var O=0,B=0,J=0;return M.forEach(function(ce){ce.forEach(function(se){O+=se[0],B+=se[1],J++})}),[O/J,B/J,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(_.coordinates);return{vertices:[].concat(kt(w),kt(w),kt(w),kt(w)),indices:[0,1,2,2,3,0],size:w.length}}function ag(_){var w=_.coordinates,M=yd.flatten(w),O=M.vertices,B=M.dimensions,J=M.holes;return{indices:yd(O,J,B),vertices:O,size:B}}var og=function(){var _=Re(Ne().mark(function w(M){var O,B,J,ce,se,De,je,Ze,Qt;return Ne().wrap(function(xr){for(;;)switch(xr.prev=xr.next){case 0:return O=M.descriptors,B=M.features,J=M.enablePicking,ce=M.iconMap,se={a_Color:B0,a_Position:N0,filter:u0,a_vertexId:z0,a_PickingColor:function(Fr,Xr){var Rn=Fr.id;return J?s0(Rn):[0,0,0]},a_DistanceAndIndex:function(Fr,Xr,Rn,Cn,Fn,vn){return vn===void 0?[Rn[3],10]:[Rn[3],vn]},a_Total_Distance:function(Fr,Xr,Rn,Cn){return[Rn[5]]},a_Size:function(Fr,Xr,Rn,Cn){var Fn=Fr.size,vn=Fn===void 0?1:Fn;return Array.isArray(vn)?[vn[0],vn[1]]:[vn,0]},a_Normal:function(Fr,Xr,Rn,Cn,Fn){return Fn},a_Miter:function(Fr,Xr,Rn,Cn){return[Rn[4]]},a_iconMapUV:function(Fr,Xr,Rn,Cn){var Fn=Fr.texture,vn=ce[Fn]||{x:0,y:0};return[vn.x,vn.y]}},De={sizePerElement:0,elements:[]},je=0,Ze=[],Qt=3,B.forEach(function(Fr,Xr){var Rn=ng(Fr),Cn=Rn.indices,Fn=Rn.vertices,vn=Rn.normals,ri=Rn.size,xi=Rn.indexes;Cn.forEach(function(lo){Ze.push(lo+je)}),Qt=ri;var Eo=Fn.length/ri;De.sizePerElement=Qt,De.elements.push({featureIdx:Xr,vertices:Fn,normals:vn,offset:je}),je+=Eo;for(var uo=function(lo){var co=(vn==null?void 0:vn.slice(3*lo,3*lo+3))||[],Kr=Fn.slice(lo*ri,lo*ri+ri),cn=0;xi&&xi[lo]!==void 0&&(cn=xi[lo]),O.forEach(function(Bi,qa){var xa;Bi&&se[Bi.name]&&(xa=Bi.buffer.data).push.apply(xa,kt(se[Bi.name](Fr,Xr,Kr,lo,co,cn)))})},ro=0;ro<Eo;ro++)uo(ro)}),xr.abrupt("return",{descriptors:O,featureLayout:De,indices:Ze});case 8:case"end":return xr.stop()}},w)}));return function(w){return _.apply(this,arguments)}}(),Ml={pointFill:function(){var _=Re(Ne().mark(function w(M){var O,B,J,ce,se,De,je,Ze,Qt;return Ne().wrap(function(xr){for(;;)switch(xr.prev=xr.next){case 0:return O=M.descriptors,B=M.features,J=M.enablePicking,ce=M.shape2d,se={a_Color:B0,a_Position:N0,filter:u0,a_vertexId:z0,a_PickingColor:function(Fr,Xr){var Rn=Fr.id;return J?s0(Rn):[0,0,0]},a_Shape:function(Fr,Xr,Rn,Cn){var Fn=Fr.shape,vn=Fn===void 0?2:Fn;return[ce.indexOf(vn)]},a_Extrude:function(Fr,Xr,Rn,Cn){var Fn=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],vn=Cn%4*3;return[Fn[vn],Fn[vn+1],Fn[vn+2]]},a_Size:function(Fr,Xr,Rn,Cn){var Fn=Fr.size,vn=Fn===void 0?5:Fn;return Array.isArray(vn)?[vn[0]]:[vn]}},De={sizePerElement:0,elements:[]},je=0,Ze=[],Qt=3,B.forEach(function(Fr,Xr){var Rn=ig(Fr),Cn=Rn.indices,Fn=Rn.vertices,vn=Rn.normals,ri=Rn.size;Cn.forEach(function(ro){Ze.push(ro+je)}),Qt=ri;var xi=Fn.length/ri;De.sizePerElement=Qt,De.elements.push({featureIdx:Xr,vertices:Fn,normals:vn,offset:je}),je+=xi;for(var Eo=function(ro){var lo=[],co=Fn.slice(ro*ri,ro*ri+ri);O.forEach(function(Kr,cn){var Bi;Kr&&se[Kr.name]&&(Bi=Kr.buffer.data).push.apply(Bi,kt(se[Kr.name](Fr,Xr,co,ro,lo,0)))})},uo=0;uo<xi;uo++)Eo(uo)}),xr.abrupt("return",{descriptors:O,featureLayout:De,indices:Ze});case 8:case"end":return xr.stop()}},w)}));return function(w){return _.apply(this,arguments)}}(),line:og,polygonFill:function(){var _=Re(Ne().mark(function w(M){var O,B,J,ce,se,De,je,Ze;return Ne().wrap(function(Qt){for(;;)switch(Qt.prev=Qt.next){case 0:return O=M.descriptors,B=M.features,J=M.enablePicking,ce={a_Color:B0,a_Position:N0,filter:u0,a_vertexId:z0,a_PickingColor:function(xr,Fr){var Xr=xr.id;return J?s0(Xr):[0,0,0]}},se={sizePerElement:0,elements:[]},De=0,je=[],Ze=3,B.forEach(function(xr,Fr){var Xr=ag(xr),Rn=Xr.indices,Cn=Xr.vertices,Fn=Xr.normals,vn=Xr.size;Rn.forEach(function(uo){je.push(uo+De)}),Ze=vn;var ri=Cn.length/vn;se.sizePerElement=Ze,se.elements.push({featureIdx:Fr,vertices:Cn,normals:Fn,offset:De}),De+=ri;for(var xi=function(uo){var ro=[],lo=Cn.slice(uo*vn,uo*vn+vn);O.forEach(function(co,Kr){var cn;co&&ce[co.name]&&(cn=co.buffer.data).push.apply(cn,kt(ce[co.name](xr,Fr,lo,uo,ro,0)))})},Eo=0;Eo<ri;Eo++)xi(Eo)}),Qt.abrupt("return",{descriptors:O,featureLayout:se,indices:je});case 8:case"end":return Qt.stop()}},w)}));return function(w){return _.apply(this,arguments)}}()},pm=function(_){for(var w=1;w<arguments.length;w++){var M=arguments[w]!=null?arguments[w]:{};w%2?y(Object(M),!0).forEach(function(O){Xe(_,O,M[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(M)):y(Object(M)).forEach(function(O){Object.defineProperty(_,O,Object.getOwnPropertyDescriptor(M,O))})}return _}({},Ml);function dm(_){return vm.apply(this,arguments)}function vm(){return(vm=Re(Ne().mark(function _(w){var M,O;return Ne().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(M=w.workerType,O=w.data,!pm[M]){B.next=3;break}return B.abrupt("return",pm[M](O));case 3:return B.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(M,'" non-existent.'))));case 4:case"end":return B.stop()}},_)}))).apply(this,arguments)}return te(dm),de.WorkerSourceMap=Ml,de.createWorker=te,de.worker=dm,de}({})},66213:function(hi,Ae,fe){"use strict";fe.d(Ae,{Z:function(){return y}});var We=fe(77608);function de(Ne,K){for(;!Object.prototype.hasOwnProperty.call(Ne,K)&&(Ne=(0,We.Z)(Ne),Ne!==null););return Ne}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(K,Re,pe){var lt=de(K,Re);if(!!lt){var we=Object.getOwnPropertyDescriptor(lt,Re);return we.get?we.get.call(arguments.length<3?K:pe):we.value}},y.apply(this,arguments)}},38163:function(hi){hi.exports=Ae;function Ae(de,y){var Ne=de&&de.type,K;if(Ne==="FeatureCollection")for(K=0;K<de.features.length;K++)Ae(de.features[K],y);else if(Ne==="GeometryCollection")for(K=0;K<de.geometries.length;K++)Ae(de.geometries[K],y);else if(Ne==="Feature")Ae(de.geometry,y);else if(Ne==="Polygon")fe(de.coordinates,y);else if(Ne==="MultiPolygon")for(K=0;K<de.coordinates.length;K++)fe(de.coordinates[K],y);return de}function fe(de,y){if(de.length!==0){We(de[0],y);for(var Ne=1;Ne<de.length;Ne++)We(de[Ne],!y)}}function We(de,y){for(var Ne=0,K=0,Re=0,pe=de.length,lt=pe-1;Re<pe;lt=Re++){var we=(de[Re][0]-de[lt][0])*(de[lt][1]+de[Re][1]),Xe=Ne+we;K+=Math.abs(Ne)>=Math.abs(we)?Ne-Xe+we:we-Xe+Ne,Ne=Xe}Ne+K>=0!=!!y&&de.reverse()}},75550:function(hi){"use strict";hi.exports=Ae;function Ae(fe,We){this.x=fe,this.y=We}Ae.prototype={clone:function(){return new Ae(this.x,this.y)},add:function(fe){return this.clone()._add(fe)},sub:function(fe){return this.clone()._sub(fe)},multByPoint:function(fe){return this.clone()._multByPoint(fe)},divByPoint:function(fe){return this.clone()._divByPoint(fe)},mult:function(fe){return this.clone()._mult(fe)},div:function(fe){return this.clone()._div(fe)},rotate:function(fe){return this.clone()._rotate(fe)},rotateAround:function(fe,We){return this.clone()._rotateAround(fe,We)},matMult:function(fe){return this.clone()._matMult(fe)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(fe){return this.x===fe.x&&this.y===fe.y},dist:function(fe){return Math.sqrt(this.distSqr(fe))},distSqr:function(fe){var We=fe.x-this.x,de=fe.y-this.y;return We*We+de*de},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(fe){return Math.atan2(this.y-fe.y,this.x-fe.x)},angleWith:function(fe){return this.angleWithSep(fe.x,fe.y)},angleWithSep:function(fe,We){return Math.atan2(this.x*We-this.y*fe,this.x*fe+this.y*We)},_matMult:function(fe){var We=fe[0]*this.x+fe[1]*this.y,de=fe[2]*this.x+fe[3]*this.y;return this.x=We,this.y=de,this},_add:function(fe){return this.x+=fe.x,this.y+=fe.y,this},_sub:function(fe){return this.x-=fe.x,this.y-=fe.y,this},_mult:function(fe){return this.x*=fe,this.y*=fe,this},_div:function(fe){return this.x/=fe,this.y/=fe,this},_multByPoint:function(fe){return this.x*=fe.x,this.y*=fe.y,this},_divByPoint:function(fe){return this.x/=fe.x,this.y/=fe.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var fe=this.y;return this.y=this.x,this.x=-fe,this},_rotate:function(fe){var We=Math.cos(fe),de=Math.sin(fe),y=We*this.x-de*this.y,Ne=de*this.x+We*this.y;return this.x=y,this.y=Ne,this},_rotateAround:function(fe,We){var de=Math.cos(fe),y=Math.sin(fe),Ne=We.x+de*(this.x-We.x)-y*(this.y-We.y),K=We.y+y*(this.x-We.x)+de*(this.y-We.y);return this.x=Ne,this.y=K,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ae.convert=function(fe){return fe instanceof Ae?fe:Array.isArray(fe)?new Ae(fe[0],fe[1]):fe}},38929:function(hi,Ae,fe){hi.exports.VectorTile=fe(22779),fe(66024),fe(59701)},22779:function(hi,Ae,fe){"use strict";var We=fe(59701);hi.exports=de;function de(Ne,K){this.layers=Ne.readFields(y,{},K)}function y(Ne,K,Re){if(Ne===3){var pe=new We(Re,Re.readVarint()+Re.pos);pe.length&&(K[pe.name]=pe)}}},66024:function(hi,Ae,fe){"use strict";var We=fe(75550);hi.exports=de;function de(pe,lt,we,Xe,Ct){this.properties={},this.extent=we,this.type=0,this._pbf=pe,this._geometry=-1,this._keys=Xe,this._values=Ct,pe.readFields(y,this,lt)}function y(pe,lt,we){pe==1?lt.id=we.readVarint():pe==2?Ne(we,lt):pe==3?lt.type=we.readVarint():pe==4&&(lt._geometry=we.pos)}function Ne(pe,lt){for(var we=pe.readVarint()+pe.pos;pe.pos<we;){var Xe=lt._keys[pe.readVarint()],Ct=lt._values[pe.readVarint()];lt.properties[Xe]=Ct}}de.types=["Unknown","Point","LineString","Polygon"],de.prototype.loadGeometry=function(){var pe=this._pbf;pe.pos=this._geometry;for(var lt=pe.readVarint()+pe.pos,we=1,Xe=0,Ct=0,Pt=0,tr=[],Yt;pe.pos<lt;){if(Xe<=0){var Wt=pe.readVarint();we=Wt&7,Xe=Wt>>3}if(Xe--,we===1||we===2)Ct+=pe.readSVarint(),Pt+=pe.readSVarint(),we===1&&(Yt&&tr.push(Yt),Yt=[]),Yt.push(new We(Ct,Pt));else if(we===7)Yt&&Yt.push(Yt[0].clone());else throw new Error("unknown command "+we)}return Yt&&tr.push(Yt),tr},de.prototype.bbox=function(){var pe=this._pbf;pe.pos=this._geometry;for(var lt=pe.readVarint()+pe.pos,we=1,Xe=0,Ct=0,Pt=0,tr=Infinity,Yt=-Infinity,Wt=Infinity,br=-Infinity;pe.pos<lt;){if(Xe<=0){var lr=pe.readVarint();we=lr&7,Xe=lr>>3}if(Xe--,we===1||we===2)Ct+=pe.readSVarint(),Pt+=pe.readSVarint(),Ct<tr&&(tr=Ct),Ct>Yt&&(Yt=Ct),Pt<Wt&&(Wt=Pt),Pt>br&&(br=Pt);else if(we!==7)throw new Error("unknown command "+we)}return[tr,Wt,Yt,br]},de.prototype.toGeoJSON=function(pe,lt,we){var Xe=this.extent*Math.pow(2,we),Ct=this.extent*pe,Pt=this.extent*lt,tr=this.loadGeometry(),Yt=de.types[this.type],Wt,br;function lr(Pr){for(var re=0;re<Pr.length;re++){var yr=Pr[re],Rt=180-(yr.y+Pt)*360/Xe;Pr[re]=[(yr.x+Ct)*360/Xe-180,360/Math.PI*Math.atan(Math.exp(Rt*Math.PI/180))-90]}}switch(this.type){case 1:var kt=[];for(Wt=0;Wt<tr.length;Wt++)kt[Wt]=tr[Wt][0];tr=kt,lr(tr);break;case 2:for(Wt=0;Wt<tr.length;Wt++)lr(tr[Wt]);break;case 3:for(tr=K(tr),Wt=0;Wt<tr.length;Wt++)for(br=0;br<tr[Wt].length;br++)lr(tr[Wt][br]);break}tr.length===1?tr=tr[0]:Yt="Multi"+Yt;var zt={type:"Feature",geometry:{type:Yt,coordinates:tr},properties:this.properties};return"id"in this&&(zt.id=this.id),zt};function K(pe){var lt=pe.length;if(lt<=1)return[pe];for(var we=[],Xe,Ct,Pt=0;Pt<lt;Pt++){var tr=Re(pe[Pt]);tr!==0&&(Ct===void 0&&(Ct=tr<0),Ct===tr<0?(Xe&&we.push(Xe),Xe=[pe[Pt]]):Xe.push(pe[Pt]))}return Xe&&we.push(Xe),we}function Re(pe){for(var lt=0,we=0,Xe=pe.length,Ct=Xe-1,Pt,tr;we<Xe;Ct=we++)Pt=pe[we],tr=pe[Ct],lt+=(tr.x-Pt.x)*(Pt.y+tr.y);return lt}},59701:function(hi,Ae,fe){"use strict";var We=fe(66024);hi.exports=de;function de(K,Re){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=K,this._keys=[],this._values=[],this._features=[],K.readFields(y,this,Re),this.length=this._features.length}function y(K,Re,pe){K===15?Re.version=pe.readVarint():K===1?Re.name=pe.readString():K===5?Re.extent=pe.readVarint():K===2?Re._features.push(pe.pos):K===3?Re._keys.push(pe.readString()):K===4&&Re._values.push(Ne(pe))}function Ne(K){for(var Re=null,pe=K.readVarint()+K.pos;K.pos<pe;){var lt=K.readVarint()>>3;Re=lt===1?K.readString():lt===2?K.readFloat():lt===3?K.readDouble():lt===4?K.readVarint64():lt===5?K.readVarint():lt===6?K.readSVarint():lt===7?K.readBoolean():null}return Re}de.prototype.feature=function(K){if(K<0||K>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[K];var Re=this._pbf.readVarint()+this._pbf.pos;return new We(this._pbf,Re,this.extent,this._keys,this._values)}},53645:function(){},9187:function(hi){"use strict";hi.exports=Ae,hi.exports.default=Ae;function Ae(Z,_e,ze){ze=ze||2;var St=_e&&_e.length,Ut=St?_e[0]*ze:Z.length,cr=fe(Z,0,Ut,ze,!0),wt=[];if(!cr||cr.next===cr.prev)return wt;var Or,Xn,Qr,Pi,mi,ln,ba;if(St&&(cr=pe(Z,_e,cr,ze)),Z.length>80*ze){Or=Qr=Z[0],Xn=Pi=Z[1];for(var ua=ze;ua<Ut;ua+=ze)mi=Z[ua],ln=Z[ua+1],mi<Or&&(Or=mi),ln<Xn&&(Xn=ln),mi>Qr&&(Qr=mi),ln>Pi&&(Pi=ln);ba=Math.max(Qr-Or,Pi-Xn),ba=ba!==0?32767/ba:0}return de(cr,wt,ze,Or,Xn,ba,0),wt}function fe(Z,_e,ze,St,Ut){var cr,wt;if(Ut===rt(Z,_e,ze,St)>0)for(cr=_e;cr<ze;cr+=St)wt=Er(cr,Z[cr],Z[cr+1],wt);else for(cr=ze-St;cr>=_e;cr-=St)wt=Er(cr,Z[cr],Z[cr+1],wt);return wt&&zt(wt,wt.next)&&(an(wt),wt=wt.next),wt}function We(Z,_e){if(!Z)return Z;_e||(_e=Z);var ze=Z,St;do if(St=!1,!ze.steiner&&(zt(ze,ze.next)||kt(ze.prev,ze,ze.next)===0)){if(an(ze),ze=_e=ze.prev,ze===ze.next)break;St=!0}else ze=ze.next;while(St||ze!==_e);return _e}function de(Z,_e,ze,St,Ut,cr,wt){if(!!Z){!wt&&cr&&Pt(Z,St,Ut,cr);for(var Or=Z,Xn,Qr;Z.prev!==Z.next;){if(Xn=Z.prev,Qr=Z.next,cr?Ne(Z,St,Ut,cr):y(Z)){_e.push(Xn.i/ze|0),_e.push(Z.i/ze|0),_e.push(Qr.i/ze|0),an(Z),Z=Qr.next,Or=Qr.next;continue}if(Z=Qr,Z===Or){wt?wt===1?(Z=K(We(Z),_e,ze),de(Z,_e,ze,St,Ut,cr,2)):wt===2&&Re(Z,_e,ze,St,Ut,cr):de(We(Z),_e,ze,St,Ut,cr,1);break}}}}function y(Z){var _e=Z.prev,ze=Z,St=Z.next;if(kt(_e,ze,St)>=0)return!1;for(var Ut=_e.x,cr=ze.x,wt=St.x,Or=_e.y,Xn=ze.y,Qr=St.y,Pi=Ut<cr?Ut<wt?Ut:wt:cr<wt?cr:wt,mi=Or<Xn?Or<Qr?Or:Qr:Xn<Qr?Xn:Qr,ln=Ut>cr?Ut>wt?Ut:wt:cr>wt?cr:wt,ba=Or>Xn?Or>Qr?Or:Qr:Xn>Qr?Xn:Qr,ua=St.next;ua!==_e;){if(ua.x>=Pi&&ua.x<=ln&&ua.y>=mi&&ua.y<=ba&&br(Ut,Or,cr,Xn,wt,Qr,ua.x,ua.y)&&kt(ua.prev,ua,ua.next)>=0)return!1;ua=ua.next}return!0}function Ne(Z,_e,ze,St){var Ut=Z.prev,cr=Z,wt=Z.next;if(kt(Ut,cr,wt)>=0)return!1;for(var Or=Ut.x,Xn=cr.x,Qr=wt.x,Pi=Ut.y,mi=cr.y,ln=wt.y,ba=Or<Xn?Or<Qr?Or:Qr:Xn<Qr?Xn:Qr,ua=Pi<mi?Pi<ln?Pi:ln:mi<ln?mi:ln,Li=Or>Xn?Or>Qr?Or:Qr:Xn>Qr?Xn:Qr,Ma=Pi>mi?Pi>ln?Pi:ln:mi>ln?mi:ln,ai=Yt(ba,ua,_e,ze,St),Ki=Yt(Li,Ma,_e,ze,St),ci=Z.prevZ,gi=Z.nextZ;ci&&ci.z>=ai&&gi&&gi.z<=Ki;){if(ci.x>=ba&&ci.x<=Li&&ci.y>=ua&&ci.y<=Ma&&ci!==Ut&&ci!==wt&&br(Or,Pi,Xn,mi,Qr,ln,ci.x,ci.y)&&kt(ci.prev,ci,ci.next)>=0||(ci=ci.prevZ,gi.x>=ba&&gi.x<=Li&&gi.y>=ua&&gi.y<=Ma&&gi!==Ut&&gi!==wt&&br(Or,Pi,Xn,mi,Qr,ln,gi.x,gi.y)&&kt(gi.prev,gi,gi.next)>=0))return!1;gi=gi.nextZ}for(;ci&&ci.z>=ai;){if(ci.x>=ba&&ci.x<=Li&&ci.y>=ua&&ci.y<=Ma&&ci!==Ut&&ci!==wt&&br(Or,Pi,Xn,mi,Qr,ln,ci.x,ci.y)&&kt(ci.prev,ci,ci.next)>=0)return!1;ci=ci.prevZ}for(;gi&&gi.z<=Ki;){if(gi.x>=ba&&gi.x<=Li&&gi.y>=ua&&gi.y<=Ma&&gi!==Ut&&gi!==wt&&br(Or,Pi,Xn,mi,Qr,ln,gi.x,gi.y)&&kt(gi.prev,gi,gi.next)>=0)return!1;gi=gi.nextZ}return!0}function K(Z,_e,ze){var St=Z;do{var Ut=St.prev,cr=St.next.next;!zt(Ut,cr)&&Pr(Ut,St,St.next,cr)&&_t(Ut,cr)&&_t(cr,Ut)&&(_e.push(Ut.i/ze|0),_e.push(St.i/ze|0),_e.push(cr.i/ze|0),an(St),an(St.next),St=Z=cr),St=St.next}while(St!==Z);return We(St)}function Re(Z,_e,ze,St,Ut,cr){var wt=Z;do{for(var Or=wt.next.next;Or!==wt.prev;){if(wt.i!==Or.i&&lr(wt,Or)){var Xn=Ue(wt,Or);wt=We(wt,wt.next),Xn=We(Xn,Xn.next),de(wt,_e,ze,St,Ut,cr,0),de(Xn,_e,ze,St,Ut,cr,0);return}Or=Or.next}wt=wt.next}while(wt!==Z)}function pe(Z,_e,ze,St){var Ut=[],cr,wt,Or,Xn,Qr;for(cr=0,wt=_e.length;cr<wt;cr++)Or=_e[cr]*St,Xn=cr<wt-1?_e[cr+1]*St:Z.length,Qr=fe(Z,Or,Xn,St,!1),Qr===Qr.next&&(Qr.steiner=!0),Ut.push(Wt(Qr));for(Ut.sort(lt),cr=0;cr<Ut.length;cr++)ze=we(Ut[cr],ze);return ze}function lt(Z,_e){return Z.x-_e.x}function we(Z,_e){var ze=Xe(Z,_e);if(!ze)return _e;var St=Ue(ze,Z);return We(St,St.next),We(ze,ze.next)}function Xe(Z,_e){var ze=_e,St=Z.x,Ut=Z.y,cr=-Infinity,wt;do{if(Ut<=ze.y&&Ut>=ze.next.y&&ze.next.y!==ze.y){var Or=ze.x+(Ut-ze.y)*(ze.next.x-ze.x)/(ze.next.y-ze.y);if(Or<=St&&Or>cr&&(cr=Or,wt=ze.x<ze.next.x?ze:ze.next,Or===St))return wt}ze=ze.next}while(ze!==_e);if(!wt)return null;var Xn=wt,Qr=wt.x,Pi=wt.y,mi=Infinity,ln;ze=wt;do St>=ze.x&&ze.x>=Qr&&St!==ze.x&&br(Ut<Pi?St:cr,Ut,Qr,Pi,Ut<Pi?cr:St,Ut,ze.x,ze.y)&&(ln=Math.abs(Ut-ze.y)/(St-ze.x),_t(ze,Z)&&(ln<mi||ln===mi&&(ze.x>wt.x||ze.x===wt.x&&Ct(wt,ze)))&&(wt=ze,mi=ln)),ze=ze.next;while(ze!==Xn);return wt}function Ct(Z,_e){return kt(Z.prev,Z,_e.prev)<0&&kt(_e.next,Z,Z.next)<0}function Pt(Z,_e,ze,St){var Ut=Z;do Ut.z===0&&(Ut.z=Yt(Ut.x,Ut.y,_e,ze,St)),Ut.prevZ=Ut.prev,Ut.nextZ=Ut.next,Ut=Ut.next;while(Ut!==Z);Ut.prevZ.nextZ=null,Ut.prevZ=null,tr(Ut)}function tr(Z){var _e,ze,St,Ut,cr,wt,Or,Xn,Qr=1;do{for(ze=Z,Z=null,cr=null,wt=0;ze;){for(wt++,St=ze,Or=0,_e=0;_e<Qr&&(Or++,St=St.nextZ,!!St);_e++);for(Xn=Qr;Or>0||Xn>0&&St;)Or!==0&&(Xn===0||!St||ze.z<=St.z)?(Ut=ze,ze=ze.nextZ,Or--):(Ut=St,St=St.nextZ,Xn--),cr?cr.nextZ=Ut:Z=Ut,Ut.prevZ=cr,cr=Ut;ze=St}cr.nextZ=null,Qr*=2}while(wt>1);return Z}function Yt(Z,_e,ze,St,Ut){return Z=(Z-ze)*Ut|0,_e=(_e-St)*Ut|0,Z=(Z|Z<<8)&16711935,Z=(Z|Z<<4)&252645135,Z=(Z|Z<<2)&858993459,Z=(Z|Z<<1)&1431655765,_e=(_e|_e<<8)&16711935,_e=(_e|_e<<4)&252645135,_e=(_e|_e<<2)&858993459,_e=(_e|_e<<1)&1431655765,Z|_e<<1}function Wt(Z){var _e=Z,ze=Z;do(_e.x<ze.x||_e.x===ze.x&&_e.y<ze.y)&&(ze=_e),_e=_e.next;while(_e!==Z);return ze}function br(Z,_e,ze,St,Ut,cr,wt,Or){return(Ut-wt)*(_e-Or)>=(Z-wt)*(cr-Or)&&(Z-wt)*(St-Or)>=(ze-wt)*(_e-Or)&&(ze-wt)*(cr-Or)>=(Ut-wt)*(St-Or)}function lr(Z,_e){return Z.next.i!==_e.i&&Z.prev.i!==_e.i&&!Rt(Z,_e)&&(_t(Z,_e)&&_t(_e,Z)&&Kt(Z,_e)&&(kt(Z.prev,Z,_e.prev)||kt(Z,_e.prev,_e))||zt(Z,_e)&&kt(Z.prev,Z,Z.next)>0&&kt(_e.prev,_e,_e.next)>0)}function kt(Z,_e,ze){return(_e.y-Z.y)*(ze.x-_e.x)-(_e.x-Z.x)*(ze.y-_e.y)}function zt(Z,_e){return Z.x===_e.x&&Z.y===_e.y}function Pr(Z,_e,ze,St){var Ut=yr(kt(Z,_e,ze)),cr=yr(kt(Z,_e,St)),wt=yr(kt(ze,St,Z)),Or=yr(kt(ze,St,_e));return!!(Ut!==cr&&wt!==Or||Ut===0&&re(Z,ze,_e)||cr===0&&re(Z,St,_e)||wt===0&&re(ze,Z,St)||Or===0&&re(ze,_e,St))}function re(Z,_e,ze){return _e.x<=Math.max(Z.x,ze.x)&&_e.x>=Math.min(Z.x,ze.x)&&_e.y<=Math.max(Z.y,ze.y)&&_e.y>=Math.min(Z.y,ze.y)}function yr(Z){return Z>0?1:Z<0?-1:0}function Rt(Z,_e){var ze=Z;do{if(ze.i!==Z.i&&ze.next.i!==Z.i&&ze.i!==_e.i&&ze.next.i!==_e.i&&Pr(ze,ze.next,Z,_e))return!0;ze=ze.next}while(ze!==Z);return!1}function _t(Z,_e){return kt(Z.prev,Z,Z.next)<0?kt(Z,_e,Z.next)>=0&&kt(Z,Z.prev,_e)>=0:kt(Z,_e,Z.prev)<0||kt(Z,Z.next,_e)<0}function Kt(Z,_e){var ze=Z,St=!1,Ut=(Z.x+_e.x)/2,cr=(Z.y+_e.y)/2;do ze.y>cr!=ze.next.y>cr&&ze.next.y!==ze.y&&Ut<(ze.next.x-ze.x)*(cr-ze.y)/(ze.next.y-ze.y)+ze.x&&(St=!St),ze=ze.next;while(ze!==Z);return St}function Ue(Z,_e){var ze=new ue(Z.i,Z.x,Z.y),St=new ue(_e.i,_e.x,_e.y),Ut=Z.next,cr=_e.prev;return Z.next=_e,_e.prev=Z,ze.next=Ut,Ut.prev=ze,St.next=ze,ze.prev=St,cr.next=St,St.prev=cr,St}function Er(Z,_e,ze,St){var Ut=new ue(Z,_e,ze);return St?(Ut.next=St.next,Ut.prev=St,St.next.prev=Ut,St.next=Ut):(Ut.prev=Ut,Ut.next=Ut),Ut}function an(Z){Z.next.prev=Z.prev,Z.prev.next=Z.next,Z.prevZ&&(Z.prevZ.nextZ=Z.nextZ),Z.nextZ&&(Z.nextZ.prevZ=Z.prevZ)}function ue(Z,_e,ze){this.i=Z,this.x=_e,this.y=ze,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ae.deviation=function(Z,_e,ze,St){var Ut=_e&&_e.length,cr=Ut?_e[0]*ze:Z.length,wt=Math.abs(rt(Z,0,cr,ze));if(Ut)for(var Or=0,Xn=_e.length;Or<Xn;Or++){var Qr=_e[Or]*ze,Pi=Or<Xn-1?_e[Or+1]*ze:Z.length;wt-=Math.abs(rt(Z,Qr,Pi,ze))}var mi=0;for(Or=0;Or<St.length;Or+=3){var ln=St[Or]*ze,ba=St[Or+1]*ze,ua=St[Or+2]*ze;mi+=Math.abs((Z[ln]-Z[ua])*(Z[ba+1]-Z[ln+1])-(Z[ln]-Z[ba])*(Z[ua+1]-Z[ln+1]))}return wt===0&&mi===0?0:Math.abs((mi-wt)/wt)};function rt(Z,_e,ze,St){for(var Ut=0,cr=_e,wt=ze-St;cr<ze;cr+=St)Ut+=(Z[wt]-Z[cr])*(Z[cr+1]+Z[wt+1]),wt=cr;return Ut}Ae.flatten=function(Z){for(var _e=Z[0][0].length,ze={vertices:[],holes:[],dimensions:_e},St=0,Ut=0;Ut<Z.length;Ut++){for(var cr=0;cr<Z[Ut].length;cr++)for(var wt=0;wt<_e;wt++)ze.vertices.push(Z[Ut][cr][wt]);Ut>0&&(St+=Z[Ut-1].length,ze.holes.push(St))}return ze}},67709:function(hi){function Ae(We){var de=We.target||We.srcElement;de.__resizeRAF__&&cancelAnimationFrame(de.__resizeRAF__),de.__resizeRAF__=requestAnimationFrame(function(){var y=de.__resizeTrigger__,Ne=y&&y.__resizeListeners__;Ne&&Ne.forEach(function(K){K.call(y,We)})})}var fe=function(de,y){var Ne=this,K=Ne.document,Re,pe=K.attachEvent;typeof navigator!="undefined"&&(Re=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function lt(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Ae)}if(!de.__resizeListeners__)if(de.__resizeListeners__=[],pe)de.__resizeTrigger__=de,de.attachEvent("onresize",Ae);else{getComputedStyle(de).position==="static"&&(de.style.position="relative");var we=de.__resizeTrigger__=K.createElement("object");we.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),we.setAttribute("class","resize-sensor"),we.setAttribute("tabindex","-1"),we.setAttribute("title",""),we.__resizeElement__=de,we.onload=lt,we.type="text/html",Re&&de.appendChild(we),we.data="about:blank",Re||de.appendChild(we)}de.__resizeListeners__.push(y)};hi.exports=typeof window=="undefined"?fe:fe.bind(window),hi.exports.unbind=function(We,de){var y=document.attachEvent,Ne=We.__resizeListeners__||[];if(de){var K=Ne.indexOf(de);K!==-1&&Ne.splice(K,1)}else Ne=We.__resizeListeners__=[];if(!Ne.length){if(y)We.detachEvent("onresize",Ae);else if(We.__resizeTrigger__){var Re=We.__resizeTrigger__.contentDocument,pe=Re&&Re.defaultView;pe&&(pe.removeEventListener("resize",Ae),delete pe.__resizeTrigger__),We.__resizeTrigger__=!We.removeChild(We.__resizeTrigger__)}delete We.__resizeListeners__}}},26729:function(hi){"use strict";var Ae=Object.prototype.hasOwnProperty,fe="~";function We(){}Object.create&&(We.prototype=Object.create(null),new We().__proto__||(fe=!1));function de(Re,pe,lt){this.fn=Re,this.context=pe,this.once=lt||!1}function y(Re,pe,lt,we,Xe){if(typeof lt!="function")throw new TypeError("The listener must be a function");var Ct=new de(lt,we||Re,Xe),Pt=fe?fe+pe:pe;return Re._events[Pt]?Re._events[Pt].fn?Re._events[Pt]=[Re._events[Pt],Ct]:Re._events[Pt].push(Ct):(Re._events[Pt]=Ct,Re._eventsCount++),Re}function Ne(Re,pe){--Re._eventsCount==0?Re._events=new We:delete Re._events[pe]}function K(){this._events=new We,this._eventsCount=0}K.prototype.eventNames=function(){var pe=[],lt,we;if(this._eventsCount===0)return pe;for(we in lt=this._events)Ae.call(lt,we)&&pe.push(fe?we.slice(1):we);return Object.getOwnPropertySymbols?pe.concat(Object.getOwnPropertySymbols(lt)):pe},K.prototype.listeners=function(pe){var lt=fe?fe+pe:pe,we=this._events[lt];if(!we)return[];if(we.fn)return[we.fn];for(var Xe=0,Ct=we.length,Pt=new Array(Ct);Xe<Ct;Xe++)Pt[Xe]=we[Xe].fn;return Pt},K.prototype.listenerCount=function(pe){var lt=fe?fe+pe:pe,we=this._events[lt];return we?we.fn?1:we.length:0},K.prototype.emit=function(pe,lt,we,Xe,Ct,Pt){var tr=fe?fe+pe:pe;if(!this._events[tr])return!1;var Yt=this._events[tr],Wt=arguments.length,br,lr;if(Yt.fn){switch(Yt.once&&this.removeListener(pe,Yt.fn,void 0,!0),Wt){case 1:return Yt.fn.call(Yt.context),!0;case 2:return Yt.fn.call(Yt.context,lt),!0;case 3:return Yt.fn.call(Yt.context,lt,we),!0;case 4:return Yt.fn.call(Yt.context,lt,we,Xe),!0;case 5:return Yt.fn.call(Yt.context,lt,we,Xe,Ct),!0;case 6:return Yt.fn.call(Yt.context,lt,we,Xe,Ct,Pt),!0}for(lr=1,br=new Array(Wt-1);lr<Wt;lr++)br[lr-1]=arguments[lr];Yt.fn.apply(Yt.context,br)}else{var kt=Yt.length,zt;for(lr=0;lr<kt;lr++)switch(Yt[lr].once&&this.removeListener(pe,Yt[lr].fn,void 0,!0),Wt){case 1:Yt[lr].fn.call(Yt[lr].context);break;case 2:Yt[lr].fn.call(Yt[lr].context,lt);break;case 3:Yt[lr].fn.call(Yt[lr].context,lt,we);break;case 4:Yt[lr].fn.call(Yt[lr].context,lt,we,Xe);break;default:if(!br)for(zt=1,br=new Array(Wt-1);zt<Wt;zt++)br[zt-1]=arguments[zt];Yt[lr].fn.apply(Yt[lr].context,br)}}return!0},K.prototype.on=function(pe,lt,we){return y(this,pe,lt,we,!1)},K.prototype.once=function(pe,lt,we){return y(this,pe,lt,we,!0)},K.prototype.removeListener=function(pe,lt,we,Xe){var Ct=fe?fe+pe:pe;if(!this._events[Ct])return this;if(!lt)return Ne(this,Ct),this;var Pt=this._events[Ct];if(Pt.fn)Pt.fn===lt&&(!Xe||Pt.once)&&(!we||Pt.context===we)&&Ne(this,Ct);else{for(var tr=0,Yt=[],Wt=Pt.length;tr<Wt;tr++)(Pt[tr].fn!==lt||Xe&&!Pt[tr].once||we&&Pt[tr].context!==we)&&Yt.push(Pt[tr]);Yt.length?this._events[Ct]=Yt.length===1?Yt[0]:Yt:Ne(this,Ct)}return this},K.prototype.removeAllListeners=function(pe){var lt;return pe?(lt=fe?fe+pe:pe,this._events[lt]&&Ne(this,lt)):(this._events=new We,this._eventsCount=0),this},K.prototype.off=K.prototype.removeListener,K.prototype.addListener=K.prototype.on,K.prefixed=fe,K.EventEmitter=K,hi.exports=K},80645:function(hi,Ae){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ae.read=function(fe,We,de,y,Ne){var K,Re,pe=Ne*8-y-1,lt=(1<<pe)-1,we=lt>>1,Xe=-7,Ct=de?Ne-1:0,Pt=de?-1:1,tr=fe[We+Ct];for(Ct+=Pt,K=tr&(1<<-Xe)-1,tr>>=-Xe,Xe+=pe;Xe>0;K=K*256+fe[We+Ct],Ct+=Pt,Xe-=8);for(Re=K&(1<<-Xe)-1,K>>=-Xe,Xe+=y;Xe>0;Re=Re*256+fe[We+Ct],Ct+=Pt,Xe-=8);if(K===0)K=1-we;else{if(K===lt)return Re?NaN:(tr?-1:1)*Infinity;Re=Re+Math.pow(2,y),K=K-we}return(tr?-1:1)*Re*Math.pow(2,K-y)},Ae.write=function(fe,We,de,y,Ne,K){var Re,pe,lt,we=K*8-Ne-1,Xe=(1<<we)-1,Ct=Xe>>1,Pt=Ne===23?Math.pow(2,-24)-Math.pow(2,-77):0,tr=y?0:K-1,Yt=y?1:-1,Wt=We<0||We===0&&1/We<0?1:0;for(We=Math.abs(We),isNaN(We)||We===Infinity?(pe=isNaN(We)?1:0,Re=Xe):(Re=Math.floor(Math.log(We)/Math.LN2),We*(lt=Math.pow(2,-Re))<1&&(Re--,lt*=2),Re+Ct>=1?We+=Pt/lt:We+=Pt*Math.pow(2,1-Ct),We*lt>=2&&(Re++,lt/=2),Re+Ct>=Xe?(pe=0,Re=Xe):Re+Ct>=1?(pe=(We*lt-1)*Math.pow(2,Ne),Re=Re+Ct):(pe=We*Math.pow(2,Ct-1)*Math.pow(2,Ne),Re=0));Ne>=8;fe[de+tr]=pe&255,tr+=Yt,pe/=256,Ne-=8);for(Re=Re<<Ne|pe,we+=Ne;we>0;fe[de+tr]=Re&255,tr+=Yt,Re/=256,we-=8);fe[de+tr-Yt]|=Wt*128}},7375:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});var fe=Symbol.for("INJECTION");function We(Re,pe,lt,we){function Xe(){return we&&!Reflect.hasMetadata(fe,this,pe)&&Reflect.defineMetadata(fe,lt(),this,pe),Reflect.hasMetadata(fe,this,pe)?Reflect.getMetadata(fe,this,pe):lt()}function Ct(Pt){Reflect.defineMetadata(fe,Pt,this,pe)}Object.defineProperty(Re,pe,{configurable:!0,enumerable:!0,get:Xe,set:Ct})}function de(Re,pe){return function(lt){return function(we,Xe){var Ct=function(){return Re.get(lt)};We(we,Xe,Ct,pe)}}}Ae.makePropertyInjectDecorator=de;function y(Re,pe){return function(lt,we){return function(Xe,Ct){var Pt=function(){return Re.getNamed(lt,we)};We(Xe,Ct,Pt,pe)}}}Ae.makePropertyInjectNamedDecorator=y;function Ne(Re,pe){return function(lt,we,Xe){return function(Ct,Pt){var tr=function(){return Re.getTagged(lt,we,Xe)};We(Ct,Pt,tr,pe)}}}Ae.makePropertyInjectTaggedDecorator=Ne;function K(Re,pe){return function(lt){return function(we,Xe){var Ct=function(){return Re.getAll(lt)};We(we,Xe,Ct,pe)}}}Ae.makePropertyMultiInjectDecorator=K},84879:function(hi,Ae,fe){"use strict";var We;We={value:!0};var de=fe(7375);function y(Ne,K){K===void 0&&(K=!0);var Re=de.makePropertyInjectDecorator(Ne,K),pe=de.makePropertyInjectNamedDecorator(Ne,K),lt=de.makePropertyInjectTaggedDecorator(Ne,K),we=de.makePropertyMultiInjectDecorator(Ne,K);return{lazyInject:Re,lazyInjectNamed:pe,lazyInjectTagged:lt,lazyMultiInject:we}}Ae.Z=y},99934:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.tagProperty=Ae.tagParameter=Ae.decorate=void 0;var We=fe(16674),de=fe(6867);function y(we,Xe,Ct,Pt){var tr=de.TAGGED;K(tr,we,Xe,Pt,Ct)}Ae.tagParameter=y;function Ne(we,Xe,Ct){var Pt=de.TAGGED_PROP;K(Pt,we.constructor,Xe,Ct)}Ae.tagProperty=Ne;function K(we,Xe,Ct,Pt,tr){var Yt={},Wt=typeof tr=="number",br=tr!==void 0&&Wt?tr.toString():Ct;if(Wt&&Ct!==void 0)throw new Error(We.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(we,Xe)&&(Yt=Reflect.getMetadata(we,Xe));var lr=Yt[br];if(!Array.isArray(lr))lr=[];else for(var kt=0,zt=lr;kt<zt.length;kt++){var Pr=zt[kt];if(Pr.key===Pt.key)throw new Error(We.DUPLICATED_METADATA+" "+Pr.key.toString())}lr.push(Pt),Yt[br]=lr,Reflect.defineMetadata(we,Yt,Xe)}function Re(we,Xe){Reflect.decorate(we,Xe)}function pe(we,Xe){return function(Ct,Pt){Xe(Ct,Pt,we)}}function lt(we,Xe,Ct){typeof Ct=="number"?Re([pe(Ct,we)],Xe):typeof Ct=="string"?Reflect.decorate([we],Xe,Ct):Re([we],Xe)}Ae.decorate=lt},5744:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.inject=Ae.LazyServiceIdentifer=void 0;var We=fe(16674),de=fe(6867),y=fe(47738),Ne=fe(99934),K=function(){function pe(lt){this._cb=lt}return pe.prototype.unwrap=function(){return this._cb()},pe}();Ae.LazyServiceIdentifer=K;function Re(pe){return function(lt,we,Xe){if(pe===void 0)throw new Error(We.UNDEFINED_INJECT_ANNOTATION(lt.name));var Ct=new y.Metadata(de.INJECT_TAG,pe);typeof Xe=="number"?Ne.tagParameter(lt,we,Xe,Ct):Ne.tagProperty(lt,we,Ct)}}Ae.inject=Re},64315:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.injectable=void 0;var We=fe(16674),de=fe(6867);function y(){return function(Ne){if(Reflect.hasOwnMetadata(de.PARAM_TYPES,Ne))throw new Error(We.DUPLICATED_INJECTABLE_DECORATOR);var K=Reflect.getMetadata(de.DESIGN_PARAM_TYPES,Ne)||[];return Reflect.defineMetadata(de.PARAM_TYPES,K,Ne),Ne}}Ae.injectable=y},71693:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.multiInject=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Ne(K){return function(Re,pe,lt){var we=new de.Metadata(We.MULTI_INJECT_TAG,K);typeof lt=="number"?y.tagParameter(Re,pe,lt,we):y.tagProperty(Re,pe,we)}}Ae.multiInject=Ne},38085:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.named=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Ne(K){return function(Re,pe,lt){var we=new de.Metadata(We.NAMED_TAG,K);typeof lt=="number"?y.tagParameter(Re,pe,lt,we):y.tagProperty(Re,pe,we)}}Ae.named=Ne},6515:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.optional=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Ne(){return function(K,Re,pe){var lt=new de.Metadata(We.OPTIONAL_TAG,!0);typeof pe=="number"?y.tagParameter(K,Re,pe,lt):y.tagProperty(K,Re,lt)}}Ae.optional=Ne},7014:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.postConstruct=void 0;var We=fe(16674),de=fe(6867),y=fe(47738);function Ne(){return function(K,Re,pe){var lt=new y.Metadata(de.POST_CONSTRUCT,Re);if(Reflect.hasOwnMetadata(de.POST_CONSTRUCT,K.constructor))throw new Error(We.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(de.POST_CONSTRUCT,lt,K.constructor)}}Ae.postConstruct=Ne},32052:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.tagged=void 0;var We=fe(47738),de=fe(99934);function y(Ne,K){return function(Re,pe,lt){var we=new We.Metadata(Ne,K);typeof lt=="number"?de.tagParameter(Re,pe,lt,we):de.tagProperty(Re,pe,we)}}Ae.tagged=y},55638:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.targetName=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Ne(K){return function(Re,pe,lt){var we=new de.Metadata(We.NAME_TAG,K);y.tagParameter(Re,pe,lt,we)}}Ae.targetName=Ne},86757:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.unmanaged=void 0;var We=fe(6867),de=fe(47738),y=fe(99934);function Ne(){return function(K,Re,pe){var lt=new de.Metadata(We.UNMANAGED_TAG,!0);y.tagParameter(K,Re,pe,lt)}}Ae.unmanaged=Ne},44290:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Binding=void 0;var We=fe(28421),de=fe(37791),y=function(){function Ne(K,Re){this.id=de.id(),this.activated=!1,this.serviceIdentifier=K,this.scope=Re,this.type=We.BindingTypeEnum.Invalid,this.constraint=function(pe){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ne.prototype.clone=function(){var K=new Ne(this.serviceIdentifier,this.scope);return K.activated=K.scope===We.BindingScopeEnum.Singleton?this.activated:!1,K.implementationType=this.implementationType,K.dynamicValue=this.dynamicValue,K.scope=this.scope,K.type=this.type,K.factory=this.factory,K.provider=this.provider,K.constraint=this.constraint,K.onActivation=this.onActivation,K.cache=this.cache,K},Ne}();Ae.Binding=y},23184:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingCount=void 0;var fe={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Ae.BindingCount=fe},16674:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.STACK_OVERFLOW=Ae.CIRCULAR_DEPENDENCY_IN_FACTORY=Ae.POST_CONSTRUCT_ERROR=Ae.MULTIPLE_POST_CONSTRUCT_METHODS=Ae.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Ae.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Ae.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Ae.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Ae.ARGUMENTS_LENGTH_MISMATCH=Ae.INVALID_DECORATOR_OPERATION=Ae.INVALID_TO_SELF_VALUE=Ae.INVALID_FUNCTION_BINDING=Ae.INVALID_MIDDLEWARE_RETURN=Ae.NO_MORE_SNAPSHOTS_AVAILABLE=Ae.INVALID_BINDING_TYPE=Ae.NOT_IMPLEMENTED=Ae.CIRCULAR_DEPENDENCY=Ae.UNDEFINED_INJECT_ANNOTATION=Ae.MISSING_INJECT_ANNOTATION=Ae.MISSING_INJECTABLE_ANNOTATION=Ae.NOT_REGISTERED=Ae.CANNOT_UNBIND=Ae.AMBIGUOUS_MATCH=Ae.KEY_NOT_FOUND=Ae.NULL_ARGUMENT=Ae.DUPLICATED_METADATA=Ae.DUPLICATED_INJECTABLE_DECORATOR=void 0,Ae.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Ae.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Ae.NULL_ARGUMENT="NULL argument",Ae.KEY_NOT_FOUND="Key Not Found",Ae.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Ae.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Ae.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Ae.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Ae.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var fe=function(Ne){return"@inject called with undefined this could mean that the class "+Ne+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Ae.UNDEFINED_INJECT_ANNOTATION=fe,Ae.CIRCULAR_DEPENDENCY="Circular dependency found:",Ae.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Ae.INVALID_BINDING_TYPE="Invalid binding type:",Ae.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Ae.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Ae.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Ae.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Ae.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var We=function(){for(var Ne=[],K=0;K<arguments.length;K++)Ne[K]=arguments[K];return"The number of constructor arguments in the derived class "+(Ne[0]+" must be >= than the number of constructor arguments of its base class.")};Ae.ARGUMENTS_LENGTH_MISMATCH=We,Ae.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Ae.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Ae.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Ae.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Ae.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var de=function(){for(var Ne=[],K=0;K<arguments.length;K++)Ne[K]=arguments[K];return"@postConstruct error in class "+Ne[0]+": "+Ne[1]};Ae.POST_CONSTRUCT_ERROR=de;var y=function(){for(var Ne=[],K=0;K<arguments.length;K++)Ne[K]=arguments[K];return"It looks like there is a circular dependency "+("in one of the '"+Ne[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ne[1]+"'.")};Ae.CIRCULAR_DEPENDENCY_IN_FACTORY=y,Ae.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.TargetTypeEnum=Ae.BindingTypeEnum=Ae.BindingScopeEnum=void 0;var fe={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Ae.BindingScopeEnum=fe;var We={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Ae.BindingTypeEnum=We;var de={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Ae.TargetTypeEnum=de},6867:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.NON_CUSTOM_TAG_KEYS=Ae.POST_CONSTRUCT=Ae.DESIGN_PARAM_TYPES=Ae.PARAM_TYPES=Ae.TAGGED_PROP=Ae.TAGGED=Ae.MULTI_INJECT_TAG=Ae.INJECT_TAG=Ae.OPTIONAL_TAG=Ae.UNMANAGED_TAG=Ae.NAME_TAG=Ae.NAMED_TAG=void 0,Ae.NAMED_TAG="named",Ae.NAME_TAG="name",Ae.UNMANAGED_TAG="unmanaged",Ae.OPTIONAL_TAG="optional",Ae.INJECT_TAG="inject",Ae.MULTI_INJECT_TAG="multi_inject",Ae.TAGGED="inversify:tagged",Ae.TAGGED_PROP="inversify:tagged_props",Ae.PARAM_TYPES="inversify:paramtypes",Ae.DESIGN_PARAM_TYPES="design:paramtypes",Ae.POST_CONSTRUCT="post_construct";function fe(){return[Ae.INJECT_TAG,Ae.MULTI_INJECT_TAG,Ae.NAME_TAG,Ae.UNMANAGED_TAG,Ae.NAMED_TAG,Ae.OPTIONAL_TAG]}Ae.NON_CUSTOM_TAG_KEYS=fe()},51389:function(hi,Ae,fe){"use strict";var We=this&&this.__awaiter||function(lr,kt,zt,Pr){function re(yr){return yr instanceof zt?yr:new zt(function(Rt){Rt(yr)})}return new(zt||(zt=Promise))(function(yr,Rt){function _t(Er){try{Ue(Pr.next(Er))}catch(an){Rt(an)}}function Kt(Er){try{Ue(Pr.throw(Er))}catch(an){Rt(an)}}function Ue(Er){Er.done?yr(Er.value):re(Er.value).then(_t,Kt)}Ue((Pr=Pr.apply(lr,kt||[])).next())})},de=this&&this.__generator||function(lr,kt){var zt={label:0,sent:function(){if(yr[0]&1)throw yr[1];return yr[1]},trys:[],ops:[]},Pr,re,yr,Rt;return Rt={next:_t(0),throw:_t(1),return:_t(2)},typeof Symbol=="function"&&(Rt[Symbol.iterator]=function(){return this}),Rt;function _t(Ue){return function(Er){return Kt([Ue,Er])}}function Kt(Ue){if(Pr)throw new TypeError("Generator is already executing.");for(;zt;)try{if(Pr=1,re&&(yr=Ue[0]&2?re.return:Ue[0]?re.throw||((yr=re.return)&&yr.call(re),0):re.next)&&!(yr=yr.call(re,Ue[1])).done)return yr;switch(re=0,yr&&(Ue=[Ue[0]&2,yr.value]),Ue[0]){case 0:case 1:yr=Ue;break;case 4:return zt.label++,{value:Ue[1],done:!1};case 5:zt.label++,re=Ue[1],Ue=[0];continue;case 7:Ue=zt.ops.pop(),zt.trys.pop();continue;default:if(yr=zt.trys,!(yr=yr.length>0&&yr[yr.length-1])&&(Ue[0]===6||Ue[0]===2)){zt=0;continue}if(Ue[0]===3&&(!yr||Ue[1]>yr[0]&&Ue[1]<yr[3])){zt.label=Ue[1];break}if(Ue[0]===6&&zt.label<yr[1]){zt.label=yr[1],yr=Ue;break}if(yr&&zt.label<yr[2]){zt.label=yr[2],zt.ops.push(Ue);break}yr[2]&&zt.ops.pop(),zt.trys.pop();continue}Ue=kt.call(lr,zt)}catch(Er){Ue=[6,Er],re=0}finally{Pr=yr=0}if(Ue[0]&5)throw Ue[1];return{value:Ue[0]?Ue[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(lr,kt){for(var zt=0,Pr=kt.length,re=lr.length;zt<Pr;zt++,re++)lr[re]=kt[zt];return lr};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Container=void 0;var Ne=fe(44290),K=fe(16674),Re=fe(28421),pe=fe(6867),lt=fe(51377),we=fe(86311),Xe=fe(31927),Ct=fe(15451),Pt=fe(37791),tr=fe(55800),Yt=fe(85700),Wt=fe(80175),br=function(){function lr(kt){this._appliedMiddleware=[];var zt=kt||{};if(typeof zt!="object")throw new Error(""+K.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(zt.defaultScope===void 0)zt.defaultScope=Re.BindingScopeEnum.Transient;else if(zt.defaultScope!==Re.BindingScopeEnum.Singleton&&zt.defaultScope!==Re.BindingScopeEnum.Transient&&zt.defaultScope!==Re.BindingScopeEnum.Request)throw new Error(""+K.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(zt.autoBindInjectable===void 0)zt.autoBindInjectable=!1;else if(typeof zt.autoBindInjectable!="boolean")throw new Error(""+K.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(zt.skipBaseClassChecks===void 0)zt.skipBaseClassChecks=!1;else if(typeof zt.skipBaseClassChecks!="boolean")throw new Error(""+K.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:zt.autoBindInjectable,defaultScope:zt.defaultScope,skipBaseClassChecks:zt.skipBaseClassChecks},this.id=Pt.id(),this._bindingDictionary=new Wt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new lt.MetadataReader}return lr.merge=function(kt,zt){for(var Pr=[],re=2;re<arguments.length;re++)Pr[re-2]=arguments[re];var yr=new lr,Rt=y([kt,zt],Pr).map(function(Ue){return we.getBindingDictionary(Ue)}),_t=we.getBindingDictionary(yr);function Kt(Ue,Er){Ue.traverse(function(an,ue){ue.forEach(function(rt){Er.add(rt.serviceIdentifier,rt.clone())})})}return Rt.forEach(function(Ue){Kt(Ue,_t)}),yr},lr.prototype.load=function(){for(var kt=[],zt=0;zt<arguments.length;zt++)kt[zt]=arguments[zt];for(var Pr=this._getContainerModuleHelpersFactory(),re=0,yr=kt;re<yr.length;re++){var Rt=yr[re],_t=Pr(Rt.id);Rt.registry(_t.bindFunction,_t.unbindFunction,_t.isboundFunction,_t.rebindFunction)}},lr.prototype.loadAsync=function(){for(var kt=[],zt=0;zt<arguments.length;zt++)kt[zt]=arguments[zt];return We(this,void 0,void 0,function(){var Pr,re,yr,Rt,_t;return de(this,function(Kt){switch(Kt.label){case 0:Pr=this._getContainerModuleHelpersFactory(),re=0,yr=kt,Kt.label=1;case 1:return re<yr.length?(Rt=yr[re],_t=Pr(Rt.id),[4,Rt.registry(_t.bindFunction,_t.unbindFunction,_t.isboundFunction,_t.rebindFunction)]):[3,4];case 2:Kt.sent(),Kt.label=3;case 3:return re++,[3,1];case 4:return[2]}})})},lr.prototype.unload=function(){for(var kt=this,zt=[],Pr=0;Pr<arguments.length;Pr++)zt[Pr]=arguments[Pr];var re=function(yr){return function(Rt){return Rt.moduleId===yr}};zt.forEach(function(yr){var Rt=re(yr.id);kt._bindingDictionary.removeByCondition(Rt)})},lr.prototype.bind=function(kt){var zt=this.options.defaultScope||Re.BindingScopeEnum.Transient,Pr=new Ne.Binding(kt,zt);return this._bindingDictionary.add(kt,Pr),new Ct.BindingToSyntax(Pr)},lr.prototype.rebind=function(kt){return this.unbind(kt),this.bind(kt)},lr.prototype.unbind=function(kt){try{this._bindingDictionary.remove(kt)}catch(zt){throw new Error(K.CANNOT_UNBIND+" "+tr.getServiceIdentifierAsString(kt))}},lr.prototype.unbindAll=function(){this._bindingDictionary=new Wt.Lookup},lr.prototype.isBound=function(kt){var zt=this._bindingDictionary.hasKey(kt);return!zt&&this.parent&&(zt=this.parent.isBound(kt)),zt},lr.prototype.isBoundNamed=function(kt,zt){return this.isBoundTagged(kt,pe.NAMED_TAG,zt)},lr.prototype.isBoundTagged=function(kt,zt,Pr){var re=!1;if(this._bindingDictionary.hasKey(kt)){var yr=this._bindingDictionary.get(kt),Rt=we.createMockRequest(this,kt,zt,Pr);re=yr.some(function(_t){return _t.constraint(Rt)})}return!re&&this.parent&&(re=this.parent.isBoundTagged(kt,zt,Pr)),re},lr.prototype.snapshot=function(){this._snapshots.push(Yt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},lr.prototype.restore=function(){var kt=this._snapshots.pop();if(kt===void 0)throw new Error(K.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=kt.bindings,this._middleware=kt.middleware},lr.prototype.createChild=function(kt){var zt=new lr(kt||this.options);return zt.parent=this,zt},lr.prototype.applyMiddleware=function(){for(var kt=[],zt=0;zt<arguments.length;zt++)kt[zt]=arguments[zt];this._appliedMiddleware=this._appliedMiddleware.concat(kt);var Pr=this._middleware?this._middleware:this._planAndResolve();this._middleware=kt.reduce(function(re,yr){return yr(re)},Pr)},lr.prototype.applyCustomMetadataReader=function(kt){this._metadataReader=kt},lr.prototype.get=function(kt){return this._get(!1,!1,Re.TargetTypeEnum.Variable,kt)},lr.prototype.getTagged=function(kt,zt,Pr){return this._get(!1,!1,Re.TargetTypeEnum.Variable,kt,zt,Pr)},lr.prototype.getNamed=function(kt,zt){return this.getTagged(kt,pe.NAMED_TAG,zt)},lr.prototype.getAll=function(kt){return this._get(!0,!0,Re.TargetTypeEnum.Variable,kt)},lr.prototype.getAllTagged=function(kt,zt,Pr){return this._get(!1,!0,Re.TargetTypeEnum.Variable,kt,zt,Pr)},lr.prototype.getAllNamed=function(kt,zt){return this.getAllTagged(kt,pe.NAMED_TAG,zt)},lr.prototype.resolve=function(kt){var zt=this.createChild();return zt.bind(kt).toSelf(),this._appliedMiddleware.forEach(function(Pr){zt.applyMiddleware(Pr)}),zt.get(kt)},lr.prototype._getContainerModuleHelpersFactory=function(){var kt=this,zt=function(_t,Kt){_t._binding.moduleId=Kt},Pr=function(_t){return function(Kt){var Ue=kt.bind.bind(kt),Er=Ue(Kt);return zt(Er,_t),Er}},re=function(_t){return function(Kt){var Ue=kt.unbind.bind(kt);Ue(Kt)}},yr=function(_t){return function(Kt){var Ue=kt.isBound.bind(kt);return Ue(Kt)}},Rt=function(_t){return function(Kt){var Ue=kt.rebind.bind(kt),Er=Ue(Kt);return zt(Er,_t),Er}};return function(_t){return{bindFunction:Pr(_t),isboundFunction:yr(_t),rebindFunction:Rt(_t),unbindFunction:re(_t)}}},lr.prototype._get=function(kt,zt,Pr,re,yr,Rt){var _t=null,Kt={avoidConstraints:kt,contextInterceptor:function(Ue){return Ue},isMultiInject:zt,key:yr,serviceIdentifier:re,targetType:Pr,value:Rt};if(this._middleware){if(_t=this._middleware(Kt),_t==null)throw new Error(K.INVALID_MIDDLEWARE_RETURN)}else _t=this._planAndResolve()(Kt);return _t},lr.prototype._planAndResolve=function(){var kt=this;return function(zt){var Pr=we.plan(kt._metadataReader,kt,zt.isMultiInject,zt.targetType,zt.serviceIdentifier,zt.key,zt.value,zt.avoidConstraints);Pr=zt.contextInterceptor(Pr);var re=Xe.resolve(Pr);return re}},lr}();Ae.Container=br},33244:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AsyncContainerModule=Ae.ContainerModule=void 0;var We=fe(37791),de=function(){function Ne(K){this.id=We.id(),this.registry=K}return Ne}();Ae.ContainerModule=de;var y=function(){function Ne(K){this.id=We.id(),this.registry=K}return Ne}();Ae.AsyncContainerModule=y},85700:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ContainerSnapshot=void 0;var fe=function(){function We(){}return We.of=function(de,y){var Ne=new We;return Ne.bindings=de,Ne.middleware=y,Ne},We}();Ae.ContainerSnapshot=fe},80175:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Lookup=void 0;var We=fe(16674),de=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Ne,K){if(Ne==null)throw new Error(We.NULL_ARGUMENT);if(K==null)throw new Error(We.NULL_ARGUMENT);var Re=this._map.get(Ne);Re!==void 0?(Re.push(K),this._map.set(Ne,Re)):this._map.set(Ne,[K])},y.prototype.get=function(Ne){if(Ne==null)throw new Error(We.NULL_ARGUMENT);var K=this._map.get(Ne);if(K!==void 0)return K;throw new Error(We.KEY_NOT_FOUND)},y.prototype.remove=function(Ne){if(Ne==null)throw new Error(We.NULL_ARGUMENT);if(!this._map.delete(Ne))throw new Error(We.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Ne){var K=this;this._map.forEach(function(Re,pe){var lt=Re.filter(function(we){return!Ne(we)});lt.length>0?K._map.set(pe,lt):K._map.delete(pe)})},y.prototype.hasKey=function(Ne){if(Ne==null)throw new Error(We.NULL_ARGUMENT);return this._map.has(Ne)},y.prototype.clone=function(){var Ne=new y;return this._map.forEach(function(K,Re){K.forEach(function(pe){return Ne.add(Re,pe.clone())})}),Ne},y.prototype.traverse=function(Ne){this._map.forEach(function(K,Re){Ne(Re,K)})},y}();Ae.Lookup=de},86700:function(hi,Ae,fe){"use strict";var We;We={value:!0},We=We=We=We=We=We=Ae.GW=We=We=Ae.zY=We=We=We=We=We=Ae.f3=We=We=Ae.b2=We=We=We=We=We=Ae.W2=We=void 0;var de=fe(6867);We=de;var y=fe(51389);Object.defineProperty(Ae,"W2",{enumerable:!0,get:function(){return y.Container}});var Ne=fe(28421);We={enumerable:!0,get:function(){return Ne.BindingScopeEnum}},We={enumerable:!0,get:function(){return Ne.BindingTypeEnum}},We={enumerable:!0,get:function(){return Ne.TargetTypeEnum}};var K=fe(33244);We={enumerable:!0,get:function(){return K.AsyncContainerModule}},We={enumerable:!0,get:function(){return K.ContainerModule}};var Re=fe(64315);Object.defineProperty(Ae,"b2",{enumerable:!0,get:function(){return Re.injectable}});var pe=fe(32052);We={enumerable:!0,get:function(){return pe.tagged}};var lt=fe(38085);We={enumerable:!0,get:function(){return lt.named}};var we=fe(5744);Object.defineProperty(Ae,"f3",{enumerable:!0,get:function(){return we.inject}}),We={enumerable:!0,get:function(){return we.LazyServiceIdentifer}};var Xe=fe(6515);We={enumerable:!0,get:function(){return Xe.optional}};var Ct=fe(86757);We={enumerable:!0,get:function(){return Ct.unmanaged}};var Pt=fe(71693);We={enumerable:!0,get:function(){return Pt.multiInject}};var tr=fe(55638);We={enumerable:!0,get:function(){return tr.targetName}};var Yt=fe(7014);Object.defineProperty(Ae,"zY",{enumerable:!0,get:function(){return Yt.postConstruct}});var Wt=fe(51377);We={enumerable:!0,get:function(){return Wt.MetadataReader}};var br=fe(37791);We={enumerable:!0,get:function(){return br.id}};var lr=fe(99934);Object.defineProperty(Ae,"GW",{enumerable:!0,get:function(){return lr.decorate}});var kt=fe(80758);We={enumerable:!0,get:function(){return kt.traverseAncerstors}},We={enumerable:!0,get:function(){return kt.taggedConstraint}},We={enumerable:!0,get:function(){return kt.namedConstraint}},We={enumerable:!0,get:function(){return kt.typeConstraint}};var zt=fe(55800);We={enumerable:!0,get:function(){return zt.getServiceIdentifierAsString}};var Pr=fe(70600);We={enumerable:!0,get:function(){return Pr.multiBindToService}}},95228:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Context=void 0;var We=fe(37791),de=function(){function y(Ne){this.id=We.id(),this.container=Ne}return y.prototype.addPlan=function(Ne){this.plan=Ne},y.prototype.setCurrentRequest=function(Ne){this.currentRequest=Ne},y}();Ae.Context=de},47738:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Metadata=void 0;var We=fe(6867),de=function(){function y(Ne,K){this.key=Ne,this.value=K}return y.prototype.toString=function(){return this.key===We.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();Ae.Metadata=de},51377:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.MetadataReader=void 0;var We=fe(6867),de=function(){function y(){}return y.prototype.getConstructorMetadata=function(Ne){var K=Reflect.getMetadata(We.PARAM_TYPES,Ne),Re=Reflect.getMetadata(We.TAGGED,Ne);return{compilerGeneratedMetadata:K,userGeneratedMetadata:Re||{}}},y.prototype.getPropertiesMetadata=function(Ne){var K=Reflect.getMetadata(We.TAGGED_PROP,Ne)||[];return K},y}();Ae.MetadataReader=de},55314:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Plan=void 0;var fe=function(){function We(de,y){this.parentContext=de,this.rootRequest=y}return We}();Ae.Plan=fe},86311:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.getBindingDictionary=Ae.createMockRequest=Ae.plan=void 0;var We=fe(23184),de=fe(16674),y=fe(28421),Ne=fe(6867),K=fe(85265),Re=fe(55800),pe=fe(95228),lt=fe(47738),we=fe(55314),Xe=fe(6e3),Ct=fe(6748),Pt=fe(18924);function tr(re){return re._bindingDictionary}Ae.getBindingDictionary=tr;function Yt(re,yr,Rt,_t,Kt,Ue){var Er=re?Ne.MULTI_INJECT_TAG:Ne.INJECT_TAG,an=new lt.Metadata(Er,Rt),ue=new Pt.Target(yr,_t,Rt,an);if(Kt!==void 0){var rt=new lt.Metadata(Kt,Ue);ue.metadata.push(rt)}return ue}function Wt(re,yr,Rt,_t,Kt){var Ue=kt(Rt.container,Kt.serviceIdentifier),Er=[];return Ue.length===We.BindingCount.NoBindingsAvailable&&Rt.container.options.autoBindInjectable&&typeof Kt.serviceIdentifier=="function"&&re.getConstructorMetadata(Kt.serviceIdentifier).compilerGeneratedMetadata&&(Rt.container.bind(Kt.serviceIdentifier).toSelf(),Ue=kt(Rt.container,Kt.serviceIdentifier)),yr?Er=Ue:Er=Ue.filter(function(an){var ue=new Ct.Request(an.serviceIdentifier,Rt,_t,an,Kt);return an.constraint(ue)}),br(Kt.serviceIdentifier,Er,Kt,Rt.container),Er}function br(re,yr,Rt,_t){switch(yr.length){case We.BindingCount.NoBindingsAvailable:if(Rt.isOptional())return yr;var Kt=Re.getServiceIdentifierAsString(re),Ue=de.NOT_REGISTERED;throw Ue+=Re.listMetadataForTarget(Kt,Rt),Ue+=Re.listRegisteredBindingsForServiceIdentifier(_t,Kt,kt),new Error(Ue);case We.BindingCount.OnlyOneBindingAvailable:if(!Rt.isArray())return yr;case We.BindingCount.MultipleBindingsAvailable:default:if(Rt.isArray())return yr;var Kt=Re.getServiceIdentifierAsString(re),Ue=de.AMBIGUOUS_MATCH+" "+Kt;throw Ue+=Re.listRegisteredBindingsForServiceIdentifier(_t,Kt,kt),new Error(Ue)}}function lr(re,yr,Rt,_t,Kt,Ue){var Er,an;if(Kt===null){Er=Wt(re,yr,_t,null,Ue),an=new Ct.Request(Rt,_t,null,Er,Ue);var ue=new we.Plan(_t,an);_t.addPlan(ue)}else Er=Wt(re,yr,_t,Kt,Ue),an=Kt.addChildRequest(Ue.serviceIdentifier,Er,Ue);Er.forEach(function(rt){var Z=null;if(Ue.isArray())Z=an.addChildRequest(rt.serviceIdentifier,rt,Ue);else{if(rt.cache)return;Z=an}if(rt.type===y.BindingTypeEnum.Instance&&rt.implementationType!==null){var _e=Xe.getDependencies(re,rt.implementationType);if(!_t.container.options.skipBaseClassChecks){var ze=Xe.getBaseClassDependencyCount(re,rt.implementationType);if(_e.length<ze){var St=de.ARGUMENTS_LENGTH_MISMATCH(Xe.getFunctionName(rt.implementationType));throw new Error(St)}}_e.forEach(function(Ut){lr(re,!1,Ut.serviceIdentifier,_t,Z,Ut)})}})}function kt(re,yr){var Rt=[],_t=tr(re);return _t.hasKey(yr)?Rt=_t.get(yr):re.parent!==null&&(Rt=kt(re.parent,yr)),Rt}function zt(re,yr,Rt,_t,Kt,Ue,Er,an){an===void 0&&(an=!1);var ue=new pe.Context(yr),rt=Yt(Rt,_t,Kt,"",Ue,Er);try{return lr(re,an,Kt,ue,null,rt),ue}catch(Z){throw K.isStackOverflowExeption(Z)&&ue.plan&&Re.circularDependencyToException(ue.plan.rootRequest),Z}}Ae.plan=zt;function Pr(re,yr,Rt,_t){var Kt=new Pt.Target(y.TargetTypeEnum.Variable,"",yr,new lt.Metadata(Rt,_t)),Ue=new pe.Context(re),Er=new Ct.Request(yr,Ue,null,[],Kt);return Er}Ae.createMockRequest=Pr},88460:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.QueryableString=void 0;var fe=function(){function We(de){this.str=de}return We.prototype.startsWith=function(de){return this.str.indexOf(de)===0},We.prototype.endsWith=function(de){var y="",Ne=de.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Ne)},We.prototype.contains=function(de){return this.str.indexOf(de)!==-1},We.prototype.equals=function(de){return this.str===de},We.prototype.value=function(){return this.str},We}();Ae.QueryableString=fe},6e3:function(hi,Ae,fe){"use strict";var We=this&&this.__spreadArray||function(Wt,br){for(var lr=0,kt=br.length,zt=Wt.length;lr<kt;lr++,zt++)Wt[zt]=br[lr];return Wt};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.getFunctionName=Ae.getBaseClassDependencyCount=Ae.getDependencies=void 0;var de=fe(5744),y=fe(16674),Ne=fe(28421),K=fe(6867),Re=fe(55800);Object.defineProperty(Ae,"getFunctionName",{enumerable:!0,get:function(){return Re.getFunctionName}});var pe=fe(18924);function lt(Wt,br){var lr=Re.getFunctionName(br),kt=we(Wt,lr,br,!1);return kt}Ae.getDependencies=lt;function we(Wt,br,lr,kt){var zt=Wt.getConstructorMetadata(lr),Pr=zt.compilerGeneratedMetadata;if(Pr===void 0){var re=y.MISSING_INJECTABLE_ANNOTATION+" "+br+".";throw new Error(re)}var yr=zt.userGeneratedMetadata,Rt=Object.keys(yr),_t=lr.length===0&&Rt.length>0,Kt=Rt.length>lr.length,Ue=_t||Kt?Rt.length:lr.length,Er=Ct(kt,br,Pr,yr,Ue),an=Pt(Wt,lr),ue=We(We([],Er),an);return ue}function Xe(Wt,br,lr,kt,zt){var Pr=zt[Wt.toString()]||[],re=Yt(Pr),yr=re.unmanaged!==!0,Rt=kt[Wt],_t=re.inject||re.multiInject;if(Rt=_t||Rt,Rt instanceof de.LazyServiceIdentifer&&(Rt=Rt.unwrap()),yr){var Kt=Rt===Object,Ue=Rt===Function,Er=Rt===void 0,an=Kt||Ue||Er;if(!br&&an){var ue=y.MISSING_INJECT_ANNOTATION+" argument "+Wt+" in class "+lr+".";throw new Error(ue)}var rt=new pe.Target(Ne.TargetTypeEnum.ConstructorArgument,re.targetName,Rt);return rt.metadata=Pr,rt}return null}function Ct(Wt,br,lr,kt,zt){for(var Pr=[],re=0;re<zt;re++){var yr=re,Rt=Xe(yr,Wt,br,lr,kt);Rt!==null&&Pr.push(Rt)}return Pr}function Pt(Wt,br){for(var lr=Wt.getPropertiesMetadata(br),kt=[],zt=Object.keys(lr),Pr=0,re=zt;Pr<re.length;Pr++){var yr=re[Pr],Rt=lr[yr],_t=Yt(lr[yr]),Kt=_t.targetName||yr,Ue=_t.inject||_t.multiInject,Er=new pe.Target(Ne.TargetTypeEnum.ClassProperty,Kt,Ue);Er.metadata=Rt,kt.push(Er)}var an=Object.getPrototypeOf(br.prototype).constructor;if(an!==Object){var ue=Pt(Wt,an);kt=We(We([],kt),ue)}return kt}function tr(Wt,br){var lr=Object.getPrototypeOf(br.prototype).constructor;if(lr!==Object){var kt=Re.getFunctionName(lr),zt=we(Wt,kt,lr,!0),Pr=zt.map(function(Rt){return Rt.metadata.filter(function(_t){return _t.key===K.UNMANAGED_TAG})}),re=[].concat.apply([],Pr).length,yr=zt.length-re;return yr>0?yr:tr(Wt,lr)}else return 0}Ae.getBaseClassDependencyCount=tr;function Yt(Wt){var br={};return Wt.forEach(function(lr){br[lr.key.toString()]=lr.value}),{inject:br[K.INJECT_TAG],multiInject:br[K.MULTI_INJECT_TAG],targetName:br[K.NAME_TAG],unmanaged:br[K.UNMANAGED_TAG]}}},6748:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Request=void 0;var We=fe(37791),de=function(){function y(Ne,K,Re,pe,lt){this.id=We.id(),this.serviceIdentifier=Ne,this.parentContext=K,this.parentRequest=Re,this.target=lt,this.childRequests=[],this.bindings=Array.isArray(pe)?pe:[pe],this.requestScope=Re===null?new Map:null}return y.prototype.addChildRequest=function(Ne,K,Re){var pe=new y(Ne,this.parentContext,this,K,Re);return this.childRequests.push(pe),pe},y}();Ae.Request=de},18924:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Target=void 0;var We=fe(6867),de=fe(37791),y=fe(47738),Ne=fe(88460),K=function(){function Re(pe,lt,we,Xe){this.id=de.id(),this.type=pe,this.serviceIdentifier=we,this.name=new Ne.QueryableString(lt||""),this.metadata=new Array;var Ct=null;typeof Xe=="string"?Ct=new y.Metadata(We.NAMED_TAG,Xe):Xe instanceof y.Metadata&&(Ct=Xe),Ct!==null&&this.metadata.push(Ct)}return Re.prototype.hasTag=function(pe){for(var lt=0,we=this.metadata;lt<we.length;lt++){var Xe=we[lt];if(Xe.key===pe)return!0}return!1},Re.prototype.isArray=function(){return this.hasTag(We.MULTI_INJECT_TAG)},Re.prototype.matchesArray=function(pe){return this.matchesTag(We.MULTI_INJECT_TAG)(pe)},Re.prototype.isNamed=function(){return this.hasTag(We.NAMED_TAG)},Re.prototype.isTagged=function(){return this.metadata.some(function(pe){return We.NON_CUSTOM_TAG_KEYS.every(function(lt){return pe.key!==lt})})},Re.prototype.isOptional=function(){return this.matchesTag(We.OPTIONAL_TAG)(!0)},Re.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(pe){return pe.key===We.NAMED_TAG})[0]:null},Re.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(pe){return We.NON_CUSTOM_TAG_KEYS.every(function(lt){return pe.key!==lt})}):null},Re.prototype.matchesNamedTag=function(pe){return this.matchesTag(We.NAMED_TAG)(pe)},Re.prototype.matchesTag=function(pe){var lt=this;return function(we){for(var Xe=0,Ct=lt.metadata;Xe<Ct.length;Xe++){var Pt=Ct[Xe];if(Pt.key===pe&&Pt.value===we)return!0}return!1}},Re}();Ae.Target=K},52279:function(hi,Ae,fe){"use strict";var We=this&&this.__spreadArray||function(we,Xe){for(var Ct=0,Pt=Xe.length,tr=we.length;Ct<Pt;Ct++,tr++)we[tr]=Xe[Ct];return we};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.resolveInstance=void 0;var de=fe(16674),y=fe(28421),Ne=fe(6867);function K(we,Xe,Ct){var Pt=Xe.filter(function(Yt){return Yt.target!==null&&Yt.target.type===y.TargetTypeEnum.ClassProperty}),tr=Pt.map(Ct);return Pt.forEach(function(Yt,Wt){var br="";br=Yt.target.name.value();var lr=tr[Wt];we[br]=lr}),we}function Re(we,Xe){return new(we.bind.apply(we,We([void 0],Xe)))}function pe(we,Xe){if(Reflect.hasMetadata(Ne.POST_CONSTRUCT,we)){var Ct=Reflect.getMetadata(Ne.POST_CONSTRUCT,we);try{Xe[Ct.value]()}catch(Pt){throw new Error(de.POST_CONSTRUCT_ERROR(we.name,Pt.message))}}}function lt(we,Xe,Ct){var Pt=null;if(Xe.length>0){var tr=Xe.filter(function(Wt){return Wt.target!==null&&Wt.target.type===y.TargetTypeEnum.ConstructorArgument}),Yt=tr.map(Ct);Pt=Re(we,Yt),Pt=K(Pt,Xe,Ct)}else Pt=new we;return pe(we,Pt),Pt}Ae.resolveInstance=lt},31927:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.resolve=void 0;var We=fe(16674),de=fe(28421),y=fe(85265),Ne=fe(55800),K=fe(52279),Re=function(we,Xe,Ct){try{return Ct()}catch(Pt){throw y.isStackOverflowExeption(Pt)?new Error(We.CIRCULAR_DEPENDENCY_IN_FACTORY(we,Xe.toString())):Pt}},pe=function(we){return function(Xe){Xe.parentContext.setCurrentRequest(Xe);var Ct=Xe.bindings,Pt=Xe.childRequests,tr=Xe.target&&Xe.target.isArray(),Yt=!Xe.parentRequest||!Xe.parentRequest.target||!Xe.target||!Xe.parentRequest.target.matchesArray(Xe.target.serviceIdentifier);if(tr&&Yt)return Pt.map(function(Pr){var re=pe(we);return re(Pr)});var Wt=null;if(Xe.target.isOptional()&&Ct.length===0)return;var br=Ct[0],lr=br.scope===de.BindingScopeEnum.Singleton,kt=br.scope===de.BindingScopeEnum.Request;if(lr&&br.activated)return br.cache;if(kt&&we!==null&&we.has(br.id))return we.get(br.id);if(br.type===de.BindingTypeEnum.ConstantValue)Wt=br.cache,br.activated=!0;else if(br.type===de.BindingTypeEnum.Function)Wt=br.cache,br.activated=!0;else if(br.type===de.BindingTypeEnum.Constructor)Wt=br.implementationType;else if(br.type===de.BindingTypeEnum.DynamicValue&&br.dynamicValue!==null)Wt=Re("toDynamicValue",br.serviceIdentifier,function(){return br.dynamicValue(Xe.parentContext)});else if(br.type===de.BindingTypeEnum.Factory&&br.factory!==null)Wt=Re("toFactory",br.serviceIdentifier,function(){return br.factory(Xe.parentContext)});else if(br.type===de.BindingTypeEnum.Provider&&br.provider!==null)Wt=Re("toProvider",br.serviceIdentifier,function(){return br.provider(Xe.parentContext)});else if(br.type===de.BindingTypeEnum.Instance&&br.implementationType!==null)Wt=K.resolveInstance(br.implementationType,Pt,pe(we));else{var zt=Ne.getServiceIdentifierAsString(Xe.serviceIdentifier);throw new Error(We.INVALID_BINDING_TYPE+" "+zt)}return typeof br.onActivation=="function"&&(Wt=br.onActivation(Xe.parentContext,Wt)),lr&&(br.cache=Wt,br.activated=!0),kt&&we!==null&&!we.has(br.id)&&we.set(br.id,Wt),Wt}};function lt(we){var Xe=pe(we.plan.rootRequest.requestScope);return Xe(we.plan.rootRequest)}Ae.resolve=lt},83366:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingInSyntax=void 0;var We=fe(28421),de=fe(71325),y=function(){function Ne(K){this._binding=K}return Ne.prototype.inRequestScope=function(){return this._binding.scope=We.BindingScopeEnum.Request,new de.BindingWhenOnSyntax(this._binding)},Ne.prototype.inSingletonScope=function(){return this._binding.scope=We.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},Ne.prototype.inTransientScope=function(){return this._binding.scope=We.BindingScopeEnum.Transient,new de.BindingWhenOnSyntax(this._binding)},Ne}();Ae.BindingInSyntax=y},74889:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingInWhenOnSyntax=void 0;var We=fe(83366),de=fe(51811),y=fe(98370),Ne=function(){function K(Re){this._binding=Re,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new de.BindingOnSyntax(this._binding),this._bindingInSyntax=new We.BindingInSyntax(Re)}return K.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},K.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},K.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},K.prototype.when=function(Re){return this._bindingWhenSyntax.when(Re)},K.prototype.whenTargetNamed=function(Re){return this._bindingWhenSyntax.whenTargetNamed(Re)},K.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},K.prototype.whenTargetTagged=function(Re,pe){return this._bindingWhenSyntax.whenTargetTagged(Re,pe)},K.prototype.whenInjectedInto=function(Re){return this._bindingWhenSyntax.whenInjectedInto(Re)},K.prototype.whenParentNamed=function(Re){return this._bindingWhenSyntax.whenParentNamed(Re)},K.prototype.whenParentTagged=function(Re,pe){return this._bindingWhenSyntax.whenParentTagged(Re,pe)},K.prototype.whenAnyAncestorIs=function(Re){return this._bindingWhenSyntax.whenAnyAncestorIs(Re)},K.prototype.whenNoAncestorIs=function(Re){return this._bindingWhenSyntax.whenNoAncestorIs(Re)},K.prototype.whenAnyAncestorNamed=function(Re){return this._bindingWhenSyntax.whenAnyAncestorNamed(Re)},K.prototype.whenAnyAncestorTagged=function(Re,pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(Re,pe)},K.prototype.whenNoAncestorNamed=function(Re){return this._bindingWhenSyntax.whenNoAncestorNamed(Re)},K.prototype.whenNoAncestorTagged=function(Re,pe){return this._bindingWhenSyntax.whenNoAncestorTagged(Re,pe)},K.prototype.whenAnyAncestorMatches=function(Re){return this._bindingWhenSyntax.whenAnyAncestorMatches(Re)},K.prototype.whenNoAncestorMatches=function(Re){return this._bindingWhenSyntax.whenNoAncestorMatches(Re)},K.prototype.onActivation=function(Re){return this._bindingOnSyntax.onActivation(Re)},K}();Ae.BindingInWhenOnSyntax=Ne},51811:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingOnSyntax=void 0;var We=fe(98370),de=function(){function y(Ne){this._binding=Ne}return y.prototype.onActivation=function(Ne){return this._binding.onActivation=Ne,new We.BindingWhenSyntax(this._binding)},y}();Ae.BindingOnSyntax=de},15451:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingToSyntax=void 0;var We=fe(16674),de=fe(28421),y=fe(74889),Ne=fe(71325),K=function(){function Re(pe){this._binding=pe}return Re.prototype.to=function(pe){return this._binding.type=de.BindingTypeEnum.Instance,this._binding.implementationType=pe,new y.BindingInWhenOnSyntax(this._binding)},Re.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+We.INVALID_TO_SELF_VALUE);var pe=this._binding.serviceIdentifier;return this.to(pe)},Re.prototype.toConstantValue=function(pe){return this._binding.type=de.BindingTypeEnum.ConstantValue,this._binding.cache=pe,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=de.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Re.prototype.toDynamicValue=function(pe){return this._binding.type=de.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=pe,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},Re.prototype.toConstructor=function(pe){return this._binding.type=de.BindingTypeEnum.Constructor,this._binding.implementationType=pe,this._binding.scope=de.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Re.prototype.toFactory=function(pe){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=pe,this._binding.scope=de.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Re.prototype.toFunction=function(pe){if(typeof pe!="function")throw new Error(We.INVALID_FUNCTION_BINDING);var lt=this.toConstantValue(pe);return this._binding.type=de.BindingTypeEnum.Function,this._binding.scope=de.BindingScopeEnum.Singleton,lt},Re.prototype.toAutoFactory=function(pe){return this._binding.type=de.BindingTypeEnum.Factory,this._binding.factory=function(lt){var we=function(){return lt.container.get(pe)};return we},this._binding.scope=de.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Re.prototype.toProvider=function(pe){return this._binding.type=de.BindingTypeEnum.Provider,this._binding.provider=pe,this._binding.scope=de.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Re.prototype.toService=function(pe){this.toDynamicValue(function(lt){return lt.container.get(pe)})},Re}();Ae.BindingToSyntax=K},71325:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingWhenOnSyntax=void 0;var We=fe(51811),de=fe(98370),y=function(){function Ne(K){this._binding=K,this._bindingWhenSyntax=new de.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new We.BindingOnSyntax(this._binding)}return Ne.prototype.when=function(K){return this._bindingWhenSyntax.when(K)},Ne.prototype.whenTargetNamed=function(K){return this._bindingWhenSyntax.whenTargetNamed(K)},Ne.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ne.prototype.whenTargetTagged=function(K,Re){return this._bindingWhenSyntax.whenTargetTagged(K,Re)},Ne.prototype.whenInjectedInto=function(K){return this._bindingWhenSyntax.whenInjectedInto(K)},Ne.prototype.whenParentNamed=function(K){return this._bindingWhenSyntax.whenParentNamed(K)},Ne.prototype.whenParentTagged=function(K,Re){return this._bindingWhenSyntax.whenParentTagged(K,Re)},Ne.prototype.whenAnyAncestorIs=function(K){return this._bindingWhenSyntax.whenAnyAncestorIs(K)},Ne.prototype.whenNoAncestorIs=function(K){return this._bindingWhenSyntax.whenNoAncestorIs(K)},Ne.prototype.whenAnyAncestorNamed=function(K){return this._bindingWhenSyntax.whenAnyAncestorNamed(K)},Ne.prototype.whenAnyAncestorTagged=function(K,Re){return this._bindingWhenSyntax.whenAnyAncestorTagged(K,Re)},Ne.prototype.whenNoAncestorNamed=function(K){return this._bindingWhenSyntax.whenNoAncestorNamed(K)},Ne.prototype.whenNoAncestorTagged=function(K,Re){return this._bindingWhenSyntax.whenNoAncestorTagged(K,Re)},Ne.prototype.whenAnyAncestorMatches=function(K){return this._bindingWhenSyntax.whenAnyAncestorMatches(K)},Ne.prototype.whenNoAncestorMatches=function(K){return this._bindingWhenSyntax.whenNoAncestorMatches(K)},Ne.prototype.onActivation=function(K){return this._bindingOnSyntax.onActivation(K)},Ne}();Ae.BindingWhenOnSyntax=y},98370:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingWhenSyntax=void 0;var We=fe(51811),de=fe(80758),y=function(){function Ne(K){this._binding=K}return Ne.prototype.when=function(K){return this._binding.constraint=K,new We.BindingOnSyntax(this._binding)},Ne.prototype.whenTargetNamed=function(K){return this._binding.constraint=de.namedConstraint(K),new We.BindingOnSyntax(this._binding)},Ne.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(K){var Re=K.target!==null&&!K.target.isNamed()&&!K.target.isTagged();return Re},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenTargetTagged=function(K,Re){return this._binding.constraint=de.taggedConstraint(K)(Re),new We.BindingOnSyntax(this._binding)},Ne.prototype.whenInjectedInto=function(K){return this._binding.constraint=function(Re){return de.typeConstraint(K)(Re.parentRequest)},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenParentNamed=function(K){return this._binding.constraint=function(Re){return de.namedConstraint(K)(Re.parentRequest)},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenParentTagged=function(K,Re){return this._binding.constraint=function(pe){return de.taggedConstraint(K)(Re)(pe.parentRequest)},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenAnyAncestorIs=function(K){return this._binding.constraint=function(Re){return de.traverseAncerstors(Re,de.typeConstraint(K))},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenNoAncestorIs=function(K){return this._binding.constraint=function(Re){return!de.traverseAncerstors(Re,de.typeConstraint(K))},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenAnyAncestorNamed=function(K){return this._binding.constraint=function(Re){return de.traverseAncerstors(Re,de.namedConstraint(K))},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenNoAncestorNamed=function(K){return this._binding.constraint=function(Re){return!de.traverseAncerstors(Re,de.namedConstraint(K))},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenAnyAncestorTagged=function(K,Re){return this._binding.constraint=function(pe){return de.traverseAncerstors(pe,de.taggedConstraint(K)(Re))},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenNoAncestorTagged=function(K,Re){return this._binding.constraint=function(pe){return!de.traverseAncerstors(pe,de.taggedConstraint(K)(Re))},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenAnyAncestorMatches=function(K){return this._binding.constraint=function(Re){return de.traverseAncerstors(Re,K)},new We.BindingOnSyntax(this._binding)},Ne.prototype.whenNoAncestorMatches=function(K){return this._binding.constraint=function(Re){return!de.traverseAncerstors(Re,K)},new We.BindingOnSyntax(this._binding)},Ne}();Ae.BindingWhenSyntax=y},80758:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.typeConstraint=Ae.namedConstraint=Ae.taggedConstraint=Ae.traverseAncerstors=void 0;var We=fe(6867),de=fe(47738),y=function(pe,lt){var we=pe.parentRequest;return we!==null?lt(we)?!0:y(we,lt):!1};Ae.traverseAncerstors=y;var Ne=function(pe){return function(lt){var we=function(Xe){return Xe!==null&&Xe.target!==null&&Xe.target.matchesTag(pe)(lt)};return we.metaData=new de.Metadata(pe,lt),we}};Ae.taggedConstraint=Ne;var K=Ne(We.NAMED_TAG);Ae.namedConstraint=K;var Re=function(pe){return function(lt){var we=null;if(lt!==null)if(we=lt.bindings[0],typeof pe=="string"){var Xe=we.serviceIdentifier;return Xe===pe}else{var Ct=lt.bindings[0].implementationType;return pe===Ct}return!1}};Ae.typeConstraint=Re},70600:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.multiBindToService=void 0;var fe=function(We){return function(de){return function(){for(var y=[],Ne=0;Ne<arguments.length;Ne++)y[Ne]=arguments[Ne];return y.forEach(function(K){return We.bind(K).toService(de)})}}};Ae.multiBindToService=fe},85265:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.isStackOverflowExeption=void 0;var We=fe(16674);function de(y){return y instanceof RangeError||y.message===We.STACK_OVERFLOW}Ae.isStackOverflowExeption=de},37791:function(hi,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.id=void 0;var fe=0;function We(){return fe++}Ae.id=We},55800:function(hi,Ae,fe){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.circularDependencyToException=Ae.listMetadataForTarget=Ae.listRegisteredBindingsForServiceIdentifier=Ae.getServiceIdentifierAsString=Ae.getFunctionName=void 0;var We=fe(16674);function de(we){if(typeof we=="function"){var Xe=we;return Xe.name}else{if(typeof we=="symbol")return we.toString();var Xe=we;return Xe}}Ae.getServiceIdentifierAsString=de;function y(we,Xe,Ct){var Pt="",tr=Ct(we,Xe);return tr.length!==0&&(Pt=`
Registered bindings:`,tr.forEach(function(Yt){var Wt="Object";Yt.implementationType!==null&&(Wt=lt(Yt.implementationType)),Pt=Pt+`
 `+Wt,Yt.constraint.metaData&&(Pt=Pt+" - "+Yt.constraint.metaData)})),Pt}Ae.listRegisteredBindingsForServiceIdentifier=y;function Ne(we,Xe){return we.parentRequest===null?!1:we.parentRequest.serviceIdentifier===Xe?!0:Ne(we.parentRequest,Xe)}function K(we){function Xe(Pt,tr){tr===void 0&&(tr=[]);var Yt=de(Pt.serviceIdentifier);return tr.push(Yt),Pt.parentRequest!==null?Xe(Pt.parentRequest,tr):tr}var Ct=Xe(we);return Ct.reverse().join(" --> ")}function Re(we){we.childRequests.forEach(function(Xe){if(Ne(Xe,Xe.serviceIdentifier)){var Ct=K(Xe);throw new Error(We.CIRCULAR_DEPENDENCY+" "+Ct)}else Re(Xe)})}Ae.circularDependencyToException=Re;function pe(we,Xe){if(Xe.isTagged()||Xe.isNamed()){var Ct="",Pt=Xe.getNamedTag(),tr=Xe.getCustomTags();return Pt!==null&&(Ct+=Pt.toString()+`
`),tr!==null&&tr.forEach(function(Yt){Ct+=Yt.toString()+`
`})," "+we+`
 `+we+" - "+Ct}else return" "+we}Ae.listMetadataForTarget=pe;function lt(we){if(we.name)return we.name;var Xe=we.toString(),Ct=Xe.match(/^function\s*([^\s(]+)/);return Ct?Ct[1]:"Anonymous function: "+Xe}Ae.getFunctionName=lt},31745:function(hi){"use strict";hi.exports=fe,hi.exports.default=fe;var Ae=1e20;function fe(K,Re,pe,lt,we,Xe){this.fontSize=K||24,this.buffer=Re===void 0?3:Re,this.cutoff=lt||.25,this.fontFamily=we||"sans-serif",this.fontWeight=Xe||"normal",this.radius=pe||8;var Ct=this.size=this.fontSize+this.buffer*2,Pt=Ct+this.buffer*2,tr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;tr?this.canvas=my.createOffscreenCanvas(Ct,Ct,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ct),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Pt*Pt),this.gridInner=new Float64Array(Pt*Pt),this.f=new Float64Array(Pt),this.z=new Float64Array(Pt+1),this.v=new Uint16Array(Pt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,tr?this.middle=Math.round(Ct/2*1):this.middle=Math.round(Ct/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function We(K,Re,pe,lt,we,Xe,Ct){Xe.fill(Ae,0,Re*pe),Ct.fill(0,0,Re*pe);for(var Pt=(Re-lt)/2,tr=0;tr<we;tr++)for(var Yt=0;Yt<lt;Yt++){var Wt=(tr+Pt)*Re+Yt+Pt,br=K.data[4*(tr*lt+Yt)+3]/255;if(br===1)Xe[Wt]=0,Ct[Wt]=Ae;else if(br===0)Xe[Wt]=Ae,Ct[Wt]=0;else{var lr=Math.max(0,.5-br),kt=Math.max(0,br-.5);Xe[Wt]=lr*lr,Ct[Wt]=kt*kt}}}function de(K,Re,pe,lt,we,Xe,Ct){for(var Pt=0;Pt<Re*pe;Pt++){var tr=Math.sqrt(lt[Pt])-Math.sqrt(we[Pt]);K[Pt]=Math.round(255-255*(tr/Xe+Ct))}}fe.prototype._draw=function(K,Re){var pe=this.ctx.measureText(K),lt=pe.width,we=2*this.buffer,Xe,Ct,Pt,tr,Yt,Wt,br,lr;Re&&this.useMetrics?(Yt=Math.floor(pe.actualBoundingBoxAscent),lr=this.buffer+Math.ceil(pe.actualBoundingBoxAscent),Wt=this.buffer,br=this.buffer,Ct=Math.min(this.size,Math.ceil(pe.actualBoundingBoxRight-pe.actualBoundingBoxLeft)),tr=Math.min(this.size-Wt,Math.ceil(pe.actualBoundingBoxAscent+pe.actualBoundingBoxDescent)),Xe=Ct+we,Pt=tr+we,this.ctx.textBaseline="alphabetic"):(Xe=Ct=this.size,Pt=tr=this.size,Yt=19*this.fontSize/24,Wt=br=0,lr=this.middle,this.ctx.textBaseline="middle");var kt;Ct&&tr&&(this.ctx.clearRect(br,Wt,Ct,tr),this.ctx.fillText(K,this.buffer,lr),kt=this.ctx.getImageData(br,Wt,Ct,tr));var zt=new Uint8ClampedArray(Xe*Pt);return We(kt,Xe,Pt,Ct,tr,this.gridOuter,this.gridInner),y(this.gridOuter,Xe,Pt,this.f,this.v,this.z),y(this.gridInner,Xe,Pt,this.f,this.v,this.z),de(zt,Xe,Pt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:zt,metrics:{width:Ct,height:tr,sdfWidth:Xe,sdfHeight:Pt,top:Yt,left:0,advance:lt}}},fe.prototype.draw=function(K){return this._draw(K,!1).data},fe.prototype.drawWithMetrics=function(K){return this._draw(K,!0)};function y(K,Re,pe,lt,we,Xe){for(var Ct=0;Ct<Re;Ct++)Ne(K,Ct,Re,pe,lt,we,Xe);for(var Pt=0;Pt<pe;Pt++)Ne(K,Pt*Re,1,Re,lt,we,Xe)}function Ne(K,Re,pe,lt,we,Xe,Ct){var Pt,tr,Yt,Wt;for(Xe[0]=0,Ct[0]=-Ae,Ct[1]=Ae,Pt=0;Pt<lt;Pt++)we[Pt]=K[Re+Pt*pe];for(Pt=1,tr=0,Yt=0;Pt<lt;Pt++){do Wt=Xe[tr],Yt=(we[Pt]-we[Wt]+Pt*Pt-Wt*Wt)/(Pt-Wt)/2;while(Yt<=Ct[tr]&&--tr>-1);tr++,Xe[tr]=Pt,Ct[tr]=Yt,Ct[tr+1]=Ae}for(Pt=0,tr=0;Pt<lt;Pt++){for(;Ct[tr+1]<Pt;)tr++;Wt=Xe[tr],K[Re+Pt*pe]=we[Wt]+(Pt-Wt)*(Pt-Wt)}}},18857:function(hi,Ae,fe){"use strict";fe.r(Ae),fe.d(Ae,{Function:function(){return ul},Interpreter:function(){return ps},default:function(){return jc},evaluate:function(){return gf},vm:function(){return We}});var We={};fe.r(We),fe.d(We,{Script:function(){return qs},compileFunction:function(){return Su},createContext:function(){return iu},runInContext:function(){return mf},runInNewContext:function(){return zh}});var de={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ne={5:y,"5module":y+" export import",6:y+" const class extends export import super"},K=/^in(stanceof)?$/,Re="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",pe="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",lt=new RegExp("["+Re+"]"),we=new RegExp("["+Re+pe+"]");Re=pe=null;var Xe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ct=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Pt(b,k){for(var G=65536,D=0;D<k.length;D+=2){if(G+=k[D],G>b)return!1;if(G+=k[D+1],G>=b)return!0}}function tr(b,k){return b<65?b===36:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&lt.test(String.fromCharCode(b)):k===!1?!1:Pt(b,Xe)}function Yt(b,k){return b<48?b===36:b<58?!0:b<65?!1:b<91?!0:b<97?b===95:b<123?!0:b<=65535?b>=170&&we.test(String.fromCharCode(b)):k===!1?!1:Pt(b,Xe)||Pt(b,Ct)}var Wt=function(k,G){G===void 0&&(G={}),this.label=k,this.keyword=G.keyword,this.beforeExpr=!!G.beforeExpr,this.startsExpr=!!G.startsExpr,this.isLoop=!!G.isLoop,this.isAssign=!!G.isAssign,this.prefix=!!G.prefix,this.postfix=!!G.postfix,this.binop=G.binop||null,this.updateContext=null};function br(b,k){return new Wt(b,{beforeExpr:!0,binop:k})}var lr={beforeExpr:!0},kt={startsExpr:!0},zt={};function Pr(b,k){return k===void 0&&(k={}),k.keyword=b,zt[b]=new Wt(b,k)}var re={num:new Wt("num",kt),regexp:new Wt("regexp",kt),string:new Wt("string",kt),name:new Wt("name",kt),eof:new Wt("eof"),bracketL:new Wt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Wt("]"),braceL:new Wt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Wt("}"),parenL:new Wt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Wt(")"),comma:new Wt(",",lr),semi:new Wt(";",lr),colon:new Wt(":",lr),dot:new Wt("."),question:new Wt("?",lr),questionDot:new Wt("?."),arrow:new Wt("=>",lr),template:new Wt("template"),invalidTemplate:new Wt("invalidTemplate"),ellipsis:new Wt("...",lr),backQuote:new Wt("`",kt),dollarBraceL:new Wt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Wt("=",{beforeExpr:!0,isAssign:!0}),assign:new Wt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Wt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Wt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:br("||",1),logicalAND:br("&&",2),bitwiseOR:br("|",3),bitwiseXOR:br("^",4),bitwiseAND:br("&",5),equality:br("==/!=/===/!==",6),relational:br("</>/<=/>=",7),bitShift:br("<</>>/>>>",8),plusMin:new Wt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:br("%",10),star:br("*",10),slash:br("/",10),starstar:new Wt("**",{beforeExpr:!0}),coalesce:br("??",1),_break:Pr("break"),_case:Pr("case",lr),_catch:Pr("catch"),_continue:Pr("continue"),_debugger:Pr("debugger"),_default:Pr("default",lr),_do:Pr("do",{isLoop:!0,beforeExpr:!0}),_else:Pr("else",lr),_finally:Pr("finally"),_for:Pr("for",{isLoop:!0}),_function:Pr("function",kt),_if:Pr("if"),_return:Pr("return",lr),_switch:Pr("switch"),_throw:Pr("throw",lr),_try:Pr("try"),_var:Pr("var"),_const:Pr("const"),_while:Pr("while",{isLoop:!0}),_with:Pr("with"),_new:Pr("new",{beforeExpr:!0,startsExpr:!0}),_this:Pr("this",kt),_super:Pr("super",kt),_class:Pr("class",kt),_extends:Pr("extends",lr),_export:Pr("export"),_import:Pr("import",kt),_null:Pr("null",kt),_true:Pr("true",kt),_false:Pr("false",kt),_in:Pr("in",{beforeExpr:!0,binop:7}),_instanceof:Pr("instanceof",{beforeExpr:!0,binop:7}),_typeof:Pr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Pr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Pr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},yr=/\r\n?|\n|\u2028|\u2029/,Rt=new RegExp(yr.source,"g");function _t(b,k){return b===10||b===13||!k&&(b===8232||b===8233)}var Kt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ue=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Er=Object.prototype,an=Er.hasOwnProperty,ue=Er.toString;function rt(b,k){return an.call(b,k)}var Z=Array.isArray||function(b){return ue.call(b)==="[object Array]"};function _e(b){return new RegExp("^(?:"+b.replace(/ /g,"|")+")$")}var ze=function(k,G){this.line=k,this.column=G};ze.prototype.offset=function(k){return new ze(this.line,this.column+k)};var St=function(k,G,D){this.start=G,this.end=D,k.sourceFile!==null&&(this.source=k.sourceFile)};function Ut(b,k){for(var G=1,D=0;;){Rt.lastIndex=D;var ne=Rt.exec(b);if(ne&&ne.index<k)++G,D=ne.index+ne[0].length;else return new ze(G,k-D)}}var cr={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function wt(b){var k={};for(var G in cr)k[G]=b&&rt(b,G)?b[G]:cr[G];if(k.ecmaVersion>=2015&&(k.ecmaVersion-=2009),k.allowReserved==null&&(k.allowReserved=k.ecmaVersion<5),Z(k.onToken)){var D=k.onToken;k.onToken=function(ne){return D.push(ne)}}return Z(k.onComment)&&(k.onComment=Or(k,k.onComment)),k}function Or(b,k){return function(G,D,ne,Oe,dt,Mt){var Zt={type:G?"Block":"Line",value:D,start:ne,end:Oe};b.locations&&(Zt.loc=new St(this,dt,Mt)),b.ranges&&(Zt.range=[ne,Oe]),k.push(Zt)}}var Xn=1,Qr=2,Pi=Xn|Qr,mi=4,ln=8,ba=16,ua=32,Li=64,Ma=128;function ai(b,k){return Qr|(b?mi:0)|(k?ln:0)}var Ki=0,ci=1,gi=2,zo=3,go=4,no=5,It=function(k,G,D){this.options=k=wt(k),this.sourceFile=k.sourceFile,this.keywords=_e(Ne[k.ecmaVersion>=6?6:k.sourceType==="module"?"5module":5]);var ne="";if(k.allowReserved!==!0){for(var Oe=k.ecmaVersion;!(ne=de[Oe]);Oe--);k.sourceType==="module"&&(ne+=" await")}this.reservedWords=_e(ne);var dt=(ne?ne+" ":"")+de.strict;this.reservedWordsStrict=_e(dt),this.reservedWordsStrictBind=_e(dt+" "+de.strictBind),this.input=String(G),this.containsEsc=!1,D?(this.pos=D,this.lineStart=this.input.lastIndexOf(`
`,D-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(yr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=re.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=k.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&k.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Xn),this.regexpState=null},ge={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};It.prototype.parse=function(){var k=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(k)},ge.inFunction.get=function(){return(this.currentVarScope().flags&Qr)>0},ge.inGenerator.get=function(){return(this.currentVarScope().flags&ln)>0},ge.inAsync.get=function(){return(this.currentVarScope().flags&mi)>0},ge.allowSuper.get=function(){return(this.currentThisScope().flags&Li)>0},ge.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Ma)>0},ge.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},It.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Qr)>0},It.extend=function(){for(var k=[],G=arguments.length;G--;)k[G]=arguments[G];for(var D=this,ne=0;ne<k.length;ne++)D=k[ne](D);return D},It.parse=function(k,G){return new this(G,k).parse()},It.parseExpressionAt=function(k,G,D){var ne=new this(D,k,G);return ne.nextToken(),ne.parseExpression()},It.tokenizer=function(k,G){return new this(G,k)},Object.defineProperties(It.prototype,ge);var oe=It.prototype,Te=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;oe.strictDirective=function(b){for(;;){Ue.lastIndex=b,b+=Ue.exec(this.input)[0].length;var k=Te.exec(this.input.slice(b));if(!k)return!1;if((k[1]||k[2])==="use strict"){Ue.lastIndex=b+k[0].length;var G=Ue.exec(this.input),D=G.index+G[0].length,ne=this.input.charAt(D);return ne===";"||ne==="}"||yr.test(G[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ne)||ne==="!"&&this.input.charAt(D+1)==="=")}b+=k[0].length,Ue.lastIndex=b,b+=Ue.exec(this.input)[0].length,this.input[b]===";"&&b++}},oe.eat=function(b){return this.type===b?(this.next(),!0):!1},oe.isContextual=function(b){return this.type===re.name&&this.value===b&&!this.containsEsc},oe.eatContextual=function(b){return this.isContextual(b)?(this.next(),!0):!1},oe.expectContextual=function(b){this.eatContextual(b)||this.unexpected()},oe.canInsertSemicolon=function(){return this.type===re.eof||this.type===re.braceR||yr.test(this.input.slice(this.lastTokEnd,this.start))},oe.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},oe.semicolon=function(){!this.eat(re.semi)&&!this.insertSemicolon()&&this.unexpected()},oe.afterTrailingComma=function(b,k){if(this.type===b)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),k||this.next(),!0},oe.expect=function(b){this.eat(b)||this.unexpected()},oe.unexpected=function(b){this.raise(b!=null?b:this.start,"Unexpected token")};function j(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}oe.checkPatternErrors=function(b,k){if(!!b){b.trailingComma>-1&&this.raiseRecoverable(b.trailingComma,"Comma is not permitted after the rest element");var G=k?b.parenthesizedAssign:b.parenthesizedBind;G>-1&&this.raiseRecoverable(G,"Parenthesized pattern")}},oe.checkExpressionErrors=function(b,k){if(!b)return!1;var G=b.shorthandAssign,D=b.doubleProto;if(!k)return G>=0||D>=0;G>=0&&this.raise(G,"Shorthand property assignments are valid only in destructuring patterns"),D>=0&&this.raiseRecoverable(D,"Redefinition of __proto__ property")},oe.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},oe.isSimpleAssignTarget=function(b){return b.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(b.expression):b.type==="Identifier"||b.type==="MemberExpression"};var ot=It.prototype;ot.parseTopLevel=function(b){var k={};for(b.body||(b.body=[]);this.type!==re.eof;){var G=this.parseStatement(null,!0,k);b.body.push(G)}if(this.inModule)for(var D=0,ne=Object.keys(this.undefinedExports);D<ne.length;D+=1){var Oe=ne[D];this.raiseRecoverable(this.undefinedExports[Oe].start,"Export '"+Oe+"' is not defined")}return this.adaptDirectivePrologue(b.body),this.next(),b.sourceType=this.options.sourceType,this.finishNode(b,"Program")};var sr={kind:"loop"},Yr={kind:"switch"};ot.isLet=function(b){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ue.lastIndex=this.pos;var k=Ue.exec(this.input),G=this.pos+k[0].length,D=this.input.charCodeAt(G);if(D===91)return!0;if(b)return!1;if(D===123)return!0;if(tr(D,!0)){for(var ne=G+1;Yt(this.input.charCodeAt(ne),!0);)++ne;var Oe=this.input.slice(G,ne);if(!K.test(Oe))return!0}return!1},ot.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ue.lastIndex=this.pos;var b=Ue.exec(this.input),k=this.pos+b[0].length;return!yr.test(this.input.slice(this.pos,k))&&this.input.slice(k,k+8)==="function"&&(k+8===this.input.length||!Yt(this.input.charAt(k+8)))},ot.parseStatement=function(b,k,G){var D=this.type,ne=this.startNode(),Oe;switch(this.isLet(b)&&(D=re._var,Oe="let"),D){case re._break:case re._continue:return this.parseBreakContinueStatement(ne,D.keyword);case re._debugger:return this.parseDebuggerStatement(ne);case re._do:return this.parseDoStatement(ne);case re._for:return this.parseForStatement(ne);case re._function:return b&&(this.strict||b!=="if"&&b!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ne,!1,!b);case re._class:return b&&this.unexpected(),this.parseClass(ne,!0);case re._if:return this.parseIfStatement(ne);case re._return:return this.parseReturnStatement(ne);case re._switch:return this.parseSwitchStatement(ne);case re._throw:return this.parseThrowStatement(ne);case re._try:return this.parseTryStatement(ne);case re._const:case re._var:return Oe=Oe||this.value,b&&Oe!=="var"&&this.unexpected(),this.parseVarStatement(ne,Oe);case re._while:return this.parseWhileStatement(ne);case re._with:return this.parseWithStatement(ne);case re.braceL:return this.parseBlock(!0,ne);case re.semi:return this.parseEmptyStatement(ne);case re._export:case re._import:if(this.options.ecmaVersion>10&&D===re._import){Ue.lastIndex=this.pos;var dt=Ue.exec(this.input),Mt=this.pos+dt[0].length,Zt=this.input.charCodeAt(Mt);if(Zt===40||Zt===46)return this.parseExpressionStatement(ne,this.parseExpression())}return this.options.allowImportExportEverywhere||(k||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),D===re._import?this.parseImport(ne):this.parseExport(ne,G);default:if(this.isAsyncFunction())return b&&this.unexpected(),this.next(),this.parseFunctionStatement(ne,!0,!b);var Br=this.value,Gr=this.parseExpression();return D===re.name&&Gr.type==="Identifier"&&this.eat(re.colon)?this.parseLabeledStatement(ne,Br,Gr,b):this.parseExpressionStatement(ne,Gr)}},ot.parseBreakContinueStatement=function(b,k){var G=k==="break";this.next(),this.eat(re.semi)||this.insertSemicolon()?b.label=null:this.type!==re.name?this.unexpected():(b.label=this.parseIdent(),this.semicolon());for(var D=0;D<this.labels.length;++D){var ne=this.labels[D];if((b.label==null||ne.name===b.label.name)&&(ne.kind!=null&&(G||ne.kind==="loop")||b.label&&G))break}return D===this.labels.length&&this.raise(b.start,"Unsyntactic "+k),this.finishNode(b,G?"BreakStatement":"ContinueStatement")},ot.parseDebuggerStatement=function(b){return this.next(),this.semicolon(),this.finishNode(b,"DebuggerStatement")},ot.parseDoStatement=function(b){return this.next(),this.labels.push(sr),b.body=this.parseStatement("do"),this.labels.pop(),this.expect(re._while),b.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(re.semi):this.semicolon(),this.finishNode(b,"DoWhileStatement")},ot.parseForStatement=function(b){this.next();var k=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(sr),this.enterScope(0),this.expect(re.parenL),this.type===re.semi)return k>-1&&this.unexpected(k),this.parseFor(b,null);var G=this.isLet();if(this.type===re._var||this.type===re._const||G){var D=this.startNode(),ne=G?"let":this.value;return this.next(),this.parseVar(D,!0,ne),this.finishNode(D,"VariableDeclaration"),(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&D.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===re._in?k>-1&&this.unexpected(k):b.await=k>-1),this.parseForIn(b,D)):(k>-1&&this.unexpected(k),this.parseFor(b,D))}var Oe=new j,dt=this.parseExpression(!0,Oe);return this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===re._in?k>-1&&this.unexpected(k):b.await=k>-1),this.toAssignable(dt,!1,Oe),this.checkLVal(dt),this.parseForIn(b,dt)):(this.checkExpressionErrors(Oe,!0),k>-1&&this.unexpected(k),this.parseFor(b,dt))},ot.parseFunctionStatement=function(b,k,G){return this.next(),this.parseFunction(b,Dt|(G?0:Cr),!1,k)},ot.parseIfStatement=function(b){return this.next(),b.test=this.parseParenExpression(),b.consequent=this.parseStatement("if"),b.alternate=this.eat(re._else)?this.parseStatement("if"):null,this.finishNode(b,"IfStatement")},ot.parseReturnStatement=function(b){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(re.semi)||this.insertSemicolon()?b.argument=null:(b.argument=this.parseExpression(),this.semicolon()),this.finishNode(b,"ReturnStatement")},ot.parseSwitchStatement=function(b){this.next(),b.discriminant=this.parseParenExpression(),b.cases=[],this.expect(re.braceL),this.labels.push(Yr),this.enterScope(0);for(var k,G=!1;this.type!==re.braceR;)if(this.type===re._case||this.type===re._default){var D=this.type===re._case;k&&this.finishNode(k,"SwitchCase"),b.cases.push(k=this.startNode()),k.consequent=[],this.next(),D?k.test=this.parseExpression():(G&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),G=!0,k.test=null),this.expect(re.colon)}else k||this.unexpected(),k.consequent.push(this.parseStatement(null));return this.exitScope(),k&&this.finishNode(k,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(b,"SwitchStatement")},ot.parseThrowStatement=function(b){return this.next(),yr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),b.argument=this.parseExpression(),this.semicolon(),this.finishNode(b,"ThrowStatement")};var Ke=[];ot.parseTryStatement=function(b){if(this.next(),b.block=this.parseBlock(),b.handler=null,this.type===re._catch){var k=this.startNode();if(this.next(),this.eat(re.parenL)){k.param=this.parseBindingAtom();var G=k.param.type==="Identifier";this.enterScope(G?ua:0),this.checkLVal(k.param,G?go:gi),this.expect(re.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),k.param=null,this.enterScope(0);k.body=this.parseBlock(!1),this.exitScope(),b.handler=this.finishNode(k,"CatchClause")}return b.finalizer=this.eat(re._finally)?this.parseBlock():null,!b.handler&&!b.finalizer&&this.raise(b.start,"Missing catch or finally clause"),this.finishNode(b,"TryStatement")},ot.parseVarStatement=function(b,k){return this.next(),this.parseVar(b,!1,k),this.semicolon(),this.finishNode(b,"VariableDeclaration")},ot.parseWhileStatement=function(b){return this.next(),b.test=this.parseParenExpression(),this.labels.push(sr),b.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(b,"WhileStatement")},ot.parseWithStatement=function(b){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),b.object=this.parseParenExpression(),b.body=this.parseStatement("with"),this.finishNode(b,"WithStatement")},ot.parseEmptyStatement=function(b){return this.next(),this.finishNode(b,"EmptyStatement")},ot.parseLabeledStatement=function(b,k,G,D){for(var ne=0,Oe=this.labels;ne<Oe.length;ne+=1){var dt=Oe[ne];dt.name===k&&this.raise(G.start,"Label '"+k+"' is already declared")}for(var Mt=this.type.isLoop?"loop":this.type===re._switch?"switch":null,Zt=this.labels.length-1;Zt>=0;Zt--){var Br=this.labels[Zt];if(Br.statementStart===b.start)Br.statementStart=this.start,Br.kind=Mt;else break}return this.labels.push({name:k,kind:Mt,statementStart:this.start}),b.body=this.parseStatement(D?D.indexOf("label")===-1?D+"label":D:"label"),this.labels.pop(),b.label=G,this.finishNode(b,"LabeledStatement")},ot.parseExpressionStatement=function(b,k){return b.expression=k,this.semicolon(),this.finishNode(b,"ExpressionStatement")},ot.parseBlock=function(b,k,G){for(b===void 0&&(b=!0),k===void 0&&(k=this.startNode()),k.body=[],this.expect(re.braceL),b&&this.enterScope(0);this.type!==re.braceR;){var D=this.parseStatement(null);k.body.push(D)}return G&&(this.strict=!1),this.next(),b&&this.exitScope(),this.finishNode(k,"BlockStatement")},ot.parseFor=function(b,k){return b.init=k,this.expect(re.semi),b.test=this.type===re.semi?null:this.parseExpression(),this.expect(re.semi),b.update=this.type===re.parenR?null:this.parseExpression(),this.expect(re.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,"ForStatement")},ot.parseForIn=function(b,k){var G=this.type===re._in;return this.next(),k.type==="VariableDeclaration"&&k.declarations[0].init!=null&&(!G||this.options.ecmaVersion<8||this.strict||k.kind!=="var"||k.declarations[0].id.type!=="Identifier")?this.raise(k.start,(G?"for-in":"for-of")+" loop variable declaration may not have an initializer"):k.type==="AssignmentPattern"&&this.raise(k.start,"Invalid left-hand side in for-loop"),b.left=k,b.right=G?this.parseExpression():this.parseMaybeAssign(),this.expect(re.parenR),b.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(b,G?"ForInStatement":"ForOfStatement")},ot.parseVar=function(b,k,G){for(b.declarations=[],b.kind=G;;){var D=this.startNode();if(this.parseVarId(D,G),this.eat(re.eq)?D.init=this.parseMaybeAssign(k):G==="const"&&!(this.type===re._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():D.id.type!=="Identifier"&&!(k&&(this.type===re._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):D.init=null,b.declarations.push(this.finishNode(D,"VariableDeclarator")),!this.eat(re.comma))break}return b},ot.parseVarId=function(b,k){b.id=this.parseBindingAtom(),this.checkLVal(b.id,k==="var"?ci:gi,!1)};var Dt=1,Cr=2,_r=4;ot.parseFunction=function(b,k,G,D){this.initFunction(b),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!D)&&(this.type===re.star&&k&Cr&&this.unexpected(),b.generator=this.eat(re.star)),this.options.ecmaVersion>=8&&(b.async=!!D),k&Dt&&(b.id=k&_r&&this.type!==re.name?null:this.parseIdent(),b.id&&!(k&Cr)&&this.checkLVal(b.id,this.strict||b.generator||b.async?this.treatFunctionsAsVar?ci:gi:zo));var ne=this.yieldPos,Oe=this.awaitPos,dt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ai(b.async,b.generator)),k&Dt||(b.id=this.type===re.name?this.parseIdent():null),this.parseFunctionParams(b),this.parseFunctionBody(b,G,!1),this.yieldPos=ne,this.awaitPos=Oe,this.awaitIdentPos=dt,this.finishNode(b,k&Dt?"FunctionDeclaration":"FunctionExpression")},ot.parseFunctionParams=function(b){this.expect(re.parenL),b.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ot.parseClass=function(b,k){this.next();var G=this.strict;this.strict=!0,this.parseClassId(b,k),this.parseClassSuper(b);var D=this.startNode(),ne=!1;for(D.body=[],this.expect(re.braceL);this.type!==re.braceR;){var Oe=this.parseClassElement(b.superClass!==null);Oe&&(D.body.push(Oe),Oe.type==="MethodDefinition"&&Oe.kind==="constructor"&&(ne&&this.raise(Oe.start,"Duplicate constructor in the same class"),ne=!0))}return this.strict=G,this.next(),b.body=this.finishNode(D,"ClassBody"),this.finishNode(b,k?"ClassDeclaration":"ClassExpression")},ot.parseClassElement=function(b){var k=this;if(this.eat(re.semi))return null;var G=this.startNode(),D=function(Zt,Br){Br===void 0&&(Br=!1);var Gr=k.start,Yn=k.startLoc;return k.eatContextual(Zt)?k.type!==re.parenL&&(!Br||!k.canInsertSemicolon())?!0:(G.key&&k.unexpected(),G.computed=!1,G.key=k.startNodeAt(Gr,Yn),G.key.name=Zt,k.finishNode(G.key,"Identifier"),!1):!1};G.kind="method",G.static=D("static");var ne=this.eat(re.star),Oe=!1;ne||(this.options.ecmaVersion>=8&&D("async",!0)?(Oe=!0,ne=this.options.ecmaVersion>=9&&this.eat(re.star)):D("get")?G.kind="get":D("set")&&(G.kind="set")),G.key||this.parsePropertyName(G);var dt=G.key,Mt=!1;return!G.computed&&!G.static&&(dt.type==="Identifier"&&dt.name==="constructor"||dt.type==="Literal"&&dt.value==="constructor")?(G.kind!=="method"&&this.raise(dt.start,"Constructor can't have get/set modifier"),ne&&this.raise(dt.start,"Constructor can't be a generator"),Oe&&this.raise(dt.start,"Constructor can't be an async method"),G.kind="constructor",Mt=b):G.static&&dt.type==="Identifier"&&dt.name==="prototype"&&this.raise(dt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(G,ne,Oe,Mt),G.kind==="get"&&G.value.params.length!==0&&this.raiseRecoverable(G.value.start,"getter should have no params"),G.kind==="set"&&G.value.params.length!==1&&this.raiseRecoverable(G.value.start,"setter should have exactly one param"),G.kind==="set"&&G.value.params[0].type==="RestElement"&&this.raiseRecoverable(G.value.params[0].start,"Setter cannot use rest params"),G},ot.parseClassMethod=function(b,k,G,D){return b.value=this.parseMethod(k,G,D),this.finishNode(b,"MethodDefinition")},ot.parseClassId=function(b,k){this.type===re.name?(b.id=this.parseIdent(),k&&this.checkLVal(b.id,gi,!1)):(k===!0&&this.unexpected(),b.id=null)},ot.parseClassSuper=function(b){b.superClass=this.eat(re._extends)?this.parseExprSubscripts():null},ot.parseExport=function(b,k){if(this.next(),this.eat(re.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(b.exported=this.parseIdent(!0),this.checkExport(k,b.exported.name,this.lastTokStart)):b.exported=null),this.expectContextual("from"),this.type!==re.string&&this.unexpected(),b.source=this.parseExprAtom(),this.semicolon(),this.finishNode(b,"ExportAllDeclaration");if(this.eat(re._default)){this.checkExport(k,"default",this.lastTokStart);var G;if(this.type===re._function||(G=this.isAsyncFunction())){var D=this.startNode();this.next(),G&&this.next(),b.declaration=this.parseFunction(D,Dt|_r,!1,G)}else if(this.type===re._class){var ne=this.startNode();b.declaration=this.parseClass(ne,"nullableID")}else b.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(b,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())b.declaration=this.parseStatement(null),b.declaration.type==="VariableDeclaration"?this.checkVariableExport(k,b.declaration.declarations):this.checkExport(k,b.declaration.id.name,b.declaration.id.start),b.specifiers=[],b.source=null;else{if(b.declaration=null,b.specifiers=this.parseExportSpecifiers(k),this.eatContextual("from"))this.type!==re.string&&this.unexpected(),b.source=this.parseExprAtom();else{for(var Oe=0,dt=b.specifiers;Oe<dt.length;Oe+=1){var Mt=dt[Oe];this.checkUnreserved(Mt.local),this.checkLocalExport(Mt.local)}b.source=null}this.semicolon()}return this.finishNode(b,"ExportNamedDeclaration")},ot.checkExport=function(b,k,G){!b||(rt(b,k)&&this.raiseRecoverable(G,"Duplicate export '"+k+"'"),b[k]=!0)},ot.checkPatternExport=function(b,k){var G=k.type;if(G==="Identifier")this.checkExport(b,k.name,k.start);else if(G==="ObjectPattern")for(var D=0,ne=k.properties;D<ne.length;D+=1){var Oe=ne[D];this.checkPatternExport(b,Oe)}else if(G==="ArrayPattern")for(var dt=0,Mt=k.elements;dt<Mt.length;dt+=1){var Zt=Mt[dt];Zt&&this.checkPatternExport(b,Zt)}else G==="Property"?this.checkPatternExport(b,k.value):G==="AssignmentPattern"?this.checkPatternExport(b,k.left):G==="RestElement"?this.checkPatternExport(b,k.argument):G==="ParenthesizedExpression"&&this.checkPatternExport(b,k.expression)},ot.checkVariableExport=function(b,k){if(!!b)for(var G=0,D=k;G<D.length;G+=1){var ne=D[G];this.checkPatternExport(b,ne.id)}},ot.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},ot.parseExportSpecifiers=function(b){var k=[],G=!0;for(this.expect(re.braceL);!this.eat(re.braceR);){if(G)G=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var D=this.startNode();D.local=this.parseIdent(!0),D.exported=this.eatContextual("as")?this.parseIdent(!0):D.local,this.checkExport(b,D.exported.name,D.exported.start),k.push(this.finishNode(D,"ExportSpecifier"))}return k},ot.parseImport=function(b){return this.next(),this.type===re.string?(b.specifiers=Ke,b.source=this.parseExprAtom()):(b.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),b.source=this.type===re.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(b,"ImportDeclaration")},ot.parseImportSpecifiers=function(){var b=[],k=!0;if(this.type===re.name){var G=this.startNode();if(G.local=this.parseIdent(),this.checkLVal(G.local,gi),b.push(this.finishNode(G,"ImportDefaultSpecifier")),!this.eat(re.comma))return b}if(this.type===re.star){var D=this.startNode();return this.next(),this.expectContextual("as"),D.local=this.parseIdent(),this.checkLVal(D.local,gi),b.push(this.finishNode(D,"ImportNamespaceSpecifier")),b}for(this.expect(re.braceL);!this.eat(re.braceR);){if(k)k=!1;else if(this.expect(re.comma),this.afterTrailingComma(re.braceR))break;var ne=this.startNode();ne.imported=this.parseIdent(!0),this.eatContextual("as")?ne.local=this.parseIdent():(this.checkUnreserved(ne.imported),ne.local=ne.imported),this.checkLVal(ne.local,gi),b.push(this.finishNode(ne,"ImportSpecifier"))}return b},ot.adaptDirectivePrologue=function(b){for(var k=0;k<b.length&&this.isDirectiveCandidate(b[k]);++k)b[k].directive=b[k].expression.raw.slice(1,-1)},ot.isDirectiveCandidate=function(b){return b.type==="ExpressionStatement"&&b.expression.type==="Literal"&&typeof b.expression.value=="string"&&(this.input[b.start]==='"'||this.input[b.start]==="'")};var Rr=It.prototype;Rr.toAssignable=function(b,k,G){if(this.options.ecmaVersion>=6&&b)switch(b.type){case"Identifier":this.inAsync&&b.name==="await"&&this.raise(b.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":b.type="ObjectPattern",G&&this.checkPatternErrors(G,!0);for(var D=0,ne=b.properties;D<ne.length;D+=1){var Oe=ne[D];this.toAssignable(Oe,k),Oe.type==="RestElement"&&(Oe.argument.type==="ArrayPattern"||Oe.argument.type==="ObjectPattern")&&this.raise(Oe.argument.start,"Unexpected token")}break;case"Property":b.kind!=="init"&&this.raise(b.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(b.value,k);break;case"ArrayExpression":b.type="ArrayPattern",G&&this.checkPatternErrors(G,!0),this.toAssignableList(b.elements,k);break;case"SpreadElement":b.type="RestElement",this.toAssignable(b.argument,k),b.argument.type==="AssignmentPattern"&&this.raise(b.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":b.operator!=="="&&this.raise(b.left.end,"Only '=' operator can be used for specifying default value."),b.type="AssignmentPattern",delete b.operator,this.toAssignable(b.left,k);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(b.expression,k,G);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!k)break;default:this.raise(b.start,"Assigning to rvalue")}else G&&this.checkPatternErrors(G,!0);return b},Rr.toAssignableList=function(b,k){for(var G=b.length,D=0;D<G;D++){var ne=b[D];ne&&this.toAssignable(ne,k)}if(G){var Oe=b[G-1];this.options.ecmaVersion===6&&k&&Oe&&Oe.type==="RestElement"&&Oe.argument.type!=="Identifier"&&this.unexpected(Oe.argument.start)}return b},Rr.parseSpread=function(b){var k=this.startNode();return this.next(),k.argument=this.parseMaybeAssign(!1,b),this.finishNode(k,"SpreadElement")},Rr.parseRestBinding=function(){var b=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==re.name&&this.unexpected(),b.argument=this.parseBindingAtom(),this.finishNode(b,"RestElement")},Rr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case re.bracketL:var b=this.startNode();return this.next(),b.elements=this.parseBindingList(re.bracketR,!0,!0),this.finishNode(b,"ArrayPattern");case re.braceL:return this.parseObj(!0)}return this.parseIdent()},Rr.parseBindingList=function(b,k,G){for(var D=[],ne=!0;!this.eat(b);)if(ne?ne=!1:this.expect(re.comma),k&&this.type===re.comma)D.push(null);else{if(G&&this.afterTrailingComma(b))break;if(this.type===re.ellipsis){var Oe=this.parseRestBinding();this.parseBindingListItem(Oe),D.push(Oe),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(b);break}else{var dt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(dt),D.push(dt)}}return D},Rr.parseBindingListItem=function(b){return b},Rr.parseMaybeDefault=function(b,k,G){if(G=G||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(re.eq))return G;var D=this.startNodeAt(b,k);return D.left=G,D.right=this.parseMaybeAssign(),this.finishNode(D,"AssignmentPattern")},Rr.checkLVal=function(b,k,G){switch(k===void 0&&(k=Ki),b.type){case"Identifier":k===gi&&b.name==="let"&&this.raiseRecoverable(b.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(b.name)&&this.raiseRecoverable(b.start,(k?"Binding ":"Assigning to ")+b.name+" in strict mode"),G&&(rt(G,b.name)&&this.raiseRecoverable(b.start,"Argument name clash"),G[b.name]=!0),k!==Ki&&k!==no&&this.declareName(b.name,k,b.start);break;case"ChainExpression":this.raiseRecoverable(b.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":k&&this.raiseRecoverable(b.start,"Binding member expression");break;case"ObjectPattern":for(var D=0,ne=b.properties;D<ne.length;D+=1){var Oe=ne[D];this.checkLVal(Oe,k,G)}break;case"Property":this.checkLVal(b.value,k,G);break;case"ArrayPattern":for(var dt=0,Mt=b.elements;dt<Mt.length;dt+=1){var Zt=Mt[dt];Zt&&this.checkLVal(Zt,k,G)}break;case"AssignmentPattern":this.checkLVal(b.left,k,G);break;case"RestElement":this.checkLVal(b.argument,k,G);break;case"ParenthesizedExpression":this.checkLVal(b.expression,k,G);break;default:this.raise(b.start,(k?"Binding":"Assigning to")+" rvalue")}};var mn=It.prototype;mn.checkPropClash=function(b,k,G){if(!(this.options.ecmaVersion>=9&&b.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(b.computed||b.method||b.shorthand))){var D=b.key,ne;switch(D.type){case"Identifier":ne=D.name;break;case"Literal":ne=String(D.value);break;default:return}var Oe=b.kind;if(this.options.ecmaVersion>=6){ne==="__proto__"&&Oe==="init"&&(k.proto&&(G?G.doubleProto<0&&(G.doubleProto=D.start):this.raiseRecoverable(D.start,"Redefinition of __proto__ property")),k.proto=!0);return}ne="$"+ne;var dt=k[ne];if(dt){var Mt;Oe==="init"?Mt=this.strict&&dt.init||dt.get||dt.set:Mt=dt.init||dt[Oe],Mt&&this.raiseRecoverable(D.start,"Redefinition of property")}else dt=k[ne]={init:!1,get:!1,set:!1};dt[Oe]=!0}},mn.parseExpression=function(b,k){var G=this.start,D=this.startLoc,ne=this.parseMaybeAssign(b,k);if(this.type===re.comma){var Oe=this.startNodeAt(G,D);for(Oe.expressions=[ne];this.eat(re.comma);)Oe.expressions.push(this.parseMaybeAssign(b,k));return this.finishNode(Oe,"SequenceExpression")}return ne},mn.parseMaybeAssign=function(b,k,G){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(b);this.exprAllowed=!1}var D=!1,ne=-1,Oe=-1;k?(ne=k.parenthesizedAssign,Oe=k.trailingComma,k.parenthesizedAssign=k.trailingComma=-1):(k=new j,D=!0);var dt=this.start,Mt=this.startLoc;(this.type===re.parenL||this.type===re.name)&&(this.potentialArrowAt=this.start);var Zt=this.parseMaybeConditional(b,k);if(G&&(Zt=G.call(this,Zt,dt,Mt)),this.type.isAssign){var Br=this.startNodeAt(dt,Mt);return Br.operator=this.value,Br.left=this.type===re.eq?this.toAssignable(Zt,!1,k):Zt,D||(k.parenthesizedAssign=k.trailingComma=k.doubleProto=-1),k.shorthandAssign>=Br.left.start&&(k.shorthandAssign=-1),this.checkLVal(Zt),this.next(),Br.right=this.parseMaybeAssign(b),this.finishNode(Br,"AssignmentExpression")}else D&&this.checkExpressionErrors(k,!0);return ne>-1&&(k.parenthesizedAssign=ne),Oe>-1&&(k.trailingComma=Oe),Zt},mn.parseMaybeConditional=function(b,k){var G=this.start,D=this.startLoc,ne=this.parseExprOps(b,k);if(this.checkExpressionErrors(k))return ne;if(this.eat(re.question)){var Oe=this.startNodeAt(G,D);return Oe.test=ne,Oe.consequent=this.parseMaybeAssign(),this.expect(re.colon),Oe.alternate=this.parseMaybeAssign(b),this.finishNode(Oe,"ConditionalExpression")}return ne},mn.parseExprOps=function(b,k){var G=this.start,D=this.startLoc,ne=this.parseMaybeUnary(k,!1);return this.checkExpressionErrors(k)||ne.start===G&&ne.type==="ArrowFunctionExpression"?ne:this.parseExprOp(ne,G,D,-1,b)},mn.parseExprOp=function(b,k,G,D,ne){var Oe=this.type.binop;if(Oe!=null&&(!ne||this.type!==re._in)&&Oe>D){var dt=this.type===re.logicalOR||this.type===re.logicalAND,Mt=this.type===re.coalesce;Mt&&(Oe=re.logicalAND.binop);var Zt=this.value;this.next();var Br=this.start,Gr=this.startLoc,Yn=this.parseExprOp(this.parseMaybeUnary(null,!1),Br,Gr,Oe,ne),ji=this.buildBinary(k,G,b,Yn,Zt,dt||Mt);return(dt&&this.type===re.coalesce||Mt&&(this.type===re.logicalOR||this.type===re.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ji,k,G,D,ne)}return b},mn.buildBinary=function(b,k,G,D,ne,Oe){var dt=this.startNodeAt(b,k);return dt.left=G,dt.operator=ne,dt.right=D,this.finishNode(dt,Oe?"LogicalExpression":"BinaryExpression")},mn.parseMaybeUnary=function(b,k){var G=this.start,D=this.startLoc,ne;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ne=this.parseAwait(),k=!0;else if(this.type.prefix){var Oe=this.startNode(),dt=this.type===re.incDec;Oe.operator=this.value,Oe.prefix=!0,this.next(),Oe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(b,!0),dt?this.checkLVal(Oe.argument):this.strict&&Oe.operator==="delete"&&Oe.argument.type==="Identifier"?this.raiseRecoverable(Oe.start,"Deleting local variable in strict mode"):k=!0,ne=this.finishNode(Oe,dt?"UpdateExpression":"UnaryExpression")}else{if(ne=this.parseExprSubscripts(b),this.checkExpressionErrors(b))return ne;for(;this.type.postfix&&!this.canInsertSemicolon();){var Mt=this.startNodeAt(G,D);Mt.operator=this.value,Mt.prefix=!1,Mt.argument=ne,this.checkLVal(ne),this.next(),ne=this.finishNode(Mt,"UpdateExpression")}}return!k&&this.eat(re.starstar)?this.buildBinary(G,D,ne,this.parseMaybeUnary(null,!1),"**",!1):ne},mn.parseExprSubscripts=function(b){var k=this.start,G=this.startLoc,D=this.parseExprAtom(b);if(D.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return D;var ne=this.parseSubscripts(D,k,G);return b&&ne.type==="MemberExpression"&&(b.parenthesizedAssign>=ne.start&&(b.parenthesizedAssign=-1),b.parenthesizedBind>=ne.start&&(b.parenthesizedBind=-1)),ne},mn.parseSubscripts=function(b,k,G,D){for(var ne=this.options.ecmaVersion>=8&&b.type==="Identifier"&&b.name==="async"&&this.lastTokEnd===b.end&&!this.canInsertSemicolon()&&b.end-b.start==5&&this.potentialArrowAt===b.start,Oe=!1;;){var dt=this.parseSubscript(b,k,G,D,ne,Oe);if(dt.optional&&(Oe=!0),dt===b||dt.type==="ArrowFunctionExpression"){if(Oe){var Mt=this.startNodeAt(k,G);Mt.expression=dt,dt=this.finishNode(Mt,"ChainExpression")}return dt}b=dt}},mn.parseSubscript=function(b,k,G,D,ne,Oe){var dt=this.options.ecmaVersion>=11,Mt=dt&&this.eat(re.questionDot);D&&Mt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Zt=this.eat(re.bracketL);if(Zt||Mt&&this.type!==re.parenL&&this.type!==re.backQuote||this.eat(re.dot)){var Br=this.startNodeAt(k,G);Br.object=b,Br.property=Zt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Br.computed=!!Zt,Zt&&this.expect(re.bracketR),dt&&(Br.optional=Mt),b=this.finishNode(Br,"MemberExpression")}else if(!D&&this.eat(re.parenL)){var Gr=new j,Yn=this.yieldPos,ji=this.awaitPos,Ui=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Fi=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1,Gr);if(ne&&!Mt&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(Gr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Yn,this.awaitPos=ji,this.awaitIdentPos=Ui,this.parseArrowExpression(this.startNodeAt(k,G),Fi,!0);this.checkExpressionErrors(Gr,!0),this.yieldPos=Yn||this.yieldPos,this.awaitPos=ji||this.awaitPos,this.awaitIdentPos=Ui||this.awaitIdentPos;var io=this.startNodeAt(k,G);io.callee=b,io.arguments=Fi,dt&&(io.optional=Mt),b=this.finishNode(io,"CallExpression")}else if(this.type===re.backQuote){(Mt||Oe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var vo=this.startNodeAt(k,G);vo.tag=b,vo.quasi=this.parseTemplate({isTagged:!0}),b=this.finishNode(vo,"TaggedTemplateExpression")}return b},mn.parseExprAtom=function(b){this.type===re.slash&&this.readRegexp();var k,G=this.potentialArrowAt===this.start;switch(this.type){case re._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),k=this.startNode(),this.next(),this.type===re.parenL&&!this.allowDirectSuper&&this.raise(k.start,"super() call outside constructor of a subclass"),this.type!==re.dot&&this.type!==re.bracketL&&this.type!==re.parenL&&this.unexpected(),this.finishNode(k,"Super");case re._this:return k=this.startNode(),this.next(),this.finishNode(k,"ThisExpression");case re.name:var D=this.start,ne=this.startLoc,Oe=this.containsEsc,dt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Oe&&dt.name==="async"&&!this.canInsertSemicolon()&&this.eat(re._function))return this.parseFunction(this.startNodeAt(D,ne),0,!1,!0);if(G&&!this.canInsertSemicolon()){if(this.eat(re.arrow))return this.parseArrowExpression(this.startNodeAt(D,ne),[dt],!1);if(this.options.ecmaVersion>=8&&dt.name==="async"&&this.type===re.name&&!Oe)return dt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(re.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(D,ne),[dt],!0)}return dt;case re.regexp:var Mt=this.value;return k=this.parseLiteral(Mt.value),k.regex={pattern:Mt.pattern,flags:Mt.flags},k;case re.num:case re.string:return this.parseLiteral(this.value);case re._null:case re._true:case re._false:return k=this.startNode(),k.value=this.type===re._null?null:this.type===re._true,k.raw=this.type.keyword,this.next(),this.finishNode(k,"Literal");case re.parenL:var Zt=this.start,Br=this.parseParenAndDistinguishExpression(G);return b&&(b.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Br)&&(b.parenthesizedAssign=Zt),b.parenthesizedBind<0&&(b.parenthesizedBind=Zt)),Br;case re.bracketL:return k=this.startNode(),this.next(),k.elements=this.parseExprList(re.bracketR,!0,!0,b),this.finishNode(k,"ArrayExpression");case re.braceL:return this.parseObj(!1,b);case re._function:return k=this.startNode(),this.next(),this.parseFunction(k,0);case re._class:return this.parseClass(this.startNode(),!1);case re._new:return this.parseNew();case re.backQuote:return this.parseTemplate();case re._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},mn.parseExprImport=function(){var b=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var k=this.parseIdent(!0);switch(this.type){case re.parenL:return this.parseDynamicImport(b);case re.dot:return b.meta=k,this.parseImportMeta(b);default:this.unexpected()}},mn.parseDynamicImport=function(b){if(this.next(),b.source=this.parseMaybeAssign(),!this.eat(re.parenR)){var k=this.start;this.eat(re.comma)&&this.eat(re.parenR)?this.raiseRecoverable(k,"Trailing comma is not allowed in import()"):this.unexpected(k)}return this.finishNode(b,"ImportExpression")},mn.parseImportMeta=function(b){this.next();var k=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="meta"&&this.raiseRecoverable(b.property.start,"The only valid meta property for import is 'import.meta'"),k&&this.raiseRecoverable(b.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(b.start,"Cannot use 'import.meta' outside a module"),this.finishNode(b,"MetaProperty")},mn.parseLiteral=function(b){var k=this.startNode();return k.value=b,k.raw=this.input.slice(this.start,this.end),k.raw.charCodeAt(k.raw.length-1)===110&&(k.bigint=k.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(k,"Literal")},mn.parseParenExpression=function(){this.expect(re.parenL);var b=this.parseExpression();return this.expect(re.parenR),b},mn.parseParenAndDistinguishExpression=function(b){var k=this.start,G=this.startLoc,D,ne=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Oe=this.start,dt=this.startLoc,Mt=[],Zt=!0,Br=!1,Gr=new j,Yn=this.yieldPos,ji=this.awaitPos,Ui;for(this.yieldPos=0,this.awaitPos=0;this.type!==re.parenR;)if(Zt?Zt=!1:this.expect(re.comma),ne&&this.afterTrailingComma(re.parenR,!0)){Br=!0;break}else if(this.type===re.ellipsis){Ui=this.start,Mt.push(this.parseParenItem(this.parseRestBinding())),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Mt.push(this.parseMaybeAssign(!1,Gr,this.parseParenItem));var Fi=this.start,io=this.startLoc;if(this.expect(re.parenR),b&&!this.canInsertSemicolon()&&this.eat(re.arrow))return this.checkPatternErrors(Gr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Yn,this.awaitPos=ji,this.parseParenArrowList(k,G,Mt);(!Mt.length||Br)&&this.unexpected(this.lastTokStart),Ui&&this.unexpected(Ui),this.checkExpressionErrors(Gr,!0),this.yieldPos=Yn||this.yieldPos,this.awaitPos=ji||this.awaitPos,Mt.length>1?(D=this.startNodeAt(Oe,dt),D.expressions=Mt,this.finishNodeAt(D,"SequenceExpression",Fi,io)):D=Mt[0]}else D=this.parseParenExpression();if(this.options.preserveParens){var vo=this.startNodeAt(k,G);return vo.expression=D,this.finishNode(vo,"ParenthesizedExpression")}else return D},mn.parseParenItem=function(b){return b},mn.parseParenArrowList=function(b,k,G){return this.parseArrowExpression(this.startNodeAt(b,k),G)};var vi=[];mn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var b=this.startNode(),k=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(re.dot)){b.meta=k;var G=this.containsEsc;return b.property=this.parseIdent(!0),b.property.name!=="target"&&this.raiseRecoverable(b.property.start,"The only valid meta property for new is 'new.target'"),G&&this.raiseRecoverable(b.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(b.start,"'new.target' can only be used in functions"),this.finishNode(b,"MetaProperty")}var D=this.start,ne=this.startLoc,Oe=this.type===re._import;return b.callee=this.parseSubscripts(this.parseExprAtom(),D,ne,!0),Oe&&b.callee.type==="ImportExpression"&&this.raise(D,"Cannot use new with import()"),this.eat(re.parenL)?b.arguments=this.parseExprList(re.parenR,this.options.ecmaVersion>=8,!1):b.arguments=vi,this.finishNode(b,"NewExpression")},mn.parseTemplateElement=function(b){var k=b.isTagged,G=this.startNode();return this.type===re.invalidTemplate?(k||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),G.value={raw:this.value,cooked:null}):G.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),G.tail=this.type===re.backQuote,this.finishNode(G,"TemplateElement")},mn.parseTemplate=function(b){b===void 0&&(b={});var k=b.isTagged;k===void 0&&(k=!1);var G=this.startNode();this.next(),G.expressions=[];var D=this.parseTemplateElement({isTagged:k});for(G.quasis=[D];!D.tail;)this.type===re.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(re.dollarBraceL),G.expressions.push(this.parseExpression()),this.expect(re.braceR),G.quasis.push(D=this.parseTemplateElement({isTagged:k}));return this.next(),this.finishNode(G,"TemplateLiteral")},mn.isAsyncProp=function(b){return!b.computed&&b.key.type==="Identifier"&&b.key.name==="async"&&(this.type===re.name||this.type===re.num||this.type===re.string||this.type===re.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===re.star)&&!yr.test(this.input.slice(this.lastTokEnd,this.start))},mn.parseObj=function(b,k){var G=this.startNode(),D=!0,ne={};for(G.properties=[],this.next();!this.eat(re.braceR);){if(D)D=!1;else if(this.expect(re.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(re.braceR))break;var Oe=this.parseProperty(b,k);b||this.checkPropClash(Oe,ne,k),G.properties.push(Oe)}return this.finishNode(G,b?"ObjectPattern":"ObjectExpression")},mn.parseProperty=function(b,k){var G=this.startNode(),D,ne,Oe,dt;if(this.options.ecmaVersion>=9&&this.eat(re.ellipsis))return b?(G.argument=this.parseIdent(!1),this.type===re.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(G,"RestElement")):(this.type===re.parenL&&k&&(k.parenthesizedAssign<0&&(k.parenthesizedAssign=this.start),k.parenthesizedBind<0&&(k.parenthesizedBind=this.start)),G.argument=this.parseMaybeAssign(!1,k),this.type===re.comma&&k&&k.trailingComma<0&&(k.trailingComma=this.start),this.finishNode(G,"SpreadElement"));this.options.ecmaVersion>=6&&(G.method=!1,G.shorthand=!1,(b||k)&&(Oe=this.start,dt=this.startLoc),b||(D=this.eat(re.star)));var Mt=this.containsEsc;return this.parsePropertyName(G),!b&&!Mt&&this.options.ecmaVersion>=8&&!D&&this.isAsyncProp(G)?(ne=!0,D=this.options.ecmaVersion>=9&&this.eat(re.star),this.parsePropertyName(G,k)):ne=!1,this.parsePropertyValue(G,b,D,ne,Oe,dt,k,Mt),this.finishNode(G,"Property")},mn.parsePropertyValue=function(b,k,G,D,ne,Oe,dt,Mt){if((G||D)&&this.type===re.colon&&this.unexpected(),this.eat(re.colon))b.value=k?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,dt),b.kind="init";else if(this.options.ecmaVersion>=6&&this.type===re.parenL)k&&this.unexpected(),b.kind="init",b.method=!0,b.value=this.parseMethod(G,D);else if(!k&&!Mt&&this.options.ecmaVersion>=5&&!b.computed&&b.key.type==="Identifier"&&(b.key.name==="get"||b.key.name==="set")&&this.type!==re.comma&&this.type!==re.braceR&&this.type!==re.eq){(G||D)&&this.unexpected(),b.kind=b.key.name,this.parsePropertyName(b),b.value=this.parseMethod(!1);var Zt=b.kind==="get"?0:1;if(b.value.params.length!==Zt){var Br=b.value.start;b.kind==="get"?this.raiseRecoverable(Br,"getter should have no params"):this.raiseRecoverable(Br,"setter should have exactly one param")}else b.kind==="set"&&b.value.params[0].type==="RestElement"&&this.raiseRecoverable(b.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!b.computed&&b.key.type==="Identifier"?((G||D)&&this.unexpected(),this.checkUnreserved(b.key),b.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ne),b.kind="init",k?b.value=this.parseMaybeDefault(ne,Oe,b.key):this.type===re.eq&&dt?(dt.shorthandAssign<0&&(dt.shorthandAssign=this.start),b.value=this.parseMaybeDefault(ne,Oe,b.key)):b.value=b.key,b.shorthand=!0):this.unexpected()},mn.parsePropertyName=function(b){if(this.options.ecmaVersion>=6){if(this.eat(re.bracketL))return b.computed=!0,b.key=this.parseMaybeAssign(),this.expect(re.bracketR),b.key;b.computed=!1}return b.key=this.type===re.num||this.type===re.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},mn.initFunction=function(b){b.id=null,this.options.ecmaVersion>=6&&(b.generator=b.expression=!1),this.options.ecmaVersion>=8&&(b.async=!1)},mn.parseMethod=function(b,k,G){var D=this.startNode(),ne=this.yieldPos,Oe=this.awaitPos,dt=this.awaitIdentPos;return this.initFunction(D),this.options.ecmaVersion>=6&&(D.generator=b),this.options.ecmaVersion>=8&&(D.async=!!k),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ai(k,D.generator)|Li|(G?Ma:0)),this.expect(re.parenL),D.params=this.parseBindingList(re.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(D,!1,!0),this.yieldPos=ne,this.awaitPos=Oe,this.awaitIdentPos=dt,this.finishNode(D,"FunctionExpression")},mn.parseArrowExpression=function(b,k,G){var D=this.yieldPos,ne=this.awaitPos,Oe=this.awaitIdentPos;return this.enterScope(ai(G,!1)|ba),this.initFunction(b),this.options.ecmaVersion>=8&&(b.async=!!G),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,b.params=this.toAssignableList(k,!0),this.parseFunctionBody(b,!0,!1),this.yieldPos=D,this.awaitPos=ne,this.awaitIdentPos=Oe,this.finishNode(b,"ArrowFunctionExpression")},mn.parseFunctionBody=function(b,k,G){var D=k&&this.type!==re.braceL,ne=this.strict,Oe=!1;if(D)b.body=this.parseMaybeAssign(),b.expression=!0,this.checkParams(b,!1);else{var dt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(b.params);(!ne||dt)&&(Oe=this.strictDirective(this.end),Oe&&dt&&this.raiseRecoverable(b.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Mt=this.labels;this.labels=[],Oe&&(this.strict=!0),this.checkParams(b,!ne&&!Oe&&!k&&!G&&this.isSimpleParamList(b.params)),this.strict&&b.id&&this.checkLVal(b.id,no),b.body=this.parseBlock(!1,void 0,Oe&&!ne),b.expression=!1,this.adaptDirectivePrologue(b.body.body),this.labels=Mt}this.exitScope()},mn.isSimpleParamList=function(b){for(var k=0,G=b;k<G.length;k+=1){var D=G[k];if(D.type!=="Identifier")return!1}return!0},mn.checkParams=function(b,k){for(var G={},D=0,ne=b.params;D<ne.length;D+=1){var Oe=ne[D];this.checkLVal(Oe,ci,k?null:G)}},mn.parseExprList=function(b,k,G,D){for(var ne=[],Oe=!0;!this.eat(b);){if(Oe)Oe=!1;else if(this.expect(re.comma),k&&this.afterTrailingComma(b))break;var dt=void 0;G&&this.type===re.comma?dt=null:this.type===re.ellipsis?(dt=this.parseSpread(D),D&&this.type===re.comma&&D.trailingComma<0&&(D.trailingComma=this.start)):dt=this.parseMaybeAssign(!1,D),ne.push(dt)}return ne},mn.checkUnreserved=function(b){var k=b.start,G=b.end,D=b.name;if(this.inGenerator&&D==="yield"&&this.raiseRecoverable(k,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&D==="await"&&this.raiseRecoverable(k,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(D)&&this.raise(k,"Unexpected keyword '"+D+"'"),!(this.options.ecmaVersion<6&&this.input.slice(k,G).indexOf("\\")!==-1)){var ne=this.strict?this.reservedWordsStrict:this.reservedWords;ne.test(D)&&(!this.inAsync&&D==="await"&&this.raiseRecoverable(k,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(k,"The keyword '"+D+"' is reserved"))}},mn.parseIdent=function(b,k){var G=this.startNode();return this.type===re.name?G.name=this.value:this.type.keyword?(G.name=this.type.keyword,(G.name==="class"||G.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!b),this.finishNode(G,"Identifier"),b||(this.checkUnreserved(G),G.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=G.start)),G},mn.parseYield=function(b){this.yieldPos||(this.yieldPos=this.start);var k=this.startNode();return this.next(),this.type===re.semi||this.canInsertSemicolon()||this.type!==re.star&&!this.type.startsExpr?(k.delegate=!1,k.argument=null):(k.delegate=this.eat(re.star),k.argument=this.parseMaybeAssign(b)),this.finishNode(k,"YieldExpression")},mn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var b=this.startNode();return this.next(),b.argument=this.parseMaybeUnary(null,!1),this.finishNode(b,"AwaitExpression")};var ni=It.prototype;ni.raise=function(b,k){var G=Ut(this.input,b);k+=" ("+G.line+":"+G.column+")";var D=new SyntaxError(k);throw D.pos=b,D.loc=G,D.raisedAt=this.pos,D},ni.raiseRecoverable=ni.raise,ni.curPosition=function(){if(this.options.locations)return new ze(this.curLine,this.pos-this.lineStart)};var bn=It.prototype,Oi=function(k){this.flags=k,this.var=[],this.lexical=[],this.functions=[]};bn.enterScope=function(b){this.scopeStack.push(new Oi(b))},bn.exitScope=function(){this.scopeStack.pop()},bn.treatFunctionsAsVarInScope=function(b){return b.flags&Qr||!this.inModule&&b.flags&Xn},bn.declareName=function(b,k,G){var D=!1;if(k===gi){var ne=this.currentScope();D=ne.lexical.indexOf(b)>-1||ne.functions.indexOf(b)>-1||ne.var.indexOf(b)>-1,ne.lexical.push(b),this.inModule&&ne.flags&Xn&&delete this.undefinedExports[b]}else if(k===go){var Oe=this.currentScope();Oe.lexical.push(b)}else if(k===zo){var dt=this.currentScope();this.treatFunctionsAsVar?D=dt.lexical.indexOf(b)>-1:D=dt.lexical.indexOf(b)>-1||dt.var.indexOf(b)>-1,dt.functions.push(b)}else for(var Mt=this.scopeStack.length-1;Mt>=0;--Mt){var Zt=this.scopeStack[Mt];if(Zt.lexical.indexOf(b)>-1&&!(Zt.flags&ua&&Zt.lexical[0]===b)||!this.treatFunctionsAsVarInScope(Zt)&&Zt.functions.indexOf(b)>-1){D=!0;break}if(Zt.var.push(b),this.inModule&&Zt.flags&Xn&&delete this.undefinedExports[b],Zt.flags&Pi)break}D&&this.raiseRecoverable(G,"Identifier '"+b+"' has already been declared")},bn.checkLocalExport=function(b){this.scopeStack[0].lexical.indexOf(b.name)===-1&&this.scopeStack[0].var.indexOf(b.name)===-1&&(this.undefinedExports[b.name]=b)},bn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},bn.currentVarScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&Pi)return k}},bn.currentThisScope=function(){for(var b=this.scopeStack.length-1;;b--){var k=this.scopeStack[b];if(k.flags&Pi&&!(k.flags&ba))return k}};var Ni=function(k,G,D){this.type="",this.start=G,this.end=0,k.options.locations&&(this.loc=new St(k,D)),k.options.directSourceFile&&(this.sourceFile=k.options.directSourceFile),k.options.ranges&&(this.range=[G,0])},Ha=It.prototype;Ha.startNode=function(){return new Ni(this,this.start,this.startLoc)},Ha.startNodeAt=function(b,k){return new Ni(this,b,k)};function oa(b,k,G,D){return b.type=k,b.end=G,this.options.locations&&(b.loc.end=D),this.options.ranges&&(b.range[1]=G),b}Ha.finishNode=function(b,k){return oa.call(this,b,k,this.lastTokEnd,this.lastTokEndLoc)},Ha.finishNodeAt=function(b,k,G,D){return oa.call(this,b,k,G,D)};var Wa=function(k,G,D,ne,Oe){this.token=k,this.isExpr=!!G,this.preserveSpace=!!D,this.override=ne,this.generator=!!Oe},Ci={b_stat:new Wa("{",!1),b_expr:new Wa("{",!0),b_tmpl:new Wa("${",!1),p_stat:new Wa("(",!1),p_expr:new Wa("(",!0),q_tmpl:new Wa("`",!0,!0,function(b){return b.tryReadTemplateToken()}),f_stat:new Wa("function",!1),f_expr:new Wa("function",!0),f_expr_gen:new Wa("function",!0,!1,null,!0),f_gen:new Wa("function",!1,!1,null,!0)},la=It.prototype;la.initialContext=function(){return[Ci.b_stat]},la.braceIsBlock=function(b){var k=this.curContext();return k===Ci.f_expr||k===Ci.f_stat?!0:b===re.colon&&(k===Ci.b_stat||k===Ci.b_expr)?!k.isExpr:b===re._return||b===re.name&&this.exprAllowed?yr.test(this.input.slice(this.lastTokEnd,this.start)):b===re._else||b===re.semi||b===re.eof||b===re.parenR||b===re.arrow?!0:b===re.braceL?k===Ci.b_stat:b===re._var||b===re._const||b===re.name?!1:!this.exprAllowed},la.inGeneratorContext=function(){for(var b=this.context.length-1;b>=1;b--){var k=this.context[b];if(k.token==="function")return k.generator}return!1},la.updateContext=function(b){var k,G=this.type;G.keyword&&b===re.dot?this.exprAllowed=!1:(k=G.updateContext)?k.call(this,b):this.exprAllowed=G.beforeExpr},re.parenR.updateContext=re.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var b=this.context.pop();b===Ci.b_stat&&this.curContext().token==="function"&&(b=this.context.pop()),this.exprAllowed=!b.isExpr},re.braceL.updateContext=function(b){this.context.push(this.braceIsBlock(b)?Ci.b_stat:Ci.b_expr),this.exprAllowed=!0},re.dollarBraceL.updateContext=function(){this.context.push(Ci.b_tmpl),this.exprAllowed=!0},re.parenL.updateContext=function(b){var k=b===re._if||b===re._for||b===re._with||b===re._while;this.context.push(k?Ci.p_stat:Ci.p_expr),this.exprAllowed=!0},re.incDec.updateContext=function(){},re._function.updateContext=re._class.updateContext=function(b){b.beforeExpr&&b!==re.semi&&b!==re._else&&!(b===re._return&&yr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((b===re.colon||b===re.braceL)&&this.curContext()===Ci.b_stat)?this.context.push(Ci.f_expr):this.context.push(Ci.f_stat),this.exprAllowed=!1},re.backQuote.updateContext=function(){this.curContext()===Ci.q_tmpl?this.context.pop():this.context.push(Ci.q_tmpl),this.exprAllowed=!1},re.star.updateContext=function(b){if(b===re._function){var k=this.context.length-1;this.context[k]===Ci.f_expr?this.context[k]=Ci.f_expr_gen:this.context[k]=Ci.f_gen}this.exprAllowed=!0},re.name.updateContext=function(b){var k=!1;this.options.ecmaVersion>=6&&b!==re.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(k=!0),this.exprAllowed=k};var Q="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ae=Q+" Extended_Pictographic",me=ae,ke={9:Q,10:ae,11:me},qe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",st="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",xt=st+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Me=xt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",it={9:st,10:xt,11:Me},Gt={};function Zr(b){var k=Gt[b]={binary:_e(ke[b]+" "+qe),nonBinary:{General_Category:_e(qe),Script:_e(it[b])}};k.nonBinary.Script_Extensions=k.nonBinary.Script,k.nonBinary.gc=k.nonBinary.General_Category,k.nonBinary.sc=k.nonBinary.Script,k.nonBinary.scx=k.nonBinary.Script_Extensions}Zr(9),Zr(10),Zr(11);var or=It.prototype,hr=function(k){this.parser=k,this.validFlags="gim"+(k.options.ecmaVersion>=6?"uy":"")+(k.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Gt[k.options.ecmaVersion>=11?11:k.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};hr.prototype.reset=function(k,G,D){var ne=D.indexOf("u")!==-1;this.start=k|0,this.source=G+"",this.flags=D,this.switchU=ne&&this.parser.options.ecmaVersion>=6,this.switchN=ne&&this.parser.options.ecmaVersion>=9},hr.prototype.raise=function(k){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+k)},hr.prototype.at=function(k,G){G===void 0&&(G=!1);var D=this.source,ne=D.length;if(k>=ne)return-1;var Oe=D.charCodeAt(k);if(!(G||this.switchU)||Oe<=55295||Oe>=57344||k+1>=ne)return Oe;var dt=D.charCodeAt(k+1);return dt>=56320&&dt<=57343?(Oe<<10)+dt-56613888:Oe},hr.prototype.nextIndex=function(k,G){G===void 0&&(G=!1);var D=this.source,ne=D.length;if(k>=ne)return ne;var Oe=D.charCodeAt(k),dt;return!(G||this.switchU)||Oe<=55295||Oe>=57344||k+1>=ne||(dt=D.charCodeAt(k+1))<56320||dt>57343?k+1:k+2},hr.prototype.current=function(k){return k===void 0&&(k=!1),this.at(this.pos,k)},hr.prototype.lookahead=function(k){return k===void 0&&(k=!1),this.at(this.nextIndex(this.pos,k),k)},hr.prototype.advance=function(k){k===void 0&&(k=!1),this.pos=this.nextIndex(this.pos,k)},hr.prototype.eat=function(k,G){return G===void 0&&(G=!1),this.current(G)===k?(this.advance(G),!0):!1};function jr(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}or.validateRegExpFlags=function(b){for(var k=b.validFlags,G=b.flags,D=0;D<G.length;D++){var ne=G.charAt(D);k.indexOf(ne)===-1&&this.raise(b.start,"Invalid regular expression flag"),G.indexOf(ne,D+1)>-1&&this.raise(b.start,"Duplicate regular expression flag")}},or.validateRegExpPattern=function(b){this.regexp_pattern(b),!b.switchN&&this.options.ecmaVersion>=9&&b.groupNames.length>0&&(b.switchN=!0,this.regexp_pattern(b))},or.regexp_pattern=function(b){b.pos=0,b.lastIntValue=0,b.lastStringValue="",b.lastAssertionIsQuantifiable=!1,b.numCapturingParens=0,b.maxBackReference=0,b.groupNames.length=0,b.backReferenceNames.length=0,this.regexp_disjunction(b),b.pos!==b.source.length&&(b.eat(41)&&b.raise("Unmatched ')'"),(b.eat(93)||b.eat(125))&&b.raise("Lone quantifier brackets")),b.maxBackReference>b.numCapturingParens&&b.raise("Invalid escape");for(var k=0,G=b.backReferenceNames;k<G.length;k+=1){var D=G[k];b.groupNames.indexOf(D)===-1&&b.raise("Invalid named capture referenced")}},or.regexp_disjunction=function(b){for(this.regexp_alternative(b);b.eat(124);)this.regexp_alternative(b);this.regexp_eatQuantifier(b,!0)&&b.raise("Nothing to repeat"),b.eat(123)&&b.raise("Lone quantifier brackets")},or.regexp_alternative=function(b){for(;b.pos<b.source.length&&this.regexp_eatTerm(b););},or.regexp_eatTerm=function(b){return this.regexp_eatAssertion(b)?(b.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(b)&&b.switchU&&b.raise("Invalid quantifier"),!0):(b.switchU?this.regexp_eatAtom(b):this.regexp_eatExtendedAtom(b))?(this.regexp_eatQuantifier(b),!0):!1},or.regexp_eatAssertion=function(b){var k=b.pos;if(b.lastAssertionIsQuantifiable=!1,b.eat(94)||b.eat(36))return!0;if(b.eat(92)){if(b.eat(66)||b.eat(98))return!0;b.pos=k}if(b.eat(40)&&b.eat(63)){var G=!1;if(this.options.ecmaVersion>=9&&(G=b.eat(60)),b.eat(61)||b.eat(33))return this.regexp_disjunction(b),b.eat(41)||b.raise("Unterminated group"),b.lastAssertionIsQuantifiable=!G,!0}return b.pos=k,!1},or.regexp_eatQuantifier=function(b,k){return k===void 0&&(k=!1),this.regexp_eatQuantifierPrefix(b,k)?(b.eat(63),!0):!1},or.regexp_eatQuantifierPrefix=function(b,k){return b.eat(42)||b.eat(43)||b.eat(63)||this.regexp_eatBracedQuantifier(b,k)},or.regexp_eatBracedQuantifier=function(b,k){var G=b.pos;if(b.eat(123)){var D=0,ne=-1;if(this.regexp_eatDecimalDigits(b)&&(D=b.lastIntValue,b.eat(44)&&this.regexp_eatDecimalDigits(b)&&(ne=b.lastIntValue),b.eat(125)))return ne!==-1&&ne<D&&!k&&b.raise("numbers out of order in {} quantifier"),!0;b.switchU&&!k&&b.raise("Incomplete quantifier"),b.pos=G}return!1},or.regexp_eatAtom=function(b){return this.regexp_eatPatternCharacters(b)||b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)},or.regexp_eatReverseSolidusAtomEscape=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatAtomEscape(b))return!0;b.pos=k}return!1},or.regexp_eatUncapturingGroup=function(b){var k=b.pos;if(b.eat(40)){if(b.eat(63)&&b.eat(58)){if(this.regexp_disjunction(b),b.eat(41))return!0;b.raise("Unterminated group")}b.pos=k}return!1},or.regexp_eatCapturingGroup=function(b){if(b.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(b):b.current()===63&&b.raise("Invalid group"),this.regexp_disjunction(b),b.eat(41))return b.numCapturingParens+=1,!0;b.raise("Unterminated group")}return!1},or.regexp_eatExtendedAtom=function(b){return b.eat(46)||this.regexp_eatReverseSolidusAtomEscape(b)||this.regexp_eatCharacterClass(b)||this.regexp_eatUncapturingGroup(b)||this.regexp_eatCapturingGroup(b)||this.regexp_eatInvalidBracedQuantifier(b)||this.regexp_eatExtendedPatternCharacter(b)},or.regexp_eatInvalidBracedQuantifier=function(b){return this.regexp_eatBracedQuantifier(b,!0)&&b.raise("Nothing to repeat"),!1},or.regexp_eatSyntaxCharacter=function(b){var k=b.current();return oi(k)?(b.lastIntValue=k,b.advance(),!0):!1};function oi(b){return b===36||b>=40&&b<=43||b===46||b===63||b>=91&&b<=94||b>=123&&b<=125}or.regexp_eatPatternCharacters=function(b){for(var k=b.pos,G=0;(G=b.current())!==-1&&!oi(G);)b.advance();return b.pos!==k},or.regexp_eatExtendedPatternCharacter=function(b){var k=b.current();return k!==-1&&k!==36&&!(k>=40&&k<=43)&&k!==46&&k!==63&&k!==91&&k!==94&&k!==124?(b.advance(),!0):!1},or.regexp_groupSpecifier=function(b){if(b.eat(63)){if(this.regexp_eatGroupName(b)){b.groupNames.indexOf(b.lastStringValue)!==-1&&b.raise("Duplicate capture group name"),b.groupNames.push(b.lastStringValue);return}b.raise("Invalid group")}},or.regexp_eatGroupName=function(b){if(b.lastStringValue="",b.eat(60)){if(this.regexp_eatRegExpIdentifierName(b)&&b.eat(62))return!0;b.raise("Invalid capture group name")}return!1},or.regexp_eatRegExpIdentifierName=function(b){if(b.lastStringValue="",this.regexp_eatRegExpIdentifierStart(b)){for(b.lastStringValue+=jr(b.lastIntValue);this.regexp_eatRegExpIdentifierPart(b);)b.lastStringValue+=jr(b.lastIntValue);return!0}return!1},or.regexp_eatRegExpIdentifierStart=function(b){var k=b.pos,G=this.options.ecmaVersion>=11,D=b.current(G);return b.advance(G),D===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,G)&&(D=b.lastIntValue),Sn(D)?(b.lastIntValue=D,!0):(b.pos=k,!1)};function Sn(b){return tr(b,!0)||b===36||b===95}or.regexp_eatRegExpIdentifierPart=function(b){var k=b.pos,G=this.options.ecmaVersion>=11,D=b.current(G);return b.advance(G),D===92&&this.regexp_eatRegExpUnicodeEscapeSequence(b,G)&&(D=b.lastIntValue),Jt(D)?(b.lastIntValue=D,!0):(b.pos=k,!1)};function Jt(b){return Yt(b,!0)||b===36||b===95||b===8204||b===8205}or.regexp_eatAtomEscape=function(b){return this.regexp_eatBackReference(b)||this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)||b.switchN&&this.regexp_eatKGroupName(b)?!0:(b.switchU&&(b.current()===99&&b.raise("Invalid unicode escape"),b.raise("Invalid escape")),!1)},or.regexp_eatBackReference=function(b){var k=b.pos;if(this.regexp_eatDecimalEscape(b)){var G=b.lastIntValue;if(b.switchU)return G>b.maxBackReference&&(b.maxBackReference=G),!0;if(G<=b.numCapturingParens)return!0;b.pos=k}return!1},or.regexp_eatKGroupName=function(b){if(b.eat(107)){if(this.regexp_eatGroupName(b))return b.backReferenceNames.push(b.lastStringValue),!0;b.raise("Invalid named reference")}return!1},or.regexp_eatCharacterEscape=function(b){return this.regexp_eatControlEscape(b)||this.regexp_eatCControlLetter(b)||this.regexp_eatZero(b)||this.regexp_eatHexEscapeSequence(b)||this.regexp_eatRegExpUnicodeEscapeSequence(b,!1)||!b.switchU&&this.regexp_eatLegacyOctalEscapeSequence(b)||this.regexp_eatIdentityEscape(b)},or.regexp_eatCControlLetter=function(b){var k=b.pos;if(b.eat(99)){if(this.regexp_eatControlLetter(b))return!0;b.pos=k}return!1},or.regexp_eatZero=function(b){return b.current()===48&&!qi(b.lookahead())?(b.lastIntValue=0,b.advance(),!0):!1},or.regexp_eatControlEscape=function(b){var k=b.current();return k===116?(b.lastIntValue=9,b.advance(),!0):k===110?(b.lastIntValue=10,b.advance(),!0):k===118?(b.lastIntValue=11,b.advance(),!0):k===102?(b.lastIntValue=12,b.advance(),!0):k===114?(b.lastIntValue=13,b.advance(),!0):!1},or.regexp_eatControlLetter=function(b){var k=b.current();return Hn(k)?(b.lastIntValue=k%32,b.advance(),!0):!1};function Hn(b){return b>=65&&b<=90||b>=97&&b<=122}or.regexp_eatRegExpUnicodeEscapeSequence=function(b,k){k===void 0&&(k=!1);var G=b.pos,D=k||b.switchU;if(b.eat(117)){if(this.regexp_eatFixedHexDigits(b,4)){var ne=b.lastIntValue;if(D&&ne>=55296&&ne<=56319){var Oe=b.pos;if(b.eat(92)&&b.eat(117)&&this.regexp_eatFixedHexDigits(b,4)){var dt=b.lastIntValue;if(dt>=56320&&dt<=57343)return b.lastIntValue=(ne-55296)*1024+(dt-56320)+65536,!0}b.pos=Oe,b.lastIntValue=ne}return!0}if(D&&b.eat(123)&&this.regexp_eatHexDigits(b)&&b.eat(125)&&wn(b.lastIntValue))return!0;D&&b.raise("Invalid unicode escape"),b.pos=G}return!1};function wn(b){return b>=0&&b<=1114111}or.regexp_eatIdentityEscape=function(b){if(b.switchU)return this.regexp_eatSyntaxCharacter(b)?!0:b.eat(47)?(b.lastIntValue=47,!0):!1;var k=b.current();return k!==99&&(!b.switchN||k!==107)?(b.lastIntValue=k,b.advance(),!0):!1},or.regexp_eatDecimalEscape=function(b){b.lastIntValue=0;var k=b.current();if(k>=49&&k<=57){do b.lastIntValue=10*b.lastIntValue+(k-48),b.advance();while((k=b.current())>=48&&k<=57);return!0}return!1},or.regexp_eatCharacterClassEscape=function(b){var k=b.current();if(Tn(k))return b.lastIntValue=-1,b.advance(),!0;if(b.switchU&&this.options.ecmaVersion>=9&&(k===80||k===112)){if(b.lastIntValue=-1,b.advance(),b.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(b)&&b.eat(125))return!0;b.raise("Invalid property name")}return!1};function Tn(b){return b===100||b===68||b===115||b===83||b===119||b===87}or.regexp_eatUnicodePropertyValueExpression=function(b){var k=b.pos;if(this.regexp_eatUnicodePropertyName(b)&&b.eat(61)){var G=b.lastStringValue;if(this.regexp_eatUnicodePropertyValue(b)){var D=b.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(b,G,D),!0}}if(b.pos=k,this.regexp_eatLoneUnicodePropertyNameOrValue(b)){var ne=b.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(b,ne),!0}return!1},or.regexp_validateUnicodePropertyNameAndValue=function(b,k,G){rt(b.unicodeProperties.nonBinary,k)||b.raise("Invalid property name"),b.unicodeProperties.nonBinary[k].test(G)||b.raise("Invalid property value")},or.regexp_validateUnicodePropertyNameOrValue=function(b,k){b.unicodeProperties.binary.test(k)||b.raise("Invalid property name")},or.regexp_eatUnicodePropertyName=function(b){var k=0;for(b.lastStringValue="";sa(k=b.current());)b.lastStringValue+=jr(k),b.advance();return b.lastStringValue!==""};function sa(b){return Hn(b)||b===95}or.regexp_eatUnicodePropertyValue=function(b){var k=0;for(b.lastStringValue="";Ir(k=b.current());)b.lastStringValue+=jr(k),b.advance();return b.lastStringValue!==""};function Ir(b){return sa(b)||qi(b)}or.regexp_eatLoneUnicodePropertyNameOrValue=function(b){return this.regexp_eatUnicodePropertyValue(b)},or.regexp_eatCharacterClass=function(b){if(b.eat(91)){if(b.eat(94),this.regexp_classRanges(b),b.eat(93))return!0;b.raise("Unterminated character class")}return!1},or.regexp_classRanges=function(b){for(;this.regexp_eatClassAtom(b);){var k=b.lastIntValue;if(b.eat(45)&&this.regexp_eatClassAtom(b)){var G=b.lastIntValue;b.switchU&&(k===-1||G===-1)&&b.raise("Invalid character class"),k!==-1&&G!==-1&&k>G&&b.raise("Range out of order in character class")}}},or.regexp_eatClassAtom=function(b){var k=b.pos;if(b.eat(92)){if(this.regexp_eatClassEscape(b))return!0;if(b.switchU){var G=b.current();(G===99||pa(G))&&b.raise("Invalid class escape"),b.raise("Invalid escape")}b.pos=k}var D=b.current();return D!==93?(b.lastIntValue=D,b.advance(),!0):!1},or.regexp_eatClassEscape=function(b){var k=b.pos;if(b.eat(98))return b.lastIntValue=8,!0;if(b.switchU&&b.eat(45))return b.lastIntValue=45,!0;if(!b.switchU&&b.eat(99)){if(this.regexp_eatClassControlLetter(b))return!0;b.pos=k}return this.regexp_eatCharacterClassEscape(b)||this.regexp_eatCharacterEscape(b)},or.regexp_eatClassControlLetter=function(b){var k=b.current();return qi(k)||k===95?(b.lastIntValue=k%32,b.advance(),!0):!1},or.regexp_eatHexEscapeSequence=function(b){var k=b.pos;if(b.eat(120)){if(this.regexp_eatFixedHexDigits(b,2))return!0;b.switchU&&b.raise("Invalid escape"),b.pos=k}return!1},or.regexp_eatDecimalDigits=function(b){var k=b.pos,G=0;for(b.lastIntValue=0;qi(G=b.current());)b.lastIntValue=10*b.lastIntValue+(G-48),b.advance();return b.pos!==k};function qi(b){return b>=48&&b<=57}or.regexp_eatHexDigits=function(b){var k=b.pos,G=0;for(b.lastIntValue=0;La(G=b.current());)b.lastIntValue=16*b.lastIntValue+na(G),b.advance();return b.pos!==k};function La(b){return b>=48&&b<=57||b>=65&&b<=70||b>=97&&b<=102}function na(b){return b>=65&&b<=70?10+(b-65):b>=97&&b<=102?10+(b-97):b-48}or.regexp_eatLegacyOctalEscapeSequence=function(b){if(this.regexp_eatOctalDigit(b)){var k=b.lastIntValue;if(this.regexp_eatOctalDigit(b)){var G=b.lastIntValue;k<=3&&this.regexp_eatOctalDigit(b)?b.lastIntValue=k*64+G*8+b.lastIntValue:b.lastIntValue=k*8+G}else b.lastIntValue=k;return!0}return!1},or.regexp_eatOctalDigit=function(b){var k=b.current();return pa(k)?(b.lastIntValue=k-48,b.advance(),!0):(b.lastIntValue=0,!1)};function pa(b){return b>=48&&b<=55}or.regexp_eatFixedHexDigits=function(b,k){var G=b.pos;b.lastIntValue=0;for(var D=0;D<k;++D){var ne=b.current();if(!La(ne))return b.pos=G,!1;b.lastIntValue=16*b.lastIntValue+na(ne),b.advance()}return!0};var Lt=function(k){this.type=k.type,this.value=k.value,this.start=k.start,this.end=k.end,k.options.locations&&(this.loc=new St(k,k.startLoc,k.endLoc)),k.options.ranges&&(this.range=[k.start,k.end])},At=It.prototype;At.next=function(b){!b&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Lt(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},At.getToken=function(){return this.next(),new Lt(this)},typeof Symbol!="undefined"&&(At[Symbol.iterator]=function(){var b=this;return{next:function(){var k=b.getToken();return{done:k.type===re.eof,value:k}}}}),At.curContext=function(){return this.context[this.context.length-1]},At.nextToken=function(){var b=this.curContext();if((!b||!b.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(re.eof);if(b.override)return b.override(this);this.readToken(this.fullCharCodeAtPos())},At.readToken=function(b){return tr(b,this.options.ecmaVersion>=6)||b===92?this.readWord():this.getTokenFromCode(b)},At.fullCharCodeAtPos=function(){var b=this.input.charCodeAt(this.pos);if(b<=55295||b>=57344)return b;var k=this.input.charCodeAt(this.pos+1);return(b<<10)+k-56613888},At.skipBlockComment=function(){var b=this.options.onComment&&this.curPosition(),k=this.pos,G=this.input.indexOf("*/",this.pos+=2);if(G===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=G+2,this.options.locations){Rt.lastIndex=k;for(var D;(D=Rt.exec(this.input))&&D.index<this.pos;)++this.curLine,this.lineStart=D.index+D[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(k+2,G),k,this.pos,b,this.curPosition())},At.skipLineComment=function(b){for(var k=this.pos,G=this.options.onComment&&this.curPosition(),D=this.input.charCodeAt(this.pos+=b);this.pos<this.input.length&&!_t(D);)D=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(k+b,this.pos),k,this.pos,G,this.curPosition())},At.skipSpace=function(){e:for(;this.pos<this.input.length;){var b=this.input.charCodeAt(this.pos);switch(b){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(b>8&&b<14||b>=5760&&Kt.test(String.fromCharCode(b)))++this.pos;else break e}}},At.finishToken=function(b,k){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var G=this.type;this.type=b,this.value=k,this.updateContext(G)},At.readToken_dot=function(){var b=this.input.charCodeAt(this.pos+1);if(b>=48&&b<=57)return this.readNumber(!0);var k=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&b===46&&k===46?(this.pos+=3,this.finishToken(re.ellipsis)):(++this.pos,this.finishToken(re.dot))},At.readToken_slash=function(){var b=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):b===61?this.finishOp(re.assign,2):this.finishOp(re.slash,1)},At.readToken_mult_modulo_exp=function(b){var k=this.input.charCodeAt(this.pos+1),G=1,D=b===42?re.star:re.modulo;return this.options.ecmaVersion>=7&&b===42&&k===42&&(++G,D=re.starstar,k=this.input.charCodeAt(this.pos+2)),k===61?this.finishOp(re.assign,G+1):this.finishOp(D,G)},At.readToken_pipe_amp=function(b){var k=this.input.charCodeAt(this.pos+1);if(k===b){if(this.options.ecmaVersion>=12){var G=this.input.charCodeAt(this.pos+2);if(G===61)return this.finishOp(re.assign,3)}return this.finishOp(b===124?re.logicalOR:re.logicalAND,2)}return k===61?this.finishOp(re.assign,2):this.finishOp(b===124?re.bitwiseOR:re.bitwiseAND,1)},At.readToken_caret=function(){var b=this.input.charCodeAt(this.pos+1);return b===61?this.finishOp(re.assign,2):this.finishOp(re.bitwiseXOR,1)},At.readToken_plus_min=function(b){var k=this.input.charCodeAt(this.pos+1);return k===b?k===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||yr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(re.incDec,2):k===61?this.finishOp(re.assign,2):this.finishOp(re.plusMin,1)},At.readToken_lt_gt=function(b){var k=this.input.charCodeAt(this.pos+1),G=1;return k===b?(G=b===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+G)===61?this.finishOp(re.assign,G+1):this.finishOp(re.bitShift,G)):k===33&&b===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(k===61&&(G=2),this.finishOp(re.relational,G))},At.readToken_eq_excl=function(b){var k=this.input.charCodeAt(this.pos+1);return k===61?this.finishOp(re.equality,this.input.charCodeAt(this.pos+2)===61?3:2):b===61&&k===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(re.arrow)):this.finishOp(b===61?re.eq:re.prefix,1)},At.readToken_question=function(){var b=this.options.ecmaVersion;if(b>=11){var k=this.input.charCodeAt(this.pos+1);if(k===46){var G=this.input.charCodeAt(this.pos+2);if(G<48||G>57)return this.finishOp(re.questionDot,2)}if(k===63){if(b>=12){var D=this.input.charCodeAt(this.pos+2);if(D===61)return this.finishOp(re.assign,3)}return this.finishOp(re.coalesce,2)}}return this.finishOp(re.question,1)},At.getTokenFromCode=function(b){switch(b){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(re.parenL);case 41:return++this.pos,this.finishToken(re.parenR);case 59:return++this.pos,this.finishToken(re.semi);case 44:return++this.pos,this.finishToken(re.comma);case 91:return++this.pos,this.finishToken(re.bracketL);case 93:return++this.pos,this.finishToken(re.bracketR);case 123:return++this.pos,this.finishToken(re.braceL);case 125:return++this.pos,this.finishToken(re.braceR);case 58:return++this.pos,this.finishToken(re.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(re.backQuote);case 48:var k=this.input.charCodeAt(this.pos+1);if(k===120||k===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(k===111||k===79)return this.readRadixNumber(8);if(k===98||k===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(b);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(b);case 124:case 38:return this.readToken_pipe_amp(b);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(b);case 60:case 62:return this.readToken_lt_gt(b);case 61:case 33:return this.readToken_eq_excl(b);case 63:return this.readToken_question();case 126:return this.finishOp(re.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ba(b)+"'")},At.finishOp=function(b,k){var G=this.input.slice(this.pos,this.pos+k);return this.pos+=k,this.finishToken(b,G)},At.readRegexp=function(){for(var b,k,G=this.pos;;){this.pos>=this.input.length&&this.raise(G,"Unterminated regular expression");var D=this.input.charAt(this.pos);if(yr.test(D)&&this.raise(G,"Unterminated regular expression"),b)b=!1;else{if(D==="[")k=!0;else if(D==="]"&&k)k=!1;else if(D==="/"&&!k)break;b=D==="\\"}++this.pos}var ne=this.input.slice(G,this.pos);++this.pos;var Oe=this.pos,dt=this.readWord1();this.containsEsc&&this.unexpected(Oe);var Mt=this.regexpState||(this.regexpState=new hr(this));Mt.reset(G,ne,dt),this.validateRegExpFlags(Mt),this.validateRegExpPattern(Mt);var Zt=null;try{Zt=new RegExp(ne,dt)}catch(Br){}return this.finishToken(re.regexp,{pattern:ne,flags:dt,value:Zt})},At.readInt=function(b,k,G){for(var D=this.options.ecmaVersion>=12&&k===void 0,ne=G&&this.input.charCodeAt(this.pos)===48,Oe=this.pos,dt=0,Mt=0,Zt=0,Br=k==null?Infinity:k;Zt<Br;++Zt,++this.pos){var Gr=this.input.charCodeAt(this.pos),Yn=void 0;if(D&&Gr===95){ne&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Mt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Zt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Mt=Gr;continue}if(Gr>=97?Yn=Gr-97+10:Gr>=65?Yn=Gr-65+10:Gr>=48&&Gr<=57?Yn=Gr-48:Yn=Infinity,Yn>=b)break;Mt=Gr,dt=dt*b+Yn}return D&&Mt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Oe||k!=null&&this.pos-Oe!==k?null:dt};function Qi(b,k){return k?parseInt(b,8):parseFloat(b.replace(/_/g,""))}function fo(b){return typeof BigInt!="function"?null:BigInt(b.replace(/_/g,""))}At.readRadixNumber=function(b){var k=this.pos;this.pos+=2;var G=this.readInt(b);return G==null&&this.raise(this.start+2,"Expected number in radix "+b),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(G=fo(this.input.slice(k,this.pos)),++this.pos):tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,G)},At.readNumber=function(b){var k=this.pos;!b&&this.readInt(10,void 0,!0)===null&&this.raise(k,"Invalid number");var G=this.pos-k>=2&&this.input.charCodeAt(k)===48;G&&this.strict&&this.raise(k,"Invalid number");var D=this.input.charCodeAt(this.pos);if(!G&&!b&&this.options.ecmaVersion>=11&&D===110){var ne=fo(this.input.slice(k,this.pos));return++this.pos,tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(re.num,ne)}G&&/[89]/.test(this.input.slice(k,this.pos))&&(G=!1),D===46&&!G&&(++this.pos,this.readInt(10),D=this.input.charCodeAt(this.pos)),(D===69||D===101)&&!G&&(D=this.input.charCodeAt(++this.pos),(D===43||D===45)&&++this.pos,this.readInt(10)===null&&this.raise(k,"Invalid number")),tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Oe=Qi(this.input.slice(k,this.pos),G);return this.finishToken(re.num,Oe)},At.readCodePoint=function(){var b=this.input.charCodeAt(this.pos),k;if(b===123){this.options.ecmaVersion<6&&this.unexpected();var G=++this.pos;k=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,k>1114111&&this.invalidStringToken(G,"Code point out of bounds")}else k=this.readHexChar(4);return k};function Ba(b){return b<=65535?String.fromCharCode(b):(b-=65536,String.fromCharCode((b>>10)+55296,(b&1023)+56320))}At.readString=function(b){for(var k="",G=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var D=this.input.charCodeAt(this.pos);if(D===b)break;D===92?(k+=this.input.slice(G,this.pos),k+=this.readEscapedChar(!1),G=this.pos):(_t(D,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return k+=this.input.slice(G,this.pos++),this.finishToken(re.string,k)};var zi={};At.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(b){if(b===zi)this.readInvalidTemplateToken();else throw b}this.inTemplateElement=!1},At.invalidStringToken=function(b,k){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw zi;this.raise(b,k)},At.readTmplToken=function(){for(var b="",k=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var G=this.input.charCodeAt(this.pos);if(G===96||G===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===re.template||this.type===re.invalidTemplate)?G===36?(this.pos+=2,this.finishToken(re.dollarBraceL)):(++this.pos,this.finishToken(re.backQuote)):(b+=this.input.slice(k,this.pos),this.finishToken(re.template,b));if(G===92)b+=this.input.slice(k,this.pos),b+=this.readEscapedChar(!0),k=this.pos;else if(_t(G)){switch(b+=this.input.slice(k,this.pos),++this.pos,G){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:b+=`
`;break;default:b+=String.fromCharCode(G);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),k=this.pos}else++this.pos}},At.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(re.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},At.readEscapedChar=function(b){var k=this.input.charCodeAt(++this.pos);switch(++this.pos,k){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ba(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(b){var G=this.pos-1;return this.invalidStringToken(G,"Invalid escape sequence in template string"),null}default:if(k>=48&&k<=55){var D=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ne=parseInt(D,8);return ne>255&&(D=D.slice(0,-1),ne=parseInt(D,8)),this.pos+=D.length-1,k=this.input.charCodeAt(this.pos),(D!=="0"||k===56||k===57)&&(this.strict||b)&&this.invalidStringToken(this.pos-1-D.length,b?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ne)}return _t(k)?"":String.fromCharCode(k)}},At.readHexChar=function(b){var k=this.pos,G=this.readInt(16,b);return G===null&&this.invalidStringToken(k,"Bad character escape sequence"),G},At.readWord1=function(){this.containsEsc=!1;for(var b="",k=!0,G=this.pos,D=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ne=this.fullCharCodeAtPos();if(Yt(ne,D))this.pos+=ne<=65535?1:2;else if(ne===92){this.containsEsc=!0,b+=this.input.slice(G,this.pos);var Oe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var dt=this.readCodePoint();(k?tr:Yt)(dt,D)||this.invalidStringToken(Oe,"Invalid Unicode escape"),b+=Ba(dt),G=this.pos}else break;k=!1}return b+this.input.slice(G,this.pos)},At.readWord=function(){var b=this.readWord1(),k=re.name;return this.keywords.test(b)&&(k=zt[b]),this.finishToken(k,b)};var Ea="7.4.1";It.acorn={Parser:It,version:Ea,defaultOptions:cr,Position:ze,SourceLocation:St,getLineInfo:Ut,Node:Ni,TokenType:Wt,tokTypes:re,keywordTypes:zt,TokContext:Wa,tokContexts:Ci,isIdentifierChar:Yt,isIdentifierStart:tr,Token:Lt,isNewLine:_t,lineBreak:yr,lineBreakG:Rt,nonASCIIwhitespace:Kt};function Co(b,k){return It.parse(b,k)}function sn(b,k,G){return It.parseExpressionAt(b,k,G)}function Wr(b,k){return It.tokenizer(b,k)}function bt(b,k){b.prototype=Object.create(k.prototype),b.prototype.constructor=b,b.__proto__=k}function Ds(b){var k=typeof Map=="function"?new Map:void 0;return Ds=function(D){if(D===null||!Yl(D))return D;if(typeof D!="function")throw new TypeError("Super expression must either be null or a function");if(typeof k!="undefined"){if(k.has(D))return k.get(D);k.set(D,ne)}function ne(){return Xi(D,arguments,po(this).constructor)}return ne.prototype=Object.create(D.prototype,{constructor:{value:ne,enumerable:!1,writable:!0,configurable:!0}}),Oa(ne,D)},Ds(b)}function jt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function Xi(b,k,G){return jt()?Xi=Reflect.construct:Xi=function(ne,Oe,dt){var Mt=[null];Mt.push.apply(Mt,Oe);var Zt=Function.bind.apply(ne,Mt),Br=new Zt;return dt&&Oa(Br,dt.prototype),Br},Xi.apply(null,arguments)}function Yl(b){return Function.toString.call(b).indexOf("[native code]")!==-1}function Oa(b,k){return Oa=Object.setPrototypeOf||function(D,ne){return D.__proto__=ne,D},Oa(b,k)}function po(b){return po=Object.setPrototypeOf?Object.getPrototypeOf:function(G){return G.__proto__||Object.getPrototypeOf(G)},po(b)}var Oo=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ds(Error)),_a=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ds(SyntaxError)),Bs=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ds(ReferenceError)),Ns=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Ds(TypeError)),ql=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Oo),So=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(_a),Ts=function(b){bt(k,b);function k(){return b.apply(this,arguments)||this}return k}(Bs),Ka={UnknownError:[3001,"%0",ql],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",ql],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Ts],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Ts],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Ts],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Ts],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Ts],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Ts],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Ts],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Ts],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Ts],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Ts],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Bs],VariableUndefinedReferenceError:[2002,"%0 is not defined",Bs],IsNotConstructor:[2003,"%0 is not a constructor",Ns]};function Uo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(b){return!1}}function Ms(b,k,G){return Uo()?Ms=Reflect.construct:Ms=function(ne,Oe,dt){var Mt=[null];Mt.push.apply(Mt,Oe);var Zt=Function.bind.apply(ne,Mt),Br=new Zt;return dt&&Fo(Br,dt.prototype),Br},Ms.apply(null,arguments)}function Fo(b,k){return Fo=Object.setPrototypeOf||function(D,ne){return D.__proto__=ne,D},Fo(b,k)}var Xu="0.0.3";function sl(b,k){Object.defineProperty(b,"name",{value:k,writable:!1,enumerable:!1,configurable:!0})}var ns=Object.prototype.hasOwnProperty,ve=Symbol("Break"),Be=Symbol("Continue"),yt=Symbol("DefaultCase"),ir=Symbol("EmptyStatementReturn"),gn=Symbol("WithScopeName"),ei=Symbol("SuperScopeName"),ga=Symbol("RootScopeName"),Jo=Symbol("GlobalScopeName");function Fa(b){return typeof b=="function"}var Zo=function(){function b(G){this.interpreter=G}var k=b.prototype;return k.generator=function(){var D=this.interpreter;function ne(){return this.getCurrentScope()}function Oe(){return this.getGlobalScope()}function dt(){return this.getCurrentContext()}return{getOptions:D.getOptions.bind(D),getCurrentScope:ne.bind(D),getGlobalScope:Oe.bind(D),getCurrentContext:dt.bind(D),getExecStartTime:D.getExecStartTime.bind(D)}},b}();function Ho(b,k,G){if(G===void 0&&(G=!0),!(b instanceof Zo))throw new Error("Illegal call");if(typeof k!="string")return k;if(!!k){var D=b.generator(),ne=D.getOptions(),Oe={timeout:ne.timeout,_initEnv:function(){G||this.setCurrentContext(D.getCurrentContext()),this.execStartTime=D.getExecStartTime(),this.execEndTime=this.execStartTime}},dt=G?D.getGlobalScope():D.getCurrentScope(),Mt=new ps(dt,Oe);return Mt.evaluate(k)}}Object.defineProperty(Ho,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Ro(b){if(!(b instanceof Zo))throw new Error("Illegal call");for(var k=b.generator(),G=arguments.length,D=new Array(G>1?G-1:0),ne=1;ne<G;ne++)D[ne-1]=arguments[ne];var Oe=D.pop(),dt=new ps(k.getGlobalScope(),k.getOptions()),Mt=`
		    (function anonymous(`+D.join(",")+`){
		        `+Oe+`
		    });
		    `;return dt.evaluate(Mt)}Object.defineProperty(Ro,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var zs=function(k){this.value=k},hs=function(k){this.value=k},Is=function(k){this.value=k},bu=function(k,G,D){G===void 0&&(G=null),this.name=D,this.parent=G,this.data=k,this.labelStack=[]};function Yu(){}function Eu(b,k){return b===void 0&&(b=null),new bu(Object.create(null),b,k)}function Cu(b){return Object.create(b)}var Za={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Ho,Function:Ro};typeof JSON!="undefined"&&(Za.JSON=JSON),typeof Promise!="undefined"&&(Za.Promise=Promise),typeof Set!="undefined"&&(Za.Set=Set),typeof Map!="undefined"&&(Za.Map=Map),typeof Symbol!="undefined"&&(Za.Symbol=Symbol),typeof Proxy!="undefined"&&(Za.Proxy=Proxy),typeof WeakMap!="undefined"&&(Za.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Za.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Za.Reflect=Reflect);var ps=function(){function b(G,D){G===void 0&&(G=b.global),D===void 0&&(D={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:D.ecmaVersion||b.ecmaVersion,timeout:D.timeout||0,rootContext:D.rootContext,globalContextInFunction:D.globalContextInFunction===void 0?b.globalContextInFunction:D.globalContextInFunction,_initEnv:D._initEnv},this.context=G||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var k=b.prototype;return k.initEnvironment=function(D){var ne;if(D instanceof bu)ne=D;else{var Oe=null,dt=this.createSuperScope(D);this.options.rootContext&&(Oe=new bu(Cu(this.options.rootContext),dt,ga)),ne=new bu(D,Oe||dt,Jo)}this.globalScope=ne,this.currentScope=this.globalScope,this.globalContext=ne.data,this.currentContext=ne.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Mt=this.options._initEnv;Mt&&Mt.call(this)},k.getExecStartTime=function(){return this.execStartTime},k.getExecutionTime=function(){return this.execEndTime-this.execStartTime},k.setExecTimeout=function(D){D===void 0&&(D=0),this.options.timeout=D},k.getOptions=function(){return this.options},k.getGlobalScope=function(){return this.globalScope},k.getCurrentScope=function(){return this.currentScope},k.getCurrentContext=function(){return this.currentContext},k.isInterruptThrow=function(D){return D instanceof ql||D instanceof Ts||D instanceof So},k.createSuperScope=function(D){var ne=Object.assign({},Za),Oe=Object.keys(ne);return Oe.forEach(function(dt){dt in D&&delete ne[dt]}),new bu(ne,null,ei)},k.setCurrentContext=function(D){this.currentContext=D},k.setCurrentScope=function(D){this.currentScope=D},k.evaluate=function(D){D===void 0&&(D="");var ne;if(!!D)return ne=Co(D,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||b.ecmaVersion}),this.evaluateNode(ne,D)},k.appendCode=function(D){return this.evaluate(D)},k.evaluateNode=function(D,ne){var Oe=this;ne===void 0&&(ne=""),this.value=void 0,this.source=ne,this.sourceList.push(ne),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var dt=this.getCurrentScope(),Mt=this.getCurrentContext(),Zt=dt.labelStack.concat([]),Br=this.callStack.concat([]),Gr=function(){Oe.setCurrentScope(dt),Oe.setCurrentContext(Mt),dt.labelStack=Zt,Oe.callStack=Br};try{var Yn=this.createClosure(D);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Yn()}catch(ji){throw ji}finally{Gr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},k.createErrorMessage=function(D,ne,Oe){var dt=D[1].replace("%0",String(ne));return Oe!==null&&(dt+=this.getNodePosition(Oe||this.lastExecNode)),dt},k.createError=function(D,ne){return new ne(D)},k.createThrowError=function(D,ne){return this.createError(D,ne)},k.createInternalThrowError=function(D,ne,Oe){return this.createError(this.createErrorMessage(D,ne,Oe),D[2])},k.checkTimeout=function(){if(!this.isRunning)return!1;var D=this.options.timeout||0,ne=Date.now();return ne-this.execStartTime>D},k.getNodePosition=function(D){if(D){var ne="";return D.loc?" ["+D.loc.start.line+":"+D.loc.start.column+"]"+ne:""}return""},k.createClosure=function(D){var ne=this,Oe;switch(D.type){case"BinaryExpression":Oe=this.binaryExpressionHandler(D);break;case"LogicalExpression":Oe=this.logicalExpressionHandler(D);break;case"UnaryExpression":Oe=this.unaryExpressionHandler(D);break;case"UpdateExpression":Oe=this.updateExpressionHandler(D);break;case"ObjectExpression":Oe=this.objectExpressionHandler(D);break;case"ArrayExpression":Oe=this.arrayExpressionHandler(D);break;case"CallExpression":Oe=this.callExpressionHandler(D);break;case"NewExpression":Oe=this.newExpressionHandler(D);break;case"MemberExpression":Oe=this.memberExpressionHandler(D);break;case"ThisExpression":Oe=this.thisExpressionHandler(D);break;case"SequenceExpression":Oe=this.sequenceExpressionHandler(D);break;case"Literal":Oe=this.literalHandler(D);break;case"Identifier":Oe=this.identifierHandler(D);break;case"AssignmentExpression":Oe=this.assignmentExpressionHandler(D);break;case"FunctionDeclaration":Oe=this.functionDeclarationHandler(D);break;case"VariableDeclaration":Oe=this.variableDeclarationHandler(D);break;case"BlockStatement":case"Program":Oe=this.programHandler(D);break;case"ExpressionStatement":Oe=this.expressionStatementHandler(D);break;case"EmptyStatement":Oe=this.emptyStatementHandler(D);break;case"ReturnStatement":Oe=this.returnStatementHandler(D);break;case"FunctionExpression":Oe=this.functionExpressionHandler(D);break;case"IfStatement":Oe=this.ifStatementHandler(D);break;case"ConditionalExpression":Oe=this.conditionalExpressionHandler(D);break;case"ForStatement":Oe=this.forStatementHandler(D);break;case"WhileStatement":Oe=this.whileStatementHandler(D);break;case"DoWhileStatement":Oe=this.doWhileStatementHandler(D);break;case"ForInStatement":Oe=this.forInStatementHandler(D);break;case"WithStatement":Oe=this.withStatementHandler(D);break;case"ThrowStatement":Oe=this.throwStatementHandler(D);break;case"TryStatement":Oe=this.tryStatementHandler(D);break;case"ContinueStatement":Oe=this.continueStatementHandler(D);break;case"BreakStatement":Oe=this.breakStatementHandler(D);break;case"SwitchStatement":Oe=this.switchStatementHandler(D);break;case"LabeledStatement":Oe=this.labeledStatementHandler(D);break;case"DebuggerStatement":Oe=this.debuggerStatementHandler(D);break;default:throw this.createInternalThrowError(Ka.NodeTypeSyntaxError,D.type,D)}return function(){var dt=ne.options.timeout;if(dt&&dt>0&&ne.checkTimeout())throw ne.createInternalThrowError(Ka.ExecutionTimeOutError,dt,null);return ne.lastExecNode=D,Oe.apply(void 0,arguments)}},k.binaryExpressionHandler=function(D){var ne=this,Oe=this.createClosure(D.left),dt=this.createClosure(D.right);return function(){var Mt=Oe(),Zt=dt();switch(D.operator){case"==":return Mt==Zt;case"!=":return Mt!=Zt;case"===":return Mt===Zt;case"!==":return Mt!==Zt;case"<":return Mt<Zt;case"<=":return Mt<=Zt;case">":return Mt>Zt;case">=":return Mt>=Zt;case"<<":return Mt<<Zt;case">>":return Mt>>Zt;case">>>":return Mt>>>Zt;case"+":return Mt+Zt;case"-":return Mt-Zt;case"*":return Mt*Zt;case"**":return Math.pow(Mt,Zt);case"/":return Mt/Zt;case"%":return Mt%Zt;case"|":return Mt|Zt;case"^":return Mt^Zt;case"&":return Mt&Zt;case"in":return Mt in Zt;case"instanceof":return Mt instanceof Zt;default:throw ne.createInternalThrowError(Ka.BinaryOperatorSyntaxError,D.operator,D)}}},k.logicalExpressionHandler=function(D){var ne=this,Oe=this.createClosure(D.left),dt=this.createClosure(D.right);return function(){switch(D.operator){case"||":return Oe()||dt();case"&&":return Oe()&&dt();default:throw ne.createInternalThrowError(Ka.LogicalOperatorSyntaxError,D.operator,D)}}},k.unaryExpressionHandler=function(D){var ne=this;switch(D.operator){case"delete":var Oe=this.createObjectGetter(D.argument),dt=this.createNameGetter(D.argument);return function(){var Gr=Oe(),Yn=dt();return delete Gr[Yn]};default:var Mt;if(D.operator==="typeof"&&D.argument.type==="Identifier"){var Zt=this.createObjectGetter(D.argument),Br=this.createNameGetter(D.argument);Mt=function(){return Zt()[Br()]}}else Mt=this.createClosure(D.argument);return function(){var Gr=Mt();switch(D.operator){case"-":return-Gr;case"+":return+Gr;case"!":return!Gr;case"~":return~Gr;case"void":return;case"typeof":return typeof Gr;default:throw ne.createInternalThrowError(Ka.UnaryOperatorSyntaxError,D.operator,D)}}}},k.updateExpressionHandler=function(D){var ne=this,Oe=this.createObjectGetter(D.argument),dt=this.createNameGetter(D.argument);return function(){var Mt=Oe(),Zt=dt();switch(ne.assertVariable(Mt,Zt,D),D.operator){case"++":return D.prefix?++Mt[Zt]:Mt[Zt]++;case"--":return D.prefix?--Mt[Zt]:Mt[Zt]--;default:throw ne.createInternalThrowError(Ka.UpdateOperatorSyntaxError,D.operator,D)}}},k.objectExpressionHandler=function(D){var ne=this,Oe=[];function dt(Zt){return Zt.type==="Identifier"?Zt.name:Zt.type==="Literal"?Zt.value:this.throwError(Ka.ObjectStructureSyntaxError,Zt.type,Zt)}var Mt=Object.create(null);return D.properties.forEach(function(Zt){var Br=Zt.kind,Gr=dt(Zt.key);(!Mt[Gr]||Br==="init")&&(Mt[Gr]={}),Mt[Gr][Br]=ne.createClosure(Zt.value),Oe.push({key:Gr,property:Zt})}),function(){for(var Zt={},Br=Oe.length,Gr=0;Gr<Br;Gr++){var Yn=Oe[Gr],ji=Yn.key,Ui=Mt[ji],Fi=Ui.init?Ui.init():void 0,io=Ui.get?Ui.get():function(){},vo=Ui.set?Ui.set():function(hc){};if("set"in Ui||"get"in Ui){var Ia={configurable:!0,enumerable:!0,get:io,set:vo};Object.defineProperty(Zt,ji,Ia)}else{var au=Yn.property,Ll=au.kind;au.key.type==="Identifier"&&au.value.type==="FunctionExpression"&&Ll==="init"&&!au.value.id&&sl(Fi,au.key.name),Zt[ji]=Fi}}return Zt}},k.arrayExpressionHandler=function(D){var ne=this,Oe=D.elements.map(function(dt){return dt&&ne.createClosure(dt)});return function(){for(var dt=Oe.length,Mt=Array(dt),Zt=0;Zt<dt;Zt++){var Br=Oe[Zt];Br&&(Mt[Zt]=Br())}return Mt}},k.safeObjectGet=function(D,ne,Oe){return D[ne]},k.createCallFunctionGetter=function(D){var ne=this;switch(D.type){case"MemberExpression":var Oe=this.createClosure(D.object),dt=this.createMemberKeyGetter(D),Mt=this.source;return function(){var Br=Oe(),Gr=dt(),Yn=ne.safeObjectGet(Br,Gr,D);if(!Yn||!Fa(Yn)){var ji=Mt.slice(D.start,D.end);throw ne.createInternalThrowError(Ka.FunctionUndefinedReferenceError,ji,D)}return Yn.__IS_EVAL_FUNC?function(Ui){return Yn(new Zo(ne),Ui,!0)}:Yn.__IS_FUNCTION_FUNC?function(){for(var Ui=arguments.length,Fi=new Array(Ui),io=0;io<Ui;io++)Fi[io]=arguments[io];return Yn.apply(void 0,[new Zo(ne)].concat(Fi))}:Yn.bind(Br)};default:var Zt=this.createClosure(D);return function(){var Br="";D.type==="Identifier"&&(Br=D.name);var Gr=Zt();if(!Gr||!Fa(Gr))throw ne.createInternalThrowError(Ka.FunctionUndefinedReferenceError,Br,D);if(D.type==="Identifier"&&Gr.__IS_EVAL_FUNC&&Br==="eval")return function(Ui){var Fi=ne.getScopeFromName(Br,ne.getCurrentScope()),io=Fi.name===ei||Fi.name===Jo||Fi.name===ga;return Gr(new Zo(ne),Ui,!io)};if(Gr.__IS_EVAL_FUNC)return function(Ui){return Gr(new Zo(ne),Ui,!0)};if(Gr.__IS_FUNCTION_FUNC)return function(){for(var Ui=arguments.length,Fi=new Array(Ui),io=0;io<Ui;io++)Fi[io]=arguments[io];return Gr.apply(void 0,[new Zo(ne)].concat(Fi))};var Yn=ne.options.globalContextInFunction;if(D.type==="Identifier"){var ji=ne.getIdentifierScope(D);ji.name===gn&&(Yn=ji.data)}return Gr.bind(Yn)}}},k.callExpressionHandler=function(D){var ne=this,Oe=this.createCallFunctionGetter(D.callee),dt=D.arguments.map(function(Mt){return ne.createClosure(Mt)});return function(){return Oe().apply(void 0,dt.map(function(Mt){return Mt()}))}},k.functionExpressionHandler=function(D){var ne=this,Oe=this,dt=this.source,Mt=this.collectDeclVars,Zt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Br=D.id?D.id.name:"",Gr=D.params.length,Yn=D.params.map(function(io){return ne.createParamNameGetter(io)}),ji=this.createClosure(D.body),Ui=this.collectDeclVars,Fi=this.collectDeclFuncs;return this.collectDeclVars=Mt,this.collectDeclFuncs=Zt,function(){var io=Oe.getCurrentScope(),vo=function Ia(){for(var au=arguments.length,Ll=new Array(au),hc=0;hc<au;hc++)Ll[hc]=arguments[hc];Oe.callStack.push(""+Br);var pc=Oe.getCurrentScope(),dc=Eu(io,"FunctionScope("+Br+")");Oe.setCurrentScope(dc),Oe.addDeclarationsToScope(Ui,Fi,dc),Br&&(dc.data[Br]=Ia),dc.data.arguments=arguments,Yn.forEach(function(Ol,gl){dc.data[Ol()]=Ll[gl]});var vc=Oe.getCurrentContext();Oe.setCurrentContext(this);var Du=ji();if(Oe.setCurrentContext(vc),Oe.setCurrentScope(pc),Oe.callStack.pop(),Du instanceof zs)return Du.value};return sl(vo,Br),Object.defineProperty(vo,"length",{value:Gr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(vo,"toString",{value:function(){return dt.slice(D.start,D.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(vo,"valueOf",{value:function(){return dt.slice(D.start,D.end)},writable:!0,configurable:!0,enumerable:!1}),vo}},k.newExpressionHandler=function(D){var ne=this,Oe=this.source,dt=this.createClosure(D.callee),Mt=D.arguments.map(function(Zt){return ne.createClosure(Zt)});return function(){var Zt=dt();if(!Fa(Zt)||Zt.__IS_EVAL_FUNC){var Br=D.callee,Gr=Oe.slice(Br.start,Br.end);throw ne.createInternalThrowError(Ka.IsNotConstructor,Gr,D)}return Zt.__IS_FUNCTION_FUNC?Zt.apply(void 0,[new Zo(ne)].concat(Mt.map(function(Yn){return Yn()}))):Ms(Zt,Mt.map(function(Yn){return Yn()}))}},k.memberExpressionHandler=function(D){var ne=this.createClosure(D.object),Oe=this.createMemberKeyGetter(D);return function(){var dt=ne(),Mt=Oe();return dt[Mt]}},k.thisExpressionHandler=function(D){var ne=this;return function(){return ne.getCurrentContext()}},k.sequenceExpressionHandler=function(D){var ne=this,Oe=D.expressions.map(function(dt){return ne.createClosure(dt)});return function(){for(var dt,Mt=Oe.length,Zt=0;Zt<Mt;Zt++){var Br=Oe[Zt];dt=Br()}return dt}},k.literalHandler=function(D){return function(){return D.regex?new RegExp(D.regex.pattern,D.regex.flags):D.value}},k.identifierHandler=function(D){var ne=this;return function(){var Oe=ne.getCurrentScope(),dt=ne.getScopeDataFromName(D.name,Oe);return ne.assertVariable(dt,D.name,D),dt[D.name]}},k.getIdentifierScope=function(D){var ne=this.getCurrentScope(),Oe=this.getScopeFromName(D.name,ne);return Oe},k.assignmentExpressionHandler=function(D){var ne=this;D.left.type==="Identifier"&&D.right.type==="FunctionExpression"&&!D.right.id&&(D.right.id={type:"Identifier",name:D.left.name});var Oe=this.createObjectGetter(D.left),dt=this.createNameGetter(D.left),Mt=this.createClosure(D.right);return function(){var Zt=Oe(),Br=dt(),Gr=Mt();switch(D.operator!=="="&&ne.assertVariable(Zt,Br,D),D.operator){case"=":return Zt[Br]=Gr;case"+=":return Zt[Br]+=Gr;case"-=":return Zt[Br]-=Gr;case"*=":return Zt[Br]*=Gr;case"**=":return Zt[Br]=Math.pow(Zt[Br],Gr);case"/=":return Zt[Br]/=Gr;case"%=":return Zt[Br]%=Gr;case"<<=":return Zt[Br]<<=Gr;case">>=":return Zt[Br]>>=Gr;case">>>=":return Zt[Br]>>>=Gr;case"&=":return Zt[Br]&=Gr;case"^=":return Zt[Br]^=Gr;case"|=":return Zt[Br]|=Gr;default:throw ne.createInternalThrowError(Ka.AssignmentExpressionSyntaxError,D.type,D)}}},k.functionDeclarationHandler=function(D){if(D.id){var ne=this.functionExpressionHandler(D);Object.defineProperty(ne,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(D.id.name,ne)}return function(){return ir}},k.getVariableName=function(D){if(D.type==="Identifier")return D.name;throw this.createInternalThrowError(Ka.VariableTypeSyntaxError,D.type,D)},k.variableDeclarationHandler=function(D){for(var ne=this,Oe,dt=[],Mt=0;Mt<D.declarations.length;Mt++){var Zt=D.declarations[Mt];this.varDeclaration(this.getVariableName(Zt.id)),Zt.init&&dt.push({type:"AssignmentExpression",operator:"=",left:Zt.id,right:Zt.init})}return dt.length&&(Oe=this.createClosure({type:"BlockStatement",body:dt})),function(){if(Oe){var Br=ne.isVarDeclMode;ne.isVarDeclMode=!0,Oe(),ne.isVarDeclMode=Br}return ir}},k.assertVariable=function(D,ne,Oe){if(D===this.globalScope.data&&!(ne in D))throw this.createInternalThrowError(Ka.VariableUndefinedReferenceError,ne,Oe)},k.programHandler=function(D){var ne=this,Oe=D.body.map(function(dt){return ne.createClosure(dt)});return function(){for(var dt=ir,Mt=0;Mt<Oe.length;Mt++){var Zt=Oe[Mt],Br=ne.setValue(Zt());if(Br!==ir&&(dt=Br,dt instanceof zs||dt instanceof hs||dt instanceof Is||dt===ve||dt===Be))break}return dt}},k.expressionStatementHandler=function(D){return this.createClosure(D.expression)},k.emptyStatementHandler=function(D){return function(){return ir}},k.returnStatementHandler=function(D){var ne=D.argument?this.createClosure(D.argument):Yu;return function(){return new zs(ne())}},k.ifStatementHandler=function(D){var ne=this.createClosure(D.test),Oe=this.createClosure(D.consequent),dt=D.alternate?this.createClosure(D.alternate):function(){return ir};return function(){return ne()?Oe():dt()}},k.conditionalExpressionHandler=function(D){return this.ifStatementHandler(D)},k.forStatementHandler=function(D){var ne=this,Oe=Yu,dt=D.test?this.createClosure(D.test):function(){return!0},Mt=Yu,Zt=this.createClosure(D.body);return D.type==="ForStatement"&&(Oe=D.init?this.createClosure(D.init):Oe,Mt=D.update?this.createClosure(D.update):Yu),function(Br){var Gr,Yn=ir,ji=D.type==="DoWhileStatement";for(Br&&Br.type==="LabeledStatement"&&(Gr=Br.label.name),Oe();ji||dt();Mt()){ji=!1;var Ui=ne.setValue(Zt());if(!(Ui===ir||Ui===Be)){if(Ui===ve)break;if(Yn=Ui,Yn instanceof Is&&Yn.value===Gr){Yn=ir;continue}if(Yn instanceof zs||Yn instanceof hs||Yn instanceof Is)break}}return Yn}},k.whileStatementHandler=function(D){return this.forStatementHandler(D)},k.doWhileStatementHandler=function(D){return this.forStatementHandler(D)},k.forInStatementHandler=function(D){var ne=this,Oe=D.left,dt=this.createClosure(D.right),Mt=this.createClosure(D.body);return D.left.type==="VariableDeclaration"&&(this.createClosure(D.left)(),Oe=D.left.declarations[0].id),function(Zt){var Br,Gr=ir,Yn;Zt&&Zt.type==="LabeledStatement"&&(Br=Zt.label.name);var ji=dt();for(Yn in ji){ne.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Oe,right:{type:"Literal",value:Yn}})();var Ui=ne.setValue(Mt());if(!(Ui===ir||Ui===Be)){if(Ui===ve)break;if(Gr=Ui,Gr instanceof Is&&Gr.value===Br){Gr=ir;continue}if(Gr instanceof zs||Gr instanceof hs||Gr instanceof Is)break}}return Gr}},k.withStatementHandler=function(D){var ne=this,Oe=this.createClosure(D.object),dt=this.createClosure(D.body);return function(){var Mt=Oe(),Zt=ne.getCurrentScope(),Br=new bu(Mt,Zt,gn);ne.setCurrentScope(Br);var Gr=ne.setValue(dt());return ne.setCurrentScope(Zt),Gr}},k.throwStatementHandler=function(D){var ne=this,Oe=this.createClosure(D.argument);return function(){throw ne.setValue(void 0),Oe()}},k.tryStatementHandler=function(D){var ne=this,Oe=this.createClosure(D.block),dt=D.handler?this.catchClauseHandler(D.handler):null,Mt=D.finalizer?this.createClosure(D.finalizer):null;return function(){var Zt=ne.getCurrentScope(),Br=ne.getCurrentContext(),Gr=Zt.labelStack.concat([]),Yn=ne.callStack.concat([]),ji=ir,Ui,Fi,io=function(){ne.setCurrentScope(Zt),ne.setCurrentContext(Br),Zt.labelStack=Gr,ne.callStack=Yn};try{ji=ne.setValue(Oe()),ji instanceof zs&&(Ui=ji)}catch(vo){if(io(),ne.isInterruptThrow(vo))throw vo;if(dt)try{ji=ne.setValue(dt(vo)),ji instanceof zs&&(Ui=ji)}catch(Ia){if(io(),ne.isInterruptThrow(Ia))throw Ia;Fi=Ia}}if(Mt)try{ji=Mt(),ji instanceof zs&&(Ui=ji)}catch(vo){if(io(),ne.isInterruptThrow(vo))throw vo;Fi=vo}if(Fi)throw Fi;return Ui||ji}},k.catchClauseHandler=function(D){var ne=this,Oe=this.createParamNameGetter(D.param),dt=this.createClosure(D.body);return function(Mt){var Zt,Br=ne.getCurrentScope(),Gr=Br.data,Yn=Oe(),ji=ns.call(Gr,Yn),Ui=Gr[Yn];return Gr[Yn]=Mt,Zt=dt(),ji?Gr[Yn]=Ui:delete Gr[Yn],Zt}},k.continueStatementHandler=function(D){return function(){return D.label?new Is(D.label.name):Be}},k.breakStatementHandler=function(D){return function(){return D.label?new hs(D.label.name):ve}},k.switchStatementHandler=function(D){var ne=this,Oe=this.createClosure(D.discriminant),dt=D.cases.map(function(Mt){return ne.switchCaseHandler(Mt)});return function(){for(var Mt=Oe(),Zt=!1,Br,Gr,Yn,ji=0;ji<dt.length;ji++){var Ui=dt[ji](),Fi=Ui.testClosure();if(Fi===yt){Yn=Ui;continue}if(Zt||Fi===Mt){if(Zt=!0,Gr=ne.setValue(Ui.bodyClosure()),Gr===ir)continue;if(Gr===ve||(Br=Gr,Br instanceof zs||Br instanceof hs||Br instanceof Is||Br===Be))break}}if(!Zt&&Yn){Gr=ne.setValue(Yn.bodyClosure());var io=Gr===ir||Gr===ve||Gr===Be;io||(Br=Gr)}return Br}},k.switchCaseHandler=function(D){var ne=D.test?this.createClosure(D.test):function(){return yt},Oe=this.createClosure({type:"BlockStatement",body:D.consequent});return function(){return{testClosure:ne,bodyClosure:Oe}}},k.labeledStatementHandler=function(D){var ne=this,Oe=D.label.name,dt=this.createClosure(D.body);return function(){var Mt,Zt=ne.getCurrentScope();return Zt.labelStack.push(Oe),Mt=dt(D),Mt instanceof hs&&Mt.value===Oe&&(Mt=ir),Zt.labelStack.pop(),Mt}},k.debuggerStatementHandler=function(D){return function(){debugger;return ir}},k.createParamNameGetter=function(D){if(D.type==="Identifier")return function(){return D.name};throw this.createInternalThrowError(Ka.ParamTypeSyntaxError,D.type,D)},k.createObjectKeyGetter=function(D){var ne;return D.type==="Identifier"?ne=function(){return D.name}:ne=this.createClosure(D),function(){return ne()}},k.createMemberKeyGetter=function(D){return D.computed?this.createClosure(D.property):this.createObjectKeyGetter(D.property)},k.createObjectGetter=function(D){var ne=this;switch(D.type){case"Identifier":return function(){return ne.getScopeDataFromName(D.name,ne.getCurrentScope())};case"MemberExpression":return this.createClosure(D.object);default:throw this.createInternalThrowError(Ka.AssignmentTypeSyntaxError,D.type,D)}},k.createNameGetter=function(D){switch(D.type){case"Identifier":return function(){return D.name};case"MemberExpression":return this.createMemberKeyGetter(D);default:throw this.createInternalThrowError(Ka.AssignmentTypeSyntaxError,D.type,D)}},k.varDeclaration=function(D){var ne=this.collectDeclVars;ne[D]=void 0},k.funcDeclaration=function(D,ne){var Oe=this.collectDeclFuncs;Oe[D]=ne},k.addDeclarationsToScope=function(D,ne,Oe){var dt=Oe.data;for(var Mt in ne){var Zt=ne[Mt];dt[Mt]=Zt&&Zt()}for(var Br in D)Br in dt||(dt[Br]=void 0)},k.getScopeValue=function(D,ne){var Oe=this.getScopeFromName(D,ne);return Oe.data[D]},k.getScopeDataFromName=function(D,ne){return this.getScopeFromName(D,ne).data},k.getScopeFromName=function(D,ne){var Oe=ne;do if(D in Oe.data)return Oe;while(Oe=Oe.parent);return this.globalScope},k.setValue=function(D){var ne=this.callStack.length;return this.isVarDeclMode||ne||D===ir||D===ve||D===Be||D instanceof hs||D instanceof Is||(this.value=D instanceof zs?D.value:D),D},k.getValue=function(){return this.value},b}();ps.version=Xu,ps.eval=Ho,ps.Function=Ro,ps.ecmaVersion=5,ps.globalContextInFunction=void 0,ps.global=Object.create(null);function iu(b){return b===void 0&&(b=Object.create(null)),b}function Su(b,k,G){k===void 0&&(k=[]),G===void 0&&(G={});var D=G.parsingContext,ne=G.timeout===void 0?0:G.timeout,Oe=`
    (function anonymous(`+k.join(",")+`){
         `+b+`
    });
    `,dt=new ps(D,{ecmaVersion:G.ecmaVersion,timeout:ne,rootContext:G.rootContext,globalContextInFunction:G.globalContextInFunction});return dt.evaluate(Oe)}function mf(b,k,G){var D=new ps(k,G);return D.evaluate(b)}var zh=mf,qs=function(){function b(G){this._code=G}var k=b.prototype;return k.runInContext=function(D){return mf(this._code,D)},k.runInNewContext=function(D){return mf(this._code,D)},b}(),gf=function(b,k,G){return mf(b,k,G)};function ul(){for(var b=arguments.length,k=new Array(b),G=0;G<b;G++)k[G]=arguments[G];var D=k.pop();return Su(D||"",k)}var jc=gf},20396:function(hi,Ae,fe){var We;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(de,y,Ne,K){"use strict";var Re=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,pe=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),lt=Re||pe,we=["","webkit","Moz","MS","ms","o"],Xe=lt?"":y.createElement("div"),Ct="function",Pt=Math.round,tr=Math.abs,Yt=Date.now;function Wt(ve,Be,yt){return setTimeout(Rt(ve,yt),Be)}function br(ve,Be,yt){return Array.isArray(ve)?(lr(ve,yt[Be],yt),!0):!1}function lr(ve,Be,yt){var ir;if(!!ve)if(ve.forEach)ve.forEach(Be,yt);else if(ve.length!==K)for(ir=0;ir<ve.length;)Be.call(yt,ve[ir],ir,ve),ir++;else for(ir in ve)ve.hasOwnProperty(ir)&&Be.call(yt,ve[ir],ir,ve)}function kt(ve,Be,yt){var ir="DEPRECATED METHOD: "+Be+`
`+yt+` AT 
`;return function(){var gn=new Error("get-stack-trace"),ei=gn&&gn.stack?gn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ga=de.console&&(de.console.warn||de.console.log);return ga&&ga.call(de.console,ir,ei),ve.apply(this,arguments)}}var zt;typeof Object.assign!="function"?zt=function(Be){if(Be===K||Be===null)throw new TypeError("Cannot convert undefined or null to object");for(var yt=Object(Be),ir=1;ir<arguments.length;ir++){var gn=arguments[ir];if(gn!==K&&gn!==null)for(var ei in gn)gn.hasOwnProperty(ei)&&(yt[ei]=gn[ei])}return yt}:zt=Object.assign;var Pr=kt(function(Be,yt,ir){for(var gn=Object.keys(yt),ei=0;ei<gn.length;)(!ir||ir&&Be[gn[ei]]===K)&&(Be[gn[ei]]=yt[gn[ei]]),ei++;return Be},"extend","Use `assign`."),re=kt(function(Be,yt){return Pr(Be,yt,!0)},"merge","Use `assign`.");function yr(ve,Be,yt){var ir=Be.prototype,gn;gn=ve.prototype=Object.create(ir),gn.constructor=ve,gn._super=ir,yt&&zt(gn,yt)}function Rt(ve,Be){return function(){return ve.apply(Be,arguments)}}function _t(ve,Be){return typeof ve==Ct?ve.apply(Be&&Be[0]||K,Be):ve}function Kt(ve,Be){return ve===K?Be:ve}function Ue(ve,Be,yt){lr(rt(Be),function(ir){ve.addEventListener(ir,yt,!1)})}function Er(ve,Be,yt){lr(rt(Be),function(ir){ve.removeEventListener(ir,yt,!1)})}function an(ve,Be){for(;ve;){if(ve==Be)return!0;ve=ve.parentNode}return!1}function ue(ve,Be){return ve.indexOf(Be)>-1}function rt(ve){return ve.trim().split(/\s+/g)}function Z(ve,Be,yt){if(ve.indexOf&&!yt)return ve.indexOf(Be);for(var ir=0;ir<ve.length;){if(yt&&ve[ir][yt]==Be||!yt&&ve[ir]===Be)return ir;ir++}return-1}function _e(ve){return Array.prototype.slice.call(ve,0)}function ze(ve,Be,yt){for(var ir=[],gn=[],ei=0;ei<ve.length;){var ga=Be?ve[ei][Be]:ve[ei];Z(gn,ga)<0&&ir.push(ve[ei]),gn[ei]=ga,ei++}return yt&&(Be?ir=ir.sort(function(Fa,Zo){return Fa[Be]>Zo[Be]}):ir=ir.sort()),ir}function St(ve,Be){for(var yt,ir,gn=Be[0].toUpperCase()+Be.slice(1),ei=0;ei<we.length;){if(yt=we[ei],ir=yt?yt+gn:Be,ir in ve)return ir;ei++}return K}var Ut=1;function cr(){return Ut++}function wt(ve){var Be=ve.ownerDocument||ve;return Be.defaultView||Be.parentWindow||de}var Or=/mobile|tablet|ip(ad|hone|od)|android/i,Xn="ontouchstart"in de,Qr=St(de,"PointerEvent")!==K,Pi=Xn&&Or.test(navigator.userAgent),mi="touch",ln="pen",ba="mouse",ua="kinect",Li=25,Ma=1,ai=2,Ki=4,ci=8,gi=1,zo=2,go=4,no=8,It=16,ge=zo|go,oe=no|It,Te=ge|oe,j=["x","y"],ot=["clientX","clientY"];function sr(ve,Be){var yt=this;this.manager=ve,this.callback=Be,this.element=ve.element,this.target=ve.options.inputTarget,this.domHandler=function(ir){_t(ve.options.enable,[ve])&&yt.handler(ir)},this.init()}sr.prototype={handler:function(){},init:function(){this.evEl&&Ue(this.element,this.evEl,this.domHandler),this.evTarget&&Ue(this.target,this.evTarget,this.domHandler),this.evWin&&Ue(wt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Er(this.element,this.evEl,this.domHandler),this.evTarget&&Er(this.target,this.evTarget,this.domHandler),this.evWin&&Er(wt(this.element),this.evWin,this.domHandler)}};function Yr(ve){var Be,yt=ve.options.inputClass;return yt?Be=yt:Qr?Be=qe:Pi?Be=hr:Xn?Be=Jt:Be=la,new Be(ve,Ke)}function Ke(ve,Be,yt){var ir=yt.pointers.length,gn=yt.changedPointers.length,ei=Be&Ma&&ir-gn==0,ga=Be&(Ki|ci)&&ir-gn==0;yt.isFirst=!!ei,yt.isFinal=!!ga,ei&&(ve.session={}),yt.eventType=Be,Dt(ve,yt),ve.emit("hammer.input",yt),ve.recognize(yt),ve.session.prevInput=yt}function Dt(ve,Be){var yt=ve.session,ir=Be.pointers,gn=ir.length;yt.firstInput||(yt.firstInput=Rr(Be)),gn>1&&!yt.firstMultiple?yt.firstMultiple=Rr(Be):gn===1&&(yt.firstMultiple=!1);var ei=yt.firstInput,ga=yt.firstMultiple,Jo=ga?ga.center:ei.center,Fa=Be.center=mn(ir);Be.timeStamp=Yt(),Be.deltaTime=Be.timeStamp-ei.timeStamp,Be.angle=Oi(Jo,Fa),Be.distance=bn(Jo,Fa),Cr(yt,Be),Be.offsetDirection=ni(Be.deltaX,Be.deltaY);var Zo=vi(Be.deltaTime,Be.deltaX,Be.deltaY);Be.overallVelocityX=Zo.x,Be.overallVelocityY=Zo.y,Be.overallVelocity=tr(Zo.x)>tr(Zo.y)?Zo.x:Zo.y,Be.scale=ga?Ha(ga.pointers,ir):1,Be.rotation=ga?Ni(ga.pointers,ir):0,Be.maxPointers=yt.prevInput?Be.pointers.length>yt.prevInput.maxPointers?Be.pointers.length:yt.prevInput.maxPointers:Be.pointers.length,_r(yt,Be);var Ho=ve.element;an(Be.srcEvent.target,Ho)&&(Ho=Be.srcEvent.target),Be.target=Ho}function Cr(ve,Be){var yt=Be.center,ir=ve.offsetDelta||{},gn=ve.prevDelta||{},ei=ve.prevInput||{};(Be.eventType===Ma||ei.eventType===Ki)&&(gn=ve.prevDelta={x:ei.deltaX||0,y:ei.deltaY||0},ir=ve.offsetDelta={x:yt.x,y:yt.y}),Be.deltaX=gn.x+(yt.x-ir.x),Be.deltaY=gn.y+(yt.y-ir.y)}function _r(ve,Be){var yt=ve.lastInterval||Be,ir=Be.timeStamp-yt.timeStamp,gn,ei,ga,Jo;if(Be.eventType!=ci&&(ir>Li||yt.velocity===K)){var Fa=Be.deltaX-yt.deltaX,Zo=Be.deltaY-yt.deltaY,Ho=vi(ir,Fa,Zo);ei=Ho.x,ga=Ho.y,gn=tr(Ho.x)>tr(Ho.y)?Ho.x:Ho.y,Jo=ni(Fa,Zo),ve.lastInterval=Be}else gn=yt.velocity,ei=yt.velocityX,ga=yt.velocityY,Jo=yt.direction;Be.velocity=gn,Be.velocityX=ei,Be.velocityY=ga,Be.direction=Jo}function Rr(ve){for(var Be=[],yt=0;yt<ve.pointers.length;)Be[yt]={clientX:Pt(ve.pointers[yt].clientX),clientY:Pt(ve.pointers[yt].clientY)},yt++;return{timeStamp:Yt(),pointers:Be,center:mn(Be),deltaX:ve.deltaX,deltaY:ve.deltaY}}function mn(ve){var Be=ve.length;if(Be===1)return{x:Pt(ve[0].clientX),y:Pt(ve[0].clientY)};for(var yt=0,ir=0,gn=0;gn<Be;)yt+=ve[gn].clientX,ir+=ve[gn].clientY,gn++;return{x:Pt(yt/Be),y:Pt(ir/Be)}}function vi(ve,Be,yt){return{x:Be/ve||0,y:yt/ve||0}}function ni(ve,Be){return ve===Be?gi:tr(ve)>=tr(Be)?ve<0?zo:go:Be<0?no:It}function bn(ve,Be,yt){yt||(yt=j);var ir=Be[yt[0]]-ve[yt[0]],gn=Be[yt[1]]-ve[yt[1]];return Math.sqrt(ir*ir+gn*gn)}function Oi(ve,Be,yt){yt||(yt=j);var ir=Be[yt[0]]-ve[yt[0]],gn=Be[yt[1]]-ve[yt[1]];return Math.atan2(gn,ir)*180/Math.PI}function Ni(ve,Be){return Oi(Be[1],Be[0],ot)+Oi(ve[1],ve[0],ot)}function Ha(ve,Be){return bn(Be[0],Be[1],ot)/bn(ve[0],ve[1],ot)}var oa={mousedown:Ma,mousemove:ai,mouseup:Ki},Wa="mousedown",Ci="mousemove mouseup";function la(){this.evEl=Wa,this.evWin=Ci,this.pressed=!1,sr.apply(this,arguments)}yr(la,sr,{handler:function(Be){var yt=oa[Be.type];yt&Ma&&Be.button===0&&(this.pressed=!0),yt&ai&&Be.which!==1&&(yt=Ki),!!this.pressed&&(yt&Ki&&(this.pressed=!1),this.callback(this.manager,yt,{pointers:[Be],changedPointers:[Be],pointerType:ba,srcEvent:Be}))}});var Q={pointerdown:Ma,pointermove:ai,pointerup:Ki,pointercancel:ci,pointerout:ci},ae={2:mi,3:ln,4:ba,5:ua},me="pointerdown",ke="pointermove pointerup pointercancel";!lt&&de.MSPointerEvent&&!de.PointerEvent&&(me="MSPointerDown",ke="MSPointerMove MSPointerUp MSPointerCancel");function qe(){this.evEl=me,this.evWin=ke,sr.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}yr(qe,sr,{handler:function(Be){var yt=this.store,ir=!1,gn=Be.type.toLowerCase().replace("ms",""),ei=Q[gn],ga=ae[Be.pointerType]||Be.pointerType,Jo=ga==mi,Fa=Z(yt,Be.pointerId,"pointerId");ei&Ma&&(Be.button===0||Jo)?Fa<0&&(yt.push(Be),Fa=yt.length-1):ei&(Ki|ci)&&(ir=!0),!(Fa<0)&&(yt[Fa]=Be,this.callback(this.manager,ei,{pointers:yt,changedPointers:[Be],pointerType:ga,srcEvent:Be}),ir&&yt.splice(Fa,1))}});var st={touchstart:Ma,touchmove:ai,touchend:Ki,touchcancel:ci},xt="touchstart",Me="touchstart touchmove touchend touchcancel";function it(){this.evTarget=xt,this.evWin=Me,this.started=!1,sr.apply(this,arguments)}yr(it,sr,{handler:function(Be){var yt=st[Be.type];if(yt===Ma&&(this.started=!0),!!this.started){var ir=Gt.call(this,Be,yt);yt&(Ki|ci)&&ir[0].length-ir[1].length==0&&(this.started=!1),this.callback(this.manager,yt,{pointers:ir[0],changedPointers:ir[1],pointerType:mi,srcEvent:Be})}}});function Gt(ve,Be){var yt=_e(ve.touches),ir=_e(ve.changedTouches);return Be&(Ki|ci)&&(yt=ze(yt.concat(ir),"identifier",!0)),[yt,ir]}var Zr={touchstart:Ma,touchmove:ai,touchend:Ki,touchcancel:ci},or="touchstart touchmove touchend touchcancel";function hr(){this.evTarget=or,this.targetIds={},sr.apply(this,arguments)}yr(hr,sr,{handler:function(Be){var yt=Zr[Be.type],ir=jr.call(this,Be,yt);!ir||this.callback(this.manager,yt,{pointers:ir[0],changedPointers:ir[1],pointerType:mi,srcEvent:Be})}});function jr(ve,Be){var yt=_e(ve.touches),ir=this.targetIds;if(Be&(Ma|ai)&&yt.length===1)return ir[yt[0].identifier]=!0,[yt,yt];var gn,ei,ga=_e(ve.changedTouches),Jo=[],Fa=this.target;if(ei=yt.filter(function(Zo){return an(Zo.target,Fa)}),Be===Ma)for(gn=0;gn<ei.length;)ir[ei[gn].identifier]=!0,gn++;for(gn=0;gn<ga.length;)ir[ga[gn].identifier]&&Jo.push(ga[gn]),Be&(Ki|ci)&&delete ir[ga[gn].identifier],gn++;if(!!Jo.length)return[ze(ei.concat(Jo),"identifier",!0),Jo]}var oi=2500,Sn=25;function Jt(){sr.apply(this,arguments);var ve=Rt(this.handler,this);this.touch=new hr(this.manager,ve),this.mouse=new la(this.manager,ve),this.primaryTouch=null,this.lastTouches=[]}yr(Jt,sr,{handler:function(Be,yt,ir){var gn=ir.pointerType==mi,ei=ir.pointerType==ba;if(!(ei&&ir.sourceCapabilities&&ir.sourceCapabilities.firesTouchEvents)){if(gn)Hn.call(this,yt,ir);else if(ei&&Tn.call(this,ir))return;this.callback(Be,yt,ir)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Hn(ve,Be){ve&Ma?(this.primaryTouch=Be.changedPointers[0].identifier,wn.call(this,Be)):ve&(Ki|ci)&&wn.call(this,Be)}function wn(ve){var Be=ve.changedPointers[0];if(Be.identifier===this.primaryTouch){var yt={x:Be.clientX,y:Be.clientY};this.lastTouches.push(yt);var ir=this.lastTouches,gn=function(){var ei=ir.indexOf(yt);ei>-1&&ir.splice(ei,1)};setTimeout(gn,oi)}}function Tn(ve){for(var Be=ve.srcEvent.clientX,yt=ve.srcEvent.clientY,ir=0;ir<this.lastTouches.length;ir++){var gn=this.lastTouches[ir],ei=Math.abs(Be-gn.x),ga=Math.abs(yt-gn.y);if(ei<=Sn&&ga<=Sn)return!0}return!1}var sa=lt?K:St(Xe.style,"touchAction"),Ir=sa!==K,qi="compute",La="auto",na="manipulation",pa="none",Lt="pan-x",At="pan-y",Qi=zi();function fo(ve,Be){this.manager=ve,this.set(Be)}fo.prototype={set:function(ve){ve==qi&&(ve=this.compute()),Ir&&this.manager.element.style&&Qi[ve]&&(this.manager.element.style[sa]=ve),this.actions=ve.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ve=[];return lr(this.manager.recognizers,function(Be){_t(Be.options.enable,[Be])&&(ve=ve.concat(Be.getTouchAction()))}),Ba(ve.join(" "))},preventDefaults:function(ve){var Be=ve.srcEvent,yt=ve.offsetDirection;if(this.manager.session.prevented){Be.preventDefault();return}var ir=this.actions,gn=ue(ir,pa)&&!Qi[pa],ei=ue(ir,At)&&!Qi[At],ga=ue(ir,Lt)&&!Qi[Lt];if(gn){var Jo=ve.pointers.length===1,Fa=ve.distance<2,Zo=ve.deltaTime<250;if(Jo&&Fa&&Zo)return}if(!(ga&&ei)&&(gn||ei&&yt&ge||ga&&yt&oe))return this.preventSrc(Be)},preventSrc:function(ve){this.manager.session.prevented=!0,ve.preventDefault()}};function Ba(ve){if(ue(ve,pa))return pa;var Be=ue(ve,Lt),yt=ue(ve,At);return Be&&yt?pa:Be||yt?Be?Lt:At:ue(ve,na)?na:La}function zi(){if(!Ir)return!1;var ve={};if(lt)return ve;var Be=de.CSS&&de.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(yt){ve[yt]=Be?de.CSS.supports("touch-action",yt):!0}),ve}var Ea=1,Co=2,sn=4,Wr=8,bt=Wr,Ds=16,jt=32;function Xi(ve){this.options=zt({},this.defaults,ve||{}),this.id=cr(),this.manager=null,this.options.enable=Kt(this.options.enable,!0),this.state=Ea,this.simultaneous={},this.requireFail=[]}Xi.prototype={defaults:{},set:function(ve){return zt(this.options,ve),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ve){if(br(ve,"recognizeWith",this))return this;var Be=this.simultaneous;return ve=po(ve,this),Be[ve.id]||(Be[ve.id]=ve,ve.recognizeWith(this)),this},dropRecognizeWith:function(ve){return br(ve,"dropRecognizeWith",this)?this:(ve=po(ve,this),delete this.simultaneous[ve.id],this)},requireFailure:function(ve){if(br(ve,"requireFailure",this))return this;var Be=this.requireFail;return ve=po(ve,this),Z(Be,ve)===-1&&(Be.push(ve),ve.requireFailure(this)),this},dropRequireFailure:function(ve){if(br(ve,"dropRequireFailure",this))return this;ve=po(ve,this);var Be=Z(this.requireFail,ve);return Be>-1&&this.requireFail.splice(Be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ve){return!!this.simultaneous[ve.id]},emit:function(ve){var Be=this,yt=this.state;function ir(gn){Be.manager.emit(gn,ve)}yt<Wr&&ir(Be.options.event+Yl(yt)),ir(Be.options.event),ve.additionalEvent&&ir(ve.additionalEvent),yt>=Wr&&ir(Be.options.event+Yl(yt))},tryEmit:function(ve){if(this.canEmit())return this.emit(ve);this.state=jt},canEmit:function(){for(var ve=0;ve<this.requireFail.length;){if(!(this.requireFail[ve].state&(jt|Ea)))return!1;ve++}return!0},recognize:function(ve){var Be=zt({},ve);if(!_t(this.options.enable,[this,Be])){this.reset(),this.state=jt;return}this.state&(bt|Ds|jt)&&(this.state=Ea),this.state=this.process(Be),this.state&(Co|sn|Wr|Ds)&&this.tryEmit(Be)},process:function(ve){},getTouchAction:function(){},reset:function(){}};function Yl(ve){return ve&Ds?"cancel":ve&Wr?"end":ve&sn?"move":ve&Co?"start":""}function Oa(ve){return ve==It?"down":ve==no?"up":ve==zo?"left":ve==go?"right":""}function po(ve,Be){var yt=Be.manager;return yt?yt.get(ve):ve}function Oo(){Xi.apply(this,arguments)}yr(Oo,Xi,{defaults:{pointers:1},attrTest:function(ve){var Be=this.options.pointers;return Be===0||ve.pointers.length===Be},process:function(ve){var Be=this.state,yt=ve.eventType,ir=Be&(Co|sn),gn=this.attrTest(ve);return ir&&(yt&ci||!gn)?Be|Ds:ir||gn?yt&Ki?Be|Wr:Be&Co?Be|sn:Co:jt}});function _a(){Oo.apply(this,arguments),this.pX=null,this.pY=null}yr(_a,Oo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Te},getTouchAction:function(){var ve=this.options.direction,Be=[];return ve&ge&&Be.push(At),ve&oe&&Be.push(Lt),Be},directionTest:function(ve){var Be=this.options,yt=!0,ir=ve.distance,gn=ve.direction,ei=ve.deltaX,ga=ve.deltaY;return gn&Be.direction||(Be.direction&ge?(gn=ei===0?gi:ei<0?zo:go,yt=ei!=this.pX,ir=Math.abs(ve.deltaX)):(gn=ga===0?gi:ga<0?no:It,yt=ga!=this.pY,ir=Math.abs(ve.deltaY))),ve.direction=gn,yt&&ir>Be.threshold&&gn&Be.direction},attrTest:function(ve){return Oo.prototype.attrTest.call(this,ve)&&(this.state&Co||!(this.state&Co)&&this.directionTest(ve))},emit:function(ve){this.pX=ve.deltaX,this.pY=ve.deltaY;var Be=Oa(ve.direction);Be&&(ve.additionalEvent=this.options.event+Be),this._super.emit.call(this,ve)}});function Bs(){Oo.apply(this,arguments)}yr(Bs,Oo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[pa]},attrTest:function(ve){return this._super.attrTest.call(this,ve)&&(Math.abs(ve.scale-1)>this.options.threshold||this.state&Co)},emit:function(ve){if(ve.scale!==1){var Be=ve.scale<1?"in":"out";ve.additionalEvent=this.options.event+Be}this._super.emit.call(this,ve)}});function Ns(){Xi.apply(this,arguments),this._timer=null,this._input=null}yr(Ns,Xi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[La]},process:function(ve){var Be=this.options,yt=ve.pointers.length===Be.pointers,ir=ve.distance<Be.threshold,gn=ve.deltaTime>Be.time;if(this._input=ve,!ir||!yt||ve.eventType&(Ki|ci)&&!gn)this.reset();else if(ve.eventType&Ma)this.reset(),this._timer=Wt(function(){this.state=bt,this.tryEmit()},Be.time,this);else if(ve.eventType&Ki)return bt;return jt},reset:function(){clearTimeout(this._timer)},emit:function(ve){this.state===bt&&(ve&&ve.eventType&Ki?this.manager.emit(this.options.event+"up",ve):(this._input.timeStamp=Yt(),this.manager.emit(this.options.event,this._input)))}});function ql(){Oo.apply(this,arguments)}yr(ql,Oo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[pa]},attrTest:function(ve){return this._super.attrTest.call(this,ve)&&(Math.abs(ve.rotation)>this.options.threshold||this.state&Co)}});function So(){Oo.apply(this,arguments)}yr(So,Oo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ge|oe,pointers:1},getTouchAction:function(){return _a.prototype.getTouchAction.call(this)},attrTest:function(ve){var Be=this.options.direction,yt;return Be&(ge|oe)?yt=ve.overallVelocity:Be&ge?yt=ve.overallVelocityX:Be&oe&&(yt=ve.overallVelocityY),this._super.attrTest.call(this,ve)&&Be&ve.offsetDirection&&ve.distance>this.options.threshold&&ve.maxPointers==this.options.pointers&&tr(yt)>this.options.velocity&&ve.eventType&Ki},emit:function(ve){var Be=Oa(ve.offsetDirection);Be&&this.manager.emit(this.options.event+Be,ve),this.manager.emit(this.options.event,ve)}});function Ts(){Xi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}yr(Ts,Xi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[na]},process:function(ve){var Be=this.options,yt=ve.pointers.length===Be.pointers,ir=ve.distance<Be.threshold,gn=ve.deltaTime<Be.time;if(this.reset(),ve.eventType&Ma&&this.count===0)return this.failTimeout();if(ir&&gn&&yt){if(ve.eventType!=Ki)return this.failTimeout();var ei=this.pTime?ve.timeStamp-this.pTime<Be.interval:!0,ga=!this.pCenter||bn(this.pCenter,ve.center)<Be.posThreshold;this.pTime=ve.timeStamp,this.pCenter=ve.center,!ga||!ei?this.count=1:this.count+=1,this._input=ve;var Jo=this.count%Be.taps;if(Jo===0)return this.hasRequireFailures()?(this._timer=Wt(function(){this.state=bt,this.tryEmit()},Be.interval,this),Co):bt}return jt},failTimeout:function(){return this._timer=Wt(function(){this.state=jt},this.options.interval,this),jt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==bt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Ka(ve,Be){return Be=Be||{},Be.recognizers=Kt(Be.recognizers,Ka.defaults.preset),new Fo(ve,Be)}Ka.VERSION="2.0.7",Ka.defaults={domEvents:!1,touchAction:qi,enable:!0,inputTarget:null,inputClass:null,preset:[[ql,{enable:!1}],[Bs,{enable:!1},["rotate"]],[So,{direction:ge}],[_a,{direction:ge},["swipe"]],[Ts],[Ts,{event:"doubletap",taps:2},["tap"]],[Ns]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Uo=1,Ms=2;function Fo(ve,Be){this.options=zt({},Ka.defaults,Be||{}),this.options.inputTarget=this.options.inputTarget||ve,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ve,this.input=Yr(this),this.touchAction=new fo(this,this.options.touchAction),Xu(this,!0),lr(this.options.recognizers,function(yt){var ir=this.add(new yt[0](yt[1]));yt[2]&&ir.recognizeWith(yt[2]),yt[3]&&ir.requireFailure(yt[3])},this)}Fo.prototype={set:function(ve){return zt(this.options,ve),ve.touchAction&&this.touchAction.update(),ve.inputTarget&&(this.input.destroy(),this.input.target=ve.inputTarget,this.input.init()),this},stop:function(ve){this.session.stopped=ve?Ms:Uo},recognize:function(ve){var Be=this.session;if(!Be.stopped){this.touchAction.preventDefaults(ve);var yt,ir=this.recognizers,gn=Be.curRecognizer;(!gn||gn&&gn.state&bt)&&(gn=Be.curRecognizer=null);for(var ei=0;ei<ir.length;)yt=ir[ei],Be.stopped!==Ms&&(!gn||yt==gn||yt.canRecognizeWith(gn))?yt.recognize(ve):yt.reset(),!gn&&yt.state&(Co|sn|Wr)&&(gn=Be.curRecognizer=yt),ei++}},get:function(ve){if(ve instanceof Xi)return ve;for(var Be=this.recognizers,yt=0;yt<Be.length;yt++)if(Be[yt].options.event==ve)return Be[yt];return null},add:function(ve){if(br(ve,"add",this))return this;var Be=this.get(ve.options.event);return Be&&this.remove(Be),this.recognizers.push(ve),ve.manager=this,this.touchAction.update(),ve},remove:function(ve){if(br(ve,"remove",this))return this;if(ve=this.get(ve),ve){var Be=this.recognizers,yt=Z(Be,ve);yt!==-1&&(Be.splice(yt,1),this.touchAction.update())}return this},on:function(ve,Be){if(ve!==K&&Be!==K){var yt=this.handlers;return lr(rt(ve),function(ir){yt[ir]=yt[ir]||[],yt[ir].push(Be)}),this}},off:function(ve,Be){if(ve!==K){var yt=this.handlers;return lr(rt(ve),function(ir){Be?yt[ir]&&yt[ir].splice(Z(yt[ir],Be),1):delete yt[ir]}),this}},emit:function(ve,Be){this.options.domEvents&&sl(ve,Be);var yt=this.handlers[ve]&&this.handlers[ve].slice();if(!(!yt||!yt.length)){Be.type=ve,Be.preventDefault=function(){Be.srcEvent.preventDefault()};for(var ir=0;ir<yt.length;)yt[ir](Be),ir++}},destroy:function(){this.element&&Xu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Xu(ve,Be){var yt=ve.element;if(!!yt.style){var ir;lr(ve.options.cssProps,function(gn,ei){ir=St(yt.style,ei),Be?(ve.oldCssProps[ir]=yt.style[ir],yt.style[ir]=gn):yt.style[ir]=ve.oldCssProps[ir]||""}),Be||(ve.oldCssProps={})}}function sl(ve,Be){if(!lt){var yt=y.createEvent("Event");yt.initEvent(ve,!0,!0),yt.gesture=Be,Be.target.dispatchEvent(yt)}}if(!lt){zt(Ka,{INPUT_START:Ma,INPUT_MOVE:ai,INPUT_END:Ki,INPUT_CANCEL:ci,STATE_POSSIBLE:Ea,STATE_BEGAN:Co,STATE_CHANGED:sn,STATE_ENDED:Wr,STATE_RECOGNIZED:bt,STATE_CANCELLED:Ds,STATE_FAILED:jt,DIRECTION_NONE:gi,DIRECTION_LEFT:zo,DIRECTION_RIGHT:go,DIRECTION_UP:no,DIRECTION_DOWN:It,DIRECTION_HORIZONTAL:ge,DIRECTION_VERTICAL:oe,DIRECTION_ALL:Te,Manager:Fo,Input:sr,TouchAction:fo,TouchInput:hr,MouseInput:la,PointerEventInput:qe,TouchMouseInput:Jt,SingleTouchInput:it,Recognizer:Xi,AttrRecognizer:Oo,Tap:Ts,Pan:_a,Swipe:So,Pinch:Bs,Rotate:ql,Press:Ns,on:Ue,off:Er,each:lr,merge:re,extend:Pr,assign:zt,inherit:yr,bindFn:Rt,prefixed:St});var ns=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ns.Hammer=Ka,We=function(){return Ka}.call(Ae,fe,Ae,hi),We!==K&&(hi.exports=We)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(hi,Ae,fe){(function(We,de){hi.exports=de(fe(18857))})(this,function(We){"use strict";var de=function(H){return H instanceof Uint8Array||H instanceof Uint16Array||H instanceof Uint32Array||H instanceof Int8Array||H instanceof Int16Array||H instanceof Int32Array||H instanceof Float32Array||H instanceof Float64Array||H instanceof Uint8ClampedArray},y=function(H,Le){for(var at=Object.keys(Le),fr=0;fr<at.length;++fr)H[at[fr]]=Le[at[fr]];return H},Ne=`
`;function K(H){return typeof atob!="undefined"?atob(H):"base64:"+H}function Re(H){var Le=new Error("(regl) "+H);throw console.error(Le),Le}function pe(H,Le){H||Re(Le)}function lt(H){return H?": "+H:""}function we(H,Le,at){H in Le||Re("unknown parameter ("+H+")"+lt(at)+". possible values: "+Object.keys(Le).join())}function Xe(H,Le){de(H)||Re("invalid parameter type"+lt(Le)+". must be a typed array")}function Ct(H,Le){switch(Le){case"number":return typeof H=="number";case"object":return typeof H=="object";case"string":return typeof H=="string";case"boolean":return typeof H=="boolean";case"function":return typeof H=="function";case"undefined":return typeof H=="undefined";case"symbol":return typeof H=="symbol"}}function Pt(H,Le,at){Ct(H,Le)||Re("invalid parameter type"+lt(at)+". expected "+Le+", got "+typeof H)}function tr(H,Le){H>=0&&(H|0)===H||Re("invalid parameter type, ("+H+")"+lt(Le)+". must be a nonnegative integer")}function Yt(H,Le,at){Le.indexOf(H)<0&&Re("invalid value"+lt(at)+". must be one of: "+Le)}var Wt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function br(H){Object.keys(H).forEach(function(Le){Wt.indexOf(Le)<0&&Re('invalid regl constructor argument "'+Le+'". must be one of '+Wt)})}function lr(H,Le){for(H=H+"";H.length<Le;)H=" "+H;return H}function kt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function zt(H,Le){this.number=H,this.line=Le,this.errors=[]}function Pr(H,Le,at){this.file=H,this.line=Le,this.message=at}function re(){var H=new Error,Le=(H.stack||H).toString(),at=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Le);if(at)return at[1];var fr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Le);return fr?fr[1]:"unknown"}function yr(){var H=new Error,Le=(H.stack||H).toString(),at=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Le);if(at)return at[1];var fr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Le);return fr?fr[1]:"unknown"}function Rt(H,Le){var at=H.split(`
`),fr=1,Nr=0,ur={unknown:new kt,0:new kt};ur.unknown.name=ur[0].name=Le||re(),ur.unknown.lines.push(new zt(0,""));for(var Tr=0;Tr<at.length;++Tr){var Vr=at[Tr],qr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Vr);if(qr)switch(qr[1]){case"line":var rn=/(\d+)(\s+\d+)?/.exec(qr[2]);rn&&(fr=rn[1]|0,rn[2]&&(Nr=rn[2]|0,Nr in ur||(ur[Nr]=new kt)));break;case"define":var pn=/SHADER_NAME(_B64)?\s+(.*)$/.exec(qr[2]);pn&&(ur[Nr].name=pn[1]?K(pn[2]):pn[2]);break}ur[Nr].lines.push(new zt(fr++,Vr))}return Object.keys(ur).forEach(function(dn){var An=ur[dn];An.lines.forEach(function(en){An.index[en.number]=en})}),ur}function _t(H){var Le=[];return H.split(`
`).forEach(function(at){if(!(at.length<5)){var fr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(at);fr?Le.push(new Pr(fr[1]|0,fr[2]|0,fr[3].trim())):at.length>0&&Le.push(new Pr("unknown",0,at))}}),Le}function Kt(H,Le){Le.forEach(function(at){var fr=H[at.file];if(fr){var Nr=fr.index[at.line];if(Nr){Nr.errors.push(at),fr.hasErrors=!0;return}}H.unknown.hasErrors=!0,H.unknown.lines[0].errors.push(at)})}function Ue(H,Le,at,fr,Nr){if(!H.getShaderParameter(Le,H.COMPILE_STATUS)){var ur=H.getShaderInfoLog(Le),Tr=fr===H.FRAGMENT_SHADER?"fragment":"vertex";ze(at,"string",Tr+" shader source must be a string",Nr);var Vr=Rt(at,Nr),qr=_t(ur);Kt(Vr,qr),Object.keys(Vr).forEach(function(rn){var pn=Vr[rn];if(!pn.hasErrors)return;var dn=[""],An=[""];function en(fn,Ft){dn.push(fn),An.push(Ft||"")}en("file number "+rn+": "+pn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),pn.lines.forEach(function(fn){if(fn.errors.length>0){en(lr(fn.number,4)+"|  ","background-color:yellow; font-weight:bold"),en(fn.line+Ne,"color:red; background-color:yellow; font-weight:bold");var Ft=0;fn.errors.forEach(function(mr){var nn=mr.message,kn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(nn);if(kn){var zr=kn[1];switch(nn=kn[2],zr){case"assign":zr="=";break}Ft=Math.max(fn.line.indexOf(zr,Ft),0)}else Ft=0;en(lr("| ",6)),en(lr("^^^",Ft+3)+Ne,"font-weight:bold"),en(lr("| ",6)),en(nn+Ne,"font-weight:bold")}),en(lr("| ",6)+Ne)}else en(lr(fn.number,4)+"|  "),en(fn.line+Ne,"color:red")}),typeof document!="undefined"&&!window.chrome?(An[0]=dn.join("%c"),console.log.apply(console,An)):console.log(dn.join(""))}),pe.raise("Error compiling "+Tr+" shader, "+Vr[0].name)}}function Er(H,Le,at,fr,Nr){if(!H.getProgramParameter(Le,H.LINK_STATUS)){var ur=H.getProgramInfoLog(Le),Tr=Rt(at,Nr),Vr=Rt(fr,Nr),qr='Error linking program with vertex shader, "'+Vr[0].name+'", and fragment shader "'+Tr[0].name+'"';typeof document!="undefined"?console.log("%c"+qr+Ne+"%c"+ur,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(qr+Ne+ur),pe.raise(qr)}}function an(H){H._commandRef=re()}function ue(H,Le,at,fr){an(H);function Nr(qr){return qr?fr.id(qr):0}H._fragId=Nr(H.static.frag),H._vertId=Nr(H.static.vert);function ur(qr,rn){Object.keys(rn).forEach(function(pn){qr[fr.id(pn)]=!0})}var Tr=H._uniformSet={};ur(Tr,Le.static),ur(Tr,Le.dynamic);var Vr=H._attributeSet={};ur(Vr,at.static),ur(Vr,at.dynamic),H._hasCount="count"in H.static||"count"in H.dynamic||"elements"in H.static||"elements"in H.dynamic}function rt(H,Le){var at=yr();Re(H+" in command "+(Le||re())+(at==="unknown"?"":" called from "+at))}function Z(H,Le,at){H||rt(Le,at||re())}function _e(H,Le,at,fr){H in Le||rt("unknown parameter ("+H+")"+lt(at)+". possible values: "+Object.keys(Le).join(),fr||re())}function ze(H,Le,at,fr){Ct(H,Le)||rt("invalid parameter type"+lt(at)+". expected "+Le+", got "+typeof H,fr||re())}function St(H){H()}function Ut(H,Le,at){H.texture?Yt(H.texture._texture.internalformat,Le,"unsupported texture format for attachment"):Yt(H.renderbuffer._renderbuffer.format,at,"unsupported renderbuffer format for attachment")}var cr=33071,wt=9728,Or=9984,Xn=9985,Qr=9986,Pi=9987,mi=5120,ln=5121,ba=5122,ua=5123,Li=5124,Ma=5125,ai=5126,Ki=32819,ci=32820,gi=33635,zo=34042,go=36193,no={};no[mi]=no[ln]=1,no[ba]=no[ua]=no[go]=no[gi]=no[Ki]=no[ci]=2,no[Li]=no[Ma]=no[ai]=no[zo]=4;function It(H,Le){return H===ci||H===Ki||H===gi?2:H===zo?4:no[H]*Le}function ge(H){return!(H&H-1)&&!!H}function oe(H,Le,at){var fr,Nr=Le.width,ur=Le.height,Tr=Le.channels;pe(Nr>0&&Nr<=at.maxTextureSize&&ur>0&&ur<=at.maxTextureSize,"invalid texture shape"),(H.wrapS!==cr||H.wrapT!==cr)&&pe(ge(Nr)&&ge(ur),"incompatible wrap mode for texture, both width and height must be power of 2"),Le.mipmask===1?Nr!==1&&ur!==1&&pe(H.minFilter!==Or&&H.minFilter!==Qr&&H.minFilter!==Xn&&H.minFilter!==Pi,"min filter requires mipmap"):(pe(ge(Nr)&&ge(ur),"texture must be a square power of 2 to support mipmapping"),pe(Le.mipmask===(Nr<<1)-1,"missing or incomplete mipmap data")),Le.type===ai&&(at.extensions.indexOf("oes_texture_float_linear")<0&&pe(H.minFilter===wt&&H.magFilter===wt,"filter not supported, must enable oes_texture_float_linear"),pe(!H.genMipmaps,"mipmap generation not supported with float textures"));var Vr=Le.images;for(fr=0;fr<16;++fr)if(Vr[fr]){var qr=Nr>>fr,rn=ur>>fr;pe(Le.mipmask&1<<fr,"missing mipmap data");var pn=Vr[fr];if(pe(pn.width===qr&&pn.height===rn,"invalid shape for mip images"),pe(pn.format===Le.format&&pn.internalformat===Le.internalformat&&pn.type===Le.type,"incompatible type for mip image"),!pn.compressed)if(pn.data){var dn=Math.ceil(It(pn.type,Tr)*qr/pn.unpackAlignment)*pn.unpackAlignment;pe(pn.data.byteLength===dn*rn,"invalid data for image, buffer size is inconsistent with image format")}else pn.element||pn.copy}else H.genMipmaps||pe((Le.mipmask&1<<fr)==0,"extra mipmap data");Le.compressed&&pe(!H.genMipmaps,"mipmap generation for compressed images not supported")}function Te(H,Le,at,fr){var Nr=H.width,ur=H.height,Tr=H.channels;pe(Nr>0&&Nr<=fr.maxTextureSize&&ur>0&&ur<=fr.maxTextureSize,"invalid texture shape"),pe(Nr===ur,"cube map must be square"),pe(Le.wrapS===cr&&Le.wrapT===cr,"wrap mode not supported by cube map");for(var Vr=0;Vr<at.length;++Vr){var qr=at[Vr];pe(qr.width===Nr&&qr.height===ur,"inconsistent cube map face shape"),Le.genMipmaps&&(pe(!qr.compressed,"can not generate mipmap for compressed textures"),pe(qr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var rn=qr.images,pn=0;pn<16;++pn){var dn=rn[pn];if(dn){var An=Nr>>pn,en=ur>>pn;pe(qr.mipmask&1<<pn,"missing mipmap data"),pe(dn.width===An&&dn.height===en,"invalid shape for mip images"),pe(dn.format===H.format&&dn.internalformat===H.internalformat&&dn.type===H.type,"incompatible type for mip image"),dn.compressed||(dn.data?pe(dn.data.byteLength===An*en*Math.max(It(dn.type,Tr),dn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):dn.element||dn.copy)}}}}var j=y(pe,{optional:St,raise:Re,commandRaise:rt,command:Z,parameter:we,commandParameter:_e,constructor:br,type:Pt,commandType:ze,isTypedArray:Xe,nni:tr,oneOf:Yt,shaderError:Ue,linkError:Er,callSite:yr,saveCommandRef:an,saveDrawInfo:ue,framebufferFormat:Ut,guessCommand:re,texture2D:oe,textureCube:Te}),ot=0,sr=0,Yr=5,Ke=6;function Dt(H,Le){this.id=ot++,this.type=H,this.data=Le}function Cr(H){return H.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function _r(H){if(H.length===0)return[];var Le=H.charAt(0),at=H.charAt(H.length-1);if(H.length>1&&Le===at&&(Le==='"'||Le==="'"))return['"'+Cr(H.substr(1,H.length-2))+'"'];var fr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(H);if(fr)return _r(H.substr(0,fr.index)).concat(_r(fr[1])).concat(_r(H.substr(fr.index+fr[0].length)));var Nr=H.split(".");if(Nr.length===1)return['"'+Cr(H)+'"'];for(var ur=[],Tr=0;Tr<Nr.length;++Tr)ur=ur.concat(_r(Nr[Tr]));return ur}function Rr(H){return"["+_r(H).join("][")+"]"}function mn(H,Le){return new Dt(H,Rr(Le+""))}function vi(H){return typeof H=="function"&&!H._reglType||H instanceof Dt}function ni(H,Le){if(typeof H=="function")return new Dt(sr,H);if(typeof H=="number"||typeof H=="boolean")return new Dt(Yr,H);if(Array.isArray(H))return new Dt(Ke,H.map(function(at,fr){return ni(at,Le+"["+fr+"]")}));if(H instanceof Dt)return H;j(!1,"invalid option type in uniform "+Le)}var bn={DynamicVariable:Dt,define:mn,isDynamic:vi,unbox:ni,accessor:Rr},Oi={next:typeof requestAnimationFrame=="function"?function(H){return requestAnimationFrame(H)}:function(H){return setTimeout(H,16)},cancel:typeof cancelAnimationFrame=="function"?function(H){return cancelAnimationFrame(H)}:clearTimeout},Ni=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ha=Ni?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function oa(){var H={"":0},Le=[""];return{id:function(at){var fr=H[at];return fr||(fr=H[at]=Le.length,Le.push(at),fr)},str:function(at){return Le[at]}}}function Wa(H,Le,at){var fr=document.createElement("canvas");y(fr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),H.appendChild(fr),H===document.body&&(fr.style.position="absolute",y(H.style,{margin:0,padding:0}));function Nr(){var Vr=window.innerWidth,qr=window.innerHeight;if(H!==document.body){var rn=fr.getBoundingClientRect();Vr=rn.right-rn.left,qr=rn.bottom-rn.top}fr.width=at*Vr,fr.height=at*qr}var ur;H!==document.body&&typeof ResizeObserver=="function"?(ur=new ResizeObserver(function(){setTimeout(Nr)}),ur.observe(H)):window.addEventListener("resize",Nr,!1);function Tr(){ur?ur.disconnect():window.removeEventListener("resize",Nr),H.removeChild(fr)}return Nr(),{canvas:fr,onDestroy:Tr}}function Ci(H,Le){function at(fr){try{return H.getContext(fr,Le)}catch(Nr){return null}}return at("webgl")||at("experimental-webgl")||at("webgl-experimental")}function la(H){return typeof H.nodeName=="string"&&typeof H.appendChild=="function"&&typeof H.getBoundingClientRect=="function"}function Q(H){return typeof H.drawArrays=="function"||typeof H.drawElements=="function"}function ae(H){return typeof H=="string"?H.split():(j(Array.isArray(H),"invalid extension array"),H)}function me(H){return typeof H=="string"?(j(typeof document!="undefined","not supported outside of DOM"),document.querySelector(H)):H}function ke(H){var Le=H||{},at,fr,Nr,ur,Tr={},Vr=[],qr=[],rn=typeof window=="undefined"?1:window.devicePixelRatio,pn=!1,dn=function(fn){fn&&j.raise(fn)},An=function(){};if(typeof Le=="string"?(j(typeof document!="undefined","selector queries only supported in DOM environments"),at=document.querySelector(Le),j(at,"invalid query string for element")):typeof Le=="object"?la(Le)?at=Le:Q(Le)?(ur=Le,Nr=ur.canvas):(j.constructor(Le),"gl"in Le?ur=Le.gl:"canvas"in Le?Nr=me(Le.canvas):"container"in Le&&(fr=me(Le.container)),"attributes"in Le&&(Tr=Le.attributes,j.type(Tr,"object","invalid context attributes")),"extensions"in Le&&(Vr=ae(Le.extensions)),"optionalExtensions"in Le&&(qr=ae(Le.optionalExtensions)),"onDone"in Le&&(j.type(Le.onDone,"function","invalid or missing onDone callback"),dn=Le.onDone),"profile"in Le&&(pn=!!Le.profile),"pixelRatio"in Le&&(rn=+Le.pixelRatio,j(rn>0,"invalid pixel ratio"))):j.raise("invalid arguments to regl"),at&&(at.nodeName.toLowerCase()==="canvas"?Nr=at:fr=at),!ur){if(!Nr){j(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var en=Wa(fr||document.body,dn,rn);if(!en)return null;Nr=en.canvas,An=en.onDestroy}Tr.premultipliedAlpha===void 0&&(Tr.premultipliedAlpha=!0),ur=Ci(Nr,Tr)}return ur?{gl:ur,canvas:Nr,container:fr,extensions:Vr,optionalExtensions:qr,pixelRatio:rn,profile:pn,onDone:dn,onDestroy:An}:(An(),dn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function qe(H,Le){var at={};function fr(Vr){j.type(Vr,"string","extension name must be string");var qr=Vr.toLowerCase(),rn;try{rn=at[qr]=Nr(Vr)}catch(pn){}return!!rn}function Nr(Vr){return H.getExtension(Vr)?H.getExtension(Vr):H.getExtension(Vr.toLowerCase())?H.getExtension(Vr.toLowerCase()):null}for(var ur=0;ur<Le.extensions.length;++ur){var Tr=Le.extensions[ur];if(!fr(Tr))return Le.onDestroy(),Le.onDone('"'+Tr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Le.optionalExtensions.forEach(fr),{extensions:at,restore:function(){Object.keys(at).forEach(function(Vr){if(at[Vr]&&!fr(Vr))throw new Error("(regl): error restoring extension "+Vr)})}}}function st(H,Le){for(var at=Array(H),fr=0;fr<H;++fr)at[fr]=Le(fr);return at}var xt=5120,Me=5121,it=5122,Gt=5123,Zr=5124,or=5125,hr=5126;function jr(H){for(var Le=16;Le<=1<<28;Le*=16)if(H<=Le)return Le;return 0}function oi(H){var Le,at;return Le=(H>65535)<<4,H>>>=Le,at=(H>255)<<3,H>>>=at,Le|=at,at=(H>15)<<2,H>>>=at,Le|=at,at=(H>3)<<1,H>>>=at,Le|=at,Le|H>>1}function Sn(){var H=st(8,function(){return[]});function Le(ur){var Tr=jr(ur),Vr=H[oi(Tr)>>2];return Vr.length>0?Vr.pop():new ArrayBuffer(Tr)}function at(ur){H[oi(ur.byteLength)>>2].push(ur)}function fr(ur,Tr){var Vr=null;switch(ur){case xt:Vr=new Int8Array(Le(Tr),0,Tr);break;case Me:Vr=new Uint8Array(Le(Tr),0,Tr);break;case it:Vr=new Int16Array(Le(2*Tr),0,Tr);break;case Gt:Vr=new Uint16Array(Le(2*Tr),0,Tr);break;case Zr:Vr=new Int32Array(Le(4*Tr),0,Tr);break;case or:Vr=new Uint32Array(Le(4*Tr),0,Tr);break;case hr:Vr=new Float32Array(Le(4*Tr),0,Tr);break;default:return null}return Vr.length!==Tr?Vr.subarray(0,Tr):Vr}function Nr(ur){at(ur.buffer)}return{alloc:Le,free:at,allocType:fr,freeType:Nr}}var Jt=Sn();Jt.zero=Sn();var Hn=3408,wn=3410,Tn=3411,sa=3412,Ir=3413,qi=3414,La=3415,na=33901,pa=33902,Lt=3379,At=3386,Qi=34921,fo=36347,Ba=36348,zi=35661,Ea=35660,Co=34930,sn=36349,Wr=34076,bt=34024,Ds=7936,jt=7937,Xi=7938,Yl=35724,Oa=34047,po=36063,Oo=34852,_a=3553,Bs=34067,Ns=34069,ql=33984,So=6408,Ts=5126,Ka=5121,Uo=36160,Ms=36053,Fo=36064,Xu=16384,sl=function(H,Le){var at=1;Le.ext_texture_filter_anisotropic&&(at=H.getParameter(Oa));var fr=1,Nr=1;Le.webgl_draw_buffers&&(fr=H.getParameter(Oo),Nr=H.getParameter(po));var ur=!!Le.oes_texture_float;if(ur){var Tr=H.createTexture();H.bindTexture(_a,Tr),H.texImage2D(_a,0,So,1,1,0,So,Ts,null);var Vr=H.createFramebuffer();if(H.bindFramebuffer(Uo,Vr),H.framebufferTexture2D(Uo,Fo,_a,Tr,0),H.bindTexture(_a,null),H.checkFramebufferStatus(Uo)!==Ms)ur=!1;else{H.viewport(0,0,1,1),H.clearColor(1,0,0,1),H.clear(Xu);var qr=Jt.allocType(Ts,4);H.readPixels(0,0,1,1,So,Ts,qr),H.getError()?ur=!1:(H.deleteFramebuffer(Vr),H.deleteTexture(Tr),ur=qr[0]===1),Jt.freeType(qr)}}var rn=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),pn=!0;if(!rn){var dn=H.createTexture(),An=Jt.allocType(Ka,36);H.activeTexture(ql),H.bindTexture(Bs,dn),H.texImage2D(Ns,0,So,3,3,0,So,Ka,An),Jt.freeType(An),H.bindTexture(Bs,null),H.deleteTexture(dn),pn=!H.getError()}return{colorBits:[H.getParameter(wn),H.getParameter(Tn),H.getParameter(sa),H.getParameter(Ir)],depthBits:H.getParameter(qi),stencilBits:H.getParameter(La),subpixelBits:H.getParameter(Hn),extensions:Object.keys(Le).filter(function(en){return!!Le[en]}),maxAnisotropic:at,maxDrawbuffers:fr,maxColorAttachments:Nr,pointSizeDims:H.getParameter(na),lineWidthDims:H.getParameter(pa),maxViewportDims:H.getParameter(At),maxCombinedTextureUnits:H.getParameter(zi),maxCubeMapSize:H.getParameter(Wr),maxRenderbufferSize:H.getParameter(bt),maxTextureUnits:H.getParameter(Co),maxTextureSize:H.getParameter(Lt),maxAttributes:H.getParameter(Qi),maxVertexUniforms:H.getParameter(fo),maxVertexTextureUnits:H.getParameter(Ea),maxVaryingVectors:H.getParameter(Ba),maxFragmentUniforms:H.getParameter(sn),glsl:H.getParameter(Yl),renderer:H.getParameter(jt),vendor:H.getParameter(Ds),version:H.getParameter(Xi),readFloat:ur,npotTextureCube:pn}};function ns(H){return!!H&&typeof H=="object"&&Array.isArray(H.shape)&&Array.isArray(H.stride)&&typeof H.offset=="number"&&H.shape.length===H.stride.length&&(Array.isArray(H.data)||de(H.data))}var ve=function(H){return Object.keys(H).map(function(Le){return H[Le]})},Be={shape:Jo,flatten:ga};function yt(H,Le,at){for(var fr=0;fr<Le;++fr)at[fr]=H[fr]}function ir(H,Le,at,fr){for(var Nr=0,ur=0;ur<Le;++ur)for(var Tr=H[ur],Vr=0;Vr<at;++Vr)fr[Nr++]=Tr[Vr]}function gn(H,Le,at,fr,Nr,ur){for(var Tr=ur,Vr=0;Vr<Le;++Vr)for(var qr=H[Vr],rn=0;rn<at;++rn)for(var pn=qr[rn],dn=0;dn<fr;++dn)Nr[Tr++]=pn[dn]}function ei(H,Le,at,fr,Nr){for(var ur=1,Tr=at+1;Tr<Le.length;++Tr)ur*=Le[Tr];var Vr=Le[at];if(Le.length-at==4){var qr=Le[at+1],rn=Le[at+2],pn=Le[at+3];for(Tr=0;Tr<Vr;++Tr)gn(H[Tr],qr,rn,pn,fr,Nr),Nr+=ur}else for(Tr=0;Tr<Vr;++Tr)ei(H[Tr],Le,at+1,fr,Nr),Nr+=ur}function ga(H,Le,at,fr){var Nr=1;if(Le.length)for(var ur=0;ur<Le.length;++ur)Nr*=Le[ur];else Nr=0;var Tr=fr||Jt.allocType(at,Nr);switch(Le.length){case 0:break;case 1:yt(H,Le[0],Tr);break;case 2:ir(H,Le[0],Le[1],Tr);break;case 3:gn(H,Le[0],Le[1],Le[2],Tr,0);break;default:ei(H,Le,0,Tr,0)}return Tr}function Jo(H){for(var Le=[],at=H;at.length;at=at[0])Le.push(at.length);return Le}var Fa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Zo=5120,Ho=5122,Ro=5124,zs=5121,hs=5123,Is=5125,bu=5126,Yu=5126,Eu={int8:Zo,int16:Ho,int32:Ro,uint8:zs,uint16:hs,uint32:Is,float:bu,float32:Yu},Cu=35048,Za=35040,ps={dynamic:Cu,stream:Za,static:35044},iu=Be.flatten,Su=Be.shape,mf=35044,zh=35040,qs=5121,gf=5126,ul=[];ul[5120]=1,ul[5122]=2,ul[5124]=4,ul[5121]=1,ul[5123]=2,ul[5125]=4,ul[5126]=4;function jc(H){return Fa[Object.prototype.toString.call(H)]|0}function b(H,Le){for(var at=0;at<Le.length;++at)H[at]=Le[at]}function k(H,Le,at,fr,Nr,ur,Tr){for(var Vr=0,qr=0;qr<at;++qr)for(var rn=0;rn<fr;++rn)H[Vr++]=Le[Nr*qr+ur*rn+Tr]}function G(H,Le,at,fr){var Nr=0,ur={};function Tr(Ft){this.id=Nr++,this.buffer=H.createBuffer(),this.type=Ft,this.usage=mf,this.byteLength=0,this.dimension=1,this.dtype=qs,this.persistentData=null,at.profile&&(this.stats={size:0})}Tr.prototype.bind=function(){H.bindBuffer(this.type,this.buffer)},Tr.prototype.destroy=function(){An(this)};var Vr=[];function qr(Ft,mr){var nn=Vr.pop();return nn||(nn=new Tr(Ft)),nn.bind(),dn(nn,mr,zh,0,1,!1),nn}function rn(Ft){Vr.push(Ft)}function pn(Ft,mr,nn){Ft.byteLength=mr.byteLength,H.bufferData(Ft.type,mr,nn)}function dn(Ft,mr,nn,kn,zr,_n){var On;if(Ft.usage=nn,Array.isArray(mr)){if(Ft.dtype=kn||gf,mr.length>0){var Ti;if(Array.isArray(mr[0])){On=Su(mr);for(var Mr=1,Lr=1;Lr<On.length;++Lr)Mr*=On[Lr];Ft.dimension=Mr,Ti=iu(mr,On,Ft.dtype),pn(Ft,Ti,nn),_n?Ft.persistentData=Ti:Jt.freeType(Ti)}else if(typeof mr[0]=="number"){Ft.dimension=zr;var si=Jt.allocType(Ft.dtype,mr.length);b(si,mr),pn(Ft,si,nn),_n?Ft.persistentData=si:Jt.freeType(si)}else de(mr[0])?(Ft.dimension=mr[0].length,Ft.dtype=kn||jc(mr[0])||gf,Ti=iu(mr,[mr.length,mr[0].length],Ft.dtype),pn(Ft,Ti,nn),_n?Ft.persistentData=Ti:Jt.freeType(Ti)):j.raise("invalid buffer data")}}else if(de(mr))Ft.dtype=kn||jc(mr),Ft.dimension=zr,pn(Ft,mr,nn),_n&&(Ft.persistentData=new Uint8Array(new Uint8Array(mr.buffer)));else if(ns(mr)){On=mr.shape;var Ln=mr.stride,tn=mr.offset,Bn=0,Un=0,ca=0,Hi=0;On.length===1?(Bn=On[0],Un=1,ca=Ln[0],Hi=0):On.length===2?(Bn=On[0],Un=On[1],ca=Ln[0],Hi=Ln[1]):j.raise("invalid shape"),Ft.dtype=kn||jc(mr.data)||gf,Ft.dimension=Un;var Jr=Jt.allocType(Ft.dtype,Bn*Un);k(Jr,mr.data,Bn,Un,ca,Hi,tn),pn(Ft,Jr,nn),_n?Ft.persistentData=Jr:Jt.freeType(Jr)}else mr instanceof ArrayBuffer?(Ft.dtype=qs,Ft.dimension=zr,pn(Ft,mr,nn),_n&&(Ft.persistentData=new Uint8Array(new Uint8Array(mr)))):j.raise("invalid buffer data")}function An(Ft){Le.bufferCount--,fr(Ft);var mr=Ft.buffer;j(mr,"buffer must not be deleted already"),H.deleteBuffer(mr),Ft.buffer=null,delete ur[Ft.id]}function en(Ft,mr,nn,kn){Le.bufferCount++;var zr=new Tr(mr);ur[zr.id]=zr;function _n(Mr){var Lr=mf,si=null,Ln=0,tn=0,Bn=1;return Array.isArray(Mr)||de(Mr)||ns(Mr)||Mr instanceof ArrayBuffer?si=Mr:typeof Mr=="number"?Ln=Mr|0:Mr&&(j.type(Mr,"object","buffer arguments must be an object, a number or an array"),"data"in Mr&&(j(si===null||Array.isArray(si)||de(si)||ns(si),"invalid data for buffer"),si=Mr.data),"usage"in Mr&&(j.parameter(Mr.usage,ps,"invalid buffer usage"),Lr=ps[Mr.usage]),"type"in Mr&&(j.parameter(Mr.type,Eu,"invalid buffer type"),tn=Eu[Mr.type]),"dimension"in Mr&&(j.type(Mr.dimension,"number","invalid dimension"),Bn=Mr.dimension|0),"length"in Mr&&(j.nni(Ln,"buffer length must be a nonnegative integer"),Ln=Mr.length|0)),zr.bind(),si?dn(zr,si,Lr,tn,Bn,kn):(Ln&&H.bufferData(zr.type,Ln,Lr),zr.dtype=tn||qs,zr.usage=Lr,zr.dimension=Bn,zr.byteLength=Ln),at.profile&&(zr.stats.size=zr.byteLength*ul[zr.dtype]),_n}function On(Mr,Lr){j(Lr+Mr.byteLength<=zr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Mr.byteLength+" starting from offset "+Lr+" to a buffer of size "+zr.byteLength),H.bufferSubData(zr.type,Lr,Mr)}function Ti(Mr,Lr){var si=(Lr||0)|0,Ln;if(zr.bind(),de(Mr)||Mr instanceof ArrayBuffer)On(Mr,si);else if(Array.isArray(Mr)){if(Mr.length>0)if(typeof Mr[0]=="number"){var tn=Jt.allocType(zr.dtype,Mr.length);b(tn,Mr),On(tn,si),Jt.freeType(tn)}else if(Array.isArray(Mr[0])||de(Mr[0])){Ln=Su(Mr);var Bn=iu(Mr,Ln,zr.dtype);On(Bn,si),Jt.freeType(Bn)}else j.raise("invalid buffer data")}else if(ns(Mr)){Ln=Mr.shape;var Un=Mr.stride,ca=0,Hi=0,Jr=0,on=0;Ln.length===1?(ca=Ln[0],Hi=1,Jr=Un[0],on=0):Ln.length===2?(ca=Ln[0],Hi=Ln[1],Jr=Un[0],on=Un[1]):j.raise("invalid shape");var Ii=Array.isArray(Mr.data)?zr.dtype:jc(Mr.data),ta=Jt.allocType(Ii,ca*Hi);k(ta,Mr.data,ca,Hi,Jr,on,Mr.offset),On(ta,si),Jt.freeType(ta)}else j.raise("invalid data for buffer subdata");return _n}return nn||_n(Ft),_n._reglType="buffer",_n._buffer=zr,_n.subdata=Ti,at.profile&&(_n.stats=zr.stats),_n.destroy=function(){An(zr)},_n}function fn(){ve(ur).forEach(function(Ft){Ft.buffer=H.createBuffer(),H.bindBuffer(Ft.type,Ft.buffer),H.bufferData(Ft.type,Ft.persistentData||Ft.byteLength,Ft.usage)})}return at.profile&&(Le.getTotalBufferSize=function(){var Ft=0;return Object.keys(ur).forEach(function(mr){Ft+=ur[mr].stats.size}),Ft}),{create:en,createStream:qr,destroyStream:rn,clear:function(){ve(ur).forEach(An),Vr.forEach(An)},getBuffer:function(Ft){return Ft&&Ft._buffer instanceof Tr?Ft._buffer:null},restore:fn,_initBuffer:dn}}var D=0,ne=0,Oe=1,dt=1,Mt=4,Zt=4,Br={points:D,point:ne,lines:Oe,line:dt,triangles:Mt,triangle:Zt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Gr=0,Yn=1,ji=4,Ui=5120,Fi=5121,io=5122,vo=5123,Ia=5124,au=5125,Ll=34963,hc=35040,pc=35044;function dc(H,Le,at,fr){var Nr={},ur=0,Tr={uint8:Fi,uint16:vo};Le.oes_element_index_uint&&(Tr.uint32=au);function Vr(fn){this.id=ur++,Nr[this.id]=this,this.buffer=fn,this.primType=ji,this.vertCount=0,this.type=0}Vr.prototype.bind=function(){this.buffer.bind()};var qr=[];function rn(fn){var Ft=qr.pop();return Ft||(Ft=new Vr(at.create(null,Ll,!0,!1)._buffer)),dn(Ft,fn,hc,-1,-1,0,0),Ft}function pn(fn){qr.push(fn)}function dn(fn,Ft,mr,nn,kn,zr,_n){fn.buffer.bind();var On;if(Ft){var Ti=_n;!_n&&(!de(Ft)||ns(Ft)&&!de(Ft.data))&&(Ti=Le.oes_element_index_uint?au:vo),at._initBuffer(fn.buffer,Ft,mr,Ti,3)}else H.bufferData(Ll,zr,mr),fn.buffer.dtype=On||Fi,fn.buffer.usage=mr,fn.buffer.dimension=3,fn.buffer.byteLength=zr;if(On=_n,!_n){switch(fn.buffer.dtype){case Fi:case Ui:On=Fi;break;case vo:case io:On=vo;break;case au:case Ia:On=au;break;default:j.raise("unsupported type for element array")}fn.buffer.dtype=On}fn.type=On,j(On!==au||!!Le.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Mr=kn;Mr<0&&(Mr=fn.buffer.byteLength,On===vo?Mr>>=1:On===au&&(Mr>>=2)),fn.vertCount=Mr;var Lr=nn;if(nn<0){Lr=ji;var si=fn.buffer.dimension;si===1&&(Lr=Gr),si===2&&(Lr=Yn),si===3&&(Lr=ji)}fn.primType=Lr}function An(fn){fr.elementsCount--,j(fn.buffer!==null,"must not double destroy elements"),delete Nr[fn.id],fn.buffer.destroy(),fn.buffer=null}function en(fn,Ft){var mr=at.create(null,Ll,!0),nn=new Vr(mr._buffer);fr.elementsCount++;function kn(zr){if(!zr)mr(),nn.primType=ji,nn.vertCount=0,nn.type=Fi;else if(typeof zr=="number")mr(zr),nn.primType=ji,nn.vertCount=zr|0,nn.type=Fi;else{var _n=null,On=pc,Ti=-1,Mr=-1,Lr=0,si=0;Array.isArray(zr)||de(zr)||ns(zr)?_n=zr:(j.type(zr,"object","invalid arguments for elements"),"data"in zr&&(_n=zr.data,j(Array.isArray(_n)||de(_n)||ns(_n),"invalid data for element buffer")),"usage"in zr&&(j.parameter(zr.usage,ps,"invalid element buffer usage"),On=ps[zr.usage]),"primitive"in zr&&(j.parameter(zr.primitive,Br,"invalid element buffer primitive"),Ti=Br[zr.primitive]),"count"in zr&&(j(typeof zr.count=="number"&&zr.count>=0,"invalid vertex count for elements"),Mr=zr.count|0),"type"in zr&&(j.parameter(zr.type,Tr,"invalid buffer type"),si=Tr[zr.type]),"length"in zr?Lr=zr.length|0:(Lr=Mr,si===vo||si===io?Lr*=2:(si===au||si===Ia)&&(Lr*=4))),dn(nn,_n,On,Ti,Mr,Lr,si)}return kn}return kn(fn),kn._reglType="elements",kn._elements=nn,kn.subdata=function(zr,_n){return mr.subdata(zr,_n),kn},kn.destroy=function(){An(nn)},kn}return{create:en,createStream:rn,destroyStream:pn,getElements:function(fn){return typeof fn=="function"&&fn._elements instanceof Vr?fn._elements:null},clear:function(){ve(Nr).forEach(An)}}}var vc=new Float32Array(1),Du=new Uint32Array(vc.buffer),Ol=5123;function gl(H){for(var Le=Jt.allocType(Ol,H.length),at=0;at<H.length;++at)if(isNaN(H[at]))Le[at]=65535;else if(H[at]===Infinity)Le[at]=31744;else if(H[at]===-Infinity)Le[at]=64512;else{vc[0]=H[at];var fr=Du[0],Nr=fr>>>31<<15,ur=(fr<<1>>>24)-127,Tr=fr>>13&(1<<10)-1;if(ur<-24)Le[at]=Nr;else if(ur<-14){var Vr=-14-ur;Le[at]=Nr+(Tr+(1<<10)>>Vr)}else ur>15?Le[at]=Nr+31744:Le[at]=Nr+(ur+15<<10)+Tr}return Le}function Wo(H){return Array.isArray(H)||de(H)}var dp=function(H){return!(H&H-1)&&!!H},Uh=34467,Au=3553,yf=34067,yl=34069,qu=6408,Zh=6406,_l=6407,mo=6409,$s=6410,Vh=32854,xl=32855,vp=36194,mp=32819,ch=32820,jf=33635,_f=34042,Gf=6402,Gc=34041,Hf=35904,mc=35906,xf=36193,$l=33776,ou=33777,Wf=33778,Xf=33779,jh=35986,gc=35987,$u=34798,Fl=35840,Hc=35841,Kl=35842,Yf=35843,qf=36196,yc=5121,Gh=5123,fh=5125,Wc=5126,Vp=10242,hh=10243,Hh=10497,bf=33071,jp=33648,Xc=10240,Ao=10241,Us=9728,Yc=9729,ka=9984,Aa=9985,wo=9986,pu=9987,Ef=33170,Ql=4352,ph=4353,Qa=4354,Cf=34046,Dl=3317,_c=37440,Jl=37441,ds=37443,Ku=37444,Sf=33984,Vo=[ka,wo,Aa,pu],ti=[0,mo,$s,_l,qu],Xo={};Xo[mo]=Xo[Zh]=Xo[Gf]=1,Xo[Gc]=Xo[$s]=2,Xo[_l]=Xo[Hf]=3,Xo[qu]=Xo[mc]=4;function qc(H){return"[object "+H+"]"}var Af=qc("HTMLCanvasElement"),Ja=qc("OffscreenCanvas"),Bu=qc("CanvasRenderingContext2D"),xc=qc("ImageBitmap"),Mn=qc("HTMLImageElement"),wf=qc("HTMLVideoElement"),dh=Object.keys(Fa).concat([Af,Ja,Bu,xc,Mn,wf]),bl=[];bl[yc]=1,bl[Wc]=4,bl[xf]=2,bl[Gh]=2,bl[fh]=4;var ho=[];ho[Vh]=2,ho[xl]=2,ho[vp]=2,ho[Gc]=4,ho[$l]=.5,ho[ou]=.5,ho[Wf]=1,ho[Xf]=1,ho[jh]=.5,ho[gc]=1,ho[$u]=1,ho[Fl]=.5,ho[Hc]=.25,ho[Kl]=.5,ho[Yf]=.25,ho[qf]=.5;function du(H){return Array.isArray(H)&&(H.length===0||typeof H[0]=="number")}function Va(H){if(!Array.isArray(H))return!1;var Le=H.length;return!(Le===0||!Wo(H[0]))}function Bl(H){return Object.prototype.toString.call(H)}function wu(H){return Bl(H)===Af}function Nl(H){return Bl(H)===Ja}function $f(H){return Bl(H)===Bu}function $c(H){return Bl(H)===xc}function gp(H){return Bl(H)===Mn}function yi(H){return Bl(H)===wf}function ll(H){var Le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Le&&H&&H.getContext)}function Ks(H){var Le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Le&&H&&"src"in H&&"crossOrigin"in H)}function ha(H){if(!H)return!1;if(ll(H)||Ks(H))return!0;var Le=Bl(H);return dh.indexOf(Le)>=0?!0:du(H)||Va(H)||ns(H)}function cl(H){return Fa[Object.prototype.toString.call(H)]|0}function vu(H,Le){var at=Le.length;switch(H.type){case yc:case Gh:case fh:case Wc:var fr=Jt.allocType(H.type,at);fr.set(Le),H.data=fr;break;case xf:H.data=gl(Le);break;default:j.raise("unsupported texture type, must specify a typed array")}}function Zs(H,Le){return Jt.allocType(H.type===xf?Wc:H.type,Le)}function Tf(H,Le){H.type===xf?(H.data=gl(Le),Jt.freeType(Le)):H.data=Le}function bc(H,Le,at,fr,Nr,ur){for(var Tr=H.width,Vr=H.height,qr=H.channels,rn=Tr*Vr*qr,pn=Zs(H,rn),dn=0,An=0;An<Vr;++An)for(var en=0;en<Tr;++en)for(var fn=0;fn<qr;++fn)pn[dn++]=Le[at*en+fr*An+Nr*fn+ur];Tf(H,pn)}function Tu(H,Le,at,fr,Nr,ur){var Tr;if(typeof ho[H]!="undefined"?Tr=ho[H]:Tr=Xo[H]*bl[Le],ur&&(Tr*=6),Nr){for(var Vr=0,qr=at;qr>=1;)Vr+=Tr*qr*qr,qr/=2;return Vr}else return Tr*at*fr}function mu(H,Le,at,fr,Nr,ur,Tr){var Vr={"don't care":Ql,"dont care":Ql,nice:Qa,fast:ph},qr={repeat:Hh,clamp:bf,mirror:jp},rn={nearest:Us,linear:Yc},pn=y({mipmap:pu,"nearest mipmap nearest":ka,"linear mipmap nearest":Aa,"nearest mipmap linear":wo,"linear mipmap linear":pu},rn),dn={none:0,browser:Ku},An={uint8:yc,rgba4:mp,rgb565:jf,"rgb5 a1":ch},en={alpha:Zh,luminance:mo,"luminance alpha":$s,rgb:_l,rgba:qu,rgba4:Vh,"rgb5 a1":xl,rgb565:vp},fn={};Le.ext_srgb&&(en.srgb=Hf,en.srgba=mc),Le.oes_texture_float&&(An.float32=An.float=Wc),Le.oes_texture_half_float&&(An.float16=An["half float"]=xf),Le.webgl_depth_texture&&(y(en,{depth:Gf,"depth stencil":Gc}),y(An,{uint16:Gh,uint32:fh,"depth stencil":_f})),Le.webgl_compressed_texture_s3tc&&y(fn,{"rgb s3tc dxt1":$l,"rgba s3tc dxt1":ou,"rgba s3tc dxt3":Wf,"rgba s3tc dxt5":Xf}),Le.webgl_compressed_texture_atc&&y(fn,{"rgb atc":jh,"rgba atc explicit alpha":gc,"rgba atc interpolated alpha":$u}),Le.webgl_compressed_texture_pvrtc&&y(fn,{"rgb pvrtc 4bppv1":Fl,"rgb pvrtc 2bppv1":Hc,"rgba pvrtc 4bppv1":Kl,"rgba pvrtc 2bppv1":Yf}),Le.webgl_compressed_texture_etc1&&(fn["rgb etc1"]=qf);var Ft=Array.prototype.slice.call(H.getParameter(Uh)||new Uint32Array(0));Object.keys(fn).forEach(function(Ye){var pr=fn[Ye];Ft.indexOf(pr)>=0&&(en[Ye]=pr)});var mr=Object.keys(en);at.textureFormats=mr;var nn=[];Object.keys(en).forEach(function(Ye){var pr=en[Ye];nn[pr]=Ye});var kn=[];Object.keys(An).forEach(function(Ye){var pr=An[Ye];kn[pr]=Ye});var zr=[];Object.keys(rn).forEach(function(Ye){var pr=rn[Ye];zr[pr]=Ye});var _n=[];Object.keys(pn).forEach(function(Ye){var pr=pn[Ye];_n[pr]=Ye});var On=[];Object.keys(qr).forEach(function(Ye){var pr=qr[Ye];On[pr]=Ye});var Ti=mr.reduce(function(Ye,pr){var Vt=en[pr];return Vt===mo||Vt===Zh||Vt===mo||Vt===$s||Vt===Gf||Vt===Gc||Le.ext_srgb&&(Vt===Hf||Vt===mc)?Ye[Vt]=Vt:Vt===xl||pr.indexOf("rgba")>=0?Ye[Vt]=qu:Ye[Vt]=_l,Ye},{});function Mr(){this.internalformat=qu,this.format=qu,this.type=yc,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ku,this.width=0,this.height=0,this.channels=0}function Lr(Ye,pr){Ye.internalformat=pr.internalformat,Ye.format=pr.format,Ye.type=pr.type,Ye.compressed=pr.compressed,Ye.premultiplyAlpha=pr.premultiplyAlpha,Ye.flipY=pr.flipY,Ye.unpackAlignment=pr.unpackAlignment,Ye.colorSpace=pr.colorSpace,Ye.width=pr.width,Ye.height=pr.height,Ye.channels=pr.channels}function si(Ye,pr){if(!(typeof pr!="object"||!pr)){if("premultiplyAlpha"in pr&&(j.type(pr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ye.premultiplyAlpha=pr.premultiplyAlpha),"flipY"in pr&&(j.type(pr.flipY,"boolean","invalid texture flip"),Ye.flipY=pr.flipY),"alignment"in pr&&(j.oneOf(pr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ye.unpackAlignment=pr.alignment),"colorSpace"in pr&&(j.parameter(pr.colorSpace,dn,"invalid colorSpace"),Ye.colorSpace=dn[pr.colorSpace]),"type"in pr){var Vt=pr.type;j(Le.oes_texture_float||!(Vt==="float"||Vt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),j(Le.oes_texture_half_float||!(Vt==="half float"||Vt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),j(Le.webgl_depth_texture||!(Vt==="uint16"||Vt==="uint32"||Vt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),j.parameter(Vt,An,"invalid texture type"),Ye.type=An[Vt]}var qn=Ye.width,Ta=Ye.height,Ve=Ye.channels,Ce=!1;"shape"in pr?(j(Array.isArray(pr.shape)&&pr.shape.length>=2,"shape must be an array"),qn=pr.shape[0],Ta=pr.shape[1],pr.shape.length===3&&(Ve=pr.shape[2],j(Ve>0&&Ve<=4,"invalid number of channels"),Ce=!0),j(qn>=0&&qn<=at.maxTextureSize,"invalid width"),j(Ta>=0&&Ta<=at.maxTextureSize,"invalid height")):("radius"in pr&&(qn=Ta=pr.radius,j(qn>=0&&qn<=at.maxTextureSize,"invalid radius")),"width"in pr&&(qn=pr.width,j(qn>=0&&qn<=at.maxTextureSize,"invalid width")),"height"in pr&&(Ta=pr.height,j(Ta>=0&&Ta<=at.maxTextureSize,"invalid height")),"channels"in pr&&(Ve=pr.channels,j(Ve>0&&Ve<=4,"invalid number of channels"),Ce=!0)),Ye.width=qn|0,Ye.height=Ta|0,Ye.channels=Ve|0;var ht=!1;if("format"in pr){var Bt=pr.format;j(Le.webgl_depth_texture||!(Bt==="depth"||Bt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),j.parameter(Bt,en,"invalid texture format");var ar=Ye.internalformat=en[Bt];Ye.format=Ti[ar],Bt in An&&("type"in pr||(Ye.type=An[Bt])),Bt in fn&&(Ye.compressed=!0),ht=!0}!Ce&&ht?Ye.channels=Xo[Ye.format]:Ce&&!ht?Ye.channels!==ti[Ye.format]&&(Ye.format=Ye.internalformat=ti[Ye.channels]):ht&&Ce&&j(Ye.channels===Xo[Ye.format],"number of channels inconsistent with specified format")}}function Ln(Ye){H.pixelStorei(_c,Ye.flipY),H.pixelStorei(Jl,Ye.premultiplyAlpha),H.pixelStorei(ds,Ye.colorSpace),H.pixelStorei(Dl,Ye.unpackAlignment)}function tn(){Mr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Bn(Ye,pr){var Vt=null;if(ha(pr)?Vt=pr:pr&&(j.type(pr,"object","invalid pixel data type"),si(Ye,pr),"x"in pr&&(Ye.xOffset=pr.x|0),"y"in pr&&(Ye.yOffset=pr.y|0),ha(pr.data)&&(Vt=pr.data)),j(!Ye.compressed||Vt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),pr.copy){j(!Vt,"can not specify copy and data field for the same texture");var qn=Nr.viewportWidth,Ta=Nr.viewportHeight;Ye.width=Ye.width||qn-Ye.xOffset,Ye.height=Ye.height||Ta-Ye.yOffset,Ye.needsCopy=!0,j(Ye.xOffset>=0&&Ye.xOffset<qn&&Ye.yOffset>=0&&Ye.yOffset<Ta&&Ye.width>0&&Ye.width<=qn&&Ye.height>0&&Ye.height<=Ta,"copy texture read out of bounds")}else if(!Vt)Ye.width=Ye.width||1,Ye.height=Ye.height||1,Ye.channels=Ye.channels||4;else if(de(Vt))Ye.channels=Ye.channels||4,Ye.data=Vt,!("type"in pr)&&Ye.type===yc&&(Ye.type=cl(Vt));else if(du(Vt))Ye.channels=Ye.channels||4,vu(Ye,Vt),Ye.alignment=1,Ye.needsFree=!0;else if(ns(Vt)){var Ve=Vt.data;!Array.isArray(Ve)&&Ye.type===yc&&(Ye.type=cl(Ve));var Ce=Vt.shape,ht=Vt.stride,Bt,ar,gt,he,Tt,Fe;Ce.length===3?(gt=Ce[2],Fe=ht[2]):(j(Ce.length===2,"invalid ndarray pixel data, must be 2 or 3D"),gt=1,Fe=1),Bt=Ce[0],ar=Ce[1],he=ht[0],Tt=ht[1],Ye.alignment=1,Ye.width=Bt,Ye.height=ar,Ye.channels=gt,Ye.format=Ye.internalformat=ti[gt],Ye.needsFree=!0,bc(Ye,Ve,he,Tt,Fe,Vt.offset)}else if(ll(Vt)||wu(Vt)||Nl(Vt)||$f(Vt))ll(Vt)||wu(Vt)||Nl(Vt)?Ye.element=Vt:Ye.element=Vt.canvas,Ye.width=Ye.element.width,Ye.height=Ye.element.height,Ye.channels=4;else if($c(Vt))Ye.element=Vt,Ye.width=Vt.width,Ye.height=Vt.height,Ye.channels=4;else if(gp(Vt))Ye.element=Vt,Ye.width=Vt.naturalWidth,Ye.height=Vt.naturalHeight,Ye.channels=4;else if(Ks(Vt))Ye.element=Vt,Ye.width=Vt.width,Ye.height=Vt.height,Ye.channels=4;else if(yi(Vt))Ye.element=Vt,Ye.width=Vt.videoWidth,Ye.height=Vt.videoHeight,Ye.channels=4;else if(Va(Vt)){var ct=Ye.width||Vt[0].length,Ge=Ye.height||Vt.length,Nt=Ye.channels;Wo(Vt[0][0])?Nt=Nt||Vt[0][0].length:Nt=Nt||1;for(var qt=Be.shape(Vt),Ur=1,Pn=0;Pn<qt.length;++Pn)Ur*=qt[Pn];var In=Zs(Ye,Ur);Be.flatten(Vt,qt,"",In),Tf(Ye,In),Ye.alignment=1,Ye.width=ct,Ye.height=Ge,Ye.channels=Nt,Ye.format=Ye.internalformat=ti[Nt],Ye.needsFree=!0}Ye.type===Wc?j(at.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ye.type===xf&&j(at.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Un(Ye,pr,Vt){var qn=Ye.element,Ta=Ye.data,Ve=Ye.internalformat,Ce=Ye.format,ht=Ye.type,Bt=Ye.width,ar=Ye.height;Ln(Ye),qn?H.texImage2D(pr,Vt,Ce,Ce,ht,qn):Ye.compressed?H.compressedTexImage2D(pr,Vt,Ve,Bt,ar,0,Ta):Ye.needsCopy?(fr(),H.copyTexImage2D(pr,Vt,Ce,Ye.xOffset,Ye.yOffset,Bt,ar,0)):H.texImage2D(pr,Vt,Ce,Bt,ar,0,Ce,ht,Ta||null)}function ca(Ye,pr,Vt,qn,Ta){var Ve=Ye.element,Ce=Ye.data,ht=Ye.internalformat,Bt=Ye.format,ar=Ye.type,gt=Ye.width,he=Ye.height;Ln(Ye),Ve?H.texSubImage2D(pr,Ta,Vt,qn,Bt,ar,Ve):Ye.compressed?H.compressedTexSubImage2D(pr,Ta,Vt,qn,ht,gt,he,Ce):Ye.needsCopy?(fr(),H.copyTexSubImage2D(pr,Ta,Vt,qn,Ye.xOffset,Ye.yOffset,gt,he)):H.texSubImage2D(pr,Ta,Vt,qn,gt,he,Bt,ar,Ce)}var Hi=[];function Jr(){return Hi.pop()||new tn}function on(Ye){Ye.needsFree&&Jt.freeType(Ye.data),tn.call(Ye),Hi.push(Ye)}function Ii(){Mr.call(this),this.genMipmaps=!1,this.mipmapHint=Ql,this.mipmask=0,this.images=Array(16)}function ta(Ye,pr,Vt){var qn=Ye.images[0]=Jr();Ye.mipmask=1,qn.width=Ye.width=pr,qn.height=Ye.height=Vt,qn.channels=Ye.channels=4}function da(Ye,pr){var Vt=null;if(ha(pr))Vt=Ye.images[0]=Jr(),Lr(Vt,Ye),Bn(Vt,pr),Ye.mipmask=1;else if(si(Ye,pr),Array.isArray(pr.mipmap))for(var qn=pr.mipmap,Ta=0;Ta<qn.length;++Ta)Vt=Ye.images[Ta]=Jr(),Lr(Vt,Ye),Vt.width>>=Ta,Vt.height>>=Ta,Bn(Vt,qn[Ta]),Ye.mipmask|=1<<Ta;else Vt=Ye.images[0]=Jr(),Lr(Vt,Ye),Bn(Vt,pr),Ye.mipmask=1;Lr(Ye,Ye.images[0]),Ye.compressed&&(Ye.internalformat===$l||Ye.internalformat===ou||Ye.internalformat===Wf||Ye.internalformat===Xf)&&j(Ye.width%4==0&&Ye.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ss(Ye,pr){for(var Vt=Ye.images,qn=0;qn<Vt.length;++qn){if(!Vt[qn])return;Un(Vt[qn],pr,qn)}}var ms=[];function Pa(){var Ye=ms.pop()||new Ii;Mr.call(Ye),Ye.mipmask=0;for(var pr=0;pr<16;++pr)Ye.images[pr]=null;return Ye}function yu(Ye){for(var pr=Ye.images,Vt=0;Vt<pr.length;++Vt)pr[Vt]&&on(pr[Vt]),pr[Vt]=null;ms.push(Ye)}function Mo(){this.minFilter=Us,this.magFilter=Us,this.wrapS=bf,this.wrapT=bf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ql}function Io(Ye,pr){if("min"in pr){var Vt=pr.min;j.parameter(Vt,pn),Ye.minFilter=pn[Vt],Vo.indexOf(Ye.minFilter)>=0&&!("faces"in pr)&&(Ye.genMipmaps=!0)}if("mag"in pr){var qn=pr.mag;j.parameter(qn,rn),Ye.magFilter=rn[qn]}var Ta=Ye.wrapS,Ve=Ye.wrapT;if("wrap"in pr){var Ce=pr.wrap;typeof Ce=="string"?(j.parameter(Ce,qr),Ta=Ve=qr[Ce]):Array.isArray(Ce)&&(j.parameter(Ce[0],qr),j.parameter(Ce[1],qr),Ta=qr[Ce[0]],Ve=qr[Ce[1]])}else{if("wrapS"in pr){var ht=pr.wrapS;j.parameter(ht,qr),Ta=qr[ht]}if("wrapT"in pr){var Bt=pr.wrapT;j.parameter(Bt,qr),Ve=qr[Bt]}}if(Ye.wrapS=Ta,Ye.wrapT=Ve,"anisotropic"in pr){var ar=pr.anisotropic;j(typeof ar=="number"&&ar>=1&&ar<=at.maxAnisotropic,"aniso samples must be between 1 and "),Ye.anisotropic=pr.anisotropic}if("mipmap"in pr){var gt=!1;switch(typeof pr.mipmap){case"string":j.parameter(pr.mipmap,Vr,"invalid mipmap hint"),Ye.mipmapHint=Vr[pr.mipmap],Ye.genMipmaps=!0,gt=!0;break;case"boolean":gt=Ye.genMipmaps=pr.mipmap;break;case"object":j(Array.isArray(pr.mipmap),"invalid mipmap type"),Ye.genMipmaps=!1,gt=!0;break;default:j.raise("invalid mipmap type")}gt&&!("min"in pr)&&(Ye.minFilter=ka)}}function Ps(Ye,pr){H.texParameteri(pr,Ao,Ye.minFilter),H.texParameteri(pr,Xc,Ye.magFilter),H.texParameteri(pr,Vp,Ye.wrapS),H.texParameteri(pr,hh,Ye.wrapT),Le.ext_texture_filter_anisotropic&&H.texParameteri(pr,Cf,Ye.anisotropic),Ye.genMipmaps&&(H.hint(Ef,Ye.mipmapHint),H.generateMipmap(pr))}var uu=0,tu={},Es=at.maxTextureUnits,Qo=Array(Es).map(function(){return null});function ia(Ye){Mr.call(this),this.mipmask=0,this.internalformat=qu,this.id=uu++,this.refCount=1,this.target=Ye,this.texture=H.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Mo,Tr.profile&&(this.stats={size:0})}function Cs(Ye){H.activeTexture(Sf),H.bindTexture(Ye.target,Ye.texture)}function Na(){var Ye=Qo[0];Ye?H.bindTexture(Ye.target,Ye.texture):H.bindTexture(Au,null)}function Rs(Ye){var pr=Ye.texture;j(pr,"must not double destroy texture");var Vt=Ye.unit,qn=Ye.target;Vt>=0&&(H.activeTexture(Sf+Vt),H.bindTexture(qn,null),Qo[Vt]=null),H.deleteTexture(pr),Ye.texture=null,Ye.params=null,Ye.pixels=null,Ye.refCount=0,delete tu[Ye.id],ur.textureCount--}y(ia.prototype,{bind:function(){var Ye=this;Ye.bindCount+=1;var pr=Ye.unit;if(pr<0){for(var Vt=0;Vt<Es;++Vt){var qn=Qo[Vt];if(qn){if(qn.bindCount>0)continue;qn.unit=-1}Qo[Vt]=Ye,pr=Vt;break}pr>=Es&&j.raise("insufficient number of texture units"),Tr.profile&&ur.maxTextureUnits<pr+1&&(ur.maxTextureUnits=pr+1),Ye.unit=pr,H.activeTexture(Sf+pr),H.bindTexture(Ye.target,Ye.texture)}return pr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Rs(this)}});function Zi(Ye,pr){var Vt=new ia(Au);tu[Vt.id]=Vt,ur.textureCount++;function qn(Ce,ht){var Bt=Vt.texInfo;Mo.call(Bt);var ar=Pa();return typeof Ce=="number"?typeof ht=="number"?ta(ar,Ce|0,ht|0):ta(ar,Ce|0,Ce|0):Ce?(j.type(Ce,"object","invalid arguments to regl.texture"),Io(Bt,Ce),da(ar,Ce)):ta(ar,1,1),Bt.genMipmaps&&(ar.mipmask=(ar.width<<1)-1),Vt.mipmask=ar.mipmask,Lr(Vt,ar),j.texture2D(Bt,ar,at),Vt.internalformat=ar.internalformat,qn.width=ar.width,qn.height=ar.height,Cs(Vt),ss(ar,Au),Ps(Bt,Au),Na(),yu(ar),Tr.profile&&(Vt.stats.size=Tu(Vt.internalformat,Vt.type,ar.width,ar.height,Bt.genMipmaps,!1)),qn.format=nn[Vt.internalformat],qn.type=kn[Vt.type],qn.mag=zr[Bt.magFilter],qn.min=_n[Bt.minFilter],qn.wrapS=On[Bt.wrapS],qn.wrapT=On[Bt.wrapT],qn}function Ta(Ce,ht,Bt,ar){j(!!Ce,"must specify image data");var gt=ht|0,he=Bt|0,Tt=ar|0,Fe=Jr();return Lr(Fe,Vt),Fe.width=0,Fe.height=0,Bn(Fe,Ce),Fe.width=Fe.width||(Vt.width>>Tt)-gt,Fe.height=Fe.height||(Vt.height>>Tt)-he,j(Vt.type===Fe.type&&Vt.format===Fe.format&&Vt.internalformat===Fe.internalformat,"incompatible format for texture.subimage"),j(gt>=0&&he>=0&&gt+Fe.width<=Vt.width&&he+Fe.height<=Vt.height,"texture.subimage write out of bounds"),j(Vt.mipmask&1<<Tt,"missing mipmap data"),j(Fe.data||Fe.element||Fe.needsCopy,"missing image data"),Cs(Vt),ca(Fe,Au,gt,he,Tt),Na(),on(Fe),qn}function Ve(Ce,ht){var Bt=Ce|0,ar=ht|0||Bt;if(Bt===Vt.width&&ar===Vt.height)return qn;qn.width=Vt.width=Bt,qn.height=Vt.height=ar,Cs(Vt);for(var gt=0;Vt.mipmask>>gt;++gt){var he=Bt>>gt,Tt=ar>>gt;if(!he||!Tt)break;H.texImage2D(Au,gt,Vt.format,he,Tt,0,Vt.format,Vt.type,null)}return Na(),Tr.profile&&(Vt.stats.size=Tu(Vt.internalformat,Vt.type,Bt,ar,!1,!1)),qn}return qn(Ye,pr),qn.subimage=Ta,qn.resize=Ve,qn._reglType="texture2d",qn._texture=Vt,Tr.profile&&(qn.stats=Vt.stats),qn.destroy=function(){Vt.decRef()},qn}function Ca(Ye,pr,Vt,qn,Ta,Ve){var Ce=new ia(yf);tu[Ce.id]=Ce,ur.cubeCount++;var ht=new Array(6);function Bt(he,Tt,Fe,ct,Ge,Nt){var qt,Ur=Ce.texInfo;for(Mo.call(Ur),qt=0;qt<6;++qt)ht[qt]=Pa();if(typeof he=="number"||!he){var Pn=he|0||1;for(qt=0;qt<6;++qt)ta(ht[qt],Pn,Pn)}else if(typeof he=="object")if(Tt)da(ht[0],he),da(ht[1],Tt),da(ht[2],Fe),da(ht[3],ct),da(ht[4],Ge),da(ht[5],Nt);else if(Io(Ur,he),si(Ce,he),"faces"in he){var In=he.faces;for(j(Array.isArray(In)&&In.length===6,"cube faces must be a length 6 array"),qt=0;qt<6;++qt)j(typeof In[qt]=="object"&&!!In[qt],"invalid input for cube map face"),Lr(ht[qt],Ce),da(ht[qt],In[qt])}else for(qt=0;qt<6;++qt)da(ht[qt],he);else j.raise("invalid arguments to cube map");for(Lr(Ce,ht[0]),j.optional(function(){at.npotTextureCube||j(dp(Ce.width)&&dp(Ce.height),"your browser does not support non power or two texture dimensions")}),Ur.genMipmaps?Ce.mipmask=(ht[0].width<<1)-1:Ce.mipmask=ht[0].mipmask,j.textureCube(Ce,Ur,ht,at),Ce.internalformat=ht[0].internalformat,Bt.width=ht[0].width,Bt.height=ht[0].height,Cs(Ce),qt=0;qt<6;++qt)ss(ht[qt],yl+qt);for(Ps(Ur,yf),Na(),Tr.profile&&(Ce.stats.size=Tu(Ce.internalformat,Ce.type,Bt.width,Bt.height,Ur.genMipmaps,!0)),Bt.format=nn[Ce.internalformat],Bt.type=kn[Ce.type],Bt.mag=zr[Ur.magFilter],Bt.min=_n[Ur.minFilter],Bt.wrapS=On[Ur.wrapS],Bt.wrapT=On[Ur.wrapT],qt=0;qt<6;++qt)yu(ht[qt]);return Bt}function ar(he,Tt,Fe,ct,Ge){j(!!Tt,"must specify image data"),j(typeof he=="number"&&he===(he|0)&&he>=0&&he<6,"invalid face");var Nt=Fe|0,qt=ct|0,Ur=Ge|0,Pn=Jr();return Lr(Pn,Ce),Pn.width=0,Pn.height=0,Bn(Pn,Tt),Pn.width=Pn.width||(Ce.width>>Ur)-Nt,Pn.height=Pn.height||(Ce.height>>Ur)-qt,j(Ce.type===Pn.type&&Ce.format===Pn.format&&Ce.internalformat===Pn.internalformat,"incompatible format for texture.subimage"),j(Nt>=0&&qt>=0&&Nt+Pn.width<=Ce.width&&qt+Pn.height<=Ce.height,"texture.subimage write out of bounds"),j(Ce.mipmask&1<<Ur,"missing mipmap data"),j(Pn.data||Pn.element||Pn.needsCopy,"missing image data"),Cs(Ce),ca(Pn,yl+he,Nt,qt,Ur),Na(),on(Pn),Bt}function gt(he){var Tt=he|0;if(Tt!==Ce.width){Bt.width=Ce.width=Tt,Bt.height=Ce.height=Tt,Cs(Ce);for(var Fe=0;Fe<6;++Fe)for(var ct=0;Ce.mipmask>>ct;++ct)H.texImage2D(yl+Fe,ct,Ce.format,Tt>>ct,Tt>>ct,0,Ce.format,Ce.type,null);return Na(),Tr.profile&&(Ce.stats.size=Tu(Ce.internalformat,Ce.type,Bt.width,Bt.height,!1,!0)),Bt}}return Bt(Ye,pr,Vt,qn,Ta,Ve),Bt.subimage=ar,Bt.resize=gt,Bt._reglType="textureCube",Bt._texture=Ce,Tr.profile&&(Bt.stats=Ce.stats),Bt.destroy=function(){Ce.decRef()},Bt}function eo(){for(var Ye=0;Ye<Es;++Ye)H.activeTexture(Sf+Ye),H.bindTexture(Au,null),Qo[Ye]=null;ve(tu).forEach(Rs),ur.cubeCount=0,ur.textureCount=0}Tr.profile&&(ur.getTotalTextureSize=function(){var Ye=0;return Object.keys(tu).forEach(function(pr){Ye+=tu[pr].stats.size}),Ye});function us(){for(var Ye=0;Ye<Es;++Ye){var pr=Qo[Ye];pr&&(pr.bindCount=0,pr.unit=-1,Qo[Ye]=null)}ve(tu).forEach(function(Vt){Vt.texture=H.createTexture(),H.bindTexture(Vt.target,Vt.texture);for(var qn=0;qn<32;++qn)if((Vt.mipmask&1<<qn)!=0)if(Vt.target===Au)H.texImage2D(Au,qn,Vt.internalformat,Vt.width>>qn,Vt.height>>qn,0,Vt.internalformat,Vt.type,null);else for(var Ta=0;Ta<6;++Ta)H.texImage2D(yl+Ta,qn,Vt.internalformat,Vt.width>>qn,Vt.height>>qn,0,Vt.internalformat,Vt.type,null);Ps(Vt.texInfo,Vt.target)})}function Fc(){for(var Ye=0;Ye<Es;++Ye){var pr=Qo[Ye];pr&&(pr.bindCount=0,pr.unit=-1,Qo[Ye]=null),H.activeTexture(Sf+Ye),H.bindTexture(Au,null),H.bindTexture(yf,null)}}return{create2D:Zi,createCube:Ca,clear:eo,getTexture:function(Ye){return null},restore:us,refresh:Fc}}var Qu=36161,bi=32854,pi=32855,Kf=36194,Vs=33189,fl=36168,es=34041,El=35907,vh=34836,Mf=34842,ja=34843,yo=[];yo[bi]=2,yo[pi]=2,yo[Kf]=2,yo[Vs]=2,yo[fl]=1,yo[es]=4,yo[El]=4,yo[vh]=16,yo[Mf]=8,yo[ja]=6;function mh(H,Le,at){return yo[H]*Le*at}var Qf=function(H,Le,at,fr,Nr){var ur={rgba4:bi,rgb565:Kf,"rgb5 a1":pi,depth:Vs,stencil:fl,"depth stencil":es};Le.ext_srgb&&(ur.srgba=El),Le.ext_color_buffer_half_float&&(ur.rgba16f=Mf,ur.rgb16f=ja),Le.webgl_color_buffer_float&&(ur.rgba32f=vh);var Tr=[];Object.keys(ur).forEach(function(en){var fn=ur[en];Tr[fn]=en});var Vr=0,qr={};function rn(en){this.id=Vr++,this.refCount=1,this.renderbuffer=en,this.format=bi,this.width=0,this.height=0,Nr.profile&&(this.stats={size:0})}rn.prototype.decRef=function(){--this.refCount<=0&&pn(this)};function pn(en){var fn=en.renderbuffer;j(fn,"must not double destroy renderbuffer"),H.bindRenderbuffer(Qu,null),H.deleteRenderbuffer(fn),en.renderbuffer=null,en.refCount=0,delete qr[en.id],fr.renderbufferCount--}function dn(en,fn){var Ft=new rn(H.createRenderbuffer());qr[Ft.id]=Ft,fr.renderbufferCount++;function mr(kn,zr){var _n=0,On=0,Ti=bi;if(typeof kn=="object"&&kn){var Mr=kn;if("shape"in Mr){var Lr=Mr.shape;j(Array.isArray(Lr)&&Lr.length>=2,"invalid renderbuffer shape"),_n=Lr[0]|0,On=Lr[1]|0}else"radius"in Mr&&(_n=On=Mr.radius|0),"width"in Mr&&(_n=Mr.width|0),"height"in Mr&&(On=Mr.height|0);"format"in Mr&&(j.parameter(Mr.format,ur,"invalid renderbuffer format"),Ti=ur[Mr.format])}else typeof kn=="number"?(_n=kn|0,typeof zr=="number"?On=zr|0:On=_n):kn?j.raise("invalid arguments to renderbuffer constructor"):_n=On=1;if(j(_n>0&&On>0&&_n<=at.maxRenderbufferSize&&On<=at.maxRenderbufferSize,"invalid renderbuffer size"),!(_n===Ft.width&&On===Ft.height&&Ti===Ft.format))return mr.width=Ft.width=_n,mr.height=Ft.height=On,Ft.format=Ti,H.bindRenderbuffer(Qu,Ft.renderbuffer),H.renderbufferStorage(Qu,Ti,_n,On),j(H.getError()===0,"invalid render buffer format"),Nr.profile&&(Ft.stats.size=mh(Ft.format,Ft.width,Ft.height)),mr.format=Tr[Ft.format],mr}function nn(kn,zr){var _n=kn|0,On=zr|0||_n;return _n===Ft.width&&On===Ft.height||(j(_n>0&&On>0&&_n<=at.maxRenderbufferSize&&On<=at.maxRenderbufferSize,"invalid renderbuffer size"),mr.width=Ft.width=_n,mr.height=Ft.height=On,H.bindRenderbuffer(Qu,Ft.renderbuffer),H.renderbufferStorage(Qu,Ft.format,_n,On),j(H.getError()===0,"invalid render buffer format"),Nr.profile&&(Ft.stats.size=mh(Ft.format,Ft.width,Ft.height))),mr}return mr(en,fn),mr.resize=nn,mr._reglType="renderbuffer",mr._renderbuffer=Ft,Nr.profile&&(mr.stats=Ft.stats),mr.destroy=function(){Ft.decRef()},mr}Nr.profile&&(fr.getTotalRenderbufferSize=function(){var en=0;return Object.keys(qr).forEach(function(fn){en+=qr[fn].stats.size}),en});function An(){ve(qr).forEach(function(en){en.renderbuffer=H.createRenderbuffer(),H.bindRenderbuffer(Qu,en.renderbuffer),H.renderbufferStorage(Qu,en.format,en.width,en.height)}),H.bindRenderbuffer(Qu,null)}return{create:dn,clear:function(){ve(qr).forEach(pn)},restore:An}},hl=36160,Ju=36161,Qs=3553,pl=34069,zl=36064,gh=36096,Yo=36128,yh=33306,Wh=36053,If=36054,Kc=36055,Xh=36057,dl=36061,Cl=36193,Qc=5121,ec=5126,el=6407,kf=6408,Pf=6402,Gp=[el,kf],Jc=[];Jc[kf]=4,Jc[el]=3;var c=[];c[Qc]=1,c[ec]=4,c[Cl]=2;var h=32854,f=32855,m=36194,S=33189,I=36168,R=34041,z=35907,W=34836,te=34842,be=34843,Se=[h,f,m,z,te,be,W],Ie={};Ie[Wh]="complete",Ie[If]="incomplete attachment",Ie[Xh]="incomplete dimensions",Ie[Kc]="incomplete, missing attachment",Ie[dl]="unsupported";function Je(H,Le,at,fr,Nr,ur){var Tr={cur:null,next:null,dirty:!1,setFBO:null},Vr=["rgba"],qr=["rgba4","rgb565","rgb5 a1"];Le.ext_srgb&&qr.push("srgba"),Le.ext_color_buffer_half_float&&qr.push("rgba16f","rgb16f"),Le.webgl_color_buffer_float&&qr.push("rgba32f");var rn=["uint8"];Le.oes_texture_half_float&&rn.push("half float","float16"),Le.oes_texture_float&&rn.push("float","float32");function pn(tn,Bn,Un){this.target=tn,this.texture=Bn,this.renderbuffer=Un;var ca=0,Hi=0;Bn?(ca=Bn.width,Hi=Bn.height):Un&&(ca=Un.width,Hi=Un.height),this.width=ca,this.height=Hi}function dn(tn){tn&&(tn.texture&&tn.texture._texture.decRef(),tn.renderbuffer&&tn.renderbuffer._renderbuffer.decRef())}function An(tn,Bn,Un){if(!!tn)if(tn.texture){var ca=tn.texture._texture,Hi=Math.max(1,ca.width),Jr=Math.max(1,ca.height);j(Hi===Bn&&Jr===Un,"inconsistent width/height for supplied texture"),ca.refCount+=1}else{var on=tn.renderbuffer._renderbuffer;j(on.width===Bn&&on.height===Un,"inconsistent width/height for renderbuffer"),on.refCount+=1}}function en(tn,Bn){Bn&&(Bn.texture?H.framebufferTexture2D(hl,tn,Bn.target,Bn.texture._texture.texture,0):H.framebufferRenderbuffer(hl,tn,Ju,Bn.renderbuffer._renderbuffer.renderbuffer))}function fn(tn){var Bn=Qs,Un=null,ca=null,Hi=tn;typeof tn=="object"&&(Hi=tn.data,"target"in tn&&(Bn=tn.target|0)),j.type(Hi,"function","invalid attachment data");var Jr=Hi._reglType;return Jr==="texture2d"?(Un=Hi,j(Bn===Qs)):Jr==="textureCube"?(Un=Hi,j(Bn>=pl&&Bn<pl+6,"invalid cube map target")):Jr==="renderbuffer"?(ca=Hi,Bn=Ju):j.raise("invalid regl object for attachment"),new pn(Bn,Un,ca)}function Ft(tn,Bn,Un,ca,Hi){if(Un){var Jr=fr.create2D({width:tn,height:Bn,format:ca,type:Hi});return Jr._texture.refCount=0,new pn(Qs,Jr,null)}else{var on=Nr.create({width:tn,height:Bn,format:ca});return on._renderbuffer.refCount=0,new pn(Ju,null,on)}}function mr(tn){return tn&&(tn.texture||tn.renderbuffer)}function nn(tn,Bn,Un){tn&&(tn.texture?tn.texture.resize(Bn,Un):tn.renderbuffer&&tn.renderbuffer.resize(Bn,Un),tn.width=Bn,tn.height=Un)}var kn=0,zr={};function _n(){this.id=kn++,zr[this.id]=this,this.framebuffer=H.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function On(tn){tn.colorAttachments.forEach(dn),dn(tn.depthAttachment),dn(tn.stencilAttachment),dn(tn.depthStencilAttachment)}function Ti(tn){var Bn=tn.framebuffer;j(Bn,"must not double destroy framebuffer"),H.deleteFramebuffer(Bn),tn.framebuffer=null,ur.framebufferCount--,delete zr[tn.id]}function Mr(tn){var Bn;H.bindFramebuffer(hl,tn.framebuffer);var Un=tn.colorAttachments;for(Bn=0;Bn<Un.length;++Bn)en(zl+Bn,Un[Bn]);for(Bn=Un.length;Bn<at.maxColorAttachments;++Bn)H.framebufferTexture2D(hl,zl+Bn,Qs,null,0);H.framebufferTexture2D(hl,yh,Qs,null,0),H.framebufferTexture2D(hl,gh,Qs,null,0),H.framebufferTexture2D(hl,Yo,Qs,null,0),en(gh,tn.depthAttachment),en(Yo,tn.stencilAttachment),en(yh,tn.depthStencilAttachment);var ca=H.checkFramebufferStatus(hl);!H.isContextLost()&&ca!==Wh&&j.raise("framebuffer configuration not supported, status = "+Ie[ca]),H.bindFramebuffer(hl,Tr.next?Tr.next.framebuffer:null),Tr.cur=Tr.next,H.getError()}function Lr(tn,Bn){var Un=new _n;ur.framebufferCount++;function ca(Jr,on){var Ii;j(Tr.next!==Un,"can not update framebuffer which is currently in use");var ta=0,da=0,ss=!0,ms=!0,Pa=null,yu=!0,Mo="rgba",Io="uint8",Ps=1,uu=null,tu=null,Es=null,Qo=!1;if(typeof Jr=="number")ta=Jr|0,da=on|0||ta;else if(!Jr)ta=da=1;else{j.type(Jr,"object","invalid arguments for framebuffer");var ia=Jr;if("shape"in ia){var Cs=ia.shape;j(Array.isArray(Cs)&&Cs.length>=2,"invalid shape for framebuffer"),ta=Cs[0],da=Cs[1]}else"radius"in ia&&(ta=da=ia.radius),"width"in ia&&(ta=ia.width),"height"in ia&&(da=ia.height);("color"in ia||"colors"in ia)&&(Pa=ia.color||ia.colors,Array.isArray(Pa)&&j(Pa.length===1||Le.webgl_draw_buffers,"multiple render targets not supported")),Pa||("colorCount"in ia&&(Ps=ia.colorCount|0,j(Ps>0,"invalid color buffer count")),"colorTexture"in ia&&(yu=!!ia.colorTexture,Mo="rgba4"),"colorType"in ia&&(Io=ia.colorType,yu?(j(Le.oes_texture_float||!(Io==="float"||Io==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),j(Le.oes_texture_half_float||!(Io==="half float"||Io==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Io==="half float"||Io==="float16"?(j(Le.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Mo="rgba16f"):(Io==="float"||Io==="float32")&&(j(Le.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Mo="rgba32f"),j.oneOf(Io,rn,"invalid color type")),"colorFormat"in ia&&(Mo=ia.colorFormat,Vr.indexOf(Mo)>=0?yu=!0:qr.indexOf(Mo)>=0?yu=!1:j.optional(function(){yu?j.oneOf(ia.colorFormat,Vr,"invalid color format for texture"):j.oneOf(ia.colorFormat,qr,"invalid color format for renderbuffer")}))),("depthTexture"in ia||"depthStencilTexture"in ia)&&(Qo=!!(ia.depthTexture||ia.depthStencilTexture),j(!Qo||Le.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ia&&(typeof ia.depth=="boolean"?ss=ia.depth:(uu=ia.depth,ms=!1)),"stencil"in ia&&(typeof ia.stencil=="boolean"?ms=ia.stencil:(tu=ia.stencil,ss=!1)),"depthStencil"in ia&&(typeof ia.depthStencil=="boolean"?ss=ms=ia.depthStencil:(Es=ia.depthStencil,ss=!1,ms=!1))}var Na=null,Rs=null,Zi=null,Ca=null;if(Array.isArray(Pa))Na=Pa.map(fn);else if(Pa)Na=[fn(Pa)];else for(Na=new Array(Ps),Ii=0;Ii<Ps;++Ii)Na[Ii]=Ft(ta,da,yu,Mo,Io);j(Le.webgl_draw_buffers||Na.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),j(Na.length<=at.maxColorAttachments,"too many color attachments, not supported"),ta=ta||Na[0].width,da=da||Na[0].height,uu?Rs=fn(uu):ss&&!ms&&(Rs=Ft(ta,da,Qo,"depth","uint32")),tu?Zi=fn(tu):ms&&!ss&&(Zi=Ft(ta,da,!1,"stencil","uint8")),Es?Ca=fn(Es):!uu&&!tu&&ms&&ss&&(Ca=Ft(ta,da,Qo,"depth stencil","depth stencil")),j(!!uu+!!tu+!!Es<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var eo=null;for(Ii=0;Ii<Na.length;++Ii)if(An(Na[Ii],ta,da),j(!Na[Ii]||Na[Ii].texture&&Gp.indexOf(Na[Ii].texture._texture.format)>=0||Na[Ii].renderbuffer&&Se.indexOf(Na[Ii].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ii+" is invalid"),Na[Ii]&&Na[Ii].texture){var us=Jc[Na[Ii].texture._texture.format]*c[Na[Ii].texture._texture.type];eo===null?eo=us:j(eo===us,"all color attachments much have the same number of bits per pixel.")}return An(Rs,ta,da),j(!Rs||Rs.texture&&Rs.texture._texture.format===Pf||Rs.renderbuffer&&Rs.renderbuffer._renderbuffer.format===S,"invalid depth attachment for framebuffer object"),An(Zi,ta,da),j(!Zi||Zi.renderbuffer&&Zi.renderbuffer._renderbuffer.format===I,"invalid stencil attachment for framebuffer object"),An(Ca,ta,da),j(!Ca||Ca.texture&&Ca.texture._texture.format===R||Ca.renderbuffer&&Ca.renderbuffer._renderbuffer.format===R,"invalid depth-stencil attachment for framebuffer object"),On(Un),Un.width=ta,Un.height=da,Un.colorAttachments=Na,Un.depthAttachment=Rs,Un.stencilAttachment=Zi,Un.depthStencilAttachment=Ca,ca.color=Na.map(mr),ca.depth=mr(Rs),ca.stencil=mr(Zi),ca.depthStencil=mr(Ca),ca.width=Un.width,ca.height=Un.height,Mr(Un),ca}function Hi(Jr,on){j(Tr.next!==Un,"can not resize a framebuffer which is currently in use");var Ii=Math.max(Jr|0,1),ta=Math.max(on|0||Ii,1);if(Ii===Un.width&&ta===Un.height)return ca;for(var da=Un.colorAttachments,ss=0;ss<da.length;++ss)nn(da[ss],Ii,ta);return nn(Un.depthAttachment,Ii,ta),nn(Un.stencilAttachment,Ii,ta),nn(Un.depthStencilAttachment,Ii,ta),Un.width=ca.width=Ii,Un.height=ca.height=ta,Mr(Un),ca}return ca(tn,Bn),y(ca,{resize:Hi,_reglType:"framebuffer",_framebuffer:Un,destroy:function(){Ti(Un),On(Un)},use:function(Jr){Tr.setFBO({framebuffer:ca},Jr)}})}function si(tn){var Bn=Array(6);function Un(Hi){var Jr;j(Bn.indexOf(Tr.next)<0,"can not update framebuffer which is currently in use");var on={color:null},Ii=0,ta=null,da="rgba",ss="uint8",ms=1;if(typeof Hi=="number")Ii=Hi|0;else if(!Hi)Ii=1;else{j.type(Hi,"object","invalid arguments for framebuffer");var Pa=Hi;if("shape"in Pa){var yu=Pa.shape;j(Array.isArray(yu)&&yu.length>=2,"invalid shape for framebuffer"),j(yu[0]===yu[1],"cube framebuffer must be square"),Ii=yu[0]}else"radius"in Pa&&(Ii=Pa.radius|0),"width"in Pa?(Ii=Pa.width|0,"height"in Pa&&j(Pa.height===Ii,"must be square")):"height"in Pa&&(Ii=Pa.height|0);("color"in Pa||"colors"in Pa)&&(ta=Pa.color||Pa.colors,Array.isArray(ta)&&j(ta.length===1||Le.webgl_draw_buffers,"multiple render targets not supported")),ta||("colorCount"in Pa&&(ms=Pa.colorCount|0,j(ms>0,"invalid color buffer count")),"colorType"in Pa&&(j.oneOf(Pa.colorType,rn,"invalid color type"),ss=Pa.colorType),"colorFormat"in Pa&&(da=Pa.colorFormat,j.oneOf(Pa.colorFormat,Vr,"invalid color format for texture"))),"depth"in Pa&&(on.depth=Pa.depth),"stencil"in Pa&&(on.stencil=Pa.stencil),"depthStencil"in Pa&&(on.depthStencil=Pa.depthStencil)}var Mo;if(ta)if(Array.isArray(ta))for(Mo=[],Jr=0;Jr<ta.length;++Jr)Mo[Jr]=ta[Jr];else Mo=[ta];else{Mo=Array(ms);var Io={radius:Ii,format:da,type:ss};for(Jr=0;Jr<ms;++Jr)Mo[Jr]=fr.createCube(Io)}for(on.color=Array(Mo.length),Jr=0;Jr<Mo.length;++Jr){var Ps=Mo[Jr];j(typeof Ps=="function"&&Ps._reglType==="textureCube","invalid cube map"),Ii=Ii||Ps.width,j(Ps.width===Ii&&Ps.height===Ii,"invalid cube map shape"),on.color[Jr]={target:pl,data:Mo[Jr]}}for(Jr=0;Jr<6;++Jr){for(var uu=0;uu<Mo.length;++uu)on.color[uu].target=pl+Jr;Jr>0&&(on.depth=Bn[0].depth,on.stencil=Bn[0].stencil,on.depthStencil=Bn[0].depthStencil),Bn[Jr]?Bn[Jr](on):Bn[Jr]=Lr(on)}return y(Un,{width:Ii,height:Ii,color:Mo})}function ca(Hi){var Jr,on=Hi|0;if(j(on>0&&on<=at.maxCubeMapSize,"invalid radius for cube fbo"),on===Un.width)return Un;var Ii=Un.color;for(Jr=0;Jr<Ii.length;++Jr)Ii[Jr].resize(on);for(Jr=0;Jr<6;++Jr)Bn[Jr].resize(on);return Un.width=Un.height=on,Un}return Un(tn),y(Un,{faces:Bn,resize:ca,_reglType:"framebufferCube",destroy:function(){Bn.forEach(function(Hi){Hi.destroy()})}})}function Ln(){Tr.cur=null,Tr.next=null,Tr.dirty=!0,ve(zr).forEach(function(tn){tn.framebuffer=H.createFramebuffer(),Mr(tn)})}return y(Tr,{getFramebuffer:function(tn){if(typeof tn=="function"&&tn._reglType==="framebuffer"){var Bn=tn._framebuffer;if(Bn instanceof _n)return Bn}return null},create:Lr,createCube:si,clear:function(){ve(zr).forEach(Ti)},restore:Ln})}var Qe=5126,nt=34962,He=34963,ft=["attributes","elements","offset","count","primitive","instances"];function Et(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Qe,this.offset=0,this.stride=0,this.divisor=0}function Ht(H,Le,at,fr,Nr,ur,Tr){for(var Vr=at.maxAttributes,qr=new Array(Vr),rn=0;rn<Vr;++rn)qr[rn]=new Et;var pn=0,dn={},An={Record:Et,scope:{},state:qr,currentVAO:null,targetVAO:null,restore:fn()?On:function(){},createVAO:Ti,getVAO:mr,destroyBuffer:en,setVAO:fn()?nn:kn,clear:fn()?zr:function(){}};function en(Mr){for(var Lr=0;Lr<qr.length;++Lr){var si=qr[Lr];si.buffer===Mr&&(H.disableVertexAttribArray(Lr),si.buffer=null)}}function fn(){return Le.oes_vertex_array_object}function Ft(){return Le.angle_instanced_arrays}function mr(Mr){return typeof Mr=="function"&&Mr._vao?Mr._vao:null}function nn(Mr){if(Mr!==An.currentVAO){var Lr=fn();Mr?Lr.bindVertexArrayOES(Mr.vao):Lr.bindVertexArrayOES(null),An.currentVAO=Mr}}function kn(Mr){if(Mr!==An.currentVAO){if(Mr)Mr.bindAttrs();else{for(var Lr=Ft(),si=0;si<qr.length;++si){var Ln=qr[si];Ln.buffer?(H.enableVertexAttribArray(si),Ln.buffer.bind(),H.vertexAttribPointer(si,Ln.size,Ln.type,Ln.normalized,Ln.stride,Ln.offfset),Lr&&Ln.divisor&&Lr.vertexAttribDivisorANGLE(si,Ln.divisor)):(H.disableVertexAttribArray(si),H.vertexAttrib4f(si,Ln.x,Ln.y,Ln.z,Ln.w))}Tr.elements?H.bindBuffer(He,Tr.elements.buffer.buffer):H.bindBuffer(He,null)}An.currentVAO=Mr}}function zr(){ve(dn).forEach(function(Mr){Mr.destroy()})}function _n(){this.id=++pn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Mr=fn();Mr?this.vao=Mr.createVertexArrayOES():this.vao=null,dn[this.id]=this,this.buffers=[]}_n.prototype.bindAttrs=function(){for(var Mr=Ft(),Lr=this.attributes,si=0;si<Lr.length;++si){var Ln=Lr[si];Ln.buffer?(H.enableVertexAttribArray(si),H.bindBuffer(nt,Ln.buffer.buffer),H.vertexAttribPointer(si,Ln.size,Ln.type,Ln.normalized,Ln.stride,Ln.offset),Mr&&Ln.divisor&&Mr.vertexAttribDivisorANGLE(si,Ln.divisor)):(H.disableVertexAttribArray(si),H.vertexAttrib4f(si,Ln.x,Ln.y,Ln.z,Ln.w))}for(var tn=Lr.length;tn<Vr;++tn)H.disableVertexAttribArray(tn);var Bn=ur.getElements(this.elements);Bn?H.bindBuffer(He,Bn.buffer.buffer):H.bindBuffer(He,null)},_n.prototype.refresh=function(){var Mr=fn();Mr&&(Mr.bindVertexArrayOES(this.vao),this.bindAttrs(),An.currentVAO=null,Mr.bindVertexArrayOES(null))},_n.prototype.destroy=function(){if(this.vao){var Mr=fn();this===An.currentVAO&&(An.currentVAO=null,Mr.bindVertexArrayOES(null)),Mr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),dn[this.id]&&(delete dn[this.id],fr.vaoCount-=1)};function On(){var Mr=fn();Mr&&ve(dn).forEach(function(Lr){Lr.refresh()})}function Ti(Mr){var Lr=new _n;fr.vaoCount+=1;function si(Ln){var tn;if(Array.isArray(Ln))tn=Ln,Lr.elements&&Lr.ownsElements&&Lr.elements.destroy(),Lr.elements=null,Lr.ownsElements=!1,Lr.offset=0,Lr.count=0,Lr.instances=-1,Lr.primitive=4;else{if(j(typeof Ln=="object","invalid arguments for create vao"),j("attributes"in Ln,"must specify attributes for vao"),Ln.elements){var Bn=Ln.elements;Lr.ownsElements?typeof Bn=="function"&&Bn._reglType==="elements"?(Lr.elements.destroy(),Lr.ownsElements=!1):(Lr.elements(Bn),Lr.ownsElements=!1):ur.getElements(Ln.elements)?(Lr.elements=Ln.elements,Lr.ownsElements=!1):(Lr.elements=ur.create(Ln.elements),Lr.ownsElements=!0)}else Lr.elements=null,Lr.ownsElements=!1;tn=Ln.attributes,Lr.offset=0,Lr.count=-1,Lr.instances=-1,Lr.primitive=4,Lr.elements&&(Lr.count=Lr.elements._elements.vertCount,Lr.primitive=Lr.elements._elements.primType),"offset"in Ln&&(Lr.offset=Ln.offset|0),"count"in Ln&&(Lr.count=Ln.count|0),"instances"in Ln&&(Lr.instances=Ln.instances|0),"primitive"in Ln&&(j(Ln.primitive in Br,"bad primitive type: "+Ln.primitive),Lr.primitive=Br[Ln.primitive]),j.optional(function(){for(var ss=Object.keys(Ln),ms=0;ms<ss.length;++ms)j(ft.indexOf(ss[ms])>=0,'invalid option for vao: "'+ss[ms]+'" valid options are '+ft)}),j(Array.isArray(tn),"attributes must be an array")}j(tn.length<Vr,"too many attributes"),j(tn.length>0,"must specify at least one attribute");var Un={},ca=Lr.attributes;ca.length=tn.length;for(var Hi=0;Hi<tn.length;++Hi){var Jr=tn[Hi],on=ca[Hi]=new Et,Ii=Jr.data||Jr;if(Array.isArray(Ii)||de(Ii)||ns(Ii)){var ta;Lr.buffers[Hi]&&(ta=Lr.buffers[Hi],de(Ii)&&ta._buffer.byteLength>=Ii.byteLength?ta.subdata(Ii):(ta.destroy(),Lr.buffers[Hi]=null)),Lr.buffers[Hi]||(ta=Lr.buffers[Hi]=Nr.create(Jr,nt,!1,!0)),on.buffer=Nr.getBuffer(ta),on.size=on.buffer.dimension|0,on.normalized=!1,on.type=on.buffer.dtype,on.offset=0,on.stride=0,on.divisor=0,on.state=1,Un[Hi]=1}else Nr.getBuffer(Jr)?(on.buffer=Nr.getBuffer(Jr),on.size=on.buffer.dimension|0,on.normalized=!1,on.type=on.buffer.dtype,on.offset=0,on.stride=0,on.divisor=0,on.state=1):Nr.getBuffer(Jr.buffer)?(on.buffer=Nr.getBuffer(Jr.buffer),on.size=(+Jr.size||on.buffer.dimension)|0,on.normalized=!!Jr.normalized||!1,"type"in Jr?(j.parameter(Jr.type,Eu,"invalid buffer type"),on.type=Eu[Jr.type]):on.type=on.buffer.dtype,on.offset=(Jr.offset||0)|0,on.stride=(Jr.stride||0)|0,on.divisor=(Jr.divisor||0)|0,on.state=1,j(on.size>=1&&on.size<=4,"size must be between 1 and 4"),j(on.offset>=0,"invalid offset"),j(on.stride>=0&&on.stride<=255,"stride must be between 0 and 255"),j(on.divisor>=0,"divisor must be positive"),j(!on.divisor||!!Le.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Jr?(j(Hi>0,"first attribute must not be a constant"),on.x=+Jr.x||0,on.y=+Jr.y||0,on.z=+Jr.z||0,on.w=+Jr.w||0,on.state=2):j(!1,"invalid attribute spec for location "+Hi)}for(var da=0;da<Lr.buffers.length;++da)!Un[da]&&Lr.buffers[da]&&(Lr.buffers[da].destroy(),Lr.buffers[da]=null);return Lr.refresh(),si}return si.destroy=function(){for(var Ln=0;Ln<Lr.buffers.length;++Ln)Lr.buffers[Ln]&&Lr.buffers[Ln].destroy();Lr.buffers.length=0,Lr.ownsElements&&(Lr.elements.destroy(),Lr.elements=null,Lr.ownsElements=!1),Lr.destroy()},si._vao=Lr,si._reglType="vao",si(Mr)}return An}var vr=35632,rr=35633,Ar=35718,Hr=35721;function xn(H,Le,at,fr){var Nr={},ur={};function Tr(Ft,mr,nn,kn){this.name=Ft,this.id=mr,this.location=nn,this.info=kn}function Vr(Ft,mr){for(var nn=0;nn<Ft.length;++nn)if(Ft[nn].id===mr.id){Ft[nn].location=mr.location;return}Ft.push(mr)}function qr(Ft,mr,nn){var kn=Ft===vr?Nr:ur,zr=kn[mr];if(!zr){var _n=Le.str(mr);zr=H.createShader(Ft),H.shaderSource(zr,_n),H.compileShader(zr),j.shaderError(H,zr,_n,Ft,nn),kn[mr]=zr}return zr}var rn={},pn=[],dn=0;function An(Ft,mr){this.id=dn++,this.fragId=Ft,this.vertId=mr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,fr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function en(Ft,mr,nn){var kn,zr,_n=qr(vr,Ft.fragId),On=qr(rr,Ft.vertId),Ti=Ft.program=H.createProgram();if(H.attachShader(Ti,_n),H.attachShader(Ti,On),nn)for(kn=0;kn<nn.length;++kn){var Mr=nn[kn];H.bindAttribLocation(Ti,Mr[0],Mr[1])}H.linkProgram(Ti),j.linkError(H,Ti,Le.str(Ft.fragId),Le.str(Ft.vertId),mr);var Lr=H.getProgramParameter(Ti,Ar);fr.profile&&(Ft.stats.uniformsCount=Lr);var si=Ft.uniforms;for(kn=0;kn<Lr;++kn)if(zr=H.getActiveUniform(Ti,kn),zr)if(zr.size>1)for(var Ln=0;Ln<zr.size;++Ln){var tn=zr.name.replace("[0]","["+Ln+"]");Vr(si,new Tr(tn,Le.id(tn),H.getUniformLocation(Ti,tn),zr))}else Vr(si,new Tr(zr.name,Le.id(zr.name),H.getUniformLocation(Ti,zr.name),zr));var Bn=H.getProgramParameter(Ti,Hr);fr.profile&&(Ft.stats.attributesCount=Bn);var Un=Ft.attributes;for(kn=0;kn<Bn;++kn)zr=H.getActiveAttrib(Ti,kn),zr&&Vr(Un,new Tr(zr.name,Le.id(zr.name),H.getAttribLocation(Ti,zr.name),zr))}fr.profile&&(at.getMaxUniformsCount=function(){var Ft=0;return pn.forEach(function(mr){mr.stats.uniformsCount>Ft&&(Ft=mr.stats.uniformsCount)}),Ft},at.getMaxAttributesCount=function(){var Ft=0;return pn.forEach(function(mr){mr.stats.attributesCount>Ft&&(Ft=mr.stats.attributesCount)}),Ft});function fn(){Nr={},ur={};for(var Ft=0;Ft<pn.length;++Ft)en(pn[Ft],null,pn[Ft].attributes.map(function(mr){return[mr.location,mr.name]}))}return{clear:function(){var Ft=H.deleteShader.bind(H);ve(Nr).forEach(Ft),Nr={},ve(ur).forEach(Ft),ur={},pn.forEach(function(mr){H.deleteProgram(mr.program)}),pn.length=0,rn={},at.shaderCount=0},program:function(Ft,mr,nn,kn){j.command(Ft>=0,"missing vertex shader",nn),j.command(mr>=0,"missing fragment shader",nn);var zr=rn[mr];zr||(zr=rn[mr]={});var _n=zr[Ft];if(_n&&(_n.refCount++,!kn))return _n;var On=new An(mr,Ft);return at.shaderCount++,en(On,nn,kn),_n||(zr[Ft]=On),pn.push(On),y(On,{destroy:function(){if(On.refCount--,On.refCount<=0){H.deleteProgram(On.program);var Ti=pn.indexOf(On);pn.splice(Ti,1),at.shaderCount--}zr[On.vertId].refCount<=0&&(H.deleteShader(ur[On.vertId]),delete ur[On.vertId],delete rn[On.fragId][On.vertId]),Object.keys(rn[On.fragId]).length||(H.deleteShader(Nr[On.fragId]),delete Nr[On.fragId],delete rn[On.fragId])}})},restore:fn,shader:qr,frag:-1,vert:-1}}var yn=6408,Zn=5121,_i=3333,wi=5126;function Ei(H,Le,at,fr,Nr,ur,Tr){function Vr(pn){var dn;Le.next===null?(j(Nr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),dn=Zn):(j(Le.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),dn=Le.next.colorAttachments[0].texture._texture.type,j.optional(function(){ur.oes_texture_float?(j(dn===Zn||dn===wi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),dn===wi&&j(Tr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):j(dn===Zn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var An=0,en=0,fn=fr.framebufferWidth,Ft=fr.framebufferHeight,mr=null;de(pn)?mr=pn:pn&&(j.type(pn,"object","invalid arguments to regl.read()"),An=pn.x|0,en=pn.y|0,j(An>=0&&An<fr.framebufferWidth,"invalid x offset for regl.read"),j(en>=0&&en<fr.framebufferHeight,"invalid y offset for regl.read"),fn=(pn.width||fr.framebufferWidth-An)|0,Ft=(pn.height||fr.framebufferHeight-en)|0,mr=pn.data||null),mr&&(dn===Zn?j(mr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):dn===wi&&j(mr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),j(fn>0&&fn+An<=fr.framebufferWidth,"invalid width for read pixels"),j(Ft>0&&Ft+en<=fr.framebufferHeight,"invalid height for read pixels"),at();var nn=fn*Ft*4;return mr||(dn===Zn?mr=new Uint8Array(nn):dn===wi&&(mr=mr||new Float32Array(nn))),j.isTypedArray(mr,"data buffer for regl.read() must be a typedarray"),j(mr.byteLength>=nn,"data buffer for regl.read() too small"),H.pixelStorei(_i,4),H.readPixels(An,en,fn,Ft,yn,dn,mr),mr}function qr(pn){var dn;return Le.setFBO({framebuffer:pn.framebuffer},function(){dn=Vr(pn)}),dn}function rn(pn){return!pn||!("framebuffer"in pn)?Vr(pn):qr(pn)}return rn}function wa(H){return Array.prototype.slice.call(H)}function Wn(H){return wa(H).join("")}function Gi(){var H=0,Le=[],at=[];function fr(dn){for(var An=0;An<at.length;++An)if(at[An]===dn)return Le[An];var en="g"+H++;return Le.push(en),at.push(dn),en}function Nr(){var dn=[];function An(){dn.push.apply(dn,wa(arguments))}var en=[];function fn(){var Ft="v"+H++;return en.push(Ft),arguments.length>0&&(dn.push(Ft,"="),dn.push.apply(dn,wa(arguments)),dn.push(";")),Ft}return y(An,{def:fn,toString:function(){return Wn([en.length>0?"var "+en.join(",")+";":"",Wn(dn)])}})}function ur(){var dn=Nr(),An=Nr(),en=dn.toString,fn=An.toString;function Ft(mr,nn){An(mr,nn,"=",dn.def(mr,nn),";")}return y(function(){dn.apply(dn,wa(arguments))},{def:dn.def,entry:dn,exit:An,save:Ft,set:function(mr,nn,kn){Ft(mr,nn),dn(mr,nn,"=",kn,";")},toString:function(){return en()+fn()}})}function Tr(){var dn=Wn(arguments),An=ur(),en=ur(),fn=An.toString,Ft=en.toString;return y(An,{then:function(){return An.apply(An,wa(arguments)),this},else:function(){return en.apply(en,wa(arguments)),this},toString:function(){var mr=Ft();return mr&&(mr="else{"+mr+"}"),Wn(["if(",dn,"){",fn(),"}",mr])}})}var Vr=Nr(),qr={};function rn(dn,An){var en=[];function fn(){var zr="a"+en.length;return en.push(zr),zr}An=An||0;for(var Ft=0;Ft<An;++Ft)fn();var mr=ur(),nn=mr.toString,kn=qr[dn]=y(mr,{arg:fn,toString:function(){return Wn(["function(",en.join(),"){",nn(),"}"])}});return kn}function pn(){var dn=['"use strict";',Vr,"return {"];Object.keys(qr).forEach(function(Ft){dn.push('"',Ft,'":',qr[Ft].toString(),",")}),dn.push("}");var An=Wn(dn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),en=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,fn=en?We.Function.apply(null,Le.concat(An)):Function.apply(null,Le.concat(An));return fn.apply(null,at)}return{global:Vr,link:fr,block:Nr,proc:rn,scope:ur,cond:Tr,compile:pn}}var Ji="xyzw".split(""),Yi=5121,Ri=1,ea=2,Di=0,ki=1,xs=2,qo=3,is=4,as=5,_o=6,os="dither",Mu="blend.enable",ks="blend.color",Ul="blend.equation",$o="blend.func",Iu="depth.enable",ku="depth.func",Jf="depth.range",ef="depth.mask",Zl="colorMask",tl="cull.enable",tf="cull.face",Sl="frontFace",Ec="lineWidth",Vl="polygonOffset.enable",vs="polygonOffset.offset",Al="sample.alpha",Cc="sample.enable",gu="sample.coverage",Ga="stencil.enable",Nu="stencil.mask",bs="stencil.func",tc="stencil.opFront",_h="stencil.opBack",xh="scissor.enable",bh="scissor.box",zu="viewport",jl="profile",Uu="framebuffer",rf="vert",Rf="frag",Gl="elements",Js="primitive",Yh="count",rc="offset",yp="instances",su="vao",nf="Width",eh="Height",Sc=Uu+nf,qh=Uu+eh,rl=zu+nf,xe=zu+eh,$r="drawingBuffer",Ac=$r+nf,Qd=$r+eh,eu=[$o,Ul,bs,tc,_h,gu,zu,bh,vs],js=34962,Pu=34963,Td=35632,af=35633,th=3553,Eh=34067,rh=2884,Ch=3042,wc=3024,Ko=2960,$h=2929,Md=3089,$i=32823,Hp=32926,Kh=32928,Tc=5126,_p=35664,nl=35665,Sh=35666,of=5124,Wp=35667,nc=35668,ic=35669,xp=35670,Xp=35671,Qh=35672,Jh=35673,Zu=35674,ac=35675,Lf=35676,Yp=35678,sf=35680,Of=4,Gs=1028,Ah=1029,qp=2304,uf=2305,ep=32775,Mc=32776,Ic=519,Ru=7680,kc=0,oc=1,Pc=32774,lf=513,tp=36160,w0=36064,cf={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},wh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],nh={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Rc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},$p={frag:Td,vert:af},Kp={cw:qp,ccw:uf};function bp(H){return Array.isArray(H)||de(H)||ns(H)}function Id(H){return H.sort(function(Le,at){return Le===zu?-1:at===zu?1:Le<at?-1:1})}function oo(H,Le,at,fr){this.thisDep=H,this.contextDep=Le,this.propDep=at,this.append=fr}function Hs(H){return H&&!(H.thisDep||H.contextDep||H.propDep)}function To(H){return new oo(!1,!1,!1,H)}function Ws(H,Le){var at=H.type;if(at===Di){var fr=H.data.length;return new oo(!0,fr>=1,fr>=2,Le)}else if(at===is){var Nr=H.data;return new oo(Nr.thisDep,Nr.contextDep,Nr.propDep,Le)}else{if(at===as)return new oo(!1,!1,!1,Le);if(at===_o){for(var ur=!1,Tr=!1,Vr=!1,qr=0;qr<H.data.length;++qr){var rn=H.data[qr];if(rn.type===ki)Vr=!0;else if(rn.type===xs)Tr=!0;else if(rn.type===qo)ur=!0;else if(rn.type===Di){ur=!0;var pn=rn.data;pn>=1&&(Tr=!0),pn>=2&&(Vr=!0)}else rn.type===is&&(ur=ur||rn.data.thisDep,Tr=Tr||rn.data.contextDep,Vr=Vr||rn.data.propDep)}return new oo(ur,Tr,Vr,Le)}else return new oo(at===qo,at===xs,at===ki,Le)}}var kd=new oo(!1,!1,!1,function(){});function Lc(H,Le,at,fr,Nr,ur,Tr,Vr,qr,rn,pn,dn,An,en,fn){var Ft=rn.Record,mr={add:32774,subtract:32778,"reverse subtract":32779};at.ext_blend_minmax&&(mr.min=ep,mr.max=Mc);var nn=at.angle_instanced_arrays,kn=at.webgl_draw_buffers,zr=at.oes_vertex_array_object,_n={dirty:!0,profile:fn.profile},On={},Ti=[],Mr={},Lr={};function si(Ve){return Ve.replace(".","_")}function Ln(Ve,Ce,ht){var Bt=si(Ve);Ti.push(Ve),On[Bt]=_n[Bt]=!!ht,Mr[Bt]=Ce}function tn(Ve,Ce,ht){var Bt=si(Ve);Ti.push(Ve),Array.isArray(ht)?(_n[Bt]=ht.slice(),On[Bt]=ht.slice()):_n[Bt]=On[Bt]=ht,Lr[Bt]=Ce}Ln(os,wc),Ln(Mu,Ch),tn(ks,"blendColor",[0,0,0,0]),tn(Ul,"blendEquationSeparate",[Pc,Pc]),tn($o,"blendFuncSeparate",[oc,kc,oc,kc]),Ln(Iu,$h,!0),tn(ku,"depthFunc",lf),tn(Jf,"depthRange",[0,1]),tn(ef,"depthMask",!0),tn(Zl,Zl,[!0,!0,!0,!0]),Ln(tl,rh),tn(tf,"cullFace",Ah),tn(Sl,Sl,uf),tn(Ec,Ec,1),Ln(Vl,$i),tn(vs,"polygonOffset",[0,0]),Ln(Al,Hp),Ln(Cc,Kh),tn(gu,"sampleCoverage",[1,!1]),Ln(Ga,Ko),tn(Nu,"stencilMask",-1),tn(bs,"stencilFunc",[Ic,0,-1]),tn(tc,"stencilOpSeparate",[Gs,Ru,Ru,Ru]),tn(_h,"stencilOpSeparate",[Ah,Ru,Ru,Ru]),Ln(xh,Md),tn(bh,"scissor",[0,0,H.drawingBufferWidth,H.drawingBufferHeight]),tn(zu,zu,[0,0,H.drawingBufferWidth,H.drawingBufferHeight]);var Bn={gl:H,context:An,strings:Le,next:On,current:_n,draw:dn,elements:ur,buffer:Nr,shader:pn,attributes:rn.state,vao:rn,uniforms:qr,framebuffer:Vr,extensions:at,timer:en,isBufferArgs:bp},Un={primTypes:Br,compareFuncs:nh,blendFuncs:cf,blendEquations:mr,stencilOps:Rc,glTypes:Eu,orientationType:Kp};j.optional(function(){Bn.isArrayLike=Wo}),kn&&(Un.backBuffer=[Ah],Un.drawBuffer=st(fr.maxDrawbuffers,function(Ve){return Ve===0?[0]:st(Ve,function(Ce){return w0+Ce})}));var ca=0;function Hi(){var Ve=Gi(),Ce=Ve.link,ht=Ve.global;Ve.id=ca++,Ve.batchId="0";var Bt=Ce(Bn),ar=Ve.shared={props:"a0"};Object.keys(Bn).forEach(function(ct){ar[ct]=ht.def(Bt,".",ct)}),j.optional(function(){Ve.CHECK=Ce(j),Ve.commandStr=j.guessCommand(),Ve.command=Ce(Ve.commandStr),Ve.assert=function(ct,Ge,Nt){ct("if(!(",Ge,"))",this.CHECK,".commandRaise(",Ce(Nt),",",this.command,");")},Un.invalidBlendCombinations=wh});var gt=Ve.next={},he=Ve.current={};Object.keys(Lr).forEach(function(ct){Array.isArray(_n[ct])&&(gt[ct]=ht.def(ar.next,".",ct),he[ct]=ht.def(ar.current,".",ct))});var Tt=Ve.constants={};Object.keys(Un).forEach(function(ct){Tt[ct]=ht.def(JSON.stringify(Un[ct]))}),Ve.invoke=function(ct,Ge){switch(Ge.type){case Di:var Nt=["this",ar.context,ar.props,Ve.batchId];return ct.def(Ce(Ge.data),".call(",Nt.slice(0,Math.max(Ge.data.length+1,4)),")");case ki:return ct.def(ar.props,Ge.data);case xs:return ct.def(ar.context,Ge.data);case qo:return ct.def("this",Ge.data);case is:return Ge.data.append(Ve,ct),Ge.data.ref;case as:return Ge.data.toString();case _o:return Ge.data.map(function(qt){return Ve.invoke(ct,qt)})}},Ve.attribCache={};var Fe={};return Ve.scopeAttrib=function(ct){var Ge=Le.id(ct);if(Ge in Fe)return Fe[Ge];var Nt=rn.scope[Ge];Nt||(Nt=rn.scope[Ge]=new Ft);var qt=Fe[Ge]=Ce(Nt);return qt},Ve}function Jr(Ve){var Ce=Ve.static,ht=Ve.dynamic,Bt;if(jl in Ce){var ar=!!Ce[jl];Bt=To(function(he,Tt){return ar}),Bt.enable=ar}else if(jl in ht){var gt=ht[jl];Bt=Ws(gt,function(he,Tt){return he.invoke(Tt,gt)})}return Bt}function on(Ve,Ce){var ht=Ve.static,Bt=Ve.dynamic;if(Uu in ht){var ar=ht[Uu];return ar?(ar=Vr.getFramebuffer(ar),j.command(ar,"invalid framebuffer object"),To(function(he,Tt){var Fe=he.link(ar),ct=he.shared;Tt.set(ct.framebuffer,".next",Fe);var Ge=ct.context;return Tt.set(Ge,"."+Sc,Fe+".width"),Tt.set(Ge,"."+qh,Fe+".height"),Fe})):To(function(he,Tt){var Fe=he.shared;Tt.set(Fe.framebuffer,".next","null");var ct=Fe.context;return Tt.set(ct,"."+Sc,ct+"."+Ac),Tt.set(ct,"."+qh,ct+"."+Qd),"null"})}else if(Uu in Bt){var gt=Bt[Uu];return Ws(gt,function(he,Tt){var Fe=he.invoke(Tt,gt),ct=he.shared,Ge=ct.framebuffer,Nt=Tt.def(Ge,".getFramebuffer(",Fe,")");j.optional(function(){he.assert(Tt,"!"+Fe+"||"+Nt,"invalid framebuffer object")}),Tt.set(Ge,".next",Nt);var qt=ct.context;return Tt.set(qt,"."+Sc,Nt+"?"+Nt+".width:"+qt+"."+Ac),Tt.set(qt,"."+qh,Nt+"?"+Nt+".height:"+qt+"."+Qd),Nt})}else return null}function Ii(Ve,Ce,ht){var Bt=Ve.static,ar=Ve.dynamic;function gt(Fe){if(Fe in Bt){var ct=Bt[Fe];j.commandType(ct,"object","invalid "+Fe,ht.commandStr);var Ge=!0,Nt=ct.x|0,qt=ct.y|0,Ur,Pn;return"width"in ct?(Ur=ct.width|0,j.command(Ur>=0,"invalid "+Fe,ht.commandStr)):Ge=!1,"height"in ct?(Pn=ct.height|0,j.command(Pn>=0,"invalid "+Fe,ht.commandStr)):Ge=!1,new oo(!Ge&&Ce&&Ce.thisDep,!Ge&&Ce&&Ce.contextDep,!Ge&&Ce&&Ce.propDep,function(En,fi){var jn=En.shared.context,$n=Ur;"width"in ct||($n=fi.def(jn,".",Sc,"-",Nt));var ii=Pn;return"height"in ct||(ii=fi.def(jn,".",qh,"-",qt)),[Nt,qt,$n,ii]})}else if(Fe in ar){var In=ar[Fe],Vn=Ws(In,function(En,fi){var jn=En.invoke(fi,In);j.optional(function(){En.assert(fi,jn+"&&typeof "+jn+'==="object"',"invalid "+Fe)});var $n=En.shared.context,ii=fi.def(jn,".x|0"),Kn=fi.def(jn,".y|0"),Vi=fi.def('"width" in ',jn,"?",jn,".width|0:","(",$n,".",Sc,"-",ii,")"),Ya=fi.def('"height" in ',jn,"?",jn,".height|0:","(",$n,".",qh,"-",Kn,")");return j.optional(function(){En.assert(fi,Vi+">=0&&"+Ya+">=0","invalid "+Fe)}),[ii,Kn,Vi,Ya]});return Ce&&(Vn.thisDep=Vn.thisDep||Ce.thisDep,Vn.contextDep=Vn.contextDep||Ce.contextDep,Vn.propDep=Vn.propDep||Ce.propDep),Vn}else return Ce?new oo(Ce.thisDep,Ce.contextDep,Ce.propDep,function(En,fi){var jn=En.shared.context;return[0,0,fi.def(jn,".",Sc),fi.def(jn,".",qh)]}):null}var he=gt(zu);if(he){var Tt=he;he=new oo(he.thisDep,he.contextDep,he.propDep,function(Fe,ct){var Ge=Tt.append(Fe,ct),Nt=Fe.shared.context;return ct.set(Nt,"."+rl,Ge[2]),ct.set(Nt,"."+xe,Ge[3]),Ge})}return{viewport:he,scissor_box:gt(bh)}}function ta(Ve,Ce){var ht=Ve.static,Bt=typeof ht[Rf]=="string"&&typeof ht[rf]=="string";if(Bt){if(Object.keys(Ce.dynamic).length>0)return null;var ar=Ce.static,gt=Object.keys(ar);if(gt.length>0&&typeof ar[gt[0]]=="number"){for(var he=[],Tt=0;Tt<gt.length;++Tt)j(typeof ar[gt[Tt]]=="number","must specify all vertex attribute locations when using vaos"),he.push([ar[gt[Tt]]|0,gt[Tt]]);return he}}return null}function da(Ve,Ce,ht){var Bt=Ve.static,ar=Ve.dynamic;function gt(Ge){if(Ge in Bt){var Nt=Le.id(Bt[Ge]);j.optional(function(){pn.shader($p[Ge],Nt,j.guessCommand())});var qt=To(function(){return Nt});return qt.id=Nt,qt}else if(Ge in ar){var Ur=ar[Ge];return Ws(Ur,function(Pn,In){var Vn=Pn.invoke(In,Ur),En=In.def(Pn.shared.strings,".id(",Vn,")");return j.optional(function(){In(Pn.shared.shader,".shader(",$p[Ge],",",En,",",Pn.command,");")}),En})}return null}var he=gt(Rf),Tt=gt(rf),Fe=null,ct;return Hs(he)&&Hs(Tt)?(Fe=pn.program(Tt.id,he.id,null,ht),ct=To(function(Ge,Nt){return Ge.link(Fe)})):ct=new oo(he&&he.thisDep||Tt&&Tt.thisDep,he&&he.contextDep||Tt&&Tt.contextDep,he&&he.propDep||Tt&&Tt.propDep,function(Ge,Nt){var qt=Ge.shared.shader,Ur;he?Ur=he.append(Ge,Nt):Ur=Nt.def(qt,".",Rf);var Pn;Tt?Pn=Tt.append(Ge,Nt):Pn=Nt.def(qt,".",rf);var In=qt+".program("+Pn+","+Ur;return j.optional(function(){In+=","+Ge.command}),Nt.def(In+")")}),{frag:he,vert:Tt,progVar:ct,program:Fe}}function ss(Ve,Ce){var ht=Ve.static,Bt=Ve.dynamic,ar={},gt=!1;function he(){if(su in ht){var fi=ht[su];return fi!==null&&rn.getVAO(fi)===null&&(fi=rn.createVAO(fi)),gt=!0,ar.vao=fi,To(function($n){var ii=rn.getVAO(fi);return ii?$n.link(ii):"null"})}else if(su in Bt){gt=!0;var jn=Bt[su];return Ws(jn,function($n,ii){var Kn=$n.invoke(ii,jn);return ii.def($n.shared.vao+".getVAO("+Kn+")")})}return null}var Tt=he(),Fe=!1;function ct(){if(Gl in ht){var fi=ht[Gl];if(ar.elements=fi,bp(fi)){var jn=ar.elements=ur.create(fi,!0);fi=ur.getElements(jn),Fe=!0}else fi&&(fi=ur.getElements(fi),Fe=!0,j.command(fi,"invalid elements",Ce.commandStr));var $n=To(function(Kn,Vi){if(fi){var Ya=Kn.link(fi);return Kn.ELEMENTS=Ya,Ya}return Kn.ELEMENTS=null,null});return $n.value=fi,$n}else if(Gl in Bt){Fe=!0;var ii=Bt[Gl];return Ws(ii,function(Kn,Vi){var Ya=Kn.shared,Ls=Ya.isBufferArgs,Lo=Ya.elements,to=Kn.invoke(Vi,ii),ff=Vi.def("null"),Vu=Vi.def(Ls,"(",to,")"),sc=Kn.cond(Vu).then(ff,"=",Lo,".createStream(",to,");").else(ff,"=",Lo,".getElements(",to,");");return j.optional(function(){Kn.assert(sc.else,"!"+to+"||"+ff,"invalid elements")}),Vi.entry(sc),Vi.exit(Kn.cond(Vu).then(Lo,".destroyStream(",ff,");")),Kn.ELEMENTS=ff,ff})}else if(gt)return new oo(Tt.thisDep,Tt.contextDep,Tt.propDep,function(Kn,Vi){return Vi.def(Kn.shared.vao+".currentVAO?"+Kn.shared.elements+".getElements("+Kn.shared.vao+".currentVAO.elements):null")});return null}var Ge=ct();function Nt(){if(Js in ht){var fi=ht[Js];return ar.primitive=fi,j.commandParameter(fi,Br,"invalid primitve",Ce.commandStr),To(function($n,ii){return Br[fi]})}else if(Js in Bt){var jn=Bt[Js];return Ws(jn,function($n,ii){var Kn=$n.constants.primTypes,Vi=$n.invoke(ii,jn);return j.optional(function(){$n.assert(ii,Vi+" in "+Kn,"invalid primitive, must be one of "+Object.keys(Br))}),ii.def(Kn,"[",Vi,"]")})}else{if(Fe)return Hs(Ge)?Ge.value?To(function($n,ii){return ii.def($n.ELEMENTS,".primType")}):To(function(){return Of}):new oo(Ge.thisDep,Ge.contextDep,Ge.propDep,function($n,ii){var Kn=$n.ELEMENTS;return ii.def(Kn,"?",Kn,".primType:",Of)});if(gt)return new oo(Tt.thisDep,Tt.contextDep,Tt.propDep,function($n,ii){return ii.def($n.shared.vao+".currentVAO?"+$n.shared.vao+".currentVAO.primitive:"+Of)})}return null}function qt(fi,jn){if(fi in ht){var $n=ht[fi]|0;return jn?ar.offset=$n:ar.instances=$n,j.command(!jn||$n>=0,"invalid "+fi,Ce.commandStr),To(function(Kn,Vi){return jn&&(Kn.OFFSET=$n),$n})}else if(fi in Bt){var ii=Bt[fi];return Ws(ii,function(Kn,Vi){var Ya=Kn.invoke(Vi,ii);return jn&&(Kn.OFFSET=Ya,j.optional(function(){Kn.assert(Vi,Ya+">=0","invalid "+fi)})),Ya})}else if(jn){if(Fe)return To(function(Kn,Vi){return Kn.OFFSET=0,0});if(gt)return new oo(Tt.thisDep,Tt.contextDep,Tt.propDep,function(Kn,Vi){return Vi.def(Kn.shared.vao+".currentVAO?"+Kn.shared.vao+".currentVAO.offset:0")})}else if(gt)return new oo(Tt.thisDep,Tt.contextDep,Tt.propDep,function(Kn,Vi){return Vi.def(Kn.shared.vao+".currentVAO?"+Kn.shared.vao+".currentVAO.instances:-1")});return null}var Ur=qt(rc,!0);function Pn(){if(Yh in ht){var fi=ht[Yh]|0;return ar.count=fi,j.command(typeof fi=="number"&&fi>=0,"invalid vertex count",Ce.commandStr),To(function(){return fi})}else if(Yh in Bt){var jn=Bt[Yh];return Ws(jn,function(Vi,Ya){var Ls=Vi.invoke(Ya,jn);return j.optional(function(){Vi.assert(Ya,"typeof "+Ls+'==="number"&&'+Ls+">=0&&"+Ls+"===("+Ls+"|0)","invalid vertex count")}),Ls})}else if(Fe)if(Hs(Ge)){if(Ge)return Ur?new oo(Ur.thisDep,Ur.contextDep,Ur.propDep,function(Vi,Ya){var Ls=Ya.def(Vi.ELEMENTS,".vertCount-",Vi.OFFSET);return j.optional(function(){Vi.assert(Ya,Ls+">=0","invalid vertex offset/element buffer too small")}),Ls}):To(function(Vi,Ya){return Ya.def(Vi.ELEMENTS,".vertCount")});var $n=To(function(){return-1});return j.optional(function(){$n.MISSING=!0}),$n}else{var ii=new oo(Ge.thisDep||Ur.thisDep,Ge.contextDep||Ur.contextDep,Ge.propDep||Ur.propDep,function(Vi,Ya){var Ls=Vi.ELEMENTS;return Vi.OFFSET?Ya.def(Ls,"?",Ls,".vertCount-",Vi.OFFSET,":-1"):Ya.def(Ls,"?",Ls,".vertCount:-1")});return j.optional(function(){ii.DYNAMIC=!0}),ii}else if(gt){var Kn=new oo(Tt.thisDep,Tt.contextDep,Tt.propDep,function(Vi,Ya){return Ya.def(Vi.shared.vao,".currentVAO?",Vi.shared.vao,".currentVAO.count:-1")});return Kn}return null}var In=Nt(),Vn=Pn(),En=qt(yp,!1);return{elements:Ge,primitive:In,count:Vn,instances:En,offset:Ur,vao:Tt,vaoActive:gt,elementsActive:Fe,static:ar}}function ms(Ve,Ce){var ht=Ve.static,Bt=Ve.dynamic,ar={};return Ti.forEach(function(gt){var he=si(gt);function Tt(Fe,ct){if(gt in ht){var Ge=Fe(ht[gt]);ar[he]=To(function(){return Ge})}else if(gt in Bt){var Nt=Bt[gt];ar[he]=Ws(Nt,function(qt,Ur){return ct(qt,Ur,qt.invoke(Ur,Nt))})}}switch(gt){case tl:case Mu:case os:case Ga:case Iu:case xh:case Vl:case Al:case Cc:case ef:return Tt(function(Fe){return j.commandType(Fe,"boolean",gt,Ce.commandStr),Fe},function(Fe,ct,Ge){return j.optional(function(){Fe.assert(ct,"typeof "+Ge+'==="boolean"',"invalid flag "+gt,Fe.commandStr)}),Ge});case ku:return Tt(function(Fe){return j.commandParameter(Fe,nh,"invalid "+gt,Ce.commandStr),nh[Fe]},function(Fe,ct,Ge){var Nt=Fe.constants.compareFuncs;return j.optional(function(){Fe.assert(ct,Ge+" in "+Nt,"invalid "+gt+", must be one of "+Object.keys(nh))}),ct.def(Nt,"[",Ge,"]")});case Jf:return Tt(function(Fe){return j.command(Wo(Fe)&&Fe.length===2&&typeof Fe[0]=="number"&&typeof Fe[1]=="number"&&Fe[0]<=Fe[1],"depth range is 2d array",Ce.commandStr),Fe},function(Fe,ct,Ge){j.optional(function(){Fe.assert(ct,Fe.shared.isArrayLike+"("+Ge+")&&"+Ge+".length===2&&typeof "+Ge+'[0]==="number"&&typeof '+Ge+'[1]==="number"&&'+Ge+"[0]<="+Ge+"[1]","depth range must be a 2d array")});var Nt=ct.def("+",Ge,"[0]"),qt=ct.def("+",Ge,"[1]");return[Nt,qt]});case $o:return Tt(function(Fe){j.commandType(Fe,"object","blend.func",Ce.commandStr);var ct="srcRGB"in Fe?Fe.srcRGB:Fe.src,Ge="srcAlpha"in Fe?Fe.srcAlpha:Fe.src,Nt="dstRGB"in Fe?Fe.dstRGB:Fe.dst,qt="dstAlpha"in Fe?Fe.dstAlpha:Fe.dst;return j.commandParameter(ct,cf,he+".srcRGB",Ce.commandStr),j.commandParameter(Ge,cf,he+".srcAlpha",Ce.commandStr),j.commandParameter(Nt,cf,he+".dstRGB",Ce.commandStr),j.commandParameter(qt,cf,he+".dstAlpha",Ce.commandStr),j.command(wh.indexOf(ct+", "+Nt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ct+", "+Nt+")",Ce.commandStr),[cf[ct],cf[Nt],cf[Ge],cf[qt]]},function(Fe,ct,Ge){var Nt=Fe.constants.blendFuncs;j.optional(function(){Fe.assert(ct,Ge+"&&typeof "+Ge+'==="object"',"invalid blend func, must be an object")});function qt(jn,$n){var ii=ct.def('"',jn,$n,'" in ',Ge,"?",Ge,".",jn,$n,":",Ge,".",jn);return j.optional(function(){Fe.assert(ct,ii+" in "+Nt,"invalid "+gt+"."+jn+$n+", must be one of "+Object.keys(cf))}),ii}var Ur=qt("src","RGB"),Pn=qt("dst","RGB");j.optional(function(){var jn=Fe.constants.invalidBlendCombinations;Fe.assert(ct,jn+".indexOf("+Ur+'+", "+'+Pn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var In=ct.def(Nt,"[",Ur,"]"),Vn=ct.def(Nt,"[",qt("src","Alpha"),"]"),En=ct.def(Nt,"[",Pn,"]"),fi=ct.def(Nt,"[",qt("dst","Alpha"),"]");return[In,En,Vn,fi]});case Ul:return Tt(function(Fe){if(typeof Fe=="string")return j.commandParameter(Fe,mr,"invalid "+gt,Ce.commandStr),[mr[Fe],mr[Fe]];if(typeof Fe=="object")return j.commandParameter(Fe.rgb,mr,gt+".rgb",Ce.commandStr),j.commandParameter(Fe.alpha,mr,gt+".alpha",Ce.commandStr),[mr[Fe.rgb],mr[Fe.alpha]];j.commandRaise("invalid blend.equation",Ce.commandStr)},function(Fe,ct,Ge){var Nt=Fe.constants.blendEquations,qt=ct.def(),Ur=ct.def(),Pn=Fe.cond("typeof ",Ge,'==="string"');return j.optional(function(){function In(Vn,En,fi){Fe.assert(Vn,fi+" in "+Nt,"invalid "+En+", must be one of "+Object.keys(mr))}In(Pn.then,gt,Ge),Fe.assert(Pn.else,Ge+"&&typeof "+Ge+'==="object"',"invalid "+gt),In(Pn.else,gt+".rgb",Ge+".rgb"),In(Pn.else,gt+".alpha",Ge+".alpha")}),Pn.then(qt,"=",Ur,"=",Nt,"[",Ge,"];"),Pn.else(qt,"=",Nt,"[",Ge,".rgb];",Ur,"=",Nt,"[",Ge,".alpha];"),ct(Pn),[qt,Ur]});case ks:return Tt(function(Fe){return j.command(Wo(Fe)&&Fe.length===4,"blend.color must be a 4d array",Ce.commandStr),st(4,function(ct){return+Fe[ct]})},function(Fe,ct,Ge){return j.optional(function(){Fe.assert(ct,Fe.shared.isArrayLike+"("+Ge+")&&"+Ge+".length===4","blend.color must be a 4d array")}),st(4,function(Nt){return ct.def("+",Ge,"[",Nt,"]")})});case Nu:return Tt(function(Fe){return j.commandType(Fe,"number",he,Ce.commandStr),Fe|0},function(Fe,ct,Ge){return j.optional(function(){Fe.assert(ct,"typeof "+Ge+'==="number"',"invalid stencil.mask")}),ct.def(Ge,"|0")});case bs:return Tt(function(Fe){j.commandType(Fe,"object",he,Ce.commandStr);var ct=Fe.cmp||"keep",Ge=Fe.ref||0,Nt="mask"in Fe?Fe.mask:-1;return j.commandParameter(ct,nh,gt+".cmp",Ce.commandStr),j.commandType(Ge,"number",gt+".ref",Ce.commandStr),j.commandType(Nt,"number",gt+".mask",Ce.commandStr),[nh[ct],Ge,Nt]},function(Fe,ct,Ge){var Nt=Fe.constants.compareFuncs;j.optional(function(){function In(){Fe.assert(ct,Array.prototype.join.call(arguments,""),"invalid stencil.func")}In(Ge+"&&typeof ",Ge,'==="object"'),In('!("cmp" in ',Ge,")||(",Ge,".cmp in ",Nt,")")});var qt=ct.def('"cmp" in ',Ge,"?",Nt,"[",Ge,".cmp]",":",Ru),Ur=ct.def(Ge,".ref|0"),Pn=ct.def('"mask" in ',Ge,"?",Ge,".mask|0:-1");return[qt,Ur,Pn]});case tc:case _h:return Tt(function(Fe){j.commandType(Fe,"object",he,Ce.commandStr);var ct=Fe.fail||"keep",Ge=Fe.zfail||"keep",Nt=Fe.zpass||"keep";return j.commandParameter(ct,Rc,gt+".fail",Ce.commandStr),j.commandParameter(Ge,Rc,gt+".zfail",Ce.commandStr),j.commandParameter(Nt,Rc,gt+".zpass",Ce.commandStr),[gt===_h?Ah:Gs,Rc[ct],Rc[Ge],Rc[Nt]]},function(Fe,ct,Ge){var Nt=Fe.constants.stencilOps;j.optional(function(){Fe.assert(ct,Ge+"&&typeof "+Ge+'==="object"',"invalid "+gt)});function qt(Ur){return j.optional(function(){Fe.assert(ct,'!("'+Ur+'" in '+Ge+")||("+Ge+"."+Ur+" in "+Nt+")","invalid "+gt+"."+Ur+", must be one of "+Object.keys(Rc))}),ct.def('"',Ur,'" in ',Ge,"?",Nt,"[",Ge,".",Ur,"]:",Ru)}return[gt===_h?Ah:Gs,qt("fail"),qt("zfail"),qt("zpass")]});case vs:return Tt(function(Fe){j.commandType(Fe,"object",he,Ce.commandStr);var ct=Fe.factor|0,Ge=Fe.units|0;return j.commandType(ct,"number",he+".factor",Ce.commandStr),j.commandType(Ge,"number",he+".units",Ce.commandStr),[ct,Ge]},function(Fe,ct,Ge){j.optional(function(){Fe.assert(ct,Ge+"&&typeof "+Ge+'==="object"',"invalid "+gt)});var Nt=ct.def(Ge,".factor|0"),qt=ct.def(Ge,".units|0");return[Nt,qt]});case tf:return Tt(function(Fe){var ct=0;return Fe==="front"?ct=Gs:Fe==="back"&&(ct=Ah),j.command(!!ct,he,Ce.commandStr),ct},function(Fe,ct,Ge){return j.optional(function(){Fe.assert(ct,Ge+'==="front"||'+Ge+'==="back"',"invalid cull.face")}),ct.def(Ge,'==="front"?',Gs,":",Ah)});case Ec:return Tt(function(Fe){return j.command(typeof Fe=="number"&&Fe>=fr.lineWidthDims[0]&&Fe<=fr.lineWidthDims[1],"invalid line width, must be a positive number between "+fr.lineWidthDims[0]+" and "+fr.lineWidthDims[1],Ce.commandStr),Fe},function(Fe,ct,Ge){return j.optional(function(){Fe.assert(ct,"typeof "+Ge+'==="number"&&'+Ge+">="+fr.lineWidthDims[0]+"&&"+Ge+"<="+fr.lineWidthDims[1],"invalid line width")}),Ge});case Sl:return Tt(function(Fe){return j.commandParameter(Fe,Kp,he,Ce.commandStr),Kp[Fe]},function(Fe,ct,Ge){return j.optional(function(){Fe.assert(ct,Ge+'==="cw"||'+Ge+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ct.def(Ge+'==="cw"?'+qp+":"+uf)});case Zl:return Tt(function(Fe){return j.command(Wo(Fe)&&Fe.length===4,"color.mask must be length 4 array",Ce.commandStr),Fe.map(function(ct){return!!ct})},function(Fe,ct,Ge){return j.optional(function(){Fe.assert(ct,Fe.shared.isArrayLike+"("+Ge+")&&"+Ge+".length===4","invalid color.mask")}),st(4,function(Nt){return"!!"+Ge+"["+Nt+"]"})});case gu:return Tt(function(Fe){j.command(typeof Fe=="object"&&Fe,he,Ce.commandStr);var ct="value"in Fe?Fe.value:1,Ge=!!Fe.invert;return j.command(typeof ct=="number"&&ct>=0&&ct<=1,"sample.coverage.value must be a number between 0 and 1",Ce.commandStr),[ct,Ge]},function(Fe,ct,Ge){j.optional(function(){Fe.assert(ct,Ge+"&&typeof "+Ge+'==="object"',"invalid sample.coverage")});var Nt=ct.def('"value" in ',Ge,"?+",Ge,".value:1"),qt=ct.def("!!",Ge,".invert");return[Nt,qt]})}}),ar}function Pa(Ve,Ce){var ht=Ve.static,Bt=Ve.dynamic,ar={};return Object.keys(ht).forEach(function(gt){var he=ht[gt],Tt;if(typeof he=="number"||typeof he=="boolean")Tt=To(function(){return he});else if(typeof he=="function"){var Fe=he._reglType;Fe==="texture2d"||Fe==="textureCube"?Tt=To(function(ct){return ct.link(he)}):Fe==="framebuffer"||Fe==="framebufferCube"?(j.command(he.color.length>0,'missing color attachment for framebuffer sent to uniform "'+gt+'"',Ce.commandStr),Tt=To(function(ct){return ct.link(he.color[0])})):j.commandRaise('invalid data for uniform "'+gt+'"',Ce.commandStr)}else Wo(he)?Tt=To(function(ct){var Ge=ct.global.def("[",st(he.length,function(Nt){return j.command(typeof he[Nt]=="number"||typeof he[Nt]=="boolean","invalid uniform "+gt,ct.commandStr),he[Nt]}),"]");return Ge}):j.commandRaise('invalid or missing data for uniform "'+gt+'"',Ce.commandStr);Tt.value=he,ar[gt]=Tt}),Object.keys(Bt).forEach(function(gt){var he=Bt[gt];ar[gt]=Ws(he,function(Tt,Fe){return Tt.invoke(Fe,he)})}),ar}function yu(Ve,Ce){var ht=Ve.static,Bt=Ve.dynamic,ar={};return Object.keys(ht).forEach(function(gt){var he=ht[gt],Tt=Le.id(gt),Fe=new Ft;if(bp(he))Fe.state=Ri,Fe.buffer=Nr.getBuffer(Nr.create(he,js,!1,!0)),Fe.type=0;else{var ct=Nr.getBuffer(he);if(ct)Fe.state=Ri,Fe.buffer=ct,Fe.type=0;else if(j.command(typeof he=="object"&&he,"invalid data for attribute "+gt,Ce.commandStr),"constant"in he){var Ge=he.constant;Fe.buffer="null",Fe.state=ea,typeof Ge=="number"?Fe.x=Ge:(j.command(Wo(Ge)&&Ge.length>0&&Ge.length<=4,"invalid constant for attribute "+gt,Ce.commandStr),Ji.forEach(function(En,fi){fi<Ge.length&&(Fe[En]=Ge[fi])}))}else{bp(he.buffer)?ct=Nr.getBuffer(Nr.create(he.buffer,js,!1,!0)):ct=Nr.getBuffer(he.buffer),j.command(!!ct,'missing buffer for attribute "'+gt+'"',Ce.commandStr);var Nt=he.offset|0;j.command(Nt>=0,'invalid offset for attribute "'+gt+'"',Ce.commandStr);var qt=he.stride|0;j.command(qt>=0&&qt<256,'invalid stride for attribute "'+gt+'", must be integer betweeen [0, 255]',Ce.commandStr);var Ur=he.size|0;j.command(!("size"in he)||Ur>0&&Ur<=4,'invalid size for attribute "'+gt+'", must be 1,2,3,4',Ce.commandStr);var Pn=!!he.normalized,In=0;"type"in he&&(j.commandParameter(he.type,Eu,"invalid type for attribute "+gt,Ce.commandStr),In=Eu[he.type]);var Vn=he.divisor|0;j.optional(function(){"divisor"in he&&(j.command(Vn===0||nn,'cannot specify divisor for attribute "'+gt+'", instancing not supported',Ce.commandStr),j.command(Vn>=0,'invalid divisor for attribute "'+gt+'"',Ce.commandStr));var En=Ce.commandStr,fi=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(he).forEach(function(jn){j.command(fi.indexOf(jn)>=0,'unknown parameter "'+jn+'" for attribute pointer "'+gt+'" (valid parameters are '+fi+")",En)})}),Fe.buffer=ct,Fe.state=Ri,Fe.size=Ur,Fe.normalized=Pn,Fe.type=In||ct.dtype,Fe.offset=Nt,Fe.stride=qt,Fe.divisor=Vn}}ar[gt]=To(function(En,fi){var jn=En.attribCache;if(Tt in jn)return jn[Tt];var $n={isStream:!1};return Object.keys(Fe).forEach(function(ii){$n[ii]=Fe[ii]}),Fe.buffer&&($n.buffer=En.link(Fe.buffer),$n.type=$n.type||$n.buffer+".dtype"),jn[Tt]=$n,$n})}),Object.keys(Bt).forEach(function(gt){var he=Bt[gt];function Tt(Fe,ct){var Ge=Fe.invoke(ct,he),Nt=Fe.shared,qt=Fe.constants,Ur=Nt.isBufferArgs,Pn=Nt.buffer;j.optional(function(){Fe.assert(ct,Ge+"&&(typeof "+Ge+'==="object"||typeof '+Ge+'==="function")&&('+Ur+"("+Ge+")||"+Pn+".getBuffer("+Ge+")||"+Pn+".getBuffer("+Ge+".buffer)||"+Ur+"("+Ge+'.buffer)||("constant" in '+Ge+"&&(typeof "+Ge+'.constant==="number"||'+Nt.isArrayLike+"("+Ge+".constant))))",'invalid dynamic attribute "'+gt+'"')});var In={isStream:ct.def(!1)},Vn=new Ft;Vn.state=Ri,Object.keys(Vn).forEach(function($n){In[$n]=ct.def(""+Vn[$n])});var En=In.buffer,fi=In.type;ct("if(",Ur,"(",Ge,")){",In.isStream,"=true;",En,"=",Pn,".createStream(",js,",",Ge,");",fi,"=",En,".dtype;","}else{",En,"=",Pn,".getBuffer(",Ge,");","if(",En,"){",fi,"=",En,".dtype;",'}else if("constant" in ',Ge,"){",In.state,"=",ea,";","if(typeof "+Ge+'.constant === "number"){',In[Ji[0]],"=",Ge,".constant;",Ji.slice(1).map(function($n){return In[$n]}).join("="),"=0;","}else{",Ji.map(function($n,ii){return In[$n]+"="+Ge+".constant.length>"+ii+"?"+Ge+".constant["+ii+"]:0;"}).join(""),"}}else{","if(",Ur,"(",Ge,".buffer)){",En,"=",Pn,".createStream(",js,",",Ge,".buffer);","}else{",En,"=",Pn,".getBuffer(",Ge,".buffer);","}",fi,'="type" in ',Ge,"?",qt.glTypes,"[",Ge,".type]:",En,".dtype;",In.normalized,"=!!",Ge,".normalized;");function jn($n){ct(In[$n],"=",Ge,".",$n,"|0;")}return jn("size"),jn("offset"),jn("stride"),jn("divisor"),ct("}}"),ct.exit("if(",In.isStream,"){",Pn,".destroyStream(",En,");","}"),In}ar[gt]=Ws(he,Tt)}),ar}function Mo(Ve){var Ce=Ve.static,ht=Ve.dynamic,Bt={};return Object.keys(Ce).forEach(function(ar){var gt=Ce[ar];Bt[ar]=To(function(he,Tt){return typeof gt=="number"||typeof gt=="boolean"?""+gt:he.link(gt)})}),Object.keys(ht).forEach(function(ar){var gt=ht[ar];Bt[ar]=Ws(gt,function(he,Tt){return he.invoke(Tt,gt)})}),Bt}function Io(Ve,Ce,ht,Bt,ar){var gt=Ve.static,he=Ve.dynamic;j.optional(function(){var jn=[Uu,rf,Rf,Gl,Js,rc,Yh,yp,jl,su].concat(Ti);function $n(ii){Object.keys(ii).forEach(function(Kn){j.command(jn.indexOf(Kn)>=0,'unknown parameter "'+Kn+'"',ar.commandStr)})}$n(gt),$n(he)});var Tt=ta(Ve,Ce),Fe=on(Ve,ar),ct=Ii(Ve,Fe,ar),Ge=ss(Ve,ar),Nt=ms(Ve,ar),qt=da(Ve,ar,Tt);function Ur(jn){var $n=ct[jn];$n&&(Nt[jn]=$n)}Ur(zu),Ur(si(bh));var Pn=Object.keys(Nt).length>0,In={framebuffer:Fe,draw:Ge,shader:qt,state:Nt,dirty:Pn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(In.profile=Jr(Ve,ar),In.uniforms=Pa(ht,ar),In.drawVAO=In.scopeVAO=Ge.vao,!In.drawVAO&&qt.program&&!Tt&&at.angle_instanced_arrays&&Ge.static.elements){var Vn=!0,En=qt.program.attributes.map(function(jn){var $n=Ce.static[jn];return Vn=Vn&&!!$n,$n});if(Vn&&En.length>0){var fi=rn.getVAO(rn.createVAO({attributes:En,elements:Ge.static.elements}));In.drawVAO=new oo(null,null,null,function(jn,$n){return jn.link(fi)}),In.useVAO=!0}}return Tt?In.useVAO=!0:In.attributes=yu(Ce,ar),In.context=Mo(Bt,ar),In}function Ps(Ve,Ce,ht){var Bt=Ve.shared,ar=Bt.context,gt=Ve.scope();Object.keys(ht).forEach(function(he){Ce.save(ar,"."+he);var Tt=ht[he],Fe=Tt.append(Ve,Ce);Array.isArray(Fe)?gt(ar,".",he,"=[",Fe.join(),"];"):gt(ar,".",he,"=",Fe,";")}),Ce(gt)}function uu(Ve,Ce,ht,Bt){var ar=Ve.shared,gt=ar.gl,he=ar.framebuffer,Tt;kn&&(Tt=Ce.def(ar.extensions,".webgl_draw_buffers"));var Fe=Ve.constants,ct=Fe.drawBuffer,Ge=Fe.backBuffer,Nt;ht?Nt=ht.append(Ve,Ce):Nt=Ce.def(he,".next"),Bt||Ce("if(",Nt,"!==",he,".cur){"),Ce("if(",Nt,"){",gt,".bindFramebuffer(",tp,",",Nt,".framebuffer);"),kn&&Ce(Tt,".drawBuffersWEBGL(",ct,"[",Nt,".colorAttachments.length]);"),Ce("}else{",gt,".bindFramebuffer(",tp,",null);"),kn&&Ce(Tt,".drawBuffersWEBGL(",Ge,");"),Ce("}",he,".cur=",Nt,";"),Bt||Ce("}")}function tu(Ve,Ce,ht){var Bt=Ve.shared,ar=Bt.gl,gt=Ve.current,he=Ve.next,Tt=Bt.current,Fe=Bt.next,ct=Ve.cond(Tt,".dirty");Ti.forEach(function(Ge){var Nt=si(Ge);if(!(Nt in ht.state)){var qt,Ur;if(Nt in he){qt=he[Nt],Ur=gt[Nt];var Pn=st(_n[Nt].length,function(Vn){return ct.def(qt,"[",Vn,"]")});ct(Ve.cond(Pn.map(function(Vn,En){return Vn+"!=="+Ur+"["+En+"]"}).join("||")).then(ar,".",Lr[Nt],"(",Pn,");",Pn.map(function(Vn,En){return Ur+"["+En+"]="+Vn}).join(";"),";"))}else{qt=ct.def(Fe,".",Nt);var In=Ve.cond(qt,"!==",Tt,".",Nt);ct(In),Nt in Mr?In(Ve.cond(qt).then(ar,".enable(",Mr[Nt],");").else(ar,".disable(",Mr[Nt],");"),Tt,".",Nt,"=",qt,";"):In(ar,".",Lr[Nt],"(",qt,");",Tt,".",Nt,"=",qt,";")}}}),Object.keys(ht.state).length===0&&ct(Tt,".dirty=false;"),Ce(ct)}function Es(Ve,Ce,ht,Bt){var ar=Ve.shared,gt=Ve.current,he=ar.current,Tt=ar.gl;Id(Object.keys(ht)).forEach(function(Fe){var ct=ht[Fe];if(!(Bt&&!Bt(ct))){var Ge=ct.append(Ve,Ce);if(Mr[Fe]){var Nt=Mr[Fe];Hs(ct)?Ge?Ce(Tt,".enable(",Nt,");"):Ce(Tt,".disable(",Nt,");"):Ce(Ve.cond(Ge).then(Tt,".enable(",Nt,");").else(Tt,".disable(",Nt,");")),Ce(he,".",Fe,"=",Ge,";")}else if(Wo(Ge)){var qt=gt[Fe];Ce(Tt,".",Lr[Fe],"(",Ge,");",Ge.map(function(Ur,Pn){return qt+"["+Pn+"]="+Ur}).join(";"),";")}else Ce(Tt,".",Lr[Fe],"(",Ge,");",he,".",Fe,"=",Ge,";")}})}function Qo(Ve,Ce){nn&&(Ve.instancing=Ce.def(Ve.shared.extensions,".angle_instanced_arrays"))}function ia(Ve,Ce,ht,Bt,ar){var gt=Ve.shared,he=Ve.stats,Tt=gt.current,Fe=gt.timer,ct=ht.profile;function Ge(){var jn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return jn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Nt,qt;function Ur(jn){Nt=Ce.def(),jn(Nt,"=",Ge(),";"),typeof ar=="string"?jn(he,".count+=",ar,";"):jn(he,".count++;"),en&&(Bt?(qt=Ce.def(),jn(qt,"=",Fe,".getNumPendingQueries();")):jn(Fe,".beginQuery(",he,");"))}function Pn(jn){jn(he,".cpuTime+=",Ge(),"-",Nt,";"),en&&(Bt?jn(Fe,".pushScopeStats(",qt,",",Fe,".getNumPendingQueries(),",he,");"):jn(Fe,".endQuery();"))}function In(jn){var $n=Ce.def(Tt,".profile");Ce(Tt,".profile=",jn,";"),Ce.exit(Tt,".profile=",$n,";")}var Vn;if(ct){if(Hs(ct)){ct.enable?(Ur(Ce),Pn(Ce.exit),In("true")):In("false");return}Vn=ct.append(Ve,Ce),In(Vn)}else Vn=Ce.def(Tt,".profile");var En=Ve.block();Ur(En),Ce("if(",Vn,"){",En,"}");var fi=Ve.block();Pn(fi),Ce.exit("if(",Vn,"){",fi,"}")}function Cs(Ve,Ce,ht,Bt,ar){var gt=Ve.shared;function he(Fe){switch(Fe){case _p:case Wp:case Xp:return 2;case nl:case nc:case Qh:return 3;case Sh:case ic:case Jh:return 4;default:return 1}}function Tt(Fe,ct,Ge){var Nt=gt.gl,qt=Ce.def(Fe,".location"),Ur=Ce.def(gt.attributes,"[",qt,"]"),Pn=Ge.state,In=Ge.buffer,Vn=[Ge.x,Ge.y,Ge.z,Ge.w],En=["buffer","normalized","offset","stride"];function fi(){Ce("if(!",Ur,".buffer){",Nt,".enableVertexAttribArray(",qt,");}");var $n=Ge.type,ii;if(Ge.size?ii=Ce.def(Ge.size,"||",ct):ii=ct,Ce("if(",Ur,".type!==",$n,"||",Ur,".size!==",ii,"||",En.map(function(Vi){return Ur+"."+Vi+"!=="+Ge[Vi]}).join("||"),"){",Nt,".bindBuffer(",js,",",In,".buffer);",Nt,".vertexAttribPointer(",[qt,ii,$n,Ge.normalized,Ge.stride,Ge.offset],");",Ur,".type=",$n,";",Ur,".size=",ii,";",En.map(function(Vi){return Ur+"."+Vi+"="+Ge[Vi]+";"}).join(""),"}"),nn){var Kn=Ge.divisor;Ce("if(",Ur,".divisor!==",Kn,"){",Ve.instancing,".vertexAttribDivisorANGLE(",[qt,Kn],");",Ur,".divisor=",Kn,";}")}}function jn(){Ce("if(",Ur,".buffer){",Nt,".disableVertexAttribArray(",qt,");",Ur,".buffer=null;","}if(",Ji.map(function($n,ii){return Ur+"."+$n+"!=="+Vn[ii]}).join("||"),"){",Nt,".vertexAttrib4f(",qt,",",Vn,");",Ji.map(function($n,ii){return Ur+"."+$n+"="+Vn[ii]+";"}).join(""),"}")}Pn===Ri?fi():Pn===ea?jn():(Ce("if(",Pn,"===",Ri,"){"),fi(),Ce("}else{"),jn(),Ce("}"))}Bt.forEach(function(Fe){var ct=Fe.name,Ge=ht.attributes[ct],Nt;if(Ge){if(!ar(Ge))return;Nt=Ge.append(Ve,Ce)}else{if(!ar(kd))return;var qt=Ve.scopeAttrib(ct);j.optional(function(){Ve.assert(Ce,qt+".state","missing attribute "+ct)}),Nt={},Object.keys(new Ft).forEach(function(Ur){Nt[Ur]=Ce.def(qt,".",Ur)})}Tt(Ve.link(Fe),he(Fe.info.type),Nt)})}function Na(Ve,Ce,ht,Bt,ar,gt){for(var he=Ve.shared,Tt=he.gl,Fe,ct=0;ct<Bt.length;++ct){var Ge=Bt[ct],Nt=Ge.name,qt=Ge.info.type,Ur=ht.uniforms[Nt],Pn=Ve.link(Ge),In=Pn+".location",Vn;if(Ur){if(!ar(Ur))continue;if(Hs(Ur)){var En=Ur.value;if(j.command(En!==null&&typeof En!="undefined",'missing uniform "'+Nt+'"',Ve.commandStr),qt===Yp||qt===sf){j.command(typeof En=="function"&&(qt===Yp&&(En._reglType==="texture2d"||En._reglType==="framebuffer")||qt===sf&&(En._reglType==="textureCube"||En._reglType==="framebufferCube")),"invalid texture for uniform "+Nt,Ve.commandStr);var fi=Ve.link(En._texture||En.color[0]._texture);Ce(Tt,".uniform1i(",In,",",fi+".bind());"),Ce.exit(fi,".unbind();")}else if(qt===Zu||qt===ac||qt===Lf){j.optional(function(){j.command(Wo(En),"invalid matrix for uniform "+Nt,Ve.commandStr),j.command(qt===Zu&&En.length===4||qt===ac&&En.length===9||qt===Lf&&En.length===16,"invalid length for matrix uniform "+Nt,Ve.commandStr)});var jn=Ve.global.def("new Float32Array(["+Array.prototype.slice.call(En)+"])"),$n=2;qt===ac?$n=3:qt===Lf&&($n=4),Ce(Tt,".uniformMatrix",$n,"fv(",In,",false,",jn,");")}else{switch(qt){case Tc:j.commandType(En,"number","uniform "+Nt,Ve.commandStr),Fe="1f";break;case _p:j.command(Wo(En)&&En.length===2,"uniform "+Nt,Ve.commandStr),Fe="2f";break;case nl:j.command(Wo(En)&&En.length===3,"uniform "+Nt,Ve.commandStr),Fe="3f";break;case Sh:j.command(Wo(En)&&En.length===4,"uniform "+Nt,Ve.commandStr),Fe="4f";break;case xp:j.commandType(En,"boolean","uniform "+Nt,Ve.commandStr),Fe="1i";break;case of:j.commandType(En,"number","uniform "+Nt,Ve.commandStr),Fe="1i";break;case Xp:j.command(Wo(En)&&En.length===2,"uniform "+Nt,Ve.commandStr),Fe="2i";break;case Wp:j.command(Wo(En)&&En.length===2,"uniform "+Nt,Ve.commandStr),Fe="2i";break;case Qh:j.command(Wo(En)&&En.length===3,"uniform "+Nt,Ve.commandStr),Fe="3i";break;case nc:j.command(Wo(En)&&En.length===3,"uniform "+Nt,Ve.commandStr),Fe="3i";break;case Jh:j.command(Wo(En)&&En.length===4,"uniform "+Nt,Ve.commandStr),Fe="4i";break;case ic:j.command(Wo(En)&&En.length===4,"uniform "+Nt,Ve.commandStr),Fe="4i";break}Ce(Tt,".uniform",Fe,"(",In,",",Wo(En)?Array.prototype.slice.call(En):En,");")}continue}else Vn=Ur.append(Ve,Ce)}else{if(!ar(kd))continue;Vn=Ce.def(he.uniforms,"[",Le.id(Nt),"]")}qt===Yp?(j(!Array.isArray(Vn),"must specify a scalar prop for textures"),Ce("if(",Vn,"&&",Vn,'._reglType==="framebuffer"){',Vn,"=",Vn,".color[0];","}")):qt===sf&&(j(!Array.isArray(Vn),"must specify a scalar prop for cube maps"),Ce("if(",Vn,"&&",Vn,'._reglType==="framebufferCube"){',Vn,"=",Vn,".color[0];","}")),j.optional(function(){function Vu(Wl,ah){Ve.assert(Ce,Wl,'bad data or missing for uniform "'+Nt+'".  '+ah)}function sc(Wl){j(!Array.isArray(Vn),"must not specify an array type for uniform"),Vu("typeof "+Vn+'==="'+Wl+'"',"invalid type, expected "+Wl)}function Hl(Wl,ah){Array.isArray(Vn)?j(Vn.length===Wl,"must have length "+Wl):Vu(he.isArrayLike+"("+Vn+")&&"+Vn+".length==="+Wl,"invalid vector, should have length "+Wl,Ve.commandStr)}function Dc(Wl){j(!Array.isArray(Vn),"must not specify a value type"),Vu("typeof "+Vn+'==="function"&&'+Vn+'._reglType==="texture'+(Wl===th?"2d":"Cube")+'"',"invalid texture type",Ve.commandStr)}switch(qt){case of:sc("number");break;case Wp:Hl(2,"number");break;case nc:Hl(3,"number");break;case ic:Hl(4,"number");break;case Tc:sc("number");break;case _p:Hl(2,"number");break;case nl:Hl(3,"number");break;case Sh:Hl(4,"number");break;case xp:sc("boolean");break;case Xp:Hl(2,"boolean");break;case Qh:Hl(3,"boolean");break;case Jh:Hl(4,"boolean");break;case Zu:Hl(4,"number");break;case ac:Hl(9,"number");break;case Lf:Hl(16,"number");break;case Yp:Dc(th);break;case sf:Dc(Eh);break}});var ii=1;switch(qt){case Yp:case sf:var Kn=Ce.def(Vn,"._texture");Ce(Tt,".uniform1i(",In,",",Kn,".bind());"),Ce.exit(Kn,".unbind();");continue;case of:case xp:Fe="1i";break;case Wp:case Xp:Fe="2i",ii=2;break;case nc:case Qh:Fe="3i",ii=3;break;case ic:case Jh:Fe="4i",ii=4;break;case Tc:Fe="1f";break;case _p:Fe="2f",ii=2;break;case nl:Fe="3f",ii=3;break;case Sh:Fe="4f",ii=4;break;case Zu:Fe="Matrix2fv";break;case ac:Fe="Matrix3fv";break;case Lf:Fe="Matrix4fv";break}if(Fe.charAt(0)==="M"){Ce(Tt,".uniform",Fe,"(",In,",");var Vi=Math.pow(qt-Zu+2,2),Ya=Ve.global.def("new Float32Array(",Vi,")");Array.isArray(Vn)?Ce("false,(",st(Vi,function(Vu){return Ya+"["+Vu+"]="+Vn[Vu]}),",",Ya,")"):Ce("false,(Array.isArray(",Vn,")||",Vn," instanceof Float32Array)?",Vn,":(",st(Vi,function(Vu){return Ya+"["+Vu+"]="+Vn+"["+Vu+"]"}),",",Ya,")"),Ce(");")}else if(ii>1){for(var Ls=[],Lo=[],to=0;to<ii;++to)Array.isArray(Vn)?Lo.push(Vn[to]):Lo.push(Ce.def(Vn+"["+to+"]")),gt&&Ls.push(Ce.def());gt&&Ce("if(!",Ve.batchId,"||",Ls.map(function(Vu,sc){return Vu+"!=="+Lo[sc]}).join("||"),"){",Ls.map(function(Vu,sc){return Vu+"="+Lo[sc]+";"}).join("")),Ce(Tt,".uniform",Fe,"(",In,",",Lo.join(","),");"),gt&&Ce("}")}else{if(j(!Array.isArray(Vn),"uniform value must not be an array"),gt){var ff=Ce.def();Ce("if(!",Ve.batchId,"||",ff,"!==",Vn,"){",ff,"=",Vn,";")}Ce(Tt,".uniform",Fe,"(",In,",",Vn,");"),gt&&Ce("}")}}}function Rs(Ve,Ce,ht,Bt){var ar=Ve.shared,gt=ar.gl,he=ar.draw,Tt=Bt.draw;function Fe(){var ii=Tt.elements,Kn,Vi=Ce;return ii?((ii.contextDep&&Bt.contextDynamic||ii.propDep)&&(Vi=ht),Kn=ii.append(Ve,Vi),Tt.elementsActive&&Vi("if("+Kn+")"+gt+".bindBuffer("+Pu+","+Kn+".buffer.buffer);")):(Kn=Vi.def(),Vi(Kn,"=",he,".",Gl,";","if(",Kn,"){",gt,".bindBuffer(",Pu,",",Kn,".buffer.buffer);}","else if(",ar.vao,".currentVAO){",Kn,"=",Ve.shared.elements+".getElements("+ar.vao,".currentVAO.elements);",zr?"":"if("+Kn+")"+gt+".bindBuffer("+Pu+","+Kn+".buffer.buffer);","}")),Kn}function ct(){var ii=Tt.count,Kn,Vi=Ce;return ii?((ii.contextDep&&Bt.contextDynamic||ii.propDep)&&(Vi=ht),Kn=ii.append(Ve,Vi),j.optional(function(){ii.MISSING&&Ve.assert(Ce,"false","missing vertex count"),ii.DYNAMIC&&Ve.assert(Vi,Kn+">=0","missing vertex count")})):(Kn=Vi.def(he,".",Yh),j.optional(function(){Ve.assert(Vi,Kn+">=0","missing vertex count")})),Kn}var Ge=Fe();function Nt(ii){var Kn=Tt[ii];return Kn?Kn.contextDep&&Bt.contextDynamic||Kn.propDep?Kn.append(Ve,ht):Kn.append(Ve,Ce):Ce.def(he,".",ii)}var qt=Nt(Js),Ur=Nt(rc),Pn=ct();if(typeof Pn=="number"){if(Pn===0)return}else ht("if(",Pn,"){"),ht.exit("}");var In,Vn;nn&&(In=Nt(yp),Vn=Ve.instancing);var En=Ge+".type",fi=Tt.elements&&Hs(Tt.elements)&&!Tt.vaoActive;function jn(){function ii(){ht(Vn,".drawElementsInstancedANGLE(",[qt,Pn,En,Ur+"<<(("+En+"-"+Yi+")>>1)",In],");")}function Kn(){ht(Vn,".drawArraysInstancedANGLE(",[qt,Ur,Pn,In],");")}Ge&&Ge!=="null"?fi?ii():(ht("if(",Ge,"){"),ii(),ht("}else{"),Kn(),ht("}")):Kn()}function $n(){function ii(){ht(gt+".drawElements("+[qt,Pn,En,Ur+"<<(("+En+"-"+Yi+")>>1)"]+");")}function Kn(){ht(gt+".drawArrays("+[qt,Ur,Pn]+");")}Ge&&Ge!=="null"?fi?ii():(ht("if(",Ge,"){"),ii(),ht("}else{"),Kn(),ht("}")):Kn()}nn&&(typeof In!="number"||In>=0)?typeof In=="string"?(ht("if(",In,">0){"),jn(),ht("}else if(",In,"<0){"),$n(),ht("}")):jn():$n()}function Zi(Ve,Ce,ht,Bt,ar){var gt=Hi(),he=gt.proc("body",ar);return j.optional(function(){gt.commandStr=Ce.commandStr,gt.command=gt.link(Ce.commandStr)}),nn&&(gt.instancing=he.def(gt.shared.extensions,".angle_instanced_arrays")),Ve(gt,he,ht,Bt),gt.compile().body}function Ca(Ve,Ce,ht,Bt){Qo(Ve,Ce),ht.useVAO?ht.drawVAO?Ce(Ve.shared.vao,".setVAO(",ht.drawVAO.append(Ve,Ce),");"):Ce(Ve.shared.vao,".setVAO(",Ve.shared.vao,".targetVAO);"):(Ce(Ve.shared.vao,".setVAO(null);"),Cs(Ve,Ce,ht,Bt.attributes,function(){return!0})),Na(Ve,Ce,ht,Bt.uniforms,function(){return!0},!1),Rs(Ve,Ce,Ce,ht)}function eo(Ve,Ce){var ht=Ve.proc("draw",1);Qo(Ve,ht),Ps(Ve,ht,Ce.context),uu(Ve,ht,Ce.framebuffer),tu(Ve,ht,Ce),Es(Ve,ht,Ce.state),ia(Ve,ht,Ce,!1,!0);var Bt=Ce.shader.progVar.append(Ve,ht);if(ht(Ve.shared.gl,".useProgram(",Bt,".program);"),Ce.shader.program)Ca(Ve,ht,Ce,Ce.shader.program);else{ht(Ve.shared.vao,".setVAO(null);");var ar=Ve.global.def("{}"),gt=ht.def(Bt,".id"),he=ht.def(ar,"[",gt,"]");ht(Ve.cond(he).then(he,".call(this,a0);").else(he,"=",ar,"[",gt,"]=",Ve.link(function(Tt){return Zi(Ca,Ve,Ce,Tt,1)}),"(",Bt,");",he,".call(this,a0);"))}Object.keys(Ce.state).length>0&&ht(Ve.shared.current,".dirty=true;"),Ve.shared.vao&&ht(Ve.shared.vao,".setVAO(null);")}function us(Ve,Ce,ht,Bt){Ve.batchId="a1",Qo(Ve,Ce);function ar(){return!0}Cs(Ve,Ce,ht,Bt.attributes,ar),Na(Ve,Ce,ht,Bt.uniforms,ar,!1),Rs(Ve,Ce,Ce,ht)}function Fc(Ve,Ce,ht,Bt){Qo(Ve,Ce);var ar=ht.contextDep,gt=Ce.def(),he="a0",Tt="a1",Fe=Ce.def();Ve.shared.props=Fe,Ve.batchId=gt;var ct=Ve.scope(),Ge=Ve.scope();Ce(ct.entry,"for(",gt,"=0;",gt,"<",Tt,";++",gt,"){",Fe,"=",he,"[",gt,"];",Ge,"}",ct.exit);function Nt(En){return En.contextDep&&ar||En.propDep}function qt(En){return!Nt(En)}if(ht.needsContext&&Ps(Ve,Ge,ht.context),ht.needsFramebuffer&&uu(Ve,Ge,ht.framebuffer),Es(Ve,Ge,ht.state,Nt),ht.profile&&Nt(ht.profile)&&ia(Ve,Ge,ht,!1,!0),Bt)ht.useVAO?ht.drawVAO?Nt(ht.drawVAO)?Ge(Ve.shared.vao,".setVAO(",ht.drawVAO.append(Ve,Ge),");"):ct(Ve.shared.vao,".setVAO(",ht.drawVAO.append(Ve,ct),");"):ct(Ve.shared.vao,".setVAO(",Ve.shared.vao,".targetVAO);"):(ct(Ve.shared.vao,".setVAO(null);"),Cs(Ve,ct,ht,Bt.attributes,qt),Cs(Ve,Ge,ht,Bt.attributes,Nt)),Na(Ve,ct,ht,Bt.uniforms,qt,!1),Na(Ve,Ge,ht,Bt.uniforms,Nt,!0),Rs(Ve,ct,Ge,ht);else{var Ur=Ve.global.def("{}"),Pn=ht.shader.progVar.append(Ve,Ge),In=Ge.def(Pn,".id"),Vn=Ge.def(Ur,"[",In,"]");Ge(Ve.shared.gl,".useProgram(",Pn,".program);","if(!",Vn,"){",Vn,"=",Ur,"[",In,"]=",Ve.link(function(En){return Zi(us,Ve,ht,En,2)}),"(",Pn,");}",Vn,".call(this,a0[",gt,"],",gt,");")}}function Ye(Ve,Ce){var ht=Ve.proc("batch",2);Ve.batchId="0",Qo(Ve,ht);var Bt=!1,ar=!0;Object.keys(Ce.context).forEach(function(Ur){Bt=Bt||Ce.context[Ur].propDep}),Bt||(Ps(Ve,ht,Ce.context),ar=!1);var gt=Ce.framebuffer,he=!1;gt?(gt.propDep?Bt=he=!0:gt.contextDep&&Bt&&(he=!0),he||uu(Ve,ht,gt)):uu(Ve,ht,null),Ce.state.viewport&&Ce.state.viewport.propDep&&(Bt=!0);function Tt(Ur){return Ur.contextDep&&Bt||Ur.propDep}tu(Ve,ht,Ce),Es(Ve,ht,Ce.state,function(Ur){return!Tt(Ur)}),(!Ce.profile||!Tt(Ce.profile))&&ia(Ve,ht,Ce,!1,"a1"),Ce.contextDep=Bt,Ce.needsContext=ar,Ce.needsFramebuffer=he;var Fe=Ce.shader.progVar;if(Fe.contextDep&&Bt||Fe.propDep)Fc(Ve,ht,Ce,null);else{var ct=Fe.append(Ve,ht);if(ht(Ve.shared.gl,".useProgram(",ct,".program);"),Ce.shader.program)Fc(Ve,ht,Ce,Ce.shader.program);else{ht(Ve.shared.vao,".setVAO(null);");var Ge=Ve.global.def("{}"),Nt=ht.def(ct,".id"),qt=ht.def(Ge,"[",Nt,"]");ht(Ve.cond(qt).then(qt,".call(this,a0,a1);").else(qt,"=",Ge,"[",Nt,"]=",Ve.link(function(Ur){return Zi(Fc,Ve,Ce,Ur,2)}),"(",ct,");",qt,".call(this,a0,a1);"))}}Object.keys(Ce.state).length>0&&ht(Ve.shared.current,".dirty=true;"),Ve.shared.vao&&ht(Ve.shared.vao,".setVAO(null);")}function pr(Ve,Ce){var ht=Ve.proc("scope",3);Ve.batchId="a2";var Bt=Ve.shared,ar=Bt.current;Ps(Ve,ht,Ce.context),Ce.framebuffer&&Ce.framebuffer.append(Ve,ht),Id(Object.keys(Ce.state)).forEach(function(he){var Tt=Ce.state[he],Fe=Tt.append(Ve,ht);Wo(Fe)?Fe.forEach(function(ct,Ge){ht.set(Ve.next[he],"["+Ge+"]",ct)}):ht.set(Bt.next,"."+he,Fe)}),ia(Ve,ht,Ce,!0,!0),[Gl,rc,Yh,yp,Js].forEach(function(he){var Tt=Ce.draw[he];!Tt||ht.set(Bt.draw,"."+he,""+Tt.append(Ve,ht))}),Object.keys(Ce.uniforms).forEach(function(he){var Tt=Ce.uniforms[he].append(Ve,ht);Array.isArray(Tt)&&(Tt="["+Tt.join()+"]"),ht.set(Bt.uniforms,"["+Le.id(he)+"]",Tt)}),Object.keys(Ce.attributes).forEach(function(he){var Tt=Ce.attributes[he].append(Ve,ht),Fe=Ve.scopeAttrib(he);Object.keys(new Ft).forEach(function(ct){ht.set(Fe,"."+ct,Tt[ct])})}),Ce.scopeVAO&&ht.set(Bt.vao,".targetVAO",Ce.scopeVAO.append(Ve,ht));function gt(he){var Tt=Ce.shader[he];Tt&&ht.set(Bt.shader,"."+he,Tt.append(Ve,ht))}gt(rf),gt(Rf),Object.keys(Ce.state).length>0&&(ht(ar,".dirty=true;"),ht.exit(ar,".dirty=true;")),ht("a1(",Ve.shared.context,",a0,",Ve.batchId,");")}function Vt(Ve){if(!(typeof Ve!="object"||Wo(Ve))){for(var Ce=Object.keys(Ve),ht=0;ht<Ce.length;++ht)if(bn.isDynamic(Ve[Ce[ht]]))return!0;return!1}}function qn(Ve,Ce,ht){var Bt=Ce.static[ht];if(!Bt||!Vt(Bt))return;var ar=Ve.global,gt=Object.keys(Bt),he=!1,Tt=!1,Fe=!1,ct=Ve.global.def("{}");gt.forEach(function(Nt){var qt=Bt[Nt];if(bn.isDynamic(qt)){typeof qt=="function"&&(qt=Bt[Nt]=bn.unbox(qt));var Ur=Ws(qt,null);he=he||Ur.thisDep,Fe=Fe||Ur.propDep,Tt=Tt||Ur.contextDep}else{switch(ar(ct,".",Nt,"="),typeof qt){case"number":ar(qt);break;case"string":ar('"',qt,'"');break;case"object":Array.isArray(qt)&&ar("[",qt.join(),"]");break;default:ar(Ve.link(qt));break}ar(";")}});function Ge(Nt,qt){gt.forEach(function(Ur){var Pn=Bt[Ur];if(!!bn.isDynamic(Pn)){var In=Nt.invoke(qt,Pn);qt(ct,".",Ur,"=",In,";")}})}Ce.dynamic[ht]=new bn.DynamicVariable(is,{thisDep:he,contextDep:Tt,propDep:Fe,ref:ct,append:Ge}),delete Ce.static[ht]}function Ta(Ve,Ce,ht,Bt,ar){var gt=Hi();gt.stats=gt.link(ar),Object.keys(Ce.static).forEach(function(Tt){qn(gt,Ce,Tt)}),eu.forEach(function(Tt){qn(gt,Ve,Tt)});var he=Io(Ve,Ce,ht,Bt,gt);return eo(gt,he),pr(gt,he),Ye(gt,he),y(gt.compile(),{destroy:function(){he.shader.program.destroy()}})}return{next:On,current:_n,procs:function(){var Ve=Hi(),Ce=Ve.proc("poll"),ht=Ve.proc("refresh"),Bt=Ve.block();Ce(Bt),ht(Bt);var ar=Ve.shared,gt=ar.gl,he=ar.next,Tt=ar.current;Bt(Tt,".dirty=false;"),uu(Ve,Ce),uu(Ve,ht,null,!0);var Fe;nn&&(Fe=Ve.link(nn)),at.oes_vertex_array_object&&ht(Ve.link(at.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ct=0;ct<fr.maxAttributes;++ct){var Ge=ht.def(ar.attributes,"[",ct,"]"),Nt=Ve.cond(Ge,".buffer");Nt.then(gt,".enableVertexAttribArray(",ct,");",gt,".bindBuffer(",js,",",Ge,".buffer.buffer);",gt,".vertexAttribPointer(",ct,",",Ge,".size,",Ge,".type,",Ge,".normalized,",Ge,".stride,",Ge,".offset);").else(gt,".disableVertexAttribArray(",ct,");",gt,".vertexAttrib4f(",ct,",",Ge,".x,",Ge,".y,",Ge,".z,",Ge,".w);",Ge,".buffer=null;"),ht(Nt),nn&&ht(Fe,".vertexAttribDivisorANGLE(",ct,",",Ge,".divisor);")}return ht(Ve.shared.vao,".currentVAO=null;",Ve.shared.vao,".setVAO(",Ve.shared.vao,".targetVAO);"),Object.keys(Mr).forEach(function(qt){var Ur=Mr[qt],Pn=Bt.def(he,".",qt),In=Ve.block();In("if(",Pn,"){",gt,".enable(",Ur,")}else{",gt,".disable(",Ur,")}",Tt,".",qt,"=",Pn,";"),ht(In),Ce("if(",Pn,"!==",Tt,".",qt,"){",In,"}")}),Object.keys(Lr).forEach(function(qt){var Ur=Lr[qt],Pn=_n[qt],In,Vn,En=Ve.block();if(En(gt,".",Ur,"("),Wo(Pn)){var fi=Pn.length;In=Ve.global.def(he,".",qt),Vn=Ve.global.def(Tt,".",qt),En(st(fi,function(jn){return In+"["+jn+"]"}),");",st(fi,function(jn){return Vn+"["+jn+"]="+In+"["+jn+"];"}).join("")),Ce("if(",st(fi,function(jn){return In+"["+jn+"]!=="+Vn+"["+jn+"]"}).join("||"),"){",En,"}")}else In=Bt.def(he,".",qt),Vn=Bt.def(Tt,".",qt),En(In,");",Tt,".",qt,"=",In,";"),Ce("if(",In,"!==",Vn,"){",En,"}");ht(En)}),Ve.compile()}(),compile:Ta}}function Jd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Pd=34918,Qp=34919,Jp=35007,e0=function(H,Le){if(!Le.ext_disjoint_timer_query)return null;var at=[];function fr(){return at.pop()||Le.ext_disjoint_timer_query.createQueryEXT()}function Nr(nn){at.push(nn)}var ur=[];function Tr(nn){var kn=fr();Le.ext_disjoint_timer_query.beginQueryEXT(Jp,kn),ur.push(kn),en(ur.length-1,ur.length,nn)}function Vr(){Le.ext_disjoint_timer_query.endQueryEXT(Jp)}function qr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var rn=[];function pn(){return rn.pop()||new qr}function dn(nn){rn.push(nn)}var An=[];function en(nn,kn,zr){var _n=pn();_n.startQueryIndex=nn,_n.endQueryIndex=kn,_n.sum=0,_n.stats=zr,An.push(_n)}var fn=[],Ft=[];function mr(){var nn,kn,zr=ur.length;if(zr!==0){Ft.length=Math.max(Ft.length,zr+1),fn.length=Math.max(fn.length,zr+1),fn[0]=0,Ft[0]=0;var _n=0;for(nn=0,kn=0;kn<ur.length;++kn){var On=ur[kn];Le.ext_disjoint_timer_query.getQueryObjectEXT(On,Qp)?(_n+=Le.ext_disjoint_timer_query.getQueryObjectEXT(On,Pd),Nr(On)):ur[nn++]=On,fn[kn+1]=_n,Ft[kn+1]=nn}for(ur.length=nn,nn=0,kn=0;kn<An.length;++kn){var Ti=An[kn],Mr=Ti.startQueryIndex,Lr=Ti.endQueryIndex;Ti.sum+=fn[Lr]-fn[Mr];var si=Ft[Mr],Ln=Ft[Lr];Ln===si?(Ti.stats.gpuTime+=Ti.sum/1e6,dn(Ti)):(Ti.startQueryIndex=si,Ti.endQueryIndex=Ln,An[nn++]=Ti)}An.length=nn}}return{beginQuery:Tr,endQuery:Vr,pushScopeStats:en,update:mr,getNumPendingQueries:function(){return ur.length},clear:function(){at.push.apply(at,ur);for(var nn=0;nn<at.length;nn++)Le.ext_disjoint_timer_query.deleteQueryEXT(at[nn]);ur.length=0,at.length=0},restore:function(){ur.length=0,at.length=0}}},t0=16384,ed=256,Ep=1024,r0=34962,Ff="webglcontextlost",xo="webglcontextrestored",Rd=1,Oc=2,ih=3;function Ld(H,Le){for(var at=0;at<H.length;++at)if(H[at]===Le)return at;return-1}function td(H){var Le=ke(H);if(!Le)return null;var at=Le.gl,fr=at.getContextAttributes(),Nr=at.isContextLost(),ur=qe(at,Le);if(!ur)return null;var Tr=oa(),Vr=Jd(),qr=ur.extensions,rn=e0(at,qr),pn=Ha(),dn=at.drawingBufferWidth,An=at.drawingBufferHeight,en={tick:0,time:0,viewportWidth:dn,viewportHeight:An,framebufferWidth:dn,framebufferHeight:An,drawingBufferWidth:dn,drawingBufferHeight:An,pixelRatio:Le.pixelRatio},fn={},Ft={elements:null,primitive:4,count:-1,offset:0,instances:-1},mr=sl(at,qr),nn=G(at,Vr,Le,_n),kn=dc(at,qr,nn,Vr),zr=Ht(at,qr,mr,Vr,nn,kn,Ft);function _n(Zi){return zr.destroyBuffer(Zi)}var On=xn(at,Tr,Vr,Le),Ti=mu(at,qr,mr,function(){si.procs.poll()},en,Vr,Le),Mr=Qf(at,qr,mr,Vr,Le),Lr=Je(at,qr,mr,Ti,Mr,Vr),si=Lc(at,Tr,qr,mr,nn,kn,Ti,Lr,fn,zr,On,Ft,en,rn,Le),Ln=Ei(at,Lr,si.procs.poll,en,fr,qr,mr),tn=si.next,Bn=at.canvas,Un=[],ca=[],Hi=[],Jr=[Le.onDestroy],on=null;function Ii(){if(Un.length===0){rn&&rn.update(),on=null;return}on=Oi.next(Ii),Qo();for(var Zi=Un.length-1;Zi>=0;--Zi){var Ca=Un[Zi];Ca&&Ca(en,null,0)}at.flush(),rn&&rn.update()}function ta(){!on&&Un.length>0&&(on=Oi.next(Ii))}function da(){on&&(Oi.cancel(Ii),on=null)}function ss(Zi){Zi.preventDefault(),Nr=!0,da(),ca.forEach(function(Ca){Ca()})}function ms(Zi){at.getError(),Nr=!1,ur.restore(),On.restore(),nn.restore(),Ti.restore(),Mr.restore(),Lr.restore(),zr.restore(),rn&&rn.restore(),si.procs.refresh(),ta(),Hi.forEach(function(Ca){Ca()})}var Pa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Pa&&Bn&&(Bn.addEventListener(Ff,ss,!1),Bn.addEventListener(xo,ms,!1));function yu(){Un.length=0,da(),!Pa&&Bn&&(Bn.removeEventListener(Ff,ss),Bn.removeEventListener(xo,ms)),On.clear(),Lr.clear(),Mr.clear(),zr.clear(),Ti.clear(),kn.clear(),nn.clear(),rn&&rn.clear(),Jr.forEach(function(Zi){Zi()})}function Mo(Zi){j(!!Zi,"invalid args to regl({...})"),j.type(Zi,"object","invalid args to regl({...})");function Ca(gt){var he=y({},gt);delete he.uniforms,delete he.attributes,delete he.context,delete he.vao,"stencil"in he&&he.stencil.op&&(he.stencil.opBack=he.stencil.opFront=he.stencil.op,delete he.stencil.op);function Tt(Fe){if(Fe in he){var ct=he[Fe];delete he[Fe],Object.keys(ct).forEach(function(Ge){he[Fe+"."+Ge]=ct[Ge]})}}return Tt("blend"),Tt("depth"),Tt("cull"),Tt("stencil"),Tt("polygonOffset"),Tt("scissor"),Tt("sample"),"vao"in gt&&(he.vao=gt.vao),he}function eo(gt,he){var Tt={},Fe={};return Object.keys(gt).forEach(function(ct){var Ge=gt[ct];if(bn.isDynamic(Ge)){Fe[ct]=bn.unbox(Ge,ct);return}else if(he&&Array.isArray(Ge)){for(var Nt=0;Nt<Ge.length;++Nt)if(bn.isDynamic(Ge[Nt])){Fe[ct]=bn.unbox(Ge,ct);return}}Tt[ct]=Ge}),{dynamic:Fe,static:Tt}}var us=eo(Zi.context||{},!0),Fc=eo(Zi.uniforms||{},!0),Ye=eo(Zi.attributes||{},!1),pr=eo(Ca(Zi),!1),Vt={gpuTime:0,cpuTime:0,count:0},qn=si.compile(pr,Ye,Fc,us,Vt),Ta=qn.draw,Ve=qn.batch,Ce=qn.scope,ht=[];function Bt(gt){for(;ht.length<gt;)ht.push(null);return ht}function ar(gt,he){var Tt;if(Nr&&j.raise("context lost"),typeof gt=="function")return Ce.call(this,null,gt,0);if(typeof he=="function")if(typeof gt=="number")for(Tt=0;Tt<gt;++Tt)Ce.call(this,null,he,Tt);else if(Array.isArray(gt))for(Tt=0;Tt<gt.length;++Tt)Ce.call(this,gt[Tt],he,Tt);else return Ce.call(this,gt,he,0);else if(typeof gt=="number"){if(gt>0)return Ve.call(this,Bt(gt|0),gt|0)}else if(Array.isArray(gt)){if(gt.length)return Ve.call(this,gt,gt.length)}else return Ta.call(this,gt)}return y(ar,{stats:Vt,destroy:function(){qn.destroy()}})}var Io=Lr.setFBO=Mo({framebuffer:bn.define.call(null,Rd,"framebuffer")});function Ps(Zi,Ca){var eo=0;si.procs.poll();var us=Ca.color;us&&(at.clearColor(+us[0]||0,+us[1]||0,+us[2]||0,+us[3]||0),eo|=t0),"depth"in Ca&&(at.clearDepth(+Ca.depth),eo|=ed),"stencil"in Ca&&(at.clearStencil(Ca.stencil|0),eo|=Ep),j(!!eo,"called regl.clear with no buffer specified"),at.clear(eo)}function uu(Zi){if(j(typeof Zi=="object"&&Zi,"regl.clear() takes an object as input"),"framebuffer"in Zi)if(Zi.framebuffer&&Zi.framebuffer_reglType==="framebufferCube")for(var Ca=0;Ca<6;++Ca)Io(y({framebuffer:Zi.framebuffer.faces[Ca]},Zi),Ps);else Io(Zi,Ps);else Ps(null,Zi)}function tu(Zi){j.type(Zi,"function","regl.frame() callback must be a function"),Un.push(Zi);function Ca(){var eo=Ld(Un,Zi);j(eo>=0,"cannot cancel a frame twice");function us(){var Fc=Ld(Un,us);Un[Fc]=Un[Un.length-1],Un.length-=1,Un.length<=0&&da()}Un[eo]=us}return ta(),{cancel:Ca}}function Es(){var Zi=tn.viewport,Ca=tn.scissor_box;Zi[0]=Zi[1]=Ca[0]=Ca[1]=0,en.viewportWidth=en.framebufferWidth=en.drawingBufferWidth=Zi[2]=Ca[2]=at.drawingBufferWidth,en.viewportHeight=en.framebufferHeight=en.drawingBufferHeight=Zi[3]=Ca[3]=at.drawingBufferHeight}function Qo(){en.tick+=1,en.time=Cs(),Es(),si.procs.poll()}function ia(){Ti.refresh(),Es(),si.procs.refresh(),rn&&rn.update()}function Cs(){return(Ha()-pn)/1e3}ia();function Na(Zi,Ca){j.type(Ca,"function","listener callback must be a function");var eo;switch(Zi){case"frame":return tu(Ca);case"lost":eo=ca;break;case"restore":eo=Hi;break;case"destroy":eo=Jr;break;default:j.raise("invalid event, must be one of frame,lost,restore,destroy")}return eo.push(Ca),{cancel:function(){for(var us=0;us<eo.length;++us)if(eo[us]===Ca){eo[us]=eo[eo.length-1],eo.pop();return}}}}var Rs=y(Mo,{clear:uu,prop:bn.define.bind(null,Rd),context:bn.define.bind(null,Oc),this:bn.define.bind(null,ih),draw:Mo({}),buffer:function(Zi){return nn.create(Zi,r0,!1,!1)},elements:function(Zi){return kn.create(Zi,!1)},texture:Ti.create2D,cube:Ti.createCube,renderbuffer:Mr.create,framebuffer:Lr.create,framebufferCube:Lr.createCube,vao:zr.createVAO,attributes:fr,frame:tu,on:Na,limits:mr,hasExtension:function(Zi){return mr.extensions.indexOf(Zi.toLowerCase())>=0},read:Ln,destroy:yu,_gl:at,_refresh:ia,poll:function(){Qo(),rn&&rn.update()},now:Cs,stats:Vr});return Le.onDone(null,Rs),Rs}return td})},6158:function(hi){(function(Ae,fe){hi.exports=fe()})(this,function(){"use strict";var Ae,fe,We;function de(y,Ne){if(!Ae)Ae=Ne;else if(!fe)fe=Ne;else{var K="var sharedChunk = {}; ("+Ae+")(sharedChunk); ("+fe+")(sharedChunk);",Re={};Ae(Re),We=Ne(Re),typeof window!="undefined"&&(We.workerUrl=window.URL.createObjectURL(new Blob([K],{type:"text/javascript"})))}}return de(["exports"],function(y){"use strict";function Ne(n,s){return n(s={exports:{}},s.exports),s.exports}var K=Re;function Re(n,s,l,d){this.cx=3*n,this.bx=3*(l-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=d,this.p2x=l,this.p2y=d}Re.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},Re.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},Re.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},Re.prototype.solveCurveX=function(n,s){var l,d,x,C,T;for(s===void 0&&(s=1e-6),x=n,T=0;T<8;T++){if(C=this.sampleCurveX(x)-n,Math.abs(C)<s)return x;var L=this.sampleCurveDerivativeX(x);if(Math.abs(L)<1e-6)break;x-=C/L}if((x=n)<(l=0))return l;if(x>(d=1))return d;for(;l<d;){if(C=this.sampleCurveX(x),Math.abs(C-n)<s)return x;n>C?l=x:d=x,x=.5*(d-l)+l}return x},Re.prototype.solve=function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))};var pe=lt;function lt(n,s){this.x=n,this.y=s}lt.prototype={clone:function(){return new lt(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,s){return this.clone()._rotateAround(n,s)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var s=n.x-this.x,l=n.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,s){return Math.atan2(this.x*s-this.y*n,this.x*n+this.y*s)},_matMult:function(n){var s=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=s,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var s=Math.cos(n),l=Math.sin(n),d=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=d,this},_rotateAround:function(n,s){var l=Math.cos(n),d=Math.sin(n),x=s.y+d*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-d*(this.y-s.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},lt.convert=function(n){return n instanceof lt?n:Array.isArray(n)?new lt(n[0],n[1]):n};var we=typeof self!="undefined"?self:{},Xe=Math.pow(2,53)-1;function Ct(n,s,l,d){var x=new K(n,s,l,d);return function(C){return x.solve(C)}}var Pt=Ct(.25,.1,.25,1);function tr(n,s,l){return Math.min(l,Math.max(s,n))}function Yt(n,s,l){var d=l-s,x=((n-s)%d+d)%d+s;return x===s?l:x}function Wt(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var d=0,x=s;d<x.length;d+=1){var C=x[d];for(var T in C)n[T]=C[T]}return n}var br=1;function lr(){return br++}function kt(){return function n(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function zt(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Pr(n,s){n.forEach(function(l){s[l]&&(s[l]=s[l].bind(s))})}function re(n,s){return n.indexOf(s,n.length-s.length)!==-1}function yr(n,s,l){var d={};for(var x in n)d[x]=s.call(l||this,n[x],x,n);return d}function Rt(n,s,l){var d={};for(var x in n)s.call(l||this,n[x],x,n)&&(d[x]=n[x]);return d}function _t(n){return Array.isArray(n)?n.map(_t):typeof n=="object"&&n?yr(n,_t):n}var Kt={};function Ue(n){Kt[n]||(typeof console!="undefined"&&console.warn(n),Kt[n]=!0)}function Er(n,s,l){return(l.y-n.y)*(s.x-n.x)>(s.y-n.y)*(l.x-n.x)}function an(n){for(var s=0,l=0,d=n.length,x=d-1,C=void 0,T=void 0;l<d;x=l++)s+=((T=n[x]).x-(C=n[l]).x)*(C.y+T.y);return s}function ue(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function rt(n){var s={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(d,x,C,T){var L=C||T;return s[x]=!L||L.toLowerCase(),""}),s["max-age"]){var l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}var Z=null;function _e(n){if(Z==null){var s=n.navigator?n.navigator.userAgent:null;Z=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Z}function ze(n){try{var s=we[n];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(l){return!1}}var St,Ut,cr,wt,Or=we.performance&&we.performance.now?we.performance.now.bind(we.performance):Date.now.bind(Date),Xn=we.requestAnimationFrame||we.mozRequestAnimationFrame||we.webkitRequestAnimationFrame||we.msRequestAnimationFrame,Qr=we.cancelAnimationFrame||we.mozCancelAnimationFrame||we.webkitCancelAnimationFrame||we.msCancelAnimationFrame,Pi={now:Or,frame:function(n){var s=Xn(n);return{cancel:function(){return Qr(s)}}},getImageData:function(n,s){s===void 0&&(s=0);var l=we.document.createElement("canvas"),d=l.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return l.width=n.width,l.height=n.height,d.drawImage(n,0,0,n.width,n.height),d.getImageData(-s,-s,n.width+2*s,n.height+2*s)},resolveURL:function(n){return St||(St=we.document.createElement("a")),St.href=n,St.href},hardwareConcurrency:we.navigator&&we.navigator.hardwareConcurrency||4,get devicePixelRatio(){return we.devicePixelRatio},get prefersReducedMotion(){return!!we.matchMedia&&(Ut==null&&(Ut=we.matchMedia("(prefers-reduced-motion: reduce)")),Ut.matches)}},mi={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ln={supported:!1,testSupport:function(n){!ba&&wt&&(ua?Li(n):cr=n)}},ba=!1,ua=!1;function Li(n){var s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,wt),n.isContextLost())return;ln.supported=!0}catch(l){}n.deleteTexture(s),ba=!0}we.document&&((wt=we.document.createElement("img")).onload=function(){cr&&Li(cr),cr=null,ua=!0},wt.onerror=function(){ba=!0,cr=null},wt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ma="01",ai=function(n,s){this._transformRequestFn=n,this._customAccessToken=s,this._createSkuToken()};function Ki(n){return n.indexOf("mapbox:")===0}ai.prototype._createSkuToken=function(){var n=function(){for(var s="",l=0;l<10;l++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ma,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt},ai.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ai.prototype.transformRequest=function(n,s){return this._transformRequestFn&&this._transformRequestFn(n,s)||{url:n}},ai.prototype.normalizeStyleURL=function(n,s){if(!Ki(n))return n;var l=go(n);return l.path="/styles/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},ai.prototype.normalizeGlyphsURL=function(n,s){if(!Ki(n))return n;var l=go(n);return l.path="/fonts/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},ai.prototype.normalizeSourceURL=function(n,s){if(!Ki(n))return n;var l=go(n);return l.path="/v4/"+l.authority+".json",l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||s)},ai.prototype.normalizeSpriteURL=function(n,s,l,d){var x=go(n);return Ki(n)?(x.path="/styles/v1"+x.path+"/sprite"+s+l,this._makeAPIURL(x,this._customAccessToken||d)):(x.path+=""+s+l,no(x))},ai.prototype.normalizeTileURL=function(n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!Ki(n))return n;var l=go(n);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Pi.devicePixelRatio>=2||s===512?"@2x":"")+(ln.supported?".webp":"$1")),l.path=l.path.replace(/^.+\/v4\//,"/"),l.path="/v4"+l.path;var d=this._customAccessToken||function(x){for(var C=0,T=x;C<T.length;C+=1){var L=T[C].match(/^access_token=(.*)$/);if(L)return L[1]}return null}(l.params)||mi.ACCESS_TOKEN;return mi.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&l.params.push("sku="+this._skuToken),this._makeAPIURL(l,d)},ai.prototype.canonicalizeTileURL=function(n,s){var l=go(n);if(!l.path.match(/(^\/v4\/)/)||!l.path.match(/\.[\w]+$/))return n;var d="mapbox://tiles/";d+=l.path.replace("/v4/","");var x=l.params;return s&&(x=x.filter(function(C){return!C.match(/^access_token=/)})),x.length&&(d+="?"+x.join("&")),d},ai.prototype.canonicalizeTileset=function(n,s){for(var l=!!s&&Ki(s),d=[],x=0,C=n.tiles||[];x<C.length;x+=1){var T=C[x];gi(T)?d.push(this.canonicalizeTileURL(T,l)):d.push(T)}return d},ai.prototype._makeAPIURL=function(n,s){var l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=go(mi.API_URL);if(n.protocol=d.protocol,n.authority=d.authority,n.protocol==="http"){var x=n.params.indexOf("secure");x>=0&&n.params.splice(x,1)}if(d.path!=="/"&&(n.path=""+d.path+n.path),!mi.REQUIRE_ACCESS_TOKEN)return no(n);if(!(s=s||mi.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+l);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+l);return n.params=n.params.filter(function(C){return C.indexOf("access_token")===-1}),n.params.push("access_token="+s),no(n)};var ci=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function gi(n){return ci.test(n)}var zo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function go(n){var s=n.match(zo);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function no(n){var s=n.params.length?"?"+n.params.join("&"):"";return n.protocol+"://"+n.authority+n.path+s}function It(n){if(!n)return null;var s=n.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(we.atob(s[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(l){return null}}var ge=function(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};ge.prototype.getStorageKey=function(n){var s,l=It(mi.ACCESS_TOKEN);return s=l&&l.u?we.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,function(d,x){return String.fromCharCode(Number("0x"+x))})):mi.ACCESS_TOKEN||"",n?"mapbox.eventData."+n+":"+s:"mapbox.eventData:"+s},ge.prototype.fetchEventData=function(){var n=ze("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{var d=we.localStorage.getItem(s);d&&(this.eventData=JSON.parse(d));var x=we.localStorage.getItem(l);x&&(this.anonId=x)}catch(C){Ue("Unable to read from LocalStorage")}},ge.prototype.saveEventData=function(){var n=ze("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{we.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&we.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(d){Ue("Unable to write to LocalStorage")}},ge.prototype.processRequests=function(n){},ge.prototype.postEvent=function(n,s,l,d){var x=this;if(mi.EVENTS_URL){var C=go(mi.EVENTS_URL);C.params.push("access_token="+(d||mi.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Ma,userId:this.anonId},L=s?Wt(T,s):T,U={url:no(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([L])};this.pendingRequest=la(U,function(X){x.pendingRequest=null,l(X),x.saveEventData(),x.processRequests(d)})}},ge.prototype.queueRequest=function(n,s){this.queue.push(n),this.processRequests(s)};var oe,Te,j=function(n){function s(){n.call(this,"map.load"),this.success={},this.skuToken=""}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(l,d,x,C){this.skuToken=x,(mi.EVENTS_URL&&C||mi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(T){return Ki(T)||gi(T)}))&&this.queueRequest({id:d,timestamp:Date.now()},C)},s.prototype.processRequests=function(l){var d=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),C=x.id,T=x.timestamp;C&&this.success[C]||(this.anonId||this.fetchEventData(),zt(this.anonId)||(this.anonId=kt()),this.postEvent(T,{skuToken:this.skuToken},function(L){L||C&&(d.success[C]=!0)},l))}},s}(ge),ot=new(function(n){function s(l){n.call(this,"appUserTurnstile"),this._customAccessToken=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(l,d){mi.EVENTS_URL&&mi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(x){return Ki(x)||gi(x)})&&this.queueRequest(Date.now(),d)},s.prototype.processRequests=function(l){var d=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=It(mi.ACCESS_TOKEN),C=x?x.u:mi.ACCESS_TOKEN,T=C!==this.eventData.tokenU;zt(this.anonId)||(this.anonId=kt(),T=!0);var L=this.queue.shift();if(this.eventData.lastSuccess){var U=new Date(this.eventData.lastSuccess),X=new Date(L),$=(L-this.eventData.lastSuccess)/864e5;T=T||$>=1||$<-1||U.getDate()!==X.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(L,{"enabled.telemetry":!1},function(ee){ee||(d.eventData.lastSuccess=L,d.eventData.tokenU=C)},l)}},s}(ge)),sr=ot.postTurnstileEvent.bind(ot),Yr=new j,Ke=Yr.postMapLoadEvent.bind(Yr),Dt=500,Cr=50;function _r(){we.caches&&!oe&&(oe=we.caches.open("mapbox-tiles"))}function Rr(n){var s=n.indexOf("?");return s<0?n:n.slice(0,s)}var mn,vi=1/0;function ni(){return mn==null&&(mn=we.OffscreenCanvas&&new we.OffscreenCanvas(1,1).getContext("2d")&&typeof we.createImageBitmap=="function"),mn}var bn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(bn);var Oi=function(n){function s(l,d,x){d===401&&gi(x)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),n.call(this,l),this.status=d,this.url=x,this.name=this.constructor.name,this.message=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),Ni=ue()?function(){return self.worker&&self.worker.referrer}:function(){return(we.location.protocol==="blob:"?we.parent:we).location.href},Ha,oa,Wa=function(n,s){if(!(/^file:/.test(l=n.url)||/^file:/.test(Ni())&&!/^\w+:/.test(l))){if(we.fetch&&we.Request&&we.AbortController&&we.Request.prototype.hasOwnProperty("signal"))return function(d,x){var C,T=new we.AbortController,L=new we.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Ni(),signal:T.signal}),U=!1,X=!1,$=(C=L.url).indexOf("sku=")>0&&gi(C);d.type==="json"&&L.headers.set("Accept","application/json");var ee=function(Ee,$e,et){if(!X){if(Ee&&Ee.message!=="SecurityError"&&Ue(Ee),$e&&et)return le($e);var mt=Date.now();we.fetch(L).then(function(ut){if(ut.ok){var Ot=$?ut.clone():null;return le(ut,Ot,mt)}return x(new Oi(ut.statusText,ut.status,d.url))}).catch(function(ut){ut.code!==20&&x(new Error(ut.message))})}},le=function(Ee,$e,et){(d.type==="arrayBuffer"?Ee.arrayBuffer():d.type==="json"?Ee.json():Ee.text()).then(function(mt){X||($e&&et&&function(ut,Ot,$t){if(_r(),oe){var dr={status:Ot.status,statusText:Ot.statusText,headers:new we.Headers};Ot.headers.forEach(function(Dr,hn){return dr.headers.set(hn,Dr)});var gr=rt(Ot.headers.get("Cache-Control")||"");gr["no-store"]||(gr["max-age"]&&dr.headers.set("Expires",new Date($t+1e3*gr["max-age"]).toUTCString()),new Date(dr.headers.get("Expires")).getTime()-$t<42e4||function(Dr,hn){if(Te===void 0)try{new Response(new ReadableStream),Te=!0}catch(zn){Te=!1}Te?hn(Dr.body):Dr.blob().then(hn)}(Ot,function(Dr){var hn=new we.Response(Dr,dr);_r(),oe&&oe.then(function(zn){return zn.put(Rr(ut.url),hn)}).catch(function(zn){return Ue(zn.message)})}))}}(L,$e,et),U=!0,x(null,mt,Ee.headers.get("Cache-Control"),Ee.headers.get("Expires")))}).catch(function(mt){X||x(new Error(mt.message))})};return $?function(Ee,$e){if(_r(),!oe)return $e(null);var et=Rr(Ee.url);oe.then(function(mt){mt.match(et).then(function(ut){var Ot=function($t){if(!$t)return!1;var dr=new Date($t.headers.get("Expires")||0),gr=rt($t.headers.get("Cache-Control")||"");return dr>Date.now()&&!gr["no-cache"]}(ut);mt.delete(et),Ot&&mt.put(et,ut.clone()),$e(null,ut,Ot)}).catch($e)}).catch($e)}(L,ee):ee(null,null),{cancel:function(){X=!0,U||T.abort()}}}(n,s);if(ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,s,void 0,!0)}var l;return function(d,x){var C=new we.XMLHttpRequest;for(var T in C.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(C.responseType="arraybuffer"),d.headers)C.setRequestHeader(T,d.headers[T]);return d.type==="json"&&(C.responseType="text",C.setRequestHeader("Accept","application/json")),C.withCredentials=d.credentials==="include",C.onerror=function(){x(new Error(C.statusText))},C.onload=function(){if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){var L=C.response;if(d.type==="json")try{L=JSON.parse(C.response)}catch(U){return x(U)}x(null,L,C.getResponseHeader("Cache-Control"),C.getResponseHeader("Expires"))}else x(new Oi(C.statusText,C.status,d.url))},C.send(d.body),{cancel:function(){return C.abort()}}}(n,s)},Ci=function(n,s){return Wa(Wt(n,{type:"arrayBuffer"}),s)},la=function(n,s){return Wa(Wt(n,{method:"POST"}),s)},Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ha=[],oa=0;var ae=function(n,s){if(ln.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),oa>=mi.MAX_PARALLEL_IMAGE_REQUESTS){var l={requestParameters:n,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ha.push(l),l}oa++;var d=!1,x=function(){if(!d)for(d=!0,oa--;Ha.length&&oa<mi.MAX_PARALLEL_IMAGE_REQUESTS;){var T=Ha.shift();T.cancelled||(T.cancel=ae(T.requestParameters,T.callback).cancel)}},C=Ci(n,function(T,L,U,X){x(),T?s(T):L&&(ni()?function($,ee){var le=new we.Blob([new Uint8Array($)],{type:"image/png"});we.createImageBitmap(le).then(function(Ee){ee(null,Ee)}).catch(function(Ee){ee(new Error("Could not load image because of "+Ee.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(L,s):function($,ee,le,Ee){var $e=new we.Image,et=we.URL;$e.onload=function(){ee(null,$e),et.revokeObjectURL($e.src),$e.onload=null,we.requestAnimationFrame(function(){$e.src=Q})},$e.onerror=function(){return ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var mt=new we.Blob([new Uint8Array($)],{type:"image/png"});$e.cacheControl=le,$e.expires=Ee,$e.src=$.byteLength?et.createObjectURL(mt):Q}(L,s,U,X))});return{cancel:function(){C.cancel(),x()}}};function me(n,s,l){l[n]&&l[n].indexOf(s)!==-1||(l[n]=l[n]||[],l[n].push(s))}function ke(n,s,l){if(l&&l[n]){var d=l[n].indexOf(s);d!==-1&&l[n].splice(d,1)}}var qe=function(n,s){s===void 0&&(s={}),Wt(this,s),this.type=n},st=function(n){function s(l,d){d===void 0&&(d={}),n.call(this,"error",Wt({error:l},d))}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(qe),xt=function(){};xt.prototype.on=function(n,s){return this._listeners=this._listeners||{},me(n,s,this._listeners),this},xt.prototype.off=function(n,s){return ke(n,s,this._listeners),ke(n,s,this._oneTimeListeners),this},xt.prototype.once=function(n,s){return this._oneTimeListeners=this._oneTimeListeners||{},me(n,s,this._oneTimeListeners),this},xt.prototype.fire=function(n,s){typeof n=="string"&&(n=new qe(n,s||{}));var l=n.type;if(this.listens(l)){n.target=this;for(var d=0,x=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];d<x.length;d+=1)x[d].call(this,n);for(var C=0,T=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];C<T.length;C+=1){var L=T[C];ke(l,L,this._oneTimeListeners),L.call(this,n)}var U=this._eventedParent;U&&(Wt(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),U.fire(n))}else n instanceof st&&console.error(n.error);return this},xt.prototype.listens=function(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)},xt.prototype.setEventedParent=function(n,s){return this._eventedParent=n,this._eventedParentData=s,this};var Me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},it=function(n,s,l,d){this.message=(n?n+": ":"")+l,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)};function Gt(n){var s=n.value;return s?[new it(n.key,s,"constants have been deprecated as of v8")]:[]}function Zr(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var d=0,x=s;d<x.length;d+=1){var C=x[d];for(var T in C)n[T]=C[T]}return n}function or(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function hr(n){if(Array.isArray(n))return n.map(hr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){var s={};for(var l in n)s[l]=hr(n[l]);return s}return or(n)}var jr=function(n){function s(l,d){n.call(this,d),this.message=d,this.key=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(Error),oi=function(n,s){s===void 0&&(s=[]),this.parent=n,this.bindings={};for(var l=0,d=s;l<d.length;l+=1){var x=d[l];this.bindings[x[0]]=x[1]}};oi.prototype.concat=function(n){return new oi(this,n)},oi.prototype.get=function(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(n+" not found in scope.")},oi.prototype.has=function(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)};var Sn={kind:"null"},Jt={kind:"number"},Hn={kind:"string"},wn={kind:"boolean"},Tn={kind:"color"},sa={kind:"object"},Ir={kind:"value"},qi={kind:"collator"},La={kind:"formatted"},na={kind:"resolvedImage"};function pa(n,s){return{kind:"array",itemType:n,N:s}}function Lt(n){if(n.kind==="array"){var s=Lt(n.itemType);return typeof n.N=="number"?"array<"+s+", "+n.N+">":n.itemType.kind==="value"?"array":"array<"+s+">"}return n.kind}var At=[Sn,Jt,Hn,wn,Tn,La,sa,pa(Ir),na];function Qi(n,s){if(s.kind==="error")return null;if(n.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Qi(n.itemType,s.itemType))&&(typeof n.N!="number"||n.N===s.N))return null}else{if(n.kind===s.kind)return null;if(n.kind==="value"){for(var l=0,d=At;l<d.length;l+=1)if(!Qi(d[l],s))return null}}return"Expected "+Lt(n)+" but found "+Lt(s)+" instead."}function fo(n,s){return s.some(function(l){return l.kind===n.kind})}function Ba(n,s){return s.some(function(l){return l==="null"?n===null:l==="array"?Array.isArray(n):l==="object"?n&&!Array.isArray(n)&&typeof n=="object":l===typeof n})}var zi=Ne(function(n,s){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(L){return(L=Math.round(L))<0?0:L>255?255:L}function x(L){return d(L[L.length-1]==="%"?parseFloat(L)/100*255:parseInt(L))}function C(L){return(U=L[L.length-1]==="%"?parseFloat(L)/100:parseFloat(L))<0?0:U>1?1:U;var U}function T(L,U,X){return X<0?X+=1:X>1&&(X-=1),6*X<1?L+(U-L)*X*6:2*X<1?U:3*X<2?L+(U-L)*(2/3-X)*6:L}try{s.parseCSSColor=function(L){var U,X=L.replace(/ /g,"").toLowerCase();if(X in l)return l[X].slice();if(X[0]==="#")return X.length===4?(U=parseInt(X.substr(1),16))>=0&&U<=4095?[(3840&U)>>4|(3840&U)>>8,240&U|(240&U)>>4,15&U|(15&U)<<4,1]:null:X.length===7&&(U=parseInt(X.substr(1),16))>=0&&U<=16777215?[(16711680&U)>>16,(65280&U)>>8,255&U,1]:null;var $=X.indexOf("("),ee=X.indexOf(")");if($!==-1&&ee+1===X.length){var le=X.substr(0,$),Ee=X.substr($+1,ee-($+1)).split(","),$e=1;switch(le){case"rgba":if(Ee.length!==4)return null;$e=C(Ee.pop());case"rgb":return Ee.length!==3?null:[x(Ee[0]),x(Ee[1]),x(Ee[2]),$e];case"hsla":if(Ee.length!==4)return null;$e=C(Ee.pop());case"hsl":if(Ee.length!==3)return null;var et=(parseFloat(Ee[0])%360+360)%360/360,mt=C(Ee[1]),ut=C(Ee[2]),Ot=ut<=.5?ut*(mt+1):ut+mt-ut*mt,$t=2*ut-Ot;return[d(255*T($t,Ot,et+1/3)),d(255*T($t,Ot,et)),d(255*T($t,Ot,et-1/3)),$e];default:return null}}return null}}catch(L){}}).parseCSSColor,Ea=function(n,s,l,d){d===void 0&&(d=1),this.r=n,this.g=s,this.b=l,this.a=d};Ea.parse=function(n){if(n){if(n instanceof Ea)return n;if(typeof n=="string"){var s=zi(n);if(s)return new Ea(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},Ea.prototype.toString=function(){var n=this.toArray(),s=n[1],l=n[2],d=n[3];return"rgba("+Math.round(n[0])+","+Math.round(s)+","+Math.round(l)+","+d+")"},Ea.prototype.toArray=function(){var n=this.a;return n===0?[0,0,0,0]:[255*this.r/n,255*this.g/n,255*this.b/n,n]},Ea.black=new Ea(0,0,0,1),Ea.white=new Ea(1,1,1,1),Ea.transparent=new Ea(0,0,0,0),Ea.red=new Ea(1,0,0,1);var Co=function(n,s,l){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Co.prototype.compare=function(n,s){return this.collator.compare(n,s)},Co.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var sn=function(n,s,l,d,x){this.text=n,this.image=s,this.scale=l,this.fontStack=d,this.textColor=x},Wr=function(n){this.sections=n};Wr.fromString=function(n){return new Wr([new sn(n,null,null,null,null)])},Wr.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(n){return n.text.length!==0||n.image&&n.image.name.length!==0})},Wr.factory=function(n){return n instanceof Wr?n:Wr.fromString(n)},Wr.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(n){return n.text}).join("")},Wr.prototype.serialize=function(){for(var n=["format"],s=0,l=this.sections;s<l.length;s+=1){var d=l[s];if(d.image)n.push(["image",d.image.name]);else{n.push(d.text);var x={};d.fontStack&&(x["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(x["font-scale"]=d.scale),d.textColor&&(x["text-color"]=["rgba"].concat(d.textColor.toArray())),n.push(x)}}return n};var bt=function(n){this.name=n.name,this.available=n.available};function Ds(n,s,l,d){return typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:"Invalid rgba value ["+[n,s,l,d].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof d=="number"?[n,s,l,d]:[n,s,l]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function jt(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Ea||n instanceof Co||n instanceof Wr||n instanceof bt)return!0;if(Array.isArray(n)){for(var s=0,l=n;s<l.length;s+=1)if(!jt(l[s]))return!1;return!0}if(typeof n=="object"){for(var d in n)if(!jt(n[d]))return!1;return!0}return!1}function Xi(n){if(n===null)return Sn;if(typeof n=="string")return Hn;if(typeof n=="boolean")return wn;if(typeof n=="number")return Jt;if(n instanceof Ea)return Tn;if(n instanceof Co)return qi;if(n instanceof Wr)return La;if(n instanceof bt)return na;if(Array.isArray(n)){for(var s,l=n.length,d=0,x=n;d<x.length;d+=1){var C=Xi(x[d]);if(s){if(s===C)continue;s=Ir;break}s=C}return pa(s||Ir,l)}return sa}function Yl(n){var s=typeof n;return n===null?"":s==="string"||s==="number"||s==="boolean"?String(n):n instanceof Ea||n instanceof Wr||n instanceof bt?n.toString():JSON.stringify(n)}bt.prototype.toString=function(){return this.name},bt.fromString=function(n){return n?new bt({name:n,available:!1}):null},bt.prototype.serialize=function(){return["image",this.name]};var Oa=function(n,s){this.type=n,this.value=s};Oa.parse=function(n,s){if(n.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(!jt(n[1]))return s.error("invalid value");var l=n[1],d=Xi(l),x=s.expectedType;return d.kind!=="array"||d.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(d=x),new Oa(d,l)},Oa.prototype.evaluate=function(){return this.value},Oa.prototype.eachChild=function(){},Oa.prototype.outputDefined=function(){return!0},Oa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ea?["rgba"].concat(this.value.toArray()):this.value instanceof Wr?this.value.serialize():this.value};var po=function(n){this.name="ExpressionEvaluationError",this.message=n};po.prototype.toJSON=function(){return this.message};var Oo={string:Hn,number:Jt,boolean:wn,object:sa},_a=function(n,s){this.type=n,this.args=s};_a.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l,d=1,x=n[0];if(x==="array"){var C,T;if(n.length>2){var L=n[1];if(typeof L!="string"||!(L in Oo)||L==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);C=Oo[L],d++}else C=Ir;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=n[2],d++}l=pa(C,T)}else l=Oo[x];for(var U=[];d<n.length;d++){var X=s.parse(n[d],d,Ir);if(!X)return null;U.push(X)}return new _a(l,U)},_a.prototype.evaluate=function(n){for(var s=0;s<this.args.length;s++){var l=this.args[s].evaluate(n);if(!Qi(this.type,Xi(l)))return l;if(s===this.args.length-1)throw new po("Expected value to be of type "+Lt(this.type)+", but found "+Lt(Xi(l))+" instead.")}return null},_a.prototype.eachChild=function(n){this.args.forEach(n)},_a.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},_a.prototype.serialize=function(){var n=this.type,s=[n.kind];if(n.kind==="array"){var l=n.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);var d=n.N;(typeof d=="number"||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(function(x){return x.serialize()}))};var Bs=function(n){this.type=La,this.sections=n};Bs.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l=n[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");for(var d=[],x=!1,C=1;C<=n.length-1;++C){var T=n[C];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;var L=null;if(T["font-scale"]&&!(L=s.parse(T["font-scale"],1,Jt)))return null;var U=null;if(T["text-font"]&&!(U=s.parse(T["text-font"],1,pa(Hn))))return null;var X=null;if(T["text-color"]&&!(X=s.parse(T["text-color"],1,Tn)))return null;var $=d[d.length-1];$.scale=L,$.font=U,$.textColor=X}else{var ee=s.parse(n[C],1,Ir);if(!ee)return null;var le=ee.type.kind;if(le!=="string"&&le!=="value"&&le!=="null"&&le!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,d.push({content:ee,scale:null,font:null,textColor:null})}}return new Bs(d)},Bs.prototype.evaluate=function(n){return new Wr(this.sections.map(function(s){var l=s.content.evaluate(n);return Xi(l)===na?new sn("",l,null,null,null):new sn(Yl(l),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))},Bs.prototype.eachChild=function(n){for(var s=0,l=this.sections;s<l.length;s+=1){var d=l[s];n(d.content),d.scale&&n(d.scale),d.font&&n(d.font),d.textColor&&n(d.textColor)}},Bs.prototype.outputDefined=function(){return!1},Bs.prototype.serialize=function(){for(var n=["format"],s=0,l=this.sections;s<l.length;s+=1){var d=l[s];n.push(d.content.serialize());var x={};d.scale&&(x["font-scale"]=d.scale.serialize()),d.font&&(x["text-font"]=d.font.serialize()),d.textColor&&(x["text-color"]=d.textColor.serialize()),n.push(x)}return n};var Ns=function(n){this.type=na,this.input=n};Ns.parse=function(n,s){if(n.length!==2)return s.error("Expected two arguments.");var l=s.parse(n[1],1,Hn);return l?new Ns(l):s.error("No image name provided.")},Ns.prototype.evaluate=function(n){var s=this.input.evaluate(n),l=bt.fromString(s);return l&&n.availableImages&&(l.available=n.availableImages.indexOf(s)>-1),l},Ns.prototype.eachChild=function(n){n(this.input)},Ns.prototype.outputDefined=function(){return!1},Ns.prototype.serialize=function(){return["image",this.input.serialize()]};var ql={"to-boolean":wn,"to-color":Tn,"to-number":Jt,"to-string":Hn},So=function(n,s){this.type=n,this.args=s};So.parse=function(n,s){if(n.length<2)return s.error("Expected at least one argument.");var l=n[0];if((l==="to-boolean"||l==="to-string")&&n.length!==2)return s.error("Expected one argument.");for(var d=ql[l],x=[],C=1;C<n.length;C++){var T=s.parse(n[C],C,Ir);if(!T)return null;x.push(T)}return new So(d,x)},So.prototype.evaluate=function(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){for(var s,l,d=0,x=this.args;d<x.length;d+=1){if(l=null,(s=x[d].evaluate(n))instanceof Ea)return s;if(typeof s=="string"){var C=n.parseColor(s);if(C)return C}else if(Array.isArray(s)&&!(l=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":Ds(s[0],s[1],s[2],s[3])))return new Ea(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new po(l||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var T=null,L=0,U=this.args;L<U.length;L+=1){if((T=U[L].evaluate(n))===null)return 0;var X=Number(T);if(!isNaN(X))return X}throw new po("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?Wr.fromString(Yl(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?bt.fromString(Yl(this.args[0].evaluate(n))):Yl(this.args[0].evaluate(n))},So.prototype.eachChild=function(n){this.args.forEach(n)},So.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},So.prototype.serialize=function(){if(this.type.kind==="formatted")return new Bs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ns(this.args[0]).serialize();var n=["to-"+this.type.kind];return this.eachChild(function(s){n.push(s.serialize())}),n};var Ts=["Unknown","Point","LineString","Polygon"],Ka=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Ka.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ka.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ts[this.feature.type]:this.feature.type:null},Ka.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Ka.prototype.canonicalID=function(){return this.canonical},Ka.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ka.prototype.parseColor=function(n){var s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=Ea.parse(n)),s};var Uo=function(n,s,l,d){this.name=n,this.type=s,this._evaluate=l,this.args=d};Uo.prototype.evaluate=function(n){return this._evaluate(n,this.args)},Uo.prototype.eachChild=function(n){this.args.forEach(n)},Uo.prototype.outputDefined=function(){return!1},Uo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(n){return n.serialize()}))},Uo.parse=function(n,s){var l,d=n[0],x=Uo.definitions[d];if(!x)return s.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0);for(var C=Array.isArray(x)?x[0]:x.type,T=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,L=T.filter(function(Mi){var Jn=Mi[0];return!Array.isArray(Jn)||Jn.length===n.length-1}),U=null,X=0,$=L;X<$.length;X+=1){var ee=$[X],le=ee[0],Ee=ee[1];U=new Yu(s.registry,s.path,null,s.scope);for(var $e=[],et=!1,mt=1;mt<n.length;mt++){var ut=n[mt],Ot=Array.isArray(le)?le[mt-1]:le.type,$t=U.parse(ut,1+$e.length,Ot);if(!$t){et=!0;break}$e.push($t)}if(!et)if(Array.isArray(le)&&le.length!==$e.length)U.error("Expected "+le.length+" arguments, but found "+$e.length+" instead.");else{for(var dr=0;dr<$e.length;dr++){var gr=Array.isArray(le)?le[dr]:le.type,Dr=$e[dr];U.concat(dr+1).checkSubtype(gr,Dr.type)}if(U.errors.length===0)return new Uo(d,C,Ee,$e)}}if(L.length===1)(l=s.errors).push.apply(l,U.errors);else{for(var hn=(L.length?L:T).map(function(Mi){var Jn;return Jn=Mi[0],Array.isArray(Jn)?"("+Jn.map(Lt).join(", ")+")":"("+Lt(Jn.type)+"...)"}).join(" | "),zn=[],Ai=1;Ai<n.length;Ai++){var Qn=s.parse(n[Ai],1+zn.length);if(!Qn)return null;zn.push(Lt(Qn.type))}s.error("Expected arguments of type "+hn+", but found ("+zn.join(", ")+") instead.")}return null},Uo.register=function(n,s){for(var l in Uo.definitions=s,s)n[l]=Uo};var Ms=function(n,s,l){this.type=qi,this.locale=l,this.caseSensitive=n,this.diacriticSensitive=s};function Fo(n,s){n[0]=Math.min(n[0],s[0]),n[1]=Math.min(n[1],s[1]),n[2]=Math.max(n[2],s[0]),n[3]=Math.max(n[3],s[1])}function Xu(n,s){return!(n[0]<=s[0]||n[2]>=s[2]||n[1]<=s[1]||n[3]>=s[3])}function sl(n,s){var l=(180+n[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,x=Math.pow(2,s.z);return[Math.round(l*x*8192),Math.round(d*x*8192)]}function ns(n,s,l){return s[1]>n[1]!=l[1]>n[1]&&n[0]<(l[0]-s[0])*(n[1]-s[1])/(l[1]-s[1])+s[0]}function ve(n,s){for(var l,d,x,C,T,L,U,X=!1,$=0,ee=s.length;$<ee;$++)for(var le=s[$],Ee=0,$e=le.length;Ee<$e-1;Ee++){if((C=(l=n)[0]-(d=le[Ee])[0])*(U=l[1]-(x=le[Ee+1])[1])-(L=l[0]-x[0])*(T=l[1]-d[1])==0&&C*L<=0&&T*U<=0)return!1;ns(n,le[Ee],le[Ee+1])&&(X=!X)}return X}function Be(n,s){for(var l=0;l<s.length;l++)if(ve(n,s[l]))return!0;return!1}function yt(n,s,l,d){var x=d[0]-l[0],C=d[1]-l[1],T=(n[0]-l[0])*C-x*(n[1]-l[1]),L=(s[0]-l[0])*C-x*(s[1]-l[1]);return T>0&&L<0||T<0&&L>0}function ir(n,s,l){for(var d=0,x=l;d<x.length;d+=1)for(var C=x[d],T=0;T<C.length-1;++T)if((ee=[($=C[T+1])[0]-(X=C[T])[0],$[1]-X[1]])[0]*(le=[(U=s)[0]-(L=n)[0],U[1]-L[1]])[1]-ee[1]*le[0]!=0&&yt(L,U,X,$)&&yt(X,$,L,U))return!0;var L,U,X,$,ee,le;return!1}function gn(n,s){for(var l=0;l<n.length;++l)if(!ve(n[l],s))return!1;for(var d=0;d<n.length-1;++d)if(ir(n[d],n[d+1],s))return!1;return!0}function ei(n,s){for(var l=0;l<s.length;l++)if(gn(n,s[l]))return!0;return!1}function ga(n,s,l){for(var d=[],x=0;x<n.length;x++){for(var C=[],T=0;T<n[x].length;T++){var L=sl(n[x][T],l);Fo(s,L),C.push(L)}d.push(C)}return d}function Jo(n,s,l){for(var d=[],x=0;x<n.length;x++){var C=ga(n[x],s,l);d.push(C)}return d}function Fa(n,s,l,d){if(n[0]<l[0]||n[0]>l[2]){var x=.5*d,C=n[0]-l[0]>x?-d:l[0]-n[0]>x?d:0;C===0&&(C=n[0]-l[2]>x?-d:l[2]-n[0]>x?d:0),n[0]+=C}Fo(s,n)}function Zo(n,s,l,d){for(var x=8192*Math.pow(2,d.z),C=[8192*d.x,8192*d.y],T=[],L=0,U=n;L<U.length;L+=1)for(var X=0,$=U[L];X<$.length;X+=1){var ee=$[X],le=[ee.x+C[0],ee.y+C[1]];Fa(le,s,l,x),T.push(le)}return T}function Ho(n,s,l,d){for(var x,C=8192*Math.pow(2,d.z),T=[8192*d.x,8192*d.y],L=[],U=0,X=n;U<X.length;U+=1){for(var $=[],ee=0,le=X[U];ee<le.length;ee+=1){var Ee=le[ee],$e=[Ee.x+T[0],Ee.y+T[1]];Fo(s,$e),$.push($e)}L.push($)}if(s[2]-s[0]<=C/2){(x=s)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var et=0,mt=L;et<mt.length;et+=1)for(var ut=0,Ot=mt[et];ut<Ot.length;ut+=1)Fa(Ot[ut],s,l,C)}return L}Ms.parse=function(n,s){if(n.length!==2)return s.error("Expected one argument.");var l=n[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");var d=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,wn);if(!d)return null;var x=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,wn);if(!x)return null;var C=null;return l.locale&&!(C=s.parse(l.locale,1,Hn))?null:new Ms(d,x,C)},Ms.prototype.evaluate=function(n){return new Co(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)},Ms.prototype.eachChild=function(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)},Ms.prototype.outputDefined=function(){return!1},Ms.prototype.serialize=function(){var n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]};var Ro=function(n,s){this.type=wn,this.geojson=n,this.geometries=s};function zs(n){if(n instanceof Uo&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof Ro)return!1;var s=!0;return n.eachChild(function(l){s&&!zs(l)&&(s=!1)}),s}function hs(n){if(n instanceof Uo&&n.name==="feature-state")return!1;var s=!0;return n.eachChild(function(l){s&&!hs(l)&&(s=!1)}),s}function Is(n,s){if(n instanceof Uo&&s.indexOf(n.name)>=0)return!1;var l=!0;return n.eachChild(function(d){l&&!Is(d,s)&&(l=!1)}),l}Ro.parse=function(n,s){if(n.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(jt(n[1])){var l=n[1];if(l.type==="FeatureCollection")for(var d=0;d<l.features.length;++d){var x=l.features[d].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Ro(l,l.features[d].geometry)}else if(l.type==="Feature"){var C=l.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new Ro(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Ro(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ro.prototype.evaluate=function(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,l){var d=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var T=ga(l.coordinates,x,C),L=Zo(s.geometry(),d,x,C);if(!Xu(d,x))return!1;for(var U=0,X=L;U<X.length;U+=1)if(!ve(X[U],T))return!1}if(l.type==="MultiPolygon"){var $=Jo(l.coordinates,x,C),ee=Zo(s.geometry(),d,x,C);if(!Xu(d,x))return!1;for(var le=0,Ee=ee;le<Ee.length;le+=1)if(!Be(Ee[le],$))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,l){var d=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var T=ga(l.coordinates,x,C),L=Ho(s.geometry(),d,x,C);if(!Xu(d,x))return!1;for(var U=0,X=L;U<X.length;U+=1)if(!gn(X[U],T))return!1}if(l.type==="MultiPolygon"){var $=Jo(l.coordinates,x,C),ee=Ho(s.geometry(),d,x,C);if(!Xu(d,x))return!1;for(var le=0,Ee=ee;le<Ee.length;le+=1)if(!ei(Ee[le],$))return!1}return!0}(n,this.geometries)}return!1},Ro.prototype.eachChild=function(){},Ro.prototype.outputDefined=function(){return!0},Ro.prototype.serialize=function(){return["within",this.geojson]};var bu=function(n,s){this.type=s.type,this.name=n,this.boundExpression=s};bu.parse=function(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var l=n[1];return s.scope.has(l)?new bu(l,s.scope.get(l)):s.error('Unknown variable "'+l+'". Make sure "'+l+'" has been bound in an enclosing "let" expression before using it.',1)},bu.prototype.evaluate=function(n){return this.boundExpression.evaluate(n)},bu.prototype.eachChild=function(){},bu.prototype.outputDefined=function(){return!1},bu.prototype.serialize=function(){return["var",this.name]};var Yu=function(n,s,l,d,x){s===void 0&&(s=[]),d===void 0&&(d=new oi),x===void 0&&(x=[]),this.registry=n,this.path=s,this.key=s.map(function(C){return"["+C+"]"}).join(""),this.scope=d,this.errors=x,this.expectedType=l};function Eu(n,s){for(var l,d=n.length-1,x=0,C=d,T=0;x<=C;)if((l=n[T=Math.floor((x+C)/2)])<=s){if(T===d||s<n[T+1])return T;x=T+1}else{if(!(l>s))throw new po("Input is not a number.");C=T-1}return 0}Yu.prototype.parse=function(n,s,l,d,x){return x===void 0&&(x={}),s?this.concat(s,l,d)._parse(n,x):this._parse(n,x)},Yu.prototype._parse=function(n,s){function l(X,$,ee){return ee==="assert"?new _a($,[X]):ee==="coerce"?new So($,[X]):X}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var d=n[0];if(typeof d!="string")return this.error("Expression name must be a string, but found "+typeof d+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[d];if(x){var C=x.parse(n,this);if(!C)return null;if(this.expectedType){var T=this.expectedType,L=C.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||L.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||L.kind!=="value"&&L.kind!=="string"){if(this.checkSubtype(T,L))return null}else C=l(C,T,s.typeAnnotation||"coerce");else C=l(C,T,s.typeAnnotation||"assert")}if(!(C instanceof Oa)&&C.type.kind!=="resolvedImage"&&function X($){if($ instanceof bu)return X($.boundExpression);if($ instanceof Uo&&$.name==="error"||$ instanceof Ms||$ instanceof Ro)return!1;var ee=$ instanceof So||$ instanceof _a,le=!0;return $.eachChild(function(Ee){le=ee?le&&X(Ee):le&&Ee instanceof Oa}),!!le&&zs($)&&Is($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(C)){var U=new Ka;try{C=new Oa(C.type,C.evaluate(U))}catch(X){return this.error(X.message),null}}return C}return this.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof n+" instead.")},Yu.prototype.concat=function(n,s,l){var d=typeof n=="number"?this.path.concat(n):this.path,x=l?this.scope.concat(l):this.scope;return new Yu(this.registry,d,s||null,x,this.errors)},Yu.prototype.error=function(n){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];var d=""+this.key+s.map(function(x){return"["+x+"]"}).join("");this.errors.push(new jr(d,n))},Yu.prototype.checkSubtype=function(n,s){var l=Qi(n,s);return l&&this.error(l),l};var Cu=function(n,s,l){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(var d=0,x=l;d<x.length;d+=1){var C=x[d],T=C[1];this.labels.push(C[0]),this.outputs.push(T)}};function Za(n,s,l){return n*(1-l)+s*l}Cu.parse=function(n,s){if(n.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");var l=s.parse(n[1],1,Jt);if(!l)return null;var d=[],x=null;s.expectedType&&s.expectedType.kind!=="value"&&(x=s.expectedType);for(var C=1;C<n.length;C+=2){var T=C===1?-1/0:n[C],L=n[C+1],U=C,X=C+1;if(typeof T!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(d.length&&d[d.length-1][0]>=T)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);var $=s.parse(L,X,x);if(!$)return null;x=x||$.type,d.push([T,$])}return new Cu(x,l,d)},Cu.prototype.evaluate=function(n){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(n);var d=this.input.evaluate(n);if(d<=s[0])return l[0].evaluate(n);var x=s.length;return d>=s[x-1]?l[x-1].evaluate(n):l[Eu(s,d)].evaluate(n)},Cu.prototype.eachChild=function(n){n(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)n(l[s])},Cu.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Cu.prototype.serialize=function(){for(var n=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n};var ps=Object.freeze({__proto__:null,number:Za,color:function(n,s,l){return new Ea(Za(n.r,s.r,l),Za(n.g,s.g,l),Za(n.b,s.b,l),Za(n.a,s.a,l))},array:function(n,s,l){return n.map(function(d,x){return Za(d,s[x],l)})}}),iu=6/29*3*(6/29),Su=Math.PI/180,mf=180/Math.PI;function zh(n){return n>.008856451679035631?Math.pow(n,1/3):n/iu+4/29}function qs(n){return n>6/29?n*n*n:iu*(n-4/29)}function gf(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function ul(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function jc(n){var s=ul(n.r),l=ul(n.g),d=ul(n.b),x=zh((.4124564*s+.3575761*l+.1804375*d)/.95047),C=zh((.2126729*s+.7151522*l+.072175*d)/1);return{l:116*C-16,a:500*(x-C),b:200*(C-zh((.0193339*s+.119192*l+.9503041*d)/1.08883)),alpha:n.a}}function b(n){var s=(n.l+16)/116,l=isNaN(n.a)?s:s+n.a/500,d=isNaN(n.b)?s:s-n.b/200;return s=1*qs(s),l=.95047*qs(l),d=1.08883*qs(d),new Ea(gf(3.2404542*l-1.5371385*s-.4985314*d),gf(-.969266*l+1.8760108*s+.041556*d),gf(.0556434*l-.2040259*s+1.0572252*d),n.alpha)}function k(n,s,l){var d=s-n;return n+l*(d>180||d<-180?d-360*Math.round(d/360):d)}var G={forward:jc,reverse:b,interpolate:function(n,s,l){return{l:Za(n.l,s.l,l),a:Za(n.a,s.a,l),b:Za(n.b,s.b,l),alpha:Za(n.alpha,s.alpha,l)}}},D={forward:function(n){var s=jc(n),l=s.l,d=s.a,x=s.b,C=Math.atan2(x,d)*mf;return{h:C<0?C+360:C,c:Math.sqrt(d*d+x*x),l,alpha:n.a}},reverse:function(n){var s=n.h*Su,l=n.c;return b({l:n.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:n.alpha})},interpolate:function(n,s,l){return{h:k(n.h,s.h,l),c:Za(n.c,s.c,l),l:Za(n.l,s.l,l),alpha:Za(n.alpha,s.alpha,l)}}},ne=Object.freeze({__proto__:null,lab:G,hcl:D}),Oe=function(n,s,l,d,x){this.type=n,this.operator=s,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(var C=0,T=x;C<T.length;C+=1){var L=T[C],U=L[1];this.labels.push(L[0]),this.outputs.push(U)}};function dt(n,s,l,d){var x=d-l,C=n-l;return x===0?0:s===1?C/x:(Math.pow(s,C)-1)/(Math.pow(s,x)-1)}Oe.interpolationFactor=function(n,s,l,d){var x=0;if(n.name==="exponential")x=dt(s,n.base,l,d);else if(n.name==="linear")x=dt(s,1,l,d);else if(n.name==="cubic-bezier"){var C=n.controlPoints;x=new K(C[0],C[1],C[2],C[3]).solve(dt(s,1,l,d))}return x},Oe.parse=function(n,s){var l=n[0],d=n[1],x=n[2],C=n.slice(3);if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){var T=d[1];if(typeof T!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(d[0]),1,0);var L=d.slice(1);if(L.length!==4||L.some(function(mt){return typeof mt!="number"||mt<0||mt>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:L}}if(n.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(x=s.parse(x,2,Jt)))return null;var U=[],X=null;l==="interpolate-hcl"||l==="interpolate-lab"?X=Tn:s.expectedType&&s.expectedType.kind!=="value"&&(X=s.expectedType);for(var $=0;$<C.length;$+=2){var ee=C[$],le=C[$+1],Ee=$+3,$e=$+4;if(typeof ee!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ee);if(U.length&&U[U.length-1][0]>=ee)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ee);var et=s.parse(le,$e,X);if(!et)return null;X=X||et.type,U.push([ee,et])}return X.kind==="number"||X.kind==="color"||X.kind==="array"&&X.itemType.kind==="number"&&typeof X.N=="number"?new Oe(X,l,d,x,U):s.error("Type "+Lt(X)+" is not interpolatable.")},Oe.prototype.evaluate=function(n){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(n);var d=this.input.evaluate(n);if(d<=s[0])return l[0].evaluate(n);var x=s.length;if(d>=s[x-1])return l[x-1].evaluate(n);var C=Eu(s,d),T=Oe.interpolationFactor(this.interpolation,d,s[C],s[C+1]),L=l[C].evaluate(n),U=l[C+1].evaluate(n);return this.operator==="interpolate"?ps[this.type.kind.toLowerCase()](L,U,T):this.operator==="interpolate-hcl"?D.reverse(D.interpolate(D.forward(L),D.forward(U),T)):G.reverse(G.interpolate(G.forward(L),G.forward(U),T))},Oe.prototype.eachChild=function(n){n(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)n(l[s])},Oe.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Oe.prototype.serialize=function(){var n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,n,this.input.serialize()],l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s};var Mt=function(n,s){this.type=n,this.args=s};Mt.parse=function(n,s){if(n.length<2)return s.error("Expectected at least one argument.");var l=null,d=s.expectedType;d&&d.kind!=="value"&&(l=d);for(var x=[],C=0,T=n.slice(1);C<T.length;C+=1){var L=s.parse(T[C],1+x.length,l,void 0,{typeAnnotation:"omit"});if(!L)return null;l=l||L.type,x.push(L)}var U=d&&x.some(function(X){return Qi(d,X.type)});return new Mt(U?Ir:l,x)},Mt.prototype.evaluate=function(n){for(var s,l=null,d=0,x=0,C=this.args;x<C.length&&(d++,(l=C[x].evaluate(n))&&l instanceof bt&&!l.available&&(s||(s=l.name),l=null,d===this.args.length&&(l=s)),l===null);x+=1);return l},Mt.prototype.eachChild=function(n){this.args.forEach(n)},Mt.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},Mt.prototype.serialize=function(){var n=["coalesce"];return this.eachChild(function(s){n.push(s.serialize())}),n};var Zt=function(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s};Zt.prototype.evaluate=function(n){return this.result.evaluate(n)},Zt.prototype.eachChild=function(n){for(var s=0,l=this.bindings;s<l.length;s+=1)n(l[s][1]);n(this.result)},Zt.parse=function(n,s){if(n.length<4)return s.error("Expected at least 3 arguments, but found "+(n.length-1)+" instead.");for(var l=[],d=1;d<n.length-1;d+=2){var x=n[d];if(typeof x!="string")return s.error("Expected string, but found "+typeof x+" instead.",d);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",d);var C=s.parse(n[d+1],d+1);if(!C)return null;l.push([x,C])}var T=s.parse(n[n.length-1],n.length-1,s.expectedType,l);return T?new Zt(l,T):null},Zt.prototype.outputDefined=function(){return this.result.outputDefined()},Zt.prototype.serialize=function(){for(var n=["let"],s=0,l=this.bindings;s<l.length;s+=1){var d=l[s];n.push(d[0],d[1].serialize())}return n.push(this.result.serialize()),n};var Br=function(n,s,l){this.type=n,this.index=s,this.input=l};Br.parse=function(n,s){if(n.length!==3)return s.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Jt),d=s.parse(n[2],2,pa(s.expectedType||Ir));return l&&d?new Br(d.type.itemType,l,d):null},Br.prototype.evaluate=function(n){var s=this.index.evaluate(n),l=this.input.evaluate(n);if(s<0)throw new po("Array index out of bounds: "+s+" < 0.");if(s>=l.length)throw new po("Array index out of bounds: "+s+" > "+(l.length-1)+".");if(s!==Math.floor(s))throw new po("Array index must be an integer, but found "+s+" instead.");return l[s]},Br.prototype.eachChild=function(n){n(this.index),n(this.input)},Br.prototype.outputDefined=function(){return!1},Br.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Gr=function(n,s){this.type=wn,this.needle=n,this.haystack=s};Gr.parse=function(n,s){if(n.length!==3)return s.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Ir),d=s.parse(n[2],2,Ir);return l&&d?fo(l.type,[wn,Hn,Jt,Sn,Ir])?new Gr(l,d):s.error("Expected first argument to be of type boolean, string, number or null, but found "+Lt(l.type)+" instead"):null},Gr.prototype.evaluate=function(n){var s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!l)return!1;if(!Ba(s,["boolean","string","number","null"]))throw new po("Expected first argument to be of type boolean, string, number or null, but found "+Lt(Xi(s))+" instead.");if(!Ba(l,["string","array"]))throw new po("Expected second argument to be of type array or string, but found "+Lt(Xi(l))+" instead.");return l.indexOf(s)>=0},Gr.prototype.eachChild=function(n){n(this.needle),n(this.haystack)},Gr.prototype.outputDefined=function(){return!0},Gr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Yn=function(n,s,l){this.type=Jt,this.needle=n,this.haystack=s,this.fromIndex=l};Yn.parse=function(n,s){if(n.length<=2||n.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Ir),d=s.parse(n[2],2,Ir);if(!l||!d)return null;if(!fo(l.type,[wn,Hn,Jt,Sn,Ir]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+Lt(l.type)+" instead");if(n.length===4){var x=s.parse(n[3],3,Jt);return x?new Yn(l,d,x):null}return new Yn(l,d)},Yn.prototype.evaluate=function(n){var s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!Ba(s,["boolean","string","number","null"]))throw new po("Expected first argument to be of type boolean, string, number or null, but found "+Lt(Xi(s))+" instead.");if(!Ba(l,["string","array"]))throw new po("Expected second argument to be of type array or string, but found "+Lt(Xi(l))+" instead.");if(this.fromIndex){var d=this.fromIndex.evaluate(n);return l.indexOf(s,d)}return l.indexOf(s)},Yn.prototype.eachChild=function(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)},Yn.prototype.outputDefined=function(){return!1},Yn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ji=function(n,s,l,d,x,C){this.inputType=n,this.type=s,this.input=l,this.cases=d,this.outputs=x,this.otherwise=C};ji.parse=function(n,s){if(n.length<5)return s.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if(n.length%2!=1)return s.error("Expected an even number of arguments.");var l,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);for(var x={},C=[],T=2;T<n.length-1;T+=2){var L=n[T],U=n[T+1];Array.isArray(L)||(L=[L]);var X=s.concat(T);if(L.length===0)return X.error("Expected at least one branch label.");for(var $=0,ee=L;$<ee.length;$+=1){var le=ee[$];if(typeof le!="number"&&typeof le!="string")return X.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return X.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof le=="number"&&Math.floor(le)!==le)return X.error("Numeric branch labels must be integer values.");if(l){if(X.checkSubtype(l,Xi(le)))return null}else l=Xi(le);if(x[String(le)]!==void 0)return X.error("Branch labels must be unique.");x[String(le)]=C.length}var Ee=s.parse(U,T,d);if(!Ee)return null;d=d||Ee.type,C.push(Ee)}var $e=s.parse(n[1],1,Ir);if(!$e)return null;var et=s.parse(n[n.length-1],n.length-1,d);return et?$e.type.kind!=="value"&&s.concat(1).checkSubtype(l,$e.type)?null:new ji(l,d,$e,x,C,et):null},ji.prototype.evaluate=function(n){var s=this.input.evaluate(n);return(Xi(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)},ji.prototype.eachChild=function(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)},ji.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})&&this.otherwise.outputDefined()},ji.prototype.serialize=function(){for(var n=this,s=["match",this.input.serialize()],l=[],d={},x=0,C=Object.keys(this.cases).sort();x<C.length;x+=1){var T=C[x];(ee=d[this.cases[T]])===void 0?(d[this.cases[T]]=l.length,l.push([this.cases[T],[T]])):l[ee][1].push(T)}for(var L=function(Ee){return n.inputType.kind==="number"?Number(Ee):Ee},U=0,X=l;U<X.length;U+=1){var $=X[U],ee=$[0],le=$[1];s.push(le.length===1?L(le[0]):le.map(L)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var Ui=function(n,s,l){this.type=n,this.branches=s,this.otherwise=l};Ui.parse=function(n,s){if(n.length<4)return s.error("Expected at least 3 arguments, but found only "+(n.length-1)+".");if(n.length%2!=0)return s.error("Expected an odd number of arguments.");var l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);for(var d=[],x=1;x<n.length-1;x+=2){var C=s.parse(n[x],x,wn);if(!C)return null;var T=s.parse(n[x+1],x+1,l);if(!T)return null;d.push([C,T]),l=l||T.type}var L=s.parse(n[n.length-1],n.length-1,l);return L?new Ui(l,d,L):null},Ui.prototype.evaluate=function(n){for(var s=0,l=this.branches;s<l.length;s+=1){var d=l[s],x=d[1];if(d[0].evaluate(n))return x.evaluate(n)}return this.otherwise.evaluate(n)},Ui.prototype.eachChild=function(n){for(var s=0,l=this.branches;s<l.length;s+=1){var d=l[s],x=d[1];n(d[0]),n(x)}n(this.otherwise)},Ui.prototype.outputDefined=function(){return this.branches.every(function(n){return n[1].outputDefined()})&&this.otherwise.outputDefined()},Ui.prototype.serialize=function(){var n=["case"];return this.eachChild(function(s){n.push(s.serialize())}),n};var Fi=function(n,s,l,d){this.type=n,this.input=s,this.beginIndex=l,this.endIndex=d};function io(n,s){return n==="=="||n==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function vo(n,s,l,d){return d.compare(s,l)===0}function Ia(n,s,l){var d=n!=="=="&&n!=="!=";return function(){function x(C,T,L){this.type=wn,this.lhs=C,this.rhs=T,this.collator=L,this.hasUntypedArgument=C.type.kind==="value"||T.type.kind==="value"}return x.parse=function(C,T){if(C.length!==3&&C.length!==4)return T.error("Expected two or three arguments.");var L=C[0],U=T.parse(C[1],1,Ir);if(!U)return null;if(!io(L,U.type))return T.concat(1).error('"'+L+`" comparisons are not supported for type '`+Lt(U.type)+"'.");var X=T.parse(C[2],2,Ir);if(!X)return null;if(!io(L,X.type))return T.concat(2).error('"'+L+`" comparisons are not supported for type '`+Lt(X.type)+"'.");if(U.type.kind!==X.type.kind&&U.type.kind!=="value"&&X.type.kind!=="value")return T.error("Cannot compare types '"+Lt(U.type)+"' and '"+Lt(X.type)+"'.");d&&(U.type.kind==="value"&&X.type.kind!=="value"?U=new _a(X.type,[U]):U.type.kind!=="value"&&X.type.kind==="value"&&(X=new _a(U.type,[X])));var $=null;if(C.length===4){if(U.type.kind!=="string"&&X.type.kind!=="string"&&U.type.kind!=="value"&&X.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!($=T.parse(C[3],3,qi)))return null}return new x(U,X,$)},x.prototype.evaluate=function(C){var T=this.lhs.evaluate(C),L=this.rhs.evaluate(C);if(d&&this.hasUntypedArgument){var U=Xi(T),X=Xi(L);if(U.kind!==X.kind||U.kind!=="string"&&U.kind!=="number")throw new po('Expected arguments for "'+n+'" to be (string, string) or (number, number), but found ('+U.kind+", "+X.kind+") instead.")}if(this.collator&&!d&&this.hasUntypedArgument){var $=Xi(T),ee=Xi(L);if($.kind!=="string"||ee.kind!=="string")return s(C,T,L)}return this.collator?l(C,T,L,this.collator.evaluate(C)):s(C,T,L)},x.prototype.eachChild=function(C){C(this.lhs),C(this.rhs),this.collator&&C(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var C=[n];return this.eachChild(function(T){C.push(T.serialize())}),C},x}()}Fi.parse=function(n,s){if(n.length<=2||n.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1,Ir),d=s.parse(n[2],2,Jt);if(!l||!d)return null;if(!fo(l.type,[pa(Ir),Hn,Ir]))return s.error("Expected first argument to be of type array or string, but found "+Lt(l.type)+" instead");if(n.length===4){var x=s.parse(n[3],3,Jt);return x?new Fi(l.type,l,d,x):null}return new Fi(l.type,l,d)},Fi.prototype.evaluate=function(n){var s=this.input.evaluate(n),l=this.beginIndex.evaluate(n);if(!Ba(s,["string","array"]))throw new po("Expected first argument to be of type array or string, but found "+Lt(Xi(s))+" instead.");if(this.endIndex){var d=this.endIndex.evaluate(n);return s.slice(l,d)}return s.slice(l)},Fi.prototype.eachChild=function(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)},Fi.prototype.outputDefined=function(){return!1},Fi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var au=Ia("==",function(n,s,l){return s===l},vo),Ll=Ia("!=",function(n,s,l){return s!==l},function(n,s,l,d){return!vo(0,s,l,d)}),hc=Ia("<",function(n,s,l){return s<l},function(n,s,l,d){return d.compare(s,l)<0}),pc=Ia(">",function(n,s,l){return s>l},function(n,s,l,d){return d.compare(s,l)>0}),dc=Ia("<=",function(n,s,l){return s<=l},function(n,s,l,d){return d.compare(s,l)<=0}),vc=Ia(">=",function(n,s,l){return s>=l},function(n,s,l,d){return d.compare(s,l)>=0}),Du=function(n,s,l,d,x){this.type=Hn,this.number=n,this.locale=s,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=x};Du.parse=function(n,s){if(n.length!==3)return s.error("Expected two arguments.");var l=s.parse(n[1],1,Jt);if(!l)return null;var d=n[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");var x=null;if(d.locale&&!(x=s.parse(d.locale,1,Hn)))return null;var C=null;if(d.currency&&!(C=s.parse(d.currency,1,Hn)))return null;var T=null;if(d["min-fraction-digits"]&&!(T=s.parse(d["min-fraction-digits"],1,Jt)))return null;var L=null;return d["max-fraction-digits"]&&!(L=s.parse(d["max-fraction-digits"],1,Jt))?null:new Du(l,x,C,T,L)},Du.prototype.evaluate=function(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))},Du.prototype.eachChild=function(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)},Du.prototype.outputDefined=function(){return!1},Du.prototype.serialize=function(){var n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]};var Ol=function(n){this.type=Jt,this.input=n};Ol.parse=function(n,s){if(n.length!==2)return s.error("Expected 1 argument, but found "+(n.length-1)+" instead.");var l=s.parse(n[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+Lt(l.type)+" instead."):new Ol(l):null},Ol.prototype.evaluate=function(n){var s=this.input.evaluate(n);if(typeof s=="string"||Array.isArray(s))return s.length;throw new po("Expected value to be of type string or array, but found "+Lt(Xi(s))+" instead.")},Ol.prototype.eachChild=function(n){n(this.input)},Ol.prototype.outputDefined=function(){return!1},Ol.prototype.serialize=function(){var n=["length"];return this.eachChild(function(s){n.push(s.serialize())}),n};var gl={"==":au,"!=":Ll,">":pc,"<":hc,">=":vc,"<=":dc,array:_a,at:Br,boolean:_a,case:Ui,coalesce:Mt,collator:Ms,format:Bs,image:Ns,in:Gr,"index-of":Yn,interpolate:Oe,"interpolate-hcl":Oe,"interpolate-lab":Oe,length:Ol,let:Zt,literal:Oa,match:ji,number:_a,"number-format":Du,object:_a,slice:Fi,step:Cu,string:_a,"to-boolean":So,"to-color":So,"to-number":So,"to-string":So,var:bu,within:Ro};function Wo(n,s){var l=s[0],d=s[1],x=s[2],C=s[3];l=l.evaluate(n),d=d.evaluate(n),x=x.evaluate(n);var T=C?C.evaluate(n):1,L=Ds(l,d,x,T);if(L)throw new po(L);return new Ea(l/255*T,d/255*T,x/255*T,T)}function dp(n,s){return n in s}function Uh(n,s){var l=s[n];return l===void 0?null:l}function Au(n){return{type:n}}function yf(n){return{result:"success",value:n}}function yl(n){return{result:"error",value:n}}function qu(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Zh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function _l(n){return!!n.expression&&n.expression.interpolated}function mo(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function $s(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Vh(n){return n}function xl(n,s,l){return n!==void 0?n:s!==void 0?s:l!==void 0?l:void 0}function vp(n,s,l,d,x){return xl(typeof l===x?d[l]:void 0,n.default,s.default)}function mp(n,s,l){if(mo(l)!=="number")return xl(n.default,s.default);var d=n.stops.length;if(d===1||l<=n.stops[0][0])return n.stops[0][1];if(l>=n.stops[d-1][0])return n.stops[d-1][1];var x=Eu(n.stops.map(function(C){return C[0]}),l);return n.stops[x][1]}function ch(n,s,l){var d=n.base!==void 0?n.base:1;if(mo(l)!=="number")return xl(n.default,s.default);var x=n.stops.length;if(x===1||l<=n.stops[0][0])return n.stops[0][1];if(l>=n.stops[x-1][0])return n.stops[x-1][1];var C=Eu(n.stops.map(function(ee){return ee[0]}),l),T=function(ee,le,Ee,$e){var et=$e-Ee,mt=ee-Ee;return et===0?0:le===1?mt/et:(Math.pow(le,mt)-1)/(Math.pow(le,et)-1)}(l,d,n.stops[C][0],n.stops[C+1][0]),L=n.stops[C][1],U=n.stops[C+1][1],X=ps[s.type]||Vh;if(n.colorSpace&&n.colorSpace!=="rgb"){var $=ne[n.colorSpace];X=function(ee,le){return $.reverse($.interpolate($.forward(ee),$.forward(le),T))}}return typeof L.evaluate=="function"?{evaluate:function(){for(var ee=[],le=arguments.length;le--;)ee[le]=arguments[le];var Ee=L.evaluate.apply(void 0,ee),$e=U.evaluate.apply(void 0,ee);if(Ee!==void 0&&$e!==void 0)return X(Ee,$e,T)}}:X(L,U,T)}function jf(n,s,l){return s.type==="color"?l=Ea.parse(l):s.type==="formatted"?l=Wr.fromString(l.toString()):s.type==="resolvedImage"?l=bt.fromString(l.toString()):mo(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),xl(l,n.default,s.default)}Uo.register(gl,{error:[{kind:"error"},[Hn],function(n,s){throw new po(s[0].evaluate(n))}],typeof:[Hn,[Ir],function(n,s){return Lt(Xi(s[0].evaluate(n)))}],"to-rgba":[pa(Jt,4),[Tn],function(n,s){return s[0].evaluate(n).toArray()}],rgb:[Tn,[Jt,Jt,Jt],Wo],rgba:[Tn,[Jt,Jt,Jt,Jt],Wo],has:{type:wn,overloads:[[[Hn],function(n,s){return dp(s[0].evaluate(n),n.properties())}],[[Hn,sa],function(n,s){var l=s[1];return dp(s[0].evaluate(n),l.evaluate(n))}]]},get:{type:Ir,overloads:[[[Hn],function(n,s){return Uh(s[0].evaluate(n),n.properties())}],[[Hn,sa],function(n,s){var l=s[1];return Uh(s[0].evaluate(n),l.evaluate(n))}]]},"feature-state":[Ir,[Hn],function(n,s){return Uh(s[0].evaluate(n),n.featureState||{})}],properties:[sa,[],function(n){return n.properties()}],"geometry-type":[Hn,[],function(n){return n.geometryType()}],id:[Ir,[],function(n){return n.id()}],zoom:[Jt,[],function(n){return n.globals.zoom}],"heatmap-density":[Jt,[],function(n){return n.globals.heatmapDensity||0}],"line-progress":[Jt,[],function(n){return n.globals.lineProgress||0}],accumulated:[Ir,[],function(n){return n.globals.accumulated===void 0?null:n.globals.accumulated}],"+":[Jt,Au(Jt),function(n,s){for(var l=0,d=0,x=s;d<x.length;d+=1)l+=x[d].evaluate(n);return l}],"*":[Jt,Au(Jt),function(n,s){for(var l=1,d=0,x=s;d<x.length;d+=1)l*=x[d].evaluate(n);return l}],"-":{type:Jt,overloads:[[[Jt,Jt],function(n,s){var l=s[1];return s[0].evaluate(n)-l.evaluate(n)}],[[Jt],function(n,s){return-s[0].evaluate(n)}]]},"/":[Jt,[Jt,Jt],function(n,s){var l=s[1];return s[0].evaluate(n)/l.evaluate(n)}],"%":[Jt,[Jt,Jt],function(n,s){var l=s[1];return s[0].evaluate(n)%l.evaluate(n)}],ln2:[Jt,[],function(){return Math.LN2}],pi:[Jt,[],function(){return Math.PI}],e:[Jt,[],function(){return Math.E}],"^":[Jt,[Jt,Jt],function(n,s){var l=s[1];return Math.pow(s[0].evaluate(n),l.evaluate(n))}],sqrt:[Jt,[Jt],function(n,s){return Math.sqrt(s[0].evaluate(n))}],log10:[Jt,[Jt],function(n,s){return Math.log(s[0].evaluate(n))/Math.LN10}],ln:[Jt,[Jt],function(n,s){return Math.log(s[0].evaluate(n))}],log2:[Jt,[Jt],function(n,s){return Math.log(s[0].evaluate(n))/Math.LN2}],sin:[Jt,[Jt],function(n,s){return Math.sin(s[0].evaluate(n))}],cos:[Jt,[Jt],function(n,s){return Math.cos(s[0].evaluate(n))}],tan:[Jt,[Jt],function(n,s){return Math.tan(s[0].evaluate(n))}],asin:[Jt,[Jt],function(n,s){return Math.asin(s[0].evaluate(n))}],acos:[Jt,[Jt],function(n,s){return Math.acos(s[0].evaluate(n))}],atan:[Jt,[Jt],function(n,s){return Math.atan(s[0].evaluate(n))}],min:[Jt,Au(Jt),function(n,s){return Math.min.apply(Math,s.map(function(l){return l.evaluate(n)}))}],max:[Jt,Au(Jt),function(n,s){return Math.max.apply(Math,s.map(function(l){return l.evaluate(n)}))}],abs:[Jt,[Jt],function(n,s){return Math.abs(s[0].evaluate(n))}],round:[Jt,[Jt],function(n,s){var l=s[0].evaluate(n);return l<0?-Math.round(-l):Math.round(l)}],floor:[Jt,[Jt],function(n,s){return Math.floor(s[0].evaluate(n))}],ceil:[Jt,[Jt],function(n,s){return Math.ceil(s[0].evaluate(n))}],"filter-==":[wn,[Hn,Ir],function(n,s){var l=s[0],d=s[1];return n.properties()[l.value]===d.value}],"filter-id-==":[wn,[Ir],function(n,s){var l=s[0];return n.id()===l.value}],"filter-type-==":[wn,[Hn],function(n,s){var l=s[0];return n.geometryType()===l.value}],"filter-<":[wn,[Hn,Ir],function(n,s){var l=s[0],d=s[1],x=n.properties()[l.value],C=d.value;return typeof x==typeof C&&x<C}],"filter-id-<":[wn,[Ir],function(n,s){var l=s[0],d=n.id(),x=l.value;return typeof d==typeof x&&d<x}],"filter->":[wn,[Hn,Ir],function(n,s){var l=s[0],d=s[1],x=n.properties()[l.value],C=d.value;return typeof x==typeof C&&x>C}],"filter-id->":[wn,[Ir],function(n,s){var l=s[0],d=n.id(),x=l.value;return typeof d==typeof x&&d>x}],"filter-<=":[wn,[Hn,Ir],function(n,s){var l=s[0],d=s[1],x=n.properties()[l.value],C=d.value;return typeof x==typeof C&&x<=C}],"filter-id-<=":[wn,[Ir],function(n,s){var l=s[0],d=n.id(),x=l.value;return typeof d==typeof x&&d<=x}],"filter->=":[wn,[Hn,Ir],function(n,s){var l=s[0],d=s[1],x=n.properties()[l.value],C=d.value;return typeof x==typeof C&&x>=C}],"filter-id->=":[wn,[Ir],function(n,s){var l=s[0],d=n.id(),x=l.value;return typeof d==typeof x&&d>=x}],"filter-has":[wn,[Ir],function(n,s){return s[0].value in n.properties()}],"filter-has-id":[wn,[],function(n){return n.id()!==null&&n.id()!==void 0}],"filter-type-in":[wn,[pa(Hn)],function(n,s){return s[0].value.indexOf(n.geometryType())>=0}],"filter-id-in":[wn,[pa(Ir)],function(n,s){return s[0].value.indexOf(n.id())>=0}],"filter-in-small":[wn,[Hn,pa(Ir)],function(n,s){var l=s[0];return s[1].value.indexOf(n.properties()[l.value])>=0}],"filter-in-large":[wn,[Hn,pa(Ir)],function(n,s){var l=s[0],d=s[1];return function(x,C,T,L){for(;T<=L;){var U=T+L>>1;if(C[U]===x)return!0;C[U]>x?L=U-1:T=U+1}return!1}(n.properties()[l.value],d.value,0,d.value.length-1)}],all:{type:wn,overloads:[[[wn,wn],function(n,s){var l=s[1];return s[0].evaluate(n)&&l.evaluate(n)}],[Au(wn),function(n,s){for(var l=0,d=s;l<d.length;l+=1)if(!d[l].evaluate(n))return!1;return!0}]]},any:{type:wn,overloads:[[[wn,wn],function(n,s){var l=s[1];return s[0].evaluate(n)||l.evaluate(n)}],[Au(wn),function(n,s){for(var l=0,d=s;l<d.length;l+=1)if(d[l].evaluate(n))return!0;return!1}]]},"!":[wn,[wn],function(n,s){return!s[0].evaluate(n)}],"is-supported-script":[wn,[Hn],function(n,s){var l=n.globals&&n.globals.isSupportedScript;return!l||l(s[0].evaluate(n))}],upcase:[Hn,[Hn],function(n,s){return s[0].evaluate(n).toUpperCase()}],downcase:[Hn,[Hn],function(n,s){return s[0].evaluate(n).toLowerCase()}],concat:[Hn,Au(Ir),function(n,s){return s.map(function(l){return Yl(l.evaluate(n))}).join("")}],"resolved-locale":[Hn,[qi],function(n,s){return s[0].evaluate(n).resolvedLocale()}]});var _f=function(n,s){this.expression=n,this._warningHistory={},this._evaluator=new Ka,this._defaultValue=s?function(l){return l.type==="color"&&$s(l.default)?new Ea(0,0,0,0):l.type==="color"?Ea.parse(l.default)||null:l.default===void 0?null:l.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function Gf(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in gl}function Gc(n,s){var l=new Yu(gl,[],s?function(x){var C={color:Tn,string:Hn,number:Jt,enum:Hn,boolean:wn,formatted:La,resolvedImage:na};return x.type==="array"?pa(C[x.value]||Ir,x.length):C[x.type]}(s):void 0),d=l.parse(n,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?yf(new _f(d,s)):yl(l.errors)}_f.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,x,C){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)},_f.prototype.evaluate=function(n,s,l,d,x,C){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new po("Expected value to be one of "+Object.keys(this._enumValues).map(function(L){return JSON.stringify(L)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console!="undefined"&&console.warn(L.message)),this._defaultValue}};var Hf=function(n,s){this.kind=n,this._styleExpression=s,this.isStateDependent=n!=="constant"&&!hs(s.expression)};Hf.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,x,C){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,d,x,C)},Hf.prototype.evaluate=function(n,s,l,d,x,C){return this._styleExpression.evaluate(n,s,l,d,x,C)};var mc=function(n,s,l,d){this.kind=n,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!hs(s.expression),this.interpolationType=d};function xf(n,s){if((n=Gc(n,s)).result==="error")return n;var l=n.value.expression,d=zs(l);if(!d&&!qu(s))return yl([new jr("","data expressions not supported")]);var x=Is(l,["zoom"]);if(!x&&!Zh(s))return yl([new jr("","zoom expressions not supported")]);var C=function T(L){var U=null;if(L instanceof Zt)U=T(L.result);else if(L instanceof Mt)for(var X=0,$=L.args;X<$.length&&!(U=T($[X]));X+=1);else(L instanceof Cu||L instanceof Oe)&&L.input instanceof Uo&&L.input.name==="zoom"&&(U=L);return U instanceof jr||L.eachChild(function(ee){var le=T(ee);le instanceof jr?U=le:!U&&le?U=new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):U&&le&&U!==le&&(U=new jr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),U}(l);return C||x?C instanceof jr?yl([C]):C instanceof Oe&&!_l(s)?yl([new jr("",'"interpolate" expressions cannot be used with this property')]):yf(C?new mc(d?"camera":"composite",n.value,C.labels,C instanceof Oe?C.interpolation:void 0):new Hf(d?"constant":"source",n.value)):yl([new jr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}mc.prototype.evaluateWithoutErrorHandling=function(n,s,l,d,x,C){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,d,x,C)},mc.prototype.evaluate=function(n,s,l,d,x,C){return this._styleExpression.evaluate(n,s,l,d,x,C)},mc.prototype.interpolationFactor=function(n,s,l){return this.interpolationType?Oe.interpolationFactor(this.interpolationType,n,s,l):0};var $l=function(n,s){this._parameters=n,this._specification=s,Zr(this,function l(d,x){var C,T,L,U=x.type==="color",X=d.stops&&typeof d.stops[0][0]=="object",$=X||!(X||d.property!==void 0),ee=d.type||(_l(x)?"exponential":"interval");if(U&&((d=Zr({},d)).stops&&(d.stops=d.stops.map(function(Qn){return[Qn[0],Ea.parse(Qn[1])]})),d.default=Ea.parse(d.default?d.default:x.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!ne[d.colorSpace])throw new Error("Unknown color space: "+d.colorSpace);if(ee==="exponential")C=ch;else if(ee==="interval")C=mp;else if(ee==="categorical"){C=vp,T=Object.create(null);for(var le=0,Ee=d.stops;le<Ee.length;le+=1){var $e=Ee[le];T[$e[0]]=$e[1]}L=typeof d.stops[0][0]}else{if(ee!=="identity")throw new Error('Unknown function type "'+ee+'"');C=jf}if(X){for(var et={},mt=[],ut=0;ut<d.stops.length;ut++){var Ot=d.stops[ut],$t=Ot[0].zoom;et[$t]===void 0&&(et[$t]={zoom:$t,type:d.type,property:d.property,default:d.default,stops:[]},mt.push($t)),et[$t].stops.push([Ot[0].value,Ot[1]])}for(var dr=[],gr=0,Dr=mt;gr<Dr.length;gr+=1){var hn=Dr[gr];dr.push([et[hn].zoom,l(et[hn],x)])}var zn={name:"linear"};return{kind:"composite",interpolationType:zn,interpolationFactor:Oe.interpolationFactor.bind(void 0,zn),zoomStops:dr.map(function(Qn){return Qn[0]}),evaluate:function(Qn,Mi){var Jn=Qn.zoom;return ch({stops:dr,base:d.base},x,Jn).evaluate(Jn,Mi)}}}if($){var Ai=ee==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:Ai,interpolationFactor:Oe.interpolationFactor.bind(void 0,Ai),zoomStops:d.stops.map(function(Qn){return Qn[0]}),evaluate:function(Qn){return C(d,x,Qn.zoom,T,L)}}}return{kind:"source",evaluate:function(Qn,Mi){var Jn=Mi&&Mi.properties?Mi.properties[d.property]:void 0;return Jn===void 0?xl(d.default,x.default):C(d,x,Jn,T,L)}}}(this._parameters,this._specification))};function ou(n){var s=n.key,l=n.value,d=n.valueSpec||{},x=n.objectElementValidators||{},C=n.style,T=n.styleSpec,L=[],U=mo(l);if(U!=="object")return[new it(s,l,"object expected, "+U+" found")];for(var X in l){var $=X.split(".")[0],ee=d[$]||d["*"],le=void 0;if(x[$])le=x[$];else if(d[$])le=Aa;else if(x["*"])le=x["*"];else{if(!d["*"]){L.push(new it(s,l[X],'unknown property "'+X+'"'));continue}le=Aa}L=L.concat(le({key:(s&&s+".")+X,value:l[X],valueSpec:ee,style:C,styleSpec:T,object:l,objectKey:X},l))}for(var Ee in d)x[Ee]||d[Ee].required&&d[Ee].default===void 0&&l[Ee]===void 0&&L.push(new it(s,l,'missing required property "'+Ee+'"'));return L}function Wf(n){var s=n.value,l=n.valueSpec,d=n.style,x=n.styleSpec,C=n.key,T=n.arrayElementValidator||Aa;if(mo(s)!=="array")return[new it(C,s,"array expected, "+mo(s)+" found")];if(l.length&&s.length!==l.length)return[new it(C,s,"array length "+l.length+" expected, length "+s.length+" found")];if(l["min-length"]&&s.length<l["min-length"])return[new it(C,s,"array length at least "+l["min-length"]+" expected, length "+s.length+" found")];var L={type:l.value,values:l.values};x.$version<7&&(L.function=l.function),mo(l.value)==="object"&&(L=l.value);for(var U=[],X=0;X<s.length;X++)U=U.concat(T({array:s,arrayIndex:X,value:s[X],valueSpec:L,style:d,styleSpec:x,key:C+"["+X+"]"}));return U}function Xf(n){var s=n.key,l=n.value,d=n.valueSpec,x=mo(l);return x==="number"&&l!=l&&(x="NaN"),x!=="number"?[new it(s,l,"number expected, "+x+" found")]:"minimum"in d&&l<d.minimum?[new it(s,l,l+" is less than the minimum value "+d.minimum)]:"maximum"in d&&l>d.maximum?[new it(s,l,l+" is greater than the maximum value "+d.maximum)]:[]}function jh(n){var s,l,d,x=n.valueSpec,C=or(n.value.type),T={},L=C!=="categorical"&&n.value.property===void 0,U=!L,X=mo(n.value.stops)==="array"&&mo(n.value.stops[0])==="array"&&mo(n.value.stops[0][0])==="object",$=ou({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(Ee){if(C==="identity")return[new it(Ee.key,Ee.value,'identity function may not have a "stops" property')];var $e=[],et=Ee.value;return $e=$e.concat(Wf({key:Ee.key,value:et,valueSpec:Ee.valueSpec,style:Ee.style,styleSpec:Ee.styleSpec,arrayElementValidator:ee})),mo(et)==="array"&&et.length===0&&$e.push(new it(Ee.key,et,"array must have at least one stop")),$e},default:function(Ee){return Aa({key:Ee.key,value:Ee.value,valueSpec:x,style:Ee.style,styleSpec:Ee.styleSpec})}}});return C==="identity"&&L&&$.push(new it(n.key,n.value,'missing required property "property"')),C==="identity"||n.value.stops||$.push(new it(n.key,n.value,'missing required property "stops"')),C==="exponential"&&n.valueSpec.expression&&!_l(n.valueSpec)&&$.push(new it(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(U&&!qu(n.valueSpec)?$.push(new it(n.key,n.value,"property functions not supported")):L&&!Zh(n.valueSpec)&&$.push(new it(n.key,n.value,"zoom functions not supported"))),C!=="categorical"&&!X||n.value.property!==void 0||$.push(new it(n.key,n.value,'"property" property is required')),$;function ee(Ee){var $e=[],et=Ee.value,mt=Ee.key;if(mo(et)!=="array")return[new it(mt,et,"array expected, "+mo(et)+" found")];if(et.length!==2)return[new it(mt,et,"array length 2 expected, length "+et.length+" found")];if(X){if(mo(et[0])!=="object")return[new it(mt,et,"object expected, "+mo(et[0])+" found")];if(et[0].zoom===void 0)return[new it(mt,et,"object stop key must have zoom")];if(et[0].value===void 0)return[new it(mt,et,"object stop key must have value")];if(d&&d>or(et[0].zoom))return[new it(mt,et[0].zoom,"stop zoom values must appear in ascending order")];or(et[0].zoom)!==d&&(d=or(et[0].zoom),l=void 0,T={}),$e=$e.concat(ou({key:mt+"[0]",value:et[0],valueSpec:{zoom:{}},style:Ee.style,styleSpec:Ee.styleSpec,objectElementValidators:{zoom:Xf,value:le}}))}else $e=$e.concat(le({key:mt+"[0]",value:et[0],valueSpec:{},style:Ee.style,styleSpec:Ee.styleSpec},et));return Gf(hr(et[1]))?$e.concat([new it(mt+"[1]",et[1],"expressions are not allowed in function stops.")]):$e.concat(Aa({key:mt+"[1]",value:et[1],valueSpec:x,style:Ee.style,styleSpec:Ee.styleSpec}))}function le(Ee,$e){var et=mo(Ee.value),mt=or(Ee.value),ut=Ee.value!==null?Ee.value:$e;if(s){if(et!==s)return[new it(Ee.key,ut,et+" stop domain type must match previous stop domain type "+s)]}else s=et;if(et!=="number"&&et!=="string"&&et!=="boolean")return[new it(Ee.key,ut,"stop domain value must be a number, string, or boolean")];if(et!=="number"&&C!=="categorical"){var Ot="number expected, "+et+" found";return qu(x)&&C===void 0&&(Ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new it(Ee.key,ut,Ot)]}return C!=="categorical"||et!=="number"||isFinite(mt)&&Math.floor(mt)===mt?C!=="categorical"&&et==="number"&&l!==void 0&&mt<l?[new it(Ee.key,ut,"stop domain values must appear in ascending order")]:(l=mt,C==="categorical"&&mt in T?[new it(Ee.key,ut,"stop domain values must be unique")]:(T[mt]=!0,[])):[new it(Ee.key,ut,"integer expected, found "+mt)]}}function gc(n){var s=(n.expressionContext==="property"?xf:Gc)(hr(n.value),n.valueSpec);if(s.result==="error")return s.value.map(function(d){return new it(""+n.key+d.key,n.value,d.message)});var l=s.value.expression||s.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!l.outputDefined())return[new it(n.key,n.value,'Invalid data expression for "'+n.propertyKey+'". Output values must be contained as literals within the expression.')];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!hs(l))return[new it(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!hs(l))return[new it(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Is(l,["zoom","feature-state"]))return[new it(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!zs(l))return[new it(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $u(n){var s=n.key,l=n.value,d=n.valueSpec,x=[];return Array.isArray(d.values)?d.values.indexOf(or(l))===-1&&x.push(new it(s,l,"expected one of ["+d.values.join(", ")+"], "+JSON.stringify(l)+" found")):Object.keys(d.values).indexOf(or(l))===-1&&x.push(new it(s,l,"expected one of ["+Object.keys(d.values).join(", ")+"], "+JSON.stringify(l)+" found")),x}function Fl(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(var s=0,l=n.slice(1);s<l.length;s+=1){var d=l[s];if(!Fl(d)&&typeof d!="boolean")return!1}return!0;default:return!0}}$l.deserialize=function(n){return new $l(n._parameters,n._specification)},$l.serialize=function(n){return{_parameters:n._parameters,_specification:n._specification}};var Hc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Kl(n){if(n==null)return{filter:function(){return!0},needGeometry:!1};Fl(n)||(n=qf(n));var s=Gc(n,Hc);if(s.result==="error")throw new Error(s.value.map(function(l){return l.key+": "+l.message}).join(", "));return{filter:function(l,d,x){return s.value.evaluate(l,d,{},x)},needGeometry:function l(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(var x=1;x<d.length;x++)if(l(d[x]))return!0;return!1}(n)}}function Yf(n,s){return n<s?-1:n>s?1:0}function qf(n){if(!n)return!0;var s,l=n[0];return n.length<=1?l!=="any":l==="=="?yc(n[1],n[2],"=="):l==="!="?Wc(yc(n[1],n[2],"==")):l==="<"||l===">"||l==="<="||l===">="?yc(n[1],n[2],l):l==="any"?(s=n.slice(1),["any"].concat(s.map(qf))):l==="all"?["all"].concat(n.slice(1).map(qf)):l==="none"?["all"].concat(n.slice(1).map(qf).map(Wc)):l==="in"?Gh(n[1],n.slice(2)):l==="!in"?Wc(Gh(n[1],n.slice(2))):l==="has"?fh(n[1]):l==="!has"?Wc(fh(n[1])):l!=="within"||n}function yc(n,s,l){switch(n){case"$type":return["filter-type-"+l,s];case"$id":return["filter-id-"+l,s];default:return["filter-"+l,n,s]}}function Gh(n,s){if(s.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(l){return typeof l!=typeof s[0]})?["filter-in-large",n,["literal",s.sort(Yf)]]:["filter-in-small",n,["literal",s]]}}function fh(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Wc(n){return["!",n]}function Vp(n){return Fl(hr(n.value))?gc(Zr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(l){var d=l.value,x=l.key;if(mo(d)!=="array")return[new it(x,d,"array expected, "+mo(d)+" found")];var C,T=l.styleSpec,L=[];if(d.length<1)return[new it(x,d,"filter array must have at least 1 element")];switch(L=L.concat($u({key:x+"[0]",value:d[0],valueSpec:T.filter_operator,style:l.style,styleSpec:l.styleSpec})),or(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&or(d[1])==="$type"&&L.push(new it(x,d,'"$type" cannot be use with operator "'+d[0]+'"'));case"==":case"!=":d.length!==3&&L.push(new it(x,d,'filter array for operator "'+d[0]+'" must have 3 elements'));case"in":case"!in":d.length>=2&&(C=mo(d[1]))!=="string"&&L.push(new it(x+"[1]",d[1],"string expected, "+C+" found"));for(var U=2;U<d.length;U++)C=mo(d[U]),or(d[1])==="$type"?L=L.concat($u({key:x+"["+U+"]",value:d[U],valueSpec:T.geometry_type,style:l.style,styleSpec:l.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&L.push(new it(x+"["+U+"]",d[U],"string, number, or boolean expected, "+C+" found"));break;case"any":case"all":case"none":for(var X=1;X<d.length;X++)L=L.concat(s({key:x+"["+X+"]",value:d[X],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":C=mo(d[1]),d.length!==2?L.push(new it(x,d,'filter array for "'+d[0]+'" operator must have 2 elements')):C!=="string"&&L.push(new it(x+"[1]",d[1],"string expected, "+C+" found"));break;case"within":C=mo(d[1]),d.length!==2?L.push(new it(x,d,'filter array for "'+d[0]+'" operator must have 2 elements')):C!=="object"&&L.push(new it(x+"[1]",d[1],"object expected, "+C+" found"))}return L}(n)}function hh(n,s){var l=n.key,d=n.style,x=n.styleSpec,C=n.value,T=n.objectKey,L=x[s+"_"+n.layerType];if(!L)return[];var U=T.match(/^(.*)-transition$/);if(s==="paint"&&U&&L[U[1]]&&L[U[1]].transition)return Aa({key:l,value:C,valueSpec:x.transition,style:d,styleSpec:x});var X,$=n.valueSpec||L[T];if(!$)return[new it(l,C,'unknown property "'+T+'"')];if(mo(C)==="string"&&qu($)&&!$.tokens&&(X=/^{([^}]+)}$/.exec(C)))return[new it(l,C,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(X[1])+" }`.")];var ee=[];return n.layerType==="symbol"&&(T==="text-field"&&d&&!d.glyphs&&ee.push(new it(l,C,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&$s(hr(C))&&or(C.type)==="identity"&&ee.push(new it(l,C,'"text-font" does not support identity functions'))),ee.concat(Aa({key:n.key,value:C,valueSpec:$,style:d,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:T}))}function Hh(n){return hh(n,"paint")}function bf(n){return hh(n,"layout")}function jp(n){var s=[],l=n.value,d=n.key,x=n.style,C=n.styleSpec;l.type||l.ref||s.push(new it(d,l,'either "type" or "ref" is required'));var T,L=or(l.type),U=or(l.ref);if(l.id)for(var X=or(l.id),$=0;$<n.arrayIndex;$++){var ee=x.layers[$];or(ee.id)===X&&s.push(new it(d,l.id,'duplicate layer id "'+l.id+'", previously used at line '+ee.id.__line__))}if("ref"in l)["type","source","source-layer","filter","layout"].forEach(function($e){$e in l&&s.push(new it(d,l[$e],'"'+$e+'" is prohibited for ref layers'))}),x.layers.forEach(function($e){or($e.id)===U&&(T=$e)}),T?T.ref?s.push(new it(d,l.ref,"ref cannot reference another ref layer")):L=or(T.type):s.push(new it(d,l.ref,'ref layer "'+U+'" not found'));else if(L!=="background")if(l.source){var le=x.sources&&x.sources[l.source],Ee=le&&or(le.type);le?Ee==="vector"&&L==="raster"?s.push(new it(d,l.source,'layer "'+l.id+'" requires a raster source')):Ee==="raster"&&L!=="raster"?s.push(new it(d,l.source,'layer "'+l.id+'" requires a vector source')):Ee!=="vector"||l["source-layer"]?Ee==="raster-dem"&&L!=="hillshade"?s.push(new it(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="line"||!l.paint||!l.paint["line-gradient"]||Ee==="geojson"&&le.lineMetrics||s.push(new it(d,l,'layer "'+l.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new it(d,l,'layer "'+l.id+'" must specify a "source-layer"')):s.push(new it(d,l.source,'source "'+l.source+'" not found'))}else s.push(new it(d,l,'missing required property "source"'));return s=s.concat(ou({key:d,value:l,valueSpec:C.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Aa({key:d+".type",value:l.type,valueSpec:C.layer.type,style:n.style,styleSpec:n.styleSpec,object:l,objectKey:"type"})},filter:Vp,layout:function($e){return ou({layer:l,key:$e.key,value:$e.value,style:$e.style,styleSpec:$e.styleSpec,objectElementValidators:{"*":function(et){return bf(Zr({layerType:L},et))}}})},paint:function($e){return ou({layer:l,key:$e.key,value:$e.value,style:$e.style,styleSpec:$e.styleSpec,objectElementValidators:{"*":function(et){return Hh(Zr({layerType:L},et))}}})}}}))}function Xc(n){var s=n.value,l=n.key,d=mo(s);return d!=="string"?[new it(l,s,"string expected, "+d+" found")]:[]}var Ao={promoteId:function(n){var s=n.key,l=n.value;if(mo(l)==="string")return Xc({key:s,value:l});var d=[];for(var x in l)d.push.apply(d,Xc({key:s+"."+x,value:l[x]}));return d}};function Us(n){var s=n.value,l=n.key,d=n.styleSpec,x=n.style;if(!s.type)return[new it(l,s,'"type" is required')];var C,T=or(s.type);switch(T){case"vector":case"raster":case"raster-dem":return ou({key:l,value:s,valueSpec:d["source_"+T.replace("-","_")],style:n.style,styleSpec:d,objectElementValidators:Ao});case"geojson":if(C=ou({key:l,value:s,valueSpec:d.source_geojson,style:x,styleSpec:d,objectElementValidators:Ao}),s.cluster)for(var L in s.clusterProperties){var U=s.clusterProperties[L],X=U[0],$=typeof X=="string"?[X,["accumulated"],["get",L]]:X;C.push.apply(C,gc({key:l+"."+L+".map",value:U[1],expressionContext:"cluster-map"})),C.push.apply(C,gc({key:l+"."+L+".reduce",value:$,expressionContext:"cluster-reduce"}))}return C;case"video":return ou({key:l,value:s,valueSpec:d.source_video,style:x,styleSpec:d});case"image":return ou({key:l,value:s,valueSpec:d.source_image,style:x,styleSpec:d});case"canvas":return[new it(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $u({key:l+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:d})}}function Yc(n){var s=n.value,l=n.styleSpec,d=l.light,x=n.style,C=[],T=mo(s);if(s===void 0)return C;if(T!=="object")return C.concat([new it("light",s,"object expected, "+T+" found")]);for(var L in s){var U=L.match(/^(.*)-transition$/);C=C.concat(U&&d[U[1]]&&d[U[1]].transition?Aa({key:L,value:s[L],valueSpec:l.transition,style:x,styleSpec:l}):d[L]?Aa({key:L,value:s[L],valueSpec:d[L],style:x,styleSpec:l}):[new it(L,s[L],'unknown property "'+L+'"')])}return C}var ka={"*":function(){return[]},array:Wf,boolean:function(n){var s=n.value,l=n.key,d=mo(s);return d!=="boolean"?[new it(l,s,"boolean expected, "+d+" found")]:[]},number:Xf,color:function(n){var s=n.key,l=n.value,d=mo(l);return d!=="string"?[new it(s,l,"color expected, "+d+" found")]:zi(l)===null?[new it(s,l,'color expected, "'+l+'" found')]:[]},constants:Gt,enum:$u,filter:Vp,function:jh,layer:jp,object:ou,source:Us,light:Yc,string:Xc,formatted:function(n){return Xc(n).length===0?[]:gc(n)},resolvedImage:function(n){return Xc(n).length===0?[]:gc(n)}};function Aa(n){var s=n.value,l=n.valueSpec,d=n.styleSpec;return l.expression&&$s(or(s))?jh(n):l.expression&&Gf(hr(s))?gc(n):l.type&&ka[l.type]?ka[l.type](n):ou(Zr({},n,{valueSpec:l.type?d[l.type]:l}))}function wo(n){var s=n.value,l=n.key,d=Xc(n);return d.length||(s.indexOf("{fontstack}")===-1&&d.push(new it(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&d.push(new it(l,s,'"glyphs" url must include a "{range}" token'))),d}function pu(n,s){s===void 0&&(s=Me);var l=[];return l=l.concat(Aa({key:"",value:n,valueSpec:s.$root,styleSpec:s,style:n,objectElementValidators:{glyphs:wo,"*":function(){return[]}}})),n.constants&&(l=l.concat(Gt({key:"constants",value:n.constants,style:n,styleSpec:s}))),Ef(l)}function Ef(n){return[].concat(n).sort(function(s,l){return s.line-l.line})}function Ql(n){return function(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];return Ef(n.apply(this,s))}}pu.source=Ql(Us),pu.light=Ql(Yc),pu.layer=Ql(jp),pu.filter=Ql(Vp),pu.paintProperty=Ql(Hh),pu.layoutProperty=Ql(bf);var ph=pu,Qa=ph.light,Cf=ph.paintProperty,Dl=ph.layoutProperty;function _c(n,s){var l=!1;if(s&&s.length)for(var d=0,x=s;d<x.length;d+=1)n.fire(new st(new Error(x[d].message))),l=!0;return l}var Jl=ds;function ds(n,s,l){var d=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var x=new Int32Array(this.arrayBuffer);n=x[0],this.d=(s=x[1])+2*(l=x[2]);for(var C=0;C<this.d*this.d;C++){var T=x[3+C],L=x[3+C+1];d.push(T===L?null:x.subarray(T,L))}var U=x[3+d.length+1];this.keys=x.subarray(x[3+d.length],U),this.bboxes=x.subarray(U),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var X=0;X<this.d*this.d;X++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=n,this.padding=l,this.scale=s/n,this.uid=0;var $=l/s*n;this.min=-$,this.max=n+$}ds.prototype.insert=function(n,s,l,d,x){this._forEachCell(s,l,d,x,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(x)},ds.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ds.prototype._insertCell=function(n,s,l,d,x,C){this.cells[x].push(C)},ds.prototype.query=function(n,s,l,d,x){var C=this.min,T=this.max;if(n<=C&&s<=C&&T<=l&&T<=d&&!x)return Array.prototype.slice.call(this.keys);var L=[];return this._forEachCell(n,s,l,d,this._queryCell,L,{},x),L},ds.prototype._queryCell=function(n,s,l,d,x,C,T,L){var U=this.cells[x];if(U!==null)for(var X=this.keys,$=this.bboxes,ee=0;ee<U.length;ee++){var le=U[ee];if(T[le]===void 0){var Ee=4*le;(L?L($[Ee+0],$[Ee+1],$[Ee+2],$[Ee+3]):n<=$[Ee+2]&&s<=$[Ee+3]&&l>=$[Ee+0]&&d>=$[Ee+1])?(T[le]=!0,C.push(X[le])):T[le]=!1}}},ds.prototype._forEachCell=function(n,s,l,d,x,C,T,L){for(var U=this._convertToCellCoord(n),X=this._convertToCellCoord(s),$=this._convertToCellCoord(l),ee=this._convertToCellCoord(d),le=U;le<=$;le++)for(var Ee=X;Ee<=ee;Ee++){var $e=this.d*Ee+le;if((!L||L(this._convertFromCellCoord(le),this._convertFromCellCoord(Ee),this._convertFromCellCoord(le+1),this._convertFromCellCoord(Ee+1)))&&x.call(this,n,s,l,d,$e,C,T,L))return}},ds.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},ds.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},ds.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,s=3+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var x=new Int32Array(s+l+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var C=s,T=0;T<n.length;T++){var L=n[T];x[3+T]=C,x.set(L,C),C+=L.length}return x[3+n.length]=C,x.set(this.keys,C),x[3+n.length+1]=C+=this.keys.length,x.set(this.bboxes,C),C+=this.bboxes.length,x.buffer};var Ku=we.ImageData,Sf=we.ImageBitmap,Vo={};function ti(n,s,l){l===void 0&&(l={}),Object.defineProperty(s,"_classRegistryKey",{value:n,writeable:!1}),Vo[n]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}for(var Xo in ti("Object",Object),Jl.serialize=function(n,s){var l=n.toArrayBuffer();return s&&s.push(l),{buffer:l}},Jl.deserialize=function(n){return new Jl(n.buffer)},ti("Grid",Jl),ti("Color",Ea),ti("Error",Error),ti("ResolvedImage",bt),ti("StylePropertyFunction",$l),ti("StyleExpression",_f,{omit:["_evaluator"]}),ti("ZoomDependentExpression",mc),ti("ZoomConstantExpression",Hf),ti("CompoundExpression",Uo,{omit:["_evaluate"]}),gl)gl[Xo]._classRegistryKey||ti("Expression_"+Xo,gl[Xo]);function qc(n){return n&&typeof ArrayBuffer!="undefined"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Af(n){return Sf&&n instanceof Sf}function Ja(n,s){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(qc(n)||Af(n))return s&&s.push(n),n;if(ArrayBuffer.isView(n)){var l=n;return s&&s.push(l.buffer),l}if(n instanceof Ku)return s&&s.push(n.data.buffer),n;if(Array.isArray(n)){for(var d=[],x=0,C=n;x<C.length;x+=1)d.push(Ja(C[x],s));return d}if(typeof n=="object"){var T=n.constructor,L=T._classRegistryKey;if(!L)throw new Error("can't serialize object of unregistered class");var U=T.serialize?T.serialize(n,s):{};if(!T.serialize){for(var X in n)if(n.hasOwnProperty(X)&&!(Vo[L].omit.indexOf(X)>=0)){var $=n[X];U[X]=Vo[L].shallow.indexOf(X)>=0?$:Ja($,s)}n instanceof Error&&(U.message=n.message)}if(U.$name)throw new Error("$name property is reserved for worker serialization logic.");return L!=="Object"&&(U.$name=L),U}throw new Error("can't serialize object of type "+typeof n)}function Bu(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||qc(n)||Af(n)||ArrayBuffer.isView(n)||n instanceof Ku)return n;if(Array.isArray(n))return n.map(Bu);if(typeof n=="object"){var s=n.$name||"Object",l=Vo[s].klass;if(!l)throw new Error("can't deserialize unregistered class "+s);if(l.deserialize)return l.deserialize(n);for(var d=Object.create(l.prototype),x=0,C=Object.keys(n);x<C.length;x+=1){var T=C[x];if(T!=="$name"){var L=n[T];d[T]=Vo[s].shallow.indexOf(T)>=0?L:Bu(L)}}return d}throw new Error("can't deserialize object of type "+typeof n)}var xc=function(){this.first=!0};xc.prototype.update=function(n,s){var l=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=l,!0))};var Mn={"Latin-1 Supplement":function(n){return n>=128&&n<=255},Arabic:function(n){return n>=1536&&n<=1791},"Arabic Supplement":function(n){return n>=1872&&n<=1919},"Arabic Extended-A":function(n){return n>=2208&&n<=2303},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},Khmer:function(n){return n>=6016&&n<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Arabic Presentation Forms-A":function(n){return n>=64336&&n<=65023},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Arabic Presentation Forms-B":function(n){return n>=65136&&n<=65279},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};function wf(n){for(var s=0,l=n;s<l.length;s+=1)if(dh(l[s].charCodeAt(0)))return!0;return!1}function dh(n){return!(n!==746&&n!==747&&(n<4352||!(Mn["Bopomofo Extended"](n)||Mn.Bopomofo(n)||Mn["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Mn["CJK Compatibility Ideographs"](n)||Mn["CJK Compatibility"](n)||Mn["CJK Radicals Supplement"](n)||Mn["CJK Strokes"](n)||!(!Mn["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Mn["CJK Unified Ideographs Extension A"](n)||Mn["CJK Unified Ideographs"](n)||Mn["Enclosed CJK Letters and Months"](n)||Mn["Hangul Compatibility Jamo"](n)||Mn["Hangul Jamo Extended-A"](n)||Mn["Hangul Jamo Extended-B"](n)||Mn["Hangul Jamo"](n)||Mn["Hangul Syllables"](n)||Mn.Hiragana(n)||Mn["Ideographic Description Characters"](n)||Mn.Kanbun(n)||Mn["Kangxi Radicals"](n)||Mn["Katakana Phonetic Extensions"](n)||Mn.Katakana(n)&&n!==12540||!(!Mn["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Mn["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Mn["Unified Canadian Aboriginal Syllabics"](n)||Mn["Unified Canadian Aboriginal Syllabics Extended"](n)||Mn["Vertical Forms"](n)||Mn["Yijing Hexagram Symbols"](n)||Mn["Yi Syllables"](n)||Mn["Yi Radicals"](n))))}function bl(n){return!(dh(n)||function(s){return!!(Mn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Mn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Mn["Letterlike Symbols"](s)||Mn["Number Forms"](s)||Mn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Mn["Control Pictures"](s)&&s!==9251||Mn["Optical Character Recognition"](s)||Mn["Enclosed Alphanumerics"](s)||Mn["Geometric Shapes"](s)||Mn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Mn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Mn["CJK Symbols and Punctuation"](s)||Mn.Katakana(s)||Mn["Private Use Area"](s)||Mn["CJK Compatibility Forms"](s)||Mn["Small Form Variants"](s)||Mn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(n))}function ho(n){return n>=1424&&n<=2303||Mn["Arabic Presentation Forms-A"](n)||Mn["Arabic Presentation Forms-B"](n)}function du(n,s){return!(!s&&ho(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Mn.Khmer(n))}function Va(n){for(var s=0,l=n;s<l.length;s+=1)if(ho(l[s].charCodeAt(0)))return!0;return!1}var Bl=null,wu="unavailable",Nl=null,$f=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(wu="error"),Bl&&Bl(n)};function $c(){gp.fire(new qe("pluginStateChange",{pluginStatus:wu,pluginURL:Nl}))}var gp=new xt,yi=function(){return wu},ll=function(){if(wu!=="deferred"||!Nl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");wu="loading",$c(),Nl&&Ci({url:Nl},function(n){n?$f(n):(wu="loaded",$c())})},Ks={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return wu==="loaded"||Ks.applyArabicShaping!=null},isLoading:function(){return wu==="loading"},setState:function(n){wu=n.pluginStatus,Nl=n.pluginURL},isParsed:function(){return Ks.applyArabicShaping!=null&&Ks.processBidirectionalText!=null&&Ks.processStyledBidirectionalText!=null},getPluginURL:function(){return Nl}},ha=function(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new xc,this.transition={})};ha.prototype.isSupportedScript=function(n){return function(s,l){for(var d=0,x=s;d<x.length;d+=1)if(!du(x[d].charCodeAt(0),l))return!1;return!0}(n,Ks.isLoaded())},ha.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ha.prototype.getCrossfadeParameters=function(){var n=this.zoom,s=n-Math.floor(n),l=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}};var cl=function(n,s){this.property=n,this.value=s,this.expression=function(l,d){if($s(l))return new $l(l,d);if(Gf(l)){var x=xf(l,d);if(x.result==="error")throw new Error(x.value.map(function(T){return T.key+": "+T.message}).join(", "));return x.value}var C=l;return typeof l=="string"&&d.type==="color"&&(C=Ea.parse(l)),{kind:"constant",evaluate:function(){return C}}}(s===void 0?n.specification.default:s,n.specification)};cl.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},cl.prototype.possiblyEvaluate=function(n,s,l){return this.property.possiblyEvaluate(this,n,s,l)};var vu=function(n){this.property=n,this.value=new cl(n,void 0)};vu.prototype.transitioned=function(n,s){return new Tf(this.property,this.value,s,Wt({},n.transition,this.transition),n.now)},vu.prototype.untransitioned=function(){return new Tf(this.property,this.value,null,{},0)};var Zs=function(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)};Zs.prototype.getValue=function(n){return _t(this._values[n].value.value)},Zs.prototype.setValue=function(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new vu(this._values[n].property)),this._values[n].value=new cl(this._values[n].property,s===null?void 0:_t(s))},Zs.prototype.getTransition=function(n){return _t(this._values[n].transition)},Zs.prototype.setTransition=function(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new vu(this._values[n].property)),this._values[n].transition=_t(s)||void 0},Zs.prototype.serialize=function(){for(var n={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s],x=this.getValue(d);x!==void 0&&(n[d]=x);var C=this.getTransition(d);C!==void 0&&(n[d+"-transition"]=C)}return n},Zs.prototype.transitioned=function(n,s){for(var l=new bc(this._properties),d=0,x=Object.keys(this._values);d<x.length;d+=1){var C=x[d];l._values[C]=this._values[C].transitioned(n,s._values[C])}return l},Zs.prototype.untransitioned=function(){for(var n=new bc(this._properties),s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s];n._values[d]=this._values[d].untransitioned()}return n};var Tf=function(n,s,l,d,x){this.property=n,this.value=s,this.begin=x+d.delay||0,this.end=this.begin+d.duration||0,n.specification.transition&&(d.delay||d.duration)&&(this.prior=l)};Tf.prototype.possiblyEvaluate=function(n,s,l){var d=n.now||0,x=this.value.possiblyEvaluate(n,s,l),C=this.prior;if(C){if(d>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(d<this.begin)return C.possiblyEvaluate(n,s,l);var T=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(n,s,l),x,function(L){if(L<=0)return 0;if(L>=1)return 1;var U=L*L,X=U*L;return 4*(L<.5?X:3*(L-U)+X-.75)}(T))}return x};var bc=function(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)};bc.prototype.possiblyEvaluate=function(n,s,l){for(var d=new Qu(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var T=C[x];d._values[T]=this._values[T].possiblyEvaluate(n,s,l)}return d},bc.prototype.hasTransition=function(){for(var n=0,s=Object.keys(this._values);n<s.length;n+=1)if(this._values[s[n]].prior)return!0;return!1};var Tu=function(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)};Tu.prototype.getValue=function(n){return _t(this._values[n].value)},Tu.prototype.setValue=function(n,s){this._values[n]=new cl(this._values[n].property,s===null?void 0:_t(s))},Tu.prototype.serialize=function(){for(var n={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s],x=this.getValue(d);x!==void 0&&(n[d]=x)}return n},Tu.prototype.possiblyEvaluate=function(n,s,l){for(var d=new Qu(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var T=C[x];d._values[T]=this._values[T].possiblyEvaluate(n,s,l)}return d};var mu=function(n,s,l){this.property=n,this.value=s,this.parameters=l};mu.prototype.isConstant=function(){return this.value.kind==="constant"},mu.prototype.constantOr=function(n){return this.value.kind==="constant"?this.value.value:n},mu.prototype.evaluate=function(n,s,l,d){return this.property.evaluate(this.value,this.parameters,n,s,l,d)};var Qu=function(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)};Qu.prototype.get=function(n){return this._values[n]};var bi=function(n){this.specification=n};bi.prototype.possiblyEvaluate=function(n,s){return n.expression.evaluate(s)},bi.prototype.interpolate=function(n,s,l){var d=ps[this.specification.type];return d?d(n,s,l):n};var pi=function(n,s){this.specification=n,this.overrides=s};pi.prototype.possiblyEvaluate=function(n,s,l,d){return new mu(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},l,d)}:n.expression,s)},pi.prototype.interpolate=function(n,s,l){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new mu(this,{kind:"constant",value:void 0},n.parameters);var d=ps[this.specification.type];return d?new mu(this,{kind:"constant",value:d(n.value.value,s.value.value,l)},n.parameters):n},pi.prototype.evaluate=function(n,s,l,d,x,C){return n.kind==="constant"?n.value:n.evaluate(s,l,d,x,C)};var Kf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,d,x,C){if(l.value===void 0)return new mu(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){var T=l.expression.evaluate(d,null,{},x,C),L=l.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,U=this._calculate(L,L,L,d);return new mu(this,{kind:"constant",value:U},d)}if(l.expression.kind==="camera"){var X=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new mu(this,{kind:"constant",value:X},d)}return new mu(this,l.expression,d)},s.prototype.evaluate=function(l,d,x,C,T,L){if(l.kind==="source"){var U=l.evaluate(d,x,C,T,L);return this._calculate(U,U,U,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},x,C),l.evaluate({zoom:Math.floor(d.zoom)},x,C),l.evaluate({zoom:Math.floor(d.zoom)+1},x,C),d):l.value},s.prototype._calculate=function(l,d,x,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:x,to:d}},s.prototype.interpolate=function(l){return l},s}(pi),Vs=function(n){this.specification=n};Vs.prototype.possiblyEvaluate=function(n,s,l,d){if(n.value!==void 0){if(n.expression.kind==="constant"){var x=n.expression.evaluate(s,null,{},l,d);return this._calculate(x,x,x,s)}return this._calculate(n.expression.evaluate(new ha(Math.floor(s.zoom-1),s)),n.expression.evaluate(new ha(Math.floor(s.zoom),s)),n.expression.evaluate(new ha(Math.floor(s.zoom+1),s)),s)}},Vs.prototype._calculate=function(n,s,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:l,to:s}},Vs.prototype.interpolate=function(n){return n};var fl=function(n){this.specification=n};fl.prototype.possiblyEvaluate=function(n,s,l,d){return!!n.expression.evaluate(s,null,{},l,d)},fl.prototype.interpolate=function(){return!1};var es=function(n){for(var s in this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],n){var l=n[s];l.specification.overridable&&this.overridableProperties.push(s);var d=this.defaultPropertyValues[s]=new cl(l,void 0),x=this.defaultTransitionablePropertyValues[s]=new vu(l);this.defaultTransitioningPropertyValues[s]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}};ti("DataDrivenProperty",pi),ti("DataConstantProperty",bi),ti("CrossFadedDataDrivenProperty",Kf),ti("CrossFadedProperty",Vs),ti("ColorRampProperty",fl);var El=function(n){function s(l,d){if(n.call(this),this.id=l.id,this.type=l.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new Tu(d.layout)),d.paint)){for(var x in this._transitionablePaint=new Zs(d.paint),l.paint)this.setPaintProperty(x,l.paint[x],{validate:!1});for(var C in l.layout)this.setLayoutProperty(C,l.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qu(d.paint)}}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)},s.prototype.setLayoutProperty=function(l,d,x){x===void 0&&(x={}),d!=null&&this._validate(Dl,"layers."+this.id+".layout."+l,l,d,x)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)},s.prototype.getPaintProperty=function(l){return re(l,"-transition")?this._transitionablePaint.getTransition(l.slice(0,-"-transition".length)):this._transitionablePaint.getValue(l)},s.prototype.setPaintProperty=function(l,d,x){if(x===void 0&&(x={}),d!=null&&this._validate(Cf,"layers."+this.id+".paint."+l,l,d,x))return!1;if(re(l,"-transition"))return this._transitionablePaint.setTransition(l.slice(0,-"-transition".length),d||void 0),!1;var C=this._transitionablePaint._values[l],T=C.property.specification["property-type"]==="cross-faded-data-driven",L=C.value.isDataDriven(),U=C.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);var X=this._transitionablePaint._values[l].value;return X.isDataDriven()||L||T||this._handleOverridablePaintPropertyUpdate(l,U,X)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){},s.prototype._handleOverridablePaintPropertyUpdate=function(l,d,x){return!1},s.prototype.isHidden=function(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)},s.prototype.serialize=function(){var l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Rt(l,function(d,x){return!(d===void 0||x==="layout"&&!Object.keys(d).length||x==="paint"&&!Object.keys(d).length)})},s.prototype._validate=function(l,d,x,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&_c(this,l.call(ph,{key:d,layerType:this.type,objectKey:x,value:C,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var l in this.paint._values){var d=this.paint.get(l);if(d instanceof mu&&qu(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1},s}(xt),vh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Mf=function(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ja=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function yo(n,s){s===void 0&&(s=1);var l=0,d=0;return{members:n.map(function(x){var C=vh[x.type].BYTES_PER_ELEMENT,T=l=mh(l,Math.max(s,C)),L=x.components||1;return d=Math.max(d,C),l+=C*L,{name:x.name,type:x.type,components:L,offset:T}}),size:mh(l,Math.max(d,s)),alignment:s}}function mh(n,s){return Math.ceil(n/s)*s}ja.serialize=function(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}},ja.deserialize=function(n){var s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},ja.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ja.prototype.clear=function(){this.length=0},ja.prototype.resize=function(n){this.reserve(n),this.length=n},ja.prototype.reserve=function(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},ja.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Qf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.int16[C+0]=d,this.int16[C+1]=x,l},s}(ja);Qf.prototype.bytesPerElement=4,ti("StructArrayLayout2i4",Qf);var hl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var L=4*l;return this.int16[L+0]=d,this.int16[L+1]=x,this.int16[L+2]=C,this.int16[L+3]=T,l},s}(ja);hl.prototype.bytesPerElement=8,ti("StructArrayLayout4i8",hl);var Ju=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,L){var U=this.length;return this.resize(U+1),this.emplace(U,l,d,x,C,T,L)},s.prototype.emplace=function(l,d,x,C,T,L,U){var X=6*l;return this.int16[X+0]=d,this.int16[X+1]=x,this.int16[X+2]=C,this.int16[X+3]=T,this.int16[X+4]=L,this.int16[X+5]=U,l},s}(ja);Ju.prototype.bytesPerElement=12,ti("StructArrayLayout2i4i12",Ju);var Qs=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,L){var U=this.length;return this.resize(U+1),this.emplace(U,l,d,x,C,T,L)},s.prototype.emplace=function(l,d,x,C,T,L,U){var X=4*l,$=8*l;return this.int16[X+0]=d,this.int16[X+1]=x,this.uint8[$+4]=C,this.uint8[$+5]=T,this.uint8[$+6]=L,this.uint8[$+7]=U,l},s}(ja);Qs.prototype.bytesPerElement=8,ti("StructArrayLayout2i4ub8",Qs);var pl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.float32[C+0]=d,this.float32[C+1]=x,l},s}(ja);pl.prototype.bytesPerElement=8,ti("StructArrayLayout2f8",pl);var zl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,L,U,X,$,ee){var le=this.length;return this.resize(le+1),this.emplace(le,l,d,x,C,T,L,U,X,$,ee)},s.prototype.emplace=function(l,d,x,C,T,L,U,X,$,ee,le){var Ee=10*l;return this.uint16[Ee+0]=d,this.uint16[Ee+1]=x,this.uint16[Ee+2]=C,this.uint16[Ee+3]=T,this.uint16[Ee+4]=L,this.uint16[Ee+5]=U,this.uint16[Ee+6]=X,this.uint16[Ee+7]=$,this.uint16[Ee+8]=ee,this.uint16[Ee+9]=le,l},s}(ja);zl.prototype.bytesPerElement=20,ti("StructArrayLayout10ui20",zl);var gh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,L,U,X,$,ee,le,Ee){var $e=this.length;return this.resize($e+1),this.emplace($e,l,d,x,C,T,L,U,X,$,ee,le,Ee)},s.prototype.emplace=function(l,d,x,C,T,L,U,X,$,ee,le,Ee,$e){var et=12*l;return this.int16[et+0]=d,this.int16[et+1]=x,this.int16[et+2]=C,this.int16[et+3]=T,this.uint16[et+4]=L,this.uint16[et+5]=U,this.uint16[et+6]=X,this.uint16[et+7]=$,this.int16[et+8]=ee,this.int16[et+9]=le,this.int16[et+10]=Ee,this.int16[et+11]=$e,l},s}(ja);gh.prototype.bytesPerElement=24,ti("StructArrayLayout4i4ui4i24",gh);var Yo=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.float32[T+0]=d,this.float32[T+1]=x,this.float32[T+2]=C,l},s}(ja);Yo.prototype.bytesPerElement=12,ti("StructArrayLayout3f12",Yo);var yh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.uint32[1*l+0]=d,l},s}(ja);yh.prototype.bytesPerElement=4,ti("StructArrayLayout1ul4",yh);var Wh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,L,U,X,$){var ee=this.length;return this.resize(ee+1),this.emplace(ee,l,d,x,C,T,L,U,X,$)},s.prototype.emplace=function(l,d,x,C,T,L,U,X,$,ee){var le=10*l,Ee=5*l;return this.int16[le+0]=d,this.int16[le+1]=x,this.int16[le+2]=C,this.int16[le+3]=T,this.int16[le+4]=L,this.int16[le+5]=U,this.uint32[Ee+3]=X,this.uint16[le+8]=$,this.uint16[le+9]=ee,l},s}(ja);Wh.prototype.bytesPerElement=20,ti("StructArrayLayout6i1ul2ui20",Wh);var If=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,L){var U=this.length;return this.resize(U+1),this.emplace(U,l,d,x,C,T,L)},s.prototype.emplace=function(l,d,x,C,T,L,U){var X=6*l;return this.int16[X+0]=d,this.int16[X+1]=x,this.int16[X+2]=C,this.int16[X+3]=T,this.int16[X+4]=L,this.int16[X+5]=U,l},s}(ja);If.prototype.bytesPerElement=12,ti("StructArrayLayout2i2i2i12",If);var Kc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T){var L=this.length;return this.resize(L+1),this.emplace(L,l,d,x,C,T)},s.prototype.emplace=function(l,d,x,C,T,L){var U=4*l,X=8*l;return this.float32[U+0]=d,this.float32[U+1]=x,this.float32[U+2]=C,this.int16[X+6]=T,this.int16[X+7]=L,l},s}(ja);Kc.prototype.bytesPerElement=16,ti("StructArrayLayout2f1f2i16",Kc);var Xh=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var L=12*l,U=3*l;return this.uint8[L+0]=d,this.uint8[L+1]=x,this.float32[U+1]=C,this.float32[U+2]=T,l},s}(ja);Xh.prototype.bytesPerElement=12,ti("StructArrayLayout2ub2f12",Xh);var dl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.uint16[T+0]=d,this.uint16[T+1]=x,this.uint16[T+2]=C,l},s}(ja);dl.prototype.bytesPerElement=6,ti("StructArrayLayout3ui6",dl);var Cl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,L,U,X,$,ee,le,Ee,$e,et,mt,ut,Ot){var $t=this.length;return this.resize($t+1),this.emplace($t,l,d,x,C,T,L,U,X,$,ee,le,Ee,$e,et,mt,ut,Ot)},s.prototype.emplace=function(l,d,x,C,T,L,U,X,$,ee,le,Ee,$e,et,mt,ut,Ot,$t){var dr=24*l,gr=12*l,Dr=48*l;return this.int16[dr+0]=d,this.int16[dr+1]=x,this.uint16[dr+2]=C,this.uint16[dr+3]=T,this.uint32[gr+2]=L,this.uint32[gr+3]=U,this.uint32[gr+4]=X,this.uint16[dr+10]=$,this.uint16[dr+11]=ee,this.uint16[dr+12]=le,this.float32[gr+7]=Ee,this.float32[gr+8]=$e,this.uint8[Dr+36]=et,this.uint8[Dr+37]=mt,this.uint8[Dr+38]=ut,this.uint32[gr+10]=Ot,this.int16[dr+22]=$t,l},s}(ja);Cl.prototype.bytesPerElement=48,ti("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Cl);var Qc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,L,U,X,$,ee,le,Ee,$e,et,mt,ut,Ot,$t,dr,gr,Dr,hn,zn,Ai,Qn,Mi,Jn,va){var Wi=this.length;return this.resize(Wi+1),this.emplace(Wi,l,d,x,C,T,L,U,X,$,ee,le,Ee,$e,et,mt,ut,Ot,$t,dr,gr,Dr,hn,zn,Ai,Qn,Mi,Jn,va)},s.prototype.emplace=function(l,d,x,C,T,L,U,X,$,ee,le,Ee,$e,et,mt,ut,Ot,$t,dr,gr,Dr,hn,zn,Ai,Qn,Mi,Jn,va,Wi){var di=34*l,Ra=17*l;return this.int16[di+0]=d,this.int16[di+1]=x,this.int16[di+2]=C,this.int16[di+3]=T,this.int16[di+4]=L,this.int16[di+5]=U,this.int16[di+6]=X,this.int16[di+7]=$,this.uint16[di+8]=ee,this.uint16[di+9]=le,this.uint16[di+10]=Ee,this.uint16[di+11]=$e,this.uint16[di+12]=et,this.uint16[di+13]=mt,this.uint16[di+14]=ut,this.uint16[di+15]=Ot,this.uint16[di+16]=$t,this.uint16[di+17]=dr,this.uint16[di+18]=gr,this.uint16[di+19]=Dr,this.uint16[di+20]=hn,this.uint16[di+21]=zn,this.uint16[di+22]=Ai,this.uint32[Ra+12]=Qn,this.float32[Ra+13]=Mi,this.float32[Ra+14]=Jn,this.float32[Ra+15]=va,this.float32[Ra+16]=Wi,l},s}(ja);Qc.prototype.bytesPerElement=68,ti("StructArrayLayout8i15ui1ul4f68",Qc);var ec=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.float32[1*l+0]=d,l},s}(ja);ec.prototype.bytesPerElement=4,ti("StructArrayLayout1f4",ec);var el=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.int16[T+0]=d,this.int16[T+1]=x,this.int16[T+2]=C,l},s}(ja);el.prototype.bytesPerElement=6,ti("StructArrayLayout3i6",el);var kf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=4*l;return this.uint32[2*l+0]=d,this.uint16[T+2]=x,this.uint16[T+3]=C,l},s}(ja);kf.prototype.bytesPerElement=8,ti("StructArrayLayout1ul2ui8",kf);var Pf=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.uint16[C+0]=d,this.uint16[C+1]=x,l},s}(ja);Pf.prototype.bytesPerElement=4,ti("StructArrayLayout2ui4",Pf);var Gp=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.uint16[1*l+0]=d,l},s}(ja);Gp.prototype.bytesPerElement=2,ti("StructArrayLayout1ui2",Gp);var Jc=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var L=4*l;return this.float32[L+0]=d,this.float32[L+1]=x,this.float32[L+2]=C,this.float32[L+3]=T,l},s}(ja);Jc.prototype.bytesPerElement=16,ti("StructArrayLayout4f16",Jc);var c=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return l.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},l.x1.get=function(){return this._structArray.int16[this._pos2+2]},l.y1.get=function(){return this._structArray.int16[this._pos2+3]},l.x2.get=function(){return this._structArray.int16[this._pos2+4]},l.y2.get=function(){return this._structArray.int16[this._pos2+5]},l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.anchorPoint.get=function(){return new pe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,l),s}(Mf);c.prototype.size=20;var h=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new c(this,l)},s}(Wh);ti("CollisionBoxArray",h);var f=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},l.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},l.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},l.segment.get=function(){return this._structArray.uint16[this._pos2+10]},l.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},l.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},l.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},l.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},l.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},l.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},l.placedOrientation.set=function(d){this._structArray.uint8[this._pos1+37]=d},l.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},l.hidden.set=function(d){this._structArray.uint8[this._pos1+38]=d},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},l.crossTileID.set=function(d){this._structArray.uint32[this._pos4+10]=d},l.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,l),s}(Mf);f.prototype.size=48;var m=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new f(this,l)},s}(Cl);ti("PlacedSymbolArray",m);var S=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},l.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},l.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},l.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},l.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},l.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},l.key.get=function(){return this._structArray.uint16[this._pos2+8]},l.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},l.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},l.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},l.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},l.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},l.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},l.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},l.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},l.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},l.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},l.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},l.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},l.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},l.crossTileID.set=function(d){this._structArray.uint32[this._pos4+12]=d},l.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},l.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},l.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},l.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,l),s}(Mf);S.prototype.size=68;var I=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new S(this,l)},s}(Qc);ti("SymbolInstanceArray",I);var R=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getoffsetX=function(l){return this.float32[1*l+0]},s}(ec);ti("GlyphOffsetArray",R);var z=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.getx=function(l){return this.int16[3*l+0]},s.prototype.gety=function(l){return this.int16[3*l+1]},s.prototype.gettileUnitDistanceFromAnchor=function(l){return this.int16[3*l+2]},s}(el);ti("SymbolLineVertexArray",z);var W=function(n){function s(){n.apply(this,arguments)}n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s;var l={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,l),s}(Mf);W.prototype.size=8;var te=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.get=function(l){return new W(this,l)},s}(kf);ti("FeatureIndexArray",te);var be=yo([{name:"a_pos",components:2,type:"Int16"}],4).members,Se=function(n){n===void 0&&(n=[]),this.segments=n};function Ie(n,s){return 256*(n=tr(Math.floor(n),0,255))+tr(Math.floor(s),0,255)}Se.prototype.prepareSegment=function(n,s,l,d){var x=this.segments[this.segments.length-1];return n>Se.MAX_VERTEX_ARRAY_LENGTH&&Ue("Max vertices per segment is "+Se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+n),(!x||x.vertexLength+n>Se.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==d)&&(x={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},d!==void 0&&(x.sortKey=d),this.segments.push(x)),x},Se.prototype.get=function(){return this.segments},Se.prototype.destroy=function(){for(var n=0,s=this.segments;n<s.length;n+=1){var l=s[n];for(var d in l.vaos)l.vaos[d].destroy()}},Se.simpleSegment=function(n,s,l,d){return new Se([{vertexOffset:n,primitiveOffset:s,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])},Se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ti("SegmentVector",Se);var Je=yo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Qe=Ne(function(n){n.exports=function(s,l){var d,x,C,T,L,U,X,$;for(x=s.length-(d=3&s.length),C=l,L=3432918353,U=461845907,$=0;$<x;)X=255&s.charCodeAt($)|(255&s.charCodeAt(++$))<<8|(255&s.charCodeAt(++$))<<16|(255&s.charCodeAt(++$))<<24,++$,C=27492+(65535&(T=5*(65535&(C=(C^=X=(65535&(X=(X=(65535&X)*L+(((X>>>16)*L&65535)<<16)&4294967295)<<15|X>>>17))*U+(((X>>>16)*U&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(X=0,d){case 3:X^=(255&s.charCodeAt($+2))<<16;case 2:X^=(255&s.charCodeAt($+1))<<8;case 1:C^=X=(65535&(X=(X=(65535&(X^=255&s.charCodeAt($)))*L+(((X>>>16)*L&65535)<<16)&4294967295)<<15|X>>>17))*U+(((X>>>16)*U&65535)<<16)&4294967295}return C^=s.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0}}),nt=Ne(function(n){n.exports=function(s,l){for(var d,x=s.length,C=l^x,T=0;x>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(T)|(255&s.charCodeAt(++T))<<8|(255&s.charCodeAt(++T))<<16|(255&s.charCodeAt(++T))<<24))+((1540483477*(d>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),x-=4,++T;switch(x){case 3:C^=(255&s.charCodeAt(T+2))<<16;case 2:C^=(255&s.charCodeAt(T+1))<<8;case 1:C=1540483477*(65535&(C^=255&s.charCodeAt(T)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0}}),He=Qe,ft=nt;He.murmur3=Qe,He.murmur2=ft;var Et=function(){this.ids=[],this.positions=[],this.indexed=!1};Et.prototype.add=function(n,s,l,d){this.ids.push(vr(n)),this.positions.push(s,l,d)},Et.prototype.getPositions=function(n){for(var s=vr(n),l=0,d=this.ids.length-1;l<d;){var x=l+d>>1;this.ids[x]>=s?d=x:l=x+1}for(var C=[];this.ids[l]===s;)C.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return C},Et.serialize=function(n,s){var l=new Float64Array(n.ids),d=new Uint32Array(n.positions);return function x(C,T,L,U){for(;L<U;){for(var X=C[L+U>>1],$=L-1,ee=U+1;;){do $++;while(C[$]<X);do ee--;while(C[ee]>X);if($>=ee)break;rr(C,$,ee),rr(T,3*$,3*ee),rr(T,3*$+1,3*ee+1),rr(T,3*$+2,3*ee+2)}ee-L<U-ee?(x(C,T,L,ee),L=ee+1):(x(C,T,ee+1,U),U=ee)}}(l,d,0,l.length-1),s&&s.push(l.buffer,d.buffer),{ids:l,positions:d}},Et.deserialize=function(n){var s=new Et;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s};var Ht=Math.pow(2,53)-1;function vr(n){var s=+n;return!isNaN(s)&&s<=Ht?s:He(String(n))}function rr(n,s,l){var d=n[s];n[s]=n[l],n[l]=d}ti("FeaturePositionMap",Et);var Ar=function(n,s){this.gl=n.gl,this.location=s},Hr=function(n){function s(l,d){n.call(this,l,d),this.current=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))},s}(Ar),xn=function(n){function s(l,d){n.call(this,l,d),this.current=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))},s}(Ar),yn=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))},s}(Ar),Zn=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))},s}(Ar),_i=function(n){function s(l,d){n.call(this,l,d),this.current=[0,0,0,0]}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))},s}(Ar),wi=function(n){function s(l,d){n.call(this,l,d),this.current=Ea.transparent}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))},s}(Ar),Ei=new Float32Array(16),wa=function(n){function s(l,d){n.call(this,l,d),this.current=Ei}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.set=function(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(var d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}},s}(Ar);function Wn(n){return[Ie(255*n.r,255*n.g),Ie(255*n.b,255*n.a)]}var Gi=function(n,s,l){this.value=n,this.uniformNames=s.map(function(d){return"u_"+d}),this.type=l};Gi.prototype.setUniform=function(n,s,l){n.set(l.constantOr(this.value))},Gi.prototype.getBinding=function(n,s,l){return this.type==="color"?new wi(n,s):new xn(n,s)};var Ji=function(n,s){this.uniformNames=s.map(function(l){return"u_"+l}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ji.prototype.setConstantPatternPositions=function(n,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=n.tlbr},Ji.prototype.setUniform=function(n,s,l,d){var x=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&n.set(x)},Ji.prototype.getBinding=function(n,s,l){return l.substr(0,9)==="u_pattern"?new _i(n,s):new xn(n,s)};var Yi=function(n,s,l,d){this.expression=n,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(function(x){return{name:"a_"+x,type:"Float32",components:l==="color"?2:1,offset:0}}),this.paintVertexArray=new d};Yi.prototype.populatePaintArray=function(n,s,l,d,x){var C=this.paintVertexArray.length,T=this.expression.evaluate(new ha(0),s,{},d,[],x);this.paintVertexArray.resize(n),this._setPaintValue(C,n,T)},Yi.prototype.updatePaintArray=function(n,s,l,d){var x=this.expression.evaluate({zoom:0},l,d);this._setPaintValue(n,s,x)},Yi.prototype._setPaintValue=function(n,s,l){if(this.type==="color")for(var d=Wn(l),x=n;x<s;x++)this.paintVertexArray.emplace(x,d[0],d[1]);else{for(var C=n;C<s;C++)this.paintVertexArray.emplace(C,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}},Yi.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Yi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ri=function(n,s,l,d,x,C){this.expression=n,this.uniformNames=s.map(function(T){return"u_"+T+"_t"}),this.type=l,this.useIntegerZoom=d,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=s.map(function(T){return{name:"a_"+T,type:"Float32",components:l==="color"?4:2,offset:0}}),this.paintVertexArray=new C};Ri.prototype.populatePaintArray=function(n,s,l,d,x){var C=this.expression.evaluate(new ha(this.zoom),s,{},d,[],x),T=this.expression.evaluate(new ha(this.zoom+1),s,{},d,[],x),L=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(L,n,C,T)},Ri.prototype.updatePaintArray=function(n,s,l,d){var x=this.expression.evaluate({zoom:this.zoom},l,d),C=this.expression.evaluate({zoom:this.zoom+1},l,d);this._setPaintValue(n,s,x,C)},Ri.prototype._setPaintValue=function(n,s,l,d){if(this.type==="color")for(var x=Wn(l),C=Wn(d),T=n;T<s;T++)this.paintVertexArray.emplace(T,x[0],x[1],C[0],C[1]);else{for(var L=n;L<s;L++)this.paintVertexArray.emplace(L,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}},Ri.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ri.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ri.prototype.setUniform=function(n,s){var l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=tr(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);n.set(d)},Ri.prototype.getBinding=function(n,s,l){return new xn(n,s)};var ea=function(n,s,l,d,x,C){this.expression=n,this.type=s,this.useIntegerZoom=l,this.zoom=d,this.layerId=C,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};ea.prototype.populatePaintArray=function(n,s,l){var d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(d,n,s.patterns&&s.patterns[this.layerId],l)},ea.prototype.updatePaintArray=function(n,s,l,d,x){this._setPaintValues(n,s,l.patterns&&l.patterns[this.layerId],x)},ea.prototype._setPaintValues=function(n,s,l,d){if(d&&l){var x=d[l.min],C=d[l.mid],T=d[l.max];if(x&&C&&T)for(var L=n;L<s;L++)this.zoomInPaintVertexArray.emplace(L,C.tl[0],C.tl[1],C.br[0],C.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],C.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(L,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio)}},ea.prototype.upload=function(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Je.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Je.members,this.expression.isStateDependent))},ea.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Di=function(n,s,l){this.binders={},this._buffers=[];var d=[];for(var x in n.paint._values)if(l(x)){var C=n.paint.get(x);if(C instanceof mu&&qu(C.property.specification)){var T=xs(x,n.type),L=C.value,U=C.property.specification.type,X=C.property.useIntegerZoom,$=C.property.specification["property-type"],ee=$==="cross-faded"||$==="cross-faded-data-driven";if(L.kind==="constant")this.binders[x]=ee?new Ji(L.value,T):new Gi(L.value,T,U),d.push("/u_"+x);else if(L.kind==="source"||ee){var le=qo(x,U,"source");this.binders[x]=ee?new ea(L,U,X,s,le,n.id):new Yi(L,T,U,le),d.push("/a_"+x)}else{var Ee=qo(x,U,"composite");this.binders[x]=new Ri(L,T,U,X,s,Ee),d.push("/z_"+x)}}}this.cacheKey=d.sort().join("")};Di.prototype.getMaxValue=function(n){var s=this.binders[n];return s instanceof Yi||s instanceof Ri?s.maxValue:0},Di.prototype.populatePaintArrays=function(n,s,l,d,x){for(var C in this.binders){var T=this.binders[C];(T instanceof Yi||T instanceof Ri||T instanceof ea)&&T.populatePaintArray(n,s,l,d,x)}},Di.prototype.setConstantPatternPositions=function(n,s){for(var l in this.binders){var d=this.binders[l];d instanceof Ji&&d.setConstantPatternPositions(n,s)}},Di.prototype.updatePaintArrays=function(n,s,l,d,x){var C=!1;for(var T in n)for(var L=0,U=s.getPositions(T);L<U.length;L+=1){var X=U[L],$=l.feature(X.index);for(var ee in this.binders){var le=this.binders[ee];if((le instanceof Yi||le instanceof Ri||le instanceof ea)&&le.expression.isStateDependent===!0){var Ee=d.paint.get(ee);le.expression=Ee.value,le.updatePaintArray(X.start,X.end,$,n[T],x),C=!0}}}return C},Di.prototype.defines=function(){var n=[];for(var s in this.binders){var l=this.binders[s];(l instanceof Gi||l instanceof Ji)&&n.push.apply(n,l.uniformNames.map(function(d){return"#define HAS_UNIFORM_"+d}))}return n},Di.prototype.getBinderAttributes=function(){var n=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Yi||l instanceof Ri)for(var d=0;d<l.paintVertexAttributes.length;d++)n.push(l.paintVertexAttributes[d].name);else if(l instanceof ea)for(var x=0;x<Je.members.length;x++)n.push(Je.members[x].name)}return n},Di.prototype.getBinderUniforms=function(){var n=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Gi||l instanceof Ji||l instanceof Ri)for(var d=0,x=l.uniformNames;d<x.length;d+=1)n.push(x[d])}return n},Di.prototype.getPaintVertexBuffers=function(){return this._buffers},Di.prototype.getUniforms=function(n,s){var l=[];for(var d in this.binders){var x=this.binders[d];if(x instanceof Gi||x instanceof Ji||x instanceof Ri)for(var C=0,T=x.uniformNames;C<T.length;C+=1){var L=T[C];if(s[L]){var U=x.getBinding(n,s[L],L);l.push({name:L,property:d,binding:U})}}}return l},Di.prototype.setUniforms=function(n,s,l,d){for(var x=0,C=s;x<C.length;x+=1){var T=C[x],L=T.name,U=T.property;this.binders[U].setUniform(T.binding,d,l.get(U),L)}},Di.prototype.updatePaintBuffers=function(n){for(var s in this._buffers=[],this.binders){var l=this.binders[s];if(n&&l instanceof ea){var d=n.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof Yi||l instanceof Ri)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}},Di.prototype.upload=function(n){for(var s in this.binders){var l=this.binders[s];(l instanceof Yi||l instanceof Ri||l instanceof ea)&&l.upload(n)}this.updatePaintBuffers()},Di.prototype.destroy=function(){for(var n in this.binders){var s=this.binders[n];(s instanceof Yi||s instanceof Ri||s instanceof ea)&&s.destroy()}};var ki=function(n,s,l){l===void 0&&(l=function(){return!0}),this.programConfigurations={};for(var d=0,x=n;d<x.length;d+=1){var C=x[d];this.programConfigurations[C.id]=new Di(C,s,l)}this.needsUpload=!1,this._featureMap=new Et,this._bufferOffset=0};function xs(n,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(s+"-","").replace(/-/g,"_")]}function qo(n,s,l){var d={color:{source:pl,composite:Jc},number:{source:ec,composite:pl}},x=function(C){return{"line-pattern":{source:zl,composite:zl},"fill-pattern":{source:zl,composite:zl},"fill-extrusion-pattern":{source:zl,composite:zl}}[C]}(n);return x&&x[l]||d[s][l]}ki.prototype.populatePaintArrays=function(n,s,l,d,x,C){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(n,s,d,x,C);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0},ki.prototype.updatePaintArrays=function(n,s,l,d){for(var x=0,C=l;x<C.length;x+=1){var T=C[x];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(n,this._featureMap,s,T,d)||this.needsUpload}},ki.prototype.get=function(n){return this.programConfigurations[n]},ki.prototype.upload=function(n){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}},ki.prototype.destroy=function(){for(var n in this.programConfigurations)this.programConfigurations[n].destroy()},ti("ConstantBinder",Gi),ti("CrossFadedConstantBinder",Ji),ti("SourceExpressionBinder",Yi),ti("CrossFadedCompositeBinder",ea),ti("CompositeExpressionBinder",Ri),ti("ProgramConfiguration",Di,{omit:["_buffers"]}),ti("ProgramConfigurationSet",ki);var is=Math.pow(2,14)-1,as=-is-1;function _o(n){for(var s=8192/n.extent,l=n.loadGeometry(),d=0;d<l.length;d++)for(var x=l[d],C=0;C<x.length;C++){var T=x[C],L=Math.round(T.x*s),U=Math.round(T.y*s);T.x=tr(L,as,is),T.y=tr(U,as,is),(L<T.x||L>T.x+1||U<T.y||U>T.y+1)&&Ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return l}function os(n,s){return{type:n.type,id:n.id,properties:n.properties,geometry:s?_o(n):[]}}function Mu(n,s,l,d,x){n.emplaceBack(2*s+(d+1)/2,2*l+(x+1)/2)}var ks=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Qf,this.indexArray=new dl,this.segments=new Se,this.programConfigurations=new ki(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Ul(n,s){for(var l=0;l<n.length;l++)if(Sl(s,n[l]))return!0;for(var d=0;d<s.length;d++)if(Sl(n,s[d]))return!0;return!!Jf(n,s)}function $o(n,s,l){return!!Sl(n,s)||!!Zl(s,n,l)}function Iu(n,s){if(n.length===1)return tf(s,n[0]);for(var l=0;l<s.length;l++)for(var d=s[l],x=0;x<d.length;x++)if(Sl(n,d[x]))return!0;for(var C=0;C<n.length;C++)if(tf(s,n[C]))return!0;for(var T=0;T<s.length;T++)if(Jf(n,s[T]))return!0;return!1}function ku(n,s,l){if(n.length>1){if(Jf(n,s))return!0;for(var d=0;d<s.length;d++)if(Zl(s[d],n,l))return!0}for(var x=0;x<n.length;x++)if(Zl(n[x],s,l))return!0;return!1}function Jf(n,s){if(n.length===0||s.length===0)return!1;for(var l=0;l<n.length-1;l++)for(var d=n[l],x=n[l+1],C=0;C<s.length-1;C++)if(ef(d,x,s[C],s[C+1]))return!0;return!1}function ef(n,s,l,d){return Er(n,l,d)!==Er(s,l,d)&&Er(n,s,l)!==Er(n,s,d)}function Zl(n,s,l){var d=l*l;if(s.length===1)return n.distSqr(s[0])<d;for(var x=1;x<s.length;x++)if(tl(n,s[x-1],s[x])<d)return!0;return!1}function tl(n,s,l){var d=s.distSqr(l);if(d===0)return n.distSqr(s);var x=((n.x-s.x)*(l.x-s.x)+(n.y-s.y)*(l.y-s.y))/d;return n.distSqr(x<0?s:x>1?l:l.sub(s)._mult(x)._add(s))}function tf(n,s){for(var l,d,x,C=!1,T=0;T<n.length;T++)for(var L=0,U=(l=n[T]).length-1;L<l.length;U=L++)(d=l[L]).y>s.y!=(x=l[U]).y>s.y&&s.x<(x.x-d.x)*(s.y-d.y)/(x.y-d.y)+d.x&&(C=!C);return C}function Sl(n,s){for(var l=!1,d=0,x=n.length-1;d<n.length;x=d++){var C=n[d],T=n[x];C.y>s.y!=T.y>s.y&&s.x<(T.x-C.x)*(s.y-C.y)/(T.y-C.y)+C.x&&(l=!l)}return l}function Ec(n,s,l){var d=l[0],x=l[2];if(n.x<d.x&&s.x<d.x||n.x>x.x&&s.x>x.x||n.y<d.y&&s.y<d.y||n.y>x.y&&s.y>x.y)return!1;var C=Er(n,s,l[0]);return C!==Er(n,s,l[1])||C!==Er(n,s,l[2])||C!==Er(n,s,l[3])}function Vl(n,s,l){var d=s.paint.get(n).value;return d.kind==="constant"?d.value:l.programConfigurations.get(s.id).getMaxValue(n)}function vs(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Al(n,s,l,d,x){if(!s[0]&&!s[1])return n;var C=pe.convert(s)._mult(x);l==="viewport"&&C._rotate(-d);for(var T=[],L=0;L<n.length;L++)T.push(n[L].sub(C));return T}ks.prototype.populate=function(n,s,l){var d=this.layers[0],x=[],C=null;d.type==="circle"&&(C=d.layout.get("circle-sort-key"));for(var T=0,L=n;T<L.length;T+=1){var U=L[T],X=U.feature,$=U.id,ee=U.index,le=U.sourceLayerIndex,Ee=this.layers[0]._featureFilter.needGeometry,$e=os(X,Ee);if(this.layers[0]._featureFilter.filter(new ha(this.zoom),$e,l)){var et=C?C.evaluate($e,{},l):void 0,mt={id:$,properties:X.properties,type:X.type,sourceLayerIndex:le,index:ee,geometry:Ee?$e.geometry:_o(X),patterns:{},sortKey:et};x.push(mt)}}C&&x.sort(function(zn,Ai){return zn.sortKey-Ai.sortKey});for(var ut=0,Ot=x;ut<Ot.length;ut+=1){var $t=Ot[ut],dr=$t.geometry,gr=$t.index,Dr=$t.sourceLayerIndex,hn=n[gr].feature;this.addFeature($t,dr,gr,l),s.featureIndex.insert(hn,dr,gr,Dr,this.index)}},ks.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},ks.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ks.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ks.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,be),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},ks.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ks.prototype.addFeature=function(n,s,l,d){for(var x=0,C=s;x<C.length;x+=1)for(var T=0,L=C[x];T<L.length;T+=1){var U=L[T],X=U.x,$=U.y;if(!(X<0||X>=8192||$<0||$>=8192)){var ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),le=ee.vertexLength;Mu(this.layoutVertexArray,X,$,-1,-1),Mu(this.layoutVertexArray,X,$,1,-1),Mu(this.layoutVertexArray,X,$,1,1),Mu(this.layoutVertexArray,X,$,-1,1),this.indexArray.emplaceBack(le,le+1,le+2),this.indexArray.emplaceBack(le,le+3,le+2),ee.vertexLength+=4,ee.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,{},d)},ti("CircleBucket",ks,{omit:["layers"]});var Cc=new es({"circle-sort-key":new pi(Me.layout_circle["circle-sort-key"])}),gu={paint:new es({"circle-radius":new pi(Me.paint_circle["circle-radius"]),"circle-color":new pi(Me.paint_circle["circle-color"]),"circle-blur":new pi(Me.paint_circle["circle-blur"]),"circle-opacity":new pi(Me.paint_circle["circle-opacity"]),"circle-translate":new bi(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new bi(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bi(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bi(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pi(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pi(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pi(Me.paint_circle["circle-stroke-opacity"])}),layout:Cc},Ga=typeof Float32Array!="undefined"?Float32Array:Array;function Nu(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function bs(n,s,l){var d=s[0],x=s[1],C=s[2],T=s[3],L=s[4],U=s[5],X=s[6],$=s[7],ee=s[8],le=s[9],Ee=s[10],$e=s[11],et=s[12],mt=s[13],ut=s[14],Ot=s[15],$t=l[0],dr=l[1],gr=l[2],Dr=l[3];return n[0]=$t*d+dr*L+gr*ee+Dr*et,n[1]=$t*x+dr*U+gr*le+Dr*mt,n[2]=$t*C+dr*X+gr*Ee+Dr*ut,n[3]=$t*T+dr*$+gr*$e+Dr*Ot,n[4]=($t=l[4])*d+(dr=l[5])*L+(gr=l[6])*ee+(Dr=l[7])*et,n[5]=$t*x+dr*U+gr*le+Dr*mt,n[6]=$t*C+dr*X+gr*Ee+Dr*ut,n[7]=$t*T+dr*$+gr*$e+Dr*Ot,n[8]=($t=l[8])*d+(dr=l[9])*L+(gr=l[10])*ee+(Dr=l[11])*et,n[9]=$t*x+dr*U+gr*le+Dr*mt,n[10]=$t*C+dr*X+gr*Ee+Dr*ut,n[11]=$t*T+dr*$+gr*$e+Dr*Ot,n[12]=($t=l[12])*d+(dr=l[13])*L+(gr=l[14])*ee+(Dr=l[15])*et,n[13]=$t*x+dr*U+gr*le+Dr*mt,n[14]=$t*C+dr*X+gr*Ee+Dr*ut,n[15]=$t*T+dr*$+gr*$e+Dr*Ot,n}Math.hypot||(Math.hypot=function(){for(var n=arguments,s=0,l=arguments.length;l--;)s+=n[l]*n[l];return Math.sqrt(s)});var tc,_h=bs;function xh(n,s,l){var d=s[0],x=s[1],C=s[2],T=s[3];return n[0]=l[0]*d+l[4]*x+l[8]*C+l[12]*T,n[1]=l[1]*d+l[5]*x+l[9]*C+l[13]*T,n[2]=l[2]*d+l[6]*x+l[10]*C+l[14]*T,n[3]=l[3]*d+l[7]*x+l[11]*C+l[15]*T,n}tc=new Ga(3),Ga!=Float32Array&&(tc[0]=0,tc[1]=0,tc[2]=0),function(){var n=new Ga(4);Ga!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0)}();var bh=(function(){var n=new Ga(2);Ga!=Float32Array&&(n[0]=0,n[1]=0)}(),function(n){function s(l){n.call(this,l,gu)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new ks(l)},s.prototype.queryRadius=function(l){var d=l;return Vl("circle-radius",this,d)+Vl("circle-stroke-width",this,d)+vs(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,L,U,X){for(var $=Al(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),L.angle,U),ee=this.paint.get("circle-radius").evaluate(d,x)+this.paint.get("circle-stroke-width").evaluate(d,x),le=this.paint.get("circle-pitch-alignment")==="map",Ee=le?$:function(hn,zn){return hn.map(function(Ai){return zu(Ai,zn)})}($,X),$e=le?ee*U:ee,et=0,mt=C;et<mt.length;et+=1)for(var ut=0,Ot=mt[et];ut<Ot.length;ut+=1){var $t=Ot[ut],dr=le?$t:zu($t,X),gr=$e,Dr=xh([],[$t.x,$t.y,0,1],X);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?gr*=Dr[3]/L.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(gr*=L.cameraToCenterDistance/Dr[3]),$o(Ee,dr,gr))return!0}return!1},s}(El));function zu(n,s){var l=xh([],[n.x,n.y,0,1],s);return new pe(l[0]/l[3],l[1]/l[3])}var jl=function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(ks);function Uu(n,s,l,d){var x=s.width,C=s.height;if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==x*C*l)throw new RangeError("mismatched image size")}else d=new Uint8Array(x*C*l);return n.width=x,n.height=C,n.data=d,n}function rf(n,s,l){var d=s.width,x=s.height;if(d!==n.width||x!==n.height){var C=Uu({},{width:d,height:x},l);Rf(n,C,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,d),height:Math.min(n.height,x)},l),n.width=d,n.height=x,n.data=C.data}}function Rf(n,s,l,d,x,C){if(x.width===0||x.height===0)return s;if(x.width>n.width||x.height>n.height||l.x>n.width-x.width||l.y>n.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>s.width||x.height>s.height||d.x>s.width-x.width||d.y>s.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=n.data,L=s.data,U=0;U<x.height;U++)for(var X=((l.y+U)*n.width+l.x)*C,$=((d.y+U)*s.width+d.x)*C,ee=0;ee<x.width*C;ee++)L[$+ee]=T[X+ee];return s}ti("HeatmapBucket",jl,{omit:["layers"]});var Gl=function(n,s){Uu(this,n,1,s)};Gl.prototype.resize=function(n){rf(this,n,1)},Gl.prototype.clone=function(){return new Gl({width:this.width,height:this.height},new Uint8Array(this.data))},Gl.copy=function(n,s,l,d,x){Rf(n,s,l,d,x,1)};var Js=function(n,s){Uu(this,n,4,s)};Js.prototype.resize=function(n){rf(this,n,4)},Js.prototype.replace=function(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n},Js.prototype.clone=function(){return new Js({width:this.width,height:this.height},new Uint8Array(this.data))},Js.copy=function(n,s,l,d,x){Rf(n,s,l,d,x,4)},ti("AlphaImage",Gl),ti("RGBAImage",Js);var Yh={paint:new es({"heatmap-radius":new pi(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pi(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bi(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fl(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bi(Me.paint_heatmap["heatmap-opacity"])})};function rc(n){var s={},l=n.resolution||256,d=n.clips?n.clips.length:1,x=n.image||new Js({width:l,height:d}),C=function($e,et,mt){s[n.evaluationKey]=mt;var ut=n.expression.evaluate(s);x.data[$e+et+0]=Math.floor(255*ut.r/ut.a),x.data[$e+et+1]=Math.floor(255*ut.g/ut.a),x.data[$e+et+2]=Math.floor(255*ut.b/ut.a),x.data[$e+et+3]=Math.floor(255*ut.a)};if(n.clips)for(var T=0,L=0;T<d;++T,L+=4*l)for(var U=0,X=0;U<l;U++,X+=4){var $=U/(l-1),ee=n.clips[T];C(L,X,ee.start*(1-$)+ee.end*$)}else for(var le=0,Ee=0;le<l;le++,Ee+=4)C(0,Ee,le/(l-1));return x}var yp=function(n){function s(l){n.call(this,l,Yh),this._updateColorRamp()}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new jl(l)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=rc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(El),su={paint:new es({"hillshade-illumination-direction":new bi(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bi(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bi(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bi(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bi(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bi(Me.paint_hillshade["hillshade-accent-color"])})},nf=function(n){function s(l){n.call(this,l,su)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(El),eh=yo([{name:"a_pos",components:2,type:"Int16"}],4).members,Sc=rl,qh=rl;function rl(n,s,l){l=l||2;var d,x,C,T,L,U,X,$=s&&s.length,ee=$?s[0]*l:n.length,le=xe(n,0,ee,l,!0),Ee=[];if(!le||le.next===le.prev)return Ee;if($&&(le=function(et,mt,ut,Ot){var $t,dr,gr,Dr=[];for($t=0,dr=mt.length;$t<dr;$t++)(gr=xe(et,mt[$t]*Ot,$t<dr-1?mt[$t+1]*Ot:et.length,Ot,!1))===gr.next&&(gr.steiner=!0),Dr.push(rh(gr));for(Dr.sort(Td),$t=0;$t<Dr.length;$t++)af(Dr[$t],ut),ut=$r(ut,ut.next);return ut}(n,s,le,l)),n.length>80*l){d=C=n[0],x=T=n[1];for(var $e=l;$e<ee;$e+=l)(L=n[$e])<d&&(d=L),(U=n[$e+1])<x&&(x=U),L>C&&(C=L),U>T&&(T=U);X=(X=Math.max(C-d,T-x))!==0?1/X:0}return Ac(le,Ee,l,d,x,X),Ee}function xe(n,s,l,d,x){var C,T;if(x===of(n,s,l,d)>0)for(C=s;C<l;C+=d)T=_p(C,n[C],n[C+1],T);else for(C=l-d;C>=s;C-=d)T=_p(C,n[C],n[C+1],T);return T&&$h(T,T.next)&&(nl(T),T=T.next),T}function $r(n,s){if(!n)return n;s||(s=n);var l,d=n;do if(l=!1,d.steiner||!$h(d,d.next)&&Ko(d.prev,d,d.next)!==0)d=d.next;else{if(nl(d),(d=s=d.prev)===d.next)break;l=!0}while(l||d!==s);return s}function Ac(n,s,l,d,x,C,T){if(n){!T&&C&&function($,ee,le,Ee){var $e=$;do $e.z===null&&($e.z=Eh($e.x,$e.y,ee,le,Ee)),$e.prevZ=$e.prev,$e.nextZ=$e.next,$e=$e.next;while($e!==$);$e.prevZ.nextZ=null,$e.prevZ=null,function(et){var mt,ut,Ot,$t,dr,gr,Dr,hn,zn=1;do{for(ut=et,et=null,dr=null,gr=0;ut;){for(gr++,Ot=ut,Dr=0,mt=0;mt<zn&&(Dr++,Ot=Ot.nextZ);mt++);for(hn=zn;Dr>0||hn>0&&Ot;)Dr!==0&&(hn===0||!Ot||ut.z<=Ot.z)?($t=ut,ut=ut.nextZ,Dr--):($t=Ot,Ot=Ot.nextZ,hn--),dr?dr.nextZ=$t:et=$t,$t.prevZ=dr,dr=$t;ut=Ot}dr.nextZ=null,zn*=2}while(gr>1)}($e)}(n,d,x,C);for(var L,U,X=n;n.prev!==n.next;)if(L=n.prev,U=n.next,C?eu(n,d,x,C):Qd(n))s.push(L.i/l),s.push(n.i/l),s.push(U.i/l),nl(n),n=U.next,X=U.next;else if((n=U)===X){T?T===1?Ac(n=js($r(n),s,l),s,l,d,x,C,2):T===2&&Pu(n,s,l,d,x,C):Ac($r(n),s,l,d,x,C,1);break}}}function Qd(n){var s=n.prev,l=n,d=n.next;if(Ko(s,l,d)>=0)return!1;for(var x=n.next.next;x!==n.prev;){if(Ch(s.x,s.y,l.x,l.y,d.x,d.y,x.x,x.y)&&Ko(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function eu(n,s,l,d){var x=n.prev,C=n,T=n.next;if(Ko(x,C,T)>=0)return!1;for(var L=x.x>C.x?x.x>T.x?x.x:T.x:C.x>T.x?C.x:T.x,U=x.y>C.y?x.y>T.y?x.y:T.y:C.y>T.y?C.y:T.y,X=Eh(x.x<C.x?x.x<T.x?x.x:T.x:C.x<T.x?C.x:T.x,x.y<C.y?x.y<T.y?x.y:T.y:C.y<T.y?C.y:T.y,s,l,d),$=Eh(L,U,s,l,d),ee=n.prevZ,le=n.nextZ;ee&&ee.z>=X&&le&&le.z<=$;){if(ee!==n.prev&&ee!==n.next&&Ch(x.x,x.y,C.x,C.y,T.x,T.y,ee.x,ee.y)&&Ko(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,le!==n.prev&&le!==n.next&&Ch(x.x,x.y,C.x,C.y,T.x,T.y,le.x,le.y)&&Ko(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ee&&ee.z>=X;){if(ee!==n.prev&&ee!==n.next&&Ch(x.x,x.y,C.x,C.y,T.x,T.y,ee.x,ee.y)&&Ko(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;le&&le.z<=$;){if(le!==n.prev&&le!==n.next&&Ch(x.x,x.y,C.x,C.y,T.x,T.y,le.x,le.y)&&Ko(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function js(n,s,l){var d=n;do{var x=d.prev,C=d.next.next;!$h(x,C)&&Md(x,d,d.next,C)&&Kh(x,C)&&Kh(C,x)&&(s.push(x.i/l),s.push(d.i/l),s.push(C.i/l),nl(d),nl(d.next),d=n=C),d=d.next}while(d!==n);return $r(d)}function Pu(n,s,l,d,x,C){var T=n;do{for(var L=T.next.next;L!==T.prev;){if(T.i!==L.i&&wc(T,L)){var U=Tc(T,L);return T=$r(T,T.next),U=$r(U,U.next),Ac(T,s,l,d,x,C),void Ac(U,s,l,d,x,C)}L=L.next}T=T.next}while(T!==n)}function Td(n,s){return n.x-s.x}function af(n,s){if(s=function(d,x){var C,T=x,L=d.x,U=d.y,X=-1/0;do{if(U<=T.y&&U>=T.next.y&&T.next.y!==T.y){var $=T.x+(U-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if($<=L&&$>X){if(X=$,$===L){if(U===T.y)return T;if(U===T.next.y)return T.next}C=T.x<T.next.x?T:T.next}}T=T.next}while(T!==x);if(!C)return null;if(L===X)return C;var ee,le=C,Ee=C.x,$e=C.y,et=1/0;T=C;do L>=T.x&&T.x>=Ee&&L!==T.x&&Ch(U<$e?L:X,U,Ee,$e,U<$e?X:L,U,T.x,T.y)&&(ee=Math.abs(U-T.y)/(L-T.x),Kh(T,d)&&(ee<et||ee===et&&(T.x>C.x||T.x===C.x&&th(C,T)))&&(C=T,et=ee)),T=T.next;while(T!==le);return C}(n,s)){var l=Tc(s,n);$r(s,s.next),$r(l,l.next)}}function th(n,s){return Ko(n.prev,n,s.prev)<0&&Ko(s.next,n,n.next)<0}function Eh(n,s,l,d,x){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-l)*x)|n<<8))|n<<4))|n<<2))|n<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-d)*x)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function rh(n){var s=n,l=n;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==n);return l}function Ch(n,s,l,d,x,C,T,L){return(x-T)*(s-L)-(n-T)*(C-L)>=0&&(n-T)*(d-L)-(l-T)*(s-L)>=0&&(l-T)*(C-L)-(x-T)*(d-L)>=0}function wc(n,s){return n.next.i!==s.i&&n.prev.i!==s.i&&!function(l,d){var x=l;do{if(x.i!==l.i&&x.next.i!==l.i&&x.i!==d.i&&x.next.i!==d.i&&Md(x,x.next,l,d))return!0;x=x.next}while(x!==l);return!1}(n,s)&&(Kh(n,s)&&Kh(s,n)&&function(l,d){var x=l,C=!1,T=(l.x+d.x)/2,L=(l.y+d.y)/2;do x.y>L!=x.next.y>L&&x.next.y!==x.y&&T<(x.next.x-x.x)*(L-x.y)/(x.next.y-x.y)+x.x&&(C=!C),x=x.next;while(x!==l);return C}(n,s)&&(Ko(n.prev,n,s.prev)||Ko(n,s.prev,s))||$h(n,s)&&Ko(n.prev,n,n.next)>0&&Ko(s.prev,s,s.next)>0)}function Ko(n,s,l){return(s.y-n.y)*(l.x-s.x)-(s.x-n.x)*(l.y-s.y)}function $h(n,s){return n.x===s.x&&n.y===s.y}function Md(n,s,l,d){var x=Hp(Ko(n,s,l)),C=Hp(Ko(n,s,d)),T=Hp(Ko(l,d,n)),L=Hp(Ko(l,d,s));return x!==C&&T!==L||!(x!==0||!$i(n,l,s))||!(C!==0||!$i(n,d,s))||!(T!==0||!$i(l,n,d))||!(L!==0||!$i(l,s,d))}function $i(n,s,l){return s.x<=Math.max(n.x,l.x)&&s.x>=Math.min(n.x,l.x)&&s.y<=Math.max(n.y,l.y)&&s.y>=Math.min(n.y,l.y)}function Hp(n){return n>0?1:n<0?-1:0}function Kh(n,s){return Ko(n.prev,n,n.next)<0?Ko(n,s,n.next)>=0&&Ko(n,n.prev,s)>=0:Ko(n,s,n.prev)<0||Ko(n,n.next,s)<0}function Tc(n,s){var l=new Sh(n.i,n.x,n.y),d=new Sh(s.i,s.x,s.y),x=n.next,C=s.prev;return n.next=s,s.prev=n,l.next=x,x.prev=l,d.next=l,l.prev=d,C.next=d,d.prev=C,d}function _p(n,s,l,d){var x=new Sh(n,s,l);return d?(x.next=d.next,x.prev=d,d.next.prev=x,d.next=x):(x.prev=x,x.next=x),x}function nl(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Sh(n,s,l){this.i=n,this.x=s,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function of(n,s,l,d){for(var x=0,C=s,T=l-d;C<l;C+=d)x+=(n[T]-n[C])*(n[C+1]+n[T+1]),T=C;return x}function Wp(n,s,l,d,x){(function C(T,L,U,X,$){for(;X>U;){if(X-U>600){var ee=X-U+1,le=L-U+1,Ee=Math.log(ee),$e=.5*Math.exp(2*Ee/3),et=.5*Math.sqrt(Ee*$e*(ee-$e)/ee)*(le-ee/2<0?-1:1);C(T,L,Math.max(U,Math.floor(L-le*$e/ee+et)),Math.min(X,Math.floor(L+(ee-le)*$e/ee+et)),$)}var mt=T[L],ut=U,Ot=X;for(nc(T,U,L),$(T[X],mt)>0&&nc(T,U,X);ut<Ot;){for(nc(T,ut,Ot),ut++,Ot--;$(T[ut],mt)<0;)ut++;for(;$(T[Ot],mt)>0;)Ot--}$(T[U],mt)===0?nc(T,U,Ot):nc(T,++Ot,X),Ot<=L&&(U=Ot+1),L<=Ot&&(X=Ot-1)}})(n,s,l||0,d||n.length-1,x||ic)}function nc(n,s,l){var d=n[s];n[s]=n[l],n[l]=d}function ic(n,s){return n<s?-1:n>s?1:0}function xp(n,s){var l=n.length;if(l<=1)return[n];for(var d,x,C=[],T=0;T<l;T++){var L=an(n[T]);L!==0&&(n[T].area=Math.abs(L),x===void 0&&(x=L<0),x===L<0?(d&&C.push(d),d=[n[T]]):d.push(n[T]))}if(d&&C.push(d),s>1)for(var U=0;U<C.length;U++)C[U].length<=s||(Wp(C[U],s,1,C[U].length-1,Xp),C[U]=C[U].slice(0,s));return C}function Xp(n,s){return s.area-n.area}function Qh(n,s,l){for(var d=l.patternDependencies,x=!1,C=0,T=s;C<T.length;C+=1){var L=T[C].paint.get(n+"-pattern");L.isConstant()||(x=!0);var U=L.constantOr(null);U&&(x=!0,d[U.to]=!0,d[U.from]=!0)}return x}function Jh(n,s,l,d,x){for(var C=x.patternDependencies,T=0,L=s;T<L.length;T+=1){var U=L[T],X=U.paint.get(n+"-pattern").value;if(X.kind!=="constant"){var $=X.evaluate({zoom:d-1},l,{},x.availableImages),ee=X.evaluate({zoom:d},l,{},x.availableImages),le=X.evaluate({zoom:d+1},l,{},x.availableImages);ee=ee&&ee.name?ee.name:ee,le=le&&le.name?le.name:le,C[$=$&&$.name?$.name:$]=!0,C[ee]=!0,C[le]=!0,l.patterns[U.id]={min:$,mid:ee,max:le}}}return l}rl.deviation=function(n,s,l,d){var x=s&&s.length,C=Math.abs(of(n,0,x?s[0]*l:n.length,l));if(x)for(var T=0,L=s.length;T<L;T++)C-=Math.abs(of(n,s[T]*l,T<L-1?s[T+1]*l:n.length,l));var U=0;for(T=0;T<d.length;T+=3){var X=d[T]*l,$=d[T+1]*l,ee=d[T+2]*l;U+=Math.abs((n[X]-n[ee])*(n[$+1]-n[X+1])-(n[X]-n[$])*(n[ee+1]-n[X+1]))}return C===0&&U===0?0:Math.abs((U-C)/C)},rl.flatten=function(n){for(var s=n[0][0].length,l={vertices:[],holes:[],dimensions:s},d=0,x=0;x<n.length;x++){for(var C=0;C<n[x].length;C++)for(var T=0;T<s;T++)l.vertices.push(n[x][C][T]);x>0&&l.holes.push(d+=n[x-1].length)}return l},Sc.default=qh;var Zu=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qf,this.indexArray=new dl,this.indexArray2=new Pf,this.programConfigurations=new ki(n.layers,n.zoom),this.segments=new Se,this.segments2=new Se,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Zu.prototype.populate=function(n,s,l){this.hasPattern=Qh("fill",this.layers,s);for(var d=this.layers[0].layout.get("fill-sort-key"),x=[],C=0,T=n;C<T.length;C+=1){var L=T[C],U=L.feature,X=L.id,$=L.index,ee=L.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,Ee=os(U,le);if(this.layers[0]._featureFilter.filter(new ha(this.zoom),Ee,l)){var $e=d?d.evaluate(Ee,{},l,s.availableImages):void 0,et={id:X,properties:U.properties,type:U.type,sourceLayerIndex:ee,index:$,geometry:le?Ee.geometry:_o(U),patterns:{},sortKey:$e};x.push(et)}}d&&x.sort(function(hn,zn){return hn.sortKey-zn.sortKey});for(var mt=0,ut=x;mt<ut.length;mt+=1){var Ot=ut[mt],$t=Ot.geometry,dr=Ot.index,gr=Ot.sourceLayerIndex;if(this.hasPattern){var Dr=Jh("fill",this.layers,Ot,this.zoom,s);this.patternFeatures.push(Dr)}else this.addFeature(Ot,$t,dr,l,{});s.featureIndex.insert(n[dr].feature,$t,dr,gr,this.index)}},Zu.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},Zu.prototype.addFeatures=function(n,s,l){for(var d=0,x=this.patternFeatures;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},Zu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Zu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Zu.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,eh),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0},Zu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Zu.prototype.addFeature=function(n,s,l,d,x){for(var C=0,T=xp(s,500);C<T.length;C+=1){for(var L=T[C],U=0,X=0,$=L;X<$.length;X+=1)U+=$[X].length;for(var ee=this.segments.prepareSegment(U,this.layoutVertexArray,this.indexArray),le=ee.vertexLength,Ee=[],$e=[],et=0,mt=L;et<mt.length;et+=1){var ut=mt[et];if(ut.length!==0){ut!==L[0]&&$e.push(Ee.length/2);var Ot=this.segments2.prepareSegment(ut.length,this.layoutVertexArray,this.indexArray2),$t=Ot.vertexLength;this.layoutVertexArray.emplaceBack(ut[0].x,ut[0].y),this.indexArray2.emplaceBack($t+ut.length-1,$t),Ee.push(ut[0].x),Ee.push(ut[0].y);for(var dr=1;dr<ut.length;dr++)this.layoutVertexArray.emplaceBack(ut[dr].x,ut[dr].y),this.indexArray2.emplaceBack($t+dr-1,$t+dr),Ee.push(ut[dr].x),Ee.push(ut[dr].y);Ot.vertexLength+=ut.length,Ot.primitiveLength+=ut.length}}for(var gr=Sc(Ee,$e),Dr=0;Dr<gr.length;Dr+=3)this.indexArray.emplaceBack(le+gr[Dr],le+gr[Dr+1],le+gr[Dr+2]);ee.vertexLength+=U,ee.primitiveLength+=gr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,x,d)},ti("FillBucket",Zu,{omit:["layers","patternFeatures"]});var ac=new es({"fill-sort-key":new pi(Me.layout_fill["fill-sort-key"])}),Lf={paint:new es({"fill-antialias":new bi(Me.paint_fill["fill-antialias"]),"fill-opacity":new pi(Me.paint_fill["fill-opacity"]),"fill-color":new pi(Me.paint_fill["fill-color"]),"fill-outline-color":new pi(Me.paint_fill["fill-outline-color"]),"fill-translate":new bi(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new bi(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kf(Me.paint_fill["fill-pattern"])}),layout:ac},Yp=function(n){function s(l){n.call(this,l,Lf)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.recalculate=function(l,d){n.prototype.recalculate.call(this,l,d);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(l){return new Zu(l)},s.prototype.queryRadius=function(){return vs(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,L,U){return Iu(Al(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),L.angle,U),C)},s.prototype.isTileClipped=function(){return!0},s}(El),sf=yo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Of=Gs;function Gs(n,s,l,d,x){this.properties={},this.extent=l,this.type=0,this._pbf=n,this._geometry=-1,this._keys=d,this._values=x,n.readFields(Ah,this,s)}function Ah(n,s,l){n==1?s.id=l.readVarint():n==2?function(d,x){for(var C=d.readVarint()+d.pos;d.pos<C;){var T=x._keys[d.readVarint()],L=x._values[d.readVarint()];x.properties[T]=L}}(l,s):n==3?s.type=l.readVarint():n==4&&(s._geometry=l.pos)}function qp(n){for(var s,l,d=0,x=0,C=n.length,T=C-1;x<C;T=x++)d+=((l=n[T]).x-(s=n[x]).x)*(s.y+l.y);return d}Gs.types=["Unknown","Point","LineString","Polygon"],Gs.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var s,l=n.readVarint()+n.pos,d=1,x=0,C=0,T=0,L=[];n.pos<l;){if(x<=0){var U=n.readVarint();d=7&U,x=U>>3}if(x--,d===1||d===2)C+=n.readSVarint(),T+=n.readSVarint(),d===1&&(s&&L.push(s),s=[]),s.push(new pe(C,T));else{if(d!==7)throw new Error("unknown command "+d);s&&s.push(s[0].clone())}}return s&&L.push(s),L},Gs.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var s=n.readVarint()+n.pos,l=1,d=0,x=0,C=0,T=1/0,L=-1/0,U=1/0,X=-1/0;n.pos<s;){if(d<=0){var $=n.readVarint();l=7&$,d=$>>3}if(d--,l===1||l===2)(x+=n.readSVarint())<T&&(T=x),x>L&&(L=x),(C+=n.readSVarint())<U&&(U=C),C>X&&(X=C);else if(l!==7)throw new Error("unknown command "+l)}return[T,U,L,X]},Gs.prototype.toGeoJSON=function(n,s,l){var d,x,C=this.extent*Math.pow(2,l),T=this.extent*n,L=this.extent*s,U=this.loadGeometry(),X=Gs.types[this.type];function $(Ee){for(var $e=0;$e<Ee.length;$e++){var et=Ee[$e];Ee[$e]=[360*(et.x+T)/C-180,360/Math.PI*Math.atan(Math.exp((180-360*(et.y+L)/C)*Math.PI/180))-90]}}switch(this.type){case 1:var ee=[];for(d=0;d<U.length;d++)ee[d]=U[d][0];$(U=ee);break;case 2:for(d=0;d<U.length;d++)$(U[d]);break;case 3:for(U=function(Ee){var $e=Ee.length;if($e<=1)return[Ee];for(var et,mt,ut=[],Ot=0;Ot<$e;Ot++){var $t=qp(Ee[Ot]);$t!==0&&(mt===void 0&&(mt=$t<0),mt===$t<0?(et&&ut.push(et),et=[Ee[Ot]]):et.push(Ee[Ot]))}return et&&ut.push(et),ut}(U),d=0;d<U.length;d++)for(x=0;x<U[d].length;x++)$(U[d][x])}U.length===1?U=U[0]:X="Multi"+X;var le={type:"Feature",geometry:{type:X,coordinates:U},properties:this.properties};return"id"in this&&(le.id=this.id),le};var uf=ep;function ep(n,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Mc,this,s),this.length=this._features.length}function Mc(n,s,l){n===15?s.version=l.readVarint():n===1?s.name=l.readString():n===5?s.extent=l.readVarint():n===2?s._features.push(l.pos):n===3?s._keys.push(l.readString()):n===4&&s._values.push(function(d){for(var x=null,C=d.readVarint()+d.pos;d.pos<C;){var T=d.readVarint()>>3;x=T===1?d.readString():T===2?d.readFloat():T===3?d.readDouble():T===4?d.readVarint64():T===5?d.readVarint():T===6?d.readSVarint():T===7?d.readBoolean():null}return x}(l))}function Ic(n,s,l){if(n===3){var d=new uf(l,l.readVarint()+l.pos);d.length&&(s[d.name]=d)}}ep.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var s=this._pbf.readVarint()+this._pbf.pos;return new Of(this._pbf,s,this.extent,this._keys,this._values)};var Ru={VectorTile:function(n,s){this.layers=n.readFields(Ic,{},s)},VectorTileFeature:Of,VectorTileLayer:uf},kc=Ru.VectorTileFeature.types,oc=Math.pow(2,13);function Pc(n,s,l,d,x,C,T,L){n.emplaceBack(s,l,2*Math.floor(d*oc)+T,x*oc*2,C*oc*2,Math.round(L))}var lf=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Ju,this.indexArray=new dl,this.programConfigurations=new ki(n.layers,n.zoom),this.segments=new Se,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function tp(n,s){return n.x===s.x&&(n.x<0||n.x>8192)||n.y===s.y&&(n.y<0||n.y>8192)}lf.prototype.populate=function(n,s,l){this.features=[],this.hasPattern=Qh("fill-extrusion",this.layers,s);for(var d=0,x=n;d<x.length;d+=1){var C=x[d],T=C.feature,L=C.id,U=C.index,X=C.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,ee=os(T,$);if(this.layers[0]._featureFilter.filter(new ha(this.zoom),ee,l)){var le={id:L,sourceLayerIndex:X,index:U,geometry:$?ee.geometry:_o(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(Jh("fill-extrusion",this.layers,le,this.zoom,s)):this.addFeature(le,le.geometry,U,l,{}),s.featureIndex.insert(T,le.geometry,U,X,this.index,!0)}}},lf.prototype.addFeatures=function(n,s,l){for(var d=0,x=this.features;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},lf.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},lf.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},lf.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},lf.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,sf),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},lf.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},lf.prototype.addFeature=function(n,s,l,d,x){for(var C=0,T=xp(s,500);C<T.length;C+=1){for(var L=T[C],U=0,X=0,$=L;X<$.length;X+=1)U+=$[X].length;for(var ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),le=0,Ee=L;le<Ee.length;le+=1){var $e=Ee[le];if($e.length!==0&&!((Ra=$e).every(function(fa){return fa.x<0})||Ra.every(function(fa){return fa.x>8192})||Ra.every(function(fa){return fa.y<0})||Ra.every(function(fa){return fa.y>8192})))for(var et=0,mt=0;mt<$e.length;mt++){var ut=$e[mt];if(mt>=1){var Ot=$e[mt-1];if(!tp(ut,Ot)){ee.vertexLength+4>Se.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var $t=ut.sub(Ot)._perp()._unit(),dr=Ot.dist(ut);et+dr>32768&&(et=0),Pc(this.layoutVertexArray,ut.x,ut.y,$t.x,$t.y,0,0,et),Pc(this.layoutVertexArray,ut.x,ut.y,$t.x,$t.y,0,1,et),Pc(this.layoutVertexArray,Ot.x,Ot.y,$t.x,$t.y,0,0,et+=dr),Pc(this.layoutVertexArray,Ot.x,Ot.y,$t.x,$t.y,0,1,et);var gr=ee.vertexLength;this.indexArray.emplaceBack(gr,gr+2,gr+1),this.indexArray.emplaceBack(gr+1,gr+2,gr+3),ee.vertexLength+=4,ee.primitiveLength+=2}}}}if(ee.vertexLength+U>Se.MAX_VERTEX_ARRAY_LENGTH&&(ee=this.segments.prepareSegment(U,this.layoutVertexArray,this.indexArray)),kc[n.type]==="Polygon"){for(var Dr=[],hn=[],zn=ee.vertexLength,Ai=0,Qn=L;Ai<Qn.length;Ai+=1){var Mi=Qn[Ai];if(Mi.length!==0){Mi!==L[0]&&hn.push(Dr.length/2);for(var Jn=0;Jn<Mi.length;Jn++){var va=Mi[Jn];Pc(this.layoutVertexArray,va.x,va.y,0,0,1,1,0),Dr.push(va.x),Dr.push(va.y)}}}for(var Wi=Sc(Dr,hn),di=0;di<Wi.length;di+=3)this.indexArray.emplaceBack(zn+Wi[di],zn+Wi[di+2],zn+Wi[di+1]);ee.primitiveLength+=Wi.length/3,ee.vertexLength+=U}}var Ra;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,x,d)},ti("FillExtrusionBucket",lf,{omit:["layers","features"]});var w0={paint:new es({"fill-extrusion-opacity":new bi(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pi(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bi(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bi(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kf(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pi(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pi(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new bi(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},cf=function(n){function s(l){n.call(this,l,w0)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.createBucket=function(l){return new lf(l)},s.prototype.queryRadius=function(){return vs(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,L,U,X){var $=Al(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),L.angle,U),ee=this.paint.get("fill-extrusion-height").evaluate(d,x),le=this.paint.get("fill-extrusion-base").evaluate(d,x),Ee=function(et,mt,ut,Ot){for(var $t=[],dr=0,gr=et;dr<gr.length;dr+=1){var Dr=gr[dr],hn=[Dr.x,Dr.y,0,1];xh(hn,hn,mt),$t.push(new pe(hn[0]/hn[3],hn[1]/hn[3]))}return $t}($,X),$e=function(et,mt,ut,Ot){for(var $t=[],dr=[],gr=Ot[8]*mt,Dr=Ot[9]*mt,hn=Ot[10]*mt,zn=Ot[11]*mt,Ai=Ot[8]*ut,Qn=Ot[9]*ut,Mi=Ot[10]*ut,Jn=Ot[11]*ut,va=0,Wi=et;va<Wi.length;va+=1){for(var di=[],Ra=[],fa=0,za=Wi[va];fa<za.length;fa+=1){var Si=za[fa],ao=Si.x,ra=Si.y,ko=Ot[0]*ao+Ot[4]*ra+Ot[12],gs=Ot[1]*ao+Ot[5]*ra+Ot[13],jo=Ot[2]*ao+Ot[6]*ra+Ot[14],ys=Ot[3]*ao+Ot[7]*ra+Ot[15],cu=jo+hn,nu=ys+zn,il=ko+Ai,ts=gs+Qn,ju=jo+Mi,Os=ys+Jn,Go=new pe((ko+gr)/nu,(gs+Dr)/nu);Go.z=cu/nu,di.push(Go);var Sa=new pe(il/Os,ts/Os);Sa.z=ju/Os,Ra.push(Sa)}$t.push(di),dr.push(Ra)}return[$t,dr]}(C,le,ee,X);return function(et,mt,ut){var Ot=1/0;Iu(ut,mt)&&(Ot=nh(ut,mt[0]));for(var $t=0;$t<mt.length;$t++)for(var dr=mt[$t],gr=et[$t],Dr=0;Dr<dr.length-1;Dr++){var hn=dr[Dr],zn=[hn,dr[Dr+1],gr[Dr+1],gr[Dr],hn];Ul(ut,zn)&&(Ot=Math.min(Ot,nh(ut,zn)))}return Ot!==1/0&&Ot}($e[0],$e[1],Ee)},s}(El);function wh(n,s){return n.x*s.x+n.y*s.y}function nh(n,s){if(n.length===1){for(var l,d=0,x=s[d++];!l||x.equals(l);)if(!(l=s[d++]))return 1/0;for(;d<s.length;d++){var C=s[d],T=n[0],L=l.sub(x),U=C.sub(x),X=T.sub(x),$=wh(L,L),ee=wh(L,U),le=wh(U,U),Ee=wh(X,L),$e=wh(X,U),et=$*le-ee*ee,mt=(le*Ee-ee*$e)/et,ut=($*$e-ee*Ee)/et,Ot=x.z*(1-mt-ut)+l.z*mt+C.z*ut;if(isFinite(Ot))return Ot}return 1/0}for(var $t=1/0,dr=0,gr=s;dr<gr.length;dr+=1)$t=Math.min($t,gr[dr].z);return $t}var Rc=yo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,$p=yo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Kp=Ru.VectorTileFeature.types,bp=Math.cos(Math.PI/180*37.5),Id=Math.pow(2,14)/.5,oo=function(n){var s=this;this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(l){s.gradients[l.id]={}}),this.layoutVertexArray=new Qs,this.layoutVertexArray2=new pl,this.indexArray=new dl,this.programConfigurations=new ki(n.layers,n.zoom),this.segments=new Se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};oo.prototype.populate=function(n,s,l){this.hasPattern=Qh("line",this.layers,s);for(var d=this.layers[0].layout.get("line-sort-key"),x=[],C=0,T=n;C<T.length;C+=1){var L=T[C],U=L.feature,X=L.id,$=L.index,ee=L.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,Ee=os(U,le);if(this.layers[0]._featureFilter.filter(new ha(this.zoom),Ee,l)){var $e=d?d.evaluate(Ee,{},l):void 0,et={id:X,properties:U.properties,type:U.type,sourceLayerIndex:ee,index:$,geometry:le?Ee.geometry:_o(U),patterns:{},sortKey:$e};x.push(et)}}d&&x.sort(function(hn,zn){return hn.sortKey-zn.sortKey});for(var mt=0,ut=x;mt<ut.length;mt+=1){var Ot=ut[mt],$t=Ot.geometry,dr=Ot.index,gr=Ot.sourceLayerIndex;if(this.hasPattern){var Dr=Jh("line",this.layers,Ot,this.zoom,s);this.patternFeatures.push(Dr)}else this.addFeature(Ot,$t,dr,l,{});s.featureIndex.insert(n[dr].feature,$t,dr,gr,this.index)}},oo.prototype.update=function(n,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l)},oo.prototype.addFeatures=function(n,s,l){for(var d=0,x=this.patternFeatures;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},oo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},oo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},oo.prototype.upload=function(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,$p)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Rc),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},oo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},oo.prototype.lineFeatureClips=function(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}},oo.prototype.addFeature=function(n,s,l,d,x){var C=this.layers[0].layout,T=C.get("line-join").evaluate(n,{}),L=C.get("line-cap"),U=C.get("line-miter-limit"),X=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(var $=0,ee=s;$<ee.length;$+=1)this.addLine(ee[$],n,T,L,U,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,x,d)},oo.prototype.addLine=function(n,s,l,d,x,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<n.length-1;T++)this.totalDistance+=n[T].dist(n[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var L=Kp[s.type]==="Polygon",U=n.length;U>=2&&n[U-1].equals(n[U-2]);)U--;for(var X=0;X<U-1&&n[X].equals(n[X+1]);)X++;if(!(U<(L?3:2))){l==="bevel"&&(x=1.05);var $,ee=this.overscaling<=16?122880/(512*this.overscaling):0,le=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray),Ee=void 0,$e=void 0,et=void 0,mt=void 0;this.e1=this.e2=-1,L&&(mt=n[X].sub($=n[U-2])._unit()._perp());for(var ut=X;ut<U;ut++)if(!($e=ut===U-1?L?n[X+1]:void 0:n[ut+1])||!n[ut].equals($e)){mt&&(et=mt),$&&(Ee=$),$=n[ut],mt=$e?$e.sub($)._unit()._perp():et;var Ot=(et=et||mt).add(mt);Ot.x===0&&Ot.y===0||Ot._unit();var $t=et.x*mt.x+et.y*mt.y,dr=Ot.x*mt.x+Ot.y*mt.y,gr=dr!==0?1/dr:1/0,Dr=2*Math.sqrt(2-2*dr),hn=dr<bp&&Ee&&$e,zn=et.x*mt.y-et.y*mt.x>0;if(hn&&ut>X){var Ai=$.dist(Ee);if(Ai>2*ee){var Qn=$.sub($.sub(Ee)._mult(ee/Ai)._round());this.updateDistance(Ee,Qn),this.addCurrentVertex(Qn,et,0,0,le),Ee=Qn}}var Mi=Ee&&$e,Jn=Mi?l:L?"butt":d;if(Mi&&Jn==="round"&&(gr<C?Jn="miter":gr<=2&&(Jn="fakeround")),Jn==="miter"&&gr>x&&(Jn="bevel"),Jn==="bevel"&&(gr>2&&(Jn="flipbevel"),gr<x&&(Jn="miter")),Ee&&this.updateDistance(Ee,$),Jn==="miter")Ot._mult(gr),this.addCurrentVertex($,Ot,0,0,le);else if(Jn==="flipbevel"){if(gr>100)Ot=mt.mult(-1);else{var va=gr*et.add(mt).mag()/et.sub(mt).mag();Ot._perp()._mult(va*(zn?-1:1))}this.addCurrentVertex($,Ot,0,0,le),this.addCurrentVertex($,Ot.mult(-1),0,0,le)}else if(Jn==="bevel"||Jn==="fakeround"){var Wi=-Math.sqrt(gr*gr-1),di=zn?Wi:0,Ra=zn?0:Wi;if(Ee&&this.addCurrentVertex($,et,di,Ra,le),Jn==="fakeround")for(var fa=Math.round(180*Dr/Math.PI/20),za=1;za<fa;za++){var Si=za/fa;if(Si!==.5){var ao=Si-.5;Si+=Si*ao*(Si-1)*((1.0904+$t*($t*(3.55645-1.43519*$t)-3.2452))*ao*ao+(.848013+$t*(.215638*$t-1.06021)))}var ra=mt.sub(et)._mult(Si)._add(et)._unit()._mult(zn?-1:1);this.addHalfVertex($,ra.x,ra.y,!1,zn,0,le)}$e&&this.addCurrentVertex($,mt,-di,-Ra,le)}else if(Jn==="butt")this.addCurrentVertex($,Ot,0,0,le);else if(Jn==="square"){var ko=Ee?1:-1;this.addCurrentVertex($,Ot,ko,ko,le)}else Jn==="round"&&(Ee&&(this.addCurrentVertex($,et,0,0,le),this.addCurrentVertex($,et,1,1,le,!0)),$e&&(this.addCurrentVertex($,mt,-1,-1,le,!0),this.addCurrentVertex($,mt,0,0,le)));if(hn&&ut<U-1){var gs=$.dist($e);if(gs>2*ee){var jo=$.add($e.sub($)._mult(ee/gs)._round());this.updateDistance($,jo),this.addCurrentVertex(jo,mt,0,0,le),$=jo}}}}},oo.prototype.addCurrentVertex=function(n,s,l,d,x,C){C===void 0&&(C=!1);var T=s.y*d-s.x,L=-s.y-s.x*d;this.addHalfVertex(n,s.x+s.y*l,s.y-s.x*l,C,!1,l,x),this.addHalfVertex(n,T,L,C,!0,-d,x),this.distance>Id/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,s,l,d,x,C))},oo.prototype.addHalfVertex=function(n,s,l,d,x,C,T){var L=.5*(this.lineClips?this.scaledDistance*(Id-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n.x<<1)+(d?1:0),(n.y<<1)+(x?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(C===0?0:C<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var U=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),T.primitiveLength++),x?this.e2=U:this.e1=U},oo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},oo.prototype.updateDistance=function(n,s){this.distance+=n.dist(s),this.updateScaledDistance()},ti("LineBucket",oo,{omit:["layers","patternFeatures"]});var Hs=new es({"line-cap":new bi(Me.layout_line["line-cap"]),"line-join":new pi(Me.layout_line["line-join"]),"line-miter-limit":new bi(Me.layout_line["line-miter-limit"]),"line-round-limit":new bi(Me.layout_line["line-round-limit"]),"line-sort-key":new pi(Me.layout_line["line-sort-key"])}),To={paint:new es({"line-opacity":new pi(Me.paint_line["line-opacity"]),"line-color":new pi(Me.paint_line["line-color"]),"line-translate":new bi(Me.paint_line["line-translate"]),"line-translate-anchor":new bi(Me.paint_line["line-translate-anchor"]),"line-width":new pi(Me.paint_line["line-width"]),"line-gap-width":new pi(Me.paint_line["line-gap-width"]),"line-offset":new pi(Me.paint_line["line-offset"]),"line-blur":new pi(Me.paint_line["line-blur"]),"line-dasharray":new Vs(Me.paint_line["line-dasharray"]),"line-pattern":new Kf(Me.paint_line["line-pattern"]),"line-gradient":new fl(Me.paint_line["line-gradient"])}),layout:Hs},Ws=new(function(n){function s(){n.apply(this,arguments)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,d){return d=new ha(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),n.prototype.possiblyEvaluate.call(this,l,d)},s.prototype.evaluate=function(l,d,x,C){return d=Wt({},d,{zoom:Math.floor(d.zoom)}),n.prototype.evaluate.call(this,l,d,x,C)},s}(pi))(To.paint.properties["line-width"].specification);Ws.useIntegerZoom=!0;var kd=function(n){function s(l){n.call(this,l,To),this.gradientVersion=0}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Cu,this.gradientVersion=(this.gradientVersion+1)%Xe)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(l,d){n.prototype.recalculate.call(this,l,d),this.paint._values["line-floorwidth"]=Ws.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)},s.prototype.createBucket=function(l){return new oo(l)},s.prototype.queryRadius=function(l){var d=l,x=Lc(Vl("line-width",this,d),Vl("line-gap-width",this,d)),C=Vl("line-offset",this,d);return x/2+Math.abs(C)+vs(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,L,U){var X=Al(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),L.angle,U),$=U/2*Lc(this.paint.get("line-width").evaluate(d,x),this.paint.get("line-gap-width").evaluate(d,x)),ee=this.paint.get("line-offset").evaluate(d,x);return ee&&(C=function(le,Ee){for(var $e=[],et=new pe(0,0),mt=0;mt<le.length;mt++){for(var ut=le[mt],Ot=[],$t=0;$t<ut.length;$t++){var dr=ut[$t],gr=ut[$t+1],Dr=$t===0?et:dr.sub(ut[$t-1])._unit()._perp(),hn=$t===ut.length-1?et:gr.sub(dr)._unit()._perp(),zn=Dr._add(hn)._unit();zn._mult(1/(zn.x*hn.x+zn.y*hn.y)),Ot.push(zn._mult(Ee)._add(dr))}$e.push(Ot)}return $e}(C,ee*U)),function(le,Ee,$e){for(var et=0;et<Ee.length;et++){var mt=Ee[et];if(le.length>=3){for(var ut=0;ut<mt.length;ut++)if(Sl(le,mt[ut]))return!0}if(ku(le,mt,$e))return!0}return!1}(X,C,$)},s.prototype.isTileClipped=function(){return!0},s}(El);function Lc(n,s){return s>0?s+2*n:n}var Jd=yo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pd=yo([{name:"a_projected_pos",components:3,type:"Float32"}],4),Qp=(yo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),yo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Jp=(yo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),yo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),e0=yo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function t0(n,s,l){return n.sections.forEach(function(d){d.text=function(x,C,T){var L=C.layout.get("text-transform").evaluate(T,{});return L==="uppercase"?x=x.toLocaleUpperCase():L==="lowercase"&&(x=x.toLocaleLowerCase()),Ks.applyArabicShaping&&(x=Ks.applyArabicShaping(x)),x}(d.text,s,l)}),n}yo([{name:"triangle",components:3,type:"Uint16"}]),yo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),yo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),yo([{type:"Float32",name:"offsetX"}]),yo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ed={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Ep=function(n,s,l,d,x){var C,T,L=8*x-d-1,U=(1<<L)-1,X=U>>1,$=-7,ee=l?x-1:0,le=l?-1:1,Ee=n[s+ee];for(ee+=le,C=Ee&(1<<-$)-1,Ee>>=-$,$+=L;$>0;C=256*C+n[s+ee],ee+=le,$-=8);for(T=C&(1<<-$)-1,C>>=-$,$+=d;$>0;T=256*T+n[s+ee],ee+=le,$-=8);if(C===0)C=1-X;else{if(C===U)return T?NaN:1/0*(Ee?-1:1);T+=Math.pow(2,d),C-=X}return(Ee?-1:1)*T*Math.pow(2,C-d)},r0=function(n,s,l,d,x,C){var T,L,U,X=8*C-x-1,$=(1<<X)-1,ee=$>>1,le=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ee=d?0:C-1,$e=d?1:-1,et=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(L=isNaN(s)?1:0,T=$):(T=Math.floor(Math.log(s)/Math.LN2),s*(U=Math.pow(2,-T))<1&&(T--,U*=2),(s+=T+ee>=1?le/U:le*Math.pow(2,1-ee))*U>=2&&(T++,U/=2),T+ee>=$?(L=0,T=$):T+ee>=1?(L=(s*U-1)*Math.pow(2,x),T+=ee):(L=s*Math.pow(2,ee-1)*Math.pow(2,x),T=0));x>=8;n[l+Ee]=255&L,Ee+=$e,L/=256,x-=8);for(T=T<<x|L,X+=x;X>0;n[l+Ee]=255&T,Ee+=$e,T/=256,X-=8);n[l+Ee-$e]|=128*et},Ff=xo;function xo(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}xo.Varint=0,xo.Fixed64=1,xo.Bytes=2,xo.Fixed32=5;var Rd=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Oc(n){return n.type===xo.Bytes?n.readVarint()+n.pos:n.pos+1}function ih(n,s,l){return l?4294967296*s+(n>>>0):4294967296*(s>>>0)+(n>>>0)}function Ld(n,s,l){var d=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(d);for(var x=l.pos-1;x>=n;x--)l.buf[x+d]=l.buf[x]}function td(n,s){for(var l=0;l<n.length;l++)s.writeVarint(n[l])}function H(n,s){for(var l=0;l<n.length;l++)s.writeSVarint(n[l])}function Le(n,s){for(var l=0;l<n.length;l++)s.writeFloat(n[l])}function at(n,s){for(var l=0;l<n.length;l++)s.writeDouble(n[l])}function fr(n,s){for(var l=0;l<n.length;l++)s.writeBoolean(n[l])}function Nr(n,s){for(var l=0;l<n.length;l++)s.writeFixed32(n[l])}function ur(n,s){for(var l=0;l<n.length;l++)s.writeSFixed32(n[l])}function Tr(n,s){for(var l=0;l<n.length;l++)s.writeFixed64(n[l])}function Vr(n,s){for(var l=0;l<n.length;l++)s.writeSFixed64(n[l])}function qr(n,s){return(n[s]|n[s+1]<<8|n[s+2]<<16)+16777216*n[s+3]}function rn(n,s,l){n[l]=s,n[l+1]=s>>>8,n[l+2]=s>>>16,n[l+3]=s>>>24}function pn(n,s){return(n[s]|n[s+1]<<8|n[s+2]<<16)+(n[s+3]<<24)}function dn(n,s,l){n===1&&l.readMessage(An,s)}function An(n,s,l){if(n===3){var d=l.readMessage(en,{}),x=d.width,C=d.height,T=d.left,L=d.top,U=d.advance;s.push({id:d.id,bitmap:new Gl({width:x+6,height:C+6},d.bitmap),metrics:{width:x,height:C,left:T,top:L,advance:U}})}}function en(n,s,l){n===1?s.id=l.readVarint():n===2?s.bitmap=l.readBytes():n===3?s.width=l.readVarint():n===4?s.height=l.readVarint():n===5?s.left=l.readSVarint():n===6?s.top=l.readSVarint():n===7&&(s.advance=l.readVarint())}function fn(n){for(var s=0,l=0,d=0,x=n;d<x.length;d+=1){var C=x[d];s+=C.w*C.h,l=Math.max(l,C.w)}n.sort(function(et,mt){return mt.h-et.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],L=0,U=0,X=0,$=n;X<$.length;X+=1)for(var ee=$[X],le=T.length-1;le>=0;le--){var Ee=T[le];if(!(ee.w>Ee.w||ee.h>Ee.h)){if(ee.x=Ee.x,ee.y=Ee.y,U=Math.max(U,ee.y+ee.h),L=Math.max(L,ee.x+ee.w),ee.w===Ee.w&&ee.h===Ee.h){var $e=T.pop();le<T.length&&(T[le]=$e)}else ee.h===Ee.h?(Ee.x+=ee.w,Ee.w-=ee.w):ee.w===Ee.w?(Ee.y+=ee.h,Ee.h-=ee.h):(T.push({x:Ee.x+ee.w,y:Ee.y,w:Ee.w-ee.w,h:ee.h}),Ee.y+=ee.h,Ee.h-=ee.h);break}}return{w:L,h:U,fill:s/(L*U)||0}}xo.prototype={destroy:function(){this.buf=null},readFields:function(n,s,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),x=d>>3,C=this.pos;this.type=7&d,n(x,s,this),this.pos===C&&this.skip(d)}return s},readMessage:function(n,s){return this.readFields(n,s,this.readVarint()+this.pos)},readFixed32:function(){var n=qr(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=pn(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=qr(this.buf,this.pos)+4294967296*qr(this.buf,this.pos+4);return this.pos+=8,n},readSFixed64:function(){var n=qr(this.buf,this.pos)+4294967296*pn(this.buf,this.pos+4);return this.pos+=8,n},readFloat:function(){var n=Ep(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Ep(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var s,l,d=this.buf;return s=127&(l=d[this.pos++]),l<128?s:(s|=(127&(l=d[this.pos++]))<<7,l<128?s:(s|=(127&(l=d[this.pos++]))<<14,l<128?s:(s|=(127&(l=d[this.pos++]))<<21,l<128?s:function(x,C,T){var L,U,X=T.buf;if(L=(112&(U=X[T.pos++]))>>4,U<128||(L|=(127&(U=X[T.pos++]))<<3,U<128)||(L|=(127&(U=X[T.pos++]))<<10,U<128)||(L|=(127&(U=X[T.pos++]))<<17,U<128)||(L|=(127&(U=X[T.pos++]))<<24,U<128)||(L|=(1&(U=X[T.pos++]))<<31,U<128))return ih(x,L,C);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(l=d[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,s=this.pos;return this.pos=n,n-s>=12&&Rd?function(l,d,x){return Rd.decode(l.subarray(d,x))}(this.buf,s,n):function(l,d,x){for(var C="",T=d;T<x;){var L,U,X,$=l[T],ee=null,le=$>239?4:$>223?3:$>191?2:1;if(T+le>x)break;le===1?$<128&&(ee=$):le===2?(192&(L=l[T+1]))==128&&(ee=(31&$)<<6|63&L)<=127&&(ee=null):le===3?(U=l[T+2],(192&(L=l[T+1]))==128&&(192&U)==128&&((ee=(15&$)<<12|(63&L)<<6|63&U)<=2047||ee>=55296&&ee<=57343)&&(ee=null)):le===4&&(U=l[T+2],X=l[T+3],(192&(L=l[T+1]))==128&&(192&U)==128&&(192&X)==128&&((ee=(15&$)<<18|(63&L)<<12|(63&U)<<6|63&X)<=65535||ee>=1114112)&&(ee=null)),ee===null?(ee=65533,le=1):ee>65535&&(ee-=65536,C+=String.fromCharCode(ee>>>10&1023|55296),ee=56320|1023&ee),C+=String.fromCharCode(ee),T+=le}return C}(this.buf,s,n)},readBytes:function(){var n=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,n);return this.pos=n,s},readPackedVarint:function(n,s){if(this.type!==xo.Bytes)return n.push(this.readVarint(s));var l=Oc(this);for(n=n||[];this.pos<l;)n.push(this.readVarint(s));return n},readPackedSVarint:function(n){if(this.type!==xo.Bytes)return n.push(this.readSVarint());var s=Oc(this);for(n=n||[];this.pos<s;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==xo.Bytes)return n.push(this.readBoolean());var s=Oc(this);for(n=n||[];this.pos<s;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==xo.Bytes)return n.push(this.readFloat());var s=Oc(this);for(n=n||[];this.pos<s;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==xo.Bytes)return n.push(this.readDouble());var s=Oc(this);for(n=n||[];this.pos<s;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==xo.Bytes)return n.push(this.readFixed32());var s=Oc(this);for(n=n||[];this.pos<s;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==xo.Bytes)return n.push(this.readSFixed32());var s=Oc(this);for(n=n||[];this.pos<s;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==xo.Bytes)return n.push(this.readFixed64());var s=Oc(this);for(n=n||[];this.pos<s;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==xo.Bytes)return n.push(this.readSFixed64());var s=Oc(this);for(n=n||[];this.pos<s;)n.push(this.readSFixed64());return n},skip:function(n){var s=7&n;if(s===xo.Varint)for(;this.buf[this.pos++]>127;);else if(s===xo.Bytes)this.pos=this.readVarint()+this.pos;else if(s===xo.Fixed32)this.pos+=4;else{if(s!==xo.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(n,s){this.writeVarint(n<<3|s)},realloc:function(n){for(var s=this.length||16;s<this.pos+n;)s*=2;if(s!==this.length){var l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),rn(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),rn(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),rn(this.buf,-1&n,this.pos),rn(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),rn(this.buf,-1&n,this.pos),rn(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(s,l){var d,x;if(s>=0?(d=s%4294967296|0,x=s/4294967296|0):(x=~(-s/4294967296),4294967295^(d=~(-s%4294967296))?d=d+1|0:(d=0,x=x+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(C,T,L){L.buf[L.pos++]=127&C|128,C>>>=7,L.buf[L.pos++]=127&C|128,C>>>=7,L.buf[L.pos++]=127&C|128,C>>>=7,L.buf[L.pos++]=127&C|128,L.buf[L.pos]=127&(C>>>=7)}(d,0,l),function(C,T){var L=(7&C)<<4;T.buf[T.pos++]|=L|((C>>>=3)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C)))))}(x,l)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var s=this.pos;this.pos=function(d,x,C){for(var T,L,U=0;U<x.length;U++){if((T=x.charCodeAt(U))>55295&&T<57344){if(!L){T>56319||U+1===x.length?(d[C++]=239,d[C++]=191,d[C++]=189):L=T;continue}if(T<56320){d[C++]=239,d[C++]=191,d[C++]=189,L=T;continue}T=L-55296<<10|T-56320|65536,L=null}else L&&(d[C++]=239,d[C++]=191,d[C++]=189,L=null);T<128?d[C++]=T:(T<2048?d[C++]=T>>6|192:(T<65536?d[C++]=T>>12|224:(d[C++]=T>>18|240,d[C++]=T>>12&63|128),d[C++]=T>>6&63|128),d[C++]=63&T|128)}return C}(this.buf,n,this.pos);var l=this.pos-s;l>=128&&Ld(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeFloat:function(n){this.realloc(4),r0(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),r0(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var s=n.length;this.writeVarint(s),this.realloc(s);for(var l=0;l<s;l++)this.buf[this.pos++]=n[l]},writeRawMessage:function(n,s){this.pos++;var l=this.pos;n(s,this);var d=this.pos-l;d>=128&&Ld(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(n,s,l){this.writeTag(n,xo.Bytes),this.writeRawMessage(s,l)},writePackedVarint:function(n,s){s.length&&this.writeMessage(n,td,s)},writePackedSVarint:function(n,s){s.length&&this.writeMessage(n,H,s)},writePackedBoolean:function(n,s){s.length&&this.writeMessage(n,fr,s)},writePackedFloat:function(n,s){s.length&&this.writeMessage(n,Le,s)},writePackedDouble:function(n,s){s.length&&this.writeMessage(n,at,s)},writePackedFixed32:function(n,s){s.length&&this.writeMessage(n,Nr,s)},writePackedSFixed32:function(n,s){s.length&&this.writeMessage(n,ur,s)},writePackedFixed64:function(n,s){s.length&&this.writeMessage(n,Tr,s)},writePackedSFixed64:function(n,s){s.length&&this.writeMessage(n,Vr,s)},writeBytesField:function(n,s){this.writeTag(n,xo.Bytes),this.writeBytes(s)},writeFixed32Field:function(n,s){this.writeTag(n,xo.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(n,s){this.writeTag(n,xo.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(n,s){this.writeTag(n,xo.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(n,s){this.writeTag(n,xo.Fixed64),this.writeSFixed64(s)},writeVarintField:function(n,s){this.writeTag(n,xo.Varint),this.writeVarint(s)},writeSVarintField:function(n,s){this.writeTag(n,xo.Varint),this.writeSVarint(s)},writeStringField:function(n,s){this.writeTag(n,xo.Bytes),this.writeString(s)},writeFloatField:function(n,s){this.writeTag(n,xo.Fixed32),this.writeFloat(s)},writeDoubleField:function(n,s){this.writeTag(n,xo.Fixed64),this.writeDouble(s)},writeBooleanField:function(n,s){this.writeVarintField(n,Boolean(s))}};var Ft=function(n,s){var l=s.pixelRatio,d=s.version,x=s.stretchX,C=s.stretchY,T=s.content;this.paddedRect=n,this.pixelRatio=l,this.stretchX=x,this.stretchY=C,this.content=T,this.version=d},mr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};mr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},mr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},mr.tlbr.get=function(){return this.tl.concat(this.br)},mr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Ft.prototype,mr);var nn=function(n,s){var l={},d={};this.haveRenderCallbacks=[];var x=[];this.addImages(n,l,x),this.addImages(s,d,x);var C=fn(x),T=new Js({width:C.w||1,height:C.h||1});for(var L in n){var U=n[L],X=l[L].paddedRect;Js.copy(U.data,T,{x:0,y:0},{x:X.x+1,y:X.y+1},U.data)}for(var $ in s){var ee=s[$],le=d[$].paddedRect,Ee=le.x+1,$e=le.y+1,et=ee.data.width,mt=ee.data.height;Js.copy(ee.data,T,{x:0,y:0},{x:Ee,y:$e},ee.data),Js.copy(ee.data,T,{x:0,y:mt-1},{x:Ee,y:$e-1},{width:et,height:1}),Js.copy(ee.data,T,{x:0,y:0},{x:Ee,y:$e+mt},{width:et,height:1}),Js.copy(ee.data,T,{x:et-1,y:0},{x:Ee-1,y:$e},{width:1,height:mt}),Js.copy(ee.data,T,{x:0,y:0},{x:Ee+et,y:$e},{width:1,height:mt})}this.image=T,this.iconPositions=l,this.patternPositions=d};nn.prototype.addImages=function(n,s,l){for(var d in n){var x=n[d],C={x:0,y:0,w:x.data.width+2,h:x.data.height+2};l.push(C),s[d]=new Ft(C,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(d)}},nn.prototype.patchUpdatedImages=function(n,s){for(var l in n.dispatchRenderCallbacks(this.haveRenderCallbacks),n.updatedImages)this.patchUpdatedImage(this.iconPositions[l],n.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],n.getImage(l),s)},nn.prototype.patchUpdatedImage=function(n,s,l){if(n&&s&&n.version!==s.version){n.version=s.version;var d=n.tl;l.update(s.data,void 0,{x:d[0],y:d[1]})}},ti("ImagePosition",Ft),ti("ImageAtlas",nn);var kn={horizontal:1,vertical:2,horizontalOnly:3},zr=function(){this.scale=1,this.fontStack="",this.imageName=null};zr.forText=function(n,s){var l=new zr;return l.scale=n||1,l.fontStack=s,l},zr.forImage=function(n){var s=new zr;return s.imageName=n,s};var _n=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function On(n,s,l,d,x,C,T,L,U,X,$,ee,le,Ee,$e,et){var mt,ut=_n.fromFeature(n,x);ee===kn.vertical&&ut.verticalizePunctuation();var Ot=Ks.processBidirectionalText,$t=Ks.processStyledBidirectionalText;if(Ot&&ut.sections.length===1){mt=[];for(var dr=0,gr=Ot(ut.toString(),Bn(ut,X,C,s,d,Ee,$e));dr<gr.length;dr+=1){var Dr=gr[dr],hn=new _n;hn.text=Dr,hn.sections=ut.sections;for(var zn=0;zn<Dr.length;zn++)hn.sectionIndex.push(0);mt.push(hn)}}else if($t){mt=[];for(var Ai=0,Qn=$t(ut.text,ut.sectionIndex,Bn(ut,X,C,s,d,Ee,$e));Ai<Qn.length;Ai+=1){var Mi=Qn[Ai],Jn=new _n;Jn.text=Mi[0],Jn.sectionIndex=Mi[1],Jn.sections=ut.sections,mt.push(Jn)}}else mt=function(di,Ra){for(var fa=[],za=di.text,Si=0,ao=0,ra=Ra;ao<ra.length;ao+=1){var ko=ra[ao];fa.push(di.substring(Si,ko)),Si=ko}return Si<za.length&&fa.push(di.substring(Si,za.length)),fa}(ut,Bn(ut,X,C,s,d,Ee,$e));var va=[],Wi={positionedLines:va,text:ut.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:ee,iconsInText:!1,verticalizable:!1};return function(di,Ra,fa,za,Si,ao,ra,ko,gs,jo,ys,cu){for(var nu=0,il=-17,ts=0,ju=0,Os=ko==="right"?1:ko==="left"?0:.5,Go=0,Sa=0,so=Si;Sa<so.length;Sa+=1){var bo=so[Sa];bo.trim();var Ua=bo.getMaxScale(),Gu=24*(Ua-1),fu={positionedGlyphs:[],lineOffset:0};di.positionedLines[Go]=fu;var Do=fu.positionedGlyphs,Xs=0;if(bo.length()){for(var Lu=0;Lu<bo.length();Lu++){var Xa=bo.getSection(Lu),wl=bo.getSectionIndex(Lu),uc=bo.getCharCode(Lu),al=0,Ss=null,Nc=null,zc=null,ad=24,Cp=!(gs===kn.horizontal||!ys&&!dh(uc)||ys&&(Ti[uc]||(hf=uc,Mn.Arabic(hf)||Mn["Arabic Supplement"](hf)||Mn["Arabic Extended-A"](hf)||Mn["Arabic Presentation Forms-A"](hf)||Mn["Arabic Presentation Forms-B"](hf))));if(Xa.imageName){var od=za[Xa.imageName];if(!od)continue;zc=Xa.imageName,di.iconsInText=di.iconsInText||!0,Nc=od.paddedRect;var Th=od.displaySize;Xa.scale=24*Xa.scale/cu,al=Gu+(24-Th[1]*Xa.scale),ad=(Ss={width:Th[0],height:Th[1],left:1,top:-3,advance:Cp?Th[1]:Th[0]}).advance;var sd=Cp?Th[0]*Xa.scale-24*Ua:Th[1]*Xa.scale-24*Ua;sd>0&&sd>Xs&&(Xs=sd)}else{var ip=fa[Xa.fontStack],ap=ip&&ip[uc];if(ap&&ap.rect)Nc=ap.rect,Ss=ap.metrics;else{var Sp=Ra[Xa.fontStack],op=Sp&&Sp[uc];if(!op)continue;Ss=op.metrics}al=24*(Ua-Xa.scale)}Cp?(di.verticalizable=!0,Do.push({glyph:uc,imageName:zc,x:nu,y:il+al,vertical:Cp,scale:Xa.scale,fontStack:Xa.fontStack,sectionIndex:wl,metrics:Ss,rect:Nc}),nu+=ad*Xa.scale+jo):(Do.push({glyph:uc,imageName:zc,x:nu,y:il+al,vertical:Cp,scale:Xa.scale,fontStack:Xa.fontStack,sectionIndex:wl,metrics:Ss,rect:Nc}),nu+=Ss.advance*Xa.scale+jo)}Do.length!==0&&(ts=Math.max(nu-jo,ts),ca(Do,0,Do.length-1,Os,Xs)),nu=0;var ud=ao*Ua+Xs;fu.lineOffset=Math.max(Xs,Gu),il+=ud,ju=Math.max(ud,ju),++Go}else il+=ao,++Go}var hf,Fd=il- -17,Ap=Un(ra),sp=Ap.horizontalAlign,sh=Ap.verticalAlign;(function(Dd,wp,Tp,ld,cd,fd,Mh,hd,pd){var Ih,Mp=(wp-Tp)*cd;Ih=fd!==Mh?-hd*ld- -17:(-ld*pd+.5)*Mh;for(var up=0,lp=Dd;up<lp.length;up+=1)for(var pf=0,dd=lp[up].positionedGlyphs;pf<dd.length;pf+=1){var vd=dd[pf];vd.x+=Mp,vd.y+=Ih}})(di.positionedLines,Os,sp,sh,ts,ju,ao,Fd,Si.length),di.top+=-sh*Fd,di.bottom=di.top+Fd,di.left+=-sp*ts,di.right=di.left+ts}(Wi,s,l,d,mt,T,L,U,ee,X,le,et),!function(di){for(var Ra=0,fa=di;Ra<fa.length;Ra+=1)if(fa[Ra].positionedGlyphs.length!==0)return!1;return!0}(va)&&Wi}_n.fromFeature=function(n,s){for(var l=new _n,d=0;d<n.sections.length;d++){var x=n.sections[d];x.image?l.addImageSection(x):l.addTextSection(x,s)}return l},_n.prototype.length=function(){return this.text.length},_n.prototype.getSection=function(n){return this.sections[this.sectionIndex[n]]},_n.prototype.getSectionIndex=function(n){return this.sectionIndex[n]},_n.prototype.getCharCode=function(n){return this.text.charCodeAt(n)},_n.prototype.verticalizePunctuation=function(){this.text=function(n){for(var s="",l=0;l<n.length;l++){var d=n.charCodeAt(l+1)||null,x=n.charCodeAt(l-1)||null;s+=d&&bl(d)&&!ed[n[l+1]]||x&&bl(x)&&!ed[n[l-1]]||!ed[n[l]]?n[l]:ed[n[l]]}return s}(this.text)},_n.prototype.trim=function(){for(var n=0,s=0;s<this.text.length&&Ti[this.text.charCodeAt(s)];s++)n++;for(var l=this.text.length,d=this.text.length-1;d>=0&&d>=n&&Ti[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(n,l),this.sectionIndex=this.sectionIndex.slice(n,l)},_n.prototype.substring=function(n,s){var l=new _n;return l.text=this.text.substring(n,s),l.sectionIndex=this.sectionIndex.slice(n,s),l.sections=this.sections,l},_n.prototype.toString=function(){return this.text},_n.prototype.getMaxScale=function(){var n=this;return this.sectionIndex.reduce(function(s,l){return Math.max(s,n.sections[l].scale)},0)},_n.prototype.addTextSection=function(n,s){this.text+=n.text,this.sections.push(zr.forText(n.scale,n.fontStack||s));for(var l=this.sections.length-1,d=0;d<n.text.length;++d)this.sectionIndex.push(l)},_n.prototype.addImageSection=function(n){var s=n.image?n.image.name:"";if(s.length!==0){var l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(zr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ue("Reached maximum number of images 6401")}else Ue("Can't add FormattedSection with an empty image.")},_n.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Ti={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Mr={};function Lr(n,s,l,d,x,C){if(s.imageName){var T=d[s.imageName];return T?T.displaySize[0]*s.scale*24/C+x:0}var L=l[s.fontStack],U=L&&L[n];return U?U.metrics.advance*s.scale+x:0}function si(n,s,l,d){var x=Math.pow(n-s,2);return d?n<s?x/2:2*x:x+Math.abs(l)*l}function Ln(n,s,l){var d=0;return n===10&&(d-=1e4),l&&(d+=150),n!==40&&n!==65288||(d+=50),s!==41&&s!==65289||(d+=50),d}function tn(n,s,l,d,x,C){for(var T=null,L=si(s,l,x,C),U=0,X=d;U<X.length;U+=1){var $=X[U],ee=si(s-$.x,l,x,C)+$.badness;ee<=L&&(T=$,L=ee)}return{index:n,x:s,priorBreak:T,badness:L}}function Bn(n,s,l,d,x,C,T){if(C!=="point")return[];if(!n)return[];for(var L,U=[],X=function(mt,ut,Ot,$t,dr,gr){for(var Dr=0,hn=0;hn<mt.length();hn++){var zn=mt.getSection(hn);Dr+=Lr(mt.getCharCode(hn),zn,$t,dr,ut,gr)}return Dr/Math.max(1,Math.ceil(Dr/Ot))}(n,s,l,d,x,T),$=n.text.indexOf("\u200B")>=0,ee=0,le=0;le<n.length();le++){var Ee=n.getSection(le),$e=n.getCharCode(le);if(Ti[$e]||(ee+=Lr($e,Ee,d,x,s,T)),le<n.length()-1){var et=!((L=$e)<11904||!(Mn["Bopomofo Extended"](L)||Mn.Bopomofo(L)||Mn["CJK Compatibility Forms"](L)||Mn["CJK Compatibility Ideographs"](L)||Mn["CJK Compatibility"](L)||Mn["CJK Radicals Supplement"](L)||Mn["CJK Strokes"](L)||Mn["CJK Symbols and Punctuation"](L)||Mn["CJK Unified Ideographs Extension A"](L)||Mn["CJK Unified Ideographs"](L)||Mn["Enclosed CJK Letters and Months"](L)||Mn["Halfwidth and Fullwidth Forms"](L)||Mn.Hiragana(L)||Mn["Ideographic Description Characters"](L)||Mn["Kangxi Radicals"](L)||Mn["Katakana Phonetic Extensions"](L)||Mn.Katakana(L)||Mn["Vertical Forms"](L)||Mn["Yi Radicals"](L)||Mn["Yi Syllables"](L)));(Mr[$e]||et||Ee.imageName)&&U.push(tn(le+1,ee,X,U,Ln($e,n.getCharCode(le+1),et&&$),!1))}}return function mt(ut){return ut?mt(ut.priorBreak).concat(ut.index):[]}(tn(n.length(),ee,X,U,0,!0))}function Un(n){var s=.5,l=.5;switch(n){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function ca(n,s,l,d,x){if(d||x)for(var C=n[l],T=(n[l].x+C.metrics.advance*C.scale)*d,L=s;L<=l;L++)n[L].x-=T,n[L].y+=x}function Hi(n,s,l,d,x,C){var T,L=n.image;if(L.content){var U=L.content,X=L.pixelRatio||1;T=[U[0]/X,U[1]/X,L.displaySize[0]-U[2]/X,L.displaySize[1]-U[3]/X]}var $,ee,le,Ee,$e=s.left*C,et=s.right*C;l==="width"||l==="both"?(Ee=x[0]+$e-d[3],ee=x[0]+et+d[1]):ee=(Ee=x[0]+($e+et-L.displaySize[0])/2)+L.displaySize[0];var mt=s.top*C,ut=s.bottom*C;return l==="height"||l==="both"?($=x[1]+mt-d[0],le=x[1]+ut+d[2]):le=($=x[1]+(mt+ut-L.displaySize[1])/2)+L.displaySize[1],{image:L,top:$,right:ee,bottom:le,left:Ee,collisionPadding:T}}Mr[10]=!0,Mr[32]=!0,Mr[38]=!0,Mr[40]=!0,Mr[41]=!0,Mr[43]=!0,Mr[45]=!0,Mr[47]=!0,Mr[173]=!0,Mr[183]=!0,Mr[8203]=!0,Mr[8208]=!0,Mr[8211]=!0,Mr[8231]=!0;var Jr=function(n){function s(l,d,x,C){n.call(this,l,d),this.angle=x,C!==void 0&&(this.segment=C)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(pe);function on(n,s){var l=s.expression;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ha(n+1))};if(l.kind==="source")return{kind:"source"};for(var d=l.zoomStops,x=l.interpolationType,C=0;C<d.length&&d[C]<=n;)C++;for(var T=C=Math.max(0,C-1);T<d.length&&d[T]<n+1;)T++;T=Math.min(d.length-1,T);var L=d[C],U=d[T];return l.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:U,interpolationType:x}:{kind:"camera",minZoom:L,maxZoom:U,minSize:l.evaluate(new ha(L)),maxSize:l.evaluate(new ha(U)),interpolationType:x}}function Ii(n,s,l){var d=s.uSize,x=l.lowerSize;return n.kind==="source"?x/128:n.kind==="composite"?Za(x/128,l.upperSize/128,s.uSizeT):d}function ta(n,s){var l=0,d=0;if(n.kind==="constant")d=n.layoutSize;else if(n.kind!=="source"){var x=n.interpolationType,C=x?tr(Oe.interpolationFactor(x,s,n.minZoom,n.maxZoom),0,1):0;n.kind==="camera"?d=Za(n.minSize,n.maxSize,C):l=C}return{uSizeT:l,uSize:d}}ti("Anchor",Jr);var da=Object.freeze({__proto__:null,getSizeData:on,evaluateSizeForFeature:Ii,evaluateSizeForZoom:ta,SIZE_PACK_FACTOR:128});function ss(n,s,l,d,x){if(s.segment===void 0)return!0;for(var C=s,T=s.segment+1,L=0;L>-l/2;){if(--T<0)return!1;L-=n[T].dist(C),C=n[T]}L+=n[T].dist(n[T+1]),T++;for(var U=[],X=0;L<l/2;){var $=n[T],ee=n[T+1];if(!ee)return!1;var le=n[T-1].angleTo($)-$.angleTo(ee);for(le=Math.abs((le+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:L,angleDelta:le}),X+=le;L-U[0].distance>d;)X-=U.shift().angleDelta;if(X>x)return!1;T++,L+=$.dist(ee)}return!0}function ms(n){for(var s=0,l=0;l<n.length-1;l++)s+=n[l].dist(n[l+1]);return s}function Pa(n,s,l){return n?.6*s*l:0}function yu(n,s){return Math.max(n?n.right-n.left:0,s?s.right-s.left:0)}function Mo(n,s,l,d,x,C){for(var T=Pa(l,x,C),L=yu(l,d)*C,U=0,X=ms(n)/2,$=0;$<n.length-1;$++){var ee=n[$],le=n[$+1],Ee=ee.dist(le);if(U+Ee>X){var $e=(X-U)/Ee,et=Za(ee.x,le.x,$e),mt=Za(ee.y,le.y,$e),ut=new Jr(et,mt,le.angleTo(ee),$);return ut._round(),!T||ss(n,ut,L,T,s)?ut:void 0}U+=Ee}}function Io(n,s,l,d,x,C,T,L,U){var X=Pa(d,C,T),$=yu(d,x),ee=$*T,le=n[0].x===0||n[0].x===U||n[0].y===0||n[0].y===U;return s-ee<s/4&&(s=ee+s/4),function Ee($e,et,mt,ut,Ot,$t,dr,gr,Dr){for(var hn=$t/2,zn=ms($e),Ai=0,Qn=et-mt,Mi=[],Jn=0;Jn<$e.length-1;Jn++){for(var va=$e[Jn],Wi=$e[Jn+1],di=va.dist(Wi),Ra=Wi.angleTo(va);Qn+mt<Ai+di;){var fa=((Qn+=mt)-Ai)/di,za=Za(va.x,Wi.x,fa),Si=Za(va.y,Wi.y,fa);if(za>=0&&za<Dr&&Si>=0&&Si<Dr&&Qn-hn>=0&&Qn+hn<=zn){var ao=new Jr(za,Si,Ra,Jn);ao._round(),ut&&!ss($e,ao,$t,ut,Ot)||Mi.push(ao)}}Ai+=di}return gr||Mi.length||dr||(Mi=Ee($e,Ai/2,mt,ut,Ot,$t,dr,!0,Dr)),Mi}(n,le?s/2*L%s:($/2+2*C)*T*L%s,s,X,l,ee,le,!1,U)}function Ps(n,s,l,d,x){for(var C=[],T=0;T<n.length;T++)for(var L=n[T],U=void 0,X=0;X<L.length-1;X++){var $=L[X],ee=L[X+1];$.x<s&&ee.x<s||($.x<s?$=new pe(s,$.y+(s-$.x)/(ee.x-$.x)*(ee.y-$.y))._round():ee.x<s&&(ee=new pe(s,$.y+(s-$.x)/(ee.x-$.x)*(ee.y-$.y))._round()),$.y<l&&ee.y<l||($.y<l?$=new pe($.x+(l-$.y)/(ee.y-$.y)*(ee.x-$.x),l)._round():ee.y<l&&(ee=new pe($.x+(l-$.y)/(ee.y-$.y)*(ee.x-$.x),l)._round()),$.x>=d&&ee.x>=d||($.x>=d?$=new pe(d,$.y+(d-$.x)/(ee.x-$.x)*(ee.y-$.y))._round():ee.x>=d&&(ee=new pe(d,$.y+(d-$.x)/(ee.x-$.x)*(ee.y-$.y))._round()),$.y>=x&&ee.y>=x||($.y>=x?$=new pe($.x+(x-$.y)/(ee.y-$.y)*(ee.x-$.x),x)._round():ee.y>=x&&(ee=new pe($.x+(x-$.y)/(ee.y-$.y)*(ee.x-$.x),x)._round()),U&&$.equals(U[U.length-1])||C.push(U=[$]),U.push(ee)))))}return C}function uu(n,s,l,d){var x=[],C=n.image,T=C.pixelRatio,L=C.paddedRect.w-2,U=C.paddedRect.h-2,X=n.right-n.left,$=n.bottom-n.top,ee=C.stretchX||[[0,L]],le=C.stretchY||[[0,U]],Ee=function(za,Si){return za+Si[1]-Si[0]},$e=ee.reduce(Ee,0),et=le.reduce(Ee,0),mt=L-$e,ut=U-et,Ot=0,$t=$e,dr=0,gr=et,Dr=0,hn=mt,zn=0,Ai=ut;if(C.content&&d){var Qn=C.content;Ot=tu(ee,0,Qn[0]),dr=tu(le,0,Qn[1]),$t=tu(ee,Qn[0],Qn[2]),gr=tu(le,Qn[1],Qn[3]),Dr=Qn[0]-Ot,zn=Qn[1]-dr,hn=Qn[2]-Qn[0]-$t,Ai=Qn[3]-Qn[1]-gr}var Mi=function(za,Si,ao,ra){var ko=Qo(za.stretch-Ot,$t,X,n.left),gs=ia(za.fixed-Dr,hn,za.stretch,$e),jo=Qo(Si.stretch-dr,gr,$,n.top),ys=ia(Si.fixed-zn,Ai,Si.stretch,et),cu=Qo(ao.stretch-Ot,$t,X,n.left),nu=ia(ao.fixed-Dr,hn,ao.stretch,$e),il=Qo(ra.stretch-dr,gr,$,n.top),ts=ia(ra.fixed-zn,Ai,ra.stretch,et),ju=new pe(ko,jo),Os=new pe(cu,jo),Go=new pe(cu,il),Sa=new pe(ko,il),so=new pe(gs/T,ys/T),bo=new pe(nu/T,ts/T),Ua=s*Math.PI/180;if(Ua){var Gu=Math.sin(Ua),fu=Math.cos(Ua),Do=[fu,-Gu,Gu,fu];ju._matMult(Do),Os._matMult(Do),Sa._matMult(Do),Go._matMult(Do)}var Xs=za.stretch+za.fixed,Lu=Si.stretch+Si.fixed;return{tl:ju,tr:Os,bl:Sa,br:Go,tex:{x:C.paddedRect.x+1+Xs,y:C.paddedRect.y+1+Lu,w:ao.stretch+ao.fixed-Xs,h:ra.stretch+ra.fixed-Lu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:so,pixelOffsetBR:bo,minFontScaleX:hn/T/X,minFontScaleY:Ai/T/$,isSDF:l}};if(d&&(C.stretchX||C.stretchY))for(var Jn=Es(ee,mt,$e),va=Es(le,ut,et),Wi=0;Wi<Jn.length-1;Wi++)for(var di=Jn[Wi],Ra=Jn[Wi+1],fa=0;fa<va.length-1;fa++)x.push(Mi(di,va[fa],Ra,va[fa+1]));else x.push(Mi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:U+1}));return x}function tu(n,s,l){for(var d=0,x=0,C=n;x<C.length;x+=1){var T=C[x];d+=Math.max(s,Math.min(l,T[1]))-Math.max(s,Math.min(l,T[0]))}return d}function Es(n,s,l){for(var d=[{fixed:-1,stretch:0}],x=0,C=n;x<C.length;x+=1){var T=C[x],L=T[0],U=T[1],X=d[d.length-1];d.push({fixed:L-X.stretch,stretch:X.stretch}),d.push({fixed:L-X.stretch,stretch:X.stretch+(U-L)})}return d.push({fixed:s+1,stretch:l}),d}function Qo(n,s,l,d){return n/s*l+d}function ia(n,s,l,d){return n-s*l/d}var Cs=function(n,s,l,d,x,C,T,L,U,X){if(this.boxStartIndex=n.length,U){var $=C.top,ee=C.bottom,le=C.collisionPadding;le&&($-=le[1],ee+=le[3]);var Ee=ee-$;Ee>0&&(Ee=Math.max(10,Ee),this.circleDiameter=Ee)}else{var $e=C.top*T-L,et=C.bottom*T+L,mt=C.left*T-L,ut=C.right*T+L,Ot=C.collisionPadding;if(Ot&&(mt-=Ot[0]*T,$e-=Ot[1]*T,ut+=Ot[2]*T,et+=Ot[3]*T),X){var $t=new pe(mt,$e),dr=new pe(ut,$e),gr=new pe(mt,et),Dr=new pe(ut,et),hn=X*Math.PI/180;$t._rotate(hn),dr._rotate(hn),gr._rotate(hn),Dr._rotate(hn),mt=Math.min($t.x,dr.x,gr.x,Dr.x),ut=Math.max($t.x,dr.x,gr.x,Dr.x),$e=Math.min($t.y,dr.y,gr.y,Dr.y),et=Math.max($t.y,dr.y,gr.y,Dr.y)}n.emplaceBack(s.x,s.y,mt,$e,ut,et,l,d,x)}this.boxEndIndex=n.length},Na=function(n,s){if(n===void 0&&(n=[]),s===void 0&&(s=Rs),this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function Rs(n,s){return n<s?-1:n>s?1:0}function Zi(n,s,l){s===void 0&&(s=1),l===void 0&&(l=!1);for(var d=1/0,x=1/0,C=-1/0,T=-1/0,L=n[0],U=0;U<L.length;U++){var X=L[U];(!U||X.x<d)&&(d=X.x),(!U||X.y<x)&&(x=X.y),(!U||X.x>C)&&(C=X.x),(!U||X.y>T)&&(T=X.y)}var $=Math.min(C-d,T-x),ee=$/2,le=new Na([],Ca);if($===0)return new pe(d,x);for(var Ee=d;Ee<C;Ee+=$)for(var $e=x;$e<T;$e+=$)le.push(new eo(Ee+ee,$e+ee,ee,n));for(var et=function(Ot){for(var $t=0,dr=0,gr=0,Dr=Ot[0],hn=0,zn=Dr.length,Ai=zn-1;hn<zn;Ai=hn++){var Qn=Dr[hn],Mi=Dr[Ai],Jn=Qn.x*Mi.y-Mi.x*Qn.y;dr+=(Qn.x+Mi.x)*Jn,gr+=(Qn.y+Mi.y)*Jn,$t+=3*Jn}return new eo(dr/$t,gr/$t,0,Ot)}(n),mt=le.length;le.length;){var ut=le.pop();(ut.d>et.d||!et.d)&&(et=ut,l&&console.log("found best %d after %d probes",Math.round(1e4*ut.d)/1e4,mt)),ut.max-et.d<=s||(le.push(new eo(ut.p.x-(ee=ut.h/2),ut.p.y-ee,ee,n)),le.push(new eo(ut.p.x+ee,ut.p.y-ee,ee,n)),le.push(new eo(ut.p.x-ee,ut.p.y+ee,ee,n)),le.push(new eo(ut.p.x+ee,ut.p.y+ee,ee,n)),mt+=4)}return l&&(console.log("num probes: "+mt),console.log("best distance: "+et.d)),et.p}function Ca(n,s){return s.max-n.max}function eo(n,s,l,d){this.p=new pe(n,s),this.h=l,this.d=function(x,C){for(var T=!1,L=1/0,U=0;U<C.length;U++)for(var X=C[U],$=0,ee=X.length,le=ee-1;$<ee;le=$++){var Ee=X[$],$e=X[le];Ee.y>x.y!=$e.y>x.y&&x.x<($e.x-Ee.x)*(x.y-Ee.y)/($e.y-Ee.y)+Ee.x&&(T=!T),L=Math.min(L,tl(x,Ee,$e))}return(T?1:-1)*Math.sqrt(L)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}Na.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},Na.prototype.pop=function(){if(this.length!==0){var n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}},Na.prototype.peek=function(){return this.data[0]},Na.prototype._up=function(n){for(var s=this.data,l=this.compare,d=s[n];n>0;){var x=n-1>>1,C=s[x];if(l(d,C)>=0)break;s[n]=C,n=x}s[n]=d},Na.prototype._down=function(n){for(var s=this.data,l=this.compare,d=this.length>>1,x=s[n];n<d;){var C=1+(n<<1),T=s[C],L=C+1;if(L<this.length&&l(s[L],T)<0&&(C=L,T=s[L]),l(T,x)>=0)break;s[n]=T,n=C}s[n]=x};var us=Number.POSITIVE_INFINITY;function Fc(n,s){return s[1]!==us?function(l,d,x){var C=0,T=0;switch(d=Math.abs(d),x=Math.abs(x),l){case"top-right":case"top-left":case"top":T=x-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-x}switch(l){case"top-right":case"bottom-right":case"right":C=-d;break;case"top-left":case"bottom-left":case"left":C=d}return[C,T]}(n,s[0],s[1]):function(l,d){var x=0,C=0;d<0&&(d=0);var T=d/Math.sqrt(2);switch(l){case"top-right":case"top-left":C=T-7;break;case"bottom-right":case"bottom-left":C=7-T;break;case"bottom":C=7-d;break;case"top":C=d-7}switch(l){case"top-right":case"bottom-right":x=-T;break;case"top-left":case"bottom-left":x=T;break;case"left":x=d;break;case"right":x=-d}return[x,C]}(n,s[0])}function Ye(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function pr(n,s,l,d,x,C,T,L,U,X,$,ee,le,Ee,$e){var et=function(dr,gr,Dr,hn,zn,Ai,Qn,Mi){for(var Jn=hn.layout.get("text-rotate").evaluate(Ai,{})*Math.PI/180,va=[],Wi=0,di=gr.positionedLines;Wi<di.length;Wi+=1)for(var Ra=di[Wi],fa=0,za=Ra.positionedGlyphs;fa<za.length;fa+=1){var Si=za[fa];if(Si.rect){var ao=Si.rect||{},ra=4,ko=!0,gs=1,jo=0,ys=(zn||Mi)&&Si.vertical,cu=Si.metrics.advance*Si.scale/2;if(Mi&&gr.verticalizable&&(jo=Ra.lineOffset/2-(Si.imageName?-(24-Si.metrics.width*Si.scale)/2:24*(Si.scale-1))),Si.imageName){var nu=Qn[Si.imageName];ko=nu.sdf,ra=1/(gs=nu.pixelRatio)}var il=zn?[Si.x+cu,Si.y]:[0,0],ts=zn?[0,0]:[Si.x+cu+Dr[0],Si.y+Dr[1]-jo],ju=[0,0];ys&&(ju=ts,ts=[0,0]);var Os=(Si.metrics.left-ra)*Si.scale-cu+ts[0],Go=(-Si.metrics.top-ra)*Si.scale+ts[1],Sa=Os+ao.w*Si.scale/gs,so=Go+ao.h*Si.scale/gs,bo=new pe(Os,Go),Ua=new pe(Sa,Go),Gu=new pe(Os,so),fu=new pe(Sa,so);if(ys){var Do=new pe(-cu,cu- -17),Xs=-Math.PI/2,Lu=12-cu,Xa=new pe(22-Lu,-(Si.imageName?Lu:0)),wl=new(Function.prototype.bind.apply(pe,[null].concat(ju)));bo._rotateAround(Xs,Do)._add(Xa)._add(wl),Ua._rotateAround(Xs,Do)._add(Xa)._add(wl),Gu._rotateAround(Xs,Do)._add(Xa)._add(wl),fu._rotateAround(Xs,Do)._add(Xa)._add(wl)}if(Jn){var uc=Math.sin(Jn),al=Math.cos(Jn),Ss=[al,-uc,uc,al];bo._matMult(Ss),Ua._matMult(Ss),Gu._matMult(Ss),fu._matMult(Ss)}var Nc=new pe(0,0),zc=new pe(0,0);va.push({tl:bo,tr:Ua,bl:Gu,br:fu,tex:ao,writingMode:gr.writingMode,glyphOffset:il,sectionIndex:Si.sectionIndex,isSDF:ko,pixelOffsetTL:Nc,pixelOffsetBR:zc,minFontScaleX:0,minFontScaleY:0})}}return va}(0,l,L,x,C,T,d,n.allowVerticalPlacement),mt=n.textSizeData,ut=null;mt.kind==="source"?(ut=[128*x.layout.get("text-size").evaluate(T,{})])[0]>32640&&Ue(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):mt.kind==="composite"&&((ut=[128*Ee.compositeTextSizes[0].evaluate(T,{},$e),128*Ee.compositeTextSizes[1].evaluate(T,{},$e)])[0]>32640||ut[1]>32640)&&Ue(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),n.addSymbols(n.text,et,ut,L,C,T,X,s,U.lineStartIndex,U.lineLength,le,$e);for(var Ot=0,$t=$;Ot<$t.length;Ot+=1)ee[$t[Ot]]=n.text.placedSymbolArray.length-1;return 4*et.length}function Vt(n){for(var s in n)return n[s];return null}function qn(n,s,l,d){var x=n.compareText;if(s in x){for(var C=x[s],T=C.length-1;T>=0;T--)if(d.dist(C[T])<l)return!0}else x[s]=[];return x[s].push(d),!1}var Ta=Ru.VectorTileFeature.types,Ve=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ce(n,s,l,d,x,C,T,L,U,X,$,ee,le){var Ee=L?Math.min(32640,Math.round(L[0])):0,$e=L?Math.min(32640,Math.round(L[1])):0;n.emplaceBack(s,l,Math.round(32*d),Math.round(32*x),C,T,(Ee<<1)+(U?1:0),$e,16*X,16*$,256*ee,256*le)}function ht(n,s,l){n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l),n.emplaceBack(s.x,s.y,l)}function Bt(n){for(var s=0,l=n.sections;s<l.length;s+=1)if(Va(l[s].text))return!0;return!1}var ar=function(n){this.layoutVertexArray=new gh,this.indexArray=new dl,this.programConfigurations=n,this.segments=new Se,this.dynamicLayoutVertexArray=new Yo,this.opacityVertexArray=new yh,this.placedSymbolArray=new m};ar.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},ar.prototype.upload=function(n,s,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Jd.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Pd.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,Ve,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(n))},ar.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},ti("SymbolBuffers",ar);var gt=function(n,s,l){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Se,this.collisionVertexArray=new Xh};gt.prototype.upload=function(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Qp.members,!0)},gt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},ti("CollisionBuffers",gt);var he=function(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(C){return C.id}),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Nu([]),this.placementViewportMatrix=Nu([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=on(this.zoom,s["text-size"]),this.iconSizeData=on(this.zoom,s["icon-size"]);var l=this.layers[0].layout,d=l.get("symbol-sort-key"),x=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(function(C){return kn[C]})),this.stateDependentLayerIds=this.layers.filter(function(C){return C.isStateDependent()}).map(function(C){return C.id}),this.sourceID=n.sourceID};he.prototype.createArrays=function(){this.text=new ar(new ki(this.layers,this.zoom,function(n){return/^text/.test(n)})),this.icon=new ar(new ki(this.layers,this.zoom,function(n){return/^icon/.test(n)})),this.glyphOffsetArray=new R,this.lineVertexArray=new z,this.symbolInstances=new I},he.prototype.calculateGlyphDependencies=function(n,s,l,d,x){for(var C=0;C<n.length;C++)if(s[n.charCodeAt(C)]=!0,(l||d)&&x){var T=ed[n.charAt(C)];T&&(s[T.charCodeAt(0)]=!0)}},he.prototype.populate=function(n,s,l){var d=this.layers[0],x=d.layout,C=x.get("text-font"),T=x.get("text-field"),L=x.get("icon-image"),U=(T.value.kind!=="constant"||T.value.value instanceof Wr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),X=L.value.kind!=="constant"||!!L.value.value||Object.keys(L.parameters).length>0,$=x.get("symbol-sort-key");if(this.features=[],U||X){for(var ee=s.iconDependencies,le=s.glyphDependencies,Ee=s.availableImages,$e=new ha(this.zoom),et=0,mt=n;et<mt.length;et+=1){var ut=mt[et],Ot=ut.feature,$t=ut.id,dr=ut.index,gr=ut.sourceLayerIndex,Dr=d._featureFilter.needGeometry,hn=os(Ot,Dr);if(d._featureFilter.filter($e,hn,l)){Dr||(hn.geometry=_o(Ot));var zn=void 0;if(U){var Ai=d.getValueAndResolveTokens("text-field",hn,l,Ee),Qn=Wr.factory(Ai);Bt(Qn)&&(this.hasRTLText=!0),(!this.hasRTLText||yi()==="unavailable"||this.hasRTLText&&Ks.isParsed())&&(zn=t0(Qn,d,hn))}var Mi=void 0;if(X){var Jn=d.getValueAndResolveTokens("icon-image",hn,l,Ee);Mi=Jn instanceof bt?Jn:bt.fromString(Jn)}if(zn||Mi){var va=this.sortFeaturesByKey?$.evaluate(hn,{},l):void 0;if(this.features.push({id:$t,text:zn,icon:Mi,index:dr,sourceLayerIndex:gr,geometry:hn.geometry,properties:Ot.properties,type:Ta[Ot.type],sortKey:va}),Mi&&(ee[Mi.name]=!0),zn){var Wi=C.evaluate(hn,{},l).join(","),di=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(kn.vertical)>=0;for(var Ra=0,fa=zn.sections;Ra<fa.length;Ra+=1){var za=fa[Ra];if(za.image)ee[za.image.name]=!0;else{var Si=wf(zn.toString()),ao=za.fontStack||Wi,ra=le[ao]=le[ao]||{};this.calculateGlyphDependencies(za.text,ra,di,this.allowVerticalPlacement,Si)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(ko){var gs={},jo={},ys=[],cu=0;function nu(Do){ys.push(ko[Do]),cu++}function il(Do,Xs,Lu){var Xa=jo[Do];return delete jo[Do],jo[Xs]=Xa,ys[Xa].geometry[0].pop(),ys[Xa].geometry[0]=ys[Xa].geometry[0].concat(Lu[0]),Xa}function ts(Do,Xs,Lu){var Xa=gs[Xs];return delete gs[Xs],gs[Do]=Xa,ys[Xa].geometry[0].shift(),ys[Xa].geometry[0]=Lu[0].concat(ys[Xa].geometry[0]),Xa}function ju(Do,Xs,Lu){var Xa=Lu?Xs[0][Xs[0].length-1]:Xs[0][0];return Do+":"+Xa.x+":"+Xa.y}for(var Os=0;Os<ko.length;Os++){var Go=ko[Os],Sa=Go.geometry,so=Go.text?Go.text.toString():null;if(so){var bo=ju(so,Sa),Ua=ju(so,Sa,!0);if(bo in jo&&Ua in gs&&jo[bo]!==gs[Ua]){var Gu=ts(bo,Ua,Sa),fu=il(bo,Ua,ys[Gu].geometry);delete gs[bo],delete jo[Ua],jo[ju(so,ys[fu].geometry,!0)]=fu,ys[Gu].geometry=null}else bo in jo?il(bo,Ua,Sa):Ua in gs?ts(bo,Ua,Sa):(nu(Os),gs[bo]=cu-1,jo[Ua]=cu-1)}else nu(Os)}return ys.filter(function(Do){return Do.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(ko,gs){return ko.sortKey-gs.sortKey})}},he.prototype.update=function(n,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,l))},he.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},he.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},he.prototype.upload=function(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},he.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},he.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},he.prototype.addToLineVertexArray=function(n,s){var l=this.lineVertexArray.length;if(n.segment!==void 0){for(var d=n.dist(s[n.segment+1]),x=n.dist(s[n.segment]),C={},T=n.segment+1;T<s.length;T++)C[T]={x:s[T].x,y:s[T].y,tileUnitDistanceFromAnchor:d},T<s.length-1&&(d+=s[T+1].dist(s[T]));for(var L=n.segment||0;L>=0;L--)C[L]={x:s[L].x,y:s[L].y,tileUnitDistanceFromAnchor:x},L>0&&(x+=s[L-1].dist(s[L]));for(var U=0;U<s.length;U++){var X=C[U];this.lineVertexArray.emplaceBack(X.x,X.y,X.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}},he.prototype.addSymbols=function(n,s,l,d,x,C,T,L,U,X,$,ee){for(var le=n.indexArray,Ee=n.layoutVertexArray,$e=n.segments.prepareSegment(4*s.length,Ee,le,this.canOverlap?C.sortKey:void 0),et=this.glyphOffsetArray.length,mt=$e.vertexLength,ut=this.allowVerticalPlacement&&T===kn.vertical?Math.PI/2:0,Ot=C.text&&C.text.sections,$t=0;$t<s.length;$t++){var dr=s[$t],gr=dr.tl,Dr=dr.tr,hn=dr.bl,zn=dr.br,Ai=dr.tex,Qn=dr.pixelOffsetTL,Mi=dr.pixelOffsetBR,Jn=dr.minFontScaleX,va=dr.minFontScaleY,Wi=dr.glyphOffset,di=dr.isSDF,Ra=dr.sectionIndex,fa=$e.vertexLength,za=Wi[1];Ce(Ee,L.x,L.y,gr.x,za+gr.y,Ai.x,Ai.y,l,di,Qn.x,Qn.y,Jn,va),Ce(Ee,L.x,L.y,Dr.x,za+Dr.y,Ai.x+Ai.w,Ai.y,l,di,Mi.x,Qn.y,Jn,va),Ce(Ee,L.x,L.y,hn.x,za+hn.y,Ai.x,Ai.y+Ai.h,l,di,Qn.x,Mi.y,Jn,va),Ce(Ee,L.x,L.y,zn.x,za+zn.y,Ai.x+Ai.w,Ai.y+Ai.h,l,di,Mi.x,Mi.y,Jn,va),ht(n.dynamicLayoutVertexArray,L,ut),le.emplaceBack(fa,fa+1,fa+2),le.emplaceBack(fa+1,fa+2,fa+3),$e.vertexLength+=4,$e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Wi[0]),$t!==s.length-1&&Ra===s[$t+1].sectionIndex||n.programConfigurations.populatePaintArrays(Ee.length,C,C.index,{},ee,Ot&&Ot[Ra])}n.placedSymbolArray.emplaceBack(L.x,L.y,et,this.glyphOffsetArray.length-et,mt,U,X,L.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],T,0,!1,0,$)},he.prototype._addCollisionDebugVertex=function(n,s,l,d,x,C){return s.emplaceBack(0,0),n.emplaceBack(l.x,l.y,d,x,Math.round(C.x),Math.round(C.y))},he.prototype.addCollisionDebugVertices=function(n,s,l,d,x,C,T){var L=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),U=L.vertexLength,X=x.layoutVertexArray,$=x.collisionVertexArray,ee=T.anchorX,le=T.anchorY;this._addCollisionDebugVertex(X,$,C,ee,le,new pe(n,s)),this._addCollisionDebugVertex(X,$,C,ee,le,new pe(l,s)),this._addCollisionDebugVertex(X,$,C,ee,le,new pe(l,d)),this._addCollisionDebugVertex(X,$,C,ee,le,new pe(n,d)),L.vertexLength+=4;var Ee=x.indexArray;Ee.emplaceBack(U,U+1),Ee.emplaceBack(U+1,U+2),Ee.emplaceBack(U+2,U+3),Ee.emplaceBack(U+3,U),L.primitiveLength+=4},he.prototype.addDebugCollisionBoxes=function(n,s,l,d){for(var x=n;x<s;x++){var C=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,d?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,l)}},he.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gt(If,Jp.members,Pf),this.iconCollisionBox=new gt(If,Jp.members,Pf);for(var n=0;n<this.symbolInstances.length;n++){var s=this.symbolInstances.get(n);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},he.prototype._deserializeCollisionBoxesForSymbol=function(n,s,l,d,x,C,T,L,U){for(var X={},$=s;$<l;$++){var ee=n.get($);X.textBox={x1:ee.x1,y1:ee.y1,x2:ee.x2,y2:ee.y2,anchorPointX:ee.anchorPointX,anchorPointY:ee.anchorPointY},X.textFeatureIndex=ee.featureIndex;break}for(var le=d;le<x;le++){var Ee=n.get(le);X.verticalTextBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},X.verticalTextFeatureIndex=Ee.featureIndex;break}for(var $e=C;$e<T;$e++){var et=n.get($e);X.iconBox={x1:et.x1,y1:et.y1,x2:et.x2,y2:et.y2,anchorPointX:et.anchorPointX,anchorPointY:et.anchorPointY},X.iconFeatureIndex=et.featureIndex;break}for(var mt=L;mt<U;mt++){var ut=n.get(mt);X.verticalIconBox={x1:ut.x1,y1:ut.y1,x2:ut.x2,y2:ut.y2,anchorPointX:ut.anchorPointX,anchorPointY:ut.anchorPointY},X.verticalIconFeatureIndex=ut.featureIndex;break}return X},he.prototype.deserializeCollisionBoxes=function(n){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}},he.prototype.hasTextData=function(){return this.text.segments.get().length>0},he.prototype.hasIconData=function(){return this.icon.segments.get().length>0},he.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},he.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},he.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},he.prototype.addIndicesForPlacedSymbol=function(n,s){for(var l=n.placedSymbolArray.get(s),d=l.vertexStartIndex+4*l.numGlyphs,x=l.vertexStartIndex;x<d;x+=4)n.indexArray.emplaceBack(x,x+1,x+2),n.indexArray.emplaceBack(x+1,x+2,x+3)},he.prototype.getSortedSymbolIndexes=function(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(n),l=Math.cos(n),d=[],x=[],C=[],T=0;T<this.symbolInstances.length;++T){C.push(T);var L=this.symbolInstances.get(T);d.push(0|Math.round(s*L.anchorX+l*L.anchorY)),x.push(L.featureIndex)}return C.sort(function(U,X){return d[U]-d[X]||x[X]-x[U]}),C},he.prototype.addToSortKeyRanges=function(n,s){var l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})},he.prototype.sortFeatures=function(n){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var l=0,d=this.symbolInstanceIndexes;l<d.length;l+=1){var x=this.symbolInstances.get(d[l]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(C,T,L){C>=0&&L.indexOf(C)===T&&s.addIndicesForPlacedSymbol(s.text,C)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},ti("SymbolBucket",he,{omit:["layers","collisionBoxArray","features","compareText"]}),he.MAX_GLYPHS=65535,he.addDynamicAttributes=ht;var Tt=new es({"symbol-placement":new bi(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new bi(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bi(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pi(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bi(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new bi(Me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bi(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new bi(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bi(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new pi(Me.layout_symbol["icon-size"]),"icon-text-fit":new bi(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new bi(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new pi(Me.layout_symbol["icon-image"]),"icon-rotate":new pi(Me.layout_symbol["icon-rotate"]),"icon-padding":new bi(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new bi(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new pi(Me.layout_symbol["icon-offset"]),"icon-anchor":new pi(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bi(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bi(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bi(Me.layout_symbol["text-rotation-alignment"]),"text-field":new pi(Me.layout_symbol["text-field"]),"text-font":new pi(Me.layout_symbol["text-font"]),"text-size":new pi(Me.layout_symbol["text-size"]),"text-max-width":new pi(Me.layout_symbol["text-max-width"]),"text-line-height":new bi(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new pi(Me.layout_symbol["text-letter-spacing"]),"text-justify":new pi(Me.layout_symbol["text-justify"]),"text-radial-offset":new pi(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bi(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new pi(Me.layout_symbol["text-anchor"]),"text-max-angle":new bi(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new bi(Me.layout_symbol["text-writing-mode"]),"text-rotate":new pi(Me.layout_symbol["text-rotate"]),"text-padding":new bi(Me.layout_symbol["text-padding"]),"text-keep-upright":new bi(Me.layout_symbol["text-keep-upright"]),"text-transform":new pi(Me.layout_symbol["text-transform"]),"text-offset":new pi(Me.layout_symbol["text-offset"]),"text-allow-overlap":new bi(Me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bi(Me.layout_symbol["text-ignore-placement"]),"text-optional":new bi(Me.layout_symbol["text-optional"])}),Fe={paint:new es({"icon-opacity":new pi(Me.paint_symbol["icon-opacity"]),"icon-color":new pi(Me.paint_symbol["icon-color"]),"icon-halo-color":new pi(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new pi(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pi(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new bi(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new bi(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new pi(Me.paint_symbol["text-opacity"]),"text-color":new pi(Me.paint_symbol["text-color"],{runtimeType:Tn,getOverride:function(n){return n.textColor},hasOverride:function(n){return!!n.textColor}}),"text-halo-color":new pi(Me.paint_symbol["text-halo-color"]),"text-halo-width":new pi(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new pi(Me.paint_symbol["text-halo-blur"]),"text-translate":new bi(Me.paint_symbol["text-translate"]),"text-translate-anchor":new bi(Me.paint_symbol["text-translate-anchor"])}),layout:Tt},ct=function(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Sn,this.defaultValue=n};ct.prototype.evaluate=function(n){if(n.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default},ct.prototype.eachChild=function(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)},ct.prototype.outputDefined=function(){return!1},ct.prototype.serialize=function(){return null},ti("FormatSectionOverride",ct,{omit:["defaultValue"]});var Ge=function(n){function s(l){n.call(this,l,Fe)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.recalculate=function(l,d){if(n.prototype.recalculate.call(this,l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var C=[],T=0,L=x;T<L.length;T+=1){var U=L[T];C.indexOf(U)<0&&C.push(U)}this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(l,d,x,C){var T=this.layout.get(l).evaluate(d,{},x,C),L=this._unevaluatedLayout._values[l];return L.isDataDriven()||Gf(L.value)||!T?T:function(U,X){return X.replace(/{([^{}]+)}/g,function($,ee){return ee in U?String(U[ee]):""})}(d.properties,T)},s.prototype.createBucket=function(l){return new he(l)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var l=0,d=Fe.paint.overridableProperties;l<d.length;l+=1){var x=d[l];if(s.hasPaintOverride(this.layout,x)){var C,T=this.paint.get(x),L=new ct(T),U=new _f(L,T.property.specification);C=T.value.kind==="constant"||T.value.kind==="source"?new Hf("source",U):new mc("composite",U,T.value.zoomStops,T.value._interpolationType),this.paint._values[x]=new mu(T.property,C,T.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(l,d,x){return!(!this.layout||d.isDataDriven()||x.isDataDriven())&&s.hasPaintOverride(this.layout,l)},s.hasPaintOverride=function(l,d){var x=l.get("text-field"),C=Fe.paint.properties[d],T=!1,L=function($){for(var ee=0,le=$;ee<le.length;ee+=1)if(C.overrides&&C.overrides.hasOverride(le[ee]))return void(T=!0)};if(x.value.kind==="constant"&&x.value.value instanceof Wr)L(x.value.value.sections);else if(x.value.kind==="source"){var U=function($){T||($ instanceof Oa&&Xi($.value)===La?L($.value.sections):$ instanceof Bs?L($.sections):$.eachChild(U))},X=x.value;X._styleExpression&&U(X._styleExpression.expression)}return T},s}(El),Nt={paint:new es({"background-color":new bi(Me.paint_background["background-color"]),"background-pattern":new Vs(Me.paint_background["background-pattern"]),"background-opacity":new bi(Me.paint_background["background-opacity"])})},qt=function(n){function s(l){n.call(this,l,Nt)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(El),Ur={paint:new es({"raster-opacity":new bi(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new bi(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bi(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bi(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new bi(Me.paint_raster["raster-saturation"]),"raster-contrast":new bi(Me.paint_raster["raster-contrast"]),"raster-resampling":new bi(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new bi(Me.paint_raster["raster-fade-duration"])})},Pn=function(n){function s(l){n.call(this,l,Ur)}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s}(El),In=function(n){function s(l){n.call(this,l,{}),this.implementation=l}return n&&(s.__proto__=n),(s.prototype=Object.create(n&&n.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},s.prototype.onRemove=function(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},s}(El),Vn={circle:bh,heatmap:yp,hillshade:nf,fill:Yp,"fill-extrusion":cf,line:kd,symbol:Ge,background:qt,raster:Pn},En=we.HTMLImageElement,fi=we.HTMLCanvasElement,jn=we.HTMLVideoElement,$n=we.ImageData,ii=we.ImageBitmap,Kn=function(n,s,l,d){this.context=n,this.format=l,this.texture=n.gl.createTexture(),this.update(s,d)};Kn.prototype.update=function(n,s,l){var d=n.width,x=n.height,C=!(this.size&&this.size[0]===d&&this.size[1]===x||l),T=this.context,L=T.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!s||s.premultiply!==!1)),C)this.size=[d,x],n instanceof En||n instanceof fi||n instanceof jn||n instanceof $n||ii&&n instanceof ii?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,n):L.texImage2D(L.TEXTURE_2D,0,this.format,d,x,0,this.format,L.UNSIGNED_BYTE,n.data);else{var U=l||{x:0,y:0},X=U.x,$=U.y;n instanceof En||n instanceof fi||n instanceof jn||n instanceof $n||ii&&n instanceof ii?L.texSubImage2D(L.TEXTURE_2D,0,X,$,L.RGBA,L.UNSIGNED_BYTE,n):L.texSubImage2D(L.TEXTURE_2D,0,X,$,d,x,L.RGBA,L.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)},Kn.prototype.bind=function(n,s,l){var d=this.context.gl;d.bindTexture(d.TEXTURE_2D,this.texture),l!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=d.LINEAR),n!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,l||n),this.filter=n),s!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrap=s)},Kn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Kn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Vi=function(n){var s=this;this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Vi.prototype.trigger=function(){var n=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){n._triggered=!1,n._callback()},0))},Vi.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ya=function(n,s,l){this.target=n,this.parent=s,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Pr(["receive","process"],this),this.invoker=new Vi(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ue()?n:we};function Ls(n,s,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[n*d-2*Math.PI*6378137/2,s*d-2*Math.PI*6378137/2]}Ya.prototype.send=function(n,s,l,d,x){var C=this;x===void 0&&(x=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[T]=l);var L=_e(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:n,hasCallback:!!l,targetMapId:d,mustQueue:x,sourceMapId:this.mapId,data:Ja(s,L)},L),{cancel:function(){l&&delete C.callbacks[T],C.target.postMessage({id:T,type:"<cancel>",targetMapId:d,sourceMapId:C.mapId})}}},Ya.prototype.receive=function(n){var s=n.data,l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[l];var d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d()}else ue()||s.mustQueue?(this.tasks[l]=s,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,s)},Ya.prototype.process=function(){if(this.taskQueue.length){var n=this.taskQueue.shift(),s=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(n,s)}},Ya.prototype.processTask=function(n,s){var l=this;if(s.type==="<response>"){var d=this.callbacks[n];delete this.callbacks[n],d&&(s.error?d(Bu(s.error)):d(null,Bu(s.data)))}else{var x=!1,C=_e(this.globalScope)?void 0:[],T=s.hasCallback?function($,ee){x=!0,delete l.cancelCallbacks[n],l.target.postMessage({id:n,type:"<response>",sourceMapId:l.mapId,error:$?Ja($):null,data:Ja(ee,C)},C)}:function($){x=!0},L=null,U=Bu(s.data);if(this.parent[s.type])L=this.parent[s.type](s.sourceMapId,U,T);else if(this.parent.getWorkerSource){var X=s.type.split(".");L=this.parent.getWorkerSource(s.sourceMapId,X[0],U.source)[X[1]](U,T)}else T(new Error("Could not find function "+s.type));!x&&L&&L.cancel&&(this.cancelCallbacks[n]=L.cancel)}},Ya.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Lo=function(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))};Lo.prototype.setNorthEast=function(n){return this._ne=n instanceof to?new to(n.lng,n.lat):to.convert(n),this},Lo.prototype.setSouthWest=function(n){return this._sw=n instanceof to?new to(n.lng,n.lat):to.convert(n),this},Lo.prototype.extend=function(n){var s,l,d=this._sw,x=this._ne;if(n instanceof to)s=n,l=n;else{if(!(n instanceof Lo))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Lo.convert(n)):this.extend(to.convert(n)):this;if(l=n._ne,!(s=n._sw)||!l)return this}return d||x?(d.lng=Math.min(s.lng,d.lng),d.lat=Math.min(s.lat,d.lat),x.lng=Math.max(l.lng,x.lng),x.lat=Math.max(l.lat,x.lat)):(this._sw=new to(s.lng,s.lat),this._ne=new to(l.lng,l.lat)),this},Lo.prototype.getCenter=function(){return new to((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Lo.prototype.getSouthWest=function(){return this._sw},Lo.prototype.getNorthEast=function(){return this._ne},Lo.prototype.getNorthWest=function(){return new to(this.getWest(),this.getNorth())},Lo.prototype.getSouthEast=function(){return new to(this.getEast(),this.getSouth())},Lo.prototype.getWest=function(){return this._sw.lng},Lo.prototype.getSouth=function(){return this._sw.lat},Lo.prototype.getEast=function(){return this._ne.lng},Lo.prototype.getNorth=function(){return this._ne.lat},Lo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Lo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Lo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Lo.prototype.contains=function(n){var s=to.convert(n),l=s.lng,d=s.lat,x=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&x},Lo.convert=function(n){return!n||n instanceof Lo?n:new Lo(n)};var to=function(n,s){if(isNaN(n)||isNaN(s))throw new Error("Invalid LngLat object: ("+n+", "+s+")");if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};to.prototype.wrap=function(){return new to(Yt(this.lng,-180,180),this.lat)},to.prototype.toArray=function(){return[this.lng,this.lat]},to.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},to.prototype.distanceTo=function(n){var s=Math.PI/180,l=this.lat*s,d=n.lat*s,x=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((n.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(x,1))},to.prototype.toBounds=function(n){n===void 0&&(n=0);var s=360*n/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Lo(new to(this.lng-l,this.lat-s),new to(this.lng+l,this.lat+s))},to.convert=function(n){if(n instanceof to)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new to(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new to(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ff=2*Math.PI*63710088e-1;function Vu(n){return ff*Math.cos(n*Math.PI/180)}function sc(n){return(180+n)/360}function Hl(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Dc(n,s){return n/Vu(s)}function Wl(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}var ah=function(n,s,l){l===void 0&&(l=0),this.x=+n,this.y=+s,this.z=+l};ah.fromLngLat=function(n,s){s===void 0&&(s=0);var l=to.convert(n);return new ah(sc(l.lng),Hl(l.lat),Dc(s,l.lat))},ah.prototype.toLngLat=function(){return new to(360*this.x-180,Wl(this.y))},ah.prototype.toAltitude=function(){return this.z*Vu(Wl(this.y))},ah.prototype.meterInMercatorCoordinateUnits=function(){return 1/ff*(n=Wl(this.y),1/Math.cos(n*Math.PI/180));var n};var rp=function(n,s,l){this.z=n,this.x=s,this.y=l,this.key=lu(0,n,n,s,l)};rp.prototype.equals=function(n){return this.z===n.z&&this.x===n.x&&this.y===n.y},rp.prototype.url=function(n,s){var l,d,x,C,T,L=(d=this.y,x=this.z,C=Ls(256*(l=this.x),256*(d=Math.pow(2,x)-d-1),x),T=Ls(256*(l+1),256*(d+1),x),C[0]+","+C[1]+","+T[0]+","+T[1]),U=function(X,$,ee){for(var le,Ee="",$e=X;$e>0;$e--)Ee+=($&(le=1<<$e-1)?1:0)+(ee&le?2:0);return Ee}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",U).replace("{bbox-epsg-3857}",L)},rp.prototype.getTilePoint=function(n){var s=Math.pow(2,this.z);return new pe(8192*(n.x*s-this.x),8192*(n.y*s-this.y))},rp.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var n0=function(n,s){this.wrap=n,this.canonical=s,this.key=lu(n,s.z,s.z,s.x,s.y)},ru=function(n,s,l,d,x){this.overscaledZ=n,this.wrap=s,this.canonical=new rp(l,+d,+x),this.key=lu(s,n,l,d,x)};function lu(n,s,l,d,x){(n*=2)<0&&(n=-1*n-1);var C=1<<l;return(C*C*n+C*x+d).toString(36)+l.toString(36)+s.toString(36)}ru.prototype.equals=function(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)},ru.prototype.scaledTo=function(n){var s=this.canonical.z-n;return n>this.canonical.z?new ru(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ru(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)},ru.prototype.calculateScaledKey=function(n,s){var l=this.canonical.z-n;return n>this.canonical.z?lu(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y):lu(this.wrap*+s,n,n,this.canonical.x>>l,this.canonical.y>>l)},ru.prototype.isChildOf=function(n){if(n.wrap!==this.wrap)return!1;var s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s},ru.prototype.children=function(n){if(this.overscaledZ>=n)return[new ru(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new ru(s,this.wrap,s,l,d),new ru(s,this.wrap,s,l+1,d),new ru(s,this.wrap,s,l,d+1),new ru(s,this.wrap,s,l+1,d+1)]},ru.prototype.isLessThan=function(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))},ru.prototype.wrapped=function(){return new ru(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ru.prototype.unwrapTo=function(n){return new ru(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)},ru.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ru.prototype.toUnwrapped=function(){return new n0(this.wrap,this.canonical)},ru.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ru.prototype.getTilePoint=function(n){return this.canonical.getTilePoint(new ah(n.x-this.wrap,n.y))},ti("CanonicalTileID",rp),ti("OverscaledTileID",ru,{omit:["posMatrix"]});var oh=function(n,s,l){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Ue('"'+l+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var d=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox";for(var x=0;x<d;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(d,x)]=this.data[this._idx(d-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,d)]=this.data[this._idx(x,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]};oh.prototype.get=function(n,s){var l=new Uint8Array(this.data.buffer),d=4*this._idx(n,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[d],l[d+1],l[d+2])},oh.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},oh.prototype._idx=function(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)},oh.prototype._unpackMapbox=function(n,s,l){return(256*n*256+256*s+l)/10-1e4},oh.prototype._unpackTerrarium=function(n,s,l){return 256*n+s+l/256-32768},oh.prototype.getPixels=function(){return new Js({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},oh.prototype.backfillBorder=function(n,s,l){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");var d=s*this.dim,x=s*this.dim+this.dim,C=l*this.dim,T=l*this.dim+this.dim;switch(s){case-1:d=x-1;break;case 1:x=d+1}switch(l){case-1:C=T-1;break;case 1:T=C+1}for(var L=-s*this.dim,U=-l*this.dim,X=C;X<T;X++)for(var $=d;$<x;$++)this.data[this._idx($,X)]=n.data[this._idx($+L,X+U)]},ti("DEMData",oh);var rd=function(n){this._stringToNumber={},this._numberToString=[];for(var s=0;s<n.length;s++){var l=n[s];this._stringToNumber[l]=s,this._numberToString[s]=l}};rd.prototype.encode=function(n){return this._stringToNumber[n]},rd.prototype.decode=function(n){return this._numberToString[n]};var nd=function(n,s,l,d,x){this.type="Feature",this._vectorTileFeature=n,n._z=s,n._x=l,n._y=d,this.properties=n.properties,this.id=x},T0={geometry:{configurable:!0}};T0.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},T0.geometry.set=function(n){this._geometry=n},nd.prototype.toJSON=function(){var n={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(n[s]=this[s]);return n},Object.defineProperties(nd.prototype,T0);var id=function(){this.state={},this.stateChanges={},this.deletedStates={}};id.prototype.updateState=function(n,s,l){var d=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][d]=this.stateChanges[n][d]||{},Wt(this.stateChanges[n][d],l),this.deletedStates[n]===null)for(var x in this.deletedStates[n]={},this.state[n])x!==d&&(this.deletedStates[n][x]=null);else if(this.deletedStates[n]&&this.deletedStates[n][d]===null)for(var C in this.deletedStates[n][d]={},this.state[n][d])l[C]||(this.deletedStates[n][d][C]=null);else for(var T in l)this.deletedStates[n]&&this.deletedStates[n][d]&&this.deletedStates[n][d][T]===null&&delete this.deletedStates[n][d][T]},id.prototype.removeFeatureState=function(n,s,l){if(this.deletedStates[n]!==null){var d=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},l&&s!==void 0)this.deletedStates[n][d]!==null&&(this.deletedStates[n][d]=this.deletedStates[n][d]||{},this.deletedStates[n][d][l]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][d])for(l in this.deletedStates[n][d]={},this.stateChanges[n][d])this.deletedStates[n][d][l]=null;else this.deletedStates[n][d]=null;else this.deletedStates[n]=null}},id.prototype.getState=function(n,s){var l=String(s),d=Wt({},(this.state[n]||{})[l],(this.stateChanges[n]||{})[l]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){var x=this.deletedStates[n][s];if(x===null)return{};for(var C in x)delete d[C]}return d},id.prototype.initializeTileState=function(n,s){n.setFeatureState(this.state,s)},id.prototype.coalesceChanges=function(n,s){var l={};for(var d in this.stateChanges){this.state[d]=this.state[d]||{};var x={};for(var C in this.stateChanges[d])this.state[d][C]||(this.state[d][C]={}),Wt(this.state[d][C],this.stateChanges[d][C]),x[C]=this.state[d][C];l[d]=x}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var L={};if(this.deletedStates[T]===null)for(var U in this.state[T])L[U]={},this.state[T][U]={};else for(var X in this.deletedStates[T]){if(this.deletedStates[T][X]===null)this.state[T][X]={};else for(var $=0,ee=Object.keys(this.deletedStates[T][X]);$<ee.length;$+=1)delete this.state[T][X][ee[$]];L[X]=this.state[T][X]}l[T]=l[T]||{},Wt(l[T],L)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(var le in n)n[le].setFeatureState(l,s)};var Bc=function(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Jl(8192,16,0),this.grid3D=new Jl(8192,16,0),this.featureIndexArray=new te,this.promoteId=s};function Hv(n,s,l,d,x){return yr(n,function(C,T){var L=s instanceof Qu?s.get(T):null;return L&&L.evaluate?L.evaluate(l,d,x):L})}function Nn(n){for(var s=1/0,l=1/0,d=-1/0,x=-1/0,C=0,T=n;C<T.length;C+=1){var L=T[C];s=Math.min(s,L.x),l=Math.min(l,L.y),d=Math.max(d,L.x),x=Math.max(x,L.y)}return{minX:s,minY:l,maxX:d,maxY:x}}function Wv(n,s){return s-n}Bc.prototype.insert=function(n,s,l,d,x,C){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,x);for(var L=C?this.grid3D:this.grid,U=0;U<s.length;U++){for(var X=s[U],$=[1/0,1/0,-1/0,-1/0],ee=0;ee<X.length;ee++){var le=X[ee];$[0]=Math.min($[0],le.x),$[1]=Math.min($[1],le.y),$[2]=Math.max($[2],le.x),$[3]=Math.max($[3],le.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&L.insert(T,$[0],$[1],$[2],$[3])}},Bc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ru.VectorTile(new Ff(this.rawTileData)).layers,this.sourceLayerCoder=new rd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Bc.prototype.query=function(n,s,l,d){var x=this;this.loadVTLayers();for(var C=n.params||{},T=8192/n.tileSize/n.scale,L=Kl(C.filter),U=n.queryGeometry,X=n.queryPadding*T,$=Nn(U),ee=this.grid.query($.minX-X,$.minY-X,$.maxX+X,$.maxY+X),le=Nn(n.cameraQueryGeometry),Ee=this.grid3D.query(le.minX-X,le.minY-X,le.maxX+X,le.maxY+X,function(dr,gr,Dr,hn){return function(zn,Ai,Qn,Mi,Jn){for(var va=0,Wi=zn;va<Wi.length;va+=1){var di=Wi[va];if(Ai<=di.x&&Qn<=di.y&&Mi>=di.x&&Jn>=di.y)return!0}var Ra=[new pe(Ai,Qn),new pe(Ai,Jn),new pe(Mi,Jn),new pe(Mi,Qn)];if(zn.length>2){for(var fa=0,za=Ra;fa<za.length;fa+=1)if(Sl(zn,za[fa]))return!0}for(var Si=0;Si<zn.length-1;Si++)if(Ec(zn[Si],zn[Si+1],Ra))return!0;return!1}(n.cameraQueryGeometry,dr-X,gr-X,Dr+X,hn+X)}),$e=0,et=Ee;$e<et.length;$e+=1)ee.push(et[$e]);ee.sort(Wv);for(var mt,ut={},Ot=function(dr){var gr=ee[dr];if(gr!==mt){mt=gr;var Dr=x.featureIndexArray.get(gr),hn=null;x.loadMatchingFeature(ut,Dr.bucketIndex,Dr.sourceLayerIndex,Dr.featureIndex,L,C.layers,C.availableImages,s,l,d,function(zn,Ai,Qn){return hn||(hn=_o(zn)),Ai.queryIntersectsFeature(U,zn,Qn,hn,x.z,n.transform,T,n.pixelPosMatrix)})}},$t=0;$t<ee.length;$t++)Ot($t);return ut},Bc.prototype.loadMatchingFeature=function(n,s,l,d,x,C,T,L,U,X,$){var ee=this.bucketLayerIDs[s];if(!C||function(zn,Ai){for(var Qn=0;Qn<zn.length;Qn++)if(Ai.indexOf(zn[Qn])>=0)return!0;return!1}(C,ee)){var le=this.sourceLayerCoder.decode(l),Ee=this.vtLayers[le].feature(d);if(x.needGeometry){var $e=os(Ee,!0);if(!x.filter(new ha(this.tileID.overscaledZ),$e,this.tileID.canonical))return}else if(!x.filter(new ha(this.tileID.overscaledZ),Ee))return;for(var et=this.getId(Ee,le),mt=0;mt<ee.length;mt++){var ut=ee[mt];if(!(C&&C.indexOf(ut)<0)){var Ot=L[ut];if(Ot){var $t={};et!==void 0&&X&&($t=X.getState(Ot.sourceLayer||"_geojsonTileLayer",et));var dr=Wt({},U[ut]);dr.paint=Hv(dr.paint,Ot.paint,Ee,$t,T),dr.layout=Hv(dr.layout,Ot.layout,Ee,$t,T);var gr=!$||$(Ee,Ot,$t);if(gr){var Dr=new nd(Ee,this.z,this.x,this.y,et);Dr.layer=dr;var hn=n[ut];hn===void 0&&(hn=n[ut]=[]),hn.push({featureIndex:d,feature:Dr,intersectionZ:gr})}}}}}},Bc.prototype.lookupSymbolFeatures=function(n,s,l,d,x,C,T,L){var U={};this.loadVTLayers();for(var X=Kl(x),$=0,ee=n;$<ee.length;$+=1)this.loadMatchingFeature(U,l,d,ee[$],X,C,T,L,s);return U},Bc.prototype.hasLayer=function(n){for(var s=0,l=this.bucketLayerIDs;s<l.length;s+=1)for(var d=0,x=l[s];d<x.length;d+=1)if(n===x[d])return!0;return!1},Bc.prototype.getId=function(n,s){var l=n.id;return this.promoteId&&typeof(l=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(l=Number(l)),l},ti("FeatureIndex",Bc,{omit:["rawTileData","sourceLayerCoder"]});var nr=function(n,s){this.tileID=n,this.uid=lr(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};nr.prototype.registerFadeDuration=function(n){var s=n+this.timeAdded;s<Pi.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},nr.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},nr.prototype.loadVectorData=function(n,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){for(var d in n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(X,$){var ee={};if(!$)return ee;for(var le=function(){var et=$e[Ee],mt=et.layerIds.map(function($t){return $.getLayer($t)}).filter(Boolean);if(mt.length!==0){et.layers=mt,et.stateDependentLayerIds&&(et.stateDependentLayers=et.stateDependentLayerIds.map(function($t){return mt.filter(function(dr){return dr.id===$t})[0]}));for(var ut=0,Ot=mt;ut<Ot.length;ut+=1)ee[Ot[ut].id]=et}},Ee=0,$e=X;Ee<$e.length;Ee+=1)le();return ee}(n.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[d];if(x instanceof he){if(this.hasSymbolBuckets=!0,!l)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var C in this.buckets){var T=this.buckets[C];if(T instanceof he&&T.hasRTLText){this.hasRTLText=!0,Ks.isLoading()||Ks.isLoaded()||yi()!=="deferred"||ll();break}}for(var L in this.queryPadding=0,this.buckets){var U=this.buckets[L];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(L).queryRadius(U))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new h},nr.prototype.unloadVectorData=function(){for(var n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},nr.prototype.getBucket=function(n){return this.buckets[n.id]},nr.prototype.upload=function(n){for(var s in this.buckets){var l=this.buckets[s];l.uploadPending()&&l.upload(n)}var d=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Kn(n,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Kn(n,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)},nr.prototype.prepare=function(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)},nr.prototype.queryRenderedFeatures=function(n,s,l,d,x,C,T,L,U,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:x,scale:C,tileSize:this.tileSize,pixelPosMatrix:X,transform:L,params:T,queryPadding:this.queryPadding*U},n,s,l):{}},nr.prototype.querySourceFeatures=function(n,s){var l=this.latestFeatureIndex;if(l&&l.rawTileData){var d=l.loadVTLayers(),x=s?s.sourceLayer:"",C=d._geojsonTileLayer||d[x];if(C)for(var T=Kl(s&&s.filter),L=this.tileID.canonical,U=L.z,X=L.x,$=L.y,ee={z:U,x:X,y:$},le=0;le<C.length;le++){var Ee=C.feature(le);if(T.needGeometry){var $e=os(Ee,!0);if(!T.filter(new ha(this.tileID.overscaledZ),$e,this.tileID.canonical))continue}else if(!T.filter(new ha(this.tileID.overscaledZ),Ee))continue;var et=l.getId(Ee,x),mt=new nd(Ee,U,X,$,et);mt.tile=ee,n.push(mt)}}},nr.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},nr.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},nr.prototype.setExpiryData=function(n){var s=this.expirationTime;if(n.cacheControl){var l=rt(n.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){var d=Date.now(),x=!1;if(this.expirationTime>d)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{var C=this.expirationTime-s;C?this.expirationTime=d+Math.max(C,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},nr.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},nr.prototype.setFeatureState=function(n,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0){var l=this.latestFeatureIndex.loadVTLayers();for(var d in this.buckets)if(s.style.hasLayer(d)){var x=this.buckets[d],C=x.layers[0].sourceLayer||"_geojsonTileLayer",T=l[C],L=n[C];if(T&&L&&Object.keys(L).length!==0){x.update(L,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var U=s&&s.style&&s.style.getLayer(d);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(x)))}}}},nr.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},nr.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Pi.now()},nr.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},nr.prototype.setHoldDuration=function(n){this.symbolFadeHoldUntil=Pi.now()+n},nr.prototype.setDependencies=function(n,s){for(var l={},d=0,x=s;d<x.length;d+=1)l[x[d]]=!0;this.dependencies[n]=l},nr.prototype.hasDependency=function(n,s){for(var l=0,d=n;l<d.length;l+=1){var x=this.dependencies[d[l]];if(x){for(var C=0,T=s;C<T.length;C+=1)if(x[T[C]])return!0}}return!1};var np=we.performance,Od=function(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},np.mark(this._marks.start)};Od.prototype.finish=function(){np.mark(this._marks.end);var n=np.getEntriesByName(this._marks.measure);return n.length===0&&(np.measure(this._marks.measure,this._marks.start,this._marks.end),n=np.getEntriesByName(this._marks.measure),np.clearMarks(this._marks.start),np.clearMarks(this._marks.end),np.clearMeasures(this._marks.measure)),n},y.Actor=Ya,y.AlphaImage=Gl,y.CanonicalTileID=rp,y.CollisionBoxArray=h,y.Color=Ea,y.DEMData=oh,y.DataConstantProperty=bi,y.DictionaryCoder=rd,y.EXTENT=8192,y.ErrorEvent=st,y.EvaluationParameters=ha,y.Event=qe,y.Evented=xt,y.FeatureIndex=Bc,y.FillBucket=Zu,y.FillExtrusionBucket=lf,y.ImageAtlas=nn,y.ImagePosition=Ft,y.LineBucket=oo,y.LngLat=to,y.LngLatBounds=Lo,y.MercatorCoordinate=ah,y.ONE_EM=24,y.OverscaledTileID=ru,y.Point=pe,y.Point$1=pe,y.Properties=es,y.Protobuf=Ff,y.RGBAImage=Js,y.RequestManager=ai,y.RequestPerformance=Od,y.ResourceType=bn,y.SegmentVector=Se,y.SourceFeatureState=id,y.StructArrayLayout1ui2=Gp,y.StructArrayLayout2f1f2i16=Kc,y.StructArrayLayout2i4=Qf,y.StructArrayLayout3ui6=dl,y.StructArrayLayout4i8=hl,y.SymbolBucket=he,y.Texture=Kn,y.Tile=nr,y.Transitionable=Zs,y.Uniform1f=xn,y.Uniform1i=Hr,y.Uniform2f=yn,y.Uniform3f=Zn,y.Uniform4f=_i,y.UniformColor=wi,y.UniformMatrix4f=wa,y.UnwrappedTileID=n0,y.ValidationError=it,y.WritingMode=kn,y.ZoomHistory=xc,y.add=function(n,s,l){return n[0]=s[0]+l[0],n[1]=s[1]+l[1],n[2]=s[2]+l[2],n},y.addDynamicAttributes=ht,y.asyncAll=function(n,s,l){if(!n.length)return l(null,[]);var d=n.length,x=new Array(n.length),C=null;n.forEach(function(T,L){s(T,function(U,X){U&&(C=U),x[L]=X,--d==0&&l(C,x)})})},y.bezier=Ct,y.bindAll=Pr,y.browser=Pi,y.cacheEntryPossiblyAdded=function(n){++vi>Cr&&(n.getActor().send("enforceCacheSizeLimit",Dt),vi=0)},y.clamp=tr,y.clearTileCache=function(n){var s=we.caches.delete("mapbox-tiles");n&&s.catch(n).then(function(){return n()})},y.clipLine=Ps,y.clone=function(n){var s=new Ga(16);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},y.clone$1=_t,y.clone$2=function(n){var s=new Ga(3);return s[0]=n[0],s[1]=n[1],s[2]=n[2],s},y.collisionCircleLayout=e0,y.config=mi,y.create=function(){var n=new Ga(16);return Ga!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},y.create$1=function(){var n=new Ga(9);return Ga!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},y.create$2=function(){var n=new Ga(4);return Ga!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},y.createCommonjsModule=Ne,y.createExpression=Gc,y.createLayout=yo,y.createStyleLayer=function(n){return n.type==="custom"?new In(n):new Vn[n.type](n)},y.cross=function(n,s,l){var d=s[0],x=s[1],C=s[2],T=l[0],L=l[1],U=l[2];return n[0]=x*U-C*L,n[1]=C*T-d*U,n[2]=d*L-x*T,n},y.deepEqual=function n(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(var d=0;d<s.length;d++)if(!n(s[d],l[d]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(var x in s)if(!n(s[x],l[x]))return!1;return!0}return s===l},y.dot=function(n,s){return n[0]*s[0]+n[1]*s[1]+n[2]*s[2]},y.dot$1=function(n,s){return n[0]*s[0]+n[1]*s[1]+n[2]*s[2]+n[3]*s[3]},y.ease=Pt,y.emitValidationErrors=_c,y.endsWith=re,y.enforceCacheSizeLimit=function(n){_r(),oe&&oe.then(function(s){s.keys().then(function(l){for(var d=0;d<l.length-n;d++)s.delete(l[d])})})},y.evaluateSizeForFeature=Ii,y.evaluateSizeForZoom=ta,y.evaluateVariableOffset=Fc,y.evented=gp,y.extend=Wt,y.featureFilter=Kl,y.filterObject=Rt,y.fromRotation=function(n,s){var l=Math.sin(s),d=Math.cos(s);return n[0]=d,n[1]=l,n[2]=0,n[3]=-l,n[4]=d,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},y.getAnchorAlignment=Un,y.getAnchorJustification=Ye,y.getArrayBuffer=Ci,y.getImage=ae,y.getJSON=function(n,s){return Wa(Wt(n,{type:"json"}),s)},y.getRTLTextPluginStatus=yi,y.getReferrer=Ni,y.getVideo=function(n,s){var l,d,x=we.document.createElement("video");x.muted=!0,x.onloadstart=function(){s(null,x)};for(var C=0;C<n.length;C++){var T=we.document.createElement("source");l=n[C],d=void 0,(d=we.document.createElement("a")).href=l,(d.protocol!==we.document.location.protocol||d.host!==we.document.location.host)&&(x.crossOrigin="Anonymous"),T.src=n[C],x.appendChild(T)}return{cancel:function(){}}},y.identity=Nu,y.invert=function(n,s){var l=s[0],d=s[1],x=s[2],C=s[3],T=s[4],L=s[5],U=s[6],X=s[7],$=s[8],ee=s[9],le=s[10],Ee=s[11],$e=s[12],et=s[13],mt=s[14],ut=s[15],Ot=l*L-d*T,$t=l*U-x*T,dr=l*X-C*T,gr=d*U-x*L,Dr=d*X-C*L,hn=x*X-C*U,zn=$*et-ee*$e,Ai=$*mt-le*$e,Qn=$*ut-Ee*$e,Mi=ee*mt-le*et,Jn=ee*ut-Ee*et,va=le*ut-Ee*mt,Wi=Ot*va-$t*Jn+dr*Mi+gr*Qn-Dr*Ai+hn*zn;return Wi?(n[0]=(L*va-U*Jn+X*Mi)*(Wi=1/Wi),n[1]=(x*Jn-d*va-C*Mi)*Wi,n[2]=(et*hn-mt*Dr+ut*gr)*Wi,n[3]=(le*Dr-ee*hn-Ee*gr)*Wi,n[4]=(U*Qn-T*va-X*Ai)*Wi,n[5]=(l*va-x*Qn+C*Ai)*Wi,n[6]=(mt*dr-$e*hn-ut*$t)*Wi,n[7]=($*hn-le*dr+Ee*$t)*Wi,n[8]=(T*Jn-L*Qn+X*zn)*Wi,n[9]=(d*Qn-l*Jn-C*zn)*Wi,n[10]=($e*Dr-et*dr+ut*Ot)*Wi,n[11]=(ee*dr-$*Dr-Ee*Ot)*Wi,n[12]=(L*Ai-T*Mi-U*zn)*Wi,n[13]=(l*Mi-d*Ai+x*zn)*Wi,n[14]=(et*$t-$e*gr-mt*Ot)*Wi,n[15]=($*gr-ee*$t+le*Ot)*Wi,n):null},y.isChar=Mn,y.isMapboxURL=Ki,y.keysDifference=function(n,s){var l=[];for(var d in n)d in s||l.push(d);return l},y.makeRequest=Wa,y.mapObject=yr,y.mercatorXfromLng=sc,y.mercatorYfromLat=Hl,y.mercatorZfromAltitude=Dc,y.mul=_h,y.multiply=bs,y.mvt=Ru,y.nextPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},y.normalize=function(n,s){var l=s[0],d=s[1],x=s[2],C=l*l+d*d+x*x;return C>0&&(C=1/Math.sqrt(C)),n[0]=s[0]*C,n[1]=s[1]*C,n[2]=s[2]*C,n},y.number=Za,y.offscreenCanvasSupported=ni,y.ortho=function(n,s,l,d,x,C,T){var L=1/(s-l),U=1/(d-x),X=1/(C-T);return n[0]=-2*L,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*U,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*X,n[11]=0,n[12]=(s+l)*L,n[13]=(x+d)*U,n[14]=(T+C)*X,n[15]=1,n},y.parseGlyphPBF=function(n){return new Ff(n).readFields(dn,[])},y.pbf=Ff,y.performSymbolLayout=function(n,s,l,d,x,C,T){n.createArrays(),n.tilePixelRatio=8192/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;var L=n.layers[0].layout,U=n.layers[0]._unevaluatedLayout._values,X={};if(n.textSizeData.kind==="composite"){var $=n.textSizeData,ee=$.maxZoom;X.compositeTextSizes=[U["text-size"].possiblyEvaluate(new ha($.minZoom),T),U["text-size"].possiblyEvaluate(new ha(ee),T)]}if(n.iconSizeData.kind==="composite"){var le=n.iconSizeData,Ee=le.maxZoom;X.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new ha(le.minZoom),T),U["icon-size"].possiblyEvaluate(new ha(Ee),T)]}X.layoutTextSize=U["text-size"].possiblyEvaluate(new ha(n.zoom+1),T),X.layoutIconSize=U["icon-size"].possiblyEvaluate(new ha(n.zoom+1),T),X.textMaxSize=U["text-size"].possiblyEvaluate(new ha(18));for(var $e=24*L.get("text-line-height"),et=L.get("text-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",mt=L.get("text-keep-upright"),ut=L.get("text-size"),Ot=function(){var gr=dr[$t],Dr=L.get("text-font").evaluate(gr,{},T).join(","),hn=ut.evaluate(gr,{},T),zn=X.layoutTextSize.evaluate(gr,{},T),Ai=X.layoutIconSize.evaluate(gr,{},T),Qn={horizontal:{},vertical:void 0},Mi=gr.text,Jn=[0,0];if(Mi){var va=Mi.toString(),Wi=24*L.get("text-letter-spacing").evaluate(gr,{},T),di=function(Sa){for(var so=0,bo=Sa;so<bo.length;so+=1)if(Ua=bo[so].charCodeAt(0),Mn.Arabic(Ua)||Mn["Arabic Supplement"](Ua)||Mn["Arabic Extended-A"](Ua)||Mn["Arabic Presentation Forms-A"](Ua)||Mn["Arabic Presentation Forms-B"](Ua))return!1;var Ua;return!0}(va)?Wi:0,Ra=L.get("text-anchor").evaluate(gr,{},T),fa=L.get("text-variable-anchor");if(!fa){var za=L.get("text-radial-offset").evaluate(gr,{},T);Jn=za?Fc(Ra,[24*za,us]):L.get("text-offset").evaluate(gr,{},T).map(function(Sa){return 24*Sa})}var Si=et?"center":L.get("text-justify").evaluate(gr,{},T),ao=L.get("symbol-placement"),ra=ao==="point"?24*L.get("text-max-width").evaluate(gr,{},T):0,ko=function(){n.allowVerticalPlacement&&wf(va)&&(Qn.vertical=On(Mi,s,l,x,Dr,ra,$e,Ra,"left",di,Jn,kn.vertical,!0,ao,zn,hn))};if(!et&&fa){for(var gs=Si==="auto"?fa.map(function(Sa){return Ye(Sa)}):[Si],jo=!1,ys=0;ys<gs.length;ys++){var cu=gs[ys];if(!Qn.horizontal[cu])if(jo)Qn.horizontal[cu]=Qn.horizontal[0];else{var nu=On(Mi,s,l,x,Dr,ra,$e,"center",cu,di,Jn,kn.horizontal,!1,ao,zn,hn);nu&&(Qn.horizontal[cu]=nu,jo=nu.positionedLines.length===1)}}ko()}else{Si==="auto"&&(Si=Ye(Ra));var il=On(Mi,s,l,x,Dr,ra,$e,Ra,Si,di,Jn,kn.horizontal,!1,ao,zn,hn);il&&(Qn.horizontal[Si]=il),ko(),wf(va)&&et&&mt&&(Qn.vertical=On(Mi,s,l,x,Dr,ra,$e,Ra,Si,di,Jn,kn.vertical,!1,ao,zn,hn))}}var ts=void 0,ju=!1;if(gr.icon&&gr.icon.name){var Os=d[gr.icon.name];Os&&(ts=function(Sa,so,bo){var Ua=Un(bo),Gu=so[0]-Sa.displaySize[0]*Ua.horizontalAlign,fu=so[1]-Sa.displaySize[1]*Ua.verticalAlign;return{image:Sa,top:fu,bottom:fu+Sa.displaySize[1],left:Gu,right:Gu+Sa.displaySize[0]}}(x[gr.icon.name],L.get("icon-offset").evaluate(gr,{},T),L.get("icon-anchor").evaluate(gr,{},T)),ju=Os.sdf,n.sdfIcons===void 0?n.sdfIcons=Os.sdf:n.sdfIcons!==Os.sdf&&Ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Os.pixelRatio!==n.pixelRatio||L.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}var Go=Vt(Qn.horizontal)||Qn.vertical;n.iconsInText=!!Go&&Go.iconsInText,(Go||ts)&&function(Sa,so,bo,Ua,Gu,fu,Do,Xs,Lu,Xa,wl){var uc=fu.textMaxSize.evaluate(so,{});uc===void 0&&(uc=Do);var al,Ss=Sa.layers[0].layout,Nc=Ss.get("icon-offset").evaluate(so,{},wl),zc=Vt(bo.horizontal),ad=Do/24,Cp=Sa.tilePixelRatio*ad,od=Sa.tilePixelRatio*uc/24,Th=Sa.tilePixelRatio*Xs,sd=Sa.tilePixelRatio*Ss.get("symbol-spacing"),ip=Ss.get("text-padding")*Sa.tilePixelRatio,ap=Ss.get("icon-padding")*Sa.tilePixelRatio,Sp=Ss.get("text-max-angle")/180*Math.PI,op=Ss.get("text-rotation-alignment")==="map"&&Ss.get("symbol-placement")!=="point",ud=Ss.get("icon-rotation-alignment")==="map"&&Ss.get("symbol-placement")!=="point",hf=Ss.get("symbol-placement"),Fd=sd/2,Ap=Ss.get("icon-text-fit");Ua&&Ap!=="none"&&(Sa.allowVerticalPlacement&&bo.vertical&&(al=Hi(Ua,bo.vertical,Ap,Ss.get("icon-text-fit-padding"),Nc,ad)),zc&&(Ua=Hi(Ua,zc,Ap,Ss.get("icon-text-fit-padding"),Nc,ad)));var sp=function(Nd,kp){kp.x<0||kp.x>=8192||kp.y<0||kp.y>=8192||function(As,Df,Xv,kh,a0,I0,Ph,lc,ya,ma,zd,k0,P0,Yv,o0,Ud,R0,L0,Xl,sv,Uc,O0,qv,Bf,Zc){var $v,Pp,gd,Rp,Zd,Vd=As.addToLineVertexArray(Df,Xv),Kv=0,Qv=0,F0=0,uv=0,lv=-1,Nf=-1,zf={},Jv=He(""),D0=0,s0=0;if(lc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(D0=($v=lc.layout.get("text-offset").evaluate(Uc,{},Bf).map(function(Hd){return 24*Hd}))[0],s0=$v[1]):(D0=24*lc.layout.get("text-radial-offset").evaluate(Uc,{},Bf),s0=us),As.allowVerticalPlacement&&kh.vertical){var em=lc.layout.get("text-rotate").evaluate(Uc,{},Bf)+90;Rp=new Cs(ya,Df,ma,zd,k0,kh.vertical,P0,Yv,o0,em),Ph&&(Zd=new Cs(ya,Df,ma,zd,k0,Ph,R0,L0,o0,em))}if(a0){var cv=lc.layout.get("icon-rotate").evaluate(Uc,{}),B0=lc.layout.get("icon-text-fit")!=="none",N0=uu(a0,cv,qv,B0),u0=Ph?uu(Ph,cv,qv,B0):void 0;gd=new Cs(ya,Df,ma,zd,k0,a0,R0,L0,!1,cv),Kv=4*N0.length;var z0=As.iconSizeData,yd=null;z0.kind==="source"?(yd=[128*lc.layout.get("icon-size").evaluate(Uc,{})])[0]>32640&&Ue(As.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):z0.kind==="composite"&&((yd=[128*O0.compositeIconSizes[0].evaluate(Uc,{},Bf),128*O0.compositeIconSizes[1].evaluate(Uc,{},Bf)])[0]>32640||yd[1]>32640)&&Ue(As.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),As.addSymbols(As.icon,N0,yd,sv,Xl,Uc,!1,Df,Vd.lineStartIndex,Vd.lineLength,-1,Bf),lv=As.icon.placedSymbolArray.length-1,u0&&(Qv=4*u0.length,As.addSymbols(As.icon,u0,yd,sv,Xl,Uc,kn.vertical,Df,Vd.lineStartIndex,Vd.lineLength,-1,Bf),Nf=As.icon.placedSymbolArray.length-1)}for(var tm in kh.horizontal){var _d=kh.horizontal[tm];if(!Pp){Jv=He(_d.text);var rm=lc.layout.get("text-rotate").evaluate(Uc,{},Bf);Pp=new Cs(ya,Df,ma,zd,k0,_d,P0,Yv,o0,rm)}var uh=_d.positionedLines.length===1;if(F0+=pr(As,Df,_d,I0,lc,o0,Uc,Ud,Vd,kh.vertical?kn.horizontal:kn.horizontalOnly,uh?Object.keys(kh.horizontal):[tm],zf,lv,O0,Bf),uh)break}kh.vertical&&(uv+=pr(As,Df,kh.vertical,I0,lc,o0,Uc,Ud,Vd,kn.vertical,["vertical"],zf,Nf,O0,Bf));var jd=Pp?Pp.boxStartIndex:As.collisionBoxArray.length,fv=Pp?Pp.boxEndIndex:As.collisionBoxArray.length,hv=Rp?Rp.boxStartIndex:As.collisionBoxArray.length,cp=Rp?Rp.boxEndIndex:As.collisionBoxArray.length,Lp=gd?gd.boxStartIndex:As.collisionBoxArray.length,pv=gd?gd.boxEndIndex:As.collisionBoxArray.length,dv=Zd?Zd.boxStartIndex:As.collisionBoxArray.length,vv=Zd?Zd.boxEndIndex:As.collisionBoxArray.length,cc=-1,Gd=function(Hd,Ys){return Hd&&Hd.circleDiameter?Math.max(Hd.circleDiameter,Ys):Ys};cc=Gd(Pp,cc),cc=Gd(Rp,cc),cc=Gd(gd,cc);var Op=(cc=Gd(Zd,cc))>-1?1:0;Op&&(cc*=Zc/24),As.glyphOffsetArray.length>=he.MAX_GLYPHS&&Ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Uc.sortKey!==void 0&&As.addToSortKeyRanges(As.symbolInstances.length,Uc.sortKey),As.symbolInstances.emplaceBack(Df.x,Df.y,zf.right>=0?zf.right:-1,zf.center>=0?zf.center:-1,zf.left>=0?zf.left:-1,zf.vertical||-1,lv,Nf,Jv,jd,fv,hv,cp,Lp,pv,dv,vv,ma,F0,uv,Kv,Qv,Op,0,P0,D0,s0,cc)}(Sa,kp,Nd,bo,Ua,Gu,al,Sa.layers[0],Sa.collisionBoxArray,so.index,so.sourceLayerIndex,Sa.index,Cp,ip,op,Lu,Th,ap,ud,Nc,so,fu,Xa,wl,Do)};if(hf==="line")for(var sh=0,Dd=Ps(so.geometry,0,0,8192,8192);sh<Dd.length;sh+=1)for(var wp=Dd[sh],Tp=0,ld=Io(wp,sd,Sp,bo.vertical||zc,Ua,24,od,Sa.overscaling,8192);Tp<ld.length;Tp+=1){var cd=ld[Tp];zc&&qn(Sa,zc.text,Fd,cd)||sp(wp,cd)}else if(hf==="line-center")for(var fd=0,Mh=so.geometry;fd<Mh.length;fd+=1){var hd=Mh[fd];if(hd.length>1){var pd=Mo(hd,Sp,bo.vertical||zc,Ua,24,od);pd&&sp(hd,pd)}}else if(so.type==="Polygon")for(var Ih=0,Mp=xp(so.geometry,0);Ih<Mp.length;Ih+=1){var up=Mp[Ih],lp=Zi(up,16);sp(up[0],new Jr(lp.x,lp.y,0))}else if(so.type==="LineString")for(var pf=0,dd=so.geometry;pf<dd.length;pf+=1){var vd=dd[pf];sp(vd,new Jr(vd[0].x,vd[0].y,0))}else if(so.type==="Point")for(var Ip=0,M0=so.geometry;Ip<M0.length;Ip+=1)for(var Bd=0,i0=M0[Ip];Bd<i0.length;Bd+=1){var md=i0[Bd];sp([md],new Jr(md.x,md.y,0))}}(n,gr,Qn,ts,d,X,zn,Ai,Jn,ju,T)},$t=0,dr=n.features;$t<dr.length;$t+=1)Ot();C&&n.generateCollisionDebugBuffers()},y.perspective=function(n,s,l,d,x){var C,T=1/Math.tan(s/2);return n[0]=T/l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=T,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,x!=null&&x!==1/0?(n[10]=(x+d)*(C=1/(d-x)),n[14]=2*x*d*C):(n[10]=-1,n[14]=-2*d),n},y.pick=function(n,s){for(var l={},d=0;d<s.length;d++){var x=s[d];x in n&&(l[x]=n[x])}return l},y.plugin=Ks,y.polygonIntersectsPolygon=Ul,y.postMapLoadEvent=Ke,y.postTurnstileEvent=sr,y.potpack=fn,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=ti,y.registerForPluginStateChange=function(n){return n({pluginStatus:wu,pluginURL:Nl}),gp.on("pluginStateChange",n),n},y.renderColorRamp=rc,y.rotate=function(n,s,l){var d=s[0],x=s[1],C=s[2],T=s[3],L=Math.sin(l),U=Math.cos(l);return n[0]=d*U+C*L,n[1]=x*U+T*L,n[2]=d*-L+C*U,n[3]=x*-L+T*U,n},y.rotateX=function(n,s,l){var d=Math.sin(l),x=Math.cos(l),C=s[4],T=s[5],L=s[6],U=s[7],X=s[8],$=s[9],ee=s[10],le=s[11];return s!==n&&(n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15]),n[4]=C*x+X*d,n[5]=T*x+$*d,n[6]=L*x+ee*d,n[7]=U*x+le*d,n[8]=X*x-C*d,n[9]=$*x-T*d,n[10]=ee*x-L*d,n[11]=le*x-U*d,n},y.rotateZ=function(n,s,l){var d=Math.sin(l),x=Math.cos(l),C=s[0],T=s[1],L=s[2],U=s[3],X=s[4],$=s[5],ee=s[6],le=s[7];return s!==n&&(n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15]),n[0]=C*x+X*d,n[1]=T*x+$*d,n[2]=L*x+ee*d,n[3]=U*x+le*d,n[4]=X*x-C*d,n[5]=$*x-T*d,n[6]=ee*x-L*d,n[7]=le*x-U*d,n},y.scale=function(n,s,l){var d=l[0],x=l[1],C=l[2];return n[0]=s[0]*d,n[1]=s[1]*d,n[2]=s[2]*d,n[3]=s[3]*d,n[4]=s[4]*x,n[5]=s[5]*x,n[6]=s[6]*x,n[7]=s[7]*x,n[8]=s[8]*C,n[9]=s[9]*C,n[10]=s[10]*C,n[11]=s[11]*C,n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n},y.scale$1=function(n,s,l){return n[0]=s[0]*l,n[1]=s[1]*l,n[2]=s[2]*l,n[3]=s[3]*l,n},y.scale$2=function(n,s,l){return n[0]=s[0]*l,n[1]=s[1]*l,n[2]=s[2]*l,n},y.setCacheLimits=function(n,s){Dt=n,Cr=s},y.setRTLTextPlugin=function(n,s,l){if(l===void 0&&(l=!1),wu==="deferred"||wu==="loading"||wu==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Nl=Pi.resolveURL(n),wu="deferred",Bl=s,$c(),l||ll()},y.sphericalToCartesian=function(n){var s=n[0],l=n[1],d=n[2];return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:s*Math.cos(l)*Math.sin(d),y:s*Math.sin(l)*Math.sin(d),z:s*Math.cos(d)}},y.sqrLen=function(n){var s=n[0],l=n[1];return s*s+l*l},y.styleSpec=Me,y.sub=function(n,s,l){return n[0]=s[0]-l[0],n[1]=s[1]-l[1],n[2]=s[2]-l[2],n},y.symbolSize=da,y.transformMat3=function(n,s,l){var d=s[0],x=s[1],C=s[2];return n[0]=d*l[0]+x*l[3]+C*l[6],n[1]=d*l[1]+x*l[4]+C*l[7],n[2]=d*l[2]+x*l[5]+C*l[8],n},y.transformMat4=xh,y.translate=function(n,s,l){var d,x,C,T,L,U,X,$,ee,le,Ee,$e,et=l[0],mt=l[1],ut=l[2];return s===n?(n[12]=s[0]*et+s[4]*mt+s[8]*ut+s[12],n[13]=s[1]*et+s[5]*mt+s[9]*ut+s[13],n[14]=s[2]*et+s[6]*mt+s[10]*ut+s[14],n[15]=s[3]*et+s[7]*mt+s[11]*ut+s[15]):(x=s[1],C=s[2],T=s[3],L=s[4],U=s[5],X=s[6],$=s[7],ee=s[8],le=s[9],Ee=s[10],$e=s[11],n[0]=d=s[0],n[1]=x,n[2]=C,n[3]=T,n[4]=L,n[5]=U,n[6]=X,n[7]=$,n[8]=ee,n[9]=le,n[10]=Ee,n[11]=$e,n[12]=d*et+L*mt+ee*ut+s[12],n[13]=x*et+U*mt+le*ut+s[13],n[14]=C*et+X*mt+Ee*ut+s[14],n[15]=T*et+$*mt+$e*ut+s[15]),n},y.triggerPluginCompletionEvent=$f,y.uniqueId=lr,y.validateCustomStyleLayer=function(n){var s=[],l=n.id;return l===void 0&&s.push({message:"layers."+l+': missing required property "id"'}),n.render===void 0&&s.push({message:"layers."+l+': missing required method "render"'}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&s.push({message:"layers."+l+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=Qa,y.validateStyle=ph,y.values=function(n){var s=[];for(var l in n)s.push(n[l]);return s},y.vectorTile=Ru,y.version="1.13.2",y.warnOnce=Ue,y.webpSupported=ln,y.window=we,y.wrap=Yt}),de(["./shared"],function(y){"use strict";function Ne(Q){var ae=typeof Q;if(ae==="number"||ae==="boolean"||ae==="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){for(var me="[",ke=0,qe=Q;ke<qe.length;ke+=1)me+=Ne(qe[ke])+",";return me+"]"}for(var st=Object.keys(Q).sort(),xt="{",Me=0;Me<st.length;Me++)xt+=JSON.stringify(st[Me])+":"+Ne(Q[st[Me]])+",";return xt+"}"}function K(Q){for(var ae="",me=0,ke=y.refProperties;me<ke.length;me+=1)ae+="/"+Ne(Q[ke[me]]);return ae}var Re=function(Q){this.keyCache={},Q&&this.replace(Q)};Re.prototype.replace=function(Q){this._layerConfigs={},this._layers={},this.update(Q,[])},Re.prototype.update=function(Q,ae){for(var me=this,ke=0,qe=Q;ke<qe.length;ke+=1){var st=qe[ke];this._layerConfigs[st.id]=st;var xt=this._layers[st.id]=y.createStyleLayer(st);xt._featureFilter=y.featureFilter(xt.filter),this.keyCache[st.id]&&delete this.keyCache[st.id]}for(var Me=0,it=ae;Me<it.length;Me+=1){var Gt=it[Me];delete this.keyCache[Gt],delete this._layerConfigs[Gt],delete this._layers[Gt]}this.familiesBySource={};for(var Zr=0,or=function(wn,Tn){for(var sa={},Ir=0;Ir<wn.length;Ir++){var qi=Tn&&Tn[wn[Ir].id]||K(wn[Ir]);Tn&&(Tn[wn[Ir].id]=qi);var La=sa[qi];La||(La=sa[qi]=[]),La.push(wn[Ir])}var na=[];for(var pa in sa)na.push(sa[pa]);return na}(y.values(this._layerConfigs),this.keyCache);Zr<or.length;Zr+=1){var hr=or[Zr].map(function(wn){return me._layers[wn.id]}),jr=hr[0];if(jr.visibility!=="none"){var oi=jr.source||"",Sn=this.familiesBySource[oi];Sn||(Sn=this.familiesBySource[oi]={});var Jt=jr.sourceLayer||"_geojsonTileLayer",Hn=Sn[Jt];Hn||(Hn=Sn[Jt]=[]),Hn.push(hr)}}};var pe=function(Q){var ae={},me=[];for(var ke in Q){var qe=Q[ke],st=ae[ke]={};for(var xt in qe){var Me=qe[+xt];if(Me&&Me.bitmap.width!==0&&Me.bitmap.height!==0){var it={x:0,y:0,w:Me.bitmap.width+2,h:Me.bitmap.height+2};me.push(it),st[xt]={rect:it,metrics:Me.metrics}}}}var Gt=y.potpack(me),Zr=new y.AlphaImage({width:Gt.w||1,height:Gt.h||1});for(var or in Q){var hr=Q[or];for(var jr in hr){var oi=hr[+jr];if(oi&&oi.bitmap.width!==0&&oi.bitmap.height!==0){var Sn=ae[or][jr].rect;y.AlphaImage.copy(oi.bitmap,Zr,{x:0,y:0},{x:Sn.x+1,y:Sn.y+1},oi.bitmap)}}}this.image=Zr,this.positions=ae};y.register("GlyphAtlas",pe);var lt=function(Q){this.tileID=new y.OverscaledTileID(Q.tileID.overscaledZ,Q.tileID.wrap,Q.tileID.canonical.z,Q.tileID.canonical.x,Q.tileID.canonical.y),this.uid=Q.uid,this.zoom=Q.zoom,this.pixelRatio=Q.pixelRatio,this.tileSize=Q.tileSize,this.source=Q.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Q.showCollisionBoxes,this.collectResourceTiming=!!Q.collectResourceTiming,this.returnDependencies=!!Q.returnDependencies,this.promoteId=Q.promoteId};function we(Q,ae,me){for(var ke=new y.EvaluationParameters(ae),qe=0,st=Q;qe<st.length;qe+=1)st[qe].recalculate(ke,me)}function Xe(Q,ae){var me=y.getArrayBuffer(Q.request,function(ke,qe,st,xt){ke?ae(ke):qe&&ae(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(qe)),rawData:qe,cacheControl:st,expires:xt})});return function(){me.cancel(),ae()}}lt.prototype.parse=function(Q,ae,me,ke,qe){var st=this;this.status="parsing",this.data=Q,this.collisionBoxArray=new y.CollisionBoxArray;var xt=new y.DictionaryCoder(Object.keys(Q.layers).sort()),Me=new y.FeatureIndex(this.tileID,this.promoteId);Me.bucketLayerIDs=[];var it,Gt,Zr,or,hr={},jr={featureIndex:Me,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},oi=ae.familiesBySource[this.source];for(var Sn in oi){var Jt=Q.layers[Sn];if(Jt){Jt.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+Sn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Hn=xt.encode(Sn),wn=[],Tn=0;Tn<Jt.length;Tn++){var sa=Jt.feature(Tn),Ir=Me.getId(sa,Sn);wn.push({feature:sa,id:Ir,index:Tn,sourceLayerIndex:Hn})}for(var qi=0,La=oi[Sn];qi<La.length;qi+=1){var na=La[qi],pa=na[0];pa.minzoom&&this.zoom<Math.floor(pa.minzoom)||pa.maxzoom&&this.zoom>=pa.maxzoom||pa.visibility!=="none"&&(we(na,this.zoom,me),(hr[pa.id]=pa.createBucket({index:Me.bucketLayerIDs.length,layers:na,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Hn,sourceID:this.source})).populate(wn,jr,this.tileID.canonical),Me.bucketLayerIDs.push(na.map(function(Ba){return Ba.id})))}}}var Lt=y.mapObject(jr.glyphDependencies,function(Ba){return Object.keys(Ba).map(Number)});Object.keys(Lt).length?ke.send("getGlyphs",{uid:this.uid,stacks:Lt},function(Ba,zi){it||(it=Ba,Gt=zi,fo.call(st))}):Gt={};var At=Object.keys(jr.iconDependencies);At.length?ke.send("getImages",{icons:At,source:this.source,tileID:this.tileID,type:"icons"},function(Ba,zi){it||(it=Ba,Zr=zi,fo.call(st))}):Zr={};var Qi=Object.keys(jr.patternDependencies);function fo(){if(it)return qe(it);if(Gt&&Zr&&or){var Ba=new pe(Gt),zi=new y.ImageAtlas(Zr,or);for(var Ea in hr){var Co=hr[Ea];Co instanceof y.SymbolBucket?(we(Co.layers,this.zoom,me),y.performSymbolLayout(Co,Gt,Ba.positions,Zr,zi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Co.hasPattern&&(Co instanceof y.LineBucket||Co instanceof y.FillBucket||Co instanceof y.FillExtrusionBucket)&&(we(Co.layers,this.zoom,me),Co.addFeatures(jr,this.tileID.canonical,zi.patternPositions))}this.status="done",qe(null,{buckets:y.values(hr).filter(function(sn){return!sn.isEmpty()}),featureIndex:Me,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ba.image,imageAtlas:zi,glyphMap:this.returnDependencies?Gt:null,iconMap:this.returnDependencies?Zr:null,glyphPositions:this.returnDependencies?Ba.positions:null})}}Qi.length?ke.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"patterns"},function(Ba,zi){it||(it=Ba,or=zi,fo.call(st))}):or={},fo.call(this)};var Ct=function(Q,ae,me,ke){this.actor=Q,this.layerIndex=ae,this.availableImages=me,this.loadVectorData=ke||Xe,this.loading={},this.loaded={}};Ct.prototype.loadTile=function(Q,ae){var me=this,ke=Q.uid;this.loading||(this.loading={});var qe=!!(Q&&Q.request&&Q.request.collectResourceTiming)&&new y.RequestPerformance(Q.request),st=this.loading[ke]=new lt(Q);st.abort=this.loadVectorData(Q,function(xt,Me){if(delete me.loading[ke],xt||!Me)return st.status="done",me.loaded[ke]=st,ae(xt);var it=Me.rawData,Gt={};Me.expires&&(Gt.expires=Me.expires),Me.cacheControl&&(Gt.cacheControl=Me.cacheControl);var Zr={};if(qe){var or=qe.finish();or&&(Zr.resourceTiming=JSON.parse(JSON.stringify(or)))}st.vectorTile=Me.vectorTile,st.parse(Me.vectorTile,me.layerIndex,me.availableImages,me.actor,function(hr,jr){if(hr||!jr)return ae(hr);ae(null,y.extend({rawTileData:it.slice(0)},jr,Gt,Zr))}),me.loaded=me.loaded||{},me.loaded[ke]=st})},Ct.prototype.reloadTile=function(Q,ae){var me=this,ke=this.loaded,qe=Q.uid,st=this;if(ke&&ke[qe]){var xt=ke[qe];xt.showCollisionBoxes=Q.showCollisionBoxes;var Me=function(it,Gt){var Zr=xt.reloadCallback;Zr&&(delete xt.reloadCallback,xt.parse(xt.vectorTile,st.layerIndex,me.availableImages,st.actor,Zr)),ae(it,Gt)};xt.status==="parsing"?xt.reloadCallback=Me:xt.status==="done"&&(xt.vectorTile?xt.parse(xt.vectorTile,this.layerIndex,this.availableImages,this.actor,Me):Me())}},Ct.prototype.abortTile=function(Q,ae){var me=this.loading,ke=Q.uid;me&&me[ke]&&me[ke].abort&&(me[ke].abort(),delete me[ke]),ae()},Ct.prototype.removeTile=function(Q,ae){var me=this.loaded,ke=Q.uid;me&&me[ke]&&delete me[ke],ae()};var Pt=y.window.ImageBitmap,tr=function(){this.loaded={}};function Yt(Q,ae){if(Q.length!==0){Wt(Q[0],ae);for(var me=1;me<Q.length;me++)Wt(Q[me],!ae)}}function Wt(Q,ae){for(var me=0,ke=0,qe=Q.length,st=qe-1;ke<qe;st=ke++)me+=(Q[ke][0]-Q[st][0])*(Q[st][1]+Q[ke][1]);me>=0!=!!ae&&Q.reverse()}tr.prototype.loadTile=function(Q,ae){var me=Q.uid,ke=Q.encoding,qe=Q.rawImageData,st=Pt&&qe instanceof Pt?this.getImageData(qe):qe,xt=new y.DEMData(me,st,ke);this.loaded=this.loaded||{},this.loaded[me]=xt,ae(null,xt)},tr.prototype.getImageData=function(Q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Q.width,Q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Q.width,this.offscreenCanvas.height=Q.height,this.offscreenCanvasContext.drawImage(Q,0,0,Q.width,Q.height);var ae=this.offscreenCanvasContext.getImageData(-1,-1,Q.width+2,Q.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:ae.width,height:ae.height},ae.data)},tr.prototype.removeTile=function(Q){var ae=this.loaded,me=Q.uid;ae&&ae[me]&&delete ae[me]};var br=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,lr=function(Q){this._feature=Q,this.extent=y.EXTENT,this.type=Q.type,this.properties=Q.tags,"id"in Q&&!isNaN(Q.id)&&(this.id=parseInt(Q.id,10))};lr.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Q=[],ae=0,me=this._feature.geometry;ae<me.length;ae+=1){var ke=me[ae];Q.push([new y.Point$1(ke[0],ke[1])])}return Q}for(var qe=[],st=0,xt=this._feature.geometry;st<xt.length;st+=1){for(var Me=[],it=0,Gt=xt[st];it<Gt.length;it+=1){var Zr=Gt[it];Me.push(new y.Point$1(Zr[0],Zr[1]))}qe.push(Me)}return qe},lr.prototype.toGeoJSON=function(Q,ae,me){return br.call(this,Q,ae,me)};var kt=function(Q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=Q.length,this._features=Q};kt.prototype.feature=function(Q){return new lr(this._features[Q])};var zt=y.vectorTile.VectorTileFeature,Pr=re;function re(Q,ae){this.options=ae||{},this.features=Q,this.length=Q.length}function yr(Q,ae){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=ae||4096}re.prototype.feature=function(Q){return new yr(this.features[Q],this.options.extent)},yr.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var ae=0;ae<Q.length;ae++){for(var me=Q[ae],ke=[],qe=0;qe<me.length;qe++)ke.push(new y.Point$1(me[qe][0],me[qe][1]));this.geometry.push(ke)}return this.geometry},yr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,ae=1/0,me=-1/0,ke=1/0,qe=-1/0,st=0;st<Q.length;st++)for(var xt=Q[st],Me=0;Me<xt.length;Me++){var it=xt[Me];ae=Math.min(ae,it.x),me=Math.max(me,it.x),ke=Math.min(ke,it.y),qe=Math.max(qe,it.y)}return[ae,ke,me,qe]},yr.prototype.toGeoJSON=zt.prototype.toGeoJSON;var Rt=Kt,_t=Pr;function Kt(Q){var ae=new y.pbf;return function(me,ke){for(var qe in me.layers)ke.writeMessage(3,Ue,me.layers[qe])}(Q,ae),ae.finish()}function Ue(Q,ae){var me;ae.writeVarintField(15,Q.version||1),ae.writeStringField(1,Q.name||""),ae.writeVarintField(5,Q.extent||4096);var ke={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<Q.length;me++)ke.feature=Q.feature(me),ae.writeMessage(2,Er,ke);var qe=ke.keys;for(me=0;me<qe.length;me++)ae.writeStringField(3,qe[me]);var st=ke.values;for(me=0;me<st.length;me++)ae.writeMessage(4,_e,st[me])}function Er(Q,ae){var me=Q.feature;me.id!==void 0&&ae.writeVarintField(1,me.id),ae.writeMessage(2,an,Q),ae.writeVarintField(3,me.type),ae.writeMessage(4,Z,me)}function an(Q,ae){var me=Q.feature,ke=Q.keys,qe=Q.values,st=Q.keycache,xt=Q.valuecache;for(var Me in me.properties){var it=st[Me];it===void 0&&(ke.push(Me),st[Me]=it=ke.length-1),ae.writeVarint(it);var Gt=me.properties[Me],Zr=typeof Gt;Zr!=="string"&&Zr!=="boolean"&&Zr!=="number"&&(Gt=JSON.stringify(Gt));var or=Zr+":"+Gt,hr=xt[or];hr===void 0&&(qe.push(Gt),xt[or]=hr=qe.length-1),ae.writeVarint(hr)}}function ue(Q,ae){return(ae<<3)+(7&Q)}function rt(Q){return Q<<1^Q>>31}function Z(Q,ae){for(var me=Q.loadGeometry(),ke=Q.type,qe=0,st=0,xt=me.length,Me=0;Me<xt;Me++){var it=me[Me],Gt=1;ke===1&&(Gt=it.length),ae.writeVarint(ue(1,Gt));for(var Zr=ke===3?it.length-1:it.length,or=0;or<Zr;or++){or===1&&ke!==1&&ae.writeVarint(ue(2,Zr-1));var hr=it[or].x-qe,jr=it[or].y-st;ae.writeVarint(rt(hr)),ae.writeVarint(rt(jr)),qe+=hr,st+=jr}ke===3&&ae.writeVarint(ue(7,1))}}function _e(Q,ae){var me=typeof Q;me==="string"?ae.writeStringField(1,Q):me==="boolean"?ae.writeBooleanField(7,Q):me==="number"&&(Q%1!=0?ae.writeDoubleField(3,Q):Q<0?ae.writeSVarintField(6,Q):ae.writeVarintField(5,Q))}function ze(Q,ae,me,ke){St(Q,me,ke),St(ae,2*me,2*ke),St(ae,2*me+1,2*ke+1)}function St(Q,ae,me){var ke=Q[ae];Q[ae]=Q[me],Q[me]=ke}function Ut(Q,ae,me,ke){var qe=Q-me,st=ae-ke;return qe*qe+st*st}Rt.fromVectorTileJs=Kt,Rt.fromGeojsonVt=function(Q,ae){ae=ae||{};var me={};for(var ke in Q)me[ke]=new Pr(Q[ke].features,ae),me[ke].name=ke,me[ke].version=ae.version,me[ke].extent=ae.extent;return Kt({layers:me})},Rt.GeoJSONWrapper=_t;var cr=function(Q){return Q[0]},wt=function(Q){return Q[1]},Or=function(Q,ae,me,ke,qe){ae===void 0&&(ae=cr),me===void 0&&(me=wt),ke===void 0&&(ke=64),qe===void 0&&(qe=Float64Array),this.nodeSize=ke,this.points=Q;for(var st=Q.length<65536?Uint16Array:Uint32Array,xt=this.ids=new st(Q.length),Me=this.coords=new qe(2*Q.length),it=0;it<Q.length;it++)xt[it]=it,Me[2*it]=ae(Q[it]),Me[2*it+1]=me(Q[it]);(function Gt(Zr,or,hr,jr,oi,Sn){if(!(oi-jr<=hr)){var Jt=jr+oi>>1;(function Hn(wn,Tn,sa,Ir,qi,La){for(;qi>Ir;){if(qi-Ir>600){var na=qi-Ir+1,pa=sa-Ir+1,Lt=Math.log(na),At=.5*Math.exp(2*Lt/3),Qi=.5*Math.sqrt(Lt*At*(na-At)/na)*(pa-na/2<0?-1:1);Hn(wn,Tn,sa,Math.max(Ir,Math.floor(sa-pa*At/na+Qi)),Math.min(qi,Math.floor(sa+(na-pa)*At/na+Qi)),La)}var fo=Tn[2*sa+La],Ba=Ir,zi=qi;for(ze(wn,Tn,Ir,sa),Tn[2*qi+La]>fo&&ze(wn,Tn,Ir,qi);Ba<zi;){for(ze(wn,Tn,Ba,zi),Ba++,zi--;Tn[2*Ba+La]<fo;)Ba++;for(;Tn[2*zi+La]>fo;)zi--}Tn[2*Ir+La]===fo?ze(wn,Tn,Ir,zi):ze(wn,Tn,++zi,qi),zi<=sa&&(Ir=zi+1),sa<=zi&&(qi=zi-1)}})(Zr,or,Jt,jr,oi,Sn%2),Gt(Zr,or,hr,jr,Jt-1,Sn+1),Gt(Zr,or,hr,Jt+1,oi,Sn+1)}})(xt,Me,ke,0,xt.length-1,0)};Or.prototype.range=function(Q,ae,me,ke){return function(qe,st,xt,Me,it,Gt,Zr){for(var or,hr,jr=[0,qe.length-1,0],oi=[];jr.length;){var Sn=jr.pop(),Jt=jr.pop(),Hn=jr.pop();if(Jt-Hn<=Zr)for(var wn=Hn;wn<=Jt;wn++)hr=st[2*wn+1],(or=st[2*wn])>=xt&&or<=it&&hr>=Me&&hr<=Gt&&oi.push(qe[wn]);else{var Tn=Math.floor((Hn+Jt)/2);hr=st[2*Tn+1],(or=st[2*Tn])>=xt&&or<=it&&hr>=Me&&hr<=Gt&&oi.push(qe[Tn]);var sa=(Sn+1)%2;(Sn===0?xt<=or:Me<=hr)&&(jr.push(Hn),jr.push(Tn-1),jr.push(sa)),(Sn===0?it>=or:Gt>=hr)&&(jr.push(Tn+1),jr.push(Jt),jr.push(sa))}}return oi}(this.ids,this.coords,Q,ae,me,ke,this.nodeSize)},Or.prototype.within=function(Q,ae,me){return function(ke,qe,st,xt,Me,it){for(var Gt=[0,ke.length-1,0],Zr=[],or=Me*Me;Gt.length;){var hr=Gt.pop(),jr=Gt.pop(),oi=Gt.pop();if(jr-oi<=it)for(var Sn=oi;Sn<=jr;Sn++)Ut(qe[2*Sn],qe[2*Sn+1],st,xt)<=or&&Zr.push(ke[Sn]);else{var Jt=Math.floor((oi+jr)/2),Hn=qe[2*Jt],wn=qe[2*Jt+1];Ut(Hn,wn,st,xt)<=or&&Zr.push(ke[Jt]);var Tn=(hr+1)%2;(hr===0?st-Me<=Hn:xt-Me<=wn)&&(Gt.push(oi),Gt.push(Jt-1),Gt.push(Tn)),(hr===0?st+Me>=Hn:xt+Me>=wn)&&(Gt.push(Jt+1),Gt.push(jr),Gt.push(Tn))}}return Zr}(this.ids,this.coords,Q,ae,me,this.nodeSize)};var Xn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Q){return Q}},Qr=function(Q){this.options=Ma(Object.create(Xn),Q),this.trees=new Array(this.options.maxZoom+1)};function Pi(Q,ae,me,ke,qe){return{x:Q,y:ae,zoom:1/0,id:me,parentId:-1,numPoints:ke,properties:qe}}function mi(Q,ae){var me=Q.geometry.coordinates,ke=me[1];return{x:ua(me[0]),y:Li(ke),zoom:1/0,index:ae,parentId:-1}}function ln(Q){return{type:"Feature",id:Q.id,properties:ba(Q),geometry:{type:"Point",coordinates:[(ke=Q.x,360*(ke-.5)),(ae=Q.y,me=(180-360*ae)*Math.PI/180,360*Math.atan(Math.exp(me))/Math.PI-90)]}};var ae,me,ke}function ba(Q){var ae=Q.numPoints,me=ae>=1e4?Math.round(ae/1e3)+"k":ae>=1e3?Math.round(ae/100)/10+"k":ae;return Ma(Ma({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:ae,point_count_abbreviated:me})}function ua(Q){return Q/360+.5}function Li(Q){var ae=Math.sin(Q*Math.PI/180),me=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return me<0?0:me>1?1:me}function Ma(Q,ae){for(var me in ae)Q[me]=ae[me];return Q}function ai(Q){return Q.x}function Ki(Q){return Q.y}function ci(Q,ae,me,ke,qe,st){var xt=qe-me,Me=st-ke;if(xt!==0||Me!==0){var it=((Q-me)*xt+(ae-ke)*Me)/(xt*xt+Me*Me);it>1?(me=qe,ke=st):it>0&&(me+=xt*it,ke+=Me*it)}return(xt=Q-me)*xt+(Me=ae-ke)*Me}function gi(Q,ae,me,ke){var qe={id:Q===void 0?null:Q,type:ae,geometry:me,tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(st){var xt=st.geometry,Me=st.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")zo(st,xt);else if(Me==="Polygon"||Me==="MultiLineString")for(var it=0;it<xt.length;it++)zo(st,xt[it]);else if(Me==="MultiPolygon")for(it=0;it<xt.length;it++)for(var Gt=0;Gt<xt[it].length;Gt++)zo(st,xt[it][Gt])}(qe),qe}function zo(Q,ae){for(var me=0;me<ae.length;me+=3)Q.minX=Math.min(Q.minX,ae[me]),Q.minY=Math.min(Q.minY,ae[me+1]),Q.maxX=Math.max(Q.maxX,ae[me]),Q.maxY=Math.max(Q.maxY,ae[me+1])}function go(Q,ae,me,ke){if(ae.geometry){var qe=ae.geometry.coordinates,st=ae.geometry.type,xt=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),Me=[],it=ae.id;if(me.promoteId?it=ae.properties[me.promoteId]:me.generateId&&(it=ke||0),st==="Point")no(qe,Me);else if(st==="MultiPoint")for(var Gt=0;Gt<qe.length;Gt++)no(qe[Gt],Me);else if(st==="LineString")It(qe,Me,xt,!1);else if(st==="MultiLineString"){if(me.lineMetrics){for(Gt=0;Gt<qe.length;Gt++)It(qe[Gt],Me=[],xt,!1),Q.push(gi(it,"LineString",Me,ae.properties));return}ge(qe,Me,xt,!1)}else if(st==="Polygon")ge(qe,Me,xt,!0);else{if(st!=="MultiPolygon"){if(st==="GeometryCollection"){for(Gt=0;Gt<ae.geometry.geometries.length;Gt++)go(Q,{id:it,geometry:ae.geometry.geometries[Gt],properties:ae.properties},me,ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Gt=0;Gt<qe.length;Gt++){var Zr=[];ge(qe[Gt],Zr,xt,!0),Me.push(Zr)}}Q.push(gi(it,st,Me,ae.properties))}}function no(Q,ae){ae.push(oe(Q[0])),ae.push(Te(Q[1])),ae.push(0)}function It(Q,ae,me,ke){for(var qe,st,xt=0,Me=0;Me<Q.length;Me++){var it=oe(Q[Me][0]),Gt=Te(Q[Me][1]);ae.push(it),ae.push(Gt),ae.push(0),Me>0&&(xt+=ke?(qe*Gt-it*st)/2:Math.sqrt(Math.pow(it-qe,2)+Math.pow(Gt-st,2))),qe=it,st=Gt}var Zr=ae.length-3;ae[2]=1,function or(hr,jr,oi,Sn){for(var Jt,Hn=Sn,wn=oi-jr>>1,Tn=oi-jr,sa=hr[jr],Ir=hr[jr+1],qi=hr[oi],La=hr[oi+1],na=jr+3;na<oi;na+=3){var pa=ci(hr[na],hr[na+1],sa,Ir,qi,La);if(pa>Hn)Jt=na,Hn=pa;else if(pa===Hn){var Lt=Math.abs(na-wn);Lt<Tn&&(Jt=na,Tn=Lt)}}Hn>Sn&&(Jt-jr>3&&or(hr,jr,Jt,Sn),hr[Jt+2]=Hn,oi-Jt>3&&or(hr,Jt,oi,Sn))}(ae,0,Zr,me),ae[Zr+2]=1,ae.size=Math.abs(xt),ae.start=0,ae.end=ae.size}function ge(Q,ae,me,ke){for(var qe=0;qe<Q.length;qe++){var st=[];It(Q[qe],st,me,ke),ae.push(st)}}function oe(Q){return Q/360+.5}function Te(Q){var ae=Math.sin(Q*Math.PI/180),me=.5-.25*Math.log((1+ae)/(1-ae))/Math.PI;return me<0?0:me>1?1:me}function j(Q,ae,me,ke,qe,st,xt,Me){if(ke/=ae,st>=(me/=ae)&&xt<ke)return Q;if(xt<me||st>=ke)return null;for(var it=[],Gt=0;Gt<Q.length;Gt++){var Zr=Q[Gt],or=Zr.geometry,hr=Zr.type,jr=qe===0?Zr.minX:Zr.minY,oi=qe===0?Zr.maxX:Zr.maxY;if(jr>=me&&oi<ke)it.push(Zr);else if(!(oi<me||jr>=ke)){var Sn=[];if(hr==="Point"||hr==="MultiPoint")ot(or,Sn,me,ke,qe);else if(hr==="LineString")sr(or,Sn,me,ke,qe,!1,Me.lineMetrics);else if(hr==="MultiLineString")Ke(or,Sn,me,ke,qe,!1);else if(hr==="Polygon")Ke(or,Sn,me,ke,qe,!0);else if(hr==="MultiPolygon")for(var Jt=0;Jt<or.length;Jt++){var Hn=[];Ke(or[Jt],Hn,me,ke,qe,!0),Hn.length&&Sn.push(Hn)}if(Sn.length){if(Me.lineMetrics&&hr==="LineString"){for(Jt=0;Jt<Sn.length;Jt++)it.push(gi(Zr.id,hr,Sn[Jt],Zr.tags));continue}hr!=="LineString"&&hr!=="MultiLineString"||(Sn.length===1?(hr="LineString",Sn=Sn[0]):hr="MultiLineString"),hr!=="Point"&&hr!=="MultiPoint"||(hr=Sn.length===3?"Point":"MultiPoint"),it.push(gi(Zr.id,hr,Sn,Zr.tags))}}}return it.length?it:null}function ot(Q,ae,me,ke,qe){for(var st=0;st<Q.length;st+=3){var xt=Q[st+qe];xt>=me&&xt<=ke&&(ae.push(Q[st]),ae.push(Q[st+1]),ae.push(Q[st+2]))}}function sr(Q,ae,me,ke,qe,st,xt){for(var Me,it,Gt=Yr(Q),Zr=qe===0?Cr:_r,or=Q.start,hr=0;hr<Q.length-3;hr+=3){var jr=Q[hr],oi=Q[hr+1],Sn=Q[hr+2],Jt=Q[hr+3],Hn=Q[hr+4],wn=qe===0?jr:oi,Tn=qe===0?Jt:Hn,sa=!1;xt&&(Me=Math.sqrt(Math.pow(jr-Jt,2)+Math.pow(oi-Hn,2))),wn<me?Tn>me&&(it=Zr(Gt,jr,oi,Jt,Hn,me),xt&&(Gt.start=or+Me*it)):wn>ke?Tn<ke&&(it=Zr(Gt,jr,oi,Jt,Hn,ke),xt&&(Gt.start=or+Me*it)):Dt(Gt,jr,oi,Sn),Tn<me&&wn>=me&&(it=Zr(Gt,jr,oi,Jt,Hn,me),sa=!0),Tn>ke&&wn<=ke&&(it=Zr(Gt,jr,oi,Jt,Hn,ke),sa=!0),!st&&sa&&(xt&&(Gt.end=or+Me*it),ae.push(Gt),Gt=Yr(Q)),xt&&(or+=Me)}var Ir=Q.length-3;jr=Q[Ir],oi=Q[Ir+1],Sn=Q[Ir+2],(wn=qe===0?jr:oi)>=me&&wn<=ke&&Dt(Gt,jr,oi,Sn),Ir=Gt.length-3,st&&Ir>=3&&(Gt[Ir]!==Gt[0]||Gt[Ir+1]!==Gt[1])&&Dt(Gt,Gt[0],Gt[1],Gt[2]),Gt.length&&ae.push(Gt)}function Yr(Q){var ae=[];return ae.size=Q.size,ae.start=Q.start,ae.end=Q.end,ae}function Ke(Q,ae,me,ke,qe,st){for(var xt=0;xt<Q.length;xt++)sr(Q[xt],ae,me,ke,qe,st,!1)}function Dt(Q,ae,me,ke){Q.push(ae),Q.push(me),Q.push(ke)}function Cr(Q,ae,me,ke,qe,st){var xt=(st-ae)/(ke-ae);return Q.push(st),Q.push(me+(qe-me)*xt),Q.push(1),xt}function _r(Q,ae,me,ke,qe,st){var xt=(st-me)/(qe-me);return Q.push(ae+(ke-ae)*xt),Q.push(st),Q.push(1),xt}function Rr(Q,ae){for(var me=[],ke=0;ke<Q.length;ke++){var qe,st=Q[ke],xt=st.type;if(xt==="Point"||xt==="MultiPoint"||xt==="LineString")qe=mn(st.geometry,ae);else if(xt==="MultiLineString"||xt==="Polygon"){qe=[];for(var Me=0;Me<st.geometry.length;Me++)qe.push(mn(st.geometry[Me],ae))}else if(xt==="MultiPolygon")for(qe=[],Me=0;Me<st.geometry.length;Me++){for(var it=[],Gt=0;Gt<st.geometry[Me].length;Gt++)it.push(mn(st.geometry[Me][Gt],ae));qe.push(it)}me.push(gi(st.id,xt,qe,st.tags))}return me}function mn(Q,ae){var me=[];me.size=Q.size,Q.start!==void 0&&(me.start=Q.start,me.end=Q.end);for(var ke=0;ke<Q.length;ke+=3)me.push(Q[ke]+ae,Q[ke+1],Q[ke+2]);return me}function vi(Q,ae){if(Q.transformed)return Q;var me,ke,qe,st=1<<Q.z,xt=Q.x,Me=Q.y;for(me=0;me<Q.features.length;me++){var it=Q.features[me],Gt=it.geometry,Zr=it.type;if(it.geometry=[],Zr===1)for(ke=0;ke<Gt.length;ke+=2)it.geometry.push(ni(Gt[ke],Gt[ke+1],ae,st,xt,Me));else for(ke=0;ke<Gt.length;ke++){var or=[];for(qe=0;qe<Gt[ke].length;qe+=2)or.push(ni(Gt[ke][qe],Gt[ke][qe+1],ae,st,xt,Me));it.geometry.push(or)}}return Q.transformed=!0,Q}function ni(Q,ae,me,ke,qe,st){return[Math.round(me*(Q*ke-qe)),Math.round(me*(ae*ke-st))]}function bn(Q,ae,me,ke,qe){for(var st=ae===qe.maxZoom?0:qe.tolerance/((1<<ae)*qe.extent),xt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:ke,z:ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<Q.length;Me++){xt.numFeatures++,Oi(xt,Q[Me],st,qe);var it=Q[Me].minX,Gt=Q[Me].minY,Zr=Q[Me].maxX,or=Q[Me].maxY;it<xt.minX&&(xt.minX=it),Gt<xt.minY&&(xt.minY=Gt),Zr>xt.maxX&&(xt.maxX=Zr),or>xt.maxY&&(xt.maxY=or)}return xt}function Oi(Q,ae,me,ke){var qe=ae.geometry,st=ae.type,xt=[];if(st==="Point"||st==="MultiPoint")for(var Me=0;Me<qe.length;Me+=3)xt.push(qe[Me]),xt.push(qe[Me+1]),Q.numPoints++,Q.numSimplified++;else if(st==="LineString")Ni(xt,qe,Q,me,!1,!1);else if(st==="MultiLineString"||st==="Polygon")for(Me=0;Me<qe.length;Me++)Ni(xt,qe[Me],Q,me,st==="Polygon",Me===0);else if(st==="MultiPolygon")for(var it=0;it<qe.length;it++){var Gt=qe[it];for(Me=0;Me<Gt.length;Me++)Ni(xt,Gt[Me],Q,me,!0,Me===0)}if(xt.length){var Zr=ae.tags||null;if(st==="LineString"&&ke.lineMetrics){for(var or in Zr={},ae.tags)Zr[or]=ae.tags[or];Zr.mapbox_clip_start=qe.start/qe.size,Zr.mapbox_clip_end=qe.end/qe.size}var hr={geometry:xt,type:st==="Polygon"||st==="MultiPolygon"?3:st==="LineString"||st==="MultiLineString"?2:1,tags:Zr};ae.id!==null&&(hr.id=ae.id),Q.features.push(hr)}}function Ni(Q,ae,me,ke,qe,st){var xt=ke*ke;if(ke>0&&ae.size<(qe?xt:ke))me.numPoints+=ae.length/3;else{for(var Me=[],it=0;it<ae.length;it+=3)(ke===0||ae[it+2]>xt)&&(me.numSimplified++,Me.push(ae[it]),Me.push(ae[it+1])),me.numPoints++;qe&&function(Gt,Zr){for(var or=0,hr=0,jr=Gt.length,oi=jr-2;hr<jr;oi=hr,hr+=2)or+=(Gt[hr]-Gt[oi])*(Gt[hr+1]+Gt[oi+1]);if(or>0===Zr)for(hr=0,jr=Gt.length;hr<jr/2;hr+=2){var Sn=Gt[hr],Jt=Gt[hr+1];Gt[hr]=Gt[jr-2-hr],Gt[hr+1]=Gt[jr-1-hr],Gt[jr-2-hr]=Sn,Gt[jr-1-hr]=Jt}}(Me,st),Q.push(Me)}}function Ha(Q,ae){var me=(ae=this.options=function(qe,st){for(var xt in st)qe[xt]=st[xt];return qe}(Object.create(this.options),ae)).debug;if(me&&console.time("preprocess data"),ae.maxZoom<0||ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ae.promoteId&&ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var ke=function(qe,st){var xt=[];if(qe.type==="FeatureCollection")for(var Me=0;Me<qe.features.length;Me++)go(xt,qe.features[Me],st,Me);else go(xt,qe.type==="Feature"?qe:{geometry:qe},st);return xt}(Q,ae);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ae.indexMaxZoom,ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ke=function(qe,st){var xt=st.buffer/st.extent,Me=qe,it=j(qe,1,-1-xt,xt,0,-1,2,st),Gt=j(qe,1,1-xt,2+xt,0,-1,2,st);return(it||Gt)&&(Me=j(qe,1,-xt,1+xt,0,-1,2,st)||[],it&&(Me=Rr(it,1).concat(Me)),Gt&&(Me=Me.concat(Rr(Gt,-1)))),Me}(ke,ae)).length&&this.splitTile(ke,0,0,0),me&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oa(Q,ae,me){return 32*((1<<Q)*me+ae)+Q}function Wa(Q,ae){var me=Q.tileID.canonical;if(!this._geoJSONIndex)return ae(null,null);var ke=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!ke)return ae(null,null);var qe=new kt(ke.features),st=Rt(qe);st.byteOffset===0&&st.byteLength===st.buffer.byteLength||(st=new Uint8Array(st)),ae(null,{vectorTile:qe,rawData:st.buffer})}Qr.prototype.load=function(Q){var ae=this.options,me=ae.log,ke=ae.minZoom,qe=ae.maxZoom,st=ae.nodeSize;me&&console.time("total time");var xt="prepare "+Q.length+" points";me&&console.time(xt),this.points=Q;for(var Me=[],it=0;it<Q.length;it++)Q[it].geometry&&Me.push(mi(Q[it],it));this.trees[qe+1]=new Or(Me,ai,Ki,st,Float32Array),me&&console.timeEnd(xt);for(var Gt=qe;Gt>=ke;Gt--){var Zr=+Date.now();Me=this._cluster(Me,Gt),this.trees[Gt]=new Or(Me,ai,Ki,st,Float32Array),me&&console.log("z%d: %d clusters in %dms",Gt,Me.length,+Date.now()-Zr)}return me&&console.timeEnd("total time"),this},Qr.prototype.getClusters=function(Q,ae){var me=((Q[0]+180)%360+360)%360-180,ke=Math.max(-90,Math.min(90,Q[1])),qe=Q[2]===180?180:((Q[2]+180)%360+360)%360-180,st=Math.max(-90,Math.min(90,Q[3]));if(Q[2]-Q[0]>=360)me=-180,qe=180;else if(me>qe){var xt=this.getClusters([me,ke,180,st],ae),Me=this.getClusters([-180,ke,qe,st],ae);return xt.concat(Me)}for(var it=this.trees[this._limitZoom(ae)],Gt=[],Zr=0,or=it.range(ua(me),Li(st),ua(qe),Li(ke));Zr<or.length;Zr+=1){var hr=it.points[or[Zr]];Gt.push(hr.numPoints?ln(hr):this.points[hr.index])}return Gt},Qr.prototype.getChildren=function(Q){var ae=this._getOriginId(Q),me=this._getOriginZoom(Q),ke="No cluster with the specified id.",qe=this.trees[me];if(!qe)throw new Error(ke);var st=qe.points[ae];if(!st)throw new Error(ke);for(var xt=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Me=[],it=0,Gt=qe.within(st.x,st.y,xt);it<Gt.length;it+=1){var Zr=qe.points[Gt[it]];Zr.parentId===Q&&Me.push(Zr.numPoints?ln(Zr):this.points[Zr.index])}if(Me.length===0)throw new Error(ke);return Me},Qr.prototype.getLeaves=function(Q,ae,me){var ke=[];return this._appendLeaves(ke,Q,ae=ae||10,me=me||0,0),ke},Qr.prototype.getTile=function(Q,ae,me){var ke=this.trees[this._limitZoom(Q)],qe=Math.pow(2,Q),st=this.options,xt=st.radius/st.extent,Me=(me-xt)/qe,it=(me+1+xt)/qe,Gt={features:[]};return this._addTileFeatures(ke.range((ae-xt)/qe,Me,(ae+1+xt)/qe,it),ke.points,ae,me,qe,Gt),ae===0&&this._addTileFeatures(ke.range(1-xt/qe,Me,1,it),ke.points,qe,me,qe,Gt),ae===qe-1&&this._addTileFeatures(ke.range(0,Me,xt/qe,it),ke.points,-1,me,qe,Gt),Gt.features.length?Gt:null},Qr.prototype.getClusterExpansionZoom=function(Q){for(var ae=this._getOriginZoom(Q)-1;ae<=this.options.maxZoom;){var me=this.getChildren(Q);if(ae++,me.length!==1)break;Q=me[0].properties.cluster_id}return ae},Qr.prototype._appendLeaves=function(Q,ae,me,ke,qe){for(var st=0,xt=this.getChildren(ae);st<xt.length;st+=1){var Me=xt[st],it=Me.properties;if(it&&it.cluster?qe+it.point_count<=ke?qe+=it.point_count:qe=this._appendLeaves(Q,it.cluster_id,me,ke,qe):qe<ke?qe++:Q.push(Me),Q.length===me)break}return qe},Qr.prototype._addTileFeatures=function(Q,ae,me,ke,qe,st){for(var xt=0,Me=Q;xt<Me.length;xt+=1){var it=ae[Me[xt]],Gt=it.numPoints,Zr={type:1,geometry:[[Math.round(this.options.extent*(it.x*qe-me)),Math.round(this.options.extent*(it.y*qe-ke))]],tags:Gt?ba(it):this.points[it.index].properties},or=void 0;Gt?or=it.id:this.options.generateId?or=it.index:this.points[it.index].id&&(or=this.points[it.index].id),or!==void 0&&(Zr.id=or),st.features.push(Zr)}},Qr.prototype._limitZoom=function(Q){return Math.max(this.options.minZoom,Math.min(+Q,this.options.maxZoom+1))},Qr.prototype._cluster=function(Q,ae){for(var me=[],ke=this.options,qe=ke.reduce,st=ke.minPoints,xt=ke.radius/(ke.extent*Math.pow(2,ae)),Me=0;Me<Q.length;Me++){var it=Q[Me];if(!(it.zoom<=ae)){it.zoom=ae;for(var Gt=this.trees[ae+1],Zr=Gt.within(it.x,it.y,xt),or=it.numPoints||1,hr=or,jr=0,oi=Zr;jr<oi.length;jr+=1){var Sn=Gt.points[oi[jr]];Sn.zoom>ae&&(hr+=Sn.numPoints||1)}if(hr>=st){for(var Jt=it.x*or,Hn=it.y*or,wn=qe&&or>1?this._map(it,!0):null,Tn=(Me<<5)+(ae+1)+this.points.length,sa=0,Ir=Zr;sa<Ir.length;sa+=1){var qi=Gt.points[Ir[sa]];if(!(qi.zoom<=ae)){qi.zoom=ae;var La=qi.numPoints||1;Jt+=qi.x*La,Hn+=qi.y*La,qi.parentId=Tn,qe&&(wn||(wn=this._map(it,!0)),qe(wn,this._map(qi)))}}it.parentId=Tn,me.push(Pi(Jt/hr,Hn/hr,Tn,hr,wn))}else if(me.push(it),hr>1)for(var na=0,pa=Zr;na<pa.length;na+=1){var Lt=Gt.points[pa[na]];Lt.zoom<=ae||(Lt.zoom=ae,me.push(Lt))}}}return me},Qr.prototype._getOriginId=function(Q){return Q-this.points.length>>5},Qr.prototype._getOriginZoom=function(Q){return(Q-this.points.length)%32},Qr.prototype._map=function(Q,ae){if(Q.numPoints)return ae?Ma({},Q.properties):Q.properties;var me=this.points[Q.index].properties,ke=this.options.map(me);return ae&&ke===me?Ma({},ke):ke},Ha.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ha.prototype.splitTile=function(Q,ae,me,ke,qe,st,xt){for(var Me=[Q,ae,me,ke],it=this.options,Gt=it.debug;Me.length;){ke=Me.pop(),me=Me.pop(),ae=Me.pop(),Q=Me.pop();var Zr=1<<ae,or=oa(ae,me,ke),hr=this.tiles[or];if(!hr&&(Gt>1&&console.time("creation"),hr=this.tiles[or]=bn(Q,ae,me,ke,it),this.tileCoords.push({z:ae,x:me,y:ke}),Gt)){Gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ae,me,ke,hr.numFeatures,hr.numPoints,hr.numSimplified),console.timeEnd("creation"));var jr="z"+ae;this.stats[jr]=(this.stats[jr]||0)+1,this.total++}if(hr.source=Q,qe){if(ae===it.maxZoom||ae===qe)continue;var oi=1<<qe-ae;if(me!==Math.floor(st/oi)||ke!==Math.floor(xt/oi))continue}else if(ae===it.indexMaxZoom||hr.numPoints<=it.indexMaxPoints)continue;if(hr.source=null,Q.length!==0){Gt>1&&console.time("clipping");var Sn,Jt,Hn,wn,Tn,sa,Ir=.5*it.buffer/it.extent,qi=.5-Ir,La=.5+Ir,na=1+Ir;Sn=Jt=Hn=wn=null,Tn=j(Q,Zr,me-Ir,me+La,0,hr.minX,hr.maxX,it),sa=j(Q,Zr,me+qi,me+na,0,hr.minX,hr.maxX,it),Q=null,Tn&&(Sn=j(Tn,Zr,ke-Ir,ke+La,1,hr.minY,hr.maxY,it),Jt=j(Tn,Zr,ke+qi,ke+na,1,hr.minY,hr.maxY,it),Tn=null),sa&&(Hn=j(sa,Zr,ke-Ir,ke+La,1,hr.minY,hr.maxY,it),wn=j(sa,Zr,ke+qi,ke+na,1,hr.minY,hr.maxY,it),sa=null),Gt>1&&console.timeEnd("clipping"),Me.push(Sn||[],ae+1,2*me,2*ke),Me.push(Jt||[],ae+1,2*me,2*ke+1),Me.push(Hn||[],ae+1,2*me+1,2*ke),Me.push(wn||[],ae+1,2*me+1,2*ke+1)}}},Ha.prototype.getTile=function(Q,ae,me){var ke=this.options,qe=ke.extent,st=ke.debug;if(Q<0||Q>24)return null;var xt=1<<Q,Me=oa(Q,ae=(ae%xt+xt)%xt,me);if(this.tiles[Me])return vi(this.tiles[Me],qe);st>1&&console.log("drilling down to z%d-%d-%d",Q,ae,me);for(var it,Gt=Q,Zr=ae,or=me;!it&&Gt>0;)Gt--,Zr=Math.floor(Zr/2),or=Math.floor(or/2),it=this.tiles[oa(Gt,Zr,or)];return it&&it.source?(st>1&&console.log("found parent tile z%d-%d-%d",Gt,Zr,or),st>1&&console.time("drilling down"),this.splitTile(it.source,Gt,Zr,or,Q,ae,me),st>1&&console.timeEnd("drilling down"),this.tiles[Me]?vi(this.tiles[Me],qe):null):null};var Ci=function(Q){function ae(me,ke,qe,st){Q.call(this,me,ke,qe,Wa),st&&(this.loadGeoJSON=st)}return Q&&(ae.__proto__=Q),(ae.prototype=Object.create(Q&&Q.prototype)).constructor=ae,ae.prototype.loadData=function(me,ke){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ke,this._pendingLoadDataParams=me,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ae.prototype._loadData=function(){var me=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ke=this._pendingCallback,qe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var st=!!(qe&&qe.request&&qe.request.collectResourceTiming)&&new y.RequestPerformance(qe.request);this.loadGeoJSON(qe,function(xt,Me){if(xt||!Me)return ke(xt);if(typeof Me!="object")return ke(new Error("Input data given to '"+qe.source+"' is not a valid GeoJSON object."));(function hr(jr,oi){var Sn,Jt=jr&&jr.type;if(Jt==="FeatureCollection")for(Sn=0;Sn<jr.features.length;Sn++)hr(jr.features[Sn],oi);else if(Jt==="GeometryCollection")for(Sn=0;Sn<jr.geometries.length;Sn++)hr(jr.geometries[Sn],oi);else if(Jt==="Feature")hr(jr.geometry,oi);else if(Jt==="Polygon")Yt(jr.coordinates,oi);else if(Jt==="MultiPolygon")for(Sn=0;Sn<jr.coordinates.length;Sn++)Yt(jr.coordinates[Sn],oi);return jr})(Me,!0);try{if(qe.filter){var it=y.createExpression(qe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(it.result==="error")throw new Error(it.value.map(function(hr){return hr.key+": "+hr.message}).join(", "));var Gt=Me.features.filter(function(hr){return it.value.evaluate({zoom:0},hr)});Me={type:"FeatureCollection",features:Gt}}me._geoJSONIndex=qe.cluster?new Qr(function(hr){var jr=hr.superclusterOptions,oi=hr.clusterProperties;if(!oi||!jr)return jr;for(var Sn={},Jt={},Hn={accumulated:null,zoom:0},wn={properties:null},Tn=Object.keys(oi),sa=0,Ir=Tn;sa<Ir.length;sa+=1){var qi=Ir[sa],La=oi[qi],na=La[0],pa=y.createExpression(La[1]),Lt=y.createExpression(typeof na=="string"?[na,["accumulated"],["get",qi]]:na);Sn[qi]=pa.value,Jt[qi]=Lt.value}return jr.map=function(At){wn.properties=At;for(var Qi={},fo=0,Ba=Tn;fo<Ba.length;fo+=1){var zi=Ba[fo];Qi[zi]=Sn[zi].evaluate(Hn,wn)}return Qi},jr.reduce=function(At,Qi){wn.properties=Qi;for(var fo=0,Ba=Tn;fo<Ba.length;fo+=1){var zi=Ba[fo];Hn.accumulated=At[zi],At[zi]=Jt[zi].evaluate(Hn,wn)}},jr}(qe)).load(Me.features):function(hr,jr){return new Ha(hr,jr)}(Me,qe.geojsonVtOptions)}catch(hr){return ke(hr)}me.loaded={};var Zr={};if(st){var or=st.finish();or&&(Zr.resourceTiming={},Zr.resourceTiming[qe.source]=JSON.parse(JSON.stringify(or)))}ke(null,Zr)})}},ae.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ae.prototype.reloadTile=function(me,ke){var qe=this.loaded;return qe&&qe[me.uid]?Q.prototype.reloadTile.call(this,me,ke):this.loadTile(me,ke)},ae.prototype.loadGeoJSON=function(me,ke){if(me.request)y.getJSON(me.request,ke);else{if(typeof me.data!="string")return ke(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."));try{return ke(null,JSON.parse(me.data))}catch(qe){return ke(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."))}}},ae.prototype.removeSource=function(me,ke){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ke()},ae.prototype.getClusterExpansionZoom=function(me,ke){try{ke(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(qe){ke(qe)}},ae.prototype.getClusterChildren=function(me,ke){try{ke(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(qe){ke(qe)}},ae.prototype.getClusterLeaves=function(me,ke){try{ke(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(qe){ke(qe)}},ae}(Ct),la=function(Q){var ae=this;this.self=Q,this.actor=new y.Actor(Q,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ct,geojson:Ci},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(me,ke){if(ae.workerSourceTypes[me])throw new Error('Worker source with name "'+me+'" already registered.');ae.workerSourceTypes[me]=ke},this.self.registerRTLTextPlugin=function(me){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=me.applyArabicShaping,y.plugin.processBidirectionalText=me.processBidirectionalText,y.plugin.processStyledBidirectionalText=me.processStyledBidirectionalText}};return la.prototype.setReferrer=function(Q,ae){this.referrer=ae},la.prototype.setImages=function(Q,ae,me){for(var ke in this.availableImages[Q]=ae,this.workerSources[Q]){var qe=this.workerSources[Q][ke];for(var st in qe)qe[st].availableImages=ae}me()},la.prototype.setLayers=function(Q,ae,me){this.getLayerIndex(Q).replace(ae),me()},la.prototype.updateLayers=function(Q,ae,me){this.getLayerIndex(Q).update(ae.layers,ae.removedIds),me()},la.prototype.loadTile=function(Q,ae,me){this.getWorkerSource(Q,ae.type,ae.source).loadTile(ae,me)},la.prototype.loadDEMTile=function(Q,ae,me){this.getDEMWorkerSource(Q,ae.source).loadTile(ae,me)},la.prototype.reloadTile=function(Q,ae,me){this.getWorkerSource(Q,ae.type,ae.source).reloadTile(ae,me)},la.prototype.abortTile=function(Q,ae,me){this.getWorkerSource(Q,ae.type,ae.source).abortTile(ae,me)},la.prototype.removeTile=function(Q,ae,me){this.getWorkerSource(Q,ae.type,ae.source).removeTile(ae,me)},la.prototype.removeDEMTile=function(Q,ae){this.getDEMWorkerSource(Q,ae.source).removeTile(ae)},la.prototype.removeSource=function(Q,ae,me){if(this.workerSources[Q]&&this.workerSources[Q][ae.type]&&this.workerSources[Q][ae.type][ae.source]){var ke=this.workerSources[Q][ae.type][ae.source];delete this.workerSources[Q][ae.type][ae.source],ke.removeSource!==void 0?ke.removeSource(ae,me):me()}},la.prototype.loadWorkerSource=function(Q,ae,me){try{this.self.importScripts(ae.url),me()}catch(ke){me(ke.toString())}},la.prototype.syncRTLPluginState=function(Q,ae,me){try{y.plugin.setState(ae);var ke=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&ke!=null){this.self.importScripts(ke);var qe=y.plugin.isParsed();me(qe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ke),qe)}}catch(st){me(st.toString())}},la.prototype.getAvailableImages=function(Q){var ae=this.availableImages[Q];return ae||(ae=[]),ae},la.prototype.getLayerIndex=function(Q){var ae=this.layerIndexes[Q];return ae||(ae=this.layerIndexes[Q]=new Re),ae},la.prototype.getWorkerSource=function(Q,ae,me){var ke=this;return this.workerSources[Q]||(this.workerSources[Q]={}),this.workerSources[Q][ae]||(this.workerSources[Q][ae]={}),this.workerSources[Q][ae][me]||(this.workerSources[Q][ae][me]=new this.workerSourceTypes[ae]({send:function(qe,st,xt){ke.actor.send(qe,st,xt,Q)}},this.getLayerIndex(Q),this.getAvailableImages(Q))),this.workerSources[Q][ae][me]},la.prototype.getDEMWorkerSource=function(Q,ae){return this.demWorkerSources[Q]||(this.demWorkerSources[Q]={}),this.demWorkerSources[Q][ae]||(this.demWorkerSources[Q][ae]=new tr),this.demWorkerSources[Q][ae]},la.prototype.enforceCacheSizeLimit=function(Q,ae){y.enforceCacheSizeLimit(ae)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new la(self)),la}),de(["./shared"],function(y){"use strict";var Ne=y.createCommonjsModule(function(c){function h(S){return!f(S)}function f(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,z,W=new Blob([""],{type:"text/javascript"}),te=URL.createObjectURL(W);try{z=new Worker(te),R=!0}catch(be){R=!1}return z&&z.terminate(),URL.revokeObjectURL(te),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var z=R.getContext("2d");if(!z)return!1;var W=z.getImageData(0,0,1,1);return W&&W.width===R.width}()?(m[I=S&&S.failIfMajorPerformanceCaveat]===void 0&&(m[I]=function(R){var z=function(te){var be=document.createElement("canvas"),Se=Object.create(h.webGLContextAttributes);return Se.failIfMajorPerformanceCaveat=te,be.probablySupportsContext?be.probablySupportsContext("webgl",Se)||be.probablySupportsContext("experimental-webgl",Se):be.supportsContext?be.supportsContext("webgl",Se)||be.supportsContext("experimental-webgl",Se):be.getContext("webgl",Se)||be.getContext("experimental-webgl",Se)}(R);if(!z)return!1;var W=z.createShader(z.VERTEX_SHADER);return!(!W||z.isContextLost())&&(z.shaderSource(W,"void main() {}"),z.compileShader(W),z.getShaderParameter(W,z.COMPILE_STATUS)===!0)}(I)),m[I]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var I}c.exports?c.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=f);var m={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),K={create:function(c,h,f){var m=y.window.document.createElement(c);return h!==void 0&&(m.className=h),f&&f.appendChild(m),m},createNS:function(c,h){return y.window.document.createElementNS(c,h)}},Re=y.window.document&&y.window.document.documentElement.style;function pe(c){if(!Re)return c[0];for(var h=0;h<c.length;h++)if(c[h]in Re)return c[h];return c[0]}var lt,we=pe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);K.disableDrag=function(){Re&&we&&(lt=Re[we],Re[we]="none")},K.enableDrag=function(){Re&&we&&(Re[we]=lt)};var Xe=pe(["transform","WebkitTransform"]);K.setTransform=function(c,h){c.style[Xe]=h};var Ct=!1;try{var Pt=Object.defineProperty({},"passive",{get:function(){Ct=!0}});y.window.addEventListener("test",Pt,Pt),y.window.removeEventListener("test",Pt,Pt)}catch(c){Ct=!1}K.addEventListener=function(c,h,f,m){m===void 0&&(m={}),c.addEventListener(h,f,"passive"in m&&Ct?m:m.capture)},K.removeEventListener=function(c,h,f,m){m===void 0&&(m={}),c.removeEventListener(h,f,"passive"in m&&Ct?m:m.capture)};var tr=function(c){c.preventDefault(),c.stopPropagation(),y.window.removeEventListener("click",tr,!0)};function Yt(c){var h=c.userImage;return!!(h&&h.render&&h.render())&&(c.data.replace(new Uint8Array(h.data.buffer)),!0)}K.suppressClick=function(){y.window.addEventListener("click",tr,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",tr,!0)},0)},K.mousePos=function(c,h){var f=c.getBoundingClientRect();return new y.Point(h.clientX-f.left-c.clientLeft,h.clientY-f.top-c.clientTop)},K.touchPos=function(c,h){for(var f=c.getBoundingClientRect(),m=[],S=0;S<h.length;S++)m.push(new y.Point(h[S].clientX-f.left-c.clientLeft,h[S].clientY-f.top-c.clientTop));return m},K.mouseButton=function(c){return y.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},K.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var Wt=function(c){function h(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var m=0,S=this.requestors;m<S.length;m+=1){var I=S[m];this._notify(I.ids,I.callback)}this.requestors=[]}},h.prototype.getImage=function(f){return this.images[f]},h.prototype.addImage=function(f,m){this._validate(f,m)&&(this.images[f]=m)},h.prototype._validate=function(f,m){var S=!0;return this._validateStretch(m.stretchX,m.data&&m.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(m.stretchY,m.data&&m.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),S=!1),this._validateContent(m.content,m)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),S=!1),S},h.prototype._validateStretch=function(f,m){if(!f)return!0;for(var S=0,I=0,R=f;I<R.length;I+=1){var z=R[I];if(z[0]<S||z[1]<z[0]||m<z[1])return!1;S=z[1]}return!0},h.prototype._validateContent=function(f,m){return!(f&&(f.length!==4||f[0]<0||m.data.width<f[0]||f[1]<0||m.data.height<f[1]||f[2]<0||m.data.width<f[2]||f[3]<0||m.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},h.prototype.updateImage=function(f,m){m.version=this.images[f].version+1,this.images[f]=m,this.updatedImages[f]=!0},h.prototype.removeImage=function(f){var m=this.images[f];delete this.images[f],delete this.patterns[f],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(f,m){var S=!0;if(!this.isLoaded())for(var I=0,R=f;I<R.length;I+=1)this.images[R[I]]||(S=!1);this.isLoaded()||S?this._notify(f,m):this.requestors.push({ids:f,callback:m})},h.prototype._notify=function(f,m){for(var S={},I=0,R=f;I<R.length;I+=1){var z=R[I];this.images[z]||this.fire(new y.Event("styleimagemissing",{id:z}));var W=this.images[z];W?S[z]={data:W.data.clone(),pixelRatio:W.pixelRatio,sdf:W.sdf,version:W.version,stretchX:W.stretchX,stretchY:W.stretchY,content:W.content,hasRenderCallback:Boolean(W.userImage&&W.userImage.render)}:y.warnOnce('Image "'+z+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}m(null,S)},h.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},h.prototype.getPattern=function(f){var m=this.patterns[f],S=this.getImage(f);if(!S)return null;if(m&&m.position.version===S.version)return m.position;if(m)m.position.version=S.version;else{var I={w:S.data.width+2,h:S.data.height+2,x:0,y:0},R=new y.ImagePosition(I,S);this.patterns[f]={bin:I,position:R}}return this._updatePatternAtlas(),this.patterns[f].position},h.prototype.bind=function(f){var m=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(f,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var f=[];for(var m in this.patterns)f.push(this.patterns[m].bin);var S=y.potpack(f),I=S.w,R=S.h,z=this.atlasImage;for(var W in z.resize({width:I||1,height:R||1}),this.patterns){var te=this.patterns[W].bin,be=te.x+1,Se=te.y+1,Ie=this.images[W].data,Je=Ie.width,Qe=Ie.height;y.RGBAImage.copy(Ie,z,{x:0,y:0},{x:be,y:Se},{width:Je,height:Qe}),y.RGBAImage.copy(Ie,z,{x:0,y:Qe-1},{x:be,y:Se-1},{width:Je,height:1}),y.RGBAImage.copy(Ie,z,{x:0,y:0},{x:be,y:Se+Qe},{width:Je,height:1}),y.RGBAImage.copy(Ie,z,{x:Je-1,y:0},{x:be-1,y:Se},{width:1,height:Qe}),y.RGBAImage.copy(Ie,z,{x:0,y:0},{x:be+Je,y:Se},{width:1,height:Qe})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(f){for(var m=0,S=f;m<S.length;m+=1){var I=S[m];if(!this.callbackDispatchedThisFrame[I]){this.callbackDispatchedThisFrame[I]=!0;var R=this.images[I];Yt(R)&&this.updateImage(I,R)}}},h}(y.Evented),br=zt,lr=zt,kt=1e20;function zt(c,h,f,m,S,I){this.fontSize=c||24,this.buffer=h===void 0?3:h,this.cutoff=m||.25,this.fontFamily=S||"sans-serif",this.fontWeight=I||"normal",this.radius=f||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Pr(c,h,f,m,S,I,R){for(var z=0;z<h;z++){for(var W=0;W<f;W++)m[W]=c[W*h+z];for(re(m,S,I,R,f),W=0;W<f;W++)c[W*h+z]=S[W]}for(W=0;W<f;W++){for(z=0;z<h;z++)m[z]=c[W*h+z];for(re(m,S,I,R,h),z=0;z<h;z++)c[W*h+z]=Math.sqrt(S[z])}}function re(c,h,f,m,S){f[0]=0,m[0]=-kt,m[1]=+kt;for(var I=1,R=0;I<S;I++){for(var z=(c[I]+I*I-(c[f[R]]+f[R]*f[R]))/(2*I-2*f[R]);z<=m[R];)R--,z=(c[I]+I*I-(c[f[R]]+f[R]*f[R]))/(2*I-2*f[R]);f[++R]=I,m[R]=z,m[R+1]=+kt}for(I=0,R=0;I<S;I++){for(;m[R+1]<I;)R++;h[I]=(I-f[R])*(I-f[R])+c[f[R]]}}zt.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),m=0;m<this.size*this.size;m++){var S=h.data[4*m+3]/255;this.gridOuter[m]=S===1?0:S===0?kt:Math.pow(Math.max(0,.5-S),2),this.gridInner[m]=S===1?kt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Pr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Pr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),m=0;m<this.size*this.size;m++)f[m]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[m]-this.gridInner[m])/this.radius+this.cutoff))));return f},br.default=lr;var yr=function(c,h){this.requestManager=c,this.localIdeographFontFamily=h,this.entries={}};yr.prototype.setURL=function(c){this.url=c},yr.prototype.getGlyphs=function(c,h){var f=this,m=[];for(var S in c)for(var I=0,R=c[S];I<R.length;I+=1)m.push({stack:S,id:R[I]});y.asyncAll(m,function(z,W){var te=z.stack,be=z.id,Se=f.entries[te];Se||(Se=f.entries[te]={glyphs:{},requests:{},ranges:{}});var Ie=Se.glyphs[be];if(Ie===void 0){if(Ie=f._tinySDF(Se,te,be))return Se.glyphs[be]=Ie,void W(null,{stack:te,id:be,glyph:Ie});var Je=Math.floor(be/256);if(256*Je>65535)W(new Error("glyphs > 65535 not supported"));else if(Se.ranges[Je])W(null,{stack:te,id:be,glyph:Ie});else{var Qe=Se.requests[Je];Qe||(Qe=Se.requests[Je]=[],yr.loadGlyphRange(te,Je,f.url,f.requestManager,function(nt,He){if(He){for(var ft in He)f._doesCharSupportLocalGlyph(+ft)||(Se.glyphs[+ft]=He[+ft]);Se.ranges[Je]=!0}for(var Et=0,Ht=Qe;Et<Ht.length;Et+=1)(0,Ht[Et])(nt,He);delete Se.requests[Je]})),Qe.push(function(nt,He){nt?W(nt):He&&W(null,{stack:te,id:be,glyph:He[be]||null})})}}else W(null,{stack:te,id:be,glyph:Ie})},function(z,W){if(z)h(z);else if(W){for(var te={},be=0,Se=W;be<Se.length;be+=1){var Ie=Se[be],Je=Ie.stack,Qe=Ie.id,nt=Ie.glyph;(te[Je]||(te[Je]={}))[Qe]=nt&&{id:nt.id,bitmap:nt.bitmap.clone(),metrics:nt.metrics}}h(null,te)}})},yr.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](c)||y.isChar["Hangul Syllables"](c)||y.isChar.Hiragana(c)||y.isChar.Katakana(c))},yr.prototype._tinySDF=function(c,h,f){var m=this.localIdeographFontFamily;if(m&&this._doesCharSupportLocalGlyph(f)){var S=c.tinySDF;if(!S){var I="400";/bold/i.test(h)?I="900":/medium/i.test(h)?I="500":/light/i.test(h)&&(I="200"),S=c.tinySDF=new yr.TinySDF(24,3,8,.25,m,I)}return{id:f,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},yr.loadGlyphRange=function(c,h,f,m,S){var I=256*h,R=I+255,z=m.transformRequest(m.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",I+"-"+R),y.ResourceType.Glyphs);y.getArrayBuffer(z,function(W,te){if(W)S(W);else if(te){for(var be={},Se=0,Ie=y.parseGlyphPBF(te);Se<Ie.length;Se+=1){var Je=Ie[Se];be[Je.id]=Je}S(null,be)}})},yr.TinySDF=br;var Rt=function(){this.specification=y.styleSpec.light.position};Rt.prototype.possiblyEvaluate=function(c,h){return y.sphericalToCartesian(c.expression.evaluate(h))},Rt.prototype.interpolate=function(c,h,f){return{x:y.number(c.x,h.x,f),y:y.number(c.y,h.y,f),z:y.number(c.z,h.z,f)}};var _t=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Rt,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Kt=function(c){function h(f){c.call(this),this._transitionable=new y.Transitionable(_t),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(f,m){if(m===void 0&&(m={}),!this._validate(y.validateLight,f,m))for(var S in f){var I=f[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),I):this._transitionable.setValue(S,I)}},h.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},h.prototype._validate=function(f,m,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,f.call(y.validateStyle,y.extend({value:m,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},h}(y.Evented),Ue=function(c,h){this.width=c,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ue.prototype.getDash=function(c,h){var f=c.join(",")+String(h);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,h)),this.dashEntry[f]},Ue.prototype.getDashRanges=function(c,h,f){var m=[],S=c.length%2==1?-c[c.length-1]*f:0,I=c[0]*f,R=!0;m.push({left:S,right:I,isDash:R,zeroLength:c[0]===0});for(var z=c[0],W=1;W<c.length;W++){var te=c[W];m.push({left:S=z*f,right:I=(z+=te)*f,isDash:R=!R,zeroLength:te===0})}return m},Ue.prototype.addRoundDash=function(c,h,f){for(var m=h/2,S=-f;S<=f;S++)for(var I=this.width*(this.nextRow+f+S),R=0,z=c[R],W=0;W<this.width;W++){W/z.right>1&&(z=c[++R]);var te=Math.abs(W-z.left),be=Math.abs(W-z.right),Se=Math.min(te,be),Ie=void 0,Je=S/f*(m+1);if(z.isDash){var Qe=m-Math.abs(Je);Ie=Math.sqrt(Se*Se+Qe*Qe)}else Ie=m-Math.sqrt(Se*Se+Je*Je);this.data[I+W]=Math.max(0,Math.min(255,Ie+128))}},Ue.prototype.addRegularDash=function(c){for(var h=c.length-1;h>=0;--h){var f=c[h],m=c[h+1];f.zeroLength?c.splice(h,1):m&&m.isDash===f.isDash&&(m.left=f.left,c.splice(h,1))}var S=c[0],I=c[c.length-1];S.isDash===I.isDash&&(S.left=I.left-this.width,I.right=S.right+this.width);for(var R=this.width*this.nextRow,z=0,W=c[z],te=0;te<this.width;te++){te/W.right>1&&(W=c[++z]);var be=Math.abs(te-W.left),Se=Math.abs(te-W.right),Ie=Math.min(be,Se);this.data[R+te]=Math.max(0,Math.min(255,(W.isDash?Ie:-Ie)+128))}},Ue.prototype.addDash=function(c,h){var f=h?7:0,m=2*f+1;if(this.nextRow+m>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,I=0;I<c.length;I++)S+=c[I];if(S!==0){var R=this.width/S,z=this.getDashRanges(c,this.width,R);h?this.addRoundDash(z,R,f):this.addRegularDash(z)}var W={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:S};return this.nextRow+=m,this.dirty=!0,W},Ue.prototype.bind=function(c){var h=c.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var Er=function c(h,f){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var m=this.workerPool.acquire(this.id),S=0;S<m.length;S++){var I=new c.Actor(m[S],f,this.id);I.name="Worker "+S,this.actors.push(I)}};function an(c,h,f){var m=function(S,I){if(S)return f(S);if(I){var R=y.pick(y.extend(I,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(R.vectorLayers=I.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(z){return z.id})),R.tiles=h.canonicalizeTileset(R,c.url),f(null,R)}};return c.url?y.getJSON(h.transformRequest(h.normalizeSourceURL(c.url),y.ResourceType.Source),m):y.browser.frame(function(){return m(null,c)})}Er.prototype.broadcast=function(c,h,f){y.asyncAll(this.actors,function(m,S){m.send(c,h,S)},f=f||function(){})},Er.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Er.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},Er.Actor=y.Actor;var ue=function(c,h,f){this.bounds=y.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=f||24};ue.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},ue.prototype.contains=function(c){var h=Math.pow(2,c.z),f=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*h),m=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*h),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*h),I=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=f&&c.x<S&&c.y>=m&&c.y<I};var rt=function(c){function h(f,m,S,I){if(c.call(this),this.id=f,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(m,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=an(this._options,this.map._requestManager,function(m,S){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new y.ErrorEvent(m)):S&&(y.extend(f,S),S.bounds&&(f.tileBounds=new ue(S.bounds,f.minzoom,f.maxzoom)),y.postTurnstileEvent(S.tiles,f.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(f){var m=this;return this.setSourceProperty(function(){m._options.tiles=f}),this},h.prototype.setUrl=function(f){var m=this;return this.setSourceProperty(function(){m.url=f,m._options.url=f}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return y.extend({},this._options)},h.prototype.loadTile=function(f,m){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),I={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(z,W){return delete f.request,f.aborted?m(null):z&&z.status!==404?m(z):(W&&W.resourceTiming&&(f.resourceTiming=W.resourceTiming),this.map._refreshExpiredTiles&&W&&f.setExpiryData(W),f.loadVectorData(W,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),m(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}I.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=m:f.request=f.actor.send("reloadTile",I,R.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",I,R.bind(this)))},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(y.Evented),Z=function(c){function h(f,m,S,I){c.call(this),this.id=f,this.dispatcher=S,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},m),y.extend(this,y.pick(m,["url","scheme","tileSize"]))}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=an(this._options,this.map._requestManager,function(m,S){f._tileJSONRequest=null,f._loaded=!0,m?f.fire(new y.ErrorEvent(m)):S&&(y.extend(f,S),S.bounds&&(f.tileBounds=new ue(S.bounds,f.minzoom,f.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return y.extend({},this._options)},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.loadTile=function(f,m){var S=this,I=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=y.getImage(this.map._requestManager.transformRequest(I,y.ResourceType.Tile),function(R,z){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(R)f.state="errored",m(R);else if(z){S.map._refreshExpiredTiles&&f.setExpiryData(z),delete z.cacheControl,delete z.expires;var W=S.map.painter.context,te=W.gl;f.texture=S.map.painter.getTileTexture(z.width),f.texture?f.texture.update(z,{useMipmap:!0}):(f.texture=new y.Texture(W,z,te.RGBA,{useMipmap:!0}),f.texture.bind(te.LINEAR,te.CLAMP_TO_EDGE,te.LINEAR_MIPMAP_NEAREST),W.extTextureFilterAnisotropic&&te.texParameterf(te.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax)),f.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),m(null)}})},h.prototype.abortTile=function(f,m){f.request&&(f.request.cancel(),delete f.request),m()},h.prototype.unloadTile=function(f,m){f.texture&&this.map.painter.saveTileTexture(f.texture),m()},h.prototype.hasTransition=function(){return!1},h}(y.Evented),_e=function(c){function h(f,m,S,I){c.call(this,f,m,S,I),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox"}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(f,m){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function I(R,z){R&&(f.state="errored",m(R)),z&&(f.dem=z,f.needsHillshadePrepare=!0,f.state="loaded",m(null))}f.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(R,z){if(delete f.request,f.aborted)f.state="unloaded",m(null);else if(R)f.state="errored",m(R);else if(z){this.map._refreshExpiredTiles&&f.setExpiryData(z),delete z.cacheControl,delete z.expires;var W=y.window.ImageBitmap&&z instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?z:y.browser.getImageData(z,1),te={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:W,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",te,I.bind(this)))}}.bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},h.prototype._getNeighboringTiles=function(f){var m=f.canonical,S=Math.pow(2,m.z),I=(m.x-1+S)%S,R=m.x===0?f.wrap-1:f.wrap,z=(m.x+1+S)%S,W=m.x+1===S?f.wrap+1:f.wrap,te={};return te[new y.OverscaledTileID(f.overscaledZ,R,m.z,I,m.y).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,W,m.z,z,m.y).key]={backfilled:!1},m.y>0&&(te[new y.OverscaledTileID(f.overscaledZ,R,m.z,I,m.y-1).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,W,m.z,z,m.y-1).key]={backfilled:!1}),m.y+1<S&&(te[new y.OverscaledTileID(f.overscaledZ,R,m.z,I,m.y+1).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,f.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},te[new y.OverscaledTileID(f.overscaledZ,W,m.z,z,m.y+1).key]={backfilled:!1}),te},h.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},h}(Z),ze=function(c){function h(f,m,S,I){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(I),this._data=m.data,this._options=y.extend({},m),this._collectResourceTiming=m.collectResourceTiming,this._resourceTiming=[],m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId;var R=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:(m.buffer!==void 0?m.buffer:128)*R,tolerance:(m.tolerance!==void 0?m.tolerance:.375)*R,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:m.clusterMaxZoom!==void 0?Math.min(m.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,m.clusterMinPoints||2),extent:y.EXTENT,radius:(m.clusterRadius||50)*R,log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(m){if(m)f.fire(new y.ErrorEvent(m));else{var S={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(S.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new y.Event("data",S))}})},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setData=function(f){var m=this;return this._data=f,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)m.fire(new y.ErrorEvent(S));else{var I={dataType:"source",sourceDataType:"content"};m._collectResourceTiming&&m._resourceTiming&&m._resourceTiming.length>0&&(I.resourceTiming=m._resourceTiming,m._resourceTiming=[]),m.fire(new y.Event("data",I))}}),this},h.prototype.getClusterExpansionZoom=function(f,m){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},m),this},h.prototype.getClusterChildren=function(f,m){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},m),this},h.prototype.getClusterLeaves=function(f,m,S,I){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:m,offset:S},I),this},h.prototype._updateWorkerData=function(f){var m=this;this._loaded=!1;var S=y.extend({},this.workerOptions),I=this._data;typeof I=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(I),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(I),this.actor.send(this.type+".loadData",S,function(R,z){m._removed||z&&z.abandoned||(m._loaded=!0,z&&z.resourceTiming&&z.resourceTiming[m.id]&&(m._resourceTiming=z.resourceTiming[m.id].slice(0)),m.actor.send(m.type+".coalesce",{source:S.source},null),f(R))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(f,m){var S=this,I=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(I,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,z){return delete f.request,f.unloadVectorData(),f.aborted?m(null):R?m(R):(f.loadVectorData(z,S.map.painter,I==="reloadTile"),m(null))})},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},h.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(y.Evented),St=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Ut=function(c){function h(f,m,S,I){c.call(this),this.id=f,this.dispatcher=S,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(f,m){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(I,R){S._loaded=!0,I?S.fire(new y.ErrorEvent(I)):R&&(S.image=R,f&&(S.coordinates=f),m&&m(),S._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(f){var m=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){m.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setCoordinates=function(f){var m=this;this.coordinates=f;var S=f.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var z=1/0,W=1/0,te=-1/0,be=-1/0,Se=0,Ie=R;Se<Ie.length;Se+=1){var Je=Ie[Se];z=Math.min(z,Je.x),W=Math.min(W,Je.y),te=Math.max(te,Je.x),be=Math.max(be,Je.y)}var Qe=Math.max(te-z,be-W),nt=Math.max(0,Math.floor(-Math.log(Qe)/Math.LN2)),He=Math.pow(2,nt);return new y.CanonicalTileID(nt,Math.floor((z+te)/2*He),Math.floor((W+be)/2*He))}(S),this.minzoom=this.maxzoom=this.tileID.z;var I=S.map(function(R){return m.tileID.getTilePoint(R)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(I[0].x,I[0].y,0,0),this._boundsArray.emplaceBack(I[1].x,I[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(I[3].x,I[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(I[2].x,I[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,m=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(f,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},h.prototype.loadTile=function(f,m){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},m(null)):(f.state="errored",m(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(y.Evented),cr=function(c){function h(f,m,S,I){c.call(this,f,m,S,I),this.roundZoom=!0,this.type="video",this.options=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1;var m=this.options;this.urls=[];for(var S=0,I=m.urls;S<I.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(I[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(R,z){f._loaded=!0,R?f.fire(new y.ErrorEvent(R)):z&&(f.video=z,f.video.loop=!0,f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(f){if(this.video){var m=this.video.seekable;f<m.start(0)||f>m.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+m.start(0)+" and "+m.end(0)+"-second mark."))):this.video.currentTime=f}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,m=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(f,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(Ut),wt=function(c){function h(f,m,S,I){c.call(this,f,m,S,I),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(z){return typeof z!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var m=this.map.painter.context,S=m.gl;for(var I in this.boundsBuffer||(this.boundsBuffer=m.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(m,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[I];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var f=0,m=[this.canvas.width,this.canvas.height];f<m.length;f+=1){var S=m[f];if(isNaN(S)||S<=0)return!0}return!1},h}(Ut),Or={vector:rt,raster:Z,"raster-dem":_e,geojson:ze,video:cr,image:Ut,canvas:wt};function Xn(c,h){var f=y.identity([]);return y.translate(f,f,[1,1,0]),y.scale(f,f,[.5*c.width,.5*c.height,1]),y.multiply(f,f,c.calculatePosMatrix(h.toUnwrapped()))}function Qr(c,h,f,m,S,I){var R=function(nt,He,ft){if(nt)for(var Et=0,Ht=nt;Et<Ht.length;Et+=1){var vr=He[Ht[Et]];if(vr&&vr.source===ft&&vr.type==="fill-extrusion")return!0}else for(var rr in He){var Ar=He[rr];if(Ar.source===ft&&Ar.type==="fill-extrusion")return!0}return!1}(S&&S.layers,h,c.id),z=I.maxPitchScaleFactor(),W=c.tilesIn(m,z,R);W.sort(Pi);for(var te=[],be=0,Se=W;be<Se.length;be+=1){var Ie=Se[be];te.push({wrappedTileID:Ie.tileID.wrapped().key,queryResults:Ie.tile.queryRenderedFeatures(h,f,c._state,Ie.queryGeometry,Ie.cameraQueryGeometry,Ie.scale,S,I,z,Xn(c.transform,Ie.tileID))})}var Je=function(nt){for(var He={},ft={},Et=0,Ht=nt;Et<Ht.length;Et+=1){var vr=Ht[Et],rr=vr.queryResults,Ar=vr.wrappedTileID,Hr=ft[Ar]=ft[Ar]||{};for(var xn in rr)for(var yn=rr[xn],Zn=Hr[xn]=Hr[xn]||{},_i=He[xn]=He[xn]||[],wi=0,Ei=yn;wi<Ei.length;wi+=1){var wa=Ei[wi];Zn[wa.featureIndex]||(Zn[wa.featureIndex]=!0,_i.push(wa))}}return He}(te);for(var Qe in Je)Je[Qe].forEach(function(nt){var He=nt.feature,ft=c.getFeatureState(He.layer["source-layer"],He.id);He.source=He.layer.source,He.layer["source-layer"]&&(He.sourceLayer=He.layer["source-layer"]),He.state=ft});return Je}function Pi(c,h){var f=c.tileID,m=h.tileID;return f.overscaledZ-m.overscaledZ||f.canonical.y-m.canonical.y||f.wrap-m.wrap||f.canonical.x-m.canonical.x}var mi=function(c,h){this.max=c,this.onRemove=h,this.reset()};mi.prototype.reset=function(){for(var c in this.data)for(var h=0,f=this.data[c];h<f.length;h+=1){var m=f[h];m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value)}return this.data={},this.order=[],this},mi.prototype.add=function(c,h,f){var m=this,S=c.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var I={value:h,timeout:void 0};if(f!==void 0&&(I.timeout=setTimeout(function(){m.remove(c,I)},f)),this.data[S].push(I),this.order.push(S),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},mi.prototype.has=function(c){return c.wrapped().key in this.data},mi.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},mi.prototype._getAndRemoveByKey=function(c){var h=this.data[c].shift();return h.timeout&&clearTimeout(h.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),h.value},mi.prototype.getByKey=function(c){var h=this.data[c];return h?h[0].value:null},mi.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},mi.prototype.remove=function(c,h){if(!this.has(c))return this;var f=c.wrapped().key,m=h===void 0?0:this.data[f].indexOf(h),S=this.data[f][m];return this.data[f].splice(m,1),S.timeout&&clearTimeout(S.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(S.value),this.order.splice(this.order.indexOf(f),1),this},mi.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},mi.prototype.filter=function(c){var h=[];for(var f in this.data)for(var m=0,S=this.data[f];m<S.length;m+=1){var I=S[m];c(I.value)||h.push(I)}for(var R=0,z=h;R<z.length;R+=1){var W=z[R];this.remove(W.value.tileID,W)}};var ln=function(c,h,f){this.context=c;var m=c.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};ln.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ln.prototype.updateData=function(c){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},ln.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ba={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},ua=function(c,h,f,m){this.length=h.length,this.attributes=f,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=c;var S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};ua.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},ua.prototype.updateData=function(c){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)},ua.prototype.enableAttributes=function(c,h){for(var f=0;f<this.attributes.length;f++){var m=h.attributes[this.attributes[f].name];m!==void 0&&c.enableVertexAttribArray(m)}},ua.prototype.setVertexAttribPointers=function(c,h,f){for(var m=0;m<this.attributes.length;m++){var S=this.attributes[m],I=h.attributes[S.name];I!==void 0&&c.vertexAttribPointer(I,S.components,c[ba[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}},ua.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Li=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Li.prototype.get=function(){return this.current},Li.prototype.set=function(c){},Li.prototype.getDefault=function(){return this.default},Li.prototype.setDefault=function(){this.set(this.default)};var Ma=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return y.Color.transparent},h.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(Li),ai=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},h}(Li),Ki=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},h}(Li),ci=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(Li),gi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},h}(Li),zo=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},h}(Li),go=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(f){var m=this.current;(f.func!==m.func||f.ref!==m.ref||f.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},h}(Li),no=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},h}(Li),It=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=f,this.dirty=!1}},h}(Li),ge=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},h}(Li),oe=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=f,this.dirty=!1}},h}(Li),Te=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},h}(Li),j=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.BLEND):m.disable(m.BLEND),this.current=f,this.dirty=!1}},h}(Li),ot=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},h}(Li),sr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return y.Color.transparent},h.prototype.set=function(f){var m=this.current;(f.r!==m.r||f.g!==m.g||f.b!==m.b||f.a!==m.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(Li),Yr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},h}(Li),Ke=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;f?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=f,this.dirty=!1}},h}(Li),Dt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},h}(Li),Cr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},h}(Li),_r=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},h}(Li),Rr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},h}(Li),mn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},h.prototype.set=function(f){var m=this.current;(f[0]!==m[0]||f[1]!==m[1]||f[2]!==m[2]||f[3]!==m[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(Li),vi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},h}(Li),ni=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(Li),bn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindTexture(m.TEXTURE_2D,f),this.current=f,this.dirty=!1}},h}(Li),Oi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},h}(Li),Ni=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){var m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},h}(Li),Ha=function(c){function h(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},h}(Li),oa=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},h}(Li),Wa=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},h}(Li),Ci=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},h}(Li),la=function(c){function h(f,m){c.call(this,f),this.context=f,this.parent=m}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(Li),Q=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},h}(la),ae=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(la),me=function(c,h,f,m){this.context=c,this.width=h,this.height=f;var S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new Q(c,S),m&&(this.depthAttachment=new ae(c,S))};me.prototype.destroy=function(){var c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var ke=function(c,h,f){this.func=c,this.mask=h,this.range=f};ke.ReadOnly=!1,ke.ReadWrite=!0,ke.disabled=new ke(519,ke.ReadOnly,[0,1]);var qe=function(c,h,f,m,S,I){this.test=c,this.ref=h,this.mask=f,this.fail=m,this.depthFail=S,this.pass=I};qe.disabled=new qe({func:519,mask:0},0,0,7680,7680,7680);var st=function(c,h,f){this.blendFunction=c,this.blendColor=h,this.mask=f};st.disabled=new st(st.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),st.unblended=new st(st.Replace,y.Color.transparent,[!0,!0,!0,!0]),st.alphaBlended=new st([1,771],y.Color.transparent,[!0,!0,!0,!0]);var xt=function(c,h,f){this.enable=c,this.mode=h,this.frontFace=f};xt.disabled=new xt(!1,1029,2305),xt.backCCW=new xt(!0,1029,2305);var Me=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ma(this),this.clearDepth=new ai(this),this.clearStencil=new Ki(this),this.colorMask=new ci(this),this.depthMask=new gi(this),this.stencilMask=new zo(this),this.stencilFunc=new go(this),this.stencilOp=new no(this),this.stencilTest=new It(this),this.depthRange=new ge(this),this.depthTest=new oe(this),this.depthFunc=new Te(this),this.blend=new j(this),this.blendFunc=new ot(this),this.blendColor=new sr(this),this.blendEquation=new Yr(this),this.cullFace=new Ke(this),this.cullFaceSide=new Dt(this),this.frontFace=new Cr(this),this.program=new _r(this),this.activeTexture=new Rr(this),this.viewport=new mn(this),this.bindFramebuffer=new vi(this),this.bindRenderbuffer=new ni(this),this.bindTexture=new bn(this),this.bindVertexBuffer=new Oi(this),this.bindElementBuffer=new Ni(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ha(this),this.pixelStoreUnpack=new oa(this),this.pixelStoreUnpackPremultiplyAlpha=new Wa(this),this.pixelStoreUnpackFlipY=new Ci(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};Me.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Me.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Me.prototype.createIndexBuffer=function(c,h){return new ln(this,c,h)},Me.prototype.createVertexBuffer=function(c,h,f){return new ua(this,c,h,f)},Me.prototype.createRenderbuffer=function(c,h,f){var m=this.gl,S=m.createRenderbuffer();return this.bindRenderbuffer.set(S),m.renderbufferStorage(m.RENDERBUFFER,c,h,f),this.bindRenderbuffer.set(null),S},Me.prototype.createFramebuffer=function(c,h,f){return new me(this,c,h,f)},Me.prototype.clear=function(c){var h=c.color,f=c.depth,m=this.gl,S=0;h&&(S|=m.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(S|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),m.clear(S)},Me.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},Me.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},Me.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},Me.prototype.setColorMode=function(c){y.deepEqual(c.blendFunction,st.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},Me.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var it=function(c){function h(f,m,S){var I=this;c.call(this),this.id=f,this.dispatcher=S,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(I._sourceLoaded=!0),I._sourceLoaded&&!I._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(I.reload(),I.transform&&I.update(I.transform))}),this.on("error",function(){I._sourceErrored=!0}),this._source=function(R,z,W,te){var be=new Or[z.type](R,z,W,te);if(be.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+be.id);return y.bindAll(["load","abort","unload","serialize","prepare"],be),be}(f,m,S,this),this._tiles={},this._cache=new mi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},h.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var m=this._tiles[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(f,m){return this._source.loadTile(f,m)},h.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},h.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(f){for(var m in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[m];S.upload(f),S.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return y.values(this._tiles).map(function(f){return f.tileID}).sort(Gt).map(function(f){return f.key})},h.prototype.getRenderableIds=function(f){var m=this,S=[];for(var I in this._tiles)this._isIdRenderable(I,f)&&S.push(this._tiles[I]);return f?S.sort(function(R,z){var W=R.tileID,te=z.tileID,be=new y.Point(W.canonical.x,W.canonical.y)._rotate(m.transform.angle),Se=new y.Point(te.canonical.x,te.canonical.y)._rotate(m.transform.angle);return W.overscaledZ-te.overscaledZ||Se.y-be.y||Se.x-be.x}).map(function(R){return R.tileID.key}):S.map(function(R){return R.tileID}).sort(Gt).map(function(R){return R.key})},h.prototype.hasRenderableParent=function(f){var m=this.findLoadedParent(f,0);return!!m&&this._isIdRenderable(m.tileID.key)},h.prototype._isIdRenderable=function(f,m){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(m||!this._tiles[f].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},h.prototype._reloadTile=function(f,m){var S=this._tiles[f];S&&(S.state!=="loading"&&(S.state=m),this._loadTile(S,this._tileLoaded.bind(this,S,f,m)))},h.prototype._tileLoaded=function(f,m,S,I){if(I)return f.state="errored",void(I.status!==404?this._source.fire(new y.ErrorEvent(I,{tile:f})):this.update(this.transform));f.timeAdded=y.browser.now(),S==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(m,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},h.prototype._backfillDEM=function(f){for(var m=this.getRenderableIds(),S=0;S<m.length;S++){var I=m[S];if(f.neighboringTiles&&f.neighboringTiles[I]){var R=this.getTileByID(I);z(f,R),z(R,f)}}function z(W,te){W.needsHillshadePrepare=!0;var be=te.tileID.canonical.x-W.tileID.canonical.x,Se=te.tileID.canonical.y-W.tileID.canonical.y,Ie=Math.pow(2,W.tileID.canonical.z),Je=te.tileID.key;be===0&&Se===0||Math.abs(Se)>1||(Math.abs(be)>1&&(Math.abs(be+Ie)===1?be+=Ie:Math.abs(be-Ie)===1&&(be-=Ie)),te.dem&&W.dem&&(W.dem.backfillBorder(te.dem,be,Se),W.neighboringTiles&&W.neighboringTiles[Je]&&(W.neighboringTiles[Je].backfilled=!0)))}},h.prototype.getTile=function(f){return this.getTileByID(f.key)},h.prototype.getTileByID=function(f){return this._tiles[f]},h.prototype._retainLoadedChildren=function(f,m,S,I){for(var R in this._tiles){var z=this._tiles[R];if(!(I[R]||!z.hasData()||z.tileID.overscaledZ<=m||z.tileID.overscaledZ>S)){for(var W=z.tileID;z&&z.tileID.overscaledZ>m+1;){var te=z.tileID.scaledTo(z.tileID.overscaledZ-1);(z=this._tiles[te.key])&&z.hasData()&&(W=te)}for(var be=W;be.overscaledZ>m;)if(f[(be=be.scaledTo(be.overscaledZ-1)).key]){I[W.key]=W;break}}}},h.prototype.findLoadedParent=function(f,m){if(f.key in this._loadedParentTiles){var S=this._loadedParentTiles[f.key];return S&&S.tileID.overscaledZ>=m?S:null}for(var I=f.overscaledZ-1;I>=m;I--){var R=f.scaledTo(I),z=this._getLoadedTile(R);if(z)return z}},h.prototype._getLoadedTile=function(f){var m=this._tiles[f.key];return m&&m.hasData()?m:this._cache.getByKey(f.wrapped().key)},h.prototype.updateCacheSize=function(f){var m=Math.ceil(f.width/this._source.tileSize)+1,S=Math.ceil(f.height/this._source.tileSize)+1,I=Math.floor(m*S*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(R)},h.prototype.handleWrapJump=function(f){var m=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,m){var S={};for(var I in this._tiles){var R=this._tiles[I];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+m),S[R.tileID.key]=R}for(var z in this._tiles=S,this._timers)clearTimeout(this._timers[z]),delete this._timers[z];for(var W in this._tiles)this._setTileReloadTimer(W,this._tiles[W])}},h.prototype.update=function(f){var m=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Hr){return new y.OverscaledTileID(Hr.canonical.z,Hr.wrap,Hr.canonical.z,Hr.canonical.x,Hr.canonical.y)}):(S=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Hr){return m._source.hasTile(Hr)}))):S=[];var I=f.coveringZoomLevel(this._source),R=Math.max(I-h.maxOverzooming,this._source.minzoom),z=Math.max(I+h.maxUnderzooming,this._source.minzoom),W=this._updateRetainedTiles(S,I);if(Zr(this._source.type)){for(var te={},be={},Se=0,Ie=Object.keys(W);Se<Ie.length;Se+=1){var Je=Ie[Se],Qe=W[Je],nt=this._tiles[Je];if(nt&&!(nt.fadeEndTime&&nt.fadeEndTime<=y.browser.now())){var He=this.findLoadedParent(Qe,R);He&&(this._addTile(He.tileID),te[He.tileID.key]=He.tileID),be[Je]=Qe}}for(var ft in this._retainLoadedChildren(be,I,z,W),te)W[ft]||(this._coveredTiles[ft]=!0,W[ft]=te[ft])}for(var Et in W)this._tiles[Et].clearFadeHold();for(var Ht=0,vr=y.keysDifference(this._tiles,W);Ht<vr.length;Ht+=1){var rr=vr[Ht],Ar=this._tiles[rr];Ar.hasSymbolBuckets&&!Ar.holdingForFade()?Ar.setHoldDuration(this.map._fadeDuration):Ar.hasSymbolBuckets&&!Ar.symbolFadeFinished()||this._removeTile(rr)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},h.prototype._updateRetainedTiles=function(f,m){for(var S={},I={},R=Math.max(m-h.maxOverzooming,this._source.minzoom),z=Math.max(m+h.maxUnderzooming,this._source.minzoom),W={},te=0,be=f;te<be.length;te+=1){var Se=be[te],Ie=this._addTile(Se);S[Se.key]=Se,Ie.hasData()||m<this._source.maxzoom&&(W[Se.key]=Se)}this._retainLoadedChildren(W,m,z,S);for(var Je=0,Qe=f;Je<Qe.length;Je+=1){var nt=Qe[Je],He=this._tiles[nt.key];if(!He.hasData()){if(m+1>this._source.maxzoom){var ft=nt.children(this._source.maxzoom)[0],Et=this.getTile(ft);if(Et&&Et.hasData()){S[ft.key]=ft;continue}}else{var Ht=nt.children(this._source.maxzoom);if(S[Ht[0].key]&&S[Ht[1].key]&&S[Ht[2].key]&&S[Ht[3].key])continue}for(var vr=He.wasRequested(),rr=nt.overscaledZ-1;rr>=R;--rr){var Ar=nt.scaledTo(rr);if(I[Ar.key]||(I[Ar.key]=!0,!(He=this.getTile(Ar))&&vr&&(He=this._addTile(Ar)),He&&(S[Ar.key]=Ar,vr=He.wasRequested(),He.hasData())))break}}}return S},h.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var m=[],S=void 0,I=this._tiles[f].tileID;I.overscaledZ>0;){if(I.key in this._loadedParentTiles){S=this._loadedParentTiles[I.key];break}m.push(I.key);var R=I.scaledTo(I.overscaledZ-1);if(S=this._getLoadedTile(R))break;I=R}for(var z=0,W=m;z<W.length;z+=1)this._loadedParentTiles[W[z]]=S}},h.prototype._addTile=function(f){var m=this._tiles[f.key];if(m)return m;(m=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,m),m.tileID=f,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,m)));var S=Boolean(m);return S||(m=new y.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(m,this._tileLoaded.bind(this,m,f.key,m.state))),m?(m.uses++,this._tiles[f.key]=m,S||this._source.fire(new y.Event("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m):null},h.prototype._setTileReloadTimer=function(f,m){var S=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var I=m.getExpiryTimeout();I&&(this._timers[f]=setTimeout(function(){S._reloadTile(f,"expired"),delete S._timers[f]},I))},h.prototype._removeTile=function(f){var m=this._tiles[f];m&&(m.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))},h.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},h.prototype.tilesIn=function(f,m,S){var I=this,R=[],z=this.transform;if(!z)return R;for(var W=S?z.getCameraQueryGeometry(f):f,te=f.map(function(rr){return z.pointCoordinate(rr)}),be=W.map(function(rr){return z.pointCoordinate(rr)}),Se=this.getIds(),Ie=1/0,Je=1/0,Qe=-1/0,nt=-1/0,He=0,ft=be;He<ft.length;He+=1){var Et=ft[He];Ie=Math.min(Ie,Et.x),Je=Math.min(Je,Et.y),Qe=Math.max(Qe,Et.x),nt=Math.max(nt,Et.y)}for(var Ht=function(rr){var Ar=I._tiles[Se[rr]];if(!Ar.holdingForFade()){var Hr=Ar.tileID,xn=Math.pow(2,z.zoom-Ar.tileID.overscaledZ),yn=m*Ar.queryPadding*y.EXTENT/Ar.tileSize/xn,Zn=[Hr.getTilePoint(new y.MercatorCoordinate(Ie,Je)),Hr.getTilePoint(new y.MercatorCoordinate(Qe,nt))];if(Zn[0].x-yn<y.EXTENT&&Zn[0].y-yn<y.EXTENT&&Zn[1].x+yn>=0&&Zn[1].y+yn>=0){var _i=te.map(function(Ei){return Hr.getTilePoint(Ei)}),wi=be.map(function(Ei){return Hr.getTilePoint(Ei)});R.push({tile:Ar,tileID:Hr,queryGeometry:_i,cameraQueryGeometry:wi,scale:xn})}}},vr=0;vr<Se.length;vr++)Ht(vr);return R},h.prototype.getVisibleCoordinates=function(f){for(var m=this,S=this.getRenderableIds(f).map(function(W){return m._tiles[W].tileID}),I=0,R=S;I<R.length;I+=1){var z=R[I];z.posMatrix=this.transform.calculatePosMatrix(z.toUnwrapped())}return S},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Zr(this._source.type))for(var f in this._tiles){var m=this._tiles[f];if(m.fadeEndTime!==void 0&&m.fadeEndTime>=y.browser.now())return!0}return!1},h.prototype.setFeatureState=function(f,m,S){this._state.updateState(f=f||"_geojsonTileLayer",m,S)},h.prototype.removeFeatureState=function(f,m,S){this._state.removeFeatureState(f=f||"_geojsonTileLayer",m,S)},h.prototype.getFeatureState=function(f,m){return this._state.getState(f=f||"_geojsonTileLayer",m)},h.prototype.setDependencies=function(f,m,S){var I=this._tiles[f];I&&I.setDependencies(m,S)},h.prototype.reloadTilesForDependencies=function(f,m){for(var S in this._tiles)this._tiles[S].hasDependency(f,m)&&this._reloadTile(S,"reloading");this._cache.filter(function(I){return!I.hasDependency(f,m)})},h}(y.Evented);function Gt(c,h){var f=Math.abs(2*c.wrap)-+(c.wrap<0),m=Math.abs(2*h.wrap)-+(h.wrap<0);return c.overscaledZ-h.overscaledZ||m-f||h.canonical.y-c.canonical.y||h.canonical.x-c.canonical.x}function Zr(c){return c==="raster"||c==="image"||c==="video"}function or(){return new y.window.Worker(Jc.workerUrl)}it.maxOverzooming=10,it.maxUnderzooming=3;var hr="mapboxgl_preloaded_worker_pool",jr=function(){this.active={}};jr.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<jr.workerCount;)this.workers.push(new or);return this.active[c]=!0,this.workers.slice()},jr.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},jr.prototype.isPreloaded=function(){return!!this.active[hr]},jr.prototype.numActive=function(){return Object.keys(this.active).length};var oi,Sn=Math.floor(y.browser.hardwareConcurrency/2);function Jt(){return oi||(oi=new jr),oi}function Hn(c,h){var f={};for(var m in c)m!=="ref"&&(f[m]=c[m]);return y.refProperties.forEach(function(S){S in h&&(f[S]=h[S])}),f}function wn(c){c=c.slice();for(var h=Object.create(null),f=0;f<c.length;f++)h[c[f].id]=c[f];for(var m=0;m<c.length;m++)"ref"in c[m]&&(c[m]=Hn(c[m],h[c[m].ref]));return c}jr.workerCount=Math.max(Math.min(Sn,6),1);var Tn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function sa(c,h,f){f.push({command:Tn.addSource,args:[c,h[c]]})}function Ir(c,h,f){h.push({command:Tn.removeSource,args:[c]}),f[c]=!0}function qi(c,h,f,m){Ir(c,f,m),sa(c,h,f)}function La(c,h,f){var m;for(m in c[f])if(c[f].hasOwnProperty(m)&&m!=="data"&&!y.deepEqual(c[f][m],h[f][m]))return!1;for(m in h[f])if(h[f].hasOwnProperty(m)&&m!=="data"&&!y.deepEqual(c[f][m],h[f][m]))return!1;return!0}function na(c,h,f,m,S,I){var R;for(R in h=h||{},c=c||{})c.hasOwnProperty(R)&&(y.deepEqual(c[R],h[R])||f.push({command:I,args:[m,R,h[R],S]}));for(R in h)h.hasOwnProperty(R)&&!c.hasOwnProperty(R)&&(y.deepEqual(c[R],h[R])||f.push({command:I,args:[m,R,h[R],S]}))}function pa(c){return c.id}function Lt(c,h){return c[h.id]=h,c}var At=function(c,h){this.reset(c,h)};At.prototype.reset=function(c,h){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},At.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=y.clamp(c,0,1);for(var h=1,f=this._distances[h],m=c*this.paddedLength+this.padding;f<m&&h<this._distances.length;)f=this._distances[++h];var S=h-1,I=this._distances[S],R=f-I,z=R>0?(m-I)/R:0;return this.points[S].mult(1-z).add(this.points[h].mult(z))};var Qi=function(c,h,f){var m=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(h/f);for(var I=0;I<this.xCellCount*this.yCellCount;I++)m.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function fo(c,h,f,m,S){var I=y.create();return h?(y.scale(I,I,[1/S,1/S,1]),f||y.rotateZ(I,I,m.angle)):y.multiply(I,m.labelPlaneMatrix,c),I}function Ba(c,h,f,m,S){if(h){var I=y.clone(c);return y.scale(I,I,[S,S,1]),f||y.rotateZ(I,I,-m.angle),I}return m.glCoordMatrix}function zi(c,h){var f=[c.x,c.y,0,1];po(f,f,h);var m=f[3];return{point:new y.Point(f[0]/m,f[1]/m),signedDistanceFromCamera:m}}function Ea(c,h){return .5+c/h*.5}function Co(c,h){var f=c[0]/c[3],m=c[1]/c[3];return f>=-h[0]&&f<=h[0]&&m>=-h[1]&&m<=h[1]}function sn(c,h,f,m,S,I,R,z){var W=m?c.textSizeData:c.iconSizeData,te=y.evaluateSizeForZoom(W,f.transform.zoom),be=[256/f.width*2+1,256/f.height*2+1],Se=m?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Se.clear();for(var Ie=c.lineVertexArray,Je=m?c.text.placedSymbolArray:c.icon.placedSymbolArray,Qe=f.transform.width/f.transform.height,nt=!1,He=0;He<Je.length;He++){var ft=Je.get(He);if(ft.hidden||ft.writingMode===y.WritingMode.vertical&&!nt)Oa(ft.numGlyphs,Se);else{nt=!1;var Et=[ft.anchorX,ft.anchorY,0,1];if(y.transformMat4(Et,Et,h),Co(Et,be)){var Ht=Ea(f.transform.cameraToCenterDistance,Et[3]),vr=y.evaluateSizeForFeature(W,te,ft),rr=R?vr/Ht:vr*Ht,Ar=new y.Point(ft.anchorX,ft.anchorY),Hr=zi(Ar,S).point,xn={},yn=Ds(ft,rr,!1,z,h,S,I,c.glyphOffsetArray,Ie,Se,Hr,Ar,xn,Qe);nt=yn.useVertical,(yn.notEnoughRoom||nt||yn.needsFlipping&&Ds(ft,rr,!0,z,h,S,I,c.glyphOffsetArray,Ie,Se,Hr,Ar,xn,Qe).notEnoughRoom)&&Oa(ft.numGlyphs,Se)}else Oa(ft.numGlyphs,Se)}}m?c.text.dynamicLayoutVertexBuffer.updateData(Se):c.icon.dynamicLayoutVertexBuffer.updateData(Se)}function Wr(c,h,f,m,S,I,R,z,W,te,be){var Se=z.glyphStartIndex+z.numGlyphs,Ie=z.lineStartIndex,Je=z.lineStartIndex+z.lineLength,Qe=h.getoffsetX(z.glyphStartIndex),nt=h.getoffsetX(Se-1),He=Xi(c*Qe,f,m,S,I,R,z.segment,Ie,Je,W,te,be);if(!He)return null;var ft=Xi(c*nt,f,m,S,I,R,z.segment,Ie,Je,W,te,be);return ft?{first:He,last:ft}:null}function bt(c,h,f,m){return c===y.WritingMode.horizontal&&Math.abs(f.y-h.y)>Math.abs(f.x-h.x)*m?{useVertical:!0}:(c===y.WritingMode.vertical?h.y<f.y:h.x>f.x)?{needsFlipping:!0}:null}function Ds(c,h,f,m,S,I,R,z,W,te,be,Se,Ie,Je){var Qe,nt=h/24,He=c.lineOffsetX*nt,ft=c.lineOffsetY*nt;if(c.numGlyphs>1){var Et=c.glyphStartIndex+c.numGlyphs,Ht=c.lineStartIndex,vr=c.lineStartIndex+c.lineLength,rr=Wr(nt,z,He,ft,f,be,Se,c,W,I,Ie);if(!rr)return{notEnoughRoom:!0};var Ar=zi(rr.first.point,R).point,Hr=zi(rr.last.point,R).point;if(m&&!f){var xn=bt(c.writingMode,Ar,Hr,Je);if(xn)return xn}Qe=[rr.first];for(var yn=c.glyphStartIndex+1;yn<Et-1;yn++)Qe.push(Xi(nt*z.getoffsetX(yn),He,ft,f,be,Se,c.segment,Ht,vr,W,I,Ie));Qe.push(rr.last)}else{if(m&&!f){var Zn=zi(Se,S).point,_i=c.lineStartIndex+c.segment+1,wi=new y.Point(W.getx(_i),W.gety(_i)),Ei=zi(wi,S),wa=Ei.signedDistanceFromCamera>0?Ei.point:jt(Se,wi,Zn,1,S),Wn=bt(c.writingMode,Zn,wa,Je);if(Wn)return Wn}var Gi=Xi(nt*z.getoffsetX(c.glyphStartIndex),He,ft,f,be,Se,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,W,I,Ie);if(!Gi)return{notEnoughRoom:!0};Qe=[Gi]}for(var Ji=0,Yi=Qe;Ji<Yi.length;Ji+=1){var Ri=Yi[Ji];y.addDynamicAttributes(te,Ri.point,Ri.angle)}return{}}function jt(c,h,f,m,S){var I=zi(c.add(c.sub(h)._unit()),S).point,R=f.sub(I);return f.add(R._mult(m/R.mag()))}function Xi(c,h,f,m,S,I,R,z,W,te,be,Se){var Ie=m?c-h:c+h,Je=Ie>0?1:-1,Qe=0;m&&(Je*=-1,Qe=Math.PI),Je<0&&(Qe+=Math.PI);for(var nt=Je>0?z+R:z+R+1,He=S,ft=S,Et=0,Ht=0,vr=Math.abs(Ie),rr=[];Et+Ht<=vr;){if((nt+=Je)<z||nt>=W)return null;if(ft=He,rr.push(He),(He=Se[nt])===void 0){var Ar=new y.Point(te.getx(nt),te.gety(nt)),Hr=zi(Ar,be);if(Hr.signedDistanceFromCamera>0)He=Se[nt]=Hr.point;else{var xn=nt-Je;He=jt(Et===0?I:new y.Point(te.getx(xn),te.gety(xn)),Ar,ft,vr-Et+1,be)}}Et+=Ht,Ht=ft.dist(He)}var yn=(vr-Et)/Ht,Zn=He.sub(ft),_i=Zn.mult(yn)._add(ft);_i._add(Zn._unit()._perp()._mult(f*Je));var wi=Qe+Math.atan2(He.y-ft.y,He.x-ft.x);return rr.push(_i),{point:_i,angle:wi,path:rr}}Qi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qi.prototype.insert=function(c,h,f,m,S){this._forEachCell(h,f,m,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(S)},Qi.prototype.insertCircle=function(c,h,f,m){this._forEachCell(h-m,f-m,h+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(f),this.circles.push(m)},Qi.prototype._insertBoxCell=function(c,h,f,m,S,I){this.boxCells[S].push(I)},Qi.prototype._insertCircleCell=function(c,h,f,m,S,I){this.circleCells[S].push(I)},Qi.prototype._query=function(c,h,f,m,S,I){if(f<0||c>this.width||m<0||h>this.height)return!S&&[];var R=[];if(c<=0&&h<=0&&this.width<=f&&this.height<=m){if(S)return!0;for(var z=0;z<this.boxKeys.length;z++)R.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(var W=0;W<this.circleKeys.length;W++){var te=this.circles[3*W],be=this.circles[3*W+1],Se=this.circles[3*W+2];R.push({key:this.circleKeys[W],x1:te-Se,y1:be-Se,x2:te+Se,y2:be+Se})}return I?R.filter(I):R}return this._forEachCell(c,h,f,m,this._queryCell,R,{hitTest:S,seenUids:{box:{},circle:{}}},I),S?R.length>0:R},Qi.prototype._queryCircle=function(c,h,f,m,S){var I=c-f,R=c+f,z=h-f,W=h+f;if(R<0||I>this.width||W<0||z>this.height)return!m&&[];var te=[];return this._forEachCell(I,z,R,W,this._queryCellCircle,te,{hitTest:m,circle:{x:c,y:h,radius:f},seenUids:{box:{},circle:{}}},S),m?te.length>0:te},Qi.prototype.query=function(c,h,f,m,S){return this._query(c,h,f,m,!1,S)},Qi.prototype.hitTest=function(c,h,f,m,S){return this._query(c,h,f,m,!0,S)},Qi.prototype.hitTestCircle=function(c,h,f,m){return this._queryCircle(c,h,f,!0,m)},Qi.prototype._queryCell=function(c,h,f,m,S,I,R,z){var W=R.seenUids,te=this.boxCells[S];if(te!==null)for(var be=this.bboxes,Se=0,Ie=te;Se<Ie.length;Se+=1){var Je=Ie[Se];if(!W.box[Je]){W.box[Je]=!0;var Qe=4*Je;if(c<=be[Qe+2]&&h<=be[Qe+3]&&f>=be[Qe+0]&&m>=be[Qe+1]&&(!z||z(this.boxKeys[Je]))){if(R.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Je],x1:be[Qe],y1:be[Qe+1],x2:be[Qe+2],y2:be[Qe+3]})}}}var nt=this.circleCells[S];if(nt!==null)for(var He=this.circles,ft=0,Et=nt;ft<Et.length;ft+=1){var Ht=Et[ft];if(!W.circle[Ht]){W.circle[Ht]=!0;var vr=3*Ht;if(this._circleAndRectCollide(He[vr],He[vr+1],He[vr+2],c,h,f,m)&&(!z||z(this.circleKeys[Ht]))){if(R.hitTest)return I.push(!0),!0;var rr=He[vr],Ar=He[vr+1],Hr=He[vr+2];I.push({key:this.circleKeys[Ht],x1:rr-Hr,y1:Ar-Hr,x2:rr+Hr,y2:Ar+Hr})}}}},Qi.prototype._queryCellCircle=function(c,h,f,m,S,I,R,z){var W=R.circle,te=R.seenUids,be=this.boxCells[S];if(be!==null)for(var Se=this.bboxes,Ie=0,Je=be;Ie<Je.length;Ie+=1){var Qe=Je[Ie];if(!te.box[Qe]){te.box[Qe]=!0;var nt=4*Qe;if(this._circleAndRectCollide(W.x,W.y,W.radius,Se[nt+0],Se[nt+1],Se[nt+2],Se[nt+3])&&(!z||z(this.boxKeys[Qe])))return I.push(!0),!0}}var He=this.circleCells[S];if(He!==null)for(var ft=this.circles,Et=0,Ht=He;Et<Ht.length;Et+=1){var vr=Ht[Et];if(!te.circle[vr]){te.circle[vr]=!0;var rr=3*vr;if(this._circlesCollide(ft[rr],ft[rr+1],ft[rr+2],W.x,W.y,W.radius)&&(!z||z(this.circleKeys[vr])))return I.push(!0),!0}}},Qi.prototype._forEachCell=function(c,h,f,m,S,I,R,z){for(var W=this._convertToXCellCoord(c),te=this._convertToYCellCoord(h),be=this._convertToXCellCoord(f),Se=this._convertToYCellCoord(m),Ie=W;Ie<=be;Ie++)for(var Je=te;Je<=Se;Je++)if(S.call(this,c,h,f,m,this.xCellCount*Je+Ie,I,R,z))return},Qi.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Qi.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Qi.prototype._circlesCollide=function(c,h,f,m,S,I){var R=m-c,z=S-h,W=f+I;return W*W>R*R+z*z},Qi.prototype._circleAndRectCollide=function(c,h,f,m,S,I,R){var z=(I-m)/2,W=Math.abs(c-(m+z));if(W>z+f)return!1;var te=(R-S)/2,be=Math.abs(h-(S+te));if(be>te+f)return!1;if(W<=z||be<=te)return!0;var Se=W-z,Ie=be-te;return Se*Se+Ie*Ie<=f*f};var Yl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Oa(c,h){for(var f=0;f<c;f++){var m=h.length;h.resize(m+4),h.float32.set(Yl,3*m)}}function po(c,h,f){var m=h[0],S=h[1];return c[0]=f[0]*m+f[4]*S+f[12],c[1]=f[1]*m+f[5]*S+f[13],c[3]=f[3]*m+f[7]*S+f[15],c}var Oo=function(c,h,f){h===void 0&&(h=new Qi(c.width+200,c.height+200,25)),f===void 0&&(f=new Qi(c.width+200,c.height+200,25)),this.transform=c,this.grid=h,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function _a(c,h,f){return h*(y.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}Oo.prototype.placeCollisionBox=function(c,h,f,m,S){var I=this.projectAndGetPerspectiveRatio(m,c.anchorPointX,c.anchorPointY),R=f*I.perspectiveRatio,z=c.x1*R+I.point.x,W=c.y1*R+I.point.y,te=c.x2*R+I.point.x,be=c.y2*R+I.point.y;return!this.isInsideGrid(z,W,te,be)||!h&&this.grid.hitTest(z,W,te,be,S)?{box:[],offscreen:!1}:{box:[z,W,te,be],offscreen:this.isOffscreen(z,W,te,be)}},Oo.prototype.placeCollisionCircles=function(c,h,f,m,S,I,R,z,W,te,be,Se,Ie){var Je=[],Qe=new y.Point(h.anchorX,h.anchorY),nt=zi(Qe,I),He=Ea(this.transform.cameraToCenterDistance,nt.signedDistanceFromCamera),ft=(te?S/He:S*He)/y.ONE_EM,Et=zi(Qe,R).point,Ht=Wr(ft,m,h.lineOffsetX*ft,h.lineOffsetY*ft,!1,Et,Qe,h,f,R,{}),vr=!1,rr=!1,Ar=!0;if(Ht){for(var Hr=.5*Se*He+Ie,xn=new y.Point(-100,-100),yn=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Zn=new At,_i=Ht.first,wi=Ht.last,Ei=[],wa=_i.path.length-1;wa>=1;wa--)Ei.push(_i.path[wa]);for(var Wn=1;Wn<wi.path.length;Wn++)Ei.push(wi.path[Wn]);var Gi=2.5*Hr;if(z){var Ji=Ei.map(function(ku){return zi(ku,z)});Ei=Ji.some(function(ku){return ku.signedDistanceFromCamera<=0})?[]:Ji.map(function(ku){return ku.point})}var Yi=[];if(Ei.length>0){for(var Ri=Ei[0].clone(),ea=Ei[0].clone(),Di=1;Di<Ei.length;Di++)Ri.x=Math.min(Ri.x,Ei[Di].x),Ri.y=Math.min(Ri.y,Ei[Di].y),ea.x=Math.max(ea.x,Ei[Di].x),ea.y=Math.max(ea.y,Ei[Di].y);Yi=Ri.x>=xn.x&&ea.x<=yn.x&&Ri.y>=xn.y&&ea.y<=yn.y?[Ei]:ea.x<xn.x||Ri.x>yn.x||ea.y<xn.y||Ri.y>yn.y?[]:y.clipLine([Ei],xn.x,xn.y,yn.x,yn.y)}for(var ki=0,xs=Yi;ki<xs.length;ki+=1){var qo;Zn.reset(xs[ki],.25*Hr),qo=Zn.length<=.5*Hr?1:Math.ceil(Zn.paddedLength/Gi)+1;for(var is=0;is<qo;is++){var as=is/Math.max(qo-1,1),_o=Zn.lerp(as),os=_o.x+100,Mu=_o.y+100;Je.push(os,Mu,Hr,0);var ks=os-Hr,Ul=Mu-Hr,$o=os+Hr,Iu=Mu+Hr;if(Ar=Ar&&this.isOffscreen(ks,Ul,$o,Iu),rr=rr||this.isInsideGrid(ks,Ul,$o,Iu),!c&&this.grid.hitTestCircle(os,Mu,Hr,be)&&(vr=!0,!W))return{circles:[],offscreen:!1,collisionDetected:vr}}}}return{circles:!W&&vr||!rr?[]:Je,offscreen:Ar,collisionDetected:vr}},Oo.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],f=1/0,m=1/0,S=-1/0,I=-1/0,R=0,z=c;R<z.length;R+=1){var W=z[R],te=new y.Point(W.x+100,W.y+100);f=Math.min(f,te.x),m=Math.min(m,te.y),S=Math.max(S,te.x),I=Math.max(I,te.y),h.push(te)}for(var be={},Se={},Ie=0,Je=this.grid.query(f,m,S,I).concat(this.ignoredGrid.query(f,m,S,I));Ie<Je.length;Ie+=1){var Qe=Je[Ie],nt=Qe.key;if(be[nt.bucketInstanceId]===void 0&&(be[nt.bucketInstanceId]={}),!be[nt.bucketInstanceId][nt.featureIndex]){var He=[new y.Point(Qe.x1,Qe.y1),new y.Point(Qe.x2,Qe.y1),new y.Point(Qe.x2,Qe.y2),new y.Point(Qe.x1,Qe.y2)];y.polygonIntersectsPolygon(h,He)&&(be[nt.bucketInstanceId][nt.featureIndex]=!0,Se[nt.bucketInstanceId]===void 0&&(Se[nt.bucketInstanceId]=[]),Se[nt.bucketInstanceId].push(nt.featureIndex))}}return Se},Oo.prototype.insertCollisionBox=function(c,h,f,m,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:m,collisionGroupID:S},c[0],c[1],c[2],c[3])},Oo.prototype.insertCollisionCircles=function(c,h,f,m,S){for(var I=h?this.ignoredGrid:this.grid,R={bucketInstanceId:f,featureIndex:m,collisionGroupID:S},z=0;z<c.length;z+=4)I.insertCircle(R,c[z],c[z+1],c[z+2])},Oo.prototype.projectAndGetPerspectiveRatio=function(c,h,f){var m=[h,f,0,1];return po(m,m,c),{point:new y.Point((m[0]/m[3]+1)/2*this.transform.width+100,(-m[1]/m[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/m[3]*.5}},Oo.prototype.isOffscreen=function(c,h,f,m){return f<100||c>=this.screenRightBoundary||m<100||h>this.screenBottomBoundary},Oo.prototype.isInsideGrid=function(c,h,f,m){return f>=0&&c<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary},Oo.prototype.getViewportMatrix=function(){var c=y.identity([]);return y.translate(c,c,[-100,-100,0]),c};var Bs=function(c,h,f,m){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):m&&f?1:0,this.placed=f};Bs.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ns=function(c,h,f,m,S){this.text=new Bs(c?c.text:null,h,f,S),this.icon=new Bs(c?c.icon:null,h,m,S)};Ns.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ql=function(c,h,f){this.text=c,this.icon=h,this.skipFade=f},So=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},Ts=function(c,h,f,m,S){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=S},Ka=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Uo(c,h,f,m,S){var I=y.getAnchorAlignment(c),R=-(I.horizontalAlign-.5)*h,z=-(I.verticalAlign-.5)*f,W=y.evaluateVariableOffset(c,m);return new y.Point(R+W[0]*S,z+W[1]*S)}function Ms(c,h,f,m,S,I){var R=c.x1,z=c.x2,W=c.y1,te=c.y2,be=c.anchorPointX,Se=c.anchorPointY,Ie=new y.Point(h,f);return m&&Ie._rotate(S?I:-I),{x1:R+Ie.x,y1:W+Ie.y,x2:z+Ie.x,y2:te+Ie.y,anchorPointX:be,anchorPointY:Se}}Ka.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:function(f){return f.collisionGroupID===h}}}return this.collisionGroups[c]};var Fo=function(c,h,f,m){this.transform=c.clone(),this.collisionIndex=new Oo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Ka(f),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}};function Xu(c,h,f,m,S){c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0),c.emplaceBack(h?1:0,f?1:0,m||0,S||0)}Fo.prototype.getBucketParts=function(c,h,f,m){var S=f.getBucket(h),I=f.latestFeatureIndex;if(S&&I&&h.id===S.layerIds[0]){var R=f.collisionBoxArray,z=S.layers[0].layout,W=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),te=f.tileSize/y.EXTENT,be=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),Se=z.get("text-pitch-alignment")==="map",Ie=z.get("text-rotation-alignment")==="map",Je=_a(f,1,this.transform.zoom),Qe=fo(be,Se,Ie,this.transform,Je),nt=null;if(Se){var He=Ba(be,Se,Ie,this.transform,Je);nt=y.multiply([],this.transform.labelPlaneMatrix,He)}this.retainedQueryData[S.bucketInstanceId]=new Ts(S.bucketInstanceId,I,S.sourceLayerIndex,S.index,f.tileID);var ft={bucket:S,layout:z,posMatrix:be,textLabelPlaneMatrix:Qe,labelToScreenMatrix:nt,scale:W,textPixelRatio:te,holdingForFade:f.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(m)for(var Et=0,Ht=S.sortKeyRanges;Et<Ht.length;Et+=1){var vr=Ht[Et];c.push({sortKey:vr.sortKey,symbolInstanceStart:vr.symbolInstanceStart,symbolInstanceEnd:vr.symbolInstanceEnd,parameters:ft})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ft})}},Fo.prototype.attemptAnchorPlacement=function(c,h,f,m,S,I,R,z,W,te,be,Se,Ie,Je,Qe){var nt,He=[Se.textOffset0,Se.textOffset1],ft=Uo(c,f,m,He,S),Et=this.collisionIndex.placeCollisionBox(Ms(h,ft.x,ft.y,I,R,this.transform.angle),be,z,W,te.predicate);if(!Qe||this.collisionIndex.placeCollisionBox(Ms(Qe,ft.x,ft.y,I,R,this.transform.angle),be,z,W,te.predicate).box.length!==0)return Et.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Se.crossTileID]&&this.prevPlacement.placements[Se.crossTileID]&&this.prevPlacement.placements[Se.crossTileID].text&&(nt=this.prevPlacement.variableOffsets[Se.crossTileID].anchor),this.variableOffsets[Se.crossTileID]={textOffset:He,width:f,height:m,anchor:c,textBoxScale:S,prevAnchor:nt},this.markUsedJustification(Ie,c,Se,Je),Ie.allowVerticalPlacement&&(this.markUsedOrientation(Ie,Je,Se),this.placedOrientations[Se.crossTileID]=Je),{shift:ft,placedGlyphBoxes:Et}):void 0},Fo.prototype.placeLayerBucketPart=function(c,h,f){var m=this,S=c.parameters,I=S.bucket,R=S.layout,z=S.posMatrix,W=S.textLabelPlaneMatrix,te=S.labelToScreenMatrix,be=S.textPixelRatio,Se=S.holdingForFade,Ie=S.collisionBoxArray,Je=S.partiallyEvaluatedTextSize,Qe=S.collisionGroup,nt=R.get("text-optional"),He=R.get("icon-optional"),ft=R.get("text-allow-overlap"),Et=R.get("icon-allow-overlap"),Ht=R.get("text-rotation-alignment")==="map",vr=R.get("text-pitch-alignment")==="map",rr=R.get("icon-text-fit")!=="none",Ar=R.get("symbol-z-order")==="viewport-y",Hr=ft&&(Et||!I.hasIconData()||He),xn=Et&&(ft||!I.hasTextData()||nt);!I.collisionArrays&&Ie&&I.deserializeCollisionBoxes(Ie);var yn=function(Wn,Gi){if(!h[Wn.crossTileID])if(Se)m.placements[Wn.crossTileID]=new ql(!1,!1,!1);else{var Ji,Yi=!1,Ri=!1,ea=!0,Di=null,ki={box:null,offscreen:null},xs={box:null,offscreen:null},qo=null,is=null,as=0,_o=0,os=0;Gi.textFeatureIndex?as=Gi.textFeatureIndex:Wn.useRuntimeCollisionCircles&&(as=Wn.featureIndex),Gi.verticalTextFeatureIndex&&(_o=Gi.verticalTextFeatureIndex);var Mu=Gi.textBox;if(Mu){var ks=function(Ga){var Nu=y.WritingMode.horizontal;if(I.allowVerticalPlacement&&!Ga&&m.prevPlacement){var bs=m.prevPlacement.placedOrientations[Wn.crossTileID];bs&&(m.placedOrientations[Wn.crossTileID]=bs,m.markUsedOrientation(I,Nu=bs,Wn))}return Nu},Ul=function(Ga,Nu){if(I.allowVerticalPlacement&&Wn.numVerticalGlyphVertices>0&&Gi.verticalTextBox)for(var bs=0,tc=I.writingModes;bs<tc.length&&(tc[bs]===y.WritingMode.vertical?(ki=Nu(),xs=ki):ki=Ga(),!(ki&&ki.box&&ki.box.length));bs+=1);else ki=Ga()};if(R.get("text-variable-anchor")){var $o=R.get("text-variable-anchor");if(m.prevPlacement&&m.prevPlacement.variableOffsets[Wn.crossTileID]){var Iu=m.prevPlacement.variableOffsets[Wn.crossTileID];$o.indexOf(Iu.anchor)>0&&($o=$o.filter(function(Ga){return Ga!==Iu.anchor})).unshift(Iu.anchor)}var ku=function(Ga,Nu,bs){for(var tc=Ga.x2-Ga.x1,_h=Ga.y2-Ga.y1,xh=Wn.textBoxScale,bh=rr&&!Et?Nu:null,zu={box:[],offscreen:!1},jl=ft?2*$o.length:$o.length,Uu=0;Uu<jl;++Uu){var rf=m.attemptAnchorPlacement($o[Uu%$o.length],Ga,tc,_h,xh,Ht,vr,be,z,Qe,Uu>=$o.length,Wn,I,bs,bh);if(rf&&(zu=rf.placedGlyphBoxes)&&zu.box&&zu.box.length){Yi=!0,Di=rf.shift;break}}return zu};Ul(function(){return ku(Mu,Gi.iconBox,y.WritingMode.horizontal)},function(){var Ga=Gi.verticalTextBox;return I.allowVerticalPlacement&&!(ki&&ki.box&&ki.box.length)&&Wn.numVerticalGlyphVertices>0&&Ga?ku(Ga,Gi.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),ki&&(Yi=ki.box,ea=ki.offscreen);var Jf=ks(ki&&ki.box);if(!Yi&&m.prevPlacement){var ef=m.prevPlacement.variableOffsets[Wn.crossTileID];ef&&(m.variableOffsets[Wn.crossTileID]=ef,m.markUsedJustification(I,ef.anchor,Wn,Jf))}}else{var Zl=function(Ga,Nu){var bs=m.collisionIndex.placeCollisionBox(Ga,ft,be,z,Qe.predicate);return bs&&bs.box&&bs.box.length&&(m.markUsedOrientation(I,Nu,Wn),m.placedOrientations[Wn.crossTileID]=Nu),bs};Ul(function(){return Zl(Mu,y.WritingMode.horizontal)},function(){var Ga=Gi.verticalTextBox;return I.allowVerticalPlacement&&Wn.numVerticalGlyphVertices>0&&Ga?Zl(Ga,y.WritingMode.vertical):{box:null,offscreen:null}}),ks(ki&&ki.box&&ki.box.length)}}if(Yi=(Ji=ki)&&Ji.box&&Ji.box.length>0,ea=Ji&&Ji.offscreen,Wn.useRuntimeCollisionCircles){var tl=I.text.placedSymbolArray.get(Wn.centerJustifiedTextSymbolIndex),tf=y.evaluateSizeForFeature(I.textSizeData,Je,tl),Sl=R.get("text-padding");qo=m.collisionIndex.placeCollisionCircles(ft,tl,I.lineVertexArray,I.glyphOffsetArray,tf,z,W,te,f,vr,Qe.predicate,Wn.collisionCircleDiameter,Sl),Yi=ft||qo.circles.length>0&&!qo.collisionDetected,ea=ea&&qo.offscreen}if(Gi.iconFeatureIndex&&(os=Gi.iconFeatureIndex),Gi.iconBox){var Ec=function(Ga){var Nu=rr&&Di?Ms(Ga,Di.x,Di.y,Ht,vr,m.transform.angle):Ga;return m.collisionIndex.placeCollisionBox(Nu,Et,be,z,Qe.predicate)};Ri=xs&&xs.box&&xs.box.length&&Gi.verticalIconBox?(is=Ec(Gi.verticalIconBox)).box.length>0:(is=Ec(Gi.iconBox)).box.length>0,ea=ea&&is.offscreen}var Vl=nt||Wn.numHorizontalGlyphVertices===0&&Wn.numVerticalGlyphVertices===0,vs=He||Wn.numIconVertices===0;if(Vl||vs?vs?Vl||(Ri=Ri&&Yi):Yi=Ri&&Yi:Ri=Yi=Ri&&Yi,Yi&&Ji&&Ji.box&&m.collisionIndex.insertCollisionBox(Ji.box,R.get("text-ignore-placement"),I.bucketInstanceId,xs&&xs.box&&_o?_o:as,Qe.ID),Ri&&is&&m.collisionIndex.insertCollisionBox(is.box,R.get("icon-ignore-placement"),I.bucketInstanceId,os,Qe.ID),qo&&(Yi&&m.collisionIndex.insertCollisionCircles(qo.circles,R.get("text-ignore-placement"),I.bucketInstanceId,as,Qe.ID),f)){var Al=I.bucketInstanceId,Cc=m.collisionCircleArrays[Al];Cc===void 0&&(Cc=m.collisionCircleArrays[Al]=new So);for(var gu=0;gu<qo.circles.length;gu+=4)Cc.circles.push(qo.circles[gu+0]),Cc.circles.push(qo.circles[gu+1]),Cc.circles.push(qo.circles[gu+2]),Cc.circles.push(qo.collisionDetected?1:0)}m.placements[Wn.crossTileID]=new ql(Yi||Hr,Ri||xn,ea||I.justReloaded),h[Wn.crossTileID]=!0}};if(Ar)for(var Zn=I.getSortedSymbolIndexes(this.transform.angle),_i=Zn.length-1;_i>=0;--_i){var wi=Zn[_i];yn(I.symbolInstances.get(wi),I.collisionArrays[wi])}else for(var Ei=c.symbolInstanceStart;Ei<c.symbolInstanceEnd;Ei++)yn(I.symbolInstances.get(Ei),I.collisionArrays[Ei]);if(f&&I.bucketInstanceId in this.collisionCircleArrays){var wa=this.collisionCircleArrays[I.bucketInstanceId];y.invert(wa.invProjMatrix,z),wa.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1},Fo.prototype.markUsedJustification=function(c,h,f,m){var S;S=m===y.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(h)];for(var I=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];I<R.length;I+=1){var z=R[I];z>=0&&(c.text.placedSymbolArray.get(z).crossTileID=S>=0&&z!==S?0:f.crossTileID)}},Fo.prototype.markUsedOrientation=function(c,h,f){for(var m=h===y.WritingMode.horizontal||h===y.WritingMode.horizontalOnly?h:0,S=h===y.WritingMode.vertical?h:0,I=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];I<R.length;I+=1)c.text.placedSymbolArray.get(R[I]).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)},Fo.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,f=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var m=h?h.symbolFadeChange(c):1,S=h?h.opacities:{},I=h?h.variableOffsets:{},R=h?h.placedOrientations:{};for(var z in this.placements){var W=this.placements[z],te=S[z];te?(this.opacities[z]=new Ns(te,m,W.text,W.icon),f=f||W.text!==te.text.placed||W.icon!==te.icon.placed):(this.opacities[z]=new Ns(null,m,W.text,W.icon,W.skipFade),f=f||W.text||W.icon)}for(var be in S){var Se=S[be];if(!this.opacities[be]){var Ie=new Ns(Se,m,!1,!1);Ie.isHidden()||(this.opacities[be]=Ie,f=f||Se.text.placed||Se.icon.placed)}}for(var Je in I)this.variableOffsets[Je]||!this.opacities[Je]||this.opacities[Je].isHidden()||(this.variableOffsets[Je]=I[Je]);for(var Qe in R)this.placedOrientations[Qe]||!this.opacities[Qe]||this.opacities[Qe].isHidden()||(this.placedOrientations[Qe]=R[Qe]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)},Fo.prototype.updateLayerOpacities=function(c,h){for(var f={},m=0,S=h;m<S.length;m+=1){var I=S[m],R=I.getBucket(c);R&&I.latestFeatureIndex&&c.id===R.layerIds[0]&&this.updateBucketOpacities(R,f,I.collisionBoxArray)}},Fo.prototype.updateBucketOpacities=function(c,h,f){var m=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var S=c.layers[0].layout,I=new Ns(null,0,!1,!1,!0),R=S.get("text-allow-overlap"),z=S.get("icon-allow-overlap"),W=S.get("text-variable-anchor"),te=S.get("text-rotation-alignment")==="map",be=S.get("text-pitch-alignment")==="map",Se=S.get("icon-text-fit")!=="none",Ie=new Ns(null,0,R&&(z||!c.hasIconData()||S.get("icon-optional")),z&&(R||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var Je=function(ft,Et,Ht){for(var vr=0;vr<Et/4;vr++)ft.opacityVertexArray.emplaceBack(Ht)},Qe=function(ft){var Et=c.symbolInstances.get(ft),Ht=Et.numHorizontalGlyphVertices,vr=Et.numVerticalGlyphVertices,rr=Et.crossTileID,Ar=m.opacities[rr];h[rr]?Ar=I:Ar||(m.opacities[rr]=Ar=Ie),h[rr]=!0;var Hr=Et.numIconVertices>0,xn=m.placedOrientations[Et.crossTileID],yn=xn===y.WritingMode.vertical,Zn=xn===y.WritingMode.horizontal||xn===y.WritingMode.horizontalOnly;if(Ht>0||vr>0){var _i=ei(Ar.text);Je(c.text,Ht,yn?ga:_i),Je(c.text,vr,Zn?ga:_i);var wi=Ar.text.isHidden();[Et.rightJustifiedTextSymbolIndex,Et.centerJustifiedTextSymbolIndex,Et.leftJustifiedTextSymbolIndex].forEach(function(ki){ki>=0&&(c.text.placedSymbolArray.get(ki).hidden=wi||yn?1:0)}),Et.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Et.verticalPlacedTextSymbolIndex).hidden=wi||Zn?1:0);var Ei=m.variableOffsets[Et.crossTileID];Ei&&m.markUsedJustification(c,Ei.anchor,Et,xn);var wa=m.placedOrientations[Et.crossTileID];wa&&(m.markUsedJustification(c,"left",Et,wa),m.markUsedOrientation(c,wa,Et))}if(Hr){var Wn=ei(Ar.icon),Gi=!(Se&&Et.verticalPlacedIconSymbolIndex&&yn);Et.placedIconSymbolIndex>=0&&(Je(c.icon,Et.numIconVertices,Gi?Wn:ga),c.icon.placedSymbolArray.get(Et.placedIconSymbolIndex).hidden=Ar.icon.isHidden()),Et.verticalPlacedIconSymbolIndex>=0&&(Je(c.icon,Et.numVerticalIconVertices,Gi?ga:Wn),c.icon.placedSymbolArray.get(Et.verticalPlacedIconSymbolIndex).hidden=Ar.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var Ji=c.collisionArrays[ft];if(Ji){var Yi=new y.Point(0,0);if(Ji.textBox||Ji.verticalTextBox){var Ri=!0;if(W){var ea=m.variableOffsets[rr];ea?(Yi=Uo(ea.anchor,ea.width,ea.height,ea.textOffset,ea.textBoxScale),te&&Yi._rotate(be?m.transform.angle:-m.transform.angle)):Ri=!1}Ji.textBox&&Xu(c.textCollisionBox.collisionVertexArray,Ar.text.placed,!Ri||yn,Yi.x,Yi.y),Ji.verticalTextBox&&Xu(c.textCollisionBox.collisionVertexArray,Ar.text.placed,!Ri||Zn,Yi.x,Yi.y)}var Di=Boolean(!Zn&&Ji.verticalIconBox);Ji.iconBox&&Xu(c.iconCollisionBox.collisionVertexArray,Ar.icon.placed,Di,Se?Yi.x:0,Se?Yi.y:0),Ji.verticalIconBox&&Xu(c.iconCollisionBox.collisionVertexArray,Ar.icon.placed,!Di,Se?Yi.x:0,Se?Yi.y:0)}}},nt=0;nt<c.symbolInstances.length;nt++)Qe(nt);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var He=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=He.invProjMatrix,c.placementViewportMatrix=He.viewportMatrix,c.collisionCircleArray=He.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},Fo.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Fo.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},Fo.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},Fo.prototype.stillRecent=function(c,h){var f=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*f>c},Fo.prototype.setStale=function(){this.stale=!0};var sl=Math.pow(2,25),ns=Math.pow(2,24),ve=Math.pow(2,17),Be=Math.pow(2,16),yt=Math.pow(2,9),ir=Math.pow(2,8),gn=Math.pow(2,1);function ei(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var h=c.placed?1:0,f=Math.floor(127*c.opacity);return f*sl+h*ns+f*ve+h*Be+f*yt+h*ir+f*gn+h}var ga=0,Jo=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Jo.prototype.continuePlacement=function(c,h,f,m,S){for(var I=this._bucketParts;this._currentTileIndex<c.length;)if(h.getBucketParts(I,m,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(function(R,z){return R.sortKey-z.sortKey}));this._currentPartIndex<I.length;)if(h.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1};var Fa=function(c,h,f,m,S,I,R){this.placement=new Fo(c,S,I,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=m,this._done=!1};Fa.prototype.isDone=function(){return this._done},Fa.prototype.continuePlacement=function(c,h,f){for(var m=this,S=y.browser.now(),I=function(){var W=y.browser.now()-S;return!m._forceFullPlacement&&W>2};this._currentPlacementIndex>=0;){var R=h[c[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=z)&&(!R.maxzoom||R.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new Jo(R)),this._inProgressLayer.continuePlacement(f[R.source],this.placement,this._showCollisionBoxes,R,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Fa.prototype.commit=function(c){return this.placement.commit(c),this.placement};var Zo=512/y.EXTENT/2,Ho=function(c,h,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var m=0;m<h.length;m++){var S=h.get(m),I=S.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,c)})}};Ho.prototype.getScaledCoordinates=function(c,h){var f=Zo/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*y.EXTENT+c.anchorX)*f),y:Math.floor((h.canonical.y*y.EXTENT+c.anchorY)*f)}},Ho.prototype.findMatches=function(c,h,f){for(var m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=0;S<c.length;S++){var I=c.get(S);if(!I.crossTileID){var R=this.indexedSymbolInstances[I.key];if(R)for(var z=this.getScaledCoordinates(I,h),W=0,te=R;W<te.length;W+=1){var be=te[W];if(Math.abs(be.coord.x-z.x)<=m&&Math.abs(be.coord.y-z.y)<=m&&!f[be.crossTileID]){f[be.crossTileID]=!0,I.crossTileID=be.crossTileID;break}}}}};var Ro=function(){this.maxCrossTileID=0};Ro.prototype.generate=function(){return++this.maxCrossTileID};var zs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};zs.prototype.handleWrapJump=function(c){var h=Math.round((c-this.lng)/360);if(h!==0)for(var f in this.indexes){var m=this.indexes[f],S={};for(var I in m){var R=m[I];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+h),S[R.tileID.key]=R}this.indexes[f]=S}this.lng=c},zs.prototype.addBucket=function(c,h,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var m=0;m<h.symbolInstances.length;m++)h.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var S=this.usedCrossTileIDs[c.overscaledZ];for(var I in this.indexes){var R=this.indexes[I];if(Number(I)>c.overscaledZ)for(var z in R){var W=R[z];W.tileID.isChildOf(c)&&W.findMatches(h.symbolInstances,c,S)}else{var te=R[c.scaledTo(Number(I)).key];te&&te.findMatches(h.symbolInstances,c,S)}}for(var be=0;be<h.symbolInstances.length;be++){var Se=h.symbolInstances.get(be);Se.crossTileID||(Se.crossTileID=f.generate(),S[Se.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Ho(c,h.symbolInstances,h.bucketInstanceId),!0},zs.prototype.removeBucketCrossTileIDs=function(c,h){for(var f in h.indexedSymbolInstances)for(var m=0,S=h.indexedSymbolInstances[f];m<S.length;m+=1)delete this.usedCrossTileIDs[c][S[m].crossTileID]},zs.prototype.removeStaleBuckets=function(c){var h=!1;for(var f in this.indexes){var m=this.indexes[f];for(var S in m)c[m[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[S]),delete m[S],h=!0)}return h};var hs=function(){this.layerIndexes={},this.crossTileIDs=new Ro,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};hs.prototype.addLayer=function(c,h,f){var m=this.layerIndexes[c.id];m===void 0&&(m=this.layerIndexes[c.id]=new zs);var S=!1,I={};m.handleWrapJump(f);for(var R=0,z=h;R<z.length;R+=1){var W=z[R],te=W.getBucket(c);te&&c.id===te.layerIds[0]&&(te.bucketInstanceId||(te.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(W.tileID,te,this.crossTileIDs)&&(S=!0),I[te.bucketInstanceId]=!0)}return m.removeStaleBuckets(I)&&(S=!0),S},hs.prototype.pruneUnusedLayers=function(c){var h={};for(var f in c.forEach(function(m){h[m]=!0}),this.layerIndexes)h[f]||delete this.layerIndexes[f]};var Is=function(c,h){return y.emitValidationErrors(c,h&&h.filter(function(f){return f.identifier!=="source.canvas"}))},bu=y.pick(Tn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Yu=y.pick(Tn,["setCenter","setZoom","setBearing","setPitch"]),Eu=function(){var c={},h=y.styleSpec.$version;for(var f in y.styleSpec.$root){var m,S=y.styleSpec.$root[f];S.required&&(m=f==="version"?h:S.type==="array"?[]:{})!=null&&(c[f]=m)}return c}(),Cu=function(c){function h(f,m){var S=this;m===void 0&&(m={}),c.call(this),this.map=f,this.dispatcher=new Er(Jt(),this),this.imageManager=new Wt,this.imageManager.setEventedParent(this),this.glyphManager=new yr(f._requestManager,m.localIdeographFontFamily),this.lineAtlas=new Ue(256,512),this.crossTileSymbolIndex=new hs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var I=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(R){I.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(z,W){if(y.triggerPluginCompletionEvent(z),W&&W.every(function(be){return be}))for(var te in I.sourceCaches)I.sourceCaches[te].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var z=S.sourceCaches[R.sourceId];if(z){var W=z.getSource();if(W&&W.vectorLayerIds)for(var te in S._layers){var be=S._layers[te];be.source===W.id&&S._validateLayer(be)}}}})}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.loadURL=function(f,m){var S=this;m===void 0&&(m={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var I=typeof m.validate=="boolean"?m.validate:!y.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,m.accessToken);var R=this.map._requestManager.transformRequest(f,y.ResourceType.Style);this._request=y.getJSON(R,function(z,W){S._request=null,z?S.fire(new y.ErrorEvent(z)):W&&S._load(W,I)})},h.prototype.loadJSON=function(f,m){var S=this;m===void 0&&(m={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(f,m.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Eu,!1)},h.prototype._load=function(f,m){if(!m||!Is(this,y.validateStyle(f))){for(var S in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(S,f.sources[S],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var I=wn(this.stylesheet.layers);this._order=I.map(function(te){return te.id}),this._layers={},this._serializedLayers={};for(var R=0,z=I;R<z.length;R+=1){var W=z[R];(W=y.createStyleLayer(W)).setEventedParent(this,{layer:{id:W.id}}),this._layers[W.id]=W,this._serializedLayers[W.id]=W.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},h.prototype._loadSprite=function(f){var m=this;this._spriteRequest=function(S,I,R){var z,W,te,be=y.browser.devicePixelRatio>1?"@2x":"",Se=y.getJSON(I.transformRequest(I.normalizeSpriteURL(S,be,".json"),y.ResourceType.SpriteJSON),function(Qe,nt){Se=null,te||(te=Qe,z=nt,Je())}),Ie=y.getImage(I.transformRequest(I.normalizeSpriteURL(S,be,".png"),y.ResourceType.SpriteImage),function(Qe,nt){Ie=null,te||(te=Qe,W=nt,Je())});function Je(){if(te)R(te);else if(z&&W){var Qe=y.browser.getImageData(W),nt={};for(var He in z){var ft=z[He],Et=ft.width,Ht=ft.height,vr=ft.x,rr=ft.y,Ar=ft.sdf,Hr=ft.pixelRatio,xn=ft.stretchX,yn=ft.stretchY,Zn=ft.content,_i=new y.RGBAImage({width:Et,height:Ht});y.RGBAImage.copy(Qe,_i,{x:vr,y:rr},{x:0,y:0},{width:Et,height:Ht}),nt[He]={data:_i,pixelRatio:Hr,sdf:Ar,stretchX:xn,stretchY:yn,content:Zn}}R(null,nt)}}return{cancel:function(){Se&&(Se.cancel(),Se=null),Ie&&(Ie.cancel(),Ie=null)}}}(f,this.map._requestManager,function(S,I){if(m._spriteRequest=null,S)m.fire(new y.ErrorEvent(S));else if(I)for(var R in I)m.imageManager.addImage(R,I[R]);m.imageManager.setLoaded(!0),m._availableImages=m.imageManager.listImages(),m.dispatcher.broadcast("setImages",m._availableImages),m.fire(new y.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(f){var m=this.sourceCaches[f.source];if(m){var S=f.sourceLayer;if(S){var I=m.getSource();(I.type==="geojson"||I.vectorLayerIds&&I.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+I.id+'" as specified by style layer "'+f.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(f){for(var m=[],S=0,I=f;S<I.length;S+=1){var R=this._layers[I[S]];R.type!=="custom"&&m.push(R.serialize())}return m},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var m in this._layers)if(this._layers[m].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(f){if(this._loaded){var m=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);for(var R in(S.length||I.length)&&this._updateWorkerLayers(S,I),this._updatedSources){var z=this._updatedSources[R];z==="reload"?this._reloadSource(R):z==="clear"&&this._clearSource(R)}for(var W in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[W].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var te={};for(var be in this.sourceCaches){var Se=this.sourceCaches[be];te[be]=Se.used,Se.used=!1}for(var Ie=0,Je=this._order;Ie<Je.length;Ie+=1){var Qe=this._layers[Je[Ie]];Qe.recalculate(f,this._availableImages),!Qe.isHidden(f.zoom)&&Qe.source&&(this.sourceCaches[Qe.source].used=!0)}for(var nt in te){var He=this.sourceCaches[nt];te[nt]!==He.used&&He.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:nt}))}this.light.recalculate(f),this.z=f.zoom,m&&this.fire(new y.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},h.prototype._updateWorkerLayers=function(f,m){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:m})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(f){var m=this;if(this._checkLoaded(),Is(this,y.validateStyle(f)))return!1;(f=y.clone$1(f)).layers=wn(f.layers);var S=function(R,z){if(!R)return[{command:Tn.setStyle,args:[z]}];var W=[];try{if(!y.deepEqual(R.version,z.version))return[{command:Tn.setStyle,args:[z]}];y.deepEqual(R.center,z.center)||W.push({command:Tn.setCenter,args:[z.center]}),y.deepEqual(R.zoom,z.zoom)||W.push({command:Tn.setZoom,args:[z.zoom]}),y.deepEqual(R.bearing,z.bearing)||W.push({command:Tn.setBearing,args:[z.bearing]}),y.deepEqual(R.pitch,z.pitch)||W.push({command:Tn.setPitch,args:[z.pitch]}),y.deepEqual(R.sprite,z.sprite)||W.push({command:Tn.setSprite,args:[z.sprite]}),y.deepEqual(R.glyphs,z.glyphs)||W.push({command:Tn.setGlyphs,args:[z.glyphs]}),y.deepEqual(R.transition,z.transition)||W.push({command:Tn.setTransition,args:[z.transition]}),y.deepEqual(R.light,z.light)||W.push({command:Tn.setLight,args:[z.light]});var te={},be=[];(function(Ie,Je,Qe,nt){var He;for(He in Je=Je||{},Ie=Ie||{})Ie.hasOwnProperty(He)&&(Je.hasOwnProperty(He)||Ir(He,Qe,nt));for(He in Je)Je.hasOwnProperty(He)&&(Ie.hasOwnProperty(He)?y.deepEqual(Ie[He],Je[He])||(Ie[He].type==="geojson"&&Je[He].type==="geojson"&&La(Ie,Je,He)?Qe.push({command:Tn.setGeoJSONSourceData,args:[He,Je[He].data]}):qi(He,Je,Qe,nt)):sa(He,Je,Qe))})(R.sources,z.sources,be,te);var Se=[];R.layers&&R.layers.forEach(function(Ie){te[Ie.source]?W.push({command:Tn.removeLayer,args:[Ie.id]}):Se.push(Ie)}),W=W.concat(be),function(Ie,Je,Qe){Je=Je||[];var nt,He,ft,Et,Ht,vr,rr,Ar=(Ie=Ie||[]).map(pa),Hr=Je.map(pa),xn=Ie.reduce(Lt,{}),yn=Je.reduce(Lt,{}),Zn=Ar.slice(),_i=Object.create(null);for(nt=0,He=0;nt<Ar.length;nt++)yn.hasOwnProperty(ft=Ar[nt])?He++:(Qe.push({command:Tn.removeLayer,args:[ft]}),Zn.splice(Zn.indexOf(ft,He),1));for(nt=0,He=0;nt<Hr.length;nt++)Zn[Zn.length-1-nt]!==(ft=Hr[Hr.length-1-nt])&&(xn.hasOwnProperty(ft)?(Qe.push({command:Tn.removeLayer,args:[ft]}),Zn.splice(Zn.lastIndexOf(ft,Zn.length-He),1)):He++,Qe.push({command:Tn.addLayer,args:[yn[ft],vr=Zn[Zn.length-nt]]}),Zn.splice(Zn.length-nt,0,ft),_i[ft]=!0);for(nt=0;nt<Hr.length;nt++)if(Et=xn[ft=Hr[nt]],Ht=yn[ft],!_i[ft]&&!y.deepEqual(Et,Ht))if(y.deepEqual(Et.source,Ht.source)&&y.deepEqual(Et["source-layer"],Ht["source-layer"])&&y.deepEqual(Et.type,Ht.type)){for(rr in na(Et.layout,Ht.layout,Qe,ft,null,Tn.setLayoutProperty),na(Et.paint,Ht.paint,Qe,ft,null,Tn.setPaintProperty),y.deepEqual(Et.filter,Ht.filter)||Qe.push({command:Tn.setFilter,args:[ft,Ht.filter]}),y.deepEqual(Et.minzoom,Ht.minzoom)&&y.deepEqual(Et.maxzoom,Ht.maxzoom)||Qe.push({command:Tn.setLayerZoomRange,args:[ft,Ht.minzoom,Ht.maxzoom]}),Et)Et.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?na(Et[rr],Ht[rr],Qe,ft,rr.slice(6),Tn.setPaintProperty):y.deepEqual(Et[rr],Ht[rr])||Qe.push({command:Tn.setLayerProperty,args:[ft,rr,Ht[rr]]}));for(rr in Ht)Ht.hasOwnProperty(rr)&&!Et.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?na(Et[rr],Ht[rr],Qe,ft,rr.slice(6),Tn.setPaintProperty):y.deepEqual(Et[rr],Ht[rr])||Qe.push({command:Tn.setLayerProperty,args:[ft,rr,Ht[rr]]}))}else Qe.push({command:Tn.removeLayer,args:[ft]}),vr=Zn[Zn.lastIndexOf(ft)+1],Qe.push({command:Tn.addLayer,args:[Ht,vr]})}(Se,z.layers,W)}catch(Ie){console.warn("Unable to compute style diff:",Ie),W=[{command:Tn.setStyle,args:[z]}]}return W}(this.serialize(),f).filter(function(R){return!(R.command in Yu)});if(S.length===0)return!1;var I=S.filter(function(R){return!(R.command in bu)});if(I.length>0)throw new Error("Unimplemented: "+I.map(function(R){return R.command}).join(", ")+".");return S.forEach(function(R){R.command!=="setTransition"&&m[R.command].apply(m,R.args)}),this.stylesheet=f,!0},h.prototype.addImage=function(f,m){if(this.getImage(f))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,m),this._afterImageUpdated(f)},h.prototype.updateImage=function(f,m){this.imageManager.updateImage(f,m)},h.prototype.getImage=function(f){return this.imageManager.getImage(f)},h.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},h.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(f,m,S){var I=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!m.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(m).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(y.validateStyle.source,"sources."+f,m,null,S))){this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);var R=this.sourceCaches[f]=new it(f,m,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:I.loaded(),source:R.serialize(),sourceId:f}}),R.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var m in this._layers)if(this._layers[m].source===f)return this.fire(new y.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+m+'" is using it.')));var S=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(f,m){this._checkLoaded(),this.sourceCaches[f].getSource().setData(m),this._changed=!0},h.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},h.prototype.addLayer=function(f,m,S){S===void 0&&(S={}),this._checkLoaded();var I=f.id;if(this.getLayer(I))this.fire(new y.ErrorEvent(new Error('Layer with id "'+I+'" already exists on this map')));else{var R;if(f.type==="custom"){if(Is(this,y.validateCustomStyleLayer(f)))return;R=y.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(I,f.source),f=y.clone$1(f),f=y.extend(f,{source:I})),this._validate(y.validateStyle.layer,"layers."+I,f,{arrayIndex:-1},S))return;R=y.createStyleLayer(f),this._validateLayer(R),R.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[R.id]=R.serialize()}var z=m?this._order.indexOf(m):this._order.length;if(m&&z===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.')));else{if(this._order.splice(z,0,I),this._layerOrderChanged=!0,this._layers[I]=R,this._removedLayers[I]&&R.source&&R.type!=="custom"){var W=this._removedLayers[I];delete this._removedLayers[I],W.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},h.prototype.moveLayer=function(f,m){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==m){var S=this._order.indexOf(f);this._order.splice(S,1);var I=m?this._order.indexOf(m):this._order.length;m&&I===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+m+'" does not exist on this map.'))):(this._order.splice(I,0,f),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(f){this._checkLoaded();var m=this._layers[f];if(m){m.setEventedParent(null);var S=this._order.indexOf(f);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=m,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],m.onRemove&&m.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(f){return this._layers[f]},h.prototype.hasLayer=function(f){return f in this._layers},h.prototype.setLayerZoomRange=function(f,m,S){this._checkLoaded();var I=this.getLayer(f);I?I.minzoom===m&&I.maxzoom===S||(m!=null&&(I.minzoom=m),S!=null&&(I.maxzoom=S),this._updateLayer(I)):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(f,m,S){S===void 0&&(S={}),this._checkLoaded();var I=this.getLayer(f);if(I){if(!y.deepEqual(I.filter,m))return m==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(y.validateStyle.filter,"layers."+I.id+".filter",m,null,S)||(I.filter=y.clone$1(m),this._updateLayer(I)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(f){return y.clone$1(this.getLayer(f).filter)},h.prototype.setLayoutProperty=function(f,m,S,I){I===void 0&&(I={}),this._checkLoaded();var R=this.getLayer(f);R?y.deepEqual(R.getLayoutProperty(m),S)||(R.setLayoutProperty(m,S,I),this._updateLayer(R)):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(f,m){var S=this.getLayer(f);if(S)return S.getLayoutProperty(m);this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(f,m,S,I){I===void 0&&(I={}),this._checkLoaded();var R=this.getLayer(f);R?y.deepEqual(R.getPaintProperty(m),S)||(R.setPaintProperty(m,S,I)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(f,m){return this.getLayer(f).getPaintProperty(m)},h.prototype.setFeatureState=function(f,m){this._checkLoaded();var S=f.source,I=f.sourceLayer,R=this.sourceCaches[S];if(R!==void 0){var z=R.getSource().type;z==="geojson"&&I?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):z!=="vector"||I?(f.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(I,f.id,m)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(f,m){this._checkLoaded();var S=f.source,I=this.sourceCaches[S];if(I!==void 0){var R=I.getSource().type,z=R==="vector"?f.sourceLayer:void 0;R!=="vector"||z?m&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):I.removeFeatureState(z,f.id,m):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(f){this._checkLoaded();var m=f.source,S=f.sourceLayer,I=this.sourceCaches[m];if(I!==void 0){if(I.getSource().type!=="vector"||S)return f.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),I.getFeatureState(S,f.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+m+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},h.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(f){for(var m=this,S=function(xn){return m._layers[xn].type==="fill-extrusion"},I={},R=[],z=this._order.length-1;z>=0;z--){var W=this._order[z];if(S(W)){I[W]=z;for(var te=0,be=f;te<be.length;te+=1){var Se=be[te][W];if(Se)for(var Ie=0,Je=Se;Ie<Je.length;Ie+=1)R.push(Je[Ie])}}}R.sort(function(xn,yn){return yn.intersectionZ-xn.intersectionZ});for(var Qe=[],nt=this._order.length-1;nt>=0;nt--){var He=this._order[nt];if(S(He))for(var ft=R.length-1;ft>=0;ft--){var Et=R[ft].feature;if(I[Et.layer.id]<nt)break;Qe.push(Et),R.pop()}else for(var Ht=0,vr=f;Ht<vr.length;Ht+=1){var rr=vr[Ht][He];if(rr)for(var Ar=0,Hr=rr;Ar<Hr.length;Ar+=1)Qe.push(Hr[Ar].feature)}}return Qe},h.prototype.queryRenderedFeatures=function(f,m,S){m&&m.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",m.filter,null,m);var I={};if(m&&m.layers){if(!Array.isArray(m.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,z=m.layers;R<z.length;R+=1){var W=z[R],te=this._layers[W];if(!te)return this.fire(new y.ErrorEvent(new Error("The layer '"+W+"' does not exist in the map's style and cannot be queried for features."))),[];I[te.source]=!0}}var be=[];for(var Se in m.availableImages=this._availableImages,this.sourceCaches)m.layers&&!I[Se]||be.push(Qr(this.sourceCaches[Se],this._layers,this._serializedLayers,f,m,S));return this.placement&&be.push(function(Ie,Je,Qe,nt,He,ft,Et){for(var Ht={},vr=ft.queryRenderedSymbols(nt),rr=[],Ar=0,Hr=Object.keys(vr).map(Number);Ar<Hr.length;Ar+=1)rr.push(Et[Hr[Ar]]);rr.sort(Pi);for(var xn=function(){var Ei=Zn[yn],wa=Ei.featureIndex.lookupSymbolFeatures(vr[Ei.bucketInstanceId],Je,Ei.bucketIndex,Ei.sourceLayerIndex,He.filter,He.layers,He.availableImages,Ie);for(var Wn in wa){var Gi=Ht[Wn]=Ht[Wn]||[],Ji=wa[Wn];Ji.sort(function(ea,Di){var ki=Ei.featureSortOrder;if(ki){var xs=ki.indexOf(ea.featureIndex);return ki.indexOf(Di.featureIndex)-xs}return Di.featureIndex-ea.featureIndex});for(var Yi=0,Ri=Ji;Yi<Ri.length;Yi+=1)Gi.push(Ri[Yi])}},yn=0,Zn=rr;yn<Zn.length;yn+=1)xn();var _i=function(Ei){Ht[Ei].forEach(function(wa){var Wn=wa.feature,Gi=Qe[Ie[Ei].source].getFeatureState(Wn.layer["source-layer"],Wn.id);Wn.source=Wn.layer.source,Wn.layer["source-layer"]&&(Wn.sourceLayer=Wn.layer["source-layer"]),Wn.state=Gi})};for(var wi in Ht)_i(wi);return Ht}(this._layers,this._serializedLayers,this.sourceCaches,f,m,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(be)},h.prototype.querySourceFeatures=function(f,m){m&&m.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",m.filter,null,m);var S=this.sourceCaches[f];return S?function(I,R){for(var z=I.getRenderableIds().map(function(Je){return I.getTileByID(Je)}),W=[],te={},be=0;be<z.length;be++){var Se=z[be],Ie=Se.tileID.canonical.key;te[Ie]||(te[Ie]=!0,Se.querySourceFeatures(W,R))}return W}(S,m):[]},h.prototype.addSourceType=function(f,m,S){return h.getSourceType(f)?S(new Error('A source type called "'+f+'" already exists.')):(h.setSourceType(f,m),m.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:m.workerSourceURL},S):S(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(f,m){m===void 0&&(m={}),this._checkLoaded();var S=this.light.getLight(),I=!1;for(var R in f)if(!y.deepEqual(f[R],S[R])){I=!0;break}if(I){var z={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,m),this.light.updateTransitions(z)}},h.prototype._validate=function(f,m,S,I,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&Is(this,f.call(y.validateStyle,y.extend({key:m,style:this.serialize(),value:S,styleSpec:y.styleSpec},I)))},h.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var m in this.sourceCaches)this.sourceCaches[m].clearTiles(),this.sourceCaches[m].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},h.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},h.prototype._updateSources=function(f){for(var m in this.sourceCaches)this.sourceCaches[m].update(f)},h.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},h.prototype._updatePlacement=function(f,m,S,I,R){R===void 0&&(R=!1);for(var z=!1,W=!1,te={},be=0,Se=this._order;be<Se.length;be+=1){var Ie=this._layers[Se[be]];if(Ie.type==="symbol"){if(!te[Ie.source]){var Je=this.sourceCaches[Ie.source];te[Ie.source]=Je.getRenderableIds(!0).map(function(Et){return Je.getTileByID(Et)}).sort(function(Et,Ht){return Ht.tileID.overscaledZ-Et.tileID.overscaledZ||(Et.tileID.isLessThan(Ht.tileID)?-1:1)})}var Qe=this.crossTileSymbolIndex.addLayer(Ie,te[Ie.source],f.center.lng);z=z||Qe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),f.zoom))&&(this.pauseablePlacement=new Fa(f,this._order,R,m,S,I,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,te),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),W=!0),z&&this.pauseablePlacement.placement.setStale()),W||z)for(var nt=0,He=this._order;nt<He.length;nt+=1){var ft=this._layers[He[nt]];ft.type==="symbol"&&this.placement.updateLayerOpacities(ft,te[ft.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},h.prototype.getImages=function(f,m,S){this.imageManager.getImages(m.icons,S),this._updateTilesForChangedImages();var I=this.sourceCaches[m.source];I&&I.setDependencies(m.tileID.key,m.type,m.icons)},h.prototype.getGlyphs=function(f,m,S){this.glyphManager.getGlyphs(m.stacks,S)},h.prototype.getResource=function(f,m,S){return y.makeRequest(m,S)},h}(y.Evented);Cu.getSourceType=function(c){return Or[c]},Cu.setSourceType=function(c,h){Or[c]=h},Cu.registerForPluginStateChange=y.registerForPluginStateChange;var Za=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),ps=Ia(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),iu=Ia(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Su=Ia(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),mf=Ia(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),zh=Ia("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),qs=Ia(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),gf=Ia(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),ul=Ia("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),jc=Ia("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),b=Ia("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),k=Ia(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),G=Ia(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),D=Ia(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ne=Ia(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Oe=Ia(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),dt=Ia(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Mt=Ia(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Zt=Ia(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Br=Ia(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Gr=Ia(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Yn=Ia(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ji=Ia(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ui=Ia(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Fi=Ia(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),io=Ia(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),vo=Ia(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ia(c,h){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=h.match(/attribute ([\w]+) ([\w]+)/g),S=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=I?I.concat(S):S,z={};return{fragmentSource:c=c.replace(f,function(W,te,be,Se,Ie){return z[Ie]=!0,te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
varying `+be+" "+Se+" "+Ie+`;
#else
uniform `+be+" "+Se+" u_"+Ie+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ie+`
    `+be+" "+Se+" "+Ie+" = u_"+Ie+`;
#endif
`}),vertexSource:h=h.replace(f,function(W,te,be,Se,Ie){var Je=Se==="float"?"vec2":"vec4",Qe=Ie.match(/color/)?"color":Je;return z[Ie]?te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
uniform lowp float u_`+Ie+`_t;
attribute `+be+" "+Je+" a_"+Ie+`;
varying `+be+" "+Se+" "+Ie+`;
#else
uniform `+be+" "+Se+" u_"+Ie+`;
#endif
`:Qe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ie+" = a_"+Ie+`;
#else
    `+be+" "+Se+" "+Ie+" = u_"+Ie+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+Ie+" = unpack_mix_"+Qe+"(a_"+Ie+", u_"+Ie+`_t);
#else
    `+be+" "+Se+" "+Ie+" = u_"+Ie+`;
#endif
`:te==="define"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
uniform lowp float u_`+Ie+`_t;
attribute `+be+" "+Je+" a_"+Ie+`;
#else
uniform `+be+" "+Se+" u_"+Ie+`;
#endif
`:Qe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+be+" "+Se+" "+Ie+" = a_"+Ie+`;
#else
    `+be+" "+Se+" "+Ie+" = u_"+Ie+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ie+`
    `+be+" "+Se+" "+Ie+" = unpack_mix_"+Qe+"(a_"+Ie+", u_"+Ie+`_t);
#else
    `+be+" "+Se+" "+Ie+" = u_"+Ie+`;
#endif
`}),staticAttributes:m,staticUniforms:R}}var au=Object.freeze({__proto__:null,prelude:ps,background:iu,backgroundPattern:Su,circle:mf,clippingMask:zh,heatmap:qs,heatmapTexture:gf,collisionBox:ul,collisionCircle:jc,debug:b,fill:k,fillOutline:G,fillOutlinePattern:D,fillPattern:ne,fillExtrusion:Oe,fillExtrusionPattern:dt,hillshadePrepare:Mt,hillshade:Zt,line:Br,lineGradient:Gr,linePattern:Yn,lineSDF:ji,raster:Ui,symbolIcon:Fi,symbolSDF:io,symbolTextAndIcon:vo}),Ll=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function hc(c){for(var h=[],f=0;f<c.length;f++)if(c[f]!==null){var m=c[f].split(" ");h.push(m.pop())}return h}Ll.prototype.bind=function(c,h,f,m,S,I,R,z){this.context=c;for(var W=this.boundPaintVertexBuffers.length!==m.length,te=0;!W&&te<m.length;te++)this.boundPaintVertexBuffers[te]!==m[te]&&(W=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===f&&!W&&this.boundIndexBuffer===S&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===z?(c.bindVertexArrayOES.set(this.vao),R&&R.bind(),S&&S.dynamicDraw&&S.bind(),z&&z.bind()):this.freshBind(h,f,m,S,I,R,z)},Ll.prototype.freshBind=function(c,h,f,m,S,I,R){var z,W=c.numAttributes,te=this.context,be=te.gl;if(te.extVertexArrayObject)this.vao&&this.destroy(),this.vao=te.extVertexArrayObject.createVertexArrayOES(),te.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=R;else{z=te.currentNumAttributes||0;for(var Se=W;Se<z;Se++)be.disableVertexAttribArray(Se)}h.enableAttributes(be,c);for(var Ie=0,Je=f;Ie<Je.length;Ie+=1)Je[Ie].enableAttributes(be,c);I&&I.enableAttributes(be,c),R&&R.enableAttributes(be,c),h.bind(),h.setVertexAttribPointers(be,c,S);for(var Qe=0,nt=f;Qe<nt.length;Qe+=1){var He=nt[Qe];He.bind(),He.setVertexAttribPointers(be,c,S)}I&&(I.bind(),I.setVertexAttribPointers(be,c,S)),m&&m.bind(),R&&(R.bind(),R.setVertexAttribPointers(be,c,S)),te.currentNumAttributes=W},Ll.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var pc=function(c,h,f,m,S,I){var R=c.gl;this.program=R.createProgram();for(var z=hc(f.staticAttributes),W=m?m.getBinderAttributes():[],te=z.concat(W),be=f.staticUniforms?hc(f.staticUniforms):[],Se=m?m.getBinderUniforms():[],Ie=[],Je=0,Qe=be.concat(Se);Je<Qe.length;Je+=1){var nt=Qe[Je];Ie.indexOf(nt)<0&&Ie.push(nt)}var He=m?m.defines():[];I&&He.push("#define OVERDRAW_INSPECTOR;");var ft=He.concat(ps.fragmentSource,f.fragmentSource).join(`
`),Et=He.concat(ps.vertexSource,f.vertexSource).join(`
`),Ht=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(Ht,ft),R.compileShader(Ht),R.attachShader(this.program,Ht);var vr=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(vr,Et),R.compileShader(vr),R.attachShader(this.program,vr),this.attributes={};var rr={};this.numAttributes=te.length;for(var Ar=0;Ar<this.numAttributes;Ar++)te[Ar]&&(R.bindAttribLocation(this.program,Ar,te[Ar]),this.attributes[te[Ar]]=Ar);R.linkProgram(this.program),R.deleteShader(vr),R.deleteShader(Ht);for(var Hr=0;Hr<Ie.length;Hr++){var xn=Ie[Hr];if(xn&&!rr[xn]){var yn=R.getUniformLocation(this.program,xn);yn&&(rr[xn]=yn)}}this.fixedUniforms=S(c,rr),this.binderUniforms=m?m.getUniforms(c,rr):[]}}};function dc(c,h,f){var m=1/_a(f,1,h.transform.tileZoom),S=Math.pow(2,f.tileID.overscaledZ),I=f.tileSize*Math.pow(2,h.transform.tileZoom)/S,R=I*(f.tileID.canonical.x+f.tileID.wrap*S),z=I*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[R>>16,z>>16],u_pixel_coord_lower:[65535&R,65535&z]}}pc.prototype.draw=function(c,h,f,m,S,I,R,z,W,te,be,Se,Ie,Je,Qe,nt){var He,ft=c.gl;if(!this.failedToCreate){for(var Et in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(m),c.setColorMode(S),c.setCullFace(I),this.fixedUniforms)this.fixedUniforms[Et].set(R[Et]);Je&&Je.setUniforms(c,this.binderUniforms,Se,{zoom:Ie});for(var Ht=(He={},He[ft.LINES]=2,He[ft.TRIANGLES]=3,He[ft.LINE_STRIP]=1,He)[h],vr=0,rr=be.get();vr<rr.length;vr+=1){var Ar=rr[vr],Hr=Ar.vaos||(Ar.vaos={});(Hr[z]||(Hr[z]=new Ll)).bind(c,this,W,Je?Je.getPaintVertexBuffers():[],te,Ar.vertexOffset,Qe,nt),ft.drawElements(h,Ar.primitiveLength*Ht,ft.UNSIGNED_SHORT,Ar.primitiveOffset*Ht*2)}}};var vc=function(c,h,f,m){var S=h.style.light,I=S.properties.get("position"),R=[I.x,I.y,I.z],z=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(z,-h.transform.angle),y.transformMat3(R,R,z);var W=S.properties.get("color");return{u_matrix:c,u_lightpos:R,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[W.r,W.g,W.b],u_vertical_gradient:+f,u_opacity:m}},Du=function(c,h,f,m,S,I,R){return y.extend(vc(c,h,f,m),dc(I,h,R),{u_height_factor:-Math.pow(2,S.overscaledZ)/R.tileSize/8})},Ol=function(c){return{u_matrix:c}},gl=function(c,h,f,m){return y.extend(Ol(c),dc(f,h,m))},Wo=function(c,h){return{u_matrix:c,u_world:h}},dp=function(c,h,f,m,S){return y.extend(gl(c,h,f,m),{u_world:S})},Uh=function(c,h,f,m){var S,I,R=c.transform;if(m.paint.get("circle-pitch-alignment")==="map"){var z=_a(f,1,R.zoom);S=!0,I=[z,z]}else S=!1,I=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(h.posMatrix,f,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:I}},Au=function(c,h,f){var m=_a(f,1,h.zoom),S=Math.pow(2,h.zoom-f.tileID.overscaledZ),I=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[h.pixelsToGLUnits[0]/(m*S),h.pixelsToGLUnits[1]/(m*S)],u_overscale_factor:I}},yf=function(c,h,f){return{u_matrix:c,u_inv_matrix:h,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},yl=function(c,h,f){return f===void 0&&(f=1),{u_matrix:c,u_color:h,u_overlay:0,u_overlay_scale:f}},qu=function(c){return{u_matrix:c}},Zh=function(c,h,f,m){return{u_matrix:c,u_extrude_scale:_a(h,1,f),u_intensity:m}},_l=function(c,h,f){var m=c.transform;return{u_matrix:vp(c,h,f),u_ratio:1/_a(h,1,m.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},mo=function(c,h,f,m){return y.extend(_l(c,h,f),{u_image:0,u_image_height:m})},$s=function(c,h,f,m){var S=c.transform,I=xl(h,S);return{u_matrix:vp(c,h,f),u_texsize:h.imageAtlasTexture.size,u_ratio:1/_a(h,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[I,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Vh=function(c,h,f,m,S){var I=c.lineAtlas,R=xl(h,c.transform),z=f.layout.get("line-cap")==="round",W=I.getDash(m.from,z),te=I.getDash(m.to,z),be=W.width*S.fromScale,Se=te.width*S.toScale;return y.extend(_l(c,h,f),{u_patternscale_a:[R/be,-W.height/2],u_patternscale_b:[R/Se,-te.height/2],u_sdfgamma:I.width/(256*Math.min(be,Se)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:W.y,u_tex_y_b:te.y,u_mix:S.t})};function xl(c,h){return 1/_a(c,1,h.tileZoom)}function vp(c,h,f){return c.translatePosMatrix(h.tileID.posMatrix,h,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var mp=function(c,h,f,m,S){return{u_matrix:c,u_tl_parent:h,u_scale_parent:f,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(R=S.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(I=S.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:ch(S.paint.get("raster-hue-rotate"))};var I,R};function ch(c){c*=Math.PI/180;var h=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*h-f+1)/3,(Math.sqrt(3)*h-f+1)/3]}var jf,_f=function(c,h,f,m,S,I,R,z,W,te){var be=S.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:be.cameraToCenterDistance,u_pitch:be.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:be.width/be.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:R,u_coord_matrix:z,u_is_text:+W,u_pitch_with_map:+m,u_texsize:te,u_texture:0}},Gf=function(c,h,f,m,S,I,R,z,W,te,be){var Se=S.transform;return y.extend(_f(c,h,f,m,S,I,R,z,W,te),{u_gamma_scale:m?Math.cos(Se._pitch)*Se.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+be})},Gc=function(c,h,f,m,S,I,R,z,W,te){return y.extend(Gf(c,h,f,m,S,I,R,z,!0,W,!0),{u_texsize_icon:te,u_texture_icon:1})},Hf=function(c,h,f){return{u_matrix:c,u_opacity:h,u_color:f}},mc=function(c,h,f,m,S,I){return y.extend(function(R,z,W,te){var be=W.imageManager.getPattern(R.from.toString()),Se=W.imageManager.getPattern(R.to.toString()),Ie=W.imageManager.getPixelSize(),Je=Ie.width,Qe=Ie.height,nt=Math.pow(2,te.tileID.overscaledZ),He=te.tileSize*Math.pow(2,W.transform.tileZoom)/nt,ft=He*(te.tileID.canonical.x+te.tileID.wrap*nt),Et=He*te.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:be.tl,u_pattern_br_a:be.br,u_pattern_tl_b:Se.tl,u_pattern_br_b:Se.br,u_texsize:[Je,Qe],u_mix:z.t,u_pattern_size_a:be.displaySize,u_pattern_size_b:Se.displaySize,u_scale_a:z.fromScale,u_scale_b:z.toScale,u_tile_units_to_pixels:1/_a(te,1,W.transform.tileZoom),u_pixel_coord_upper:[ft>>16,Et>>16],u_pixel_coord_lower:[65535&ft,65535&Et]}}(m,I,f,S),{u_matrix:c,u_opacity:h})},xf={fillExtrusion:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_lightpos:new y.Uniform3f(c,h.u_lightpos),u_lightintensity:new y.Uniform1f(c,h.u_lightintensity),u_lightcolor:new y.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new y.Uniform1f(c,h.u_vertical_gradient),u_opacity:new y.Uniform1f(c,h.u_opacity)}},fillExtrusionPattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_lightpos:new y.Uniform3f(c,h.u_lightpos),u_lightintensity:new y.Uniform1f(c,h.u_lightintensity),u_lightcolor:new y.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new y.Uniform1f(c,h.u_vertical_gradient),u_height_factor:new y.Uniform1f(c,h.u_height_factor),u_image:new y.Uniform1i(c,h.u_image),u_texsize:new y.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,h.u_scale),u_fade:new y.Uniform1f(c,h.u_fade),u_opacity:new y.Uniform1f(c,h.u_opacity)}},fill:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix)}},fillPattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_image:new y.Uniform1i(c,h.u_image),u_texsize:new y.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,h.u_scale),u_fade:new y.Uniform1f(c,h.u_fade)}},fillOutline:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_world:new y.Uniform2f(c,h.u_world)}},fillOutlinePattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_world:new y.Uniform2f(c,h.u_world),u_image:new y.Uniform1i(c,h.u_image),u_texsize:new y.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,h.u_scale),u_fade:new y.Uniform1f(c,h.u_fade)}},circle:function(c,h){return{u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(c,h.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(c,h.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(c,h.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(c,h.u_matrix)}},collisionBox:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(c,h.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(c,h.u_extrude_scale),u_overscale_factor:new y.Uniform1f(c,h.u_overscale_factor)}},collisionCircle:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_inv_matrix:new y.UniformMatrix4f(c,h.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(c,h.u_viewport_size)}},debug:function(c,h){return{u_color:new y.UniformColor(c,h.u_color),u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_overlay:new y.Uniform1i(c,h.u_overlay),u_overlay_scale:new y.Uniform1f(c,h.u_overlay_scale)}},clippingMask:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix)}},heatmap:function(c,h){return{u_extrude_scale:new y.Uniform1f(c,h.u_extrude_scale),u_intensity:new y.Uniform1f(c,h.u_intensity),u_matrix:new y.UniformMatrix4f(c,h.u_matrix)}},heatmapTexture:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_world:new y.Uniform2f(c,h.u_world),u_image:new y.Uniform1i(c,h.u_image),u_color_ramp:new y.Uniform1i(c,h.u_color_ramp),u_opacity:new y.Uniform1f(c,h.u_opacity)}},hillshade:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_image:new y.Uniform1i(c,h.u_image),u_latrange:new y.Uniform2f(c,h.u_latrange),u_light:new y.Uniform2f(c,h.u_light),u_shadow:new y.UniformColor(c,h.u_shadow),u_highlight:new y.UniformColor(c,h.u_highlight),u_accent:new y.UniformColor(c,h.u_accent)}},hillshadePrepare:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_image:new y.Uniform1i(c,h.u_image),u_dimension:new y.Uniform2f(c,h.u_dimension),u_zoom:new y.Uniform1f(c,h.u_zoom),u_unpack:new y.Uniform4f(c,h.u_unpack)}},line:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_ratio:new y.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,h.u_units_to_pixels)}},lineGradient:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_ratio:new y.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,h.u_units_to_pixels),u_image:new y.Uniform1i(c,h.u_image),u_image_height:new y.Uniform1f(c,h.u_image_height)}},linePattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_texsize:new y.Uniform2f(c,h.u_texsize),u_ratio:new y.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_image:new y.Uniform1i(c,h.u_image),u_units_to_pixels:new y.Uniform2f(c,h.u_units_to_pixels),u_scale:new y.Uniform3f(c,h.u_scale),u_fade:new y.Uniform1f(c,h.u_fade)}},lineSDF:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_ratio:new y.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,h.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(c,h.u_patternscale_a),u_patternscale_b:new y.Uniform2f(c,h.u_patternscale_b),u_sdfgamma:new y.Uniform1f(c,h.u_sdfgamma),u_image:new y.Uniform1i(c,h.u_image),u_tex_y_a:new y.Uniform1f(c,h.u_tex_y_a),u_tex_y_b:new y.Uniform1f(c,h.u_tex_y_b),u_mix:new y.Uniform1f(c,h.u_mix)}},raster:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_tl_parent:new y.Uniform2f(c,h.u_tl_parent),u_scale_parent:new y.Uniform1f(c,h.u_scale_parent),u_buffer_scale:new y.Uniform1f(c,h.u_buffer_scale),u_fade_t:new y.Uniform1f(c,h.u_fade_t),u_opacity:new y.Uniform1f(c,h.u_opacity),u_image0:new y.Uniform1i(c,h.u_image0),u_image1:new y.Uniform1i(c,h.u_image1),u_brightness_low:new y.Uniform1f(c,h.u_brightness_low),u_brightness_high:new y.Uniform1f(c,h.u_brightness_high),u_saturation_factor:new y.Uniform1f(c,h.u_saturation_factor),u_contrast_factor:new y.Uniform1f(c,h.u_contrast_factor),u_spin_weights:new y.Uniform3f(c,h.u_spin_weights)}},symbolIcon:function(c,h){return{u_is_size_zoom_constant:new y.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,h.u_size_t),u_size:new y.Uniform1f(c,h.u_size),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,h.u_pitch),u_rotate_symbol:new y.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,h.u_fade_change),u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new y.Uniform1i(c,h.u_is_text),u_pitch_with_map:new y.Uniform1i(c,h.u_pitch_with_map),u_texsize:new y.Uniform2f(c,h.u_texsize),u_texture:new y.Uniform1i(c,h.u_texture)}},symbolSDF:function(c,h){return{u_is_size_zoom_constant:new y.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,h.u_size_t),u_size:new y.Uniform1f(c,h.u_size),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,h.u_pitch),u_rotate_symbol:new y.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,h.u_fade_change),u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new y.Uniform1i(c,h.u_is_text),u_pitch_with_map:new y.Uniform1i(c,h.u_pitch_with_map),u_texsize:new y.Uniform2f(c,h.u_texsize),u_texture:new y.Uniform1i(c,h.u_texture),u_gamma_scale:new y.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(c,h.u_is_halo)}},symbolTextAndIcon:function(c,h){return{u_is_size_zoom_constant:new y.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,h.u_size_t),u_size:new y.Uniform1f(c,h.u_size),u_camera_to_center_distance:new y.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,h.u_pitch),u_rotate_symbol:new y.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,h.u_fade_change),u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new y.Uniform1i(c,h.u_is_text),u_pitch_with_map:new y.Uniform1i(c,h.u_pitch_with_map),u_texsize:new y.Uniform2f(c,h.u_texsize),u_texsize_icon:new y.Uniform2f(c,h.u_texsize_icon),u_texture:new y.Uniform1i(c,h.u_texture),u_texture_icon:new y.Uniform1i(c,h.u_texture_icon),u_gamma_scale:new y.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(c,h.u_is_halo)}},background:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_opacity:new y.Uniform1f(c,h.u_opacity),u_color:new y.UniformColor(c,h.u_color)}},backgroundPattern:function(c,h){return{u_matrix:new y.UniformMatrix4f(c,h.u_matrix),u_opacity:new y.Uniform1f(c,h.u_opacity),u_image:new y.Uniform1i(c,h.u_image),u_pattern_tl_a:new y.Uniform2f(c,h.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(c,h.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(c,h.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(c,h.u_pattern_br_b),u_texsize:new y.Uniform2f(c,h.u_texsize),u_mix:new y.Uniform1f(c,h.u_mix),u_pattern_size_a:new y.Uniform2f(c,h.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(c,h.u_pattern_size_b),u_scale_a:new y.Uniform1f(c,h.u_scale_a),u_scale_b:new y.Uniform1f(c,h.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,h.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(c,h.u_tile_units_to_pixels)}}};function $l(c,h,f,m,S,I,R){for(var z=c.context,W=z.gl,te=c.useProgram("collisionBox"),be=[],Se=0,Ie=0,Je=0;Je<m.length;Je++){var Qe=m[Je],nt=h.getTile(Qe),He=nt.getBucket(f);if(He){var ft=Qe.posMatrix;S[0]===0&&S[1]===0||(ft=c.translatePosMatrix(Qe.posMatrix,nt,S,I));var Et=R?He.textCollisionBox:He.iconCollisionBox,Ht=He.collisionCircleArray;if(Ht.length>0){var vr=y.create(),rr=ft;y.mul(vr,He.placementInvProjMatrix,c.transform.glCoordMatrix),y.mul(vr,vr,He.placementViewportMatrix),be.push({circleArray:Ht,circleOffset:Ie,transform:rr,invTransform:vr}),Ie=Se+=Ht.length/4}Et&&te.draw(z,W.LINES,ke.disabled,qe.disabled,c.colorModeForRenderPass(),xt.disabled,Au(ft,c.transform,nt),f.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,null,c.transform.zoom,null,null,Et.collisionVertexBuffer)}}if(R&&be.length){var Ar=c.useProgram("collisionCircle"),Hr=new y.StructArrayLayout2f1f2i16;Hr.resize(4*Se),Hr._trim();for(var xn=0,yn=0,Zn=be;yn<Zn.length;yn+=1)for(var _i=Zn[yn],wi=0;wi<_i.circleArray.length/4;wi++){var Ei=4*wi,wa=_i.circleArray[Ei+0],Wn=_i.circleArray[Ei+1],Gi=_i.circleArray[Ei+2],Ji=_i.circleArray[Ei+3];Hr.emplace(xn++,wa,Wn,Gi,Ji,0),Hr.emplace(xn++,wa,Wn,Gi,Ji,1),Hr.emplace(xn++,wa,Wn,Gi,Ji,2),Hr.emplace(xn++,wa,Wn,Gi,Ji,3)}(!jf||jf.length<2*Se)&&(jf=function(qo){var is=2*qo,as=new y.StructArrayLayout3ui6;as.resize(is),as._trim();for(var _o=0;_o<is;_o++){var os=6*_o;as.uint16[os+0]=4*_o+0,as.uint16[os+1]=4*_o+1,as.uint16[os+2]=4*_o+2,as.uint16[os+3]=4*_o+2,as.uint16[os+4]=4*_o+3,as.uint16[os+5]=4*_o+0}return as}(Se));for(var Yi=z.createIndexBuffer(jf,!0),Ri=z.createVertexBuffer(Hr,y.collisionCircleLayout.members,!0),ea=0,Di=be;ea<Di.length;ea+=1){var ki=Di[ea],xs=yf(ki.transform,ki.invTransform,c.transform);Ar.draw(z,W.TRIANGLES,ke.disabled,qe.disabled,c.colorModeForRenderPass(),xt.disabled,xs,f.id,Ri,Yi,y.SegmentVector.simpleSegment(0,2*ki.circleOffset,ki.circleArray.length,ki.circleArray.length/2),null,c.transform.zoom,null,null,null)}Ri.destroy(),Yi.destroy()}}var ou=y.identity(new Float32Array(16));function Wf(c,h,f,m,S,I){var R=y.getAnchorAlignment(c),z=-(R.horizontalAlign-.5)*h,W=-(R.verticalAlign-.5)*f,te=y.evaluateVariableOffset(c,m);return new y.Point((z/S+te[0])*I,(W/S+te[1])*I)}function Xf(c,h,f,m,S,I,R,z,W,te,be){var Se=c.text.placedSymbolArray,Ie=c.text.dynamicLayoutVertexArray,Je=c.icon.dynamicLayoutVertexArray,Qe={};Ie.clear();for(var nt=0;nt<Se.length;nt++){var He=Se.get(nt),ft=He.hidden||!He.crossTileID||c.allowVerticalPlacement&&!He.placedOrientation?null:m[He.crossTileID];if(ft){var Et=new y.Point(He.anchorX,He.anchorY),Ht=zi(Et,f?z:R),vr=Ea(I.cameraToCenterDistance,Ht.signedDistanceFromCamera),rr=S.evaluateSizeForFeature(c.textSizeData,te,He)*vr/y.ONE_EM;f&&(rr*=c.tilePixelRatio/W);for(var Ar=Wf(ft.anchor,ft.width,ft.height,ft.textOffset,ft.textBoxScale,rr),Hr=f?zi(Et.add(Ar),R).point:Ht.point.add(h?Ar.rotate(-I.angle):Ar),xn=c.allowVerticalPlacement&&He.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,yn=0;yn<He.numGlyphs;yn++)y.addDynamicAttributes(Ie,Hr,xn);be&&He.associatedIconIndex>=0&&(Qe[He.associatedIconIndex]={shiftedAnchor:Hr,angle:xn})}else Oa(He.numGlyphs,Ie)}if(be){Je.clear();for(var Zn=c.icon.placedSymbolArray,_i=0;_i<Zn.length;_i++){var wi=Zn.get(_i);if(wi.hidden)Oa(wi.numGlyphs,Je);else{var Ei=Qe[_i];if(Ei)for(var wa=0;wa<wi.numGlyphs;wa++)y.addDynamicAttributes(Je,Ei.shiftedAnchor,Ei.angle);else Oa(wi.numGlyphs,Je)}}c.icon.dynamicLayoutVertexBuffer.updateData(Je)}c.text.dynamicLayoutVertexBuffer.updateData(Ie)}function jh(c,h,f){return f.iconsInText&&h?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function gc(c,h,f,m,S,I,R,z,W,te,be,Se){for(var Ie=c.context,Je=Ie.gl,Qe=c.transform,nt=z==="map",He=W==="map",ft=nt&&f.layout.get("symbol-placement")!=="point",Et=nt&&!He&&!ft,Ht=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,vr=!1,rr=c.depthModeForSublayer(0,ke.ReadOnly),Ar=f.layout.get("text-variable-anchor"),Hr=[],xn=0,yn=m;xn<yn.length;xn+=1){var Zn=yn[xn],_i=h.getTile(Zn),wi=_i.getBucket(f);if(wi){var Ei=S?wi.text:wi.icon;if(Ei&&Ei.segments.get().length){var wa=Ei.programConfigurations.get(f.id),Wn=S||wi.sdfIcons,Gi=S?wi.textSizeData:wi.iconSizeData,Ji=He||Qe.pitch!==0,Yi=c.useProgram(jh(Wn,S,wi),wa),Ri=y.evaluateSizeForZoom(Gi,Qe.zoom),ea=void 0,Di=[0,0],ki=void 0,xs=void 0,qo=null,is=void 0;if(S)ki=_i.glyphAtlasTexture,xs=Je.LINEAR,ea=_i.glyphAtlasTexture.size,wi.iconsInText&&(Di=_i.imageAtlasTexture.size,qo=_i.imageAtlasTexture,is=Ji||c.options.rotating||c.options.zooming||Gi.kind==="composite"||Gi.kind==="camera"?Je.LINEAR:Je.NEAREST);else{var as=f.layout.get("icon-size").constantOr(0)!==1||wi.iconsNeedLinear;ki=_i.imageAtlasTexture,xs=Wn||c.options.rotating||c.options.zooming||as||Ji?Je.LINEAR:Je.NEAREST,ea=_i.imageAtlasTexture.size}var _o=_a(_i,1,c.transform.zoom),os=fo(Zn.posMatrix,He,nt,c.transform,_o),Mu=Ba(Zn.posMatrix,He,nt,c.transform,_o),ks=Ar&&wi.hasTextData(),Ul=f.layout.get("icon-text-fit")!=="none"&&ks&&wi.hasIconData();ft&&sn(wi,Zn.posMatrix,c,S,os,Mu,He,te);var $o=c.translatePosMatrix(Zn.posMatrix,_i,I,R),Iu=ft||S&&Ar||Ul?ou:os,ku=c.translatePosMatrix(Mu,_i,I,R,!0),Jf=Wn&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ef={program:Yi,buffers:Ei,uniformValues:Wn?wi.iconsInText?Gc(Gi.kind,Ri,Et,He,c,$o,Iu,ku,ea,Di):Gf(Gi.kind,Ri,Et,He,c,$o,Iu,ku,S,ea,!0):_f(Gi.kind,Ri,Et,He,c,$o,Iu,ku,S,ea),atlasTexture:ki,atlasTextureIcon:qo,atlasInterpolation:xs,atlasInterpolationIcon:is,isSDF:Wn,hasHalo:Jf};if(Ht&&wi.canOverlap){vr=!0;for(var Zl=0,tl=Ei.segments.get();Zl<tl.length;Zl+=1){var tf=tl[Zl];Hr.push({segments:new y.SegmentVector([tf]),sortKey:tf.sortKey,state:ef})}}else Hr.push({segments:Ei.segments,sortKey:0,state:ef})}}}vr&&Hr.sort(function(Cc,gu){return Cc.sortKey-gu.sortKey});for(var Sl=0,Ec=Hr;Sl<Ec.length;Sl+=1){var Vl=Ec[Sl],vs=Vl.state;if(Ie.activeTexture.set(Je.TEXTURE0),vs.atlasTexture.bind(vs.atlasInterpolation,Je.CLAMP_TO_EDGE),vs.atlasTextureIcon&&(Ie.activeTexture.set(Je.TEXTURE1),vs.atlasTextureIcon&&vs.atlasTextureIcon.bind(vs.atlasInterpolationIcon,Je.CLAMP_TO_EDGE)),vs.isSDF){var Al=vs.uniformValues;vs.hasHalo&&(Al.u_is_halo=1,$u(vs.buffers,Vl.segments,f,c,vs.program,rr,be,Se,Al)),Al.u_is_halo=0}$u(vs.buffers,Vl.segments,f,c,vs.program,rr,be,Se,vs.uniformValues)}}function $u(c,h,f,m,S,I,R,z,W){var te=m.context;S.draw(te,te.gl.TRIANGLES,I,R,z,xt.disabled,W,f.id,c.layoutVertexBuffer,c.indexBuffer,h,f.paint,m.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Fl(c,h,f,m,S,I,R){var z,W,te,be,Se,Ie=c.context.gl,Je=f.paint.get("fill-pattern"),Qe=Je&&Je.constantOr(1),nt=f.getCrossfadeParameters();R?(W=Qe&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=Ie.LINES):(W=Qe?"fillPattern":"fill",z=Ie.TRIANGLES);for(var He=0,ft=m;He<ft.length;He+=1){var Et=ft[He],Ht=h.getTile(Et);if(!Qe||Ht.patternsLoaded()){var vr=Ht.getBucket(f);if(vr){var rr=vr.programConfigurations.get(f.id),Ar=c.useProgram(W,rr);Qe&&(c.context.activeTexture.set(Ie.TEXTURE0),Ht.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),rr.updatePaintBuffers(nt));var Hr=Je.constantOr(null);if(Hr&&Ht.imageAtlas){var xn=Ht.imageAtlas,yn=xn.patternPositions[Hr.to.toString()],Zn=xn.patternPositions[Hr.from.toString()];yn&&Zn&&rr.setConstantPatternPositions(yn,Zn)}var _i=c.translatePosMatrix(Et.posMatrix,Ht,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){be=vr.indexBuffer2,Se=vr.segments2;var wi=[Ie.drawingBufferWidth,Ie.drawingBufferHeight];te=W==="fillOutlinePattern"&&Qe?dp(_i,c,nt,Ht,wi):Wo(_i,wi)}else be=vr.indexBuffer,Se=vr.segments,te=Qe?gl(_i,c,nt,Ht):Ol(_i);Ar.draw(c.context,z,S,c.stencilModeForClipping(Et),I,xt.disabled,te,f.id,vr.layoutVertexBuffer,be,Se,f.paint,c.transform.zoom,rr)}}}}function Hc(c,h,f,m,S,I,R){for(var z=c.context,W=z.gl,te=f.paint.get("fill-extrusion-pattern"),be=te.constantOr(1),Se=f.getCrossfadeParameters(),Ie=f.paint.get("fill-extrusion-opacity"),Je=0,Qe=m;Je<Qe.length;Je+=1){var nt=Qe[Je],He=h.getTile(nt),ft=He.getBucket(f);if(ft){var Et=ft.programConfigurations.get(f.id),Ht=c.useProgram(be?"fillExtrusionPattern":"fillExtrusion",Et);be&&(c.context.activeTexture.set(W.TEXTURE0),He.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Et.updatePaintBuffers(Se));var vr=te.constantOr(null);if(vr&&He.imageAtlas){var rr=He.imageAtlas,Ar=rr.patternPositions[vr.to.toString()],Hr=rr.patternPositions[vr.from.toString()];Ar&&Hr&&Et.setConstantPatternPositions(Ar,Hr)}var xn=c.translatePosMatrix(nt.posMatrix,He,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),yn=f.paint.get("fill-extrusion-vertical-gradient"),Zn=be?Du(xn,c,yn,Ie,nt,Se,He):vc(xn,c,yn,Ie);Ht.draw(z,z.gl.TRIANGLES,S,I,R,xt.backCCW,Zn,f.id,ft.layoutVertexBuffer,ft.indexBuffer,ft.segments,f.paint,c.transform.zoom,Et)}}}function Kl(c,h,f,m,S,I){var R=c.context,z=R.gl,W=h.fbo;if(W){var te=c.useProgram("hillshade");R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,W.colorAttachment.get());var be=function(Se,Ie,Je){var Qe=Je.paint.get("hillshade-shadow-color"),nt=Je.paint.get("hillshade-highlight-color"),He=Je.paint.get("hillshade-accent-color"),ft=Je.paint.get("hillshade-illumination-direction")*(Math.PI/180);Je.paint.get("hillshade-illumination-anchor")==="viewport"&&(ft-=Se.transform.angle);var Et,Ht,vr,rr=!Se.options.moving;return{u_matrix:Se.transform.calculatePosMatrix(Ie.tileID.toUnwrapped(),rr),u_image:0,u_latrange:(Et=Ie.tileID,Ht=Math.pow(2,Et.canonical.z),vr=Et.canonical.y,[new y.MercatorCoordinate(0,vr/Ht).toLngLat().lat,new y.MercatorCoordinate(0,(vr+1)/Ht).toLngLat().lat]),u_light:[Je.paint.get("hillshade-exaggeration"),ft],u_shadow:Qe,u_highlight:nt,u_accent:He}}(c,h,f);te.draw(R,z.TRIANGLES,m,S,I,xt.disabled,be,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function Yf(c,h,f,m,S,I){var R=c.context,z=R.gl,W=h.dem;if(W&&W.data){var te=W.dim,be=W.stride,Se=W.getPixels();if(R.activeTexture.set(z.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||c.getTileTexture(be),h.demTexture){var Ie=h.demTexture;Ie.update(Se,{premultiply:!1}),Ie.bind(z.NEAREST,z.CLAMP_TO_EDGE)}else h.demTexture=new y.Texture(R,Se,z.RGBA,{premultiply:!1}),h.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);R.activeTexture.set(z.TEXTURE0);var Je=h.fbo;if(!Je){var Qe=new y.Texture(R,{width:te,height:te,data:null},z.RGBA);Qe.bind(z.LINEAR,z.CLAMP_TO_EDGE),(Je=h.fbo=R.createFramebuffer(te,te,!0)).colorAttachment.set(Qe.texture)}R.bindFramebuffer.set(Je.framebuffer),R.viewport.set([0,0,te,te]),c.useProgram("hillshadePrepare").draw(R,z.TRIANGLES,m,S,I,xt.disabled,function(nt,He){var ft=He.stride,Et=y.create();return y.ortho(Et,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(Et,Et,[0,-y.EXTENT,0]),{u_matrix:Et,u_image:1,u_dimension:[ft,ft],u_zoom:nt.overscaledZ,u_unpack:He.getUnpackVector()}}(h.tileID,W),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function qf(c,h,f,m,S){var I=m.paint.get("raster-fade-duration");if(I>0){var R=y.browser.now(),z=(R-c.timeAdded)/I,W=h?(R-h.timeAdded)/I:-1,te=f.getSource(),be=S.coveringZoomLevel({tileSize:te.tileSize,roundZoom:te.roundZoom}),Se=!h||Math.abs(h.tileID.overscaledZ-be)>Math.abs(c.tileID.overscaledZ-be),Ie=Se&&c.refreshedUponExpiration?1:y.clamp(Se?z:1-W,0,1);return c.refreshedUponExpiration&&z>=1&&(c.refreshedUponExpiration=!1),h?{opacity:1,mix:1-Ie}:{opacity:Ie,mix:0}}return{opacity:1,mix:0}}var yc=new y.Color(1,0,0,1),Gh=new y.Color(0,1,0,1),fh=new y.Color(0,0,1,1),Wc=new y.Color(1,0,1,1),Vp=new y.Color(0,1,1,1);function hh(c,h,f,m){bf(c,0,h+f/2,c.transform.width,f,m)}function Hh(c,h,f,m){bf(c,h-f/2,0,f,c.transform.height,m)}function bf(c,h,f,m,S,I){var R=c.context,z=R.gl;z.enable(z.SCISSOR_TEST),z.scissor(h*y.browser.devicePixelRatio,f*y.browser.devicePixelRatio,m*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),R.clear({color:I}),z.disable(z.SCISSOR_TEST)}function jp(c,h,f){var m=c.context,S=m.gl,I=f.posMatrix,R=c.useProgram("debug"),z=ke.disabled,W=qe.disabled,te=c.colorModeForRenderPass();m.activeTexture.set(S.TEXTURE0),c.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R.draw(m,S.LINE_STRIP,z,W,te,xt.disabled,yl(I,y.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var be=h.getTileByID(f.key).latestRawTileData,Se=Math.floor((be&&be.byteLength||0)/1024),Ie=h.getTile(f).tileSize,Je=512/Math.min(Ie,512)*(f.overscaledZ/c.transform.zoom)*.5,Qe=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Qe+=" => "+f.overscaledZ),function(nt,He){nt.initDebugOverlayCanvas();var ft=nt.debugOverlayCanvas,Et=nt.context.gl,Ht=nt.debugOverlayCanvas.getContext("2d");Ht.clearRect(0,0,ft.width,ft.height),Ht.shadowColor="white",Ht.shadowBlur=2,Ht.lineWidth=1.5,Ht.strokeStyle="white",Ht.textBaseline="top",Ht.font="bold 36px Open Sans, sans-serif",Ht.fillText(He,5,5),Ht.strokeText(He,5,5),nt.debugOverlayTexture.update(ft),nt.debugOverlayTexture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE)}(c,Qe+" "+Se+"kb"),R.draw(m,S.TRIANGLES,z,W,st.alphaBlended,xt.disabled,yl(I,y.Color.transparent,Je),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var Xc={symbol:function(c,h,f,m,S){if(c.renderPass==="translucent"){var I=qe.disabled,R=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(z,W,te,be,Se,Ie,Je){for(var Qe=W.transform,nt=Se==="map",He=Ie==="map",ft=0,Et=z;ft<Et.length;ft+=1){var Ht=Et[ft],vr=be.getTile(Ht),rr=vr.getBucket(te);if(rr&&rr.text&&rr.text.segments.get().length){var Ar=y.evaluateSizeForZoom(rr.textSizeData,Qe.zoom),Hr=_a(vr,1,W.transform.zoom),xn=fo(Ht.posMatrix,He,nt,W.transform,Hr),yn=te.layout.get("icon-text-fit")!=="none"&&rr.hasIconData();if(Ar){var Zn=Math.pow(2,Qe.zoom-vr.tileID.overscaledZ);Xf(rr,nt,He,Je,y.symbolSize,Qe,xn,Ht.posMatrix,Zn,Ar,yn)}}}}(m,c,f,h,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&gc(c,h,f,m,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),I,R),f.paint.get("text-opacity").constantOr(1)!==0&&gc(c,h,f,m,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),I,R),h.map.showCollisionBoxes&&($l(c,h,f,m,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),$l(c,h,f,m,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,h,f,m){if(c.renderPass==="translucent"){var S=f.paint.get("circle-opacity"),I=f.paint.get("circle-stroke-width"),R=f.paint.get("circle-stroke-opacity"),z=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||I.constantOr(1)!==0&&R.constantOr(1)!==0){for(var W=c.context,te=W.gl,be=c.depthModeForSublayer(0,ke.ReadOnly),Se=qe.disabled,Ie=c.colorModeForRenderPass(),Je=[],Qe=0;Qe<m.length;Qe++){var nt=m[Qe],He=h.getTile(nt),ft=He.getBucket(f);if(ft){var Et=ft.programConfigurations.get(f.id),Ht={programConfiguration:Et,program:c.useProgram("circle",Et),layoutVertexBuffer:ft.layoutVertexBuffer,indexBuffer:ft.indexBuffer,uniformValues:Uh(c,nt,He,f)};if(z)for(var vr=0,rr=ft.segments.get();vr<rr.length;vr+=1){var Ar=rr[vr];Je.push({segments:new y.SegmentVector([Ar]),sortKey:Ar.sortKey,state:Ht})}else Je.push({segments:ft.segments,sortKey:0,state:Ht})}}z&&Je.sort(function(_i,wi){return _i.sortKey-wi.sortKey});for(var Hr=0,xn=Je;Hr<xn.length;Hr+=1){var yn=xn[Hr],Zn=yn.state;Zn.program.draw(W,te.TRIANGLES,be,Se,Ie,xt.disabled,Zn.uniformValues,f.id,Zn.layoutVertexBuffer,Zn.indexBuffer,yn.segments,f.paint,c.transform.zoom,Zn.programConfiguration)}}}},heatmap:function(c,h,f,m){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var S=c.context,I=S.gl,R=qe.disabled,z=new st([I.ONE,I.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Je,Qe,nt){var He=Je.gl;Je.activeTexture.set(He.TEXTURE1),Je.viewport.set([0,0,Qe.width/4,Qe.height/4]);var ft=nt.heatmapFbo;if(ft)He.bindTexture(He.TEXTURE_2D,ft.colorAttachment.get()),Je.bindFramebuffer.set(ft.framebuffer);else{var Et=He.createTexture();He.bindTexture(He.TEXTURE_2D,Et),He.texParameteri(He.TEXTURE_2D,He.TEXTURE_WRAP_S,He.CLAMP_TO_EDGE),He.texParameteri(He.TEXTURE_2D,He.TEXTURE_WRAP_T,He.CLAMP_TO_EDGE),He.texParameteri(He.TEXTURE_2D,He.TEXTURE_MIN_FILTER,He.LINEAR),He.texParameteri(He.TEXTURE_2D,He.TEXTURE_MAG_FILTER,He.LINEAR),ft=nt.heatmapFbo=Je.createFramebuffer(Qe.width/4,Qe.height/4,!1),function(Ht,vr,rr,Ar){var Hr=Ht.gl;Hr.texImage2D(Hr.TEXTURE_2D,0,Hr.RGBA,vr.width/4,vr.height/4,0,Hr.RGBA,Ht.extRenderToTextureHalfFloat?Ht.extTextureHalfFloat.HALF_FLOAT_OES:Hr.UNSIGNED_BYTE,null),Ar.colorAttachment.set(rr)}(Je,Qe,Et,ft)}})(S,c,f),S.clear({color:y.Color.transparent});for(var W=0;W<m.length;W++){var te=m[W];if(!h.hasRenderableParent(te)){var be=h.getTile(te),Se=be.getBucket(f);if(Se){var Ie=Se.programConfigurations.get(f.id);c.useProgram("heatmap",Ie).draw(S,I.TRIANGLES,ke.disabled,R,z,xt.disabled,Zh(te.posMatrix,be,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,f.paint,c.transform.zoom,Ie)}}}S.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(Je,Qe){var nt=Je.context,He=nt.gl,ft=Qe.heatmapFbo;if(ft){nt.activeTexture.set(He.TEXTURE0),He.bindTexture(He.TEXTURE_2D,ft.colorAttachment.get()),nt.activeTexture.set(He.TEXTURE1);var Et=Qe.colorRampTexture;Et||(Et=Qe.colorRampTexture=new y.Texture(nt,Qe.colorRamp,He.RGBA)),Et.bind(He.LINEAR,He.CLAMP_TO_EDGE),Je.useProgram("heatmapTexture").draw(nt,He.TRIANGLES,ke.disabled,qe.disabled,Je.colorModeForRenderPass(),xt.disabled,function(Ht,vr,rr,Ar){var Hr=y.create();y.ortho(Hr,0,Ht.width,Ht.height,0,0,1);var xn=Ht.context.gl;return{u_matrix:Hr,u_world:[xn.drawingBufferWidth,xn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:vr.paint.get("heatmap-opacity")}}(Je,Qe),Qe.id,Je.viewportBuffer,Je.quadTriangleIndexBuffer,Je.viewportSegments,Qe.paint,Je.transform.zoom)}}(c,f))},line:function(c,h,f,m){if(c.renderPass==="translucent"){var S=f.paint.get("line-opacity"),I=f.paint.get("line-width");if(S.constantOr(1)!==0&&I.constantOr(1)!==0)for(var R=c.depthModeForSublayer(0,ke.ReadOnly),z=c.colorModeForRenderPass(),W=f.paint.get("line-dasharray"),te=f.paint.get("line-pattern"),be=te.constantOr(1),Se=f.paint.get("line-gradient"),Ie=f.getCrossfadeParameters(),Je=be?"linePattern":W?"lineSDF":Se?"lineGradient":"line",Qe=c.context,nt=Qe.gl,He=!0,ft=0,Et=m;ft<Et.length;ft+=1){var Ht=Et[ft],vr=h.getTile(Ht);if(!be||vr.patternsLoaded()){var rr=vr.getBucket(f);if(rr){var Ar=rr.programConfigurations.get(f.id),Hr=c.context.program.get(),xn=c.useProgram(Je,Ar),yn=He||xn.program!==Hr,Zn=te.constantOr(null);if(Zn&&vr.imageAtlas){var _i=vr.imageAtlas,wi=_i.patternPositions[Zn.to.toString()],Ei=_i.patternPositions[Zn.from.toString()];wi&&Ei&&Ar.setConstantPatternPositions(wi,Ei)}var wa=be?$s(c,vr,f,Ie):W?Vh(c,vr,f,W,Ie):Se?mo(c,vr,f,rr.lineClipsArray.length):_l(c,vr,f);if(be)Qe.activeTexture.set(nt.TEXTURE0),vr.imageAtlasTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),Ar.updatePaintBuffers(Ie);else if(W&&(yn||c.lineAtlas.dirty))Qe.activeTexture.set(nt.TEXTURE0),c.lineAtlas.bind(Qe);else if(Se){var Wn=rr.gradients[f.id],Gi=Wn.texture;if(f.gradientVersion!==Wn.version){var Ji=256;if(f.stepInterpolant){var Yi=h.getSource().maxzoom,Ri=Ht.canonical.z===Yi?Math.ceil(1<<c.transform.maxZoom-Ht.canonical.z):1;Ji=y.clamp(y.nextPowerOfTwo(rr.maxLineLength/y.EXTENT*1024*Ri),256,Qe.maxTextureSize)}Wn.gradient=y.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Ji,image:Wn.gradient||void 0,clips:rr.lineClipsArray}),Wn.texture?Wn.texture.update(Wn.gradient):Wn.texture=new y.Texture(Qe,Wn.gradient,nt.RGBA),Wn.version=f.gradientVersion,Gi=Wn.texture}Qe.activeTexture.set(nt.TEXTURE0),Gi.bind(f.stepInterpolant?nt.NEAREST:nt.LINEAR,nt.CLAMP_TO_EDGE)}xn.draw(Qe,nt.TRIANGLES,R,c.stencilModeForClipping(Ht),z,xt.disabled,wa,f.id,rr.layoutVertexBuffer,rr.indexBuffer,rr.segments,f.paint,c.transform.zoom,Ar,rr.layoutVertexBuffer2),He=!1}}}}},fill:function(c,h,f,m){var S=f.paint.get("fill-color"),I=f.paint.get("fill-opacity");if(I.constantOr(1)!==0){var R=c.colorModeForRenderPass(),z=f.paint.get("fill-pattern"),W=c.opaquePassEnabledForLayer()&&!z.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===W){var te=c.depthModeForSublayer(1,c.renderPass==="opaque"?ke.ReadWrite:ke.ReadOnly);Fl(c,h,f,m,te,R,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var be=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,ke.ReadOnly);Fl(c,h,f,m,be,R,!0)}}},"fill-extrusion":function(c,h,f,m){var S=f.paint.get("fill-extrusion-opacity");if(S!==0&&c.renderPass==="translucent"){var I=new ke(c.context.gl.LEQUAL,ke.ReadWrite,c.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Hc(c,h,f,m,I,qe.disabled,st.disabled),Hc(c,h,f,m,I,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var R=c.colorModeForRenderPass();Hc(c,h,f,m,I,qe.disabled,R)}}},hillshade:function(c,h,f,m){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var S=c.context,I=c.depthModeForSublayer(0,ke.ReadOnly),R=c.colorModeForRenderPass(),z=c.renderPass==="translucent"?c.stencilConfigForOverlap(m):[{},m],W=z[0],te=0,be=z[1];te<be.length;te+=1){var Se=be[te],Ie=h.getTile(Se);Ie.needsHillshadePrepare&&c.renderPass==="offscreen"?Yf(c,Ie,f,I,qe.disabled,R):c.renderPass==="translucent"&&Kl(c,Ie,f,I,W[Se.overscaledZ],R)}S.viewport.set([0,0,c.width,c.height])}},raster:function(c,h,f,m){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&m.length)for(var S=c.context,I=S.gl,R=h.getSource(),z=c.useProgram("raster"),W=c.colorModeForRenderPass(),te=R instanceof Ut?[{},m]:c.stencilConfigForOverlap(m),be=te[0],Se=te[1],Ie=Se[Se.length-1].overscaledZ,Je=!c.options.moving,Qe=0,nt=Se;Qe<nt.length;Qe+=1){var He=nt[Qe],ft=c.depthModeForSublayer(He.overscaledZ-Ie,f.paint.get("raster-opacity")===1?ke.ReadWrite:ke.ReadOnly,I.LESS),Et=h.getTile(He),Ht=c.transform.calculatePosMatrix(He.toUnwrapped(),Je);Et.registerFadeDuration(f.paint.get("raster-fade-duration"));var vr=h.findLoadedParent(He,0),rr=qf(Et,vr,h,f,c.transform),Ar=void 0,Hr=void 0,xn=f.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;S.activeTexture.set(I.TEXTURE0),Et.texture.bind(xn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(I.TEXTURE1),vr?(vr.texture.bind(xn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),Ar=Math.pow(2,vr.tileID.overscaledZ-Et.tileID.overscaledZ),Hr=[Et.tileID.canonical.x*Ar%1,Et.tileID.canonical.y*Ar%1]):Et.texture.bind(xn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);var yn=mp(Ht,Hr||[0,0],Ar||1,rr,f);R instanceof Ut?z.draw(S,I.TRIANGLES,ft,qe.disabled,W,xt.disabled,yn,f.id,R.boundsBuffer,c.quadTriangleIndexBuffer,R.boundsSegments):z.draw(S,I.TRIANGLES,ft,be[He.overscaledZ],W,xt.disabled,yn,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,h,f){var m=f.paint.get("background-color"),S=f.paint.get("background-opacity");if(S!==0){var I=c.context,R=I.gl,z=c.transform,W=z.tileSize,te=f.paint.get("background-pattern");if(!c.isPatternMissing(te)){var be=!te&&m.a===1&&S===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===be){var Se=qe.disabled,Ie=c.depthModeForSublayer(0,be==="opaque"?ke.ReadWrite:ke.ReadOnly),Je=c.colorModeForRenderPass(),Qe=c.useProgram(te?"backgroundPattern":"background"),nt=z.coveringTiles({tileSize:W});te&&(I.activeTexture.set(R.TEXTURE0),c.imageManager.bind(c.context));for(var He=f.getCrossfadeParameters(),ft=0,Et=nt;ft<Et.length;ft+=1){var Ht=Et[ft],vr=c.transform.calculatePosMatrix(Ht.toUnwrapped()),rr=te?mc(vr,S,c,te,{tileID:Ht,tileSize:W},He):Hf(vr,S,m);Qe.draw(I,R.TRIANGLES,Ie,Se,Je,xt.disabled,rr,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,h,f){for(var m=0;m<f.length;m++)jp(c,h,f[m])},custom:function(c,h,f){var m=c.context,S=f.implementation;if(c.renderPass==="offscreen"){var I=S.prerender;I&&(c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),I.call(S,m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),m.setColorMode(c.colorModeForRenderPass()),m.setStencilMode(qe.disabled);var R=S.renderingMode==="3d"?new ke(c.context.gl.LEQUAL,ke.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,ke.ReadOnly);m.setDepthMode(R),S.render(m.gl,c.transform.customLayerMatrix()),m.setDirty(),c.setBaseState(),m.bindFramebuffer.set(null)}}},Ao=function(c,h){this.context=new Me(c),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=it.maxUnderzooming+it.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new hs,this.gpuTimers={}};Ao.prototype.resize=function(c,h){if(this.width=c*y.browser.devicePixelRatio,this.height=h*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,m=this.style._order;f<m.length;f+=1)this.style._layers[m[f]].resize()},Ao.prototype.setup=function(){var c=this.context,h=new y.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(y.EXTENT,0),h.emplaceBack(0,y.EXTENT),h.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,Za.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var f=new y.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(y.EXTENT,0),f.emplaceBack(0,y.EXTENT),f.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=c.createVertexBuffer(f,Za.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var m=new y.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(y.EXTENT,0,y.EXTENT,0),m.emplaceBack(0,y.EXTENT,0,y.EXTENT),m.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(m,St.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,Za.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var I=new y.StructArrayLayout1ui2;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(I);var R=new y.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(R),this.emptyTexture=new y.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var z=this.context.gl;this.stencilClearMode=new qe({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)},Ao.prototype.clearStencil=function(){var c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=y.create();y.ortho(f,0,this.width,this.height,0,0,1),y.scale(f,f,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,h.TRIANGLES,ke.disabled,this.stencilClearMode,st.disabled,xt.disabled,qu(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ao.prototype._renderTileClippingMasks=function(c,h){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&h&&h.length){this.currentStencilSource=c.source;var f=this.context,m=f.gl;this.nextStencilID+h.length>256&&this.clearStencil(),f.setColorMode(st.disabled),f.setDepthMode(ke.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var I=0,R=h;I<R.length;I+=1){var z=R[I],W=this._tileClippingMaskIDs[z.key]=this.nextStencilID++;S.draw(f,m.TRIANGLES,ke.disabled,new qe({func:m.ALWAYS,mask:0},W,255,m.KEEP,m.KEEP,m.REPLACE),st.disabled,xt.disabled,qu(z.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ao.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,h=this.context.gl;return new qe({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)},Ao.prototype.stencilModeForClipping=function(c){var h=this.context.gl;return new qe({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)},Ao.prototype.stencilConfigForOverlap=function(c){var h,f=this.context.gl,m=c.sort(function(W,te){return te.overscaledZ-W.overscaledZ}),S=m[m.length-1].overscaledZ,I=m[0].overscaledZ-S+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();for(var R={},z=0;z<I;z++)R[z+S]=new qe({func:f.GEQUAL,mask:255},z+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=I,[R,m]}return[(h={},h[S]=qe.disabled,h),m]},Ao.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new st([c.CONSTANT_COLOR,c.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?st.unblended:st.alphaBlended},Ao.prototype.depthModeForSublayer=function(c,h,f){if(!this.opaquePassEnabledForLayer())return ke.disabled;var m=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new ke(f||this.context.gl.LEQUAL,h,[m,m])},Ao.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ao.prototype.render=function(c,h){var f=this;this.style=c,this.options=h,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var m=this.style._order,S=this.style.sourceCaches;for(var I in S){var R=S[I];R.used&&R.prepare(this.context)}var z,W,te={},be={},Se={};for(var Ie in S){var Je=S[Ie];te[Ie]=Je.getVisibleCoordinates(),be[Ie]=te[Ie].slice().reverse(),Se[Ie]=Je.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Qe=0;Qe<m.length;Qe++)if(this.style._layers[m[Qe]].is3D()){this.opaquePassCutoff=Qe;break}this.renderPass="offscreen";for(var nt=0,He=m;nt<He.length;nt+=1){var ft=this.style._layers[He[nt]];if(ft.hasOffscreenPass()&&!ft.isHidden(this.transform.zoom)){var Et=be[ft.source];(ft.type==="custom"||Et.length)&&this.renderLayer(this,S[ft.source],ft,Et)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){var Ht=this.style._layers[m[this.currentLayer]],vr=S[Ht.source],rr=te[Ht.source];this._renderTileClippingMasks(Ht,rr),this.renderLayer(this,vr,Ht,rr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){var Ar=this.style._layers[m[this.currentLayer]],Hr=S[Ar.source],xn=(Ar.type==="symbol"?Se:be)[Ar.source];this._renderTileClippingMasks(Ar,te[Ar.source]),this.renderLayer(this,Hr,Ar,xn)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(yn){yn.source&&!yn.isHidden(f.transform.zoom)&&(yn.source!==(W&&W.id)&&(W=f.style.sourceCaches[yn.source]),(!z||z.getSource().maxzoom<W.getSource().maxzoom)&&(z=W))}),z&&Xc.debug(this,z,z.getVisibleCoordinates())),this.options.showPadding&&function(yn){var Zn=yn.transform.padding;hh(yn,yn.transform.height-(Zn.top||0),3,yc),hh(yn,Zn.bottom||0,3,Gh),Hh(yn,Zn.left||0,3,fh),Hh(yn,yn.transform.width-(Zn.right||0),3,Wc);var _i=yn.transform.centerPoint;(function(wi,Ei,wa,Wn){bf(wi,Ei-1,wa-10,2,20,Wn),bf(wi,Ei-10,wa-1,20,2,Wn)})(yn,_i.x,yn.transform.height-_i.y,Vp)}(this),this.context.setDefault()},Ao.prototype.renderLayer=function(c,h,f,m){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||m.length)&&(this.id=f.id,this.gpuTimingStart(f),Xc[f.type](c,h,f,m,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ao.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var h=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),f.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,f.query)}},Ao.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Ao.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Ao.prototype.queryGpuTimers=function(c){var h={};for(var f in c){var m=c[f],S=this.context.extTimerQuery,I=S.getQueryObjectEXT(m.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(m.query),h[f]=I}return h},Ao.prototype.translatePosMatrix=function(c,h,f,m,S){if(!f[0]&&!f[1])return c;var I=S?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(I){var R=Math.sin(I),z=Math.cos(I);f=[f[0]*z-f[1]*R,f[0]*R+f[1]*z]}var W=[S?f[0]:_a(h,f[0],this.transform.zoom),S?f[1]:_a(h,f[1],this.transform.zoom),0],te=new Float32Array(16);return y.translate(te,c,W),te},Ao.prototype.saveTileTexture=function(c){var h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]},Ao.prototype.getTileTexture=function(c){var h=this._tileTextures[c];return h&&h.length>0?h.pop():null},Ao.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var h=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!h||!f},Ao.prototype.useProgram=function(c,h){this.cache=this.cache||{};var f=""+c+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new pc(this.context,c,au[c],h,xf[c],this._showOverdrawInspector)),this.cache[f]},Ao.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ao.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Ao.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ao.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Us=function(c,h){this.points=c,this.planes=h};Us.fromInvProjectionMatrix=function(c,h,f){var m=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return y.transformMat4([],R,c)}).map(function(R){return y.scale$1([],R,1/R[3]/h*m)}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var z=y.sub([],S[R[0]],S[R[1]]),W=y.sub([],S[R[2]],S[R[1]]),te=y.normalize([],y.cross([],z,W)),be=-y.dot(te,S[R[1]]);return te.concat(be)});return new Us(S,I)};var Yc=function(c,h){this.min=c,this.max=h,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Yc.prototype.quadrant=function(c){for(var h=[c%2==0,c<2],f=y.clone$2(this.min),m=y.clone$2(this.max),S=0;S<h.length;S++)f[S]=h[S]?this.min[S]:this.center[S],m[S]=h[S]?this.center[S]:this.max[S];return m[2]=this.max[2],new Yc(f,m)},Yc.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},Yc.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},Yc.prototype.intersects=function(c){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,m=0;m<c.planes.length;m++){for(var S=c.planes[m],I=0,R=0;R<h.length;R++)I+=y.dot$1(S,h[R])>=0;if(I===0)return 0;I!==h.length&&(f=!1)}if(f)return 2;for(var z=0;z<3;z++){for(var W=Number.MAX_VALUE,te=-Number.MAX_VALUE,be=0;be<c.points.length;be++){var Se=c.points[be][z]-this.min[z];W=Math.min(W,Se),te=Math.max(te,Se)}if(te<0||W>this.max[z]-this.min[z])return 0}return 1};var ka=function(c,h,f,m){if(c===void 0&&(c=0),h===void 0&&(h=0),f===void 0&&(f=0),m===void 0&&(m=0),isNaN(c)||c<0||isNaN(h)||h<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=f,this.right=m};ka.prototype.interpolate=function(c,h,f){return h.top!=null&&c.top!=null&&(this.top=y.number(c.top,h.top,f)),h.bottom!=null&&c.bottom!=null&&(this.bottom=y.number(c.bottom,h.bottom,f)),h.left!=null&&c.left!=null&&(this.left=y.number(c.left,h.left,f)),h.right!=null&&c.right!=null&&(this.right=y.number(c.right,h.right,f)),this},ka.prototype.getCenter=function(c,h){var f=y.clamp((this.left+c-this.right)/2,0,c),m=y.clamp((this.top+h-this.bottom)/2,0,h);return new y.Point(f,m)},ka.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},ka.prototype.clone=function(){return new ka(this.top,this.bottom,this.left,this.right)},ka.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Aa=function(c,h,f,m,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=f==null?0:f,this._maxPitch=m==null?60:m,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ka,this._posMatrixCache={},this._alignedPosMatrixCache={}},wo={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Aa.prototype.clone=function(){var c=new Aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},wo.minZoom.get=function(){return this._minZoom},wo.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},wo.maxZoom.get=function(){return this._maxZoom},wo.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},wo.minPitch.get=function(){return this._minPitch},wo.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},wo.maxPitch.get=function(){return this._maxPitch},wo.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},wo.renderWorldCopies.get=function(){return this._renderWorldCopies},wo.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},wo.worldSize.get=function(){return this.tileSize*this.scale},wo.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},wo.size.get=function(){return new y.Point(this.width,this.height)},wo.bearing.get=function(){return-this.angle/Math.PI*180},wo.bearing.set=function(c){var h=-y.wrap(c,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},wo.pitch.get=function(){return this._pitch/Math.PI*180},wo.pitch.set=function(c){var h=y.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},wo.fov.get=function(){return this._fov/Math.PI*180},wo.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},wo.zoom.get=function(){return this._zoom},wo.zoom.set=function(c){var h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},wo.center.get=function(){return this._center},wo.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},wo.padding.get=function(){return this._edgeInsets.toJSON()},wo.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},wo.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Aa.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},Aa.prototype.interpolatePadding=function(c,h,f){this._unmodified=!1,this._edgeInsets.interpolate(c,h,f),this._constrain(),this._calcMatrices()},Aa.prototype.coveringZoomLevel=function(c){var h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)},Aa.prototype.getVisibleUnwrappedCoordinates=function(c){var h=[new y.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new y.Point(0,0)),m=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),I=this.pointCoordinate(new y.Point(0,this.height)),R=Math.floor(Math.min(f.x,m.x,S.x,I.x)),z=Math.floor(Math.max(f.x,m.x,S.x,I.x)),W=R-1;W<=z+1;W++)W!==0&&h.push(new y.UnwrappedTileID(W,c));return h},Aa.prototype.coveringTiles=function(c){var h=this.coveringZoomLevel(c),f=h;if(c.minzoom!==void 0&&h<c.minzoom)return[];c.maxzoom!==void 0&&h>c.maxzoom&&(h=c.maxzoom);var m=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,h),I=[S*m.x,S*m.y,0],R=Us.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),z=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(z=h);var W=function(yn){return{aabb:new Yc([yn*S,0,0],[(yn+1)*S,S,0]),zoom:0,x:0,y:0,wrap:yn,fullyVisible:!1}},te=[],be=[],Se=h,Ie=c.reparseOverscaled?f:h;if(this._renderWorldCopies)for(var Je=1;Je<=3;Je++)te.push(W(-Je)),te.push(W(Je));for(te.push(W(0));te.length>0;){var Qe=te.pop(),nt=Qe.x,He=Qe.y,ft=Qe.fullyVisible;if(!ft){var Et=Qe.aabb.intersects(R);if(Et===0)continue;ft=Et===2}var Ht=Qe.aabb.distanceX(I),vr=Qe.aabb.distanceY(I),rr=Math.max(Math.abs(Ht),Math.abs(vr));if(Qe.zoom===Se||rr>3+(1<<Se-Qe.zoom)-2&&Qe.zoom>=z)be.push({tileID:new y.OverscaledTileID(Qe.zoom===Se?Ie:Qe.zoom,Qe.wrap,Qe.zoom,nt,He),distanceSq:y.sqrLen([I[0]-.5-nt,I[1]-.5-He])});else for(var Ar=0;Ar<4;Ar++){var Hr=(nt<<1)+Ar%2,xn=(He<<1)+(Ar>>1);te.push({aabb:Qe.aabb.quadrant(Ar),zoom:Qe.zoom+1,x:Hr,y:xn,wrap:Qe.wrap,fullyVisible:ft})}}return be.sort(function(yn,Zn){return yn.distanceSq-Zn.distanceSq}).map(function(yn){return yn.tileID})},Aa.prototype.resize=function(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()},wo.unmodified.get=function(){return this._unmodified},Aa.prototype.zoomScale=function(c){return Math.pow(2,c)},Aa.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},Aa.prototype.project=function(c){var h=y.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(c.lng)*this.worldSize,y.mercatorYfromLat(h)*this.worldSize)},Aa.prototype.unproject=function(c){return new y.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},wo.point.get=function(){return this.project(this.center)},Aa.prototype.setLocationAtPoint=function(c,h){var f=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(c),I=new y.MercatorCoordinate(S.x-(f.x-m.x),S.y-(f.y-m.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())},Aa.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},Aa.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},Aa.prototype.locationCoordinate=function(c){return y.MercatorCoordinate.fromLngLat(c)},Aa.prototype.coordinateLocation=function(c){return c.toLngLat()},Aa.prototype.pointCoordinate=function(c){var h=[c.x,c.y,0,1],f=[c.x,c.y,1,1];y.transformMat4(h,h,this.pixelMatrixInverse),y.transformMat4(f,f,this.pixelMatrixInverse);var m=h[3],S=f[3],I=h[1]/m,R=f[1]/S,z=h[2]/m,W=f[2]/S,te=z===W?0:(0-z)/(W-z);return new y.MercatorCoordinate(y.number(h[0]/m,f[0]/S,te)/this.worldSize,y.number(I,R,te)/this.worldSize)},Aa.prototype.coordinatePoint=function(c){var h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return y.transformMat4(h,h,this.pixelMatrix),new y.Point(h[0]/h[3],h[1]/h[3])},Aa.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Aa.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Aa.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Aa.prototype.calculatePosMatrix=function(c,h){h===void 0&&(h=!1);var f=c.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[f])return m[f];var S=c.canonical,I=this.worldSize/this.zoomScale(S.z),R=S.x+Math.pow(2,S.z)*c.wrap,z=y.identity(new Float64Array(16));return y.translate(z,z,[R*I,S.y*I,0]),y.scale(z,z,[I/y.EXTENT,I/y.EXTENT,1]),y.multiply(z,h?this.alignedProjMatrix:this.projMatrix,z),m[f]=new Float32Array(z),m[f]},Aa.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Aa.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,h,f,m,S=-90,I=90,R=-180,z=180,W=this.size,te=this._unmodified;if(this.latRange){var be=this.latRange;S=y.mercatorYfromLat(be[1])*this.worldSize,c=(I=y.mercatorYfromLat(be[0])*this.worldSize)-S<W.y?W.y/(I-S):0}if(this.lngRange){var Se=this.lngRange;R=y.mercatorXfromLng(Se[0])*this.worldSize,h=(z=y.mercatorXfromLng(Se[1])*this.worldSize)-R<W.x?W.x/(z-R):0}var Ie=this.point,Je=Math.max(h||0,c||0);if(Je)return this.center=this.unproject(new y.Point(h?(z+R)/2:Ie.x,c?(I+S)/2:Ie.y)),this.zoom+=this.scaleZoom(Je),this._unmodified=te,void(this._constraining=!1);if(this.latRange){var Qe=Ie.y,nt=W.y/2;Qe-nt<S&&(m=S+nt),Qe+nt>I&&(m=I-nt)}if(this.lngRange){var He=Ie.x,ft=W.x/2;He-ft<R&&(f=R+ft),He+ft>z&&(f=z-ft)}f===void 0&&m===void 0||(this.center=this.unproject(new y.Point(f!==void 0?f:Ie.x,m!==void 0?m:Ie.y))),this._unmodified=te,this._constraining=!1}},Aa.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),m=Math.sin(f)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-h-f,.01,Math.PI-.01)),S=this.point,I=S.x,R=S.y,z=1.01*(Math.cos(Math.PI/2-this._pitch)*m+this.cameraToCenterDistance),W=this.height/50,te=new Float64Array(16);y.perspective(te,this._fov,this.width/this.height,W,z),te[8]=2*-c.x/this.width,te[9]=2*c.y/this.height,y.scale(te,te,[1,-1,1]),y.translate(te,te,[0,0,-this.cameraToCenterDistance]),y.rotateX(te,te,this._pitch),y.rotateZ(te,te,this.angle),y.translate(te,te,[-I,-R,0]),this.mercatorMatrix=y.scale([],te,[this.worldSize,this.worldSize,this.worldSize]),y.scale(te,te,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=te,this.invProjMatrix=y.invert([],this.projMatrix);var be=this.width%2/2,Se=this.height%2/2,Ie=Math.cos(this.angle),Je=Math.sin(this.angle),Qe=I-Math.round(I)+Ie*be+Je*Se,nt=R-Math.round(R)+Ie*Se+Je*be,He=new Float64Array(te);if(y.translate(He,He,[Qe>.5?Qe-1:Qe,nt>.5?nt-1:nt,0]),this.alignedProjMatrix=He,te=y.create(),y.scale(te,te,[this.width/2,-this.height/2,1]),y.translate(te,te,[1,-1,0]),this.labelPlaneMatrix=te,te=y.create(),y.scale(te,te,[1,-1,1]),y.translate(te,te,[-1,-1,0]),y.scale(te,te,[2/this.width,2/this.height,1]),this.glCoordMatrix=te,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(te=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=te,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Aa.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new y.Point(0,0)),h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return y.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},Aa.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,c))},Aa.prototype.getCameraQueryGeometry=function(c){var h=this.getCameraPoint();if(c.length===1)return[c[0],h];for(var f=h.x,m=h.y,S=h.x,I=h.y,R=0,z=c;R<z.length;R+=1){var W=z[R];f=Math.min(f,W.x),m=Math.min(m,W.y),S=Math.max(S,W.x),I=Math.max(I,W.y)}return[new y.Point(f,m),new y.Point(S,m),new y.Point(S,I),new y.Point(f,I),new y.Point(f,m)]},Object.defineProperties(Aa.prototype,wo);var pu=function(c){var h,f,m,S;this._hashName=c&&encodeURIComponent(c),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),f=!1,m=null,S=function(){m=null,f&&(h(),m=setTimeout(S,300),f=!1)},function(){return f=!0,m||S(),m})};pu.prototype.addTo=function(c){return this._map=c,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},pu.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},pu.prototype.getHashString=function(c){var h=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,m),I=Math.round(h.lng*S)/S,R=Math.round(h.lat*S)/S,z=this._map.getBearing(),W=this._map.getPitch(),te="";if(te+=c?"/"+I+"/"+R+"/"+f:f+"/"+R+"/"+I,(z||W)&&(te+="/"+Math.round(10*z)/10),W&&(te+="/"+Math.round(W)),this._hashName){var be=this._hashName,Se=!1,Ie=y.window.location.hash.slice(1).split("&").map(function(Je){var Qe=Je.split("=")[0];return Qe===be?(Se=!0,Qe+"="+te):Je}).filter(function(Je){return Je});return Se||Ie.push(be+"="+te),"#"+Ie.join("&")}return"#"+te},pu.prototype._getCurrentHash=function(){var c,h=this,f=y.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(m){return m.split("=")}).forEach(function(m){m[0]===h._hashName&&(c=m)}),(c&&c[1]||"").split("/")):f.split("/")},pu.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:h,pitch:+(c[4]||0)}),!0}return!1},pu.prototype._updateHashUnthrottled=function(){var c=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,c)}catch(h){}};var Ef={linearity:.3,easing:y.bezier(0,0,.3,1)},Ql=y.extend({deceleration:2500,maxSpeed:1400},Ef),ph=y.extend({deceleration:20,maxSpeed:1400},Ef),Qa=y.extend({deceleration:1e3,maxSpeed:360},Ef),Cf=y.extend({deceleration:1e3,maxSpeed:90},Ef),Dl=function(c){this._map=c,this.clear()};function _c(c,h){(!c.duration||c.duration<h.duration)&&(c.duration=h.duration,c.easing=h.easing)}function Jl(c,h,f){var m=f.maxSpeed,S=f.linearity,I=f.deceleration,R=y.clamp(c*S/(h/1e3),-m,m),z=Math.abs(R)/(I*S);return{easing:f.easing,duration:1e3*z,amount:R*(z/2)}}Dl.prototype.clear=function(){this._inertiaBuffer=[]},Dl.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:c})},Dl.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,h=y.browser.now();c.length>0&&h-c[0].time>160;)c.shift()},Dl.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},f=0,m=this._inertiaBuffer;f<m.length;f+=1){var S=m[f].settings;h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround)}var I=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(h.pan.mag()){var z=Jl(h.pan.mag(),I,y.extend({},Ql,c||{}));R.offset=h.pan.mult(z.amount/h.pan.mag()),R.center=this._map.transform.center,_c(R,z)}if(h.zoom){var W=Jl(h.zoom,I,ph);R.zoom=this._map.transform.zoom+W.amount,_c(R,W)}if(h.bearing){var te=Jl(h.bearing,I,Qa);R.bearing=this._map.transform.bearing+y.clamp(te.amount,-179,179),_c(R,te)}if(h.pitch){var be=Jl(h.pitch,I,Cf);R.pitch=this._map.transform.pitch+be.amount,_c(R,be)}if(R.zoom||R.bearing){var Se=h.pinchAround===void 0?h.around:h.pinchAround;R.around=Se?this._map.unproject(Se):this._map.getCenter()}return this.clear(),y.extend(R,{noMoveStart:!0})}};var ds=function(c){function h(m,S,I,R){R===void 0&&(R={});var z=K.mousePos(S.getCanvasContainer(),I),W=S.unproject(z);c.call(this,m,y.extend({point:z,lngLat:W,originalEvent:I},R)),this._defaultPrevented=!1,this.target=S}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(y.Event),Ku=function(c){function h(m,S,I){var R=m==="touchend"?I.changedTouches:I.touches,z=K.touchPos(S.getCanvasContainer(),R),W=z.map(function(Se){return S.unproject(Se)}),te=z.reduce(function(Se,Ie,Je,Qe){return Se.add(Ie.div(Qe.length))},new y.Point(0,0)),be=S.unproject(te);c.call(this,m,{points:z,point:te,lngLats:W,lngLat:be,originalEvent:I}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(y.Event),Sf=function(c){function h(m,S,I){c.call(this,m,{originalEvent:I}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(y.Event),Vo=function(c,h){this._map=c,this._clickTolerance=h.clickTolerance};Vo.prototype.reset=function(){delete this._mousedownPos},Vo.prototype.wheel=function(c){return this._firePreventable(new Sf(c.type,this._map,c))},Vo.prototype.mousedown=function(c,h){return this._mousedownPos=h,this._firePreventable(new ds(c.type,this._map,c))},Vo.prototype.mouseup=function(c){this._map.fire(new ds(c.type,this._map,c))},Vo.prototype.click=function(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new ds(c.type,this._map,c))},Vo.prototype.dblclick=function(c){return this._firePreventable(new ds(c.type,this._map,c))},Vo.prototype.mouseover=function(c){this._map.fire(new ds(c.type,this._map,c))},Vo.prototype.mouseout=function(c){this._map.fire(new ds(c.type,this._map,c))},Vo.prototype.touchstart=function(c){return this._firePreventable(new Ku(c.type,this._map,c))},Vo.prototype.touchmove=function(c){this._map.fire(new Ku(c.type,this._map,c))},Vo.prototype.touchend=function(c){this._map.fire(new Ku(c.type,this._map,c))},Vo.prototype.touchcancel=function(c){this._map.fire(new Ku(c.type,this._map,c))},Vo.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},Vo.prototype.isEnabled=function(){return!0},Vo.prototype.isActive=function(){return!1},Vo.prototype.enable=function(){},Vo.prototype.disable=function(){};var ti=function(c){this._map=c};ti.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},ti.prototype.mousemove=function(c){this._map.fire(new ds(c.type,this._map,c))},ti.prototype.mousedown=function(){this._delayContextMenu=!0},ti.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ds("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},ti.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new ds(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},ti.prototype.isEnabled=function(){return!0},ti.prototype.isActive=function(){return!1},ti.prototype.enable=function(){},ti.prototype.disable=function(){};var Xo=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1};function qc(c,h){for(var f={},m=0;m<c.length;m++)f[c[m].identifier]=h[m];return f}Xo.prototype.isEnabled=function(){return!!this._enabled},Xo.prototype.isActive=function(){return!!this._active},Xo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Xo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Xo.prototype.mousedown=function(c,h){this.isEnabled()&&c.shiftKey&&c.button===0&&(K.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},Xo.prototype.mousemoveWindow=function(c,h){if(this._active){var f=h;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var m=this._startPos;this._lastPos=f,this._box||(this._box=K.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var S=Math.min(m.x,f.x),I=Math.max(m.x,f.x),R=Math.min(m.y,f.y),z=Math.max(m.y,f.y);K.setTransform(this._box,"translate("+S+"px,"+R+"px)"),this._box.style.width=I-S+"px",this._box.style.height=z-R+"px"}}},Xo.prototype.mouseupWindow=function(c,h){var f=this;if(this._active&&c.button===0){var m=this._startPos,S=h;if(this.reset(),K.suppressClick(),m.x!==S.x||m.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(I){return I.fitScreenCoordinates(m,S,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},Xo.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},Xo.prototype.blur=function(){this.reset()},Xo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(K.remove(this._box),this._box=null),K.enableDrag(),delete this._startPos,delete this._lastPos},Xo.prototype._fireEvent=function(c,h){return this._map.fire(new y.Event(c,{originalEvent:h}))};var Af=function(c){this.reset(),this.numTouches=c.numTouches};Af.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Af.prototype.touchstart=function(c,h,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){for(var S=new y.Point(0,0),I=0,R=m;I<R.length;I+=1)S._add(R[I]);return S.div(m.length)}(h),this.touches=qc(f,h)))},Af.prototype.touchmove=function(c,h,f){if(!this.aborted&&this.centroid){var m=qc(f,h);for(var S in this.touches){var I=m[S];(!I||I.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Af.prototype.touchend=function(c,h,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var m=!this.aborted&&this.centroid;if(this.reset(),m)return m}};var Ja=function(c){this.singleTap=new Af(c),this.numTaps=c.numTaps,this.reset()};Ja.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ja.prototype.touchstart=function(c,h,f){this.singleTap.touchstart(c,h,f)},Ja.prototype.touchmove=function(c,h,f){this.singleTap.touchmove(c,h,f)},Ja.prototype.touchend=function(c,h,f){var m=this.singleTap.touchend(c,h,f);if(m){var S=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(m)<30;if(S&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}};var Bu=function(){this._zoomIn=new Ja({numTouches:1,numTaps:2}),this._zoomOut=new Ja({numTouches:2,numTaps:1}),this.reset()};Bu.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Bu.prototype.touchstart=function(c,h,f){this._zoomIn.touchstart(c,h,f),this._zoomOut.touchstart(c,h,f)},Bu.prototype.touchmove=function(c,h,f){this._zoomIn.touchmove(c,h,f),this._zoomOut.touchmove(c,h,f)},Bu.prototype.touchend=function(c,h,f){var m=this,S=this._zoomIn.touchend(c,h,f),I=this._zoomOut.touchend(c,h,f);return S?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(S)},{originalEvent:c})}}):I?(this._active=!0,c.preventDefault(),setTimeout(function(){return m.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(I)},{originalEvent:c})}}):void 0},Bu.prototype.touchcancel=function(){this.reset()},Bu.prototype.enable=function(){this._enabled=!0},Bu.prototype.disable=function(){this._enabled=!1,this.reset()},Bu.prototype.isEnabled=function(){return this._enabled},Bu.prototype.isActive=function(){return this._active};var xc={0:1,2:2},Mn=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};Mn.prototype.blur=function(){this.reset()},Mn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Mn.prototype._correctButton=function(c,h){return!1},Mn.prototype._move=function(c,h){return{}},Mn.prototype.mousedown=function(c,h){if(!this._lastPoint){var f=K.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=h,this._eventButton=f)}},Mn.prototype.mousemoveWindow=function(c,h){var f=this._lastPoint;if(f){if(c.preventDefault(),function(m,S){var I=xc[S];return m.buttons===void 0||(m.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(f,h)}},Mn.prototype.mouseupWindow=function(c){this._lastPoint&&K.mouseButton(c)===this._eventButton&&(this._moved&&K.suppressClick(),this.reset())},Mn.prototype.enable=function(){this._enabled=!0},Mn.prototype.disable=function(){this._enabled=!1,this.reset()},Mn.prototype.isEnabled=function(){return this._enabled},Mn.prototype.isActive=function(){return this._active};var wf=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.mousedown=function(f,m){c.prototype.mousedown.call(this,f,m),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(f,m){return m===0&&!f.ctrlKey},h.prototype._move=function(f,m){return{around:m,panDelta:m.sub(f)}},h}(Mn),dh=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},h.prototype._move=function(f,m){var S=.8*(m.x-f.x);if(S)return this._active=!0,{bearingDelta:S}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(Mn),bl=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,m){return m===0&&f.ctrlKey||m===2},h.prototype._move=function(f,m){var S=-.5*(m.y-f.y);if(S)return this._active=!0,{pitchDelta:S}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(Mn),ho=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};ho.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},ho.prototype.touchstart=function(c,h,f){return this._calculateTransform(c,h,f)},ho.prototype.touchmove=function(c,h,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,h,f)},ho.prototype.touchend=function(c,h,f){this._calculateTransform(c,h,f),this._active&&f.length<this._minTouches&&this.reset()},ho.prototype.touchcancel=function(){this.reset()},ho.prototype._calculateTransform=function(c,h,f){f.length>0&&(this._active=!0);var m=qc(f,h),S=new y.Point(0,0),I=new y.Point(0,0),R=0;for(var z in m){var W=m[z],te=this._touches[z];te&&(S._add(W),I._add(W.sub(te)),R++,m[z]=W)}if(this._touches=m,!(R<this._minTouches)&&I.mag()){var be=I.div(R);if(this._sum._add(be),!(this._sum.mag()<this._clickTolerance))return{around:S.div(R),panDelta:be}}},ho.prototype.enable=function(){this._enabled=!0},ho.prototype.disable=function(){this._enabled=!1,this.reset()},ho.prototype.isEnabled=function(){return this._enabled},ho.prototype.isActive=function(){return this._active};var du=function(){this.reset()};function Va(c,h,f){for(var m=0;m<c.length;m++)if(c[m].identifier===f)return h[m]}function Bl(c,h){return Math.log(c/h)/Math.LN2}du.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},du.prototype._start=function(c){},du.prototype._move=function(c,h,f){return{}},du.prototype.touchstart=function(c,h,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([h[0],h[1]]))},du.prototype.touchmove=function(c,h,f){if(this._firstTwoTouches){c.preventDefault();var m=this._firstTwoTouches,S=m[1],I=Va(f,h,m[0]),R=Va(f,h,S);if(I&&R){var z=this._aroundCenter?null:I.add(R).div(2);return this._move([I,R],z,c)}}},du.prototype.touchend=function(c,h,f){if(this._firstTwoTouches){var m=this._firstTwoTouches,S=m[1],I=Va(f,h,m[0]),R=Va(f,h,S);I&&R||(this._active&&K.suppressClick(),this.reset())}},du.prototype.touchcancel=function(){this.reset()},du.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},du.prototype.disable=function(){this._enabled=!1,this.reset()},du.prototype.isEnabled=function(){return this._enabled},du.prototype.isActive=function(){return this._active};var wu=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},h.prototype._move=function(f,m){var S=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(Bl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bl(this._distance,S),pinchAround:m}},h}(du);function Nl(c,h){return 180*c.angleWith(h)/Math.PI}var $f=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},h.prototype._move=function(f,m){var S=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Nl(this._vector,S),pinchAround:m}},h.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var m=25/(Math.PI*this._minDiameter)*360,S=Nl(f,this._startVector);return Math.abs(S)<m},h}(du);function $c(c){return Math.abs(c.y)>Math.abs(c.x)}var gp=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(f){this._lastPoints=f,$c(f[0].sub(f[1]))&&(this._valid=!1)},h.prototype._move=function(f,m,S){var I=f[0].sub(this._lastPoints[0]),R=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(I,R,S.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(I.y+R.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(f,m,S){if(this._valid!==void 0)return this._valid;var I=f.mag()>=2,R=m.mag()>=2;if(I||R){if(!I||!R)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var z=f.y>0==m.y>0;return $c(f)&&$c(m)&&z}},h}(du),yi={panStep:100,bearingStep:15,pitchStep:10},ll=function(){var c=yi;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function Ks(c){return c*(2-c)}ll.prototype.blur=function(){this.reset()},ll.prototype.reset=function(){this._active=!1},ll.prototype.keydown=function(c){var h=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,m=0,S=0,I=0,R=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?m=-1:(c.preventDefault(),I=-1);break;case 39:c.shiftKey?m=1:(c.preventDefault(),I=1);break;case 38:c.shiftKey?S=1:(c.preventDefault(),R=-1);break;case 40:c.shiftKey?S=-1:(c.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(m=0,S=0),{cameraAnimation:function(z){var W=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:Ks,zoom:f?Math.round(W)+f*(c.shiftKey?2:1):W,bearing:z.getBearing()+m*h._bearingStep,pitch:z.getPitch()+S*h._pitchStep,offset:[-I*h._panStep,-R*h._panStep],center:z.getCenter()},{originalEvent:c})}}}},ll.prototype.enable=function(){this._enabled=!0},ll.prototype.disable=function(){this._enabled=!1,this.reset()},ll.prototype.isEnabled=function(){return this._enabled},ll.prototype.isActive=function(){return this._active},ll.prototype.disableRotation=function(){this._rotationDisabled=!0},ll.prototype.enableRotation=function(){this._rotationDisabled=!1};var ha=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};ha.prototype.setZoomRate=function(c){this._defaultZoomRate=c},ha.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},ha.prototype.isEnabled=function(){return!!this._enabled},ha.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ha.prototype.isZooming=function(){return!!this._zooming},ha.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},ha.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ha.prototype.wheel=function(c){if(this.isEnabled()){var h=c.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=y.browser.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}},ha.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},ha.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=K.mousePos(this._el,c);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ha.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&m!==0&&(m=1/m);var S=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(S*m))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var I,R=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,z=this._startZoom,W=this._easing,te=!1;if(this._type==="wheel"&&z&&W){var be=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),Se=W(be);I=y.number(z,R,Se),be<1?this._frameId||(this._frameId=!0):te=!0}else I=R,te=!0;return this._active=!0,te&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!te,zoomDelta:I-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ha.prototype._smoothOutEasing=function(c){var h=y.ease;if(this._prevEase){var f=this._prevEase,m=(y.browser.now()-f.start)/f.duration,S=f.easing(m+.01)-f.easing(m),I=.27/Math.sqrt(S*S+1e-4)*.01,R=Math.sqrt(.0729-I*I);h=y.bezier(I,R,.25,1)}return this._prevEase={start:y.browser.now(),duration:c,easing:h},h},ha.prototype.blur=function(){this.reset()},ha.prototype.reset=function(){this._active=!1};var cl=function(c,h){this._clickZoom=c,this._tapZoom=h};cl.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},cl.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},cl.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},cl.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var vu=function(){this.reset()};vu.prototype.reset=function(){this._active=!1},vu.prototype.blur=function(){this.reset()},vu.prototype.dblclick=function(c,h){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(h)},{originalEvent:c})}}},vu.prototype.enable=function(){this._enabled=!0},vu.prototype.disable=function(){this._enabled=!1,this.reset()},vu.prototype.isEnabled=function(){return this._enabled},vu.prototype.isActive=function(){return this._active};var Zs=function(){this._tap=new Ja({numTouches:1,numTaps:1}),this.reset()};Zs.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Zs.prototype.touchstart=function(c,h,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=h[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,h,f))},Zs.prototype.touchmove=function(c,h,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var m=h[0],S=m.y-this._swipePoint.y;return this._swipePoint=m,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,h,f)},Zs.prototype.touchend=function(c,h,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,h,f)&&(this._tapTime=c.timeStamp)},Zs.prototype.touchcancel=function(){this.reset()},Zs.prototype.enable=function(){this._enabled=!0},Zs.prototype.disable=function(){this._enabled=!1,this.reset()},Zs.prototype.isEnabled=function(){return this._enabled},Zs.prototype.isActive=function(){return this._active};var Tf=function(c,h,f){this._el=c,this._mousePan=h,this._touchPan=f};Tf.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Tf.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Tf.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Tf.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var bc=function(c,h,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=f};bc.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},bc.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},bc.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},bc.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Tu=function(c,h,f,m){this._el=c,this._touchZoom=h,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0};Tu.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Tu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Tu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Tu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Tu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Tu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var mu=function(c){return c.zoom||c.drag||c.pitch||c.rotate},Qu=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h}(y.Event);function bi(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var pi=function(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dl(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),y.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[y.window,"blur",void 0]];for(var m=0,S=this._listeners;m<S.length;m+=1){var I=S[m],R=I[0];K.addEventListener(R,I[1],R===y.window.document?this.handleWindowEvent:this.handleEvent,I[2])}};pi.prototype.destroy=function(){for(var c=0,h=this._listeners;c<h.length;c+=1){var f=h[c],m=f[0];K.removeEventListener(m,f[1],m===y.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},pi.prototype._addDefaultHandlers=function(c){var h=this._map,f=h.getCanvasContainer();this._add("mapEvent",new Vo(h,c));var m=h.boxZoom=new Xo(h,c);this._add("boxZoom",m);var S=new Bu,I=new vu;h.doubleClickZoom=new cl(I,S),this._add("tapZoom",S),this._add("clickZoom",I);var R=new Zs;this._add("tapDragZoom",R);var z=h.touchPitch=new gp;this._add("touchPitch",z);var W=new dh(c),te=new bl(c);h.dragRotate=new bc(c,W,te),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]);var be=new wf(c),Se=new ho(c);h.dragPan=new Tf(f,be,Se),this._add("mousePan",be),this._add("touchPan",Se,["touchZoom","touchRotate"]);var Ie=new $f,Je=new wu;h.touchZoomRotate=new Tu(f,Je,Ie,R),this._add("touchRotate",Ie,["touchPan","touchZoom"]),this._add("touchZoom",Je,["touchPan","touchRotate"]);var Qe=h.scrollZoom=new ha(h,this);this._add("scrollZoom",Qe,["mousePan"]);var nt=h.keyboard=new ll;this._add("keyboard",nt),this._add("blockableMapEvent",new ti(h));for(var He=0,ft=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];He<ft.length;He+=1){var Et=ft[He];c.interactive&&c[Et]&&h[Et].enable(c[Et])}},pi.prototype._add=function(c,h,f){this._handlers.push({handlerName:c,handler:h,allowed:f}),this._handlersById[c]=h},pi.prototype.stop=function(c){if(!this._updatingCamera){for(var h=0,f=this._handlers;h<f.length;h+=1)f[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},pi.prototype.isActive=function(){for(var c=0,h=this._handlers;c<h.length;c+=1)if(h[c].handler.isActive())return!0;return!1},pi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},pi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},pi.prototype.isMoving=function(){return Boolean(mu(this._eventsInProgress))||this.isZooming()},pi.prototype._blockedByActive=function(c,h,f){for(var m in c)if(m!==f&&(!h||h.indexOf(m)<0))return!0;return!1},pi.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},pi.prototype._getMapTouches=function(c){for(var h=[],f=0,m=c;f<m.length;f+=1){var S=m[f];this._el.contains(S.target)&&h.push(S)}return h},pi.prototype.handleEvent=function(c,h){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,m={needsRenderFrame:!1},S={},I={},R=c.touches?this._getMapTouches(c.touches):void 0,z=R?K.touchPos(this._el,R):K.mousePos(this._el,c),W=0,te=this._handlers;W<te.length;W+=1){var be=te[W],Se=be.handlerName,Ie=be.handler,Je=be.allowed;if(Ie.isEnabled()){var Qe=void 0;this._blockedByActive(I,Je,Se)?Ie.reset():Ie[h||c.type]&&(Qe=Ie[h||c.type](c,z,R),this.mergeHandlerResult(m,S,Qe,Se,f),Qe&&Qe.needsRenderFrame&&this._triggerRenderFrame()),(Qe||Ie.isActive())&&(I[Se]=Ie)}}var nt={};for(var He in this._previousActiveHandlers)I[He]||(nt[He]=f);this._previousActiveHandlers=I,(Object.keys(nt).length||bi(m))&&(this._changes.push([m,S,nt]),this._triggerRenderFrame()),(Object.keys(I).length||bi(m))&&this._map._stop(!0),this._updatingCamera=!1;var ft=m.cameraAnimation;ft&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ft(this._map))},pi.prototype.mergeHandlerResult=function(c,h,f,m,S){if(f){y.extend(c,f);var I={handlerName:m,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(h.zoom=I),f.panDelta!==void 0&&(h.drag=I),f.pitchDelta!==void 0&&(h.pitch=I),f.bearingDelta!==void 0&&(h.rotate=I)}},pi.prototype._applyChanges=function(){for(var c={},h={},f={},m=0,S=this._changes;m<S.length;m+=1){var I=S[m],R=I[0],z=I[1],W=I[2];R.panDelta&&(c.panDelta=(c.panDelta||new y.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(c.around=R.around),R.pinchAround!==void 0&&(c.pinchAround=R.pinchAround),R.noInertia&&(c.noInertia=R.noInertia),y.extend(h,z),y.extend(f,W)}this._updateMapTransform(c,h,f),this._changes=[]},pi.prototype._updateMapTransform=function(c,h,f){var m=this._map,S=m.transform;if(!bi(c))return this._fireEvents(h,f,!0);var I=c.panDelta,R=c.zoomDelta,z=c.bearingDelta,W=c.pitchDelta,te=c.around,be=c.pinchAround;be!==void 0&&(te=be),m._stop(!0),te=te||m.transform.centerPoint;var Se=S.pointLocation(I?te.sub(I):te);z&&(S.bearing+=z),W&&(S.pitch+=W),R&&(S.zoom+=R),S.setLocationAtPoint(Se,te),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,f,!0)},pi.prototype._fireEvents=function(c,h,f){var m=this,S=mu(this._eventsInProgress),I=mu(c),R={};for(var z in c)this._eventsInProgress[z]||(R[z+"start"]=c[z].originalEvent),this._eventsInProgress[z]=c[z];for(var W in!S&&I&&this._fireEvent("movestart",I.originalEvent),R)this._fireEvent(W,R[W]);for(var te in I&&this._fireEvent("move",I.originalEvent),c)this._fireEvent(te,c[te].originalEvent);var be,Se={};for(var Ie in this._eventsInProgress){var Je=this._eventsInProgress[Ie],Qe=Je.handlerName,nt=Je.originalEvent;this._handlersById[Qe].isActive()||(delete this._eventsInProgress[Ie],Se[Ie+"end"]=be=h[Qe]||nt)}for(var He in Se)this._fireEvent(He,Se[He]);var ft=mu(this._eventsInProgress);if(f&&(S||I)&&!ft){this._updatingCamera=!0;var Et=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ht=function(vr){return vr!==0&&-m._bearingSnap<vr&&vr<m._bearingSnap};Et?(Ht(Et.bearing||this._map.getBearing())&&(Et.bearing=0),this._map.easeTo(Et,{originalEvent:be})):(this._map.fire(new y.Event("moveend",{originalEvent:be})),Ht(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},pi.prototype._fireEvent=function(c,h){this._map.fire(new y.Event(c,h?{originalEvent:h}:{}))},pi.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete c._frameId,c.handleEvent(new Qu("renderFrame",{timeStamp:h})),c._applyChanges()})},pi.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Kf=function(c){function h(f,m){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=m.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(f,m){return this.jumpTo({center:f},m)},h.prototype.panBy=function(f,m,S){return f=y.Point.convert(f).mult(-1),this.panTo(this.transform.center,y.extend({offset:f},m),S)},h.prototype.panTo=function(f,m,S){return this.easeTo(y.extend({center:f},m),S)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(f,m){return this.jumpTo({zoom:f},m),this},h.prototype.zoomTo=function(f,m,S){return this.easeTo(y.extend({zoom:f},m),S)},h.prototype.zoomIn=function(f,m){return this.zoomTo(this.getZoom()+1,f,m),this},h.prototype.zoomOut=function(f,m){return this.zoomTo(this.getZoom()-1,f,m),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(f,m){return this.jumpTo({bearing:f},m),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(f,m){return this.jumpTo({padding:f},m),this},h.prototype.rotateTo=function(f,m,S){return this.easeTo(y.extend({bearing:f},m),S)},h.prototype.resetNorth=function(f,m){return this.rotateTo(0,y.extend({duration:1e3},f),m),this},h.prototype.resetNorthPitch=function(f,m){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},f),m),this},h.prototype.snapToNorth=function(f,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,m):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(f,m){return this.jumpTo({pitch:f},m),this},h.prototype.cameraForBounds=function(f,m){f=y.LngLatBounds.convert(f);var S=m&&m.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),S,m)},h.prototype._cameraForBoxAndBearing=function(f,m,S,I){var R={top:0,bottom:0,right:0,left:0};if(typeof(I=y.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},I)).padding=="number"){var z=I.padding;I.padding={top:z,bottom:z,right:z,left:z}}I.padding=y.extend(R,I.padding);var W=this.transform,te=W.padding,be=W.project(y.LngLat.convert(f)),Se=W.project(y.LngLat.convert(m)),Ie=be.rotate(-S*Math.PI/180),Je=Se.rotate(-S*Math.PI/180),Qe=new y.Point(Math.max(Ie.x,Je.x),Math.max(Ie.y,Je.y)),nt=new y.Point(Math.min(Ie.x,Je.x),Math.min(Ie.y,Je.y)),He=Qe.sub(nt),ft=(W.width-(te.left+te.right+I.padding.left+I.padding.right))/He.x,Et=(W.height-(te.top+te.bottom+I.padding.top+I.padding.bottom))/He.y;if(!(Et<0||ft<0)){var Ht=Math.min(W.scaleZoom(W.scale*Math.min(ft,Et)),I.maxZoom),vr=typeof I.offset.x=="number"?new y.Point(I.offset.x,I.offset.y):y.Point.convert(I.offset),rr=new y.Point((I.padding.left-I.padding.right)/2,(I.padding.top-I.padding.bottom)/2).rotate(S*Math.PI/180),Ar=vr.add(rr).mult(W.scale/W.zoomScale(Ht));return{center:W.unproject(be.add(Se).div(2).sub(Ar)),zoom:Ht,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(f,m,S){return this._fitInternal(this.cameraForBounds(f,m),m,S)},h.prototype.fitScreenCoordinates=function(f,m,S,I,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(f)),this.transform.pointLocation(y.Point.convert(m)),S,I),I,R)},h.prototype._fitInternal=function(f,m,S){return f?(delete(m=y.extend(f,m)).padding,m.linear?this.easeTo(m,S):this.flyTo(m,S)):this},h.prototype.jumpTo=function(f,m){this.stop();var S=this.transform,I=!1,R=!1,z=!1;return"zoom"in f&&S.zoom!==+f.zoom&&(I=!0,S.zoom=+f.zoom),f.center!==void 0&&(S.center=y.LngLat.convert(f.center)),"bearing"in f&&S.bearing!==+f.bearing&&(R=!0,S.bearing=+f.bearing),"pitch"in f&&S.pitch!==+f.pitch&&(z=!0,S.pitch=+f.pitch),f.padding==null||S.isPaddingEqual(f.padding)||(S.padding=f.padding),this.fire(new y.Event("movestart",m)).fire(new y.Event("move",m)),I&&this.fire(new y.Event("zoomstart",m)).fire(new y.Event("zoom",m)).fire(new y.Event("zoomend",m)),R&&this.fire(new y.Event("rotatestart",m)).fire(new y.Event("rotate",m)).fire(new y.Event("rotateend",m)),z&&this.fire(new y.Event("pitchstart",m)).fire(new y.Event("pitch",m)).fire(new y.Event("pitchend",m)),this.fire(new y.Event("moveend",m))},h.prototype.easeTo=function(f,m){var S=this;this._stop(!1,f.easeId),((f=y.extend({offset:[0,0],duration:500,easing:y.ease},f)).animate===!1||!f.essential&&y.browser.prefersReducedMotion)&&(f.duration=0);var I=this.transform,R=this.getZoom(),z=this.getBearing(),W=this.getPitch(),te=this.getPadding(),be="zoom"in f?+f.zoom:R,Se="bearing"in f?this._normalizeBearing(f.bearing,z):z,Ie="pitch"in f?+f.pitch:W,Je="padding"in f?f.padding:I.padding,Qe=y.Point.convert(f.offset),nt=I.centerPoint.add(Qe),He=I.pointLocation(nt),ft=y.LngLat.convert(f.center||He);this._normalizeCenter(ft);var Et,Ht,vr=I.project(He),rr=I.project(ft).sub(vr),Ar=I.zoomScale(be-R);f.around&&(Et=y.LngLat.convert(f.around),Ht=I.locationPoint(Et));var Hr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==R,this._rotating=this._rotating||z!==Se,this._pitching=this._pitching||Ie!==W,this._padding=!I.isPaddingEqual(Je),this._easeId=f.easeId,this._prepareEase(m,f.noMoveStart,Hr),this._ease(function(xn){if(S._zooming&&(I.zoom=y.number(R,be,xn)),S._rotating&&(I.bearing=y.number(z,Se,xn)),S._pitching&&(I.pitch=y.number(W,Ie,xn)),S._padding&&(I.interpolatePadding(te,Je,xn),nt=I.centerPoint.add(Qe)),Et)I.setLocationAtPoint(Et,Ht);else{var yn=I.zoomScale(I.zoom-R),Zn=be>R?Math.min(2,Ar):Math.max(.5,Ar),_i=Math.pow(Zn,1-xn),wi=I.unproject(vr.add(rr.mult(xn*_i)).mult(yn));I.setLocationAtPoint(I.renderWorldCopies?wi.wrap():wi,nt)}S._fireMoveEvents(m)},function(xn){S._afterEase(m,xn)},f),this},h.prototype._prepareEase=function(f,m,S){S===void 0&&(S={}),this._moving=!0,m||S.moving||this.fire(new y.Event("movestart",f)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",f)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",f)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",f))},h.prototype._fireMoveEvents=function(f){this.fire(new y.Event("move",f)),this._zooming&&this.fire(new y.Event("zoom",f)),this._rotating&&this.fire(new y.Event("rotate",f)),this._pitching&&this.fire(new y.Event("pitch",f))},h.prototype._afterEase=function(f,m){if(!this._easeId||!m||this._easeId!==m){delete this._easeId;var S=this._zooming,I=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",f)),I&&this.fire(new y.Event("rotateend",f)),R&&this.fire(new y.Event("pitchend",f)),this.fire(new y.Event("moveend",f))}},h.prototype.flyTo=function(f,m){var S=this;if(!f.essential&&y.browser.prefersReducedMotion){var I=y.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(I,m)}this.stop(),f=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},f);var R=this.transform,z=this.getZoom(),W=this.getBearing(),te=this.getPitch(),be=this.getPadding(),Se="zoom"in f?y.clamp(+f.zoom,R.minZoom,R.maxZoom):z,Ie="bearing"in f?this._normalizeBearing(f.bearing,W):W,Je="pitch"in f?+f.pitch:te,Qe="padding"in f?f.padding:R.padding,nt=R.zoomScale(Se-z),He=y.Point.convert(f.offset),ft=R.centerPoint.add(He),Et=R.pointLocation(ft),Ht=y.LngLat.convert(f.center||Et);this._normalizeCenter(Ht);var vr=R.project(Et),rr=R.project(Ht).sub(vr),Ar=f.curve,Hr=Math.max(R.width,R.height),xn=Hr/nt,yn=rr.mag();if("minZoom"in f){var Zn=y.clamp(Math.min(f.minZoom,z,Se),R.minZoom,R.maxZoom),_i=Hr/R.zoomScale(Zn-z);Ar=Math.sqrt(_i/yn*2)}var wi=Ar*Ar;function Ei(Di){var ki=(xn*xn-Hr*Hr+(Di?-1:1)*wi*wi*yn*yn)/(2*(Di?xn:Hr)*wi*yn);return Math.log(Math.sqrt(ki*ki+1)-ki)}function wa(Di){return(Math.exp(Di)-Math.exp(-Di))/2}function Wn(Di){return(Math.exp(Di)+Math.exp(-Di))/2}var Gi=Ei(0),Ji=function(Di){return Wn(Gi)/Wn(Gi+Ar*Di)},Yi=function(Di){return Hr*((Wn(Gi)*(wa(ki=Gi+Ar*Di)/Wn(ki))-wa(Gi))/wi)/yn;var ki},Ri=(Ei(1)-Gi)/Ar;if(Math.abs(yn)<1e-6||!isFinite(Ri)){if(Math.abs(Hr-xn)<1e-6)return this.easeTo(f,m);var ea=xn<Hr?-1:1;Ri=Math.abs(Math.log(xn/Hr))/Ar,Yi=function(){return 0},Ji=function(Di){return Math.exp(ea*Ar*Di)}}return f.duration="duration"in f?+f.duration:1e3*Ri/("screenSpeed"in f?+f.screenSpeed/Ar:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=W!==Ie,this._pitching=Je!==te,this._padding=!R.isPaddingEqual(Qe),this._prepareEase(m,!1),this._ease(function(Di){var ki=Di*Ri,xs=1/Ji(ki);R.zoom=Di===1?Se:z+R.scaleZoom(xs),S._rotating&&(R.bearing=y.number(W,Ie,Di)),S._pitching&&(R.pitch=y.number(te,Je,Di)),S._padding&&(R.interpolatePadding(be,Qe,Di),ft=R.centerPoint.add(He));var qo=Di===1?Ht:R.unproject(vr.add(rr.mult(Yi(ki))).mult(xs));R.setLocationAtPoint(R.renderWorldCopies?qo.wrap():qo,ft),S._fireMoveEvents(m)},function(){return S._afterEase(m)},f),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(f,m){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,m)}if(!f){var I=this.handlers;I&&I.stop(!1)}return this},h.prototype._ease=function(f,m,S){S.animate===!1||S.duration===0?(f(1),m()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=f,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var f=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(f,m){f=y.wrap(f,-180,180);var S=Math.abs(f-m);return Math.abs(f-360-m)<S&&(f-=360),Math.abs(f+360-m)<S&&(f+=360),f},h.prototype._normalizeCenter=function(f){var m=this.transform;if(m.renderWorldCopies&&!m.lngRange){var S=f.lng-m.center.lng;f.lng+=S>180?-360:S<-180?360:0}},h}(y.Evented),Vs=function(c){c===void 0&&(c={}),this.options=c,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Vs.prototype.getDefaultPosition=function(){return"bottom-right"},Vs.prototype.onAdd=function(c){var h=this.options&&this.options.compact;return this._map=c,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=K.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=K.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Vs.prototype.onRemove=function(){K.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Vs.prototype._setElementTitle=function(c,h){var f=this._map._getUIString("AttributionControl."+h);c.title=f,c.setAttribute("aria-label",f)},Vs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Vs.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(c){var f=h.reduce(function(m,S,I){return S.value&&(m+=S.key+"="+S.value+(I<h.length-1?"&":"")),m},"?");c.href=y.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},Vs.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Vs.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(z){return typeof z!="string"?"":z})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var f=this._map.style.sourceCaches;for(var m in f){var S=f[m];if(S.used){var I=S.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort(function(z,W){return z.length-W.length});var R=(c=c.filter(function(z,W){for(var te=W+1;te<c.length;te++)if(c[te].indexOf(z)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,c.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Vs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var fl=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};fl.prototype.onAdd=function(c){this._map=c,this._container=K.create("div","mapboxgl-ctrl");var h=K.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},fl.prototype.onRemove=function(){K.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},fl.prototype.getDefaultPosition=function(){return"bottom-left"},fl.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},fl.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var h in c)if(c[h].getSource().mapbox_logo)return!0;return!1}},fl.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var es=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};es.prototype.add=function(c){var h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h},es.prototype.remove=function(c){for(var h=this._currentlyRunning,f=0,m=h?this._queue.concat(h):this._queue;f<m.length;f+=1){var S=m[f];if(S.id===c)return void(S.cancelled=!0)}},es.prototype.run=function(c){c===void 0&&(c=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,m=h;f<m.length;f+=1){var S=m[f];if(!S.cancelled&&(S.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},es.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var El={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},vh=y.window.HTMLImageElement,Mf=y.window.HTMLElement,ja=y.window.ImageBitmap,yo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},mh=function(c){function h(m){var S=this;if((m=y.extend({},yo,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var I=new Aa(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies);if(c.call(this,I,m),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new es,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},El,m.locale),this._clickTolerance=m.clickTolerance,this._requestManager=new y.RequestManager(m.transformRequest,m.accessToken),typeof m.container=="string"){if(this._container=y.window.document.getElementById(m.container),!this._container)throw new Error("Container '"+m.container+"' not found.")}else{if(!(m.container instanceof Mf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new pi(this,m),this._hash=m.hash&&new pu(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,y.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Vs({customAttribution:m.customAttribution})),this.addControl(new fl,m.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(R){S._update(R.dataType==="style"),S.fire(new y.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){S.fire(new y.Event(R.dataType+"dataloading",R))})}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(m,S){if(S===void 0&&(S=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var I=m.onAdd(this);this._controls.push(m);var R=this._controlPositions[S];return S.indexOf("bottom")!==-1?R.insertBefore(I,R.firstChild):R.appendChild(I),this},h.prototype.removeControl=function(m){if(!m||!m.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(m);return S>-1&&this._controls.splice(S,1),m.onRemove(this),this},h.prototype.hasControl=function(m){return this._controls.indexOf(m)>-1},h.prototype.resize=function(m){var S=this._containerDimensions(),I=S[0],R=S[1];if(I===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(I,R),this.transform.resize(I,R),this.painter.resize(I,R);var z=!this._moving;return z&&this.fire(new y.Event("movestart",m)).fire(new y.Event("move",m)),this.fire(new y.Event("resize",m)),z&&this.fire(new y.Event("moveend",m)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(m){return this.transform.setMaxBounds(y.LngLatBounds.convert(m)),this._update()},h.prototype.setMinZoom=function(m){if((m=m==null?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(m){if((m=m==null?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(m){if((m=m==null?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(m){if((m=m==null?60:m)>60)throw new Error("maxPitch must be less than or equal to 60");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(m){return this.transform.renderWorldCopies=m,this._update()},h.prototype.project=function(m){return this.transform.locationPoint(y.LngLat.convert(m))},h.prototype.unproject=function(m){return this.transform.pointLocation(y.Point.convert(m))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(m,S,I){var R,z=this;if(m==="mouseenter"||m==="mouseover"){var W=!1;return{layer:S,listener:I,delegates:{mousemove:function(be){var Se=z.getLayer(S)?z.queryRenderedFeatures(be.point,{layers:[S]}):[];Se.length?W||(W=!0,I.call(z,new ds(m,z,be.originalEvent,{features:Se}))):W=!1},mouseout:function(){W=!1}}}}if(m==="mouseleave"||m==="mouseout"){var te=!1;return{layer:S,listener:I,delegates:{mousemove:function(be){(z.getLayer(S)?z.queryRenderedFeatures(be.point,{layers:[S]}):[]).length?te=!0:te&&(te=!1,I.call(z,new ds(m,z,be.originalEvent)))},mouseout:function(be){te&&(te=!1,I.call(z,new ds(m,z,be.originalEvent)))}}}}return{layer:S,listener:I,delegates:(R={},R[m]=function(be){var Se=z.getLayer(S)?z.queryRenderedFeatures(be.point,{layers:[S]}):[];Se.length&&(be.features=Se,I.call(z,be),delete be.features)},R)}},h.prototype.on=function(m,S,I){if(I===void 0)return c.prototype.on.call(this,m,S);var R=this._createDelegatedListener(m,S,I);for(var z in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(R),R.delegates)this.on(z,R.delegates[z]);return this},h.prototype.once=function(m,S,I){if(I===void 0)return c.prototype.once.call(this,m,S);var R=this._createDelegatedListener(m,S,I);for(var z in R.delegates)this.once(z,R.delegates[z]);return this},h.prototype.off=function(m,S,I){var R=this;return I===void 0?c.prototype.off.call(this,m,S):(this._delegatedListeners&&this._delegatedListeners[m]&&function(z){for(var W=z[m],te=0;te<W.length;te++){var be=W[te];if(be.layer===S&&be.listener===I){for(var Se in be.delegates)R.off(Se,be.delegates[Se]);return W.splice(te,1),R}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(m,S){if(!this.style)return[];var I;if(S!==void 0||m===void 0||m instanceof y.Point||Array.isArray(m)||(S=m,m=void 0),S=S||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof m[0]=="number")I=[y.Point.convert(m)];else{var R=y.Point.convert(m[0]),z=y.Point.convert(m[1]);I=[R,new y.Point(z.x,R.y),z,new y.Point(R.x,z.y),R]}return this.style.queryRenderedFeatures(I,S,this.transform)},h.prototype.querySourceFeatures=function(m,S){return this.style.querySourceFeatures(m,S)},h.prototype.setStyle=function(m,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(m,S))},h.prototype._getUIString=function(m){var S=this._locale[m];if(S==null)throw new Error("Missing UI string '"+m+"'");return S},h.prototype._updateStyle=function(m,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Cu(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Cu(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(m,S){var I=this;if(typeof m=="string"){var R=this._requestManager.normalizeStyleURL(m),z=this._requestManager.transformRequest(R,y.ResourceType.Style);y.getJSON(z,function(W,te){W?I.fire(new y.ErrorEvent(W)):te&&I._updateDiff(te,S)})}else typeof m=="object"&&this._updateDiff(m,S)},h.prototype._updateDiff=function(m,S){try{this.style.setState(m)&&this._update(!0)}catch(I){y.warnOnce("Unable to perform style diff: "+(I.message||I.error||I)+".  Rebuilding the style from scratch."),this._updateStyle(m,S)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(m,S){return this._lazyInitEmptyStyle(),this.style.addSource(m,S),this._update(!0)},h.prototype.isSourceLoaded=function(m){var S=this.style&&this.style.sourceCaches[m];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+m+"'")))},h.prototype.areTilesLoaded=function(){var m=this.style&&this.style.sourceCaches;for(var S in m){var I=m[S]._tiles;for(var R in I){var z=I[R];if(z.state!=="loaded"&&z.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(m,S,I){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,S,I)},h.prototype.removeSource=function(m){return this.style.removeSource(m),this._update(!0)},h.prototype.getSource=function(m){return this.style.getSource(m)},h.prototype.addImage=function(m,S,I){I===void 0&&(I={});var R=I.pixelRatio;R===void 0&&(R=1);var z=I.sdf;z===void 0&&(z=!1);var W=I.stretchX,te=I.stretchY,be=I.content;if(this._lazyInitEmptyStyle(),S instanceof vh||ja&&S instanceof ja){var Se=y.browser.getImageData(S);this.style.addImage(m,{data:new y.RGBAImage({width:Se.width,height:Se.height},Se.data),pixelRatio:R,stretchX:W,stretchY:te,content:be,sdf:z,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ie=S;this.style.addImage(m,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:R,stretchX:W,stretchY:te,content:be,sdf:z,version:0,userImage:Ie}),Ie.onAdd&&Ie.onAdd(this,m)}},h.prototype.updateImage=function(m,S){var I=this.style.getImage(m);if(!I)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=S instanceof vh||ja&&S instanceof ja?y.browser.getImageData(S):S,z=R.width,W=R.height,te=R.data;return z===void 0||W===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):z!==I.data.width||W!==I.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(I.data.replace(te,!(S instanceof vh||ja&&S instanceof ja)),void this.style.updateImage(m,I))},h.prototype.hasImage=function(m){return m?!!this.style.getImage(m):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(m){this.style.removeImage(m)},h.prototype.loadImage=function(m,S){y.getImage(this._requestManager.transformRequest(m,y.ResourceType.Image),S)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(m,S){return this._lazyInitEmptyStyle(),this.style.addLayer(m,S),this._update(!0)},h.prototype.moveLayer=function(m,S){return this.style.moveLayer(m,S),this._update(!0)},h.prototype.removeLayer=function(m){return this.style.removeLayer(m),this._update(!0)},h.prototype.getLayer=function(m){return this.style.getLayer(m)},h.prototype.setLayerZoomRange=function(m,S,I){return this.style.setLayerZoomRange(m,S,I),this._update(!0)},h.prototype.setFilter=function(m,S,I){return I===void 0&&(I={}),this.style.setFilter(m,S,I),this._update(!0)},h.prototype.getFilter=function(m){return this.style.getFilter(m)},h.prototype.setPaintProperty=function(m,S,I,R){return R===void 0&&(R={}),this.style.setPaintProperty(m,S,I,R),this._update(!0)},h.prototype.getPaintProperty=function(m,S){return this.style.getPaintProperty(m,S)},h.prototype.setLayoutProperty=function(m,S,I,R){return R===void 0&&(R={}),this.style.setLayoutProperty(m,S,I,R),this._update(!0)},h.prototype.getLayoutProperty=function(m,S){return this.style.getLayoutProperty(m,S)},h.prototype.setLight=function(m,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(m,S),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(m,S){return this.style.setFeatureState(m,S),this._update()},h.prototype.removeFeatureState=function(m,S){return this.style.removeFeatureState(m,S),this._update()},h.prototype.getFeatureState=function(m){return this.style.getFeatureState(m)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var m=0,S=0;return this._container&&(m=this._container.clientWidth||400,S=this._container.clientHeight||300),[m,S]},h.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=K.create("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=K.create("div","mapboxgl-canvas-container",m);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=K.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var I=this._containerDimensions();this._resizeCanvas(I[0],I[1]);var R=this._controlContainer=K.create("div","mapboxgl-control-container",m),z=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(W){z[W]=K.create("div","mapboxgl-ctrl-"+W,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(m,S){var I=y.browser.devicePixelRatio||1;this._canvas.width=I*m,this._canvas.height=I*S,this._canvas.style.width=m+"px",this._canvas.style.height=S+"px"},h.prototype._setupPainter=function(){var m=y.extend({},Ne.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);S?(this.painter=new Ao(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:m}))},h.prototype._contextRestored=function(m){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:m}))},h.prototype._onMapScroll=function(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(m){return this._update(),this._renderTaskQueue.add(m)},h.prototype._cancelRenderFrame=function(m){this._renderTaskQueue.remove(m)},h.prototype._render=function(m){var S,I=this,R=0,z=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=z.createQueryEXT(),z.beginQueryEXT(z.TIME_ELAPSED_EXT,S),R=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),!this._removed){var W=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var te=this.transform.zoom,be=y.browser.now();this.style.zoomHistory.update(te,be);var Se=new y.EvaluationParameters(te,{now:be,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ie=Se.crossFadingFactor();Ie===1&&Ie===this._crossFadingFactor||(W=!0,this._crossFadingFactor=Ie),this.style.update(Se)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||W)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Je=y.browser.now()-R;z.endQueryEXT(z.TIME_ELAPSED_EXT,S),setTimeout(function(){var He=z.getQueryObjectEXT(S,z.QUERY_RESULT_EXT)/1e6;z.deleteQueryEXT(S),I.fire(new y.Event("gpu-timing-frame",{cpuTime:Je,gpuTime:He}))},50)}if(this.listens("gpu-timing-layer")){var Qe=this.painter.collectGpuTimers();setTimeout(function(){var He=I.painter.queryGpuTimers(Qe);I.fire(new y.Event("gpu-timing-layer",{layerTimes:He}))},50)}var nt=this._sourcesDirty||this._styleDirty||this._placementDirty;return nt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||nt||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var m=0,S=this._controls;m<S.length;m+=1)S[m].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var I=this.painter.context.gl.getExtension("WEBGL_lose_context");I&&I.loseContext(),Qf(this._canvasContainer),Qf(this._controlContainer),Qf(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},h.prototype.triggerRepaint=function(){var m=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){m._frame=null,m._render(S)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(m){this._trackResize&&this.resize({originalEvent:m})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(m){this._showPadding!==m&&(this._showPadding=m,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(m){this._vertices=m,this._update()},h.prototype._setCacheLimits=function(m,S){y.setCacheLimits(m,S)},f.version.get=function(){return y.version},Object.defineProperties(h.prototype,f),h}(Kf);function Qf(c){c.parentNode&&c.parentNode.removeChild(c)}var hl={showCompass:!0,showZoom:!0,visualizePitch:!1},Ju=function(c){var h=this;this.options=y.extend({},hl,c),this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return h._map.zoomIn({},{originalEvent:f})}),K.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return h._map.zoomOut({},{originalEvent:f})}),K.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:f}):h._map.resetNorth({},{originalEvent:f})}),this._compassIcon=K.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ju.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),h=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},Ju.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},Ju.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Qs(this._map,this._compass,this.options.visualizePitch)),this._container},Ju.prototype.onRemove=function(){K.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ju.prototype._createButton=function(c,h){var f=K.create("button",c,this._container);return f.type="button",f.addEventListener("click",h),f},Ju.prototype._setButtonTitle=function(c,h){var f=this._map._getUIString("NavigationControl."+h);c.title=f,c.setAttribute("aria-label",f)};var Qs=function(c,h,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new dh({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new bl({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),K.addEventListener(h,"mousedown",this.mousedown),K.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),K.addEventListener(h,"touchmove",this.touchmove),K.addEventListener(h,"touchend",this.touchend),K.addEventListener(h,"touchcancel",this.reset)};function pl(c,h,f){if(c=new y.LngLat(c.lng,c.lat),h){var m=new y.LngLat(c.lng-360,c.lat),S=new y.LngLat(c.lng+360,c.lat),I=f.locationPoint(c).distSqr(h);f.locationPoint(m).distSqr(h)<I?c=m:f.locationPoint(S).distSqr(h)<I&&(c=S)}for(;Math.abs(c.lng-f.center.lng)>180;){var R=f.locationPoint(c);if(R.x>=0&&R.y>=0&&R.x<=f.width&&R.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}Qs.prototype.down=function(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),K.disableDrag()},Qs.prototype.move=function(c,h){var f=this.map,m=this.mouseRotate.mousemoveWindow(c,h);if(m&&m.bearingDelta&&f.setBearing(f.getBearing()+m.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(c,h);S&&S.pitchDelta&&f.setPitch(f.getPitch()+S.pitchDelta)}},Qs.prototype.off=function(){var c=this.element;K.removeEventListener(c,"mousedown",this.mousedown),K.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),K.removeEventListener(c,"touchmove",this.touchmove),K.removeEventListener(c,"touchend",this.touchend),K.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},Qs.prototype.offTemp=function(){K.enableDrag(),K.removeEventListener(y.window,"mousemove",this.mousemove),K.removeEventListener(y.window,"mouseup",this.mouseup)},Qs.prototype.mousedown=function(c){this.down(y.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),K.mousePos(this.element,c)),K.addEventListener(y.window,"mousemove",this.mousemove),K.addEventListener(y.window,"mouseup",this.mouseup)},Qs.prototype.mousemove=function(c){this.move(c,K.mousePos(this.element,c))},Qs.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},Qs.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=K.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},Qs.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=K.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},Qs.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Qs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gh(c,h,f){var m=c.classList;for(var S in zl)m.remove("mapboxgl-"+f+"-anchor-"+S);m.add("mapboxgl-"+f+"-anchor-"+h)}var Yo,yh=function(c){function h(f,m){if(c.call(this),(f instanceof y.window.HTMLElement||m)&&(f=y.extend({element:f},m)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=y.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=K.create("div"),this._element.setAttribute("aria-label","Map marker");var S=K.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var I=K.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");var R=K.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var z=K.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");for(var W=0,te=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];W<te.length;W+=1){var be=te[W],Se=K.createNS("http://www.w3.org/2000/svg","ellipse");Se.setAttributeNS(null,"opacity","0.04"),Se.setAttributeNS(null,"cx","10.5"),Se.setAttributeNS(null,"cy","5.80029008"),Se.setAttributeNS(null,"rx",be.rx),Se.setAttributeNS(null,"ry",be.ry),z.appendChild(Se)}var Ie=K.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"fill",this._color);var Je=K.createNS("http://www.w3.org/2000/svg","path");Je.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ie.appendChild(Je);var Qe=K.createNS("http://www.w3.org/2000/svg","g");Qe.setAttributeNS(null,"opacity","0.25"),Qe.setAttributeNS(null,"fill","#000000");var nt=K.createNS("http://www.w3.org/2000/svg","path");nt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Qe.appendChild(nt);var He=K.createNS("http://www.w3.org/2000/svg","g");He.setAttributeNS(null,"transform","translate(6.0, 7.0)"),He.setAttributeNS(null,"fill","#FFFFFF");var ft=K.createNS("http://www.w3.org/2000/svg","g");ft.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Et=K.createNS("http://www.w3.org/2000/svg","circle");Et.setAttributeNS(null,"fill","#000000"),Et.setAttributeNS(null,"opacity","0.25"),Et.setAttributeNS(null,"cx","5.5"),Et.setAttributeNS(null,"cy","5.5"),Et.setAttributeNS(null,"r","5.4999962");var Ht=K.createNS("http://www.w3.org/2000/svg","circle");Ht.setAttributeNS(null,"fill","#FFFFFF"),Ht.setAttributeNS(null,"cx","5.5"),Ht.setAttributeNS(null,"cy","5.5"),Ht.setAttributeNS(null,"r","5.4999962"),ft.appendChild(Et),ft.appendChild(Ht),R.appendChild(z),R.appendChild(Ie),R.appendChild(Qe),R.appendChild(He),R.appendChild(ft),S.appendChild(R),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(vr){vr.preventDefault()}),this._element.addEventListener("mousedown",function(vr){vr.preventDefault()}),gh(this._element,this._anchor,"marker"),this._popup=null}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),K.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var m=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(24.6+m)],"bottom-right":[-m,-1*(24.6+m)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(f){var m=f.code,S=f.charCode||f.keyCode;m!=="Space"&&m!=="Enter"&&S!==32&&S!==13||this.togglePopup()},h.prototype._onMapClick=function(f){var m=f.originalEvent.target,S=this._element;this._popup&&(m===S||S.contains(m))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},h.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=pl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(m="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),K.setTransform(this._element,zl[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+m)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(f){return this._offset=y.Point.convert(f),this._update(),this},h.prototype._onMove=function(f){if(!this._isDragging){var m=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(y.Evented),Wh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},If=0,Kc=!1,Xh=function(c){function h(f){c.call(this),this.options=y.extend({},Wh,f),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){var m;return this._map=f,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),m=this._setupUI,Yo!==void 0?m(Yo):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){m(Yo=S.state!=="denied")}):m(Yo=!!y.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),K.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,If=0,Kc=!1},h.prototype._isOutOfMapMaxBounds=function(f){var m=this._map.getMaxBounds(),S=f.coords;return m&&(S.longitude<m.getWest()||S.longitude>m.getEast()||S.latitude<m.getSouth()||S.latitude>m.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",f)),this._finish()}},h.prototype._updateCamera=function(f){var m=new y.LngLat(f.coords.longitude,f.coords.latitude),S=f.coords.accuracy,I=this._map.getBearing(),R=y.extend({bearing:I},this.options.fitBoundsOptions);this._map.fitBounds(m.toBounds(S),R,{geolocateSource:!0})},h.prototype._updateMarker=function(f){if(f){var m=new y.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,m=this._map.unproject([0,f]),S=this._map.unproject([1,f]),I=m.distanceTo(S),R=Math.ceil(2*this._accuracy/I);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Kc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",f)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(f){var m=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=K.create("button","mapboxgl-ctrl-geolocate",this._container),K.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var I=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=I,this._geolocateButton.setAttribute("aria-label",I)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=K.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new yh(this._dotElement),this._circleElement=K.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||m._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(m._watchState="BACKGROUND",m._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),m._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),m.fire(new y.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":If--,Kc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++If>1?(f={maximumAge:6e5,timeout:0},Kc=!0):(f=this.options.positionOptions,Kc=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(y.Evented),dl={maxWidth:100,unit:"metric"},Cl=function(c){this.options=y.extend({},dl,c),y.bindAll(["_onMove","setUnit"],this)};function Qc(c,h,f){var m=f&&f.maxWidth||100,S=c._container.clientHeight/2,I=c.unproject([0,S]),R=c.unproject([m,S]),z=I.distanceTo(R);if(f&&f.unit==="imperial"){var W=3.2808*z;W>5280?ec(h,m,W/5280,c._getUIString("ScaleControl.Miles")):ec(h,m,W,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?ec(h,m,z/1852,c._getUIString("ScaleControl.NauticalMiles")):z>=1e3?ec(h,m,z/1e3,c._getUIString("ScaleControl.Kilometers")):ec(h,m,z,c._getUIString("ScaleControl.Meters"))}function ec(c,h,f,m){var S,I,R,z=(S=f,(I=Math.pow(10,(""+Math.floor(S)).length-1))*(R=(R=S/I)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(W){var te=Math.pow(10,Math.ceil(-Math.log(W)/Math.LN10));return Math.round(W*te)/te}(R)));c.style.width=h*(z/f)+"px",c.innerHTML=z+"&nbsp;"+m}Cl.prototype.getDefaultPosition=function(){return"bottom-left"},Cl.prototype._onMove=function(){Qc(this._map,this._container,this.options)},Cl.prototype.onAdd=function(c){return this._map=c,this._container=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Cl.prototype.onRemove=function(){K.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Cl.prototype.setUnit=function(c){this.options.unit=c,Qc(this._map,this._container,this.options)};var el=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof y.window.HTMLElement?this._container=c.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};el.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=K.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},el.prototype.onRemove=function(){K.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},el.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},el.prototype._setupUI=function(){var c=this._fullscreenButton=K.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);K.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},el.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},el.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},el.prototype._isFullscreen=function(){return this._fullscreen},el.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},el.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var kf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Pf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Gp=function(c){function h(f){c.call(this),this.options=y.extend(Object.create(kf),f),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&K.remove(this._content),this._container&&(K.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(f){return this.setDOMContent(y.window.document.createTextNode(f))},h.prototype.setHTML=function(f){var m,S=y.window.document.createDocumentFragment(),I=y.window.document.createElement("body");for(I.innerHTML=f;m=I.firstChild;)S.appendChild(m);return this.setDOMContent(S)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},h.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=K.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},h.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},h.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},h.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=K.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(f){this._update(f.point)},h.prototype._onMouseMove=function(f){this._update(f.point)},h.prototype._onDrag=function(f){this._update(f.point)},h.prototype._update=function(f){var m=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=K.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=K.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Se){return m._container.classList.add(Se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var S=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),I=this.options.anchor,R=function Se(Ie){if(Ie){if(typeof Ie=="number"){var Je=Math.round(Math.sqrt(.5*Math.pow(Ie,2)));return{center:new y.Point(0,0),top:new y.Point(0,Ie),"top-left":new y.Point(Je,Je),"top-right":new y.Point(-Je,Je),bottom:new y.Point(0,-Ie),"bottom-left":new y.Point(Je,-Je),"bottom-right":new y.Point(-Je,-Je),left:new y.Point(Ie,0),right:new y.Point(-Ie,0)}}if(Ie instanceof y.Point||Array.isArray(Ie)){var Qe=y.Point.convert(Ie);return{center:Qe,top:Qe,"top-left":Qe,"top-right":Qe,bottom:Qe,"bottom-left":Qe,"bottom-right":Qe,left:Qe,right:Qe}}return{center:y.Point.convert(Ie.center||[0,0]),top:y.Point.convert(Ie.top||[0,0]),"top-left":y.Point.convert(Ie["top-left"]||[0,0]),"top-right":y.Point.convert(Ie["top-right"]||[0,0]),bottom:y.Point.convert(Ie.bottom||[0,0]),"bottom-left":y.Point.convert(Ie["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(Ie["bottom-right"]||[0,0]),left:y.Point.convert(Ie.left||[0,0]),right:y.Point.convert(Ie.right||[0,0])}}return Se(new y.Point(0,0))}(this.options.offset);if(!I){var z,W=this._container.offsetWidth,te=this._container.offsetHeight;z=S.y+R.bottom.y<te?["top"]:S.y>this._map.transform.height-te?["bottom"]:[],S.x<W/2?z.push("left"):S.x>this._map.transform.width-W/2&&z.push("right"),I=z.length===0?"bottom":z.join("-")}var be=S.add(R[I]).round();K.setTransform(this._container,zl[I]+" translate("+be.x+"px,"+be.y+"px)"),gh(this._container,I,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(Pf);f&&f.focus()}},h.prototype._onClose=function(){this.remove()},h}(y.Evented),Jc={version:y.version,supported:Ne,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:mh,NavigationControl:Ju,GeolocateControl:Xh,AttributionControl:Vs,ScaleControl:Cl,FullscreenControl:el,Popup:Gp,Marker:yh,Style:Cu,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){Jt().acquire(hr)},clearPrewarmedResources:function(){var c=oi;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(hr),oi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(c){y.config.ACCESS_TOKEN=c},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(c){y.config.API_URL=c},get workerCount(){return jr.workerCount},set workerCount(c){jr.workerCount=c},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){y.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){y.clearTileCache(c)},workerUrl:""};return Jc}),We})},3614:function(hi,Ae,fe){"use strict";hi.exports=de;var We=fe(80645);function de(ue){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ue)?ue:new Uint8Array(ue||0),this.pos=0,this.type=0,this.length=this.buf.length}de.Varint=0,de.Fixed64=1,de.Bytes=2,de.Fixed32=5;var y=(1<<16)*(1<<16),Ne=1/y,K=12,Re=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");de.prototype={destroy:function(){this.buf=null},readFields:function(ue,rt,Z){for(Z=Z||this.length;this.pos<Z;){var _e=this.readVarint(),ze=_e>>3,St=this.pos;this.type=_e&7,ue(ze,rt,this),this.pos===St&&this.skip(_e)}return rt},readMessage:function(ue,rt){return this.readFields(ue,rt,this.readVarint()+this.pos)},readFixed32:function(){var ue=Rt(this.buf,this.pos);return this.pos+=4,ue},readSFixed32:function(){var ue=Kt(this.buf,this.pos);return this.pos+=4,ue},readFixed64:function(){var ue=Rt(this.buf,this.pos)+Rt(this.buf,this.pos+4)*y;return this.pos+=8,ue},readSFixed64:function(){var ue=Rt(this.buf,this.pos)+Kt(this.buf,this.pos+4)*y;return this.pos+=8,ue},readFloat:function(){var ue=We.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ue},readDouble:function(){var ue=We.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ue},readVarint:function(ue){var rt=this.buf,Z,_e;return _e=rt[this.pos++],Z=_e&127,_e<128||(_e=rt[this.pos++],Z|=(_e&127)<<7,_e<128)||(_e=rt[this.pos++],Z|=(_e&127)<<14,_e<128)||(_e=rt[this.pos++],Z|=(_e&127)<<21,_e<128)?Z:(_e=rt[this.pos],Z|=(_e&15)<<28,pe(Z,ue,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ue=this.readVarint();return ue%2==1?(ue+1)/-2:ue/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var ue=this.readVarint()+this.pos,rt=this.pos;return this.pos=ue,ue-rt>=K&&Re?Er(this.buf,rt,ue):Ue(this.buf,rt,ue)},readBytes:function(){var ue=this.readVarint()+this.pos,rt=this.buf.subarray(this.pos,ue);return this.pos=ue,rt},readPackedVarint:function(ue,rt){if(this.type!==de.Bytes)return ue.push(this.readVarint(rt));var Z=lt(this);for(ue=ue||[];this.pos<Z;)ue.push(this.readVarint(rt));return ue},readPackedSVarint:function(ue){if(this.type!==de.Bytes)return ue.push(this.readSVarint());var rt=lt(this);for(ue=ue||[];this.pos<rt;)ue.push(this.readSVarint());return ue},readPackedBoolean:function(ue){if(this.type!==de.Bytes)return ue.push(this.readBoolean());var rt=lt(this);for(ue=ue||[];this.pos<rt;)ue.push(this.readBoolean());return ue},readPackedFloat:function(ue){if(this.type!==de.Bytes)return ue.push(this.readFloat());var rt=lt(this);for(ue=ue||[];this.pos<rt;)ue.push(this.readFloat());return ue},readPackedDouble:function(ue){if(this.type!==de.Bytes)return ue.push(this.readDouble());var rt=lt(this);for(ue=ue||[];this.pos<rt;)ue.push(this.readDouble());return ue},readPackedFixed32:function(ue){if(this.type!==de.Bytes)return ue.push(this.readFixed32());var rt=lt(this);for(ue=ue||[];this.pos<rt;)ue.push(this.readFixed32());return ue},readPackedSFixed32:function(ue){if(this.type!==de.Bytes)return ue.push(this.readSFixed32());var rt=lt(this);for(ue=ue||[];this.pos<rt;)ue.push(this.readSFixed32());return ue},readPackedFixed64:function(ue){if(this.type!==de.Bytes)return ue.push(this.readFixed64());var rt=lt(this);for(ue=ue||[];this.pos<rt;)ue.push(this.readFixed64());return ue},readPackedSFixed64:function(ue){if(this.type!==de.Bytes)return ue.push(this.readSFixed64());var rt=lt(this);for(ue=ue||[];this.pos<rt;)ue.push(this.readSFixed64());return ue},skip:function(ue){var rt=ue&7;if(rt===de.Varint)for(;this.buf[this.pos++]>127;);else if(rt===de.Bytes)this.pos=this.readVarint()+this.pos;else if(rt===de.Fixed32)this.pos+=4;else if(rt===de.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+rt)},writeTag:function(ue,rt){this.writeVarint(ue<<3|rt)},realloc:function(ue){for(var rt=this.length||16;rt<this.pos+ue;)rt*=2;if(rt!==this.length){var Z=new Uint8Array(rt);Z.set(this.buf),this.buf=Z,this.length=rt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ue){this.realloc(4),_t(this.buf,ue,this.pos),this.pos+=4},writeSFixed32:function(ue){this.realloc(4),_t(this.buf,ue,this.pos),this.pos+=4},writeFixed64:function(ue){this.realloc(8),_t(this.buf,ue&-1,this.pos),_t(this.buf,Math.floor(ue*Ne),this.pos+4),this.pos+=8},writeSFixed64:function(ue){this.realloc(8),_t(this.buf,ue&-1,this.pos),_t(this.buf,Math.floor(ue*Ne),this.pos+4),this.pos+=8},writeVarint:function(ue){if(ue=+ue||0,ue>268435455||ue<0){Xe(ue,this);return}this.realloc(4),this.buf[this.pos++]=ue&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=(ue>>>=7)&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=(ue>>>=7)&127|(ue>127?128:0),!(ue<=127)&&(this.buf[this.pos++]=ue>>>7&127)))},writeSVarint:function(ue){this.writeVarint(ue<0?-ue*2-1:ue*2)},writeBoolean:function(ue){this.writeVarint(Boolean(ue))},writeString:function(ue){ue=String(ue),this.realloc(ue.length*4),this.pos++;var rt=this.pos;this.pos=an(this.buf,ue,this.pos);var Z=this.pos-rt;Z>=128&&tr(rt,Z,this),this.pos=rt-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(ue){this.realloc(4),We.write(this.buf,ue,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ue){this.realloc(8),We.write(this.buf,ue,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ue){var rt=ue.length;this.writeVarint(rt),this.realloc(rt);for(var Z=0;Z<rt;Z++)this.buf[this.pos++]=ue[Z]},writeRawMessage:function(ue,rt){this.pos++;var Z=this.pos;ue(rt,this);var _e=this.pos-Z;_e>=128&&tr(Z,_e,this),this.pos=Z-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(ue,rt,Z){this.writeTag(ue,de.Bytes),this.writeRawMessage(rt,Z)},writePackedVarint:function(ue,rt){rt.length&&this.writeMessage(ue,Yt,rt)},writePackedSVarint:function(ue,rt){rt.length&&this.writeMessage(ue,Wt,rt)},writePackedBoolean:function(ue,rt){rt.length&&this.writeMessage(ue,kt,rt)},writePackedFloat:function(ue,rt){rt.length&&this.writeMessage(ue,br,rt)},writePackedDouble:function(ue,rt){rt.length&&this.writeMessage(ue,lr,rt)},writePackedFixed32:function(ue,rt){rt.length&&this.writeMessage(ue,zt,rt)},writePackedSFixed32:function(ue,rt){rt.length&&this.writeMessage(ue,Pr,rt)},writePackedFixed64:function(ue,rt){rt.length&&this.writeMessage(ue,re,rt)},writePackedSFixed64:function(ue,rt){rt.length&&this.writeMessage(ue,yr,rt)},writeBytesField:function(ue,rt){this.writeTag(ue,de.Bytes),this.writeBytes(rt)},writeFixed32Field:function(ue,rt){this.writeTag(ue,de.Fixed32),this.writeFixed32(rt)},writeSFixed32Field:function(ue,rt){this.writeTag(ue,de.Fixed32),this.writeSFixed32(rt)},writeFixed64Field:function(ue,rt){this.writeTag(ue,de.Fixed64),this.writeFixed64(rt)},writeSFixed64Field:function(ue,rt){this.writeTag(ue,de.Fixed64),this.writeSFixed64(rt)},writeVarintField:function(ue,rt){this.writeTag(ue,de.Varint),this.writeVarint(rt)},writeSVarintField:function(ue,rt){this.writeTag(ue,de.Varint),this.writeSVarint(rt)},writeStringField:function(ue,rt){this.writeTag(ue,de.Bytes),this.writeString(rt)},writeFloatField:function(ue,rt){this.writeTag(ue,de.Fixed32),this.writeFloat(rt)},writeDoubleField:function(ue,rt){this.writeTag(ue,de.Fixed64),this.writeDouble(rt)},writeBooleanField:function(ue,rt){this.writeVarintField(ue,Boolean(rt))}};function pe(ue,rt,Z){var _e=Z.buf,ze,St;if(St=_e[Z.pos++],ze=(St&112)>>4,St<128||(St=_e[Z.pos++],ze|=(St&127)<<3,St<128)||(St=_e[Z.pos++],ze|=(St&127)<<10,St<128)||(St=_e[Z.pos++],ze|=(St&127)<<17,St<128)||(St=_e[Z.pos++],ze|=(St&127)<<24,St<128)||(St=_e[Z.pos++],ze|=(St&1)<<31,St<128))return we(ue,ze,rt);throw new Error("Expected varint not more than 10 bytes")}function lt(ue){return ue.type===de.Bytes?ue.readVarint()+ue.pos:ue.pos+1}function we(ue,rt,Z){return Z?rt*4294967296+(ue>>>0):(rt>>>0)*4294967296+(ue>>>0)}function Xe(ue,rt){var Z,_e;if(ue>=0?(Z=ue%4294967296|0,_e=ue/4294967296|0):(Z=~(-ue%4294967296),_e=~(-ue/4294967296),Z^4294967295?Z=Z+1|0:(Z=0,_e=_e+1|0)),ue>=18446744073709552e3||ue<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");rt.realloc(10),Ct(Z,_e,rt),Pt(_e,rt)}function Ct(ue,rt,Z){Z.buf[Z.pos++]=ue&127|128,ue>>>=7,Z.buf[Z.pos++]=ue&127|128,ue>>>=7,Z.buf[Z.pos++]=ue&127|128,ue>>>=7,Z.buf[Z.pos++]=ue&127|128,ue>>>=7,Z.buf[Z.pos]=ue&127}function Pt(ue,rt){var Z=(ue&7)<<4;rt.buf[rt.pos++]|=Z|((ue>>>=3)?128:0),!!ue&&(rt.buf[rt.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(rt.buf[rt.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(rt.buf[rt.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(rt.buf[rt.pos++]=ue&127|((ue>>>=7)?128:0),!!ue&&(rt.buf[rt.pos++]=ue&127)))))}function tr(ue,rt,Z){var _e=rt<=16383?1:rt<=2097151?2:rt<=268435455?3:Math.floor(Math.log(rt)/(Math.LN2*7));Z.realloc(_e);for(var ze=Z.pos-1;ze>=ue;ze--)Z.buf[ze+_e]=Z.buf[ze]}function Yt(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeVarint(ue[Z])}function Wt(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeSVarint(ue[Z])}function br(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeFloat(ue[Z])}function lr(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeDouble(ue[Z])}function kt(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeBoolean(ue[Z])}function zt(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeFixed32(ue[Z])}function Pr(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeSFixed32(ue[Z])}function re(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeFixed64(ue[Z])}function yr(ue,rt){for(var Z=0;Z<ue.length;Z++)rt.writeSFixed64(ue[Z])}function Rt(ue,rt){return(ue[rt]|ue[rt+1]<<8|ue[rt+2]<<16)+ue[rt+3]*16777216}function _t(ue,rt,Z){ue[Z]=rt,ue[Z+1]=rt>>>8,ue[Z+2]=rt>>>16,ue[Z+3]=rt>>>24}function Kt(ue,rt){return(ue[rt]|ue[rt+1]<<8|ue[rt+2]<<16)+(ue[rt+3]<<24)}function Ue(ue,rt,Z){for(var _e="",ze=rt;ze<Z;){var St=ue[ze],Ut=null,cr=St>239?4:St>223?3:St>191?2:1;if(ze+cr>Z)break;var wt,Or,Xn;cr===1?St<128&&(Ut=St):cr===2?(wt=ue[ze+1],(wt&192)==128&&(Ut=(St&31)<<6|wt&63,Ut<=127&&(Ut=null))):cr===3?(wt=ue[ze+1],Or=ue[ze+2],(wt&192)==128&&(Or&192)==128&&(Ut=(St&15)<<12|(wt&63)<<6|Or&63,(Ut<=2047||Ut>=55296&&Ut<=57343)&&(Ut=null))):cr===4&&(wt=ue[ze+1],Or=ue[ze+2],Xn=ue[ze+3],(wt&192)==128&&(Or&192)==128&&(Xn&192)==128&&(Ut=(St&15)<<18|(wt&63)<<12|(Or&63)<<6|Xn&63,(Ut<=65535||Ut>=1114112)&&(Ut=null))),Ut===null?(Ut=65533,cr=1):Ut>65535&&(Ut-=65536,_e+=String.fromCharCode(Ut>>>10&1023|55296),Ut=56320|Ut&1023),_e+=String.fromCharCode(Ut),ze+=cr}return _e}function Er(ue,rt,Z){return Re.decode(ue.subarray(rt,Z))}function an(ue,rt,Z){for(var _e=0,ze,St;_e<rt.length;_e++){if(ze=rt.charCodeAt(_e),ze>55295&&ze<57344)if(St)if(ze<56320){ue[Z++]=239,ue[Z++]=191,ue[Z++]=189,St=ze;continue}else ze=St-55296<<10|ze-56320|65536,St=null;else{ze>56319||_e+1===rt.length?(ue[Z++]=239,ue[Z++]=191,ue[Z++]=189):St=ze;continue}else St&&(ue[Z++]=239,ue[Z++]=191,ue[Z++]=189,St=null);ze<128?ue[Z++]=ze:(ze<2048?ue[Z++]=ze>>6|192:(ze<65536?ue[Z++]=ze>>12|224:(ue[Z++]=ze>>18|240,ue[Z++]=ze>>12&63|128),ue[Z++]=ze>>6&63|128),ue[Z++]=ze&63|128)}return Z}},32676:function(hi,Ae,fe){var We=fe(34155);(function(de,y){hi.exports=y()})(this,function(){"use strict";function de(It,ge){if(!(It instanceof ge))throw new TypeError("Cannot call a class as a function")}function y(It,ge){for(var oe=0;oe<ge.length;oe++){var Te=ge[oe];Te.enumerable=Te.enumerable||!1,Te.configurable=!0,"value"in Te&&(Te.writable=!0),Object.defineProperty(It,Te.key,Te)}}function Ne(It,ge,oe){return ge&&y(It.prototype,ge),oe&&y(It,oe),It}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var K=function(){function It(ge,oe){this.next=null,this.key=ge,this.data=oe,this.left=null,this.right=null}return It}();function Re(It,ge){return It>ge?1:It<ge?-1:0}function pe(It,ge,oe){for(var Te=new K(null,null),j=Te,ot=Te;;){var sr=oe(It,ge.key);if(sr<0){if(ge.left===null)break;if(oe(It,ge.left.key)<0){var Yr=ge.left;if(ge.left=Yr.right,Yr.right=ge,ge=Yr,ge.left===null)break}ot.left=ge,ot=ge,ge=ge.left}else if(sr>0){if(ge.right===null)break;if(oe(It,ge.right.key)>0){var Yr=ge.right;if(ge.right=Yr.left,Yr.left=ge,ge=Yr,ge.right===null)break}j.right=ge,j=ge,ge=ge.right}else break}return j.right=ge.left,ot.left=ge.right,ge.left=Te.right,ge.right=Te.left,ge}function lt(It,ge,oe,Te){var j=new K(It,ge);if(oe===null)return j.left=j.right=null,j;oe=pe(It,oe,Te);var ot=Te(It,oe.key);return ot<0?(j.left=oe.left,j.right=oe,oe.left=null):ot>=0&&(j.right=oe.right,j.left=oe,oe.right=null),j}function we(It,ge,oe){var Te=null,j=null;if(ge){ge=pe(It,ge,oe);var ot=oe(ge.key,It);ot===0?(Te=ge.left,j=ge.right):ot<0?(j=ge.right,ge.right=null,Te=ge):(Te=ge.left,ge.left=null,j=ge)}return{left:Te,right:j}}function Xe(It,ge,oe){return ge===null?It:(It===null||(ge=pe(It.key,ge,oe),ge.left=It),ge)}function Ct(It,ge,oe,Te,j){if(It){Te(""+ge+(oe?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+j(It)+`
`);var ot=ge+(oe?"    ":"\u2502   ");It.left&&Ct(It.left,ot,!1,Te,j),It.right&&Ct(It.right,ot,!0,Te,j)}}var Pt=function(){function It(ge){ge===void 0&&(ge=Re),this._root=null,this._size=0,this._comparator=ge}return It.prototype.insert=function(ge,oe){return this._size++,this._root=lt(ge,oe,this._root,this._comparator)},It.prototype.add=function(ge,oe){var Te=new K(ge,oe);this._root===null&&(Te.left=Te.right=null,this._size++,this._root=Te);var j=this._comparator,ot=pe(ge,this._root,j),sr=j(ge,ot.key);return sr===0?this._root=ot:(sr<0?(Te.left=ot.left,Te.right=ot,ot.left=null):sr>0&&(Te.right=ot.right,Te.left=ot,ot.right=null),this._size++,this._root=Te),this._root},It.prototype.remove=function(ge){this._root=this._remove(ge,this._root,this._comparator)},It.prototype._remove=function(ge,oe,Te){var j;if(oe===null)return null;oe=pe(ge,oe,Te);var ot=Te(ge,oe.key);return ot===0?(oe.left===null?j=oe.right:(j=pe(ge,oe.left,Te),j.right=oe.right),this._size--,j):oe},It.prototype.pop=function(){var ge=this._root;if(ge){for(;ge.left;)ge=ge.left;return this._root=pe(ge.key,this._root,this._comparator),this._root=this._remove(ge.key,this._root,this._comparator),{key:ge.key,data:ge.data}}return null},It.prototype.findStatic=function(ge){for(var oe=this._root,Te=this._comparator;oe;){var j=Te(ge,oe.key);if(j===0)return oe;j<0?oe=oe.left:oe=oe.right}return null},It.prototype.find=function(ge){return this._root&&(this._root=pe(ge,this._root,this._comparator),this._comparator(ge,this._root.key)!==0)?null:this._root},It.prototype.contains=function(ge){for(var oe=this._root,Te=this._comparator;oe;){var j=Te(ge,oe.key);if(j===0)return!0;j<0?oe=oe.left:oe=oe.right}return!1},It.prototype.forEach=function(ge,oe){for(var Te=this._root,j=[],ot=!1;!ot;)Te!==null?(j.push(Te),Te=Te.left):j.length!==0?(Te=j.pop(),ge.call(oe,Te),Te=Te.right):ot=!0;return this},It.prototype.range=function(ge,oe,Te,j){for(var ot=[],sr=this._comparator,Yr=this._root,Ke;ot.length!==0||Yr;)if(Yr)ot.push(Yr),Yr=Yr.left;else{if(Yr=ot.pop(),Ke=sr(Yr.key,oe),Ke>0)break;if(sr(Yr.key,ge)>=0&&Te.call(j,Yr))return this;Yr=Yr.right}return this},It.prototype.keys=function(){var ge=[];return this.forEach(function(oe){var Te=oe.key;return ge.push(Te)}),ge},It.prototype.values=function(){var ge=[];return this.forEach(function(oe){var Te=oe.data;return ge.push(Te)}),ge},It.prototype.min=function(){return this._root?this.minNode(this._root).key:null},It.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},It.prototype.minNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.left;)ge=ge.left;return ge},It.prototype.maxNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.right;)ge=ge.right;return ge},It.prototype.at=function(ge){for(var oe=this._root,Te=!1,j=0,ot=[];!Te;)if(oe)ot.push(oe),oe=oe.left;else if(ot.length>0){if(oe=ot.pop(),j===ge)return oe;j++,oe=oe.right}else Te=!0;return null},It.prototype.next=function(ge){var oe=this._root,Te=null;if(ge.right){for(Te=ge.right;Te.left;)Te=Te.left;return Te}for(var j=this._comparator;oe;){var ot=j(ge.key,oe.key);if(ot===0)break;ot<0?(Te=oe,oe=oe.left):oe=oe.right}return Te},It.prototype.prev=function(ge){var oe=this._root,Te=null;if(ge.left!==null){for(Te=ge.left;Te.right;)Te=Te.right;return Te}for(var j=this._comparator;oe;){var ot=j(ge.key,oe.key);if(ot===0)break;ot<0?oe=oe.left:(Te=oe,oe=oe.right)}return Te},It.prototype.clear=function(){return this._root=null,this._size=0,this},It.prototype.toList=function(){return Wt(this._root)},It.prototype.load=function(ge,oe,Te){oe===void 0&&(oe=[]),Te===void 0&&(Te=!1);var j=ge.length,ot=this._comparator;if(Te&&kt(ge,oe,0,j-1,ot),this._root===null)this._root=tr(ge,oe,0,j),this._size=j;else{var sr=lr(this.toList(),Yt(ge,oe),ot);j=this._size+j,this._root=br({head:sr},0,j)}return this},It.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(It.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(It.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),It.prototype.toString=function(ge){ge===void 0&&(ge=function(j){return String(j.key)});var oe=[];return Ct(this._root,"",!0,function(Te){return oe.push(Te)},ge),oe.join("")},It.prototype.update=function(ge,oe,Te){var j=this._comparator,ot=we(ge,this._root,j),sr=ot.left,Yr=ot.right;j(ge,oe)<0?Yr=lt(oe,Te,Yr,j):sr=lt(oe,Te,sr,j),this._root=Xe(sr,Yr,j)},It.prototype.split=function(ge){return we(ge,this._root,this._comparator)},It}();function tr(It,ge,oe,Te){var j=Te-oe;if(j>0){var ot=oe+Math.floor(j/2),sr=It[ot],Yr=ge[ot],Ke=new K(sr,Yr);return Ke.left=tr(It,ge,oe,ot),Ke.right=tr(It,ge,ot+1,Te),Ke}return null}function Yt(It,ge){for(var oe=new K(null,null),Te=oe,j=0;j<It.length;j++)Te=Te.next=new K(It[j],ge[j]);return Te.next=null,oe.next}function Wt(It){for(var ge=It,oe=[],Te=!1,j=new K(null,null),ot=j;!Te;)ge?(oe.push(ge),ge=ge.left):oe.length>0?(ge=ot=ot.next=oe.pop(),ge=ge.right):Te=!0;return ot.next=null,j.next}function br(It,ge,oe){var Te=oe-ge;if(Te>0){var j=ge+Math.floor(Te/2),ot=br(It,ge,j),sr=It.head;return sr.left=ot,It.head=It.head.next,sr.right=br(It,j+1,oe),sr}return null}function lr(It,ge,oe){for(var Te=new K(null,null),j=Te,ot=It,sr=ge;ot!==null&&sr!==null;)oe(ot.key,sr.key)<0?(j.next=ot,ot=ot.next):(j.next=sr,sr=sr.next),j=j.next;return ot!==null?j.next=ot:sr!==null&&(j.next=sr),Te.next}function kt(It,ge,oe,Te,j){if(!(oe>=Te)){for(var ot=It[oe+Te>>1],sr=oe-1,Yr=Te+1;;){do sr++;while(j(It[sr],ot)<0);do Yr--;while(j(It[Yr],ot)>0);if(sr>=Yr)break;var Ke=It[sr];It[sr]=It[Yr],It[Yr]=Ke,Ke=ge[sr],ge[sr]=ge[Yr],ge[Yr]=Ke}kt(It,ge,oe,Yr,j),kt(It,ge,Yr+1,Te,j)}}var zt=function(ge,oe){return ge.ll.x<=oe.x&&oe.x<=ge.ur.x&&ge.ll.y<=oe.y&&oe.y<=ge.ur.y},Pr=function(ge,oe){if(oe.ur.x<ge.ll.x||ge.ur.x<oe.ll.x||oe.ur.y<ge.ll.y||ge.ur.y<oe.ll.y)return null;var Te=ge.ll.x<oe.ll.x?oe.ll.x:ge.ll.x,j=ge.ur.x<oe.ur.x?ge.ur.x:oe.ur.x,ot=ge.ll.y<oe.ll.y?oe.ll.y:ge.ll.y,sr=ge.ur.y<oe.ur.y?ge.ur.y:oe.ur.y;return{ll:{x:Te,y:ot},ur:{x:j,y:sr}}},re=Number.EPSILON;re===void 0&&(re=Math.pow(2,-52));var yr=re*re,Rt=function(ge,oe){if(-re<ge&&ge<re&&-re<oe&&oe<re)return 0;var Te=ge-oe;return Te*Te<yr*ge*oe?0:ge<oe?-1:1},_t=function(){function It(){de(this,It),this.reset()}return Ne(It,[{key:"reset",value:function(){this.xRounder=new Kt,this.yRounder=new Kt}},{key:"round",value:function(oe,Te){return{x:this.xRounder.round(oe),y:this.yRounder.round(Te)}}}]),It}(),Kt=function(){function It(){de(this,It),this.tree=new Pt,this.round(0)}return Ne(It,[{key:"round",value:function(oe){var Te=this.tree.add(oe),j=this.tree.prev(Te);if(j!==null&&Rt(Te.key,j.key)===0)return this.tree.remove(oe),j.key;var ot=this.tree.next(Te);return ot!==null&&Rt(Te.key,ot.key)===0?(this.tree.remove(oe),ot.key):oe}}]),It}(),Ue=new _t,Er=function(ge,oe){return ge.x*oe.y-ge.y*oe.x},an=function(ge,oe){return ge.x*oe.x+ge.y*oe.y},ue=function(ge,oe,Te){var j={x:oe.x-ge.x,y:oe.y-ge.y},ot={x:Te.x-ge.x,y:Te.y-ge.y},sr=Er(j,ot);return Rt(sr,0)},rt=function(ge){return Math.sqrt(an(ge,ge))},Z=function(ge,oe,Te){var j={x:oe.x-ge.x,y:oe.y-ge.y},ot={x:Te.x-ge.x,y:Te.y-ge.y};return Er(ot,j)/rt(ot)/rt(j)},_e=function(ge,oe,Te){var j={x:oe.x-ge.x,y:oe.y-ge.y},ot={x:Te.x-ge.x,y:Te.y-ge.y};return an(ot,j)/rt(ot)/rt(j)},ze=function(ge,oe,Te){return oe.y===0?null:{x:ge.x+oe.x/oe.y*(Te-ge.y),y:Te}},St=function(ge,oe,Te){return oe.x===0?null:{x:Te,y:ge.y+oe.y/oe.x*(Te-ge.x)}},Ut=function(ge,oe,Te,j){if(oe.x===0)return St(Te,j,ge.x);if(j.x===0)return St(ge,oe,Te.x);if(oe.y===0)return ze(Te,j,ge.y);if(j.y===0)return ze(ge,oe,Te.y);var ot=Er(oe,j);if(ot==0)return null;var sr={x:Te.x-ge.x,y:Te.y-ge.y},Yr=Er(sr,oe)/ot,Ke=Er(sr,j)/ot,Dt=ge.x+Ke*oe.x,Cr=Te.x+Yr*j.x,_r=ge.y+Ke*oe.y,Rr=Te.y+Yr*j.y,mn=(Dt+Cr)/2,vi=(_r+Rr)/2;return{x:mn,y:vi}},cr=function(){Ne(It,null,[{key:"compare",value:function(oe,Te){var j=It.comparePoints(oe.point,Te.point);return j!==0?j:(oe.point!==Te.point&&oe.link(Te),oe.isLeft!==Te.isLeft?oe.isLeft?1:-1:Or.compare(oe.segment,Te.segment))}},{key:"comparePoints",value:function(oe,Te){return oe.x<Te.x?-1:oe.x>Te.x?1:oe.y<Te.y?-1:oe.y>Te.y?1:0}}]);function It(ge,oe){de(this,It),ge.events===void 0?ge.events=[this]:ge.events.push(this),this.point=ge,this.isLeft=oe}return Ne(It,[{key:"link",value:function(oe){if(oe.point===this.point)throw new Error("Tried to link already linked events");for(var Te=oe.point.events,j=0,ot=Te.length;j<ot;j++){var sr=Te[j];this.point.events.push(sr),sr.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var oe=this.point.events.length,Te=0;Te<oe;Te++){var j=this.point.events[Te];if(j.segment.consumedBy===void 0)for(var ot=Te+1;ot<oe;ot++){var sr=this.point.events[ot];sr.consumedBy===void 0&&j.otherSE.point.events===sr.otherSE.point.events&&j.segment.consume(sr.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var oe=[],Te=0,j=this.point.events.length;Te<j;Te++){var ot=this.point.events[Te];ot!==this&&!ot.segment.ringOut&&ot.segment.isInResult()&&oe.push(ot)}return oe}},{key:"getLeftmostComparator",value:function(oe){var Te=this,j=new Map,ot=function(Yr){var Ke=Yr.otherSE;j.set(Yr,{sine:Z(Te.point,oe.point,Ke.point),cosine:_e(Te.point,oe.point,Ke.point)})};return function(sr,Yr){j.has(sr)||ot(sr),j.has(Yr)||ot(Yr);var Ke=j.get(sr),Dt=Ke.sine,Cr=Ke.cosine,_r=j.get(Yr),Rr=_r.sine,mn=_r.cosine;return Dt>=0&&Rr>=0?Cr<mn?1:Cr>mn?-1:0:Dt<0&&Rr<0?Cr<mn?-1:Cr>mn?1:0:Rr<Dt?-1:Rr>Dt?1:0}}}]),It}(),wt=0,Or=function(){Ne(It,null,[{key:"compare",value:function(oe,Te){var j=oe.leftSE.point.x,ot=Te.leftSE.point.x,sr=oe.rightSE.point.x,Yr=Te.rightSE.point.x;if(Yr<j)return 1;if(sr<ot)return-1;var Ke=oe.leftSE.point.y,Dt=Te.leftSE.point.y,Cr=oe.rightSE.point.y,_r=Te.rightSE.point.y;if(j<ot){if(Dt<Ke&&Dt<Cr)return 1;if(Dt>Ke&&Dt>Cr)return-1;var Rr=oe.comparePoint(Te.leftSE.point);if(Rr<0)return 1;if(Rr>0)return-1;var mn=Te.comparePoint(oe.rightSE.point);return mn!==0?mn:-1}if(j>ot){if(Ke<Dt&&Ke<_r)return-1;if(Ke>Dt&&Ke>_r)return 1;var vi=Te.comparePoint(oe.leftSE.point);if(vi!==0)return vi;var ni=oe.comparePoint(Te.rightSE.point);return ni<0?1:ni>0?-1:1}if(Ke<Dt)return-1;if(Ke>Dt)return 1;if(sr<Yr){var bn=Te.comparePoint(oe.rightSE.point);if(bn!==0)return bn}if(sr>Yr){var Oi=oe.comparePoint(Te.rightSE.point);if(Oi<0)return 1;if(Oi>0)return-1}if(sr!==Yr){var Ni=Cr-Ke,Ha=sr-j,oa=_r-Dt,Wa=Yr-ot;if(Ni>Ha&&oa<Wa)return 1;if(Ni<Ha&&oa>Wa)return-1}return sr>Yr?1:sr<Yr||Cr<_r?-1:Cr>_r?1:oe.id<Te.id?-1:oe.id>Te.id?1:0}}]);function It(ge,oe,Te,j){de(this,It),this.id=++wt,this.leftSE=ge,ge.segment=this,ge.otherSE=oe,this.rightSE=oe,oe.segment=this,oe.otherSE=ge,this.rings=Te,this.windings=j}return Ne(It,[{key:"replaceRightSE",value:function(oe){this.rightSE=oe,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var oe=this.leftSE.point.y,Te=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:oe<Te?oe:Te},ur:{x:this.rightSE.point.x,y:oe>Te?oe:Te}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(oe){return oe.x===this.leftSE.point.x&&oe.y===this.leftSE.point.y||oe.x===this.rightSE.point.x&&oe.y===this.rightSE.point.y}},{key:"comparePoint",value:function(oe){if(this.isAnEndpoint(oe))return 0;var Te=this.leftSE.point,j=this.rightSE.point,ot=this.vector();if(Te.x===j.x)return oe.x===Te.x?0:oe.x<Te.x?1:-1;var sr=(oe.y-Te.y)/ot.y,Yr=Te.x+sr*ot.x;if(oe.x===Yr)return 0;var Ke=(oe.x-Te.x)/ot.x,Dt=Te.y+Ke*ot.y;return oe.y===Dt?0:oe.y<Dt?-1:1}},{key:"getIntersection",value:function(oe){var Te=this.bbox(),j=oe.bbox(),ot=Pr(Te,j);if(ot===null)return null;var sr=this.leftSE.point,Yr=this.rightSE.point,Ke=oe.leftSE.point,Dt=oe.rightSE.point,Cr=zt(Te,Ke)&&this.comparePoint(Ke)===0,_r=zt(j,sr)&&oe.comparePoint(sr)===0,Rr=zt(Te,Dt)&&this.comparePoint(Dt)===0,mn=zt(j,Yr)&&oe.comparePoint(Yr)===0;if(_r&&Cr)return mn&&!Rr?Yr:!mn&&Rr?Dt:null;if(_r)return Rr&&sr.x===Dt.x&&sr.y===Dt.y?null:sr;if(Cr)return mn&&Yr.x===Ke.x&&Yr.y===Ke.y?null:Ke;if(mn&&Rr)return null;if(mn)return Yr;if(Rr)return Dt;var vi=Ut(sr,this.vector(),Ke,oe.vector());return vi===null||!zt(ot,vi)?null:Ue.round(vi.x,vi.y)}},{key:"split",value:function(oe){var Te=[],j=oe.events!==void 0,ot=new cr(oe,!0),sr=new cr(oe,!1),Yr=this.rightSE;this.replaceRightSE(sr),Te.push(sr),Te.push(ot);var Ke=new It(ot,Yr,this.rings.slice(),this.windings.slice());return cr.comparePoints(Ke.leftSE.point,Ke.rightSE.point)>0&&Ke.swapEvents(),cr.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),j&&(ot.checkForConsuming(),sr.checkForConsuming()),Te}},{key:"swapEvents",value:function(){var oe=this.rightSE;this.rightSE=this.leftSE,this.leftSE=oe,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var Te=0,j=this.windings.length;Te<j;Te++)this.windings[Te]*=-1}},{key:"consume",value:function(oe){for(var Te=this,j=oe;Te.consumedBy;)Te=Te.consumedBy;for(;j.consumedBy;)j=j.consumedBy;var ot=It.compare(Te,j);if(ot!==0){if(ot>0){var sr=Te;Te=j,j=sr}if(Te.prev===j){var Yr=Te;Te=j,j=Yr}for(var Ke=0,Dt=j.rings.length;Ke<Dt;Ke++){var Cr=j.rings[Ke],_r=j.windings[Ke],Rr=Te.rings.indexOf(Cr);Rr===-1?(Te.rings.push(Cr),Te.windings.push(_r)):Te.windings[Rr]+=_r}j.rings=null,j.windings=null,j.consumedBy=Te,j.leftSE.consumedBy=Te.leftSE,j.rightSE.consumedBy=Te.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var oe=this.prev.consumedBy||this.prev;this._beforeState=oe.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var oe=this.beforeState();this._afterState={rings:oe.rings.slice(0),windings:oe.windings.slice(0),multiPolys:[]};for(var Te=this._afterState.rings,j=this._afterState.windings,ot=this._afterState.multiPolys,sr=0,Yr=this.rings.length;sr<Yr;sr++){var Ke=this.rings[sr],Dt=this.windings[sr],Cr=Te.indexOf(Ke);Cr===-1?(Te.push(Ke),j.push(Dt)):j[Cr]+=Dt}for(var _r=[],Rr=[],mn=0,vi=Te.length;mn<vi;mn++)if(j[mn]!==0){var ni=Te[mn],bn=ni.poly;if(Rr.indexOf(bn)===-1)if(ni.isExterior)_r.push(bn);else{Rr.indexOf(bn)===-1&&Rr.push(bn);var Oi=_r.indexOf(ni.poly);Oi!==-1&&_r.splice(Oi,1)}}for(var Ni=0,Ha=_r.length;Ni<Ha;Ni++){var oa=_r[Ni].multiPoly;ot.indexOf(oa)===-1&&ot.push(oa)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var oe=this.beforeState().multiPolys,Te=this.afterState().multiPolys;switch(Ki.type){case"union":{var j=oe.length===0,ot=Te.length===0;this._isInResult=j!==ot;break}case"intersection":{var sr,Yr;oe.length<Te.length?(sr=oe.length,Yr=Te.length):(sr=Te.length,Yr=oe.length),this._isInResult=Yr===Ki.numMultiPolys&&sr<Yr;break}case"xor":{var Ke=Math.abs(oe.length-Te.length);this._isInResult=Ke%2==1;break}case"difference":{var Dt=function(_r){return _r.length===1&&_r[0].isSubject};this._isInResult=Dt(oe)!==Dt(Te);break}default:throw new Error("Unrecognized operation type found ".concat(Ki.type))}return this._isInResult}}],[{key:"fromRing",value:function(oe,Te,j){var ot,sr,Yr,Ke=cr.comparePoints(oe,Te);if(Ke<0)ot=oe,sr=Te,Yr=1;else if(Ke>0)ot=Te,sr=oe,Yr=-1;else throw new Error("Tried to create degenerate segment at [".concat(oe.x,", ").concat(oe.y,"]"));var Dt=new cr(ot,!0),Cr=new cr(sr,!1);return new It(Dt,Cr,[j],[Yr])}}]),It}(),Xn=function(){function It(ge,oe,Te){if(de(this,It),!Array.isArray(ge)||ge.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=oe,this.isExterior=Te,this.segments=[],typeof ge[0][0]!="number"||typeof ge[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var j=Ue.round(ge[0][0],ge[0][1]);this.bbox={ll:{x:j.x,y:j.y},ur:{x:j.x,y:j.y}};for(var ot=j,sr=1,Yr=ge.length;sr<Yr;sr++){if(typeof ge[sr][0]!="number"||typeof ge[sr][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ke=Ue.round(ge[sr][0],ge[sr][1]);Ke.x===ot.x&&Ke.y===ot.y||(this.segments.push(Or.fromRing(ot,Ke,this)),Ke.x<this.bbox.ll.x&&(this.bbox.ll.x=Ke.x),Ke.y<this.bbox.ll.y&&(this.bbox.ll.y=Ke.y),Ke.x>this.bbox.ur.x&&(this.bbox.ur.x=Ke.x),Ke.y>this.bbox.ur.y&&(this.bbox.ur.y=Ke.y),ot=Ke)}(j.x!==ot.x||j.y!==ot.y)&&this.segments.push(Or.fromRing(ot,j,this))}return Ne(It,[{key:"getSweepEvents",value:function(){for(var oe=[],Te=0,j=this.segments.length;Te<j;Te++){var ot=this.segments[Te];oe.push(ot.leftSE),oe.push(ot.rightSE)}return oe}}]),It}(),Qr=function(){function It(ge,oe){if(de(this,It),!Array.isArray(ge))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Xn(ge[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Te=1,j=ge.length;Te<j;Te++){var ot=new Xn(ge[Te],this,!1);ot.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ot.bbox.ll.x),ot.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ot.bbox.ll.y),ot.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ot.bbox.ur.x),ot.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ot.bbox.ur.y),this.interiorRings.push(ot)}this.multiPoly=oe}return Ne(It,[{key:"getSweepEvents",value:function(){for(var oe=this.exteriorRing.getSweepEvents(),Te=0,j=this.interiorRings.length;Te<j;Te++)for(var ot=this.interiorRings[Te].getSweepEvents(),sr=0,Yr=ot.length;sr<Yr;sr++)oe.push(ot[sr]);return oe}}]),It}(),Pi=function(){function It(ge,oe){if(de(this,It),!Array.isArray(ge))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof ge[0][0][0]=="number"&&(ge=[ge])}catch(sr){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Te=0,j=ge.length;Te<j;Te++){var ot=new Qr(ge[Te],this);ot.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ot.bbox.ll.x),ot.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ot.bbox.ll.y),ot.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ot.bbox.ur.x),ot.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ot.bbox.ur.y),this.polys.push(ot)}this.isSubject=oe}return Ne(It,[{key:"getSweepEvents",value:function(){for(var oe=[],Te=0,j=this.polys.length;Te<j;Te++)for(var ot=this.polys[Te].getSweepEvents(),sr=0,Yr=ot.length;sr<Yr;sr++)oe.push(ot[sr]);return oe}}]),It}(),mi=function(){Ne(It,null,[{key:"factory",value:function(oe){for(var Te=[],j=0,ot=oe.length;j<ot;j++){var sr=oe[j];if(!(!sr.isInResult()||sr.ringOut)){for(var Yr=null,Ke=sr.leftSE,Dt=sr.rightSE,Cr=[Ke],_r=Ke.point,Rr=[];Yr=Ke,Ke=Dt,Cr.push(Ke),Ke.point!==_r;)for(;;){var mn=Ke.getAvailableLinkedEvents();if(mn.length===0){var vi=Cr[0].point,ni=Cr[Cr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(vi.x,",")+" ".concat(vi.y,"]. Last matching segment found ends at")+" [".concat(ni.x,", ").concat(ni.y,"]."))}if(mn.length===1){Dt=mn[0].otherSE;break}for(var bn=null,Oi=0,Ni=Rr.length;Oi<Ni;Oi++)if(Rr[Oi].point===Ke.point){bn=Oi;break}if(bn!==null){var Ha=Rr.splice(bn)[0],oa=Cr.splice(Ha.index);oa.unshift(oa[0].otherSE),Te.push(new It(oa.reverse()));continue}Rr.push({index:Cr.length,point:Ke.point});var Wa=Ke.getLeftmostComparator(Yr);Dt=mn.sort(Wa)[0].otherSE;break}Te.push(new It(Cr))}}return Te}}]);function It(ge){de(this,It),this.events=ge;for(var oe=0,Te=ge.length;oe<Te;oe++)ge[oe].segment.ringOut=this;this.poly=null}return Ne(It,[{key:"getGeom",value:function(){for(var oe=this.events[0].point,Te=[oe],j=1,ot=this.events.length-1;j<ot;j++){var sr=this.events[j].point,Yr=this.events[j+1].point;ue(sr,oe,Yr)!==0&&(Te.push(sr),oe=sr)}if(Te.length===1)return null;var Ke=Te[0],Dt=Te[1];ue(Ke,oe,Dt)===0&&Te.shift(),Te.push(Te[0]);for(var Cr=this.isExteriorRing()?1:-1,_r=this.isExteriorRing()?0:Te.length-1,Rr=this.isExteriorRing()?Te.length:-1,mn=[],vi=_r;vi!=Rr;vi+=Cr)mn.push([Te[vi].x,Te[vi].y]);return mn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var oe=this.enclosingRing();this._isExteriorRing=oe?!oe.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var oe=this.events[0],Te=1,j=this.events.length;Te<j;Te++){var ot=this.events[Te];cr.compare(oe,ot)>0&&(oe=ot)}for(var sr=oe.segment.prevInResult(),Yr=sr?sr.prevInResult():null;;){if(!sr)return null;if(!Yr)return sr.ringOut;if(Yr.ringOut!==sr.ringOut)return Yr.ringOut.enclosingRing()!==sr.ringOut?sr.ringOut:sr.ringOut.enclosingRing();sr=Yr.prevInResult(),Yr=sr?sr.prevInResult():null}}}]),It}(),ln=function(){function It(ge){de(this,It),this.exteriorRing=ge,ge.poly=this,this.interiorRings=[]}return Ne(It,[{key:"addInterior",value:function(oe){this.interiorRings.push(oe),oe.poly=this}},{key:"getGeom",value:function(){var oe=[this.exteriorRing.getGeom()];if(oe[0]===null)return null;for(var Te=0,j=this.interiorRings.length;Te<j;Te++){var ot=this.interiorRings[Te].getGeom();ot!==null&&oe.push(ot)}return oe}}]),It}(),ba=function(){function It(ge){de(this,It),this.rings=ge,this.polys=this._composePolys(ge)}return Ne(It,[{key:"getGeom",value:function(){for(var oe=[],Te=0,j=this.polys.length;Te<j;Te++){var ot=this.polys[Te].getGeom();ot!==null&&oe.push(ot)}return oe}},{key:"_composePolys",value:function(oe){for(var Te=[],j=0,ot=oe.length;j<ot;j++){var sr=oe[j];if(!sr.poly)if(sr.isExteriorRing())Te.push(new ln(sr));else{var Yr=sr.enclosingRing();Yr.poly||Te.push(new ln(Yr)),Yr.poly.addInterior(sr)}}return Te}}]),It}(),ua=function(){function It(ge){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Or.compare;de(this,It),this.queue=ge,this.tree=new Pt(oe),this.segments=[]}return Ne(It,[{key:"process",value:function(oe){var Te=oe.segment,j=[];if(oe.consumedBy)return oe.isLeft?this.queue.remove(oe.otherSE):this.tree.remove(Te),j;var ot=oe.isLeft?this.tree.insert(Te):this.tree.find(Te);if(!ot)throw new Error("Unable to find segment #".concat(Te.id," ")+"[".concat(Te.leftSE.point.x,", ").concat(Te.leftSE.point.y,"] -> ")+"[".concat(Te.rightSE.point.x,", ").concat(Te.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var sr=ot,Yr=ot,Ke=void 0,Dt=void 0;Ke===void 0;)sr=this.tree.prev(sr),sr===null?Ke=null:sr.key.consumedBy===void 0&&(Ke=sr.key);for(;Dt===void 0;)Yr=this.tree.next(Yr),Yr===null?Dt=null:Yr.key.consumedBy===void 0&&(Dt=Yr.key);if(oe.isLeft){var Cr=null;if(Ke){var _r=Ke.getIntersection(Te);if(_r!==null&&(Te.isAnEndpoint(_r)||(Cr=_r),!Ke.isAnEndpoint(_r)))for(var Rr=this._splitSafely(Ke,_r),mn=0,vi=Rr.length;mn<vi;mn++)j.push(Rr[mn])}var ni=null;if(Dt){var bn=Dt.getIntersection(Te);if(bn!==null&&(Te.isAnEndpoint(bn)||(ni=bn),!Dt.isAnEndpoint(bn)))for(var Oi=this._splitSafely(Dt,bn),Ni=0,Ha=Oi.length;Ni<Ha;Ni++)j.push(Oi[Ni])}if(Cr!==null||ni!==null){var oa=null;if(Cr===null)oa=ni;else if(ni===null)oa=Cr;else{var Wa=cr.comparePoints(Cr,ni);oa=Wa<=0?Cr:ni}this.queue.remove(Te.rightSE),j.push(Te.rightSE);for(var Ci=Te.split(oa),la=0,Q=Ci.length;la<Q;la++)j.push(Ci[la])}j.length>0?(this.tree.remove(Te),j.push(oe)):(this.segments.push(Te),Te.prev=Ke)}else{if(Ke&&Dt){var ae=Ke.getIntersection(Dt);if(ae!==null){if(!Ke.isAnEndpoint(ae))for(var me=this._splitSafely(Ke,ae),ke=0,qe=me.length;ke<qe;ke++)j.push(me[ke]);if(!Dt.isAnEndpoint(ae))for(var st=this._splitSafely(Dt,ae),xt=0,Me=st.length;xt<Me;xt++)j.push(st[xt])}}this.tree.remove(Te)}return j}},{key:"_splitSafely",value:function(oe,Te){this.tree.remove(oe);var j=oe.rightSE;this.queue.remove(j);var ot=oe.split(Te);return ot.push(j),oe.consumedBy===void 0&&this.tree.insert(oe),ot}}]),It}(),Li=typeof We!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Ma=typeof We!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ai=function(){function It(){de(this,It)}return Ne(It,[{key:"run",value:function(oe,Te,j){Ki.type=oe,Ue.reset();for(var ot=[new Pi(Te,!0)],sr=0,Yr=j.length;sr<Yr;sr++)ot.push(new Pi(j[sr],!1));if(Ki.numMultiPolys=ot.length,Ki.type==="difference")for(var Ke=ot[0],Dt=1;Dt<ot.length;)Pr(ot[Dt].bbox,Ke.bbox)!==null?Dt++:ot.splice(Dt,1);if(Ki.type==="intersection"){for(var Cr=0,_r=ot.length;Cr<_r;Cr++)for(var Rr=ot[Cr],mn=Cr+1,vi=ot.length;mn<vi;mn++)if(Pr(Rr.bbox,ot[mn].bbox)===null)return[]}for(var ni=new Pt(cr.compare),bn=0,Oi=ot.length;bn<Oi;bn++)for(var Ni=ot[bn].getSweepEvents(),Ha=0,oa=Ni.length;Ha<oa;Ha++)if(ni.insert(Ni[Ha]),ni.size>Li)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Wa=new ua(ni),Ci=ni.size,la=ni.pop();la;){var Q=la.key;if(ni.size===Ci){var ae=Q.segment;throw new Error("Unable to pop() ".concat(Q.isLeft?"left":"right"," SweepEvent ")+"[".concat(Q.point.x,", ").concat(Q.point.y,"] from segment #").concat(ae.id," ")+"[".concat(ae.leftSE.point.x,", ").concat(ae.leftSE.point.y,"] -> ")+"[".concat(ae.rightSE.point.x,", ").concat(ae.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(ni.size>Li)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Wa.segments.length>Ma)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var me=Wa.process(Q),ke=0,qe=me.length;ke<qe;ke++){var st=me[ke];st.consumedBy===void 0&&ni.insert(st)}Ci=ni.size,la=ni.pop()}Ue.reset();var xt=mi.factory(Wa.segments),Me=new ba(xt);return Me.getGeom()}}]),It}(),Ki=new ai,ci=function(ge){for(var oe=arguments.length,Te=new Array(oe>1?oe-1:0),j=1;j<oe;j++)Te[j-1]=arguments[j];return Ki.run("union",ge,Te)},gi=function(ge){for(var oe=arguments.length,Te=new Array(oe>1?oe-1:0),j=1;j<oe;j++)Te[j-1]=arguments[j];return Ki.run("intersection",ge,Te)},zo=function(ge){for(var oe=arguments.length,Te=new Array(oe>1?oe-1:0),j=1;j<oe;j++)Te[j-1]=arguments[j];return Ki.run("xor",ge,Te)},go=function(ge){for(var oe=arguments.length,Te=new Array(oe>1?oe-1:0),j=1;j<oe;j++)Te[j-1]=arguments[j];return Ki.run("difference",ge,Te)},no={union:ci,intersection:gi,xor:zo,difference:go};return no})},28660:function(hi,Ae,fe){var We=fe(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var de;(function(y){(function(Ne){var K=typeof fe.g=="object"?fe.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Re=pe(y);typeof K.Reflect=="undefined"?K.Reflect=y:Re=pe(K.Reflect,Re),Ne(Re);function pe(lt,we){return function(Xe,Ct){typeof lt[Xe]!="function"&&Object.defineProperty(lt,Xe,{configurable:!0,writable:!0,value:Ct}),we&&we(Xe,Ct)}}})(function(Ne){var K=Object.prototype.hasOwnProperty,Re=typeof Symbol=="function",pe=Re&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",lt=Re&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",we=typeof Object.create=="function",Xe={__proto__:[]}instanceof Array,Ct=!we&&!Xe,Pt={create:we?function(){return Yr(Object.create(null))}:Xe?function(){return Yr({__proto__:null})}:function(){return Yr({})},has:Ct?function(Ke,Dt){return K.call(Ke,Dt)}:function(Ke,Dt){return Dt in Ke},get:Ct?function(Ke,Dt){return K.call(Ke,Dt)?Ke[Dt]:void 0}:function(Ke,Dt){return Ke[Dt]}},tr=Object.getPrototypeOf(Function),Yt=typeof We=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Wt=!Yt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:j(),br=!Yt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:ot(),lr=!Yt&&typeof WeakMap=="function"?WeakMap:sr(),kt=new lr;function zt(Ke,Dt,Cr,_r){if(Qr(Cr)){if(!Ki(Ke))throw new TypeError;if(!gi(Dt))throw new TypeError;return ue(Ke,Dt)}else{if(!Ki(Ke))throw new TypeError;if(!ln(Dt))throw new TypeError;if(!ln(_r)&&!Qr(_r)&&!Pi(_r))throw new TypeError;return Pi(_r)&&(_r=void 0),Cr=ai(Cr),rt(Ke,Dt,Cr,_r)}}Ne("decorate",zt);function Pr(Ke,Dt){function Cr(_r,Rr){if(!ln(_r))throw new TypeError;if(!Qr(Rr)&&!zo(Rr))throw new TypeError;cr(Ke,Dt,_r,Rr)}return Cr}Ne("metadata",Pr);function re(Ke,Dt,Cr,_r){if(!ln(Cr))throw new TypeError;return Qr(_r)||(_r=ai(_r)),cr(Ke,Dt,Cr,_r)}Ne("defineMetadata",re);function yr(Ke,Dt,Cr){if(!ln(Dt))throw new TypeError;return Qr(Cr)||(Cr=ai(Cr)),_e(Ke,Dt,Cr)}Ne("hasMetadata",yr);function Rt(Ke,Dt,Cr){if(!ln(Dt))throw new TypeError;return Qr(Cr)||(Cr=ai(Cr)),ze(Ke,Dt,Cr)}Ne("hasOwnMetadata",Rt);function _t(Ke,Dt,Cr){if(!ln(Dt))throw new TypeError;return Qr(Cr)||(Cr=ai(Cr)),St(Ke,Dt,Cr)}Ne("getMetadata",_t);function Kt(Ke,Dt,Cr){if(!ln(Dt))throw new TypeError;return Qr(Cr)||(Cr=ai(Cr)),Ut(Ke,Dt,Cr)}Ne("getOwnMetadata",Kt);function Ue(Ke,Dt){if(!ln(Ke))throw new TypeError;return Qr(Dt)||(Dt=ai(Dt)),wt(Ke,Dt)}Ne("getMetadataKeys",Ue);function Er(Ke,Dt){if(!ln(Ke))throw new TypeError;return Qr(Dt)||(Dt=ai(Dt)),Or(Ke,Dt)}Ne("getOwnMetadataKeys",Er);function an(Ke,Dt,Cr){if(!ln(Dt))throw new TypeError;Qr(Cr)||(Cr=ai(Cr));var _r=Z(Dt,Cr,!1);if(Qr(_r)||!_r.delete(Ke))return!1;if(_r.size>0)return!0;var Rr=kt.get(Dt);return Rr.delete(Cr),Rr.size>0||kt.delete(Dt),!0}Ne("deleteMetadata",an);function ue(Ke,Dt){for(var Cr=Ke.length-1;Cr>=0;--Cr){var _r=Ke[Cr],Rr=_r(Dt);if(!Qr(Rr)&&!Pi(Rr)){if(!gi(Rr))throw new TypeError;Dt=Rr}}return Dt}function rt(Ke,Dt,Cr,_r){for(var Rr=Ke.length-1;Rr>=0;--Rr){var mn=Ke[Rr],vi=mn(Dt,Cr,_r);if(!Qr(vi)&&!Pi(vi)){if(!ln(vi))throw new TypeError;_r=vi}}return _r}function Z(Ke,Dt,Cr){var _r=kt.get(Ke);if(Qr(_r)){if(!Cr)return;_r=new Wt,kt.set(Ke,_r)}var Rr=_r.get(Dt);if(Qr(Rr)){if(!Cr)return;Rr=new Wt,_r.set(Dt,Rr)}return Rr}function _e(Ke,Dt,Cr){var _r=ze(Ke,Dt,Cr);if(_r)return!0;var Rr=Te(Dt);return Pi(Rr)?!1:_e(Ke,Rr,Cr)}function ze(Ke,Dt,Cr){var _r=Z(Dt,Cr,!1);return Qr(_r)?!1:Li(_r.has(Ke))}function St(Ke,Dt,Cr){var _r=ze(Ke,Dt,Cr);if(_r)return Ut(Ke,Dt,Cr);var Rr=Te(Dt);if(!Pi(Rr))return St(Ke,Rr,Cr)}function Ut(Ke,Dt,Cr){var _r=Z(Dt,Cr,!1);if(!Qr(_r))return _r.get(Ke)}function cr(Ke,Dt,Cr,_r){var Rr=Z(Cr,_r,!0);Rr.set(Ke,Dt)}function wt(Ke,Dt){var Cr=Or(Ke,Dt),_r=Te(Ke);if(_r===null)return Cr;var Rr=wt(_r,Dt);if(Rr.length<=0)return Cr;if(Cr.length<=0)return Rr;for(var mn=new br,vi=[],ni=0,bn=Cr;ni<bn.length;ni++){var Oi=bn[ni],Ni=mn.has(Oi);Ni||(mn.add(Oi),vi.push(Oi))}for(var Ha=0,oa=Rr;Ha<oa.length;Ha++){var Oi=oa[Ha],Ni=mn.has(Oi);Ni||(mn.add(Oi),vi.push(Oi))}return vi}function Or(Ke,Dt){var Cr=[],_r=Z(Ke,Dt,!1);if(Qr(_r))return Cr;for(var Rr=_r.keys(),mn=no(Rr),vi=0;;){var ni=ge(mn);if(!ni)return Cr.length=vi,Cr;var bn=It(ni);try{Cr[vi]=bn}catch(Oi){try{oe(mn)}finally{throw Oi}}vi++}}function Xn(Ke){if(Ke===null)return 1;switch(typeof Ke){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ke===null?1:6;default:return 6}}function Qr(Ke){return Ke===void 0}function Pi(Ke){return Ke===null}function mi(Ke){return typeof Ke=="symbol"}function ln(Ke){return typeof Ke=="object"?Ke!==null:typeof Ke=="function"}function ba(Ke,Dt){switch(Xn(Ke)){case 0:return Ke;case 1:return Ke;case 2:return Ke;case 3:return Ke;case 4:return Ke;case 5:return Ke}var Cr=Dt===3?"string":Dt===5?"number":"default",_r=go(Ke,pe);if(_r!==void 0){var Rr=_r.call(Ke,Cr);if(ln(Rr))throw new TypeError;return Rr}return ua(Ke,Cr==="default"?"number":Cr)}function ua(Ke,Dt){if(Dt==="string"){var Cr=Ke.toString;if(ci(Cr)){var _r=Cr.call(Ke);if(!ln(_r))return _r}var Rr=Ke.valueOf;if(ci(Rr)){var _r=Rr.call(Ke);if(!ln(_r))return _r}}else{var Rr=Ke.valueOf;if(ci(Rr)){var _r=Rr.call(Ke);if(!ln(_r))return _r}var mn=Ke.toString;if(ci(mn)){var _r=mn.call(Ke);if(!ln(_r))return _r}}throw new TypeError}function Li(Ke){return!!Ke}function Ma(Ke){return""+Ke}function ai(Ke){var Dt=ba(Ke,3);return mi(Dt)?Dt:Ma(Dt)}function Ki(Ke){return Array.isArray?Array.isArray(Ke):Ke instanceof Object?Ke instanceof Array:Object.prototype.toString.call(Ke)==="[object Array]"}function ci(Ke){return typeof Ke=="function"}function gi(Ke){return typeof Ke=="function"}function zo(Ke){switch(Xn(Ke)){case 3:return!0;case 4:return!0;default:return!1}}function go(Ke,Dt){var Cr=Ke[Dt];if(Cr!=null){if(!ci(Cr))throw new TypeError;return Cr}}function no(Ke){var Dt=go(Ke,lt);if(!ci(Dt))throw new TypeError;var Cr=Dt.call(Ke);if(!ln(Cr))throw new TypeError;return Cr}function It(Ke){return Ke.value}function ge(Ke){var Dt=Ke.next();return Dt.done?!1:Dt}function oe(Ke){var Dt=Ke.return;Dt&&Dt.call(Ke)}function Te(Ke){var Dt=Object.getPrototypeOf(Ke);if(typeof Ke!="function"||Ke===tr||Dt!==tr)return Dt;var Cr=Ke.prototype,_r=Cr&&Object.getPrototypeOf(Cr);if(_r==null||_r===Object.prototype)return Dt;var Rr=_r.constructor;return typeof Rr!="function"||Rr===Ke?Dt:Rr}function j(){var Ke={},Dt=[],Cr=function(){function vi(ni,bn,Oi){this._index=0,this._keys=ni,this._values=bn,this._selector=Oi}return vi.prototype["@@iterator"]=function(){return this},vi.prototype[lt]=function(){return this},vi.prototype.next=function(){var ni=this._index;if(ni>=0&&ni<this._keys.length){var bn=this._selector(this._keys[ni],this._values[ni]);return ni+1>=this._keys.length?(this._index=-1,this._keys=Dt,this._values=Dt):this._index++,{value:bn,done:!1}}return{value:void 0,done:!0}},vi.prototype.throw=function(ni){throw this._index>=0&&(this._index=-1,this._keys=Dt,this._values=Dt),ni},vi.prototype.return=function(ni){return this._index>=0&&(this._index=-1,this._keys=Dt,this._values=Dt),{value:ni,done:!0}},vi}();return function(){function vi(){this._keys=[],this._values=[],this._cacheKey=Ke,this._cacheIndex=-2}return Object.defineProperty(vi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),vi.prototype.has=function(ni){return this._find(ni,!1)>=0},vi.prototype.get=function(ni){var bn=this._find(ni,!1);return bn>=0?this._values[bn]:void 0},vi.prototype.set=function(ni,bn){var Oi=this._find(ni,!0);return this._values[Oi]=bn,this},vi.prototype.delete=function(ni){var bn=this._find(ni,!1);if(bn>=0){for(var Oi=this._keys.length,Ni=bn+1;Ni<Oi;Ni++)this._keys[Ni-1]=this._keys[Ni],this._values[Ni-1]=this._values[Ni];return this._keys.length--,this._values.length--,ni===this._cacheKey&&(this._cacheKey=Ke,this._cacheIndex=-2),!0}return!1},vi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ke,this._cacheIndex=-2},vi.prototype.keys=function(){return new Cr(this._keys,this._values,_r)},vi.prototype.values=function(){return new Cr(this._keys,this._values,Rr)},vi.prototype.entries=function(){return new Cr(this._keys,this._values,mn)},vi.prototype["@@iterator"]=function(){return this.entries()},vi.prototype[lt]=function(){return this.entries()},vi.prototype._find=function(ni,bn){return this._cacheKey!==ni&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ni)),this._cacheIndex<0&&bn&&(this._cacheIndex=this._keys.length,this._keys.push(ni),this._values.push(void 0)),this._cacheIndex},vi}();function _r(vi,ni){return vi}function Rr(vi,ni){return ni}function mn(vi,ni){return[vi,ni]}}function ot(){return function(){function Ke(){this._map=new Wt}return Object.defineProperty(Ke.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ke.prototype.has=function(Dt){return this._map.has(Dt)},Ke.prototype.add=function(Dt){return this._map.set(Dt,Dt),this},Ke.prototype.delete=function(Dt){return this._map.delete(Dt)},Ke.prototype.clear=function(){this._map.clear()},Ke.prototype.keys=function(){return this._map.keys()},Ke.prototype.values=function(){return this._map.values()},Ke.prototype.entries=function(){return this._map.entries()},Ke.prototype["@@iterator"]=function(){return this.keys()},Ke.prototype[lt]=function(){return this.keys()},Ke}()}function sr(){var Ke=16,Dt=Pt.create(),Cr=_r();return function(){function bn(){this._key=_r()}return bn.prototype.has=function(Oi){var Ni=Rr(Oi,!1);return Ni!==void 0?Pt.has(Ni,this._key):!1},bn.prototype.get=function(Oi){var Ni=Rr(Oi,!1);return Ni!==void 0?Pt.get(Ni,this._key):void 0},bn.prototype.set=function(Oi,Ni){var Ha=Rr(Oi,!0);return Ha[this._key]=Ni,this},bn.prototype.delete=function(Oi){var Ni=Rr(Oi,!1);return Ni!==void 0?delete Ni[this._key]:!1},bn.prototype.clear=function(){this._key=_r()},bn}();function _r(){var bn;do bn="@@WeakMap@@"+ni();while(Pt.has(Dt,bn));return Dt[bn]=!0,bn}function Rr(bn,Oi){if(!K.call(bn,Cr)){if(!Oi)return;Object.defineProperty(bn,Cr,{value:Pt.create()})}return bn[Cr]}function mn(bn,Oi){for(var Ni=0;Ni<Oi;++Ni)bn[Ni]=Math.random()*255|0;return bn}function vi(bn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(bn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(bn)):mn(new Uint8Array(bn),bn):mn(new Array(bn),bn)}function ni(){var bn=vi(Ke);bn[6]=bn[6]&79|64,bn[8]=bn[8]&191|128;for(var Oi="",Ni=0;Ni<Ke;++Ni){var Ha=bn[Ni];(Ni===4||Ni===6||Ni===8)&&(Oi+="-"),Ha<16&&(Oi+="0"),Oi+=Ha.toString(16).toLowerCase()}return Oi}}function Yr(Ke){return Ke.__=void 0,delete Ke.__,Ke}})})(de||(de={}))},69848:function(hi){(function(Ae,fe){hi.exports=fe()})(this,function(){"use strict";function Ae(Rt,_t,Kt,Ue,Er,an){if(!(Er-Ue<=Kt)){var ue=Ue+Er>>1;fe(Rt,_t,ue,Ue,Er,an%2),Ae(Rt,_t,Kt,Ue,ue-1,an+1),Ae(Rt,_t,Kt,ue+1,Er,an+1)}}function fe(Rt,_t,Kt,Ue,Er,an){for(;Er>Ue;){if(Er-Ue>600){var ue=Er-Ue+1,rt=Kt-Ue+1,Z=Math.log(ue),_e=.5*Math.exp(2*Z/3),ze=.5*Math.sqrt(Z*_e*(ue-_e)/ue)*(rt-ue/2<0?-1:1),St=Math.max(Ue,Math.floor(Kt-rt*_e/ue+ze)),Ut=Math.min(Er,Math.floor(Kt+(ue-rt)*_e/ue+ze));fe(Rt,_t,Kt,St,Ut,an)}var cr=_t[2*Kt+an],wt=Ue,Or=Er;for(We(Rt,_t,Ue,Kt),_t[2*Er+an]>cr&&We(Rt,_t,Ue,Er);wt<Or;){for(We(Rt,_t,wt,Or),wt++,Or--;_t[2*wt+an]<cr;)wt++;for(;_t[2*Or+an]>cr;)Or--}_t[2*Ue+an]===cr?We(Rt,_t,Ue,Or):(Or++,We(Rt,_t,Or,Er)),Or<=Kt&&(Ue=Or+1),Kt<=Or&&(Er=Or-1)}}function We(Rt,_t,Kt,Ue){de(Rt,Kt,Ue),de(_t,2*Kt,2*Ue),de(_t,2*Kt+1,2*Ue+1)}function de(Rt,_t,Kt){var Ue=Rt[_t];Rt[_t]=Rt[Kt],Rt[Kt]=Ue}function y(Rt,_t,Kt,Ue,Er,an,ue){for(var rt=[0,Rt.length-1,0],Z=[],_e,ze;rt.length;){var St=rt.pop(),Ut=rt.pop(),cr=rt.pop();if(Ut-cr<=ue){for(var wt=cr;wt<=Ut;wt++)_e=_t[2*wt],ze=_t[2*wt+1],_e>=Kt&&_e<=Er&&ze>=Ue&&ze<=an&&Z.push(Rt[wt]);continue}var Or=Math.floor((cr+Ut)/2);_e=_t[2*Or],ze=_t[2*Or+1],_e>=Kt&&_e<=Er&&ze>=Ue&&ze<=an&&Z.push(Rt[Or]);var Xn=(St+1)%2;(St===0?Kt<=_e:Ue<=ze)&&(rt.push(cr),rt.push(Or-1),rt.push(Xn)),(St===0?Er>=_e:an>=ze)&&(rt.push(Or+1),rt.push(Ut),rt.push(Xn))}return Z}function Ne(Rt,_t,Kt,Ue,Er,an){for(var ue=[0,Rt.length-1,0],rt=[],Z=Er*Er;ue.length;){var _e=ue.pop(),ze=ue.pop(),St=ue.pop();if(ze-St<=an){for(var Ut=St;Ut<=ze;Ut++)K(_t[2*Ut],_t[2*Ut+1],Kt,Ue)<=Z&&rt.push(Rt[Ut]);continue}var cr=Math.floor((St+ze)/2),wt=_t[2*cr],Or=_t[2*cr+1];K(wt,Or,Kt,Ue)<=Z&&rt.push(Rt[cr]);var Xn=(_e+1)%2;(_e===0?Kt-Er<=wt:Ue-Er<=Or)&&(ue.push(St),ue.push(cr-1),ue.push(Xn)),(_e===0?Kt+Er>=wt:Ue+Er>=Or)&&(ue.push(cr+1),ue.push(ze),ue.push(Xn))}return rt}function K(Rt,_t,Kt,Ue){var Er=Rt-Kt,an=_t-Ue;return Er*Er+an*an}var Re=function(Rt){return Rt[0]},pe=function(Rt){return Rt[1]},lt=function(_t,Kt,Ue,Er,an){Kt===void 0&&(Kt=Re),Ue===void 0&&(Ue=pe),Er===void 0&&(Er=64),an===void 0&&(an=Float64Array),this.nodeSize=Er,this.points=_t;for(var ue=_t.length<65536?Uint16Array:Uint32Array,rt=this.ids=new ue(_t.length),Z=this.coords=new an(_t.length*2),_e=0;_e<_t.length;_e++)rt[_e]=_e,Z[2*_e]=Kt(_t[_e]),Z[2*_e+1]=Ue(_t[_e]);Ae(rt,Z,Er,0,rt.length-1,0)};lt.prototype.range=function(_t,Kt,Ue,Er){return y(this.ids,this.coords,_t,Kt,Ue,Er,this.nodeSize)},lt.prototype.within=function(_t,Kt,Ue){return Ne(this.ids,this.coords,_t,Kt,Ue,this.nodeSize)};var we={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Rt){return Rt}},Xe=Math.fround||function(Rt){return function(_t){return Rt[0]=+_t,Rt[0]}}(new Float32Array(1)),Ct=function(_t){this.options=Pr(Object.create(we),_t),this.trees=new Array(this.options.maxZoom+1)};Ct.prototype.load=function(_t){var Kt=this.options,Ue=Kt.log,Er=Kt.minZoom,an=Kt.maxZoom,ue=Kt.nodeSize;Ue&&console.time("total time");var rt="prepare "+_t.length+" points";Ue&&console.time(rt),this.points=_t;for(var Z=[],_e=0;_e<_t.length;_e++)!_t[_e].geometry||Z.push(tr(_t[_e],_e));this.trees[an+1]=new lt(Z,re,yr,ue,Float32Array),Ue&&console.timeEnd(rt);for(var ze=an;ze>=Er;ze--){var St=+Date.now();Z=this._cluster(Z,ze),this.trees[ze]=new lt(Z,re,yr,ue,Float32Array),Ue&&console.log("z%d: %d clusters in %dms",ze,Z.length,+Date.now()-St)}return Ue&&console.timeEnd("total time"),this},Ct.prototype.getClusters=function(_t,Kt){var Ue=((_t[0]+180)%360+360)%360-180,Er=Math.max(-90,Math.min(90,_t[1])),an=_t[2]===180?180:((_t[2]+180)%360+360)%360-180,ue=Math.max(-90,Math.min(90,_t[3]));if(_t[2]-_t[0]>=360)Ue=-180,an=180;else if(Ue>an){var rt=this.getClusters([Ue,Er,180,ue],Kt),Z=this.getClusters([-180,Er,an,ue],Kt);return rt.concat(Z)}for(var _e=this.trees[this._limitZoom(Kt)],ze=_e.range(br(Ue),lr(ue),br(an),lr(Er)),St=[],Ut=0,cr=ze;Ut<cr.length;Ut+=1){var wt=cr[Ut],Or=_e.points[wt];St.push(Or.numPoints?Yt(Or):this.points[Or.index])}return St},Ct.prototype.getChildren=function(_t){var Kt=this._getOriginId(_t),Ue=this._getOriginZoom(_t),Er="No cluster with the specified id.",an=this.trees[Ue];if(!an)throw new Error(Er);var ue=an.points[Kt];if(!ue)throw new Error(Er);for(var rt=this.options.radius/(this.options.extent*Math.pow(2,Ue-1)),Z=an.within(ue.x,ue.y,rt),_e=[],ze=0,St=Z;ze<St.length;ze+=1){var Ut=St[ze],cr=an.points[Ut];cr.parentId===_t&&_e.push(cr.numPoints?Yt(cr):this.points[cr.index])}if(_e.length===0)throw new Error(Er);return _e},Ct.prototype.getLeaves=function(_t,Kt,Ue){Kt=Kt||10,Ue=Ue||0;var Er=[];return this._appendLeaves(Er,_t,Kt,Ue,0),Er},Ct.prototype.getTile=function(_t,Kt,Ue){var Er=this.trees[this._limitZoom(_t)],an=Math.pow(2,_t),ue=this.options,rt=ue.extent,Z=ue.radius,_e=Z/rt,ze=(Ue-_e)/an,St=(Ue+1+_e)/an,Ut={features:[]};return this._addTileFeatures(Er.range((Kt-_e)/an,ze,(Kt+1+_e)/an,St),Er.points,Kt,Ue,an,Ut),Kt===0&&this._addTileFeatures(Er.range(1-_e/an,ze,1,St),Er.points,an,Ue,an,Ut),Kt===an-1&&this._addTileFeatures(Er.range(0,ze,_e/an,St),Er.points,-1,Ue,an,Ut),Ut.features.length?Ut:null},Ct.prototype.getClusterExpansionZoom=function(_t){for(var Kt=this._getOriginZoom(_t)-1;Kt<=this.options.maxZoom;){var Ue=this.getChildren(_t);if(Kt++,Ue.length!==1)break;_t=Ue[0].properties.cluster_id}return Kt},Ct.prototype._appendLeaves=function(_t,Kt,Ue,Er,an){for(var ue=this.getChildren(Kt),rt=0,Z=ue;rt<Z.length;rt+=1){var _e=Z[rt],ze=_e.properties;if(ze&&ze.cluster?an+ze.point_count<=Er?an+=ze.point_count:an=this._appendLeaves(_t,ze.cluster_id,Ue,Er,an):an<Er?an++:_t.push(_e),_t.length===Ue)break}return an},Ct.prototype._addTileFeatures=function(_t,Kt,Ue,Er,an,ue){for(var rt=0,Z=_t;rt<Z.length;rt+=1){var _e=Z[rt],ze=Kt[_e],St=ze.numPoints,Ut=void 0,cr=void 0,wt=void 0;if(St)Ut=Wt(ze),cr=ze.x,wt=ze.y;else{var Or=this.points[ze.index];Ut=Or.properties,cr=br(Or.geometry.coordinates[0]),wt=lr(Or.geometry.coordinates[1])}var Xn={type:1,geometry:[[Math.round(this.options.extent*(cr*an-Ue)),Math.round(this.options.extent*(wt*an-Er))]],tags:Ut},Qr=void 0;St?Qr=ze.id:this.options.generateId?Qr=ze.index:this.points[ze.index].id&&(Qr=this.points[ze.index].id),Qr!==void 0&&(Xn.id=Qr),ue.features.push(Xn)}},Ct.prototype._limitZoom=function(_t){return Math.max(this.options.minZoom,Math.min(Math.floor(+_t),this.options.maxZoom+1))},Ct.prototype._cluster=function(_t,Kt){for(var Ue=[],Er=this.options,an=Er.radius,ue=Er.extent,rt=Er.reduce,Z=Er.minPoints,_e=an/(ue*Math.pow(2,Kt)),ze=0;ze<_t.length;ze++){var St=_t[ze];if(!(St.zoom<=Kt)){St.zoom=Kt;for(var Ut=this.trees[Kt+1],cr=Ut.within(St.x,St.y,_e),wt=St.numPoints||1,Or=wt,Xn=0,Qr=cr;Xn<Qr.length;Xn+=1){var Pi=Qr[Xn],mi=Ut.points[Pi];mi.zoom>Kt&&(Or+=mi.numPoints||1)}if(Or>wt&&Or>=Z){for(var ln=St.x*wt,ba=St.y*wt,ua=rt&&wt>1?this._map(St,!0):null,Li=(ze<<5)+(Kt+1)+this.points.length,Ma=0,ai=cr;Ma<ai.length;Ma+=1){var Ki=ai[Ma],ci=Ut.points[Ki];if(!(ci.zoom<=Kt)){ci.zoom=Kt;var gi=ci.numPoints||1;ln+=ci.x*gi,ba+=ci.y*gi,ci.parentId=Li,rt&&(ua||(ua=this._map(St,!0)),rt(ua,this._map(ci)))}}St.parentId=Li,Ue.push(Pt(ln/Or,ba/Or,Li,Or,ua))}else if(Ue.push(St),Or>1)for(var zo=0,go=cr;zo<go.length;zo+=1){var no=go[zo],It=Ut.points[no];It.zoom<=Kt||(It.zoom=Kt,Ue.push(It))}}}return Ue},Ct.prototype._getOriginId=function(_t){return _t-this.points.length>>5},Ct.prototype._getOriginZoom=function(_t){return(_t-this.points.length)%32},Ct.prototype._map=function(_t,Kt){if(_t.numPoints)return Kt?Pr({},_t.properties):_t.properties;var Ue=this.points[_t.index].properties,Er=this.options.map(Ue);return Kt&&Er===Ue?Pr({},Er):Er};function Pt(Rt,_t,Kt,Ue,Er){return{x:Xe(Rt),y:Xe(_t),zoom:Infinity,id:Kt,parentId:-1,numPoints:Ue,properties:Er}}function tr(Rt,_t){var Kt=Rt.geometry.coordinates,Ue=Kt[0],Er=Kt[1];return{x:Xe(br(Ue)),y:Xe(lr(Er)),zoom:Infinity,index:_t,parentId:-1}}function Yt(Rt){return{type:"Feature",id:Rt.id,properties:Wt(Rt),geometry:{type:"Point",coordinates:[kt(Rt.x),zt(Rt.y)]}}}function Wt(Rt){var _t=Rt.numPoints,Kt=_t>=1e4?Math.round(_t/1e3)+"k":_t>=1e3?Math.round(_t/100)/10+"k":_t;return Pr(Pr({},Rt.properties),{cluster:!0,cluster_id:Rt.id,point_count:_t,point_count_abbreviated:Kt})}function br(Rt){return Rt/360+.5}function lr(Rt){var _t=Math.sin(Rt*Math.PI/180),Kt=.5-.25*Math.log((1+_t)/(1-_t))/Math.PI;return Kt<0?0:Kt>1?1:Kt}function kt(Rt){return(Rt-.5)*360}function zt(Rt){var _t=(180-Rt*360)*Math.PI/180;return 360*Math.atan(Math.exp(_t))/Math.PI-90}function Pr(Rt,_t){for(var Kt in _t)Rt[Kt]=_t[Kt];return Rt}function re(Rt){return Rt.x}function yr(Rt){return Rt.y}return Ct})}}]);
