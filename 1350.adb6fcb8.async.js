(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1350],{64335:function(ci,Ae,de){"use strict";var He=de(67294),ge=(0,He.createContext)({});Ae.Z=ge},21349:function(ci,Ae,de){"use strict";var He=de(84305),ge=de(75901),y=de(85893),Ne=de(94184),Q=de.n(Ne),Pe=de(67294),ve=de(64335),lt=de(53645),we=de.n(lt),We=function(Rt){var tr=(0,Pe.useContext)(ve.Z),qt=Rt.children,Yt=Rt.contentWidth,Sr=Rt.className,fr=Rt.style,It=(0,Pe.useContext)(ge.ZP.ConfigContext),jt=It.getPrefixCls,Rr=Rt.prefixCls||jt("pro"),ie=Yt||tr.contentWidth,_r="".concat(Rr,"-grid-content");return(0,y.jsx)("div",{className:Q()(_r,Sr,{wide:ie==="Fixed"}),style:fr,children:(0,y.jsx)("div",{className:"".concat(Rr,"-grid-content-children"),children:qt})})};Ae.Z=We},59159:function(ci,Ae,de){"use strict";de.d(Ae,{zP:function(){return ZP},JE:function(){return Qk},ns:function(){return UP}});var He={};de.r(He),de.d(He,{add:function(){return lf},adjoint:function(){return fp},clone:function(){return fd},copy:function(){return hd},create:function(){return Wc},determinant:function(){return Up},equals:function(){return _h},exactEquals:function(){return Vp},frob:function(){return dv},fromQuat:function(){return s0},fromQuat2:function(){return D0},fromRotation:function(){return gd},fromRotationTranslation:function(){return Zh},fromRotationTranslationScale:function(){return o0},fromRotationTranslationScaleOrigin:function(){return Ud},fromScaling:function(){return a0},fromTranslation:function(){return Zp},fromValues:function(){return lp},fromXRotation:function(){return Ss},fromYRotation:function(){return Zf},fromZRotation:function(){return Vv},frustum:function(){return u0},getRotation:function(){return bc},getScaling:function(){return yh},getTranslation:function(){return B0},identity:function(){return zp},invert:function(){return Uh},lookAt:function(){return z0},mul:function(){return _d},multiply:function(){return wu},multiplyScalar:function(){return vv},multiplyScalarAndAdd:function(){return hp},ortho:function(){return c0},orthoNO:function(){return Vd},orthoZO:function(){return Ll},perspective:function(){return N0},perspectiveFromFieldOfView:function(){return yd},perspectiveNO:function(){return l0},perspectiveZO:function(){return Zd},rotate:function(){return dd},rotateX:function(){return vd},rotateY:function(){return md},rotateZ:function(){return zd},scale:function(){return gh},set:function(){return pd},str:function(){return f0},sub:function(){return xd},subtract:function(){return Cc},targetTo:function(){return Ec},translate:function(){return mh},transpose:function(){return cp}});var ge=de(67294),y=(0,ge.createContext)({});function Ne(){return(0,ge.useContext)(y)}var Q={},Pe={},ve=function(a){return Pe[a]},lt=function(a,t){Pe[a]=t},we=function(a){return Q[a]},We=function(a,t){Q[a]=t},St={},Rt={},tr=34,qt=10,Yt=13;function Sr(e){return new Function("d","return {"+e.map(function(a,t){return JSON.stringify(a)+": d["+t+'] || ""'}).join(",")+"}")}function fr(e,a){var t=Sr(e);return function(n,r){return a(t(n),r,e)}}function It(e){var a=Object.create(null),t=[];return e.forEach(function(n){for(var r in n)r in a||t.push(a[r]=r)}),t}function jt(e,a){var t=e+"",n=t.length;return n<a?new Array(a-n+1).join(0)+t:t}function Rr(e){return e<0?"-"+jt(-e,6):e>9999?"+"+jt(e,6):jt(e,4)}function ie(e){var a=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Rr(e.getUTCFullYear(),4)+"-"+jt(e.getUTCMonth()+1,2)+"-"+jt(e.getUTCDate(),2)+(r?"T"+jt(a,2)+":"+jt(t,2)+":"+jt(n,2)+"."+jt(r,3)+"Z":n?"T"+jt(a,2)+":"+jt(t,2)+":"+jt(n,2)+"Z":t||a?"T"+jt(a,2)+":"+jt(t,2)+"Z":"")}function _r(e){var a=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(A,k){var L,B,Z=r(A,function(V,K){if(L)return L(V,K-1);B=V,L=k?fr(V,k):Sr(V)});return Z.columns=B||[],Z}function r(A,k){var L=[],B=A.length,Z=0,V=0,K,le=B<=0,be=!1;A.charCodeAt(B-1)===qt&&--B,A.charCodeAt(B-1)===Yt&&--B;function Be(){if(le)return Rt;if(be)return be=!1,St;var at,Lt=Z,Gt;if(A.charCodeAt(Lt)===tr){for(;Z++<B&&A.charCodeAt(Z)!==tr||A.charCodeAt(++Z)===tr;);return(at=Z)>=B?le=!0:(Gt=A.charCodeAt(Z++))===qt?be=!0:Gt===Yt&&(be=!0,A.charCodeAt(Z)===qt&&++Z),A.slice(Lt+1,at-1).replace(/""/g,'"')}for(;Z<B;){if((Gt=A.charCodeAt(at=Z++))===qt)be=!0;else if(Gt===Yt)be=!0,A.charCodeAt(Z)===qt&&++Z;else if(Gt!==t)continue;return A.slice(Lt,at)}return le=!0,A.slice(Lt,B)}for(;(K=Be())!==Rt;){for(var et=[];K!==St&&K!==Rt;)et.push(K),K=Be();k&&(et=k(et,V++))==null||L.push(et)}return L}function o(A,k){return A.map(function(L){return k.map(function(B){return b(L[B])}).join(e)})}function u(A,k){return k==null&&(k=It(A)),[k.map(b).join(e)].concat(o(A,k)).join(`
`)}function h(A,k){return k==null&&(k=It(A)),o(A,k).join(`
`)}function v(A){return A.map(m).join(`
`)}function m(A){return A.map(b).join(e)}function b(A){return A==null?"":A instanceof Date?ie(A):a.test(A+="")?'"'+A.replace(/"/g,'""')+'"':A}return{parse:n,parseRows:r,format:u,formatBody:h,formatRows:v,formatRow:m,formatValue:b}}var Ot=_r(","),yt=Ot.parse,Qt=Ot.parseRows,Ue=Ot.format,Ar=Ot.formatBody,an=Ot.formatRows,fe=Ot.formatRow,rt=Ot.formatValue,X=de(85061),ae=de(28991),ze=de(38163),At=de.n(ze),Ft=63710088e-1,ur={centimeters:Ft*100,centimetres:Ft*100,degrees:Ft/111325,feet:Ft*3.28084,inches:Ft*39.37,kilometers:Ft/1e3,kilometres:Ft/1e3,meters:Ft,metres:Ft,miles:Ft/1609.344,millimeters:Ft*1e3,millimetres:Ft*1e3,nauticalmiles:Ft/1852,radians:1,yards:Ft*1.0936},Tt={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ft,yards:1.0936133},Br={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Bn(e,a,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=a||{},n.geometry=e,n}function Sn(e,a,t){switch(t===void 0&&(t={}),e){case"Point":return Li(a).geometry;case"LineString":return ra(a).geometry;case"Polygon":return on(a).geometry;case"MultiPoint":return $i(a).geometry;case"MultiLineString":return fi(a).geometry;case"MultiPolygon":return hi(a).geometry;default:throw new Error(e+" is invalid")}}function Li(e,a,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ar(e[0])||!ar(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Bn(n,a,t)}function gi(e,a,t){return t===void 0&&(t={}),ga(e.map(function(n){return Li(n,a)}),t)}function on(e,a,t){t===void 0&&(t={});for(var n=0,r=e;n<r.length;n++){var o=r[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var h={type:"Polygon",coordinates:e};return Bn(h,a,t)}function Xa(e,a,t){return t===void 0&&(t={}),ga(e.map(function(n){return on(n,a)}),t)}function ra(e,a,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Bn(n,a,t)}function Vi(e,a,t){return t===void 0&&(t={}),ga(e.map(function(n){return ra(n,a)}),t)}function ga(e,a){a===void 0&&(a={});var t={type:"FeatureCollection"};return a.id&&(t.id=a.id),a.bbox&&(t.bbox=a.bbox),t.features=e,t}function fi(e,a,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return Bn(n,a,t)}function $i(e,a,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return Bn(n,a,t)}function hi(e,a,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return Bn(n,a,t)}function yi(e,a,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return Bn(n,a,t)}function os(e,a){if(a===void 0&&(a=0),a&&!(a>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,a||0);return Math.round(e*t)/t}function mo(e,a){a===void 0&&(a="kilometers");var t=ur[a];if(!t)throw new Error(a+" units is invalid");return e*t}function Ya(e,a){a===void 0&&(a="kilometers");var t=ur[a];if(!t)throw new Error(a+" units is invalid");return e/t}function Pt(e,a){return ce(Ya(e,a))}function xe(e){var a=e%360;return a<0&&(a+=360),a}function ce(e){var a=e%(2*Math.PI);return a*180/Math.PI}function Te(e){var a=e%360;return a*Math.PI/180}function j(e,a,t){if(a===void 0&&(a="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return mo(Ya(e,a),t)}function st(e,a,t){if(a===void 0&&(a="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Br[a];if(!n)throw new Error("invalid original units");var r=Br[t];if(!r)throw new Error("invalid final units");return e/n*r}function ar(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Jr(e){return!!e&&e.constructor===Object}function tt(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(a){if(!ar(a))throw new Error("bbox must only contain numbers")})}function Ut(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function xr(e,a,t){if(e!==null)for(var n,r,o,u,h,v,m,b=0,A=0,k,L=e.type,B=L==="FeatureCollection",Z=L==="Feature",V=B?e.features.length:1,K=0;K<V;K++){m=B?e.features[K].geometry:Z?e.geometry:e,k=m?m.type==="GeometryCollection":!1,h=k?m.geometries.length:1;for(var le=0;le<h;le++){var be=0,Be=0;if(u=k?m.geometries[le]:m,u!==null){v=u.coordinates;var et=u.type;switch(b=t&&(et==="Polygon"||et==="MultiPolygon")?1:0,et){case null:break;case"Point":if(a(v,A,K,be,Be)===!1)return!1;A++,be++;break;case"LineString":case"MultiPoint":for(n=0;n<v.length;n++){if(a(v[n],A,K,be,Be)===!1)return!1;A++,et==="MultiPoint"&&be++}et==="LineString"&&be++;break;case"Polygon":case"MultiLineString":for(n=0;n<v.length;n++){for(r=0;r<v[n].length-b;r++){if(a(v[n][r],A,K,be,Be)===!1)return!1;A++}et==="MultiLineString"&&be++,et==="Polygon"&&Be++}et==="Polygon"&&be++;break;case"MultiPolygon":for(n=0;n<v.length;n++){for(Be=0,r=0;r<v[n].length;r++){for(o=0;o<v[n][r].length-b;o++){if(a(v[n][r][o],A,K,be,Be)===!1)return!1;A++}Be++}be++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(xr(u.geometries[n],a,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Cr(e,a,t,n){var r=t;return xr(e,function(o,u,h,v,m){u===0&&t===void 0?r=o:r=a(r,o,u,h,v,m)},n),r}function Lr(e,a){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&a(e.features[t].properties,t)!==!1;t++);break;case"Feature":a(e.properties,0);break}}function vn(e,a,t){var n=t;return Lr(e,function(r,o){o===0&&t===void 0?n=r:n=a(n,r,o)}),n}function vi(e,a){if(e.type==="Feature")a(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&a(e.features[t],t)!==!1;t++);}function ni(e,a,t){var n=t;return vi(e,function(r,o){o===0&&t===void 0?n=r:n=a(n,r,o)}),n}function An(e){var a=[];return xr(e,function(t){a.push(t)}),a}function Oi(e,a){var t,n,r,o,u,h,v,m,b,A,k=0,L=e.type==="FeatureCollection",B=e.type==="Feature",Z=L?e.features.length:1;for(t=0;t<Z;t++){for(h=L?e.features[t].geometry:B?e.geometry:e,m=L?e.features[t].properties:B?e.properties:{},b=L?e.features[t].bbox:B?e.bbox:void 0,A=L?e.features[t].id:B?e.id:void 0,v=h?h.type==="GeometryCollection":!1,u=v?h.geometries.length:1,r=0;r<u;r++){if(o=v?h.geometries[r]:h,o===null){if(a(null,k,m,b,A)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(a(o,k,m,b,A)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(a(o.geometries[n],k,m,b,A)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function zi(e,a,t){var n=t;return Oi(e,function(r,o,u,h,v){o===0&&t===void 0?n=r:n=a(n,r,o,u,h,v)}),n}function Pa(e,a){Oi(e,function(t,n,r,o,u){var h=t===null?null:t.type;switch(h){case null:case"Point":case"LineString":case"Polygon":return a(Bn(t,r,{bbox:o,id:u}),n,0)===!1?!1:void 0}var v;switch(h){case"MultiPoint":v="Point";break;case"MultiLineString":v="LineString";break;case"MultiPolygon":v="Polygon";break}for(var m=0;m<t.coordinates.length;m++){var b=t.coordinates[m],A={type:v,coordinates:b};if(a(Bn(A,r),n,m)===!1)return!1}})}function ia(e,a,t){var n=t;return Pa(e,function(r,o,u){o===0&&u===0&&t===void 0?n=r:n=a(n,r,o,u)}),n}function ao(e,a){Pa(e,function(t,n,r){var o=0;if(!!t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var h,v=0,m=0,b=0;if(xr(t,function(A,k,L,B,Z){if(h===void 0||n>v||B>m||Z>b){h=A,v=n,m=B,b=Z,o=0;return}var V=lineString([h,A],t.properties);if(a(V,n,r,Z,o)===!1)return!1;o++,h=A})===!1)return!1}}})}function Ci(e,a,t){var n=t,r=!1;return ao(e,function(o,u,h,v,m){r===!1&&t===void 0?n=o:n=a(n,o,u,h,v,m),r=!0}),n}function da(e,a){if(!e)throw new Error("geojson is required");Pa(e,function(t,n,r){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(a(t,n,r,0,0)===!1)return!1;break;case"Polygon":for(var h=0;h<u.length;h++)if(a(lineString(u[h],t.properties),n,r,h)===!1)return!1;break}}})}function J(e,a,t){var n=t;return da(e,function(r,o,u,h){o===0&&t===void 0?n=r:n=a(n,r,o,u,h)}),n}function se(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,n=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.segmentIndex||0,u=a.properties,h;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,h=e.features[t].geometry;break;case"Feature":u=u||e.properties,h=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":h=e;break;default:throw new Error("geojson is invalid")}if(h===null)return null;var v=h.coordinates;switch(h.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=v.length+o-1),lineString([v[o],v[o+1]],u,a);case"Polygon":return r<0&&(r=v.length+r),o<0&&(o=v[r].length+o-1),lineString([v[r][o],v[r][o+1]],u,a);case"MultiLineString":return n<0&&(n=v.length+n),o<0&&(o=v[n].length+o-1),lineString([v[n][o],v[n][o+1]],u,a);case"MultiPolygon":return n<0&&(n=v.length+n),r<0&&(r=v[n].length+r),o<0&&(o=v[n][r].length-o-1),lineString([v[n][r][o],v[n][r][o+1]],u,a)}throw new Error("geojson is invalid")}function _e(e,a){if(a=a||{},!isObject(a))throw new Error("options is invalid");var t=a.featureIndex||0,n=a.multiFeatureIndex||0,r=a.geometryIndex||0,o=a.coordIndex||0,u=a.properties,h;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),u=u||e.features[t].properties,h=e.features[t].geometry;break;case"Feature":u=u||e.properties,h=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":h=e;break;default:throw new Error("geojson is invalid")}if(h===null)return null;var v=h.coordinates;switch(h.type){case"Point":return point(v,u,a);case"MultiPoint":return n<0&&(n=v.length+n),point(v[n],u,a);case"LineString":return o<0&&(o=v.length+o),point(v[o],u,a);case"Polygon":return r<0&&(r=v.length+r),o<0&&(o=v[r].length+o),point(v[r][o],u,a);case"MultiLineString":return n<0&&(n=v.length+n),o<0&&(o=v[n].length+o),point(v[n][o],u,a);case"MultiPolygon":return n<0&&(n=v.length+n),r<0&&(r=v[n].length+r),o<0&&(o=v[n][r].length-o),point(v[n][r][o],u,a)}throw new Error("geojson is invalid")}function ke(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ye(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ut(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return ut(e[0]);throw new Error("coordinates must only contain numbers")}function xt(e,a,t){if(!a||!t)throw new Error("type and name required");if(!e||e.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.type)}function Ie(e,a,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+e.geometry.type)}function nt(e,a,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,r=e.features;n<r.length;n++){var o=r[n];if(!o||o.type!=="Feature"||!o.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!o.geometry||o.geometry.type!==a)throw new Error("Invalid input to "+t+": must be a "+a+", given "+o.geometry.type)}}function Ht(e){return e.type==="Feature"?e.geometry:e}function jr(e,a){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function ir(e,a){var t=a.x,n=a.y,r=a.x1,o=a.y1,u=a.coordinates,h=a.geometry,v=[];if(!Array.isArray(e))return{dataArray:[]};for(var m=function(L){var B=e[L];if(h){var Z=(0,ae.Z)({},B[h]),V=At()(Z,!0);return Pa(V,function(Gt){var sr=Ye(Gt),Tr=(0,ae.Z)((0,ae.Z)({},B),{},{_id:L,coordinates:sr});v.push(Tr)}),"continue"}var K=[];if(u){var le="Polygon";Array.isArray(u[0])||(le="Point"),Array.isArray(u[0])&&!Array.isArray(u[0][0])&&(le="LineString");var be={type:le,coordinates:(0,X.Z)(B[u])},Be=At()(be,!0);K=Be.coordinates}else if(t&&n&&r&&o){var et=[parseFloat(B[t]),parseFloat(B[n])],at=[parseFloat(B[r]),parseFloat(B[o])];K=[et,at]}else t&&n&&(K=[parseFloat(B[t]),parseFloat(B[n])]);var Lt=(0,ae.Z)((0,ae.Z)({},B),{},{_id:L,coordinates:K});v.push(Lt)},b=0;b<e.length;b++)var A=m(b);return{dataArray:v}}function pr(e,a){var t=yt(e);return ir(t,a)}function Hr(e){for(var a=e.toString(),t=5381,n=a.length;n;)t=t*33^a.charCodeAt(--n);return t>>>0}function oi(e,a){return a===void 0?null:a==="id"&&e.id?e.id:e[a]?e[a]:e.properties&&e.properties[a]?Hr(e.properties[a]+"")%1000019:null}function wn(e,a){var t=[],n={};return e.features?(e.features=e.features.filter(function(r){var o=r.geometry;return r!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),At()(e,!0),e.features.length===0?{dataArray:[],featureKeys:n}:(Pa(e,function(r,o){var u=oi(r,a==null?void 0:a.featureId);u===null&&(u=o);var h=u,v=Ye(r),m=(0,ae.Z)((0,ae.Z)({},r.properties),{},{coordinates:v,_id:h});t.push(m)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function rr(e){var a=131,t=137,n=0;e+="x";for(var r=Math.floor(9007199254740991/t),o=0;o<e.length;o++)n>r&&(n=Math.floor(n/t)),n=n*a+e.charCodeAt(o);return n}function Wn(e){e=e.toString();for(var a=5381,t=e.length;t;)a=a*33^e.charCodeAt(--t);return a>>>0}var Mr=de(28481),mn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ea(e){this.message=e}ea.prototype=new Error,ea.prototype.name="InvalidCharacterError";function Zn(e){var a=String(e).replace(/=+$/,"");if(a.length%4==1)throw new ea("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",n=0,r,o,u=0;o=a.charAt(u++);~o&&(r=n%4?r*64+o:o,n++%4)?t+=String.fromCharCode(255&r>>(-2*n&6)):0)o=mn.indexOf(o);return t}function na(e){e=String(e);for(var a,t,n,r,o="",u=0,h=e.length%3;u<e.length;){if((t=e.charCodeAt(u++))>255||(n=e.charCodeAt(u++))>255||(r=e.charCodeAt(u++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");a=t<<16|n<<8|r,o+=mn.charAt(a>>18&63)+mn.charAt(a>>12&63)+mn.charAt(a>>6&63)+mn.charAt(a&63)}return h?o.slice(0,h-3)+"===".substring(h):o}var Zt=de(6610),kt=de(5991),va=function(){function e(a,t){(0,Zt.Z)(this,e),this.buffers=a,this.type=t}return(0,kt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,n,r){throw new Error("not implemented")}}]),e}(),aa,Fi=function(){return aa||(aa=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof de.g!="undefined"?de.g:{})};aa=Fi();var Mi;typeof window=="undefined"?Mi={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(a){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(a){return!0},Event:function(a,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Mi=window;var go=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ba=go?my.getSystemInfoSync().pixelRatio:Mi.devicePixelRatio,Pr=de(10379),Or=de(46070),Et=de(77608),ss=(0,kt.Z)(function e(a,t){(0,Zt.Z)(this,e),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=a,this.timeStamp=Date.now()}),bt=de(63349);function oo(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=yu(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function yu(e,a){if(!!e){if(typeof e=="string")return Qo(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qo(e,a)}}function Qo(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Bi=new WeakMap,ml=function(){function e(){(0,Zt.Z)(this,e),Bi.set(this,{})}return(0,kt.Z)(e,[{key:"addEventListener",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Bi.get(this);o||(o={}),o[t]||(o[t]=[]),o[t].push(n),Bi.set(this,o),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=Bi.get(this);if(o){var u=o[t];if(u&&u.length>0){for(var h=u.length;h--;h>0)if(u[h]===n){u.splice(h,1);break}}}}},{key:"dispatchEvent",value:function(t){var n=Bi.get(this)[t.type];if(n){var r=oo(n),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u(t)}}catch(h){r.e(h)}finally{r.f()}}}}]),e}();function Ra(e){var a=Lo();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Lo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Do=function(e){(0,Pr.Z)(t,e);var a=Ra(t);function t(){var n;return(0,Zt.Z)(this,t),n=a.call(this),n.childNodes=[],n}return(0,kt.Z)(t,[{key:"appendChild",value:function(r){this.childNodes.push(r)}},{key:"cloneNode",value:function(){var r=Object.create(this);return Object.assign(r,this),r}},{key:"removeChild",value:function(r){var o=this.childNodes.findIndex(function(u){return u===r});return o>-1?this.childNodes.splice(o,1):null}}]),t}(ml);function ba(e){var a=Ps();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Ps(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ls=function(e){(0,Pr.Z)(t,e);var a=ba(t);function t(){var n;return(0,Zt.Z)(this,t),n=a.call(this),n.className="",n.children=[],n}return(0,kt.Z)(t,[{key:"setAttribute",value:function(r,o){this[r]=o}},{key:"getAttribute",value:function(r){return this[r]}},{key:"setAttributeNS",value:function(r,o){this[r]=o}},{key:"getAttributeNS",value:function(r){return this[r]}}]),t}(Do),Ql=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,fo,ds,Va,Bo;if(Ql){var vs=my.getSystemInfoSync();fo=vs.screenWidth,ds=vs.screenHeight,Va=vs.windowWidth,Bo=vs.windowHeight}else{var No=Mi.innerWidth,Qu=Mi.innerHeight;fo=No,ds=Qu,Va=No,Bo=Qu}var Zu={width:fo,height:ds,availWidth:Va,availHeight:Bo,availLeft:0,availTop:0},Vo=Zu.availWidth,me=Zu.availHeight,De={style:[]};function _t(e,a){if(!("parentNode"in e)){var t;a===0?t=function(){return null}:a===1?t=function(){return De}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var n;a===0?n=function(){return null}:a===1?n=function(){return De}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function lr(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Vo+"px",height:me+"px",margin:"0px",padding:"0px"})}function xn(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Vo,e.clientHeight=me),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var a={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return a})}function ti(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Vo,e.offsetHeight=me)}function ya(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Vo,e.scrollHeight=me)}function jo(e){var a=function(){return!0};e.classList=[],e.classList.add=a,e.classList.remove=a,e.classList.contains=a,e.classList.toggle=a}function Oa(e){var a=zo();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function zo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function So(){}var so=function(e){(0,Pr.Z)(t,e);var a=Oa(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return(0,Zt.Z)(this,t),n=a.call(this),n.className="",n.children=[],n.focus=So,n.blur=So,n.insertBefore=So,n.appendChild=So,n.removeChild=So,n.remove=So,n.innerHTML="",n.tagName=r.toUpperCase(),_t((0,bt.Z)(n),o),lr((0,bt.Z)(n)),jo((0,bt.Z)(n)),xn((0,bt.Z)(n)),ti((0,bt.Z)(n)),ya((0,bt.Z)(n)),n}return(0,kt.Z)(t)}(Ls);function Rs(e){var a=eu();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function eu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var su=function(e){(0,Pr.Z)(t,e);var a=Rs(t);function t(n){return(0,Zt.Z)(this,t),a.call(this,n)}return(0,kt.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(so);function _u(e){var a=Vu();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Vu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xu=function(e){(0,Pr.Z)(t,e);var a=_u(t);function t(){return(0,Zt.Z)(this,t),a.call(this,"video")}return(0,kt.Z)(t)}(su),Ro={},ha={};function As(e,a){Ro=e,Ro.id=a,"tagName"in Ro||(Ro.tagName="CANVAS"),Ro.type="canvas",Mixin.parentNode(Ro),Mixin.style(Ro),Mixin.classList(Ro),Mixin.clientRegion(Ro),Mixin.offsetRegion(Ro),Ro.focus=function(){},Ro.blur=function(){}}function Sh(e,a){var t=1024,n=1024;ha={width:t,height:n,clientWidth:t/devicePixelRatio,clientHeight:n/devicePixelRatio,id:a,type:"canvas"},"tagName"in ha||(ha.tagName="CANVAS"),Mixin.parentNode(ha),Mixin.style(ha),Mixin.classList(ha),Mixin.clientRegion(ha),Mixin.offsetRegion(ha),ha.getContext=function(r){if(r==="2d")return e},ha.focus=function(){},ha.blur=function(){}}function Ju(){return Ro}function pf(){return ha}var Wf=(0,kt.Z)(function e(){(0,Zt.Z)(this,e);var a=Ju(),t=a.createImage&&a.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),_t(t),jo(t),Object.assign(t,{addEventListener:function(r,o){t["on".concat(r)]=o.bind(t)},removeEventListener:function(r){t["on".concat(r)]=null}}),t}),gl={href:"",protocol:"",host:""};function Ac(e){var a=yl();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function yl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var df=function(e){(0,Pr.Z)(t,e);var a=Ac(t);function t(){return(0,Zt.Z)(this,t),a.call(this,"body",0)}return(0,kt.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o,u){}},{key:"dispatchEvent",value:function(r){}}]),t}(so),E=function(e){(0,Pr.Z)(t,e);var a=Ac(t);function t(){return(0,Zt.Z)(this,t),a.call(this,"html",0)}return(0,kt.Z)(t,[{key:"addEventListener",value:function(r,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(r,o){}},{key:"dispatchEvent",value:function(r){}}]),t}(so),P={},G={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:gl,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(a){return a=a.toLowerCase(),a==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):a==="img"?new Wf:a==="video"?new xu:new so(a)},createElementNS:function(a,t){return this.createElement(t)},createTextNode:function(a){return a},getElementById:function(a){return null},getElementsByTagName:function(a){return a=a.toLowerCase(),[]},getElementsByTagNameNS:function(a,t){return this.getElementsByTagName(t)},getElementsByName:function(a){return[]},querySelector:function(a){return null},querySelectorAll:function(a){return[]},addEventListener:function(a,t,n){P[a]||(P[a]=[]),P[a].push(t)},removeEventListener:function(a,t){var n=P[a];if(n&&n.length>0){for(var r=n.length;r--;r>0)if(n[r]===t){n.splice(r,1);break}}},dispatchEvent:function(a){var t=a.type,n=P[t];if(n)for(var r=0;r<n.length;r++)n[r](a);a.target&&typeof a.target["on"+t]=="function"&&a.target["on"+t](a)},createEvent:function(a){return new ss(a)}};G.documentElement=new E,G.head=new so("head"),G.body=new df;var D=Object,oe=de(90484),Fe=function(){function e(){(0,Zt.Z)(this,e);var a=arguments.length;if(a===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else a===3&&(0,oe.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,kt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),vt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Mt,Dt,Nr;if(vt){var Xr=my.getSystemInfoSync();Mt=Xr.system,Dt=Xr.platform,Nr=Xr.language}else{var Qn={versions:function(){var e=Mi.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Mi.navigator.browserLanguage||Mi.navigator.language).toLowerCase()};Qn.versions.android?Dt="android":Qn.versions.trident?Dt="IE":Qn.versions.presto?Dt="Opera":Qn.versions.webKit?Dt="webKit":Qn.versions.gecko?Dt="Firefox":Qn.versions.mobile?Dt="mobile":Qn.versions.ios?Dt="ios":Qn.versions.iPhone?Dt="iPhone":Qn.versions.iPad?Dt="ipad":Qn.versions.webApp?Dt="webApp":Qn.versions.weixin?Dt="weixin":Qn.versions.qq&&(Dt="qq"),Mt=Mi.navigator.userAgent,Nr=Qn.language}var Ki=Mt.toLowerCase().indexOf("android")!==-1,ji=Ki?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",pa="Mozilla/5.0 (".concat(ji,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Nr),Ka={platform:Dt,language:Nr,appVersion:"5.0 (".concat(ji,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:pa},yo={mark:function(a){return null},clearMeasures:function(a){return null},clearMarks:function(a){return null},measure:function(a,t,n){return{duration:0}},now:function(){}},wa=0,Xs=0;function Bl(e){var a=Date.now(),t=Math.max(wa+23,a);return Xs=setTimeout(function(){e(wa=t)},t-a),Xs}function Yc(e){var a=Ju();return a.requestAnimationFrame?a.requestAnimationFrame(e):Bl(e)}function qc(e){var a=Ju();return a.cancelAnimationFrame?a.cancelAnimationFrame(e):clearTimeout(e)}var wc=function(){function e(a){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,Zt.Z)(this,e),a.indexOf("http://")==0||a.indexOf("https://")==0){this.href=a;return}this.href=t+a}return(0,kt.Z)(e,null,[{key:"createObjectURL",value:function(t){var n=t.buffers[0],r=t.type,o=Tc(n),u="data:".concat(r,";base64, ");return u+o}}]),e}();function Tc(e){for(var a="",t=new Uint8Array(e),n=t.byteLength,r=0;r<n;r++)a+=String.fromCharCode(t[r]);return na(a)}var Mu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},Nl={};function _l(e){var a=Go();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Go(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ah=new Map,wh=new Map,bu=new Map,Yh={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function zl(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,a)}function el(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,zl.call(this,"readystatechange",a)}var Ul=function(e){(0,Pr.Z)(t,e);var a=_l(t);function t(){var n;return(0,Zt.Z)(this,t),n=a.call(this),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Ah.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,kt.Z)(t,[{key:"responseType",set:function(r){this._responseType=r}},{key:"abort",value:function(){var r=bu.get("requestTask");r&&r.abort()}},{key:"getAllResponseHeaders",value:function(){var r=wh.get("responseHeader");return Object.keys(r).map(function(o){return"".concat(o,": ").concat(r[o])}).join(`
`)}},{key:"getResponseHeader",value:function(r){return wh.get("responseHeader")[r]}},{key:"open",value:function(r,o,u){this._method=r,this._url=o}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(r,o){var u=Ah.get("requestHeader");u[r]=o,Ah.set("requestHeader",u)}},{key:"addEventListener",value:function(r,o){var u=this;typeof o=="function"&&(this["on"+r]=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};h.target=h.target||u,o.call(u,h)})}},{key:"removeEventListener",value:function(r,o){this["on"+r]===o&&(this["on"+r]=null)}}]),t}(ml);Ul.UNSEND=0,Ul.OPENED=1,Ul.HEADERS_RECEIVED=2,Ul.LOADING=3,Ul.DONE=4;function xl(e){var a=lo();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function lo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tl=function(e){(0,Pr.Z)(t,e);var a=xl(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=Ju(),r.currentTarget=Ju(),r}return(0,kt.Z)(t)}(ss);function Xf(e){var a=e||{},t=a.x,n=t===void 0?0:t,r=a.y,o=r===void 0?0:r,u=a.clientX,h=u===void 0?0:u,v=a.clientY,m=v===void 0?0:v;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=o):(e.x=h,e.y=m)}function ju(e){return function(a){var t=new tl(e);t.changedTouches=a.changedTouches,t.touches=a.touches,t.targetTouches=Array.prototype.slice.call(a.touches),t.timeStamp=a.timeStamp,t.changedTouches.forEach(function(n){return Xf(n)}),t.touches.forEach(function(n){return Xf(n)}),t.targetTouches.forEach(function(n){return Xf(n)}),G.dispatchEvent(t)}}function xp(e){return function(a){a.type=e,G.dispatchEvent(a)}}var e0=ju("touchstart"),$p=ju("touchmove"),Th=ju("touchend"),vf=xp("mapCameaParams");function mf(e){var a=Mc();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Mc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gf=function(e){(0,Pr.Z)(t,e);var a=mf(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.target=Ju(),r.currentTarget=Ju(),r}return(0,kt.Z)(t)}(ss),Jl=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],yf=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],ec="touch";function uu(e,a,t){for(var n=new gf(e),r=0;r<Jl.length;r++){var o=Jl[r];n[o]=a[o]||yf[r]}return n.type=e,n.target=Ju(),n.currentTarget=Ju(),n.buttons=Yf(e),n.which=n.buttons,n.pointerId=(a.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(a.radiusX||.5)*2,n.height=(a.radiusY||.5)*2,n.pressure=a.force||.5,n.isPrimary=qh(a),n.pointerType=ec,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey,t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n}function Yf(e){var a=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(a=1),a}var tc=null;function qh(e){return tc===e.identifier}function Ic(e){tc===null&&(tc=e.identifier)}function rc(e){tc===e.identifier&&(tc=null)}function rl(e){return function(a){for(var t=a.changedTouches,n=0;n<t.length;n++){var r=t[n];n===0&&e==="pointerdown"?Ic(r):(e==="pointerup"||e==="pointercancel")&&rc(r);var o=uu(e,r,a);G.dispatchEvent(o)}}}var _f=rl("pointerdown"),kc=rl("pointermove"),bp=rl("pointerup");function xf(e){var a=nc();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function nc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $h=function(e){(0,Pr.Z)(t,e);var a=xf(t);function t(n){return(0,Zt.Z)(this,t),a.call(this,n)}return(0,kt.Z)(t)}(ss);function bf(e){return function(a){a.type=e,G.dispatchEvent(a)}}var Ef=bf("mousedown"),Kp=bf("mousemove"),Qp=bf("mouseup"),Mh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,$c=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Eu=Mh||$c,Kc={atob:Zn,btoa:na,devicePixelRatio:Ba,Blob:va,document:G,Element:Ls,Event:ss,EventTarget:ml,HTMLCanvasElement:D,HTMLElement:so,HTMLMediaElement:su,HTMLVideoElement:xu,Image:Wf,ImageData:Fe,navigator:Ka,Node:Do,requestAnimationFrame:Yc,cancelAnimationFrame:qc,screen:Zu,XMLHttpRequest:Ul,performance:yo,URL:wc,WebGLRenderingContext:Mu,WebGL2RenderingContext:Nl,addEventListener:function(a,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};G.addEventListener(a,t,n)},removeEventListener:function(a,t,n){G.removeEventListener(a,t)},dispatchEvent:function(a){G.dispatchEvent(a)},innerWidth:Zu.availWidth,innerHeight:Zu.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Ui=Eu?Kc:Mi,Cf=Eu?Ul:Mi.XMLHttpRequest,Sf=Eu?gl:Mi.location;function bl(e){var a=e;return typeof e=="string"&&(a=Ui.document.getElementById(e)),a}function Sa(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function _o(e){return Sa(e).split(/\s+/)}function lu(e){var a,t,n=Ui==null||(a=Ui.document)===null||a===void 0||(t=a.documentElement)===null||t===void 0?void 0:t.style;if(!n)return e[0];for(var r in e)if(e[r]&&e[r]in n)return e[r];return e[0]}function Mo(e,a,t){var n=Ui.document.createElement(e);return n.className=a||"",t&&t.appendChild(n),n}function Iu(e){var a=e.parentNode;a&&a.removeChild(e)}function Zl(e,a){if(e.classList!==void 0)for(var t=_o(a),n=0,r=t.length;n<r;n++)e.classList.add(t[n]);else if(!Jp(e,a)){var o=Af(e);qf(e,(o?o+" ":"")+a)}}function cu(e,a){e.classList!==void 0?e.classList.remove(a):qf(e,Sa((" "+Af(e)+" ").replace(" "+a+" "," ")))}function Jp(e,a){if(e.classList!==void 0)return e.classList.contains(a);var t=Af(e);return t.length>0&&new RegExp("(^|\\s)"+a+"(\\s|$)").test(t)}function qf(e,a){e instanceof HTMLElement?e.className=a:e.className.baseVal=a}function Af(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Vl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var ms=lu(["transform","WebkitTransform"]);function nl(e,a){e.style[ms]=a}function $f(){if(typeof Event=="function")Ui.dispatchEvent(new Event("resize"));else{var e=Ui.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Ui,0),Ui.dispatchEvent(e)}}function Ho(e){var a=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,a.join(""))}function ri(){var e,a=Ui.document.querySelector('meta[name="viewport"]');if(!a)return 1;var t=(e=a.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(r){var o=r.split("="),u=(0,Mr.Z)(o,2),h=u[0],v=u[1];return h==="initial-scale"});return n?n.split("=")[1]*1:1}var ma=ri()<1?1:Ui.devicePixelRatio;function Pc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a*1}function wf(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a*1}function ku(e){if(e.length===0)return 0;for(var a=e[0]*1,t=1;t<e.length;t++)a+=e[t]*1;return a}function Pu(e){if(e.length===0)throw new Error("mean requires at least one data point");return ku(e)/e.length}function Lc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var a=e[0],t=NaN,n=0,r=1,o=1;o<e.length+1;o++)e[o]!==a?(r>n&&(n=r,t=a),r=1,a=e[o]):r++;return t*1}var Tn={min:wf,max:Pc,mean:Pu,sum:ku,mode:Lc};function Rc(e,a){return e.map(function(t){return t[a]})}function Ih(e,a){return Tn[e](a)}var _a=de(92137),ho=de(14665);function fu(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var kh=de(51814);function il(e,a,t){return(0,kh.Z)()?il=Reflect.construct.bind():il=function(r,o,u){var h=[null];h.push.apply(h,o);var v=Function.bind.apply(r,h),m=new v;return u&&(0,ho.Z)(m,u.prototype),m},il.apply(null,arguments)}function tu(e){var a=typeof Map=="function"?new Map:void 0;return tu=function(n){if(n===null||!fu(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(n))return a.get(n);a.set(n,r)}function r(){return il(n,arguments,(0,Et.Z)(this).constructor)}return r.prototype=Object.create(n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,ho.Z)(r,n)},tu(e)}var jl=de(87757),di=de.n(jl);function Kf(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Ep(){return typeof importScripts=="function"}var Cp=Ep()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function al(e){var a=Ys();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Ys(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var la=function(e){(0,Pr.Z)(t,e);var a=al(t);function t(n,r,o,u){var h;return(0,Zt.Z)(this,t),h=a.call(this,"AJAXError: ".concat(r," (").concat(n,"): ").concat(o)),h.status=n,h.statusText=r,h.url=o,h.body=u,h}return(0,kt.Z)(t)}(tu(Error));function El(e,a){var t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:getReferrer(),signal:e==null?void 0:e.signal});return e.type==="json"&&t.headers.set("Accept","application/json"),fetch(t).then(function(n){return n.ok?(e.type==="arrayBuffer"?n.arrayBuffer():e.type==="json"?n.json():n.text()).then(function(r){a(null,r,n.headers.get("Cache-Control"),n.headers.get("Expires"))}).catch(function(r){a(new Error(r.message))}):n.blob().then(function(r){return a(new la(n.status,n.statusText,e.url,r))})}).catch(function(n){a(new Error(n.message))})}function hu(e,a){var t=new Cf;t.open(e.method||"GET",e.url,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var n in e.headers)e.headers.hasOwnProperty(n)&&t.setRequestHeader(n,e.headers[n]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){a(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var r=t.response;if(e.type==="json")try{r=JSON.parse(t.response)}catch(u){return a(u)}a(null,r,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"))}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});a(new la(t.status,t.statusText,e.url,o))}},t.send(e.body),t}function ws(e,a){return hu(e,a)}var Tf=function(a,t){return ws(_objectSpread(_objectSpread({},a),{},{type:"json"}),t)},Gl=function(a,t){return ws((0,ae.Z)((0,ae.Z)({},a),{},{type:"arrayBuffer"}),t)},ol=function(a,t){return ws(_objectSpread(_objectSpread({},a),{},{method:"POST"}),t)};function pu(e){var a=$window.document.createElement("a");return a.href=e,a.protocol===$window.document.location.protocol&&a.host===$window.document.location.host}var sl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function _i(e,a){var t=new Ui.Image,n=Ui.URL||Ui.webkitURL;t.crossOrigin="anonymous",t.onload=function(){a(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=sl})},t.onerror=function(){return a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var r=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(r):sl}function pi(e,a){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){a(null,n)}).catch(function(n){a(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Mf=function(a,t){return Gl(a,function(n,r){if(n)t(n);else if(r){var o=typeof createImageBitmap=="function";o?pi(r,t):_i(r,t)}})},Os=function(){var e=(0,_a.Z)(di().mark(function a(t,n,r){var o,u,h,v,m,b;return di().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.prev=0,k.next=3,r(t);case 3:o=k.sent,u=o.rasterData,h=o.width,v=o.height,m=0,b=8e3,n(null,{data:u,width:h,height:v,min:m,max:b}),k.next=15;break;case 12:k.prev=12,k.t0=k.catch(0),n(null,new Error(""+k.t0));case 15:case"end":return k.stop()}},a,null,[[0,12]])}));return function(t,n,r){return e.apply(this,arguments)}}(),ul=function(a,t,n){return Gl(a,function(r,o){r?t(r):o&&Os(o,t,n)})};function Yo(e){return typeof e=="number"}var Lu=2*Math.PI*6378137/2;function Ph(e){var a=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;Qf(a,n)}),a}function Qf(e,a){return Array.isArray(a[0])?a.forEach(function(t){Qf(e,t)}):(e[0]>a[0]&&(e[0]=a[0]),e[1]>a[1]&&(e[1]=a[1]),e[2]<a[0]&&(e[2]=a[0]),e[3]<a[1]&&(e[3]=a[1])),e}function Qa(e,a){return po(e,a)}function po(e,a){return Array.isArray(e[0])?e.map(function(t){return po(t,a)}):a(e)}function Jf(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Fs(e,a);var n=e[0],r=e[1],o=n*Lu/180,u=Math.log(Math.tan((90+r)*Math.PI/360))/(Math.PI/180);return u=u*Lu/180,t.enable&&(o=Number(o.toFixed(t.decimal)),u=Number(u.toFixed(t.decimal))),e.length===3?[o,u,e[2]]:[o,u]}function eh(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],r=t/Lu*180,o=n/Lu*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),a!=null&&(r=Number(r.toFixed(a)),o=Number(o.toFixed(a))),e.length===3?[r,o,e[2]]:[r,o]}function Cl(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Sl(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Fs(e,a){if(a===!1)return e;var t=Cl(e[0]),n=Sl(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Ao(e){var a=85.0511287798,t=Math.max(Math.min(a,e[1]),-a),n=256<<20,r=Math.PI/180,o=e[0]*r,u=t*r;u=Math.log(Math.tan(Math.PI/4+u/2));var h=.5/Math.PI,v=.5,m=-.5/Math.PI;return r=.5,o=n*(h*o+v),u=n*(m*u+r),[Math.floor(o),Math.floor(u)]}function ic(e){var a=.5/Math.PI,t=.5,n=-.5/Math.PI,r=.5,o=256<<20,u=_slicedToArray(e,2),h=u[0],v=u[1];h=(h/o-t)/a,v=(v/o-r)/n,v=(Math.atan(Math.pow(Math.E,v))-Math.PI/4)*2,r=Math.PI/180;var m=v/r,b=h/r;return[b,m]}function Kh(e,a){var t=85.0511287798,n=Math.PI/180,r=6378137;return a=Math.max(Math.min(t,a),-t),e*=n,a*=n,a=Math.log(Math.tan(Math.PI/4+a/2)),[e*r,a*r]}function Qc(e,a){var t=Math.PI/180,n=6378137,r=e/n/t,o=2*(Math.atan(Math.exp(a/n))-Math.PI/4)/t;return[r,o]}function th(e,a,t){var n=Te(a[1]-e[1]),r=Te(a[0]-e[0]),o=Te(e[1]),u=Te(a[1]),h=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(r/2),2)*Math.cos(o)*Math.cos(u);return mo(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),t="meters")}function Qh(e){var a=Math.PI/180,t=85.0511287798,n=6378137,r=Math.max(Math.min(t,e[1]),-t),o=Math.sin(r*a),u=n*e[0]*a,h=n*Math.log((1+o)/(1-o))/2;return[u,h]}function ll(e,a){var t=Math.abs(e[1][1]-e[0][1])*a,n=Math.abs(e[1][0]-e[0][0])*a;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function ac(e,a){return e[0][0]<=a[0][0]&&e[0][1]<=a[0][1]&&e[1][0]>=a[1][0]&&e[1][1]>=a[1][1]}function Jc(e){return[[e[0],e[1]],[e[2],e[3]]]}function oc(e){var a=Hl(e,[0,0]);return[e[0]/a,e[1]/a]}function Hl(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function Lh(e,a){return e[0]*a[0]+e[1]*a[1]}function sc(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Al(e,a){return Math.acos(Lh(e,a)/(sc(e)*sc(a)))*180/Math.PI}function If(e,a){return a[0]>0?a[1]>0?90-Math.atan(a[1]/a[0])*180/Math.PI:90+Math.atan(-a[1]/a[0])*180/Math.PI:a[1]<0?180+(90-Math.atan(a[1]/a[0])*180/Math.PI):270+Math.atan(a[1]/-a[0])*180/Math.PI}function Rh(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,r=[],o=0;o<e.length-1;o++){var u=e[o],h=e[o+1],v=Hl(u,h);n+=v;var m=[u[0]-h[0],u[1]-h[1]],b=If(t,m);if(o>0){var A=r[o-1].rotation;A-b>360-A+b&&(b=b+360)}r.push({start:u,end:h,dis:v,rotation:b,duration:0})}return r.map(function(k){k.duration=a*(k.dis/n)}),r}}function Gu(e){if(Yo(e[0]))return e;if(Yo(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Yo(e[0][0][0])){var a=e,t=0,n=0,r=0;return a.forEach(function(o){o.forEach(function(u){t+=u[0],n+=u[1],r++})}),[t/r,n/r,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function ef(e){for(var a=e[0],t=e[1],n=e[0],r=e[1],o=0,u=0,h=0,v=0;v<e.length;v+=2){var m=e[v],b=e[v+1];m&&b&&(a=Math.max(m,a),t=Math.max(b,t),n=Math.min(m,n),r=Math.min(b,r),o+=m,u+=b,h++)}return{center:[o/h,u/h],radius:Math.sqrt(Math.pow(a-n,2)+Math.pow(t-r,2))/2}}var c=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,Zt.Z)(this,e),this.limit=a,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,kt.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(r){return r===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function p(e,a){e.forEach(function(t){!a[t]||(a[t]=a[t].bind(a))})}var f=null,g=de(2650);function S(e){return typeof e=="string"?!!g.ZP(e):!1}function I(e){var a=g.ZP(e),t=[0,0,0,0];return a!=null&&(t[0]=a.r/255,t[1]=a.g/255,t[2]=a.b/255,t[3]=a.opacity),t}function R(e){var a=e&&e[0],t=e&&e[1],n=e&&e[2],r=a+t*256+n*65536-1;return r}function z(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function q(e){var a=Ui.document.createElement("canvas"),t=a.getContext("2d");a.width=256,a.height=1;var n=null;if(e.weights){var r=0;e.weights.map(function(k,L){var B=e.colors[L]||"rgba(0, 0, 0, 0)",Z=r+k;t.fillStyle=B,t.fillRect(r*256,0,Z*256,1),r=Z})}else{for(var o=t.createLinearGradient(0,0,256,1),u=e.positions[0],h=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var m=(e.positions[v]-u)/(h-u);o.addColorStop(m,e.colors[v])}t.fillStyle=o,t.fillRect(0,0,256,1)}if(Eu)return n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),a=null,t=null,{data:n,width:256,height:1};n=t.getImageData(0,0,256,1).data;for(var b=t.createImageData(256,1),A=0;A<b.data.length;A+=4)b.data[A+0]=n[A+0],b.data[A+1]=n[A+1],b.data[A+2]=n[A+2],b.data[A+3]=n[A+3];return a=null,t=null,b}var ne;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(ne||(ne={}));var Se={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Me(e,a,t){var n=e.classList;for(var r in Se)Se.hasOwnProperty(r)&&n.remove("l7-".concat(t,"-anchor-").concat(r));n.add("l7-".concat(t,"-anchor-").concat(a))}function ye(e,a){return{enable:e,mask:255,func:{cmp:514,ref:a?1:0,mask:255}}}function Qe(e,a){if(!e)throw new Error(a||"web worker helper assertion failed.")}var qe={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},pt=qe.self||qe.window||{},Xe=qe.window||qe.self||{},dt=qe.self||qe.window||{},Ct=qe.document||{},Wt=typeof importScripts=="function",vr=typeof window!="undefined"&&typeof window.orientation!="undefined",er=function(){function e(a,t){var n=this;this.name=a,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(r,o){n.resolve=r,n.reject=o})}return e.prototype.postMessage=function(a,t){this.workerThread.postMessage({source:"Main thread",type:a,payload:t})},e.prototype.done=function(a){Qe(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(a)},e.prototype.error=function(a){Qe(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(a)},e}(),wr=er,Wr=new Map;function bn(e){Qe(e.source&&!e.url||!e.source&&e.url);var a=Wr.get(e.source||e.url);return a||(e.url&&(a=gn(e.url),Wr.set(e.url,a)),e.source&&(a=Gn(e.source),Wr.set(e.source,a))),Qe(a),a}function gn(e){if(!e.startsWith("http"))return e;var a=xi(e);return Gn(a)}function Gn(e){var a=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(a)}function xi(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Si(e,a,t){a===void 0&&(a=!0);var n=t||new Set;if(e){if(bi(e))n.add(e);else if(bi(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(a&&typeof e=="object")for(var r in e)Si(e[r],a,n)}}return t===void 0?Array.from(n):[]}function bi(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Ea=function(){},Xn=function(){function e(a){this.terminated=!1,this.loadableURL="";var t=a.name,n=a.source,r=a.url;Qe(n||r),this.name=t,this.source=n,this.url=r,this.onMessage=Ea,this.onError=function(o){return console.log(o)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Ea,this.onError=Ea,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(a,t){t=t||Si(a),this.worker.postMessage(a,t)},e.prototype.getErrorFromErrorEvent=function(a){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",a.message&&(t+=a.message+" in "),a.lineno&&(t+=":"+a.lineno+":"+a.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var a=this;this.loadableURL=bn({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?a.onMessage(n.data):a.onError(new Error("No data received"))},t.onerror=function(n){a.onError(a.getErrorFromErrorEvent(n)),a.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+a.name+", message error: "+n)},t},e}(),Hi=Xn,Qi=function(){return Qi=Object.assign||function(e){for(var a,t=1,n=arguments.length;t<n;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},Qi.apply(this,arguments)},Wi=function(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function v(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,v)}m((n=n.apply(e,a||[])).next())})},Ri=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return v([m,b])}}function v(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},oa=function(){function e(a){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=a.source,this.url=a.url,this.setProps(a)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(a){return a.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(a){this.props=Qi(Qi({},this.props),a),a.name!==void 0&&(this.name=a.name),a.maxConcurrency!==void 0&&(this.maxConcurrency=a.maxConcurrency),a.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=a.maxMobileConcurrency),a.reuseWorkers!==void 0&&(this.reuseWorkers=a.reuseWorkers),a.onDebug!==void 0&&(this.onDebug=a.onDebug)},e.prototype.startJob=function(a,t,n){return t===void 0&&(t=function(r,o,u){return r.done(u)}),n===void 0&&(n=function(r,o){return r.error(o)}),Wi(this,void 0,void 0,function(){var r,o=this;return Ri(this,function(u){switch(u.label){case 0:return r=new Promise(function(h){return o.jobQueue.push({name:a,onMessage:t,onError:n,onStart:h}),o}),this.startQueuedJob(),[4,r];case 1:return[2,u.sent()]}})})},e.prototype.startQueuedJob=function(){return Wi(this,void 0,void 0,function(){var a,t,n;return Ri(this,function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(a=this.getAvailableWorker(),!a)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:a}),n=new wr(t.name,a),a.onMessage=function(o){return t.onMessage(n,o.type,o.payload)},a.onError=function(o){return t.onError(n,o)},t.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(a),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(a){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(a.destroy(),this.count--):this.idleQueue.push(a),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var a=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Hi({name:a,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return vr?this.maxMobileConcurrency:this.maxConcurrency},e}(),Zi=oa,wi=function(){return wi=Object.assign||function(e){for(var a,t=1,n=arguments.length;t<n;t++){a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},wi.apply(this,arguments)},us=function(e){var a=typeof Symbol=="function"&&Symbol.iterator,t=a&&e[a],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")},Wo={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Ds=function(){function e(a){this.workerPools=new Map,this.props=wi({},Wo),this.setProps(a),this.workerPools=new Map}return e.isSupported=function(){return Hi.isSupported()},e.getWorkerFarm=function(a){return a===void 0&&(a={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(a),e.workerFarm},e.prototype.destroy=function(){var a,t;try{for(var n=us(this.workerPools.values()),r=n.next();!r.done;r=n.next()){var o=r.value;o.destroy()}}catch(u){a={error:u}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(a)throw a.error}}},e.prototype.setProps=function(a){var t,n;this.props=wi(wi({},this.props),a);try{for(var r=us(this.workerPools.values()),o=r.next();!o.done;o=r.next()){var u=o.value;u.setProps(this.getWorkerPoolProps())}}catch(h){t={error:h}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(a){var t=a.name,n=a.source,r=a.url,o=this.workerPools.get(t);return o||(o=new Zi({name:t,source:n,url:r}),o.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,o)),o},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),ls=Ds,co=new Map,Jo=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(a){self.onmessage=function(t){if(!!Bs(t)){var n=t.data,r=n.type,o=n.payload;a(r,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(a){var t=co.get(a);t||(t=function(n){if(!!Bs(n)){var r=n.data,o=r.type,u=r.payload;a(o,u)}}),self.addEventListener("message",t)},e.removeEventListener=function(a){var t=co.get(a);co.delete(a),self.removeEventListener("message",t)},e.postMessage=function(a,t){if(self){var n={source:"Worker thread",type:a,payload:t},r=Si(t);self.postMessage(n,r)}},e}(),es=Jo;function Bs(e){var a=e.type,t=e.data;return a==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function uc(e){return JSON.parse(ru(e))}function ru(e){var a=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(a.has(n))try{return JSON.parse(JSON.stringify(n))}catch(r){return}a.add(n)}return n})}function Hu(e){return""+e.name}function Cu(e,a){a===void 0&&(a={});var t=a[e.id]||{},n=e.name+".worker.js",r=t.workerUrl;return a._workerType==="test"&&(r=e.module+"/dist/"+n),r||(r="https://unpkg.com/"+e.module+"/dist/"+n),assert(r),r}var kf=function(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function v(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,v)}m((n=n.apply(e,a||[])).next())})},lc=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return v([m,b])}}function v(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}};function Wl(e,a){return WorkerFarm.isSupported()?e.worker&&(a==null?void 0:a.worker):!1}function wl(e,a,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),kf(this,void 0,void 0,function(){var r,o,u,h,v,m,b,A;return lc(this,function(k){switch(k.label){case 0:return r=getWorkerName(e),o=getWorkerURL(e,t),u=WorkerFarm.getWorkerFarm(t),h=u.getWorkerPool({name:r,url:o}),v=t.jobName||e.name,[4,h.startJob(v,Pf.bind(null,n))];case 1:return m=k.sent(),b=removeNontransferableOptions(t),m.postMessage("process",{input:a,options:b}),[4,m.result];case 2:return A=k.sent(),[2,A.result]}})})}function Pf(e,a,t,n){return kf(this,void 0,void 0,function(){var r,o,u,h,v,m,b;return lc(this,function(A){switch(A.label){case 0:switch(r=t,r){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return a.done(n),[3,9];case 2:return a.error(new Error(n.error)),[3,9];case 3:o=n.id,u=n.input,h=n.options,A.label=4;case 4:return A.trys.push([4,6,,7]),e.process?[4,e.process(u,h)]:(a.postMessage("error",{id:o,error:"Worker not set up to process on main thread"}),[2]);case 5:return v=A.sent(),a.postMessage("done",{id:o,result:v}),[3,7];case 6:return m=A.sent(),b=m instanceof Error?m.message:"unknown error",a.postMessage("error",{id:o,error:b}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),A.label=9;case 9:return[2]}})})}var cl=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(a){return this.enqueue(a)},e.prototype.enqueue=function(a){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();a instanceof Error?t.reject(a):t.resolve({value:a})}else this._values.push(a)},e.prototype.close=function(){for(;this._settlers.length>0;){var a=this._settlers.shift();a.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var a=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,r){a._settlers.push({resolve:n,reject:r})})},e}(),cc=cl,Xl=function(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function v(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,v)}m((n=n.apply(e,a||[])).next())})},cs=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return v([m,b])}}function v(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Tl=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=e[Symbol.asyncIterator],t;return a?a.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=e[o]&&function(u){return new Promise(function(h,v){u=e[o](u),r(h,v,u.done,u.value)})}}function r(o,u,h,v){Promise.resolve(v).then(function(m){o({value:m,done:h})},u)}},Oc=0,Ns,Na;function Ru(e,a){var t=this;if(typeof self!="undefined"){var n={process:qs};es.onmessage=function(r,o){return Xl(t,void 0,void 0,function(){var u,h,v,m,b,A,k,L,B,Z,V;return cs(this,function(K){switch(K.label){case 0:switch(K.trys.push([0,19,,20]),u=r,u){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(o.input,o.options||{},n)];case 2:return h=K.sent(),es.postMessage("done",{result:h}),[3,18];case 3:if(!a)throw new Error("Worker does not support batched processing");Ns=new cc,Na=o.options||{},v=a(Ns,Na,n),K.label=4;case 4:K.trys.push([4,9,10,15]),m=Tl(v),K.label=5;case 5:return[4,m.next()];case 6:if(b=K.sent(),!!b.done)return[3,8];A=b.value,es.postMessage("output-batch",{result:A}),K.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return k=K.sent(),Z={error:k},[3,15];case 10:return K.trys.push([10,,13,14]),b&&!b.done&&(V=m.return)?[4,V.call(m)]:[3,12];case 11:K.sent(),K.label=12;case 12:return[3,14];case 13:if(Z)throw Z.error;return[7];case 14:return[7];case 15:return es.postMessage("done",{}),[3,18];case 16:return Ns.push(o.input),[3,18];case 17:return Ns.close(),[3,18];case 18:return[3,20];case 19:return L=K.sent(),B=L instanceof Error?L.message:"",es.postMessage("error",{error:B}),[3,20];case 20:return[2]}})})}}}function qs(e,a){return a===void 0&&(a={}),new Promise(function(t,n){var r=Oc++,o=function(h,v){if(v.id===r)switch(h){case"done":es.removeEventListener(o),t(v.result);break;case"error":es.removeEventListener(o),n(v.error);break;default:}};es.addEventListener(o);var u={id:r,input:e,options:a};es.postMessage("process",u)})}var fc=function(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function v(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,v)}m((n=n.apply(e,a||[])).next())})},rh=function(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return v([m,b])}}function v(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}},Lf={};function Sp(e,a,t){return a===void 0&&(a=null),t===void 0&&(t={}),fc(this,void 0,void 0,function(){return rh(this,function(n){switch(n.label){case 0:return a&&(e=Wu(e,a,t)),Lf[e]=Lf[e]||Fc(e),[4,Lf[e]];case 1:return[2,n.sent()]}})})}function Wu(e,a,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+a+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+a+"/src/libs/"+e}function Fc(e){return fc(this,void 0,void 0,function(){var a,t,n;return rh(this,function(r){switch(r.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return a=r.sent(),[4,a.arrayBuffer()];case 2:return[2,r.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=r.sent(),[4,t.text()];case 5:return n=r.sent(),[2,Su(n,e)]}})})}function Su(e,a){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=a;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Rf="0.0.3",nh={id:"null",name:"null",module:"web-worker-helper",options:{}},Yl=de(75174),zs=de.n(Yl);function Of(e,a){var t=e.color;return!t||!t.length?[1,1,1,1]:t}function Ml(e,a,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function Oh(e,a){var t=e.filter;return t?[1]:[0]}function nu(e,a,t,n){return[a]}var ih=de(9187),Ou=de.n(ih),re=de(96156),un=de(31437),ah=un.create(),L0=un.create(),Io=un.create(),fl=un.create(),oh=un.create();function ed(e,a,t,n,r){un.add(e,t,n),un.normalize(e,e),a=un.fromValues(-e[1],e[0]);var o=un.fromValues(-t[1],t[0]);return[r/un.dot(a,o),a]}function Us(e,a){return un.set(e,-a[1],a[0])}function Au(e,a,t){return un.sub(e,a,t),un.normalize(e,e),e}function Md(e,a){return e[0]===a[0]&&e[1]===a[1]}function t0(e){for(var a=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();a.get(n)?(e.splice(t,1),t++):a.set(n,n)}return e}var Id=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Zt.Z)(this,e),(0,re.Z)(this,"lastFlip",-1),(0,re.Z)(this,"miter",un.fromValues(0,0)),(0,re.Z)(this,"started",!1),(0,re.Z)(this,"dash",!1),(0,re.Z)(this,"totalDistance",0),(0,re.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,kt.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,h=1;h<o;h++){var v,m,b,A=t[h-1];A.push((v=n[h-1][2])!==null&&v!==void 0?v:0);var k=n[h-1],L=t[h];L.push((m=n[h][2])!==null&&m!==void 0?m:0);var B=n[h],Z=h<t.length-1?[].concat((0,X.Z)(t[h+1]),[(b=n[h+1][2])!==null&&b!==void 0?b:0]):null,V=h<n.length-1?n[h+1]:null,K=this.segment_gaode2(r,u,A,L,Z,k,B,V);u+=K}if(this.dash)for(var le=0;le<r.positions.length/6;le++)r.positions[le*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,h=1;h<o;h++){var v,m,b,A=t[h-1];A.push((v=n[h-1][2])!==null&&v!==void 0?v:0);var k=n[h-1],L=t[h];L.push((m=n[h][2])!==null&&m!==void 0?m:0);var B=n[h],Z=h<t.length-1?[].concat((0,X.Z)(t[h+1]),[(b=n[h+1][2])!==null&&b!==void 0?b:0]):null,V=h<n.length-1?n[h+1]:null,K=this.simpleSegment(r,u,A,L,Z,k,B,V);u+=K}if(this.dash)for(var le=0;le<r.positions.length/6;le++)r.positions[le*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var h=t[u-1],v=t[u],m=u<t.length-1?t[u+1]:null,b=this.segment(n,o,h,v,m);o+=b}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var h=t[u-1],v=t[u],m=u<t.length-1?t[u+1]:null,b=this.simpleSegment(n,o,h,v,m);o+=b}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,r,o,u,h,v,m){var b=0,A=t.indices,k=t.positions,L=t.normals,B=this.cap==="square",Z=this.join==="bevel",V=Ao([v[0],v[1]]),K=Ao([h[0],h[1]]);Au(Io,o,r);var le=0;if(this.dash&&(le=this.lineSegmentDistance(V,K),this.totalDistance+=le),this.normal||(this.normal=un.create(),Us(this.normal,Io)),!this.started)if(this.started=!0,B){var be=un.create(),Be=un.create();un.add(be,this.normal,Io),un.add(Be,this.normal,Io),L.push(Be[0],Be[1],0),L.push(be[0],be[1],0),k.push(r[0],r[1],r[2]|0,this.totalDistance-le,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),k.push(r[0],r[1],r[2]|0,this.totalDistance-le,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(k,L,r,this.normal,this.thickness,this.totalDistance-le);if(A.push(n+0,n+1,n+2),u){Md(o,u)&&un.add(u,o,un.normalize(u,un.subtract(u,o,r))),Au(fl,u,o);var Lt=ed(oh,un.create(),Io,fl,this.thickness),Gt=(0,Mr.Z)(Lt,2),sr=Gt[0],Tr=Gt[1],Er=un.dot(oh,this.normal)<0?-1:1,Qr=Z;if(!Qr&&this.join==="miter"){var On=sr;On>this.miterLimit&&(Qr=!0)}Qr?(L.push(this.normal[0],this.normal[1],0),L.push(Tr[0],Tr[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Er,o[2]|0),this.complex.indexes.push(this.currentIndex),k.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Er,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push.apply(A,(0,X.Z)(this.lastFlip!==-Er?[n,n+2,n+3]:[n+2,n+1,n+3])),A.push(n+2,n+3,n+4),Us(ah,fl),un.copy(this.normal,ah),L.push(this.normal[0],this.normal[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Er,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b+=3):(this.extrusions(k,L,o,Tr,sr,this.totalDistance),A.push.apply(A,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Er=-1,un.copy(this.normal,Tr),b+=2),this.lastFlip=Er}else{if(Us(this.normal,Io),B){var et=un.create(),at=un.create();un.sub(at,Io,this.normal),un.add(et,Io,this.normal),L.push(at[0],at[1],0),L.push(et[0],et[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),k.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(k,L,o,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),b+=2}return b}},{key:"simpleSegment",value:function(t,n,r,o,u){var h=0,v=t.indices,m=t.positions,b=t.normals,A=Ao([o[0],o[1]]),k=Ao([r[0],r[1]]);Au(Io,A,k);var L=0;if(this.dash&&(L=this.lineSegmentDistance(A,k),this.totalDistance+=L),this.normal||(this.normal=un.create(),Us(this.normal,Io)),this.started||(this.started=!0,this.extrusions(m,b,r,this.normal,this.thickness,this.totalDistance-L)),v.push(n+0,n+1,n+2),!u)Us(this.normal,Io),this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance),v.push.apply(v,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),h+=2;else{var B=Ao([u[0],u[1]]);Md(A,B)&&un.add(B,A,un.normalize(B,un.subtract(B,A,k))),Au(fl,B,A);var Z=ed(oh,un.create(),Io,fl,this.thickness),V=(0,Mr.Z)(Z,2),K=V[0],le=V[1],be=un.dot(oh,this.normal)<0?-1:1;this.extrusions(m,b,o,le,K,this.totalDistance),v.push.apply(v,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),be=-1,un.copy(this.normal,le),h+=2,this.lastFlip=be}return h}},{key:"segment",value:function(t,n,r,o,u){var h=0,v=t.indices,m=t.positions,b=t.normals,A=this.cap==="square",k=this.join==="bevel",L=Ao([o[0],o[1]]),B=Ao([r[0],r[1]]);Au(Io,L,B);var Z=0;if(this.dash&&(Z=this.lineSegmentDistance(L,B),this.totalDistance+=Z),this.normal||(this.normal=un.create(),Us(this.normal,Io)),!this.started)if(this.started=!0,A){var V=un.create(),K=un.create();un.add(V,this.normal,Io),un.add(K,this.normal,Io),b.push(K[0],K[1],0),b.push(V[0],V[1],0),m.push(r[0],r[1],r[2]|0,this.totalDistance-Z,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),m.push(r[0],r[1],r[2]|0,this.totalDistance-Z,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,r,this.normal,this.thickness,this.totalDistance-Z);if(v.push(n+0,n+1,n+2),u){var Be=Ao([u[0],u[1]]);Md(L,Be)&&un.add(Be,L,un.normalize(Be,un.subtract(Be,L,B))),Au(fl,Be,L);var et=ed(oh,un.create(),Io,fl,this.thickness),at=(0,Mr.Z)(et,2),Lt=at[0],Gt=at[1],sr=un.dot(oh,this.normal)<0?-1:1,Tr=k;if(!Tr&&this.join==="miter"){var Er=Lt;Er>this.miterLimit&&(Tr=!0)}Tr?(b.push(this.normal[0],this.normal[1],0),b.push(Gt[0],Gt[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*sr,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*sr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v.push.apply(v,(0,X.Z)(this.lastFlip!==-sr?[n,n+2,n+3]:[n+2,n+1,n+3])),v.push(n+2,n+3,n+4),Us(ah,fl),un.copy(this.normal,ah),b.push(this.normal[0],this.normal[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*sr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,h+=3):(this.extrusions(m,b,o,Gt,Lt,this.totalDistance),v.push.apply(v,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),sr=-1,un.copy(this.normal,Gt),h+=2),this.lastFlip=sr}else{if(Us(this.normal,Io),A){var le=un.create(),be=un.create();un.sub(be,Io,this.normal),un.add(le,Io,this.normal),b.push(be[0],be[1],0),b.push(le[0],le[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance);v.push.apply(v,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),h+=2}return h}},{key:"extrusions",value:function(t,n,r,o,u,h){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,h,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,h,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var r=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}();function Fh(e){var a=e.coordinates,t=e.originCoordinates,n=e.version,r=new Id({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var h=0;h<o.length;h++){var v=o[h],m=u[h];r.extrude_gaode2(v,m)}}else{var b=a;b[0]&&!Array.isArray(b[0][0])&&(b=[a]),b.forEach(function(k){r.extrude(k)})}var A=r.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,indexes:A.indexes,size:6}}function hc(e){var a=Gu(e.coordinates);return{vertices:[].concat((0,X.Z)(a),(0,X.Z)(a),(0,X.Z)(a),(0,X.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function sh(e){var a=e.coordinates,t=Ou().flatten(a),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:Ou()(n,o,r),vertices:n,size:r}}var Ff=function(){var e=(0,_a.Z)(di().mark(function a(t){var n,r,o,u,h,v,m,b,A;return di().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u=t.iconMap,h={a_Color:Of,a_Position:Ml,filter:Oh,a_vertexId:nu,a_PickingColor:function(Z,V){var K=Z.id;return o?z(K):[0,0,0]},a_DistanceAndIndex:function(Z,V,K,le,be,Be){return Be===void 0?[K[3],10]:[K[3],Be]},a_Total_Distance:function(Z,V,K,le){return[K[5]]},a_Size:function(Z,V,K,le){var be=Z.size,Be=be===void 0?1:be;return Array.isArray(Be)?[Be[0],Be[1]]:[Be,0]},a_Normal:function(Z,V,K,le,be){return be},a_Miter:function(Z,V,K,le){return[K[4]]},a_iconMapUV:function(Z,V,K,le){var be=Z.texture,Be=u[be]||{x:0,y:0},et=Be.x,at=Be.y;return[et,at]}},v={sizePerElement:0,elements:[]},m=0,b=[],A=3,r.forEach(function(B,Z){var V=Fh(B),K=V.indices,le=V.vertices,be=V.normals,Be=V.size,et=V.indexes;K.forEach(function(sr){b.push(sr+m)}),A=Be;var at=le.length/Be;v.sizePerElement=A,v.elements.push({featureIdx:Z,vertices:le,normals:be,offset:m}),m+=at;for(var Lt=function(Tr){var Er=(be==null?void 0:be.slice(Tr*3,Tr*3+3))||[],Qr=le.slice(Tr*Be,Tr*Be+Be),On=0;et&&et[Tr]!==void 0&&(On=et[Tr]),n.forEach(function(li,Da){if(li&&h[li.name]){var Wa;(Wa=li.buffer.data).push.apply(Wa,(0,X.Z)(h[li.name](B,Z,Qr,Tr,Er,On)))}})},Gt=0;Gt<at;Gt++)Lt(Gt)}),L.abrupt("return",{descriptors:n,featureLayout:v,indices:b});case 8:case"end":return L.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),fs=function(){var e=(0,_a.Z)(di().mark(function a(t){var n,r,o,u,h,v,m,b,A;return di().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u=t.shape2d,h={a_Color:Of,a_Position:Ml,filter:Oh,a_vertexId:nu,a_PickingColor:function(Z,V){var K=Z.id;return o?z(K):[0,0,0]},a_Shape:function(Z,V,K,le){var be=Z.shape,Be=be===void 0?2:be,et=u.indexOf(Be);return[et]},a_Extrude:function(Z,V,K,le){var be=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Be=le%4*3;return[be[Be],be[Be+1],be[Be+2]]},a_Size:function(Z,V,K,le){var be=Z.size,Be=be===void 0?5:be;return Array.isArray(Be)?[Be[0]]:[Be]}},v={sizePerElement:0,elements:[]},m=0,b=[],A=3,r.forEach(function(B,Z){var V=hc(B),K=V.indices,le=V.vertices,be=V.normals,Be=V.size,et=V.indexes;K.forEach(function(sr){b.push(sr+m)}),A=Be;var at=le.length/Be;v.sizePerElement=A,v.elements.push({featureIdx:Z,vertices:le,normals:be,offset:m}),m+=at;for(var Lt=function(Tr){var Er=(be==null?void 0:be.slice(Tr*3,Tr*3+3))||[],Qr=le.slice(Tr*Be,Tr*Be+Be),On=0;et&&et[Tr]!==void 0&&(On=et[Tr]),n.forEach(function(li,Da){if(li&&h[li.name]){var Wa;(Wa=li.buffer.data).push.apply(Wa,(0,X.Z)(h[li.name](B,Z,Qr,Tr,Er,On)))}})},Gt=0;Gt<at;Gt++)Lt(Gt)}),L.abrupt("return",{descriptors:n,featureLayout:v,indices:b});case 8:case"end":return L.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),Ap=function(){var e=(0,_a.Z)(di().mark(function a(t){var n,r,o,u,h,v,m,b;return di().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return n=t.descriptors,r=t.features,o=t.enablePicking,u={a_Color:Of,a_Position:Ml,filter:Oh,a_vertexId:nu,a_PickingColor:function(B,Z){var V=B.id;return o?z(V):[0,0,0]}},h={sizePerElement:0,elements:[]},v=0,m=[],b=3,r.forEach(function(L,B){var Z=sh(L),V=Z.indices,K=Z.vertices,le=Z.normals,be=Z.size,Be=Z.indexes;V.forEach(function(Gt){m.push(Gt+v)}),b=be;var et=K.length/be;h.sizePerElement=b,h.elements.push({featureIdx:B,vertices:K,normals:le,offset:v}),v+=et;for(var at=function(sr){var Tr=(le==null?void 0:le.slice(sr*3,sr*3+3))||[],Er=K.slice(sr*be,sr*be+be),Qr=0;Be&&Be[sr]!==void 0&&(Qr=Be[sr]),n.forEach(function(On,li){if(On&&u[On.name]){var Da;(Da=On.buffer.data).push.apply(Da,(0,X.Z)(u[On.name](L,B,Er,sr,Tr,Qr)))}})},Lt=0;Lt<et;Lt++)at(Lt)}),k.abrupt("return",{descriptors:n,featureLayout:h,indices:m});case 8:case"end":return k.stop()}},a)}));return function(t){return e.apply(this,arguments)}}(),td={pointFill:fs,line:Ff,polygonFill:Ap},Xi=(0,ae.Z)({},td);function rd(e){return Dh.apply(this,arguments)}function Dh(){return Dh=(0,_a.Z)(di().mark(function e(a){var t,n;return di().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(t=a.workerType,n=a.data,!Xi[t]){o.next=3;break}return o.abrupt("return",Xi[t](n));case 3:return o.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return o.stop()}},e)})),Dh.apply(this,arguments)}Ru(rd);var Dc=new Map;function wp(e,a){Dc.set(e,a)}function Il(e){var a=Dc.get(e);return a}var tf="l7-worker",rf=3,nd=!0;function uh(e){wp(tf,e)}function pc(){var e=Il(tf);if(!e)throw new Error("get worker failed by workerName: ".concat(tf,"."));return e}function Tp(e,a){return Jh.apply(this,arguments)}function Jh(){return Jh=(0,_a.Z)(di().mark(function e(a,t){var n,r,o,u,h;return di().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return n=pc(),r=ls.getWorkerFarm({maxConcurrency:rf,reuseWorkers:nd}),o=r.getWorkerPool({name:tf,source:n}),m.next=5,o.startJob(tf,function(b,A,k){return b.done(k)});case 5:return u=m.sent,u.postMessage("process",{input:{workerType:a,data:t}}),m.next=9,u.result;case 9:return h=m.sent,m.abrupt("return",h.result);case 11:case"end":return m.stop()}},e)})),Jh.apply(this,arguments)}uh(zs());var dc={BACK:1029,FRONT:1028};function nf(e){switch(e){case"GAODE1.x":return dc.BACK;case"GAODE2.x":return dc.BACK;case"MAPBOX":return dc.FRONT;case"SIMPLE":return dc.FRONT;case"GLOBEL":return dc.BACK;case"L7MAP":return dc.FRONT;default:return dc.FRONT}}function kl(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function lh(e,a){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=a.x,n=a.y,r=a.z;if(Array.isArray(e)){var o=Math.abs(t+n)%e.length;e=e[o]}return e.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,r.toString()).replace(/\{-y\}/g,(Math.pow(2,r)-n-1).toString())}var af;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(af||(af={}));var Fu;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(Fu||(Fu={}));function ch(e,a){a===void 0&&(a={});var t=Number(e[0]),n=Number(e[1]),r=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var u=[t,n],h=[t,o],v=[r,o],m=[r,n];return on([[u,m,v,h,u]],a.properties,{bbox:e,id:a.id})}var Mp=0,Bc=1,of=2;function kd(e){e.forEach(function(a){a.isCurrent&&(a.isVisible=a.isLoaded)})}function Df(e){e.forEach(function(a){a.properties.state=Mp}),e.forEach(function(a){a.isCurrent&&!vc(a)&&ql(a)}),e.forEach(function(a){a.isVisible=Boolean(a.properties.state&of)})}function Pd(e){e.forEach(function(t){t.properties.state=Mp}),e.forEach(function(t){t.isCurrent&&vc(t)});var a=e.slice().sort(function(t,n){return t.z-n.z});a.forEach(function(t){t.isVisible=Boolean(t.properties.state&of),t.children.length&&(t.isVisible||t.properties.state&Bc)?t.children.forEach(function(n){n.properties.state=Bc}):t.isCurrent&&ql(t)})}function vc(e){for(;e;){if(e.isLoaded)return e.properties.state|=of,!0;e=e.parent}return!1}function ql(e){e.children.forEach(function(a){a.isLoaded?a.properties.state|=of:ql(a)})}var Zs,Bf=256,Nc=[-Infinity,-Infinity,Infinity,Infinity],Bh=.2,zc=5,Ip=(Zs={},(0,re.Z)(Zs,af.Realtime,kd),(0,re.Z)(Zs,af.Overlap,Df),(0,re.Z)(Zs,af.Replace,Pd),Zs),R0=function(){};function mc(e,a,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),r=Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,r]}function fh(e,a,t){var n=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[n,o]}var hh=function(a,t,n){var r=fh(a,t,n),o=(0,Mr.Z)(r,2),u=o[0],h=o[1],v=fh(a+1,t+1,n),m=(0,Mr.Z)(v,2),b=m[0],A=m[1];return[u,A,b,h]};function Nf(e){var a=e.zoom,t=e.latLonBounds,n=e.maxZoom,r=n===void 0?Infinity:n,o=e.minZoom,u=o===void 0?0:o,h=e.zoomOffset,v=h===void 0?0:h,m=e.extent,b=m===void 0?Nc:m,A=Math.ceil(a)+v;if(Number.isFinite(u)&&A<u)return[];Number.isFinite(r)&&A>r&&(A=r);for(var k=(0,Mr.Z)(t,4),L=k[0],B=k[1],Z=k[2],V=k[3],K=[Math.max(L,b[0]),Math.max(B,b[1]),Math.min(Z,b[2]),Math.min(V,b[3])],le=[],be=mc(K[0],K[1],A),Be=(0,Mr.Z)(be,2),et=Be[0],at=Be[1],Lt=mc(K[2],K[3],A),Gt=(0,Mr.Z)(Lt,2),sr=Gt[0],Tr=Gt[1],Er=et;Er<=sr;Er++)for(var Qr=Tr;Qr<=at;Qr++)le.push({x:Er,y:Qr,z:A});var On=(sr+et)/2,li=(at+Tr)/2,Da=function(ks,Tu){return Math.abs(ks-On)+Math.abs(Tu-li)};return le.sort(function(Wa,ks){return Da(Wa.x,Wa.y)-Da(ks.x,ks.y)}),le}var Ld=function(a,t,n){var r=Math.pow(2,n),o=r-1,u=r,h=a,v=t;return h<0?h=h+u:h>o&&(h=h%u),{warpX:h,warpY:v}},id=function(){function e(a){(0,Zt.Z)(this,e),(0,re.Z)(this,"tileSize",256),(0,re.Z)(this,"isVisible",!1),(0,re.Z)(this,"isCurrent",!1),(0,re.Z)(this,"isVisibleChange",!1),(0,re.Z)(this,"parentLayerIDList",[]),(0,re.Z)(this,"layerIDList",[]),(0,re.Z)(this,"parent",null),(0,re.Z)(this,"children",[]),(0,re.Z)(this,"data",null),(0,re.Z)(this,"properties",{}),(0,re.Z)(this,"loadDataId",0);var t=a.x,n=a.y,r=a.z,o=a.tileSize;this.x=t,this.y=n,this.z=r,this.tileSize=o}return(0,kt.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===Fu.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Fu.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Fu.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===Fu.Cancelled}},{key:"isDone",get:function(){return[Fu.Loaded,Fu.Cancelled,Fu.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return hh(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,Mr.Z)(this.bounds,4),n=t[0],r=t[1],o=t[2],u=t[3],h=[(o-n)/2,(u-r)/2],v=ch(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:h,meta:`
      `.concat(this.key,`
      `)}});return v}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"loadData",value:function(){var a=(0,_a.Z)(di().mark(function n(r){var o,u,h,v,m,b,A,k,L,B,Z,V,K,le,be,Be;return di().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:return o=r.getData,u=r.onLoad,h=r.onError,this.loadDataId++,v=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Fu.Loading,m=null,at.prev=7,A=this.x,k=this.y,L=this.z,B=this.bounds,Z=this.tileSize,V=Ld(A,k,L),K=V.warpX,le=V.warpY,be=this.abortController.signal,Be={x:K,y:le,z:L,bounds:B,tileSize:Z,signal:be},at.next=14,o(Be,this);case 14:m=at.sent,at.next=20;break;case 17:at.prev=17,at.t0=at.catch(7),b=at.t0;case 20:if(v===this.loadDataId){at.next=22;break}return at.abrupt("return");case 22:if(!(this.isCancelled&&!m)){at.next=24;break}return at.abrupt("return");case 24:if(!(b||!m)){at.next=28;break}return this.loadStatus=Fu.Failure,h(b,this),at.abrupt("return");case 28:this.loadStatus=Fu.Loaded,this.data=m,u(this);case 31:case"end":return at.stop()}},n,this,[[7,17]])}));function t(n){return a.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Fu.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),e}(),Xu=de(26729),kp=de.n(Xu),uo=function(a,t){var n=Jc(a),r=ll(n,t),o=360*3-180,u=85.0511287798065,h=[Math.max(r[0][0],-o),Math.max(r[0][1],-u),Math.min(r[1][0],o),Math.min(r[1][1],u)];return h},Uc=function(a,t){var n=Jc(a),r=Jc(t),o=ac(n,r);return o};function Ja(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Vs(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Vs(e,a){if(!!e){if(typeof e=="string")return ad(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ad(e,a)}}function ad(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function od(e){var a=r0();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function r0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n0=function(e){(0,Pr.Z)(t,e);var a=od(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this),(0,re.Z)((0,bt.Z)(r),"currentTiles",[]),(0,re.Z)((0,bt.Z)(r),"cacheTiles",new Map),(0,re.Z)((0,bt.Z)(r),"onTileLoad",function(o){r.emit("tile-loaded",o),r.updateTileVisible()}),(0,re.Z)((0,bt.Z)(r),"onTileError",function(o,u){r.emit("tile-error",{error:o,tile:u}),r.updateTileVisible()}),(0,re.Z)((0,bt.Z)(r),"onTileUnload",function(o){r.emit("tile-unload",o)}),r.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Nc,getTileData:R0,updateStrategy:af.Replace},r.updateOptions(n),r}return(0,kt.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(r){return r.isDone})}},{key:"tiles",get:function(){var r=Array.from(this.cacheTiles.values()).sort(function(o,u){return o.z-u.z});return r}},{key:"updateOptions",value:function(r){var o=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),u=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=(0,ae.Z)((0,ae.Z)((0,ae.Z)({},this.options),r),{},{minZoom:o,maxZoom:u})}},{key:"update",value:function(r,o){var u=this,h=Math.ceil(r);if(!(this.lastViewStates&&this.lastViewStates.zoom===h&&Uc(this.lastViewStates.latLonBoundsBuffer,o))){var v=uo(o,Bh);this.lastViewStates={zoom:h,latLonBounds:o,latLonBoundsBuffer:v};var m=!1,b=this.getTileIndices(h,v);this.currentTiles=b.map(function(A){var k=A.x,L=A.y,B=A.z,Z=u.getTile(k,L,B);if(Z){var V,K,le=((V=Z)===null||V===void 0?void 0:V.isFailure)||((K=Z)===null||K===void 0?void 0:K.isCancelled);return le&&Z.loadData({getData:u.options.getTileData,onLoad:u.onTileLoad,onError:u.onTileError}),Z}return Z=u.createTile(k,L,B),m=!0,Z}),m&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var r=Ja(this.cacheTiles),o;try{for(r.s();!(o=r.n()).done;){var u=(0,Mr.Z)(o.value,2),h=u[0],v=u[1];this.currentTiles.includes(v)||(this.cacheTiles.delete(h),this.onTileUnload(v)),this.onTileUnload(v),v.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(m){r.e(m)}finally{r.f()}}},{key:"pruneRequests",value:function(){var r=[],o=Ja(this.cacheTiles.values()),u;try{for(o.s();!(u=o.n()).done;){var h=u.value;h.isLoading&&!h.isCurrent&&!h.isVisible&&r.push(h)}}catch(m){o.e(m)}finally{o.f()}for(;r.length>0;){var v=r.shift();v.abortLoad()}}},{key:"destroy",value:function(){var r=Ja(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.isLoading&&u.abortLoad()}}catch(h){r.e(h)}finally{r.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var r=this.options.updateStrategy,o=new Map,u=Ja(this.cacheTiles.values()),h;try{for(u.s();!(h=u.n()).done;){var v=h.value;o.set(v.key,v.isVisible),v.isCurrent=!1,v.isVisible=!1}}catch(B){u.e(B)}finally{u.f()}var m=Ja(this.currentTiles),b;try{for(m.s();!(b=m.n()).done;){var A=b.value;A.isCurrent=!0,A.isVisible=!0}}catch(B){m.e(B)}finally{m.f()}var k=Array.from(this.cacheTiles.values());typeof r=="function"?r(k):Ip[r](k);var L=!1;Array.from(this.cacheTiles.values()).forEach(function(B){B.isVisible!==o.get(B.key)?(B.isVisibleChange=!0,L=!0):B.isVisibleChange=!1}),L&&this.emit("tile-update")}},{key:"getTileIndices",value:function(r,o){var u=this.options,h=u.tileSize,v=u.extent,m=u.zoomOffset,b=Math.floor(this.options.maxZoom),A=Math.ceil(this.options.minZoom),k=Nf({maxZoom:b,minZoom:A,zoomOffset:m,tileSize:h,zoom:r,latLonBounds:o,extent:v});return k}},{key:"getTileId",value:function(r,o,u){var h="".concat(r,",").concat(o,",").concat(u);return h}},{key:"getTile",value:function(r,o,u){var h=this.getTileId(r,o,u),v=this.cacheTiles.get(h);return v}},{key:"createTile",value:function(r,o,u){var h=this.getTileId(r,o,u),v=new id({x:r,y:o,z:u,tileSize:this.options.tileSize});return this.cacheTiles.set(h,v),v.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),v}},{key:"resizeCacheTiles",value:function(){var r=zc*this.currentTiles.length,o=this.cacheTiles.size>r;if(o){var u=Ja(this.cacheTiles),h;try{for(u.s();!(h=u.n()).done;){var v=(0,Mr.Z)(h.value,2),m=v[0],b=v[1];if(!b.isVisible&&!this.currentTiles.includes(b)&&(this.cacheTiles.delete(m),this.onTileUnload(b)),this.cacheTiles.size<=r)break}}catch(A){u.e(A)}finally{u.f()}}}},{key:"rebuildTileTree",value:function(){var r=Ja(this.cacheTiles.values()),o;try{for(r.s();!(o=r.n()).done;){var u=o.value;u.parent=null,u.children.length=0}}catch(A){r.e(A)}finally{r.f()}var h=Ja(this.cacheTiles.values()),v;try{for(h.s();!(v=h.n()).done;){var m=v.value,b=this.getNearestAncestor(m.x,m.y,m.z);m.parent=b,b!=null&&b.children&&b.children.push(m)}}catch(A){h.e(A)}finally{h.f()}}},{key:"getNearestAncestor",value:function(r,o,u){for(;u>this.options.minZoom;){r=Math.floor(r/2),o=Math.floor(o/2),u=u-1;var h=this.getTile(r,o,u);if(h)return h}return null}}]),t}(kp()),Pp;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Pp||(Pp={}));function Rd(e,a,t,n,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,h=t;return u&&(h=Math.round(t*(o-1))/(o-1)),n?Od(e,a,h,n,r):Od(e,a,h,.314,r)}function Lp(e,a){var t=1-a;return(e[0]*t+e[1]*a)*t+(e[1]*t+e[2]*a)*a}function O0(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function ep(e,a,t){var n=[a[0]-e[0],a[1]-e[1]],r=O0(n,[0,0]),o=Math.atan2(n[1],n[0]),u=r/2/Math.cos(t),h=o+t,v=[u*Math.cos(h)+e[0],u*Math.sin(h)+e[1]];return v}function Od(e,a,t,n,r){if(r===Version["GAODE2.x"]){var o=amap2Project(e[0],e[1]),u=amap2Project(a[0],a[1]),h=ep(o,u,n),v=[o[0],h[0],u[0]],m=[o[1],h[1],u[1]];return[].concat(_toConsumableArray(amap2UnProject(Lp(v,t),Lp(m,t))),[0])}else{var b=ep(e,a,n),A=[e[0],b[0],a[0]],k=[e[1],b[1],a[1]];return[Lp(A,t),Lp(k,t),0]}}function F0(e,a,t,n,r){var o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,u=arguments.length>6?arguments[6]:void 0,h=t;return u&&(h=Math.round(t*29)/29),Zc(e,a,h,r)}function ph(e,a){var t=[a[0]-e[0],a[1]-e[1]],n=calDistance(t,[0,0]),r=Math.atan2(t[1],t[0]),o=.314,u=n/2/Math.cos(o),h=r+o,v=[u*Math.cos(h)+e[0],u*Math.sin(h)+e[1]];return v}function xo(e,a){var t=1-a;return(e[0]*t+e[1]*a)*t+(e[1]*t+e[2]*a)*a}function sd(e,a){var t=[e[0]-a[0],e[1]-a[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],r=n[1]*n[1]+Math.cos(e[1])*Math.cos(a[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))}function Zc(e,a,t,n){var r=[degreesToRadians(e[0]),degreesToRadians(e[1])],o=[degreesToRadians(a[0]),degreesToRadians(a[1])];if(n==="GAODE2.x"){var u=ph(r,o),h=[r[0],u[0],o[0]],v=[r[1],u[1],o[1]];return[xo(h,t),xo(v,t),0]}else{var m=sd(r,o);if(Math.abs(m-Math.PI)<.001)return[(1-t)*r[0]+t*o[0],(1-t)*r[1]+t*o[1]];var b=Math.sin((1-t)*m)/Math.sin(m),A=Math.sin(t*m)/Math.sin(m),k=[Math.sin(r[0]),Math.sin(r[1])],L=[Math.cos(r[0]),Math.cos(r[1])],B=[Math.sin(o[0]),Math.sin(o[1])],Z=[Math.cos(o[0]),Math.cos(o[1])],V=b*L[1]*L[0]+A*Z[1]*Z[0],K=b*L[1]*k[0]+A*Z[1]*B[0],le=b*k[1]+A*B[1];return[radiansToDegrees(Math.atan2(K,V)),radiansToDegrees(Math.atan2(le,Math.sqrt(V*V+K*K)))]}}function tp(e,a){for(var t=0,n=[],r=0;r<e.length-1;r++){var o=e[r],u=e[r+1],h=ud(o,u),v=t;t+=h,n.push({p1:o,p2:u,totalDistance:t,distance:h,lastTotalDistance:v})}for(var m=t*a,b,A,k=0;k<n.length;k++){var L=n[k].totalDistance;if(L>m){var B=n[k].p1,Z=n[k].p2,V=(m-n[k].lastTotalDistance)/n[k].distance,K=Fd(Z,B,V);b=K[0],A=K[1];break}}return{_lng:b,_lat:A,_height:0}}function Fd(e,a,t){return[e[0]*t+a[0]*(1-t),e[1]*t+a[1]*(1-t)]}function ud(e,a){return Math.sqrt(Math.pow(e[0]-a[0],2)+Math.pow(e[1]-a[1],2))}function H(e,a){var t=a.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(r){var o=r._id;return o===t})),n.map(function(r){var o=ot(r,a);return _objectSpread(_objectSpread({},r),o)})}function Le(e,a){return new Promise(function(t,n){e.inited?t(H(e,a)):e.once("sourceUpdate",function(){t(H(e,a))})})}function ot(e,a){var t=a.offset,n=a.shape,r=a.thetaOffset,o=a.mapVersion,u=a.segmentNumber,h=u===void 0?30:u,v=a.autoFit,m=v===void 0?!0:v,b=e.coordinates;if(n==="line")return pathLineAtOffset(b,t);var A=b[0],k=b[1],L;typeof r=="string"?L=e[r]||0:L=r;var B;switch(n){case"arc":B=arcLineAtOffset;break;case"greatcircle":B=greatCircleLineAtOffset;break;default:B=arcLineAtOffset}var Z=B(A,k,t,L,o,h,m),V=_slicedToArray(Z,3),K=V[0],le=V[1],be=V[2];return{_lng:K,_lat:le,_height:be}}function hr(e,a){var t=a.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,r=new Promise(function(u){e instanceof HTMLImageElement||Kf(e)?u([e]):Ur(e,function(h){u(h)})}),o={originData:e,images:r,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return o}function Ur(e,a){var t=e,n=[];if(typeof t=="string")Mf({url:t},function(u,h){h&&(n.push(h),a(n))});else{var r=t.length,o=0;t.forEach(function(u){Mf({url:u},function(h,v){o++,v&&n.push(v),o===r&&a(n)})})}return hr}var cr=de(38929),kr=de(3614),Gr=de.n(kr),$r={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},tn=512;function hn(e,a,t){var n=e/Math.pow(2,t)*360-180,r=Math.PI-2*Math.PI*a/Math.pow(2,t),o=180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)));return[n,o]}function pn(e){for(var a=0,t=0,n=e.length,r=n-1,o,u;t<n;r=t++)o=e[t],u=e[r],a+=(u.x-o.x)*(o.y+u.y);return a}function In(e){var a=e.length;if(a<=1)return[e];for(var t=[],n,r,o=0;o<a;o++){var u=pn(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(n&&t.push(n),n=[e[o]]):n.push(e[o]))}return n&&t.push(n),t}var rn=["Unknown","Point","LineString","Polygon"];function cn(e,a){var t=a.extent,n=a.loadGeometry(),r=a.type,o=a.properties,u=a.id,h=t*Math.pow(2,e),v=rn[r],m,b;function A(B){for(var Z=0;Z<B.length;Z++){var V=B[Z];B[Z]=[V.x/h*tn,V.y/h*tn]}}switch(r){case 1:var k=[];for(m=0;m<n.length;m++)k[m]=n[m][0];n=k,A(n);break;case 2:for(m=0;m<n.length;m++)A(n[m]);break;case 3:for(n=In(n),m=0;m<n.length;m++)for(b=0;b<n[m].length;b++)A(n[m][b]);break}n.length===1?n=n[0]:v="Multi"+v;var L={type:"Feature",geometry:{type:v,coordinates:n},properties:o,id:u,tileOrigin:[0,0],coord:""};return L}var Nt=function(){var e=(0,_a.Z)(di().mark(function a(t,n,r,o){var u;return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=lh(t,n),v.abrupt("return",new Promise(function(m){var b=Gl({url:u},function(A,k){if(A||!k)m({layers:{}});else{for(var L=new cr.VectorTile(new(Gr())(k)),B=hn(n.x,n.y,n.z),Z=n.z,V=0,K=Object.keys(L.layers);V<K.length;V++){for(var le=K[V],be=[],Be=L.layers[le],et=0;et<L.layers[le].length;et++){var at=L.layers[le].feature(et),Lt=void 0;o==="lnglat"?Lt=at.toGeoJSON(n.x,n.y,n.z):(Lt=cn(Z,at),Be.l7TileOrigin=B,Be.l7TileCoord=o),be.push(Lt)}Be.features=be}m(L)}});r.xhrCancel=function(){return b.abort()}}));case 2:case"end":return v.stop()}},a)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function yr(e,a){var t=(a==null?void 0:a.coord)||"lnglat",n=function(u,h){return Nt(e,u,h,t)},r=(0,ae.Z)((0,ae.Z)((0,ae.Z)({},$r),a),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}function en(e,a,t,n){for(var r=n,o=t-a>>1,u=t-a,h,v=e[a],m=e[a+1],b=e[t],A=e[t+1],k=a+3;k<t;k+=3){var L=Pn(e[k],e[k+1],v,m,b,A);if(L>r)h=k,r=L;else if(L===r){var B=Math.abs(k-o);B<u&&(h=k,u=B)}}r>n&&(h-a>3&&en(e,a,h,n),e[h+2]=r,t-h>3&&en(e,h,t,n))}function Pn(e,a,t,n,r,o){var u=r-t,h=o-n;if(u!==0||h!==0){var v=((e-t)*u+(a-n)*h)/(u*u+h*h);v>1?(t=r,n=o):v>0&&(t+=u*v,n+=h*v)}return u=e-t,h=a-n,u*u+h*h}function Zr(e,a,t,n){var r={id:typeof e=="undefined"?null:e,type:a,geometry:t,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return yn(r),r}function yn(e){var a=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")Nn(e,a);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<a.length;n++)Nn(e,a[n]);else if(t==="MultiPolygon")for(n=0;n<a.length;n++)for(var r=0;r<a[n].length;r++)Nn(e,a[n][r])}function Nn(e,a){for(var t=0;t<a.length;t+=3)e.minX=Math.min(e.minX,a[t]),e.minY=Math.min(e.minY,a[t+1]),e.maxX=Math.max(e.maxX,a[t]),e.maxY=Math.max(e.maxY,a[t+1])}function Ti(e,a){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Ir(t,e.features[n],a,n);else e.type==="Feature"?Ir(t,e,a):Ir(t,{geometry:e},a);return t}function Ir(e,a,t,n){if(!!a.geometry){var r=a.geometry.coordinates,o=a.geometry.type,u=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),h=[],v=a.id;if(t.promoteId?v=a.properties[t.promoteId]:t.generateId&&(v=n||0),o==="Point")Fr(r,h);else if(o==="MultiPoint")for(var m=0;m<r.length;m++)Fr(r[m],h);else if(o==="LineString")ii(r,h,u,!1);else if(o==="MultiLineString")if(t.lineMetrics){for(m=0;m<r.length;m++)h=[],ii(r[m],h,u,!1),e.push(Zr(v,"LineString",h,a.properties));return}else Ln(r,h,u,!1);else if(o==="Polygon")Ln(r,h,u,!0);else if(o==="MultiPolygon")for(m=0;m<r.length;m++){var b=[];Ln(r[m],b,u,!0),h.push(b)}else if(o==="GeometryCollection"){for(m=0;m<a.geometry.geometries.length;m++)Ir(e,{id:v,geometry:a.geometry.geometries[m],properties:a.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Zr(v,o,h,a.properties))}}function Fr(e,a){a.push(nn(e[0])),a.push(zn(e[1])),a.push(0)}function ii(e,a,t,n){for(var r,o,u=0,h=0;h<e.length;h++){var v=nn(e[h][0]),m=zn(e[h][1]);a.push(v),a.push(m),a.push(0),h>0&&(n?u+=(r*m-v*o)/2:u+=Math.sqrt(Math.pow(v-r,2)+Math.pow(m-o,2))),r=v,o=m}var b=a.length-3;a[2]=1,en(a,0,b,t),a[b+2]=1,a.size=Math.abs(u),a.start=0,a.end=a.size}function Ln(e,a,t,n){for(var r=0;r<e.length;r++){var o=[];ii(e[r],o,t,n),a.push(o)}}function nn(e){return e/360+.5}function zn(e){var a=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+a)/(1-a))/Math.PI;return t<0?0:t>1?1:t}function Mn(e,a,t,n,r,o,u,h){if(t/=a,n/=a,o>=t&&u<n)return e;if(u<t||o>=n)return null;for(var v=[],m=0;m<e.length;m++){var b=e[m],A=b.geometry,k=b.type,L=r===0?b.minX:b.minY,B=r===0?b.maxX:b.maxY;if(L>=t&&B<n){v.push(b);continue}else if(B<t||L>=n)continue;var Z=[];if(k==="Point"||k==="MultiPoint")ca(A,Z,t,n,r);else if(k==="LineString")Gi(A,Z,t,n,r,!1,h.lineMetrics);else if(k==="MultiLineString")Fn(A,Z,t,n,r,!1);else if(k==="Polygon")Fn(A,Z,t,n,r,!0);else if(k==="MultiPolygon")for(var V=0;V<A.length;V++){var K=[];Fn(A[V],K,t,n,r,!0),K.length&&Z.push(K)}if(Z.length){if(h.lineMetrics&&k==="LineString"){for(V=0;V<Z.length;V++)v.push(Zr(b.id,k,Z[V],b.tags));continue}(k==="LineString"||k==="MultiLineString")&&(Z.length===1?(k="LineString",Z=Z[0]):k="MultiLineString"),(k==="Point"||k==="MultiPoint")&&(k=Z.length===3?"Point":"MultiPoint"),v.push(Zr(b.id,k,Z,b.tags))}}return v.length?v:null}function ca(e,a,t,n,r){for(var o=0;o<e.length;o+=3){var u=e[o+r];u>=t&&u<=n&&(a.push(e[o]),a.push(e[o+1]),a.push(e[o+2]))}}function Gi(e,a,t,n,r,o,u){for(var h=Rn(e),v=r===0?ta:Ta,m=e.start,b,A,k=0;k<e.length-3;k+=3){var L=e[k],B=e[k+1],Z=e[k+2],V=e[k+3],K=e[k+4],le=r===0?L:B,be=r===0?V:K,Be=!1;u&&(b=Math.sqrt(Math.pow(L-V,2)+Math.pow(B-K,2))),le<t?be>t&&(A=v(h,L,B,V,K,t),u&&(h.start=m+b*A)):le>n?be<n&&(A=v(h,L,B,V,K,n),u&&(h.start=m+b*A)):Pi(h,L,B,Z),be<t&&le>=t&&(A=v(h,L,B,V,K,t),Be=!0),be>n&&le<=n&&(A=v(h,L,B,V,K,n),Be=!0),!o&&Be&&(u&&(h.end=m+b*A),a.push(h),h=Rn(e)),u&&(m+=b)}var et=e.length-3;L=e[et],B=e[et+1],Z=e[et+2],le=r===0?L:B,le>=t&&le<=n&&Pi(h,L,B,Z),et=h.length-3,o&&et>=3&&(h[et]!==h[0]||h[et+1]!==h[1])&&Pi(h,h[0],h[1],h[2]),h.length&&a.push(h)}function Rn(e){var a=[];return a.size=e.size,a.start=e.start,a.end=e.end,a}function Fn(e,a,t,n,r,o){for(var u=0;u<e.length;u++)Gi(e[u],a,t,n,r,o,!1)}function Pi(e,a,t,n){e.push(a),e.push(t),e.push(n)}function ta(e,a,t,n,r,o){var u=(o-a)/(n-a);return e.push(o),e.push(t+(r-t)*u),e.push(1),u}function Ta(e,a,t,n,r,o){var u=(o-t)/(r-t);return e.push(a+(n-a)*u),e.push(o),e.push(1),u}function qo(e,a){var t=a.buffer/a.extent,n=e,r=Mn(e,1,-1-t,t,0,-1,2,a),o=Mn(e,1,1-t,2+t,0,-1,2,a);return(r||o)&&(n=Mn(e,1,-t,1+t,0,-1,2,a)||[],r&&(n=$o(r,1).concat(n)),o&&(n=n.concat($o(o,-1)))),n}function $o(e,a){for(var t=[],n=0;n<e.length;n++){var r=e[n],o=r.type,u;if(o==="Point"||o==="MultiPoint"||o==="LineString")u=Ca(r.geometry,a);else if(o==="MultiLineString"||o==="Polygon"){u=[];for(var h=0;h<r.geometry.length;h++)u.push(Ca(r.geometry[h],a))}else if(o==="MultiPolygon")for(u=[],h=0;h<r.geometry.length;h++){for(var v=[],m=0;m<r.geometry[h].length;m++)v.push(Ca(r.geometry[h][m],a));u.push(v)}t.push(Zr(r.id,o,u,r.tags))}return t}function Ca(e,a){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+a,e[n+1],e[n+2]);return t}function $s(e,a){if(e.transformed)return e;var t=1<<e.z,n=e.x,r=e.y,o,u,h;for(o=0;o<e.features.length;o++){var v=e.features[o],m=v.geometry,b=v.type;if(v.geometry=[],b===1)for(u=0;u<m.length;u+=2)v.geometry.push(wo(m[u],m[u+1],a,t,n,r));else for(u=0;u<m.length;u++){var A=[];for(h=0;h<m[u].length;h+=2)A.push(wo(m[u][h],m[u][h+1],a,t,n,r));v.geometry.push(A)}}return e.transformed=!0,e}function wo(e,a,t,n,r,o){return[Math.round(t*(e*n-r)),Math.round(t*(a*n-o))]}function js(e,a,t,n,r){for(var o=a===r.maxZoom?0:r.tolerance/((1<<a)*r.extent),u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:a,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},h=0;h<e.length;h++){u.numFeatures++,gs(u,e[h],o,r);var v=e[h].minX,m=e[h].minY,b=e[h].maxX,A=e[h].maxY;v<u.minX&&(u.minX=v),m<u.minY&&(u.minY=m),b>u.maxX&&(u.maxX=b),A>u.maxY&&(u.maxY=A)}return u}function gs(e,a,t,n){var r=a.geometry,o=a.type,u=[];if(o==="Point"||o==="MultiPoint")for(var h=0;h<r.length;h+=3)u.push(r[h]),u.push(r[h+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")Ts(u,r,e,t,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(h=0;h<r.length;h++)Ts(u,r[h],e,t,o==="Polygon",h===0);else if(o==="MultiPolygon")for(var v=0;v<r.length;v++){var m=r[v];for(h=0;h<m.length;h++)Ts(u,m[h],e,t,!0,h===0)}if(u.length){var b=a.tags||null;if(o==="LineString"&&n.lineMetrics){b={};for(var A in a.tags)b[A]=a.tags[A];b.mapbox_clip_start=r.start/r.size,b.mapbox_clip_end=r.end/r.size}var k={geometry:u,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:b};a.id!==null&&(k.id=a.id),e.features.push(k)}}function Ts(e,a,t,n,r,o){var u=n*n;if(n>0&&a.size<(r?u:n)){t.numPoints+=a.length/3;return}for(var h=[],v=0;v<a.length;v+=3)(n===0||a[v+2]>u)&&(t.numSimplified++,h.push(a[v]),h.push(a[v+1])),t.numPoints++;r&&Gs(h,o),e.push(h)}function Gs(e,a){for(var t=0,n=0,r=e.length,o=r-2;n<r;o=n,n+=2)t+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(t>0===a)for(n=0,r=e.length;n<r/2;n+=2){var u=e[n],h=e[n+1];e[n]=e[r-2-n],e[n+1]=e[r-1-n],e[r-2-n]=u,e[r-1-n]=h}}function du(e,a){return new Uo(e,a)}function Uo(e,a){a=this.options=Ms(Object.create(this.options),a);var t=a.debug;if(t&&console.time("preprocess data"),a.maxZoom<0||a.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(a.promoteId&&a.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Ti(e,a);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",a.indexMaxZoom,a.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=qo(n,a),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}Uo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Uo.prototype.splitTile=function(e,a,t,n,r,o,u){for(var h=[e,a,t,n],v=this.options,m=v.debug;h.length;){n=h.pop(),t=h.pop(),a=h.pop(),e=h.pop();var b=1<<a,A=sa(a,t,n),k=this.tiles[A];if(!k&&(m>1&&console.time("creation"),k=this.tiles[A]=js(e,a,t,n,v),this.tileCoords.push({z:a,x:t,y:n}),m)){m>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",a,t,n,k.numFeatures,k.numPoints,k.numSimplified),console.timeEnd("creation"));var L="z"+a;this.stats[L]=(this.stats[L]||0)+1,this.total++}if(k.source=e,r){if(a===v.maxZoom||a===r)continue;var B=1<<r-a;if(t!==Math.floor(o/B)||n!==Math.floor(u/B))continue}else if(a===v.indexMaxZoom||k.numPoints<=v.indexMaxPoints)continue;if(k.source=null,e.length!==0){m>1&&console.time("clipping");var Z=.5*v.buffer/v.extent,V=.5-Z,K=.5+Z,le=1+Z,be,Be,et,at,Lt,Gt;be=Be=et=at=null,Lt=Mn(e,b,t-Z,t+K,0,k.minX,k.maxX,v),Gt=Mn(e,b,t+V,t+le,0,k.minX,k.maxX,v),e=null,Lt&&(be=Mn(Lt,b,n-Z,n+K,1,k.minY,k.maxY,v),Be=Mn(Lt,b,n+V,n+le,1,k.minY,k.maxY,v),Lt=null),Gt&&(et=Mn(Gt,b,n-Z,n+K,1,k.minY,k.maxY,v),at=Mn(Gt,b,n+V,n+le,1,k.minY,k.maxY,v),Gt=null),m>1&&console.timeEnd("clipping"),h.push(be||[],a+1,t*2,n*2),h.push(Be||[],a+1,t*2,n*2+1),h.push(et||[],a+1,t*2+1,n*2),h.push(at||[],a+1,t*2+1,n*2+1)}}},Uo.prototype.getTile=function(e,a,t){var n=this.options,r=n.extent,o=n.debug;if(e<0||e>24)return null;var u=1<<e;a=(a%u+u)%u;var h=sa(e,a,t);if(this.tiles[h])return $s(this.tiles[h],r);o>1&&console.log("drilling down to z%d-%d-%d",e,a,t);for(var v=e,m=a,b=t,A;!A&&v>0;)v--,m=Math.floor(m/2),b=Math.floor(b/2),A=this.tiles[sa(v,m,b)];return!A||!A.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",v,m,b),o>1&&console.time("drilling down"),this.splitTile(A.source,v,m,b,e,a,t),o>1&&console.timeEnd("drilling down"),this.tiles[h]?$s(this.tiles[h],r):null)};function sa(e,a,t){return((1<<e)*t+a)*32+e}function Ms(e,a){for(var t in a)e[t]=a[t];return e}var Ua={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function iu(e){for(var a=0,t=0,n=e.length,r=n-1,o,u;t<n;r=t++)o=e[t],u=e[r],a+=(u.x-o.x)*(o.y+u.y);return a}function Yi(e){var a=e.length;if(a<=1)return[e];for(var t=[],n,r,o=0;o<a;o++){var u=iu(e[o]);u!==0&&(r===void 0&&(r=u<0),r===u<0?(n&&t.push(n),n=[e[o]]):n.push(e[o]))}return n&&t.push(n),t}var Ma=["Unknown","Point","LineString","Polygon"];function eo(e,a,t,n,r){var o=r.geometry,u=r.type,h=r.tags,v=r.id,m=e*Math.pow(2,n),b=e*a,A=e*t,k=Ma[u],L,B;function Z(le){for(var be=0;be<le.length;be++){var Be=le[be];if(Be[3])break;var et=180-(Be[1]+A)*360/m,at=(Be[0]+b)*360/m-180,Lt=360/Math.PI*Math.atan(Math.exp(et*Math.PI/180))-90;le[be]=[at,Lt,0,1]}}switch(u){case 1:var V=[];for(L=0;L<o.length;L++)V[L]=o[L][0];o=V,Z(o);break;case 2:for(L=0;L<o.length;L++)Z(o[L]);break;case 3:for(o=Yi(o),L=0;L<o.length;L++)for(B=0;B<o[L].length;B++)Z(o[L][B]);break}o.length===1?o=o[0]:k="Multi"+k;var K={type:"Feature",geometry:{type:k,coordinates:o},properties:h,id:v,tileOrigin:[0,0],coord:""};return K}var ys=function(){var e=(0,_a.Z)(di().mark(function a(t,n,r,o){return di().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",new Promise(function(v){var m=n.getTile(t.z,t.x,t.y),b=[];m.features.map(function(k){var L=eo(o,r.x,r.y,r.z,k);b.push(L)});var A={layers:{geojsonvt:{features:b}}};v(A)}));case 1:case"end":return h.stop()}},a)}));return function(t,n,r,o){return e.apply(this,arguments)}}();function sf(e){var a={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"||(e.geojsonvtOptions.maxZoom&&(a.maxZoom=e.geojsonvtOptions.maxZoom),e.geojsonvtOptions.indexMaxZoom&&(a.indexMaxZoom=e.geojsonvtOptions.indexMaxZoom),e.geojsonvtOptions.indexMaxPoints&&(a.indexMaxPoints=e.geojsonvtOptions.indexMaxPoints),e.geojsonvtOptions.tolerance&&(a.tolerance=e.geojsonvtOptions.tolerance),e.geojsonvtOptions.extent&&(a.extent=e.geojsonvtOptions.extent),e.geojsonvtOptions.buffer&&(a.buffer=e.geojsonvtOptions.buffer),e.geojsonvtOptions.lineMetrics&&(a.lineMetrics=e.geojsonvtOptions.lineMetrics),e.geojsonvtOptions.promoteId&&(a.promoteId=e.geojsonvtOptions.promoteId),e.geojsonvtOptions.generateId&&(a.generateId=e.geojsonvtOptions.generateId),e.geojsonvtOptions.debug&&(a.debug=e.geojsonvtOptions.debug)),a}function $e(e,a){var t=sf(a),n=t.extent||4096,r=du(e,t),o=function(v,m){return ys(m,r,v,n)},u=(0,ae.Z)((0,ae.Z)((0,ae.Z)({},Ua),a),{},{getTileData:o});return{data:e,dataArray:[],tilesetOptions:u,isTile:!0}}function dr(e,a){var t=a.extent,n=a.width,r=a.height,o=a.min,u=a.max,h={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:r,min:o,max:u,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return h}var Xt;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer"})(Xt||(Xt={}));var Jn=function(){var e=(0,_a.Z)(di().mark(function a(t,n,r,o){var u;return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return u=lh(t,n),v.abrupt("return",new Promise(function(m,b){var A=ul({url:u},function(k,L){k?b(k):L&&m(L)},o);r.xhrCancel=function(){return A.abort()}}));case 2:case"end":return v.stop()}},a)}));return function(t,n,r,o){return e.apply(this,arguments)}}(),Ia=function(){var e=(0,_a.Z)(di().mark(function a(t,n,r){var o;return di().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o=lh(t,n),h.abrupt("return",new Promise(function(v,m){var b=Mf({url:o},function(A,k){A?m(A):k&&v(k)});r.xhrCancel=function(){return b.abort()}}));case 2:case"end":return h.stop()}},a)}));return function(t,n,r){return e.apply(this,arguments)}}(),Ze=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Ce={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function ht(e,a){var t=(a==null?void 0:a.dataType)||Xt.IMAGE,n=function(u,h){return t===Xt.IMAGE?Ia(e,u,h):Jn(e,u,h,(a==null?void 0:a.format)||Ze)},r=(0,ae.Z)((0,ae.Z)((0,ae.Z)({},Ce),a),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:r,isTile:!0}}var Vt={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},or=function(){var e=(0,_a.Z)(di().mark(function a(t){return di().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(o){var u=(0,Mr.Z)(t.bounds,4),h=u[0],v=u[1],m=u[2],b=u[3],A={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,textLng:(h+m)/2,textLat:(v+b)/2},geometry:{type:"LineString",coordinates:[[m,b],[m,v],[h,v],[h,v]]}}]}}};o(A)}));case 1:case"end":return r.stop()}},a)}));return function(t){return e.apply(this,arguments)}}();function gt(e,a){var t=function(o){return or(o)},n=(0,ae.Z)((0,ae.Z)((0,ae.Z)({},Vt),a),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var it=de(34155);function wt(e,a,t,n){function r(o){return o instanceof t?o:new t(function(u){u(o)})}return new(t||(t=Promise))(function(o,u){function h(b){try{m(n.next(b))}catch(A){u(A)}}function v(b){try{m(n.throw(b))}catch(A){u(A)}}function m(b){b.done?o(b.value):r(b.value).then(h,v)}m((n=n.apply(e,a||[])).next())})}function Re(e,a){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,r,o,u;return u={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function h(m){return function(b){return v([m,b])}}function v(m){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,r&&(o=m[0]&2?r.return:m[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,m[1])).done)return o;switch(r=0,o&&(m=[m[0]&2,o.value]),m[0]){case 0:case 1:o=m;break;case 4:return t.label++,{value:m[1],done:!1};case 5:t.label++,r=m[1],m=[0];continue;case 7:m=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(m[0]===6||m[0]===2)){t=0;continue}if(m[0]===3&&(!o||m[1]>o[0]&&m[1]<o[3])){t.label=m[1];break}if(m[0]===6&&t.label<o[1]){t.label=o[1],o=m;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(m);break}o[2]&&t.ops.pop(),t.trys.pop();continue}m=a.call(e,t)}catch(b){m=[6,b],r=0}finally{n=o=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}}function ft(e,a){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),r,o=[],u;try{for(;(a===void 0||a-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(h){u={error:h}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(u)throw u.error}}return o}function je(e,a,t){if(t||arguments.length===2)for(var n=0,r=a.length,o;n<r;n++)(o||!(n in a))&&(o||(o=Array.prototype.slice.call(a,0,n)),o[n]=a[n]);return e.concat(o||Array.prototype.slice.call(a))}function zt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $t={exports:{}},Vr={exports:{}},En={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=a.default})(En,En.exports);var sn={},jn={exports:{}},_n={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return function(){for(var n=[],r=arguments.length;r--;)n[r]=arguments[r];var o=n.pop();return t.call(this,n,o)}},e.exports=a.default})(_n,_n.exports);var Yn={};Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.fallback=$n,Yn.wrap=Ni;var Hn=Yn.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,qn=Yn.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,si=Yn.hasNextTick=typeof it=="object"&&typeof it.nextTick=="function";function $n(e){setTimeout(e,0)}function Ni(e){return function(a){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return a.apply(void 0,t)})}}var za;Hn?za=queueMicrotask:qn?za=setImmediate:si?za=it.nextTick:za=$n,Yn.default=Ni(za),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=v;var t=_n.exports,n=h(t),r=Yn,o=h(r),u=sn;function h(A){return A&&A.__esModule?A:{default:A}}function v(A){return(0,u.isAsync)(A)?function(){for(var k=[],L=arguments.length;L--;)k[L]=arguments[L];var B=k.pop(),Z=A.apply(this,k);return m(Z,B)}:(0,n.default)(function(k,L){var B;try{B=A.apply(this,k)}catch(Z){return L(Z)}if(B&&typeof B.then=="function")return m(B,L);L(null,B)})}function m(A,k){return A.then(function(L){b(k,null,L)},function(L){b(k,L&&L.message?L:new Error(L))})}function b(A,k,L){try{A(k,L)}catch(B){(0,o.default)(function(Z){throw Z},B)}}e.exports=a.default}(jn,jn.exports),Object.defineProperty(sn,"__esModule",{value:!0}),sn.isAsyncIterable=sn.isAsyncGenerator=sn.isAsync=void 0;var Ks=jn.exports,ko=qa(Ks);function qa(e){return e&&e.__esModule?e:{default:e}}function Vc(e){return e[Symbol.toStringTag]==="AsyncFunction"}function Du(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function gc(e){return typeof e[Symbol.asyncIterator]=="function"}function $l(e){if(typeof e!="function")throw new Error("expected a function");return Vc(e)?(0,ko.default)(e):e}sn.default=$l,sn.isAsync=Vc,sn.isAsyncGenerator=Du,sn.isAsyncIterable=gc;var yc={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(n,r){if(r===void 0&&(r=n.length),!r)throw new Error("arity is undefined");function o(){for(var u=this,h=[],v=arguments.length;v--;)h[v]=arguments[v];return typeof h[r-1]=="function"?n.apply(this,h):new Promise(function(m,b){h[r-1]=function(A){for(var k=[],L=arguments.length-1;L-- >0;)k[L]=arguments[L+1];if(A)return b(A);m(k.length>1?k:k[0])},n.apply(u,h)})}return o}e.exports=a.default})(yc,yc.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=En.exports,n=v(t),r=sn,o=v(r),u=yc.exports,h=v(u);function v(m){return m&&m.__esModule?m:{default:m}}a.default=(0,h.default)(function(m,b,A){var k=(0,n.default)(b)?[]:{};m(b,function(L,B,Z){(0,o.default)(L)(function(V){for(var K,le=[],be=arguments.length-1;be-- >0;)le[be]=arguments[be+1];le.length<2&&(K=le,le=K[0]),k[B]=le,Z(V)})},function(L){return A(L,k)})},3),e.exports=a.default}(Vr,Vr.exports);var hl={exports:{}},jc={exports:{}},dh={exports:{}},rp={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(n){function r(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];if(n!==null){var h=n;n=null,h.apply(this,o)}}return Object.assign(r,n),r}e.exports=a.default})(rp,rp.exports);var Is={exports:{}},Hs={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=a.default})(Hs,Hs.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=b;var t=En.exports,n=u(t),r=Hs.exports,o=u(r);function u(A){return A&&A.__esModule?A:{default:A}}function h(A){var k=-1,L=A.length;return function(){return++k<L?{value:A[k],key:k}:null}}function v(A){var k=-1;return function(){var B=A.next();return B.done?null:(k++,{value:B.value,key:k})}}function m(A){var k=A?Object.keys(A):[],L=-1,B=k.length;return function Z(){var V=k[++L];return V==="__proto__"?Z():L<B?{value:A[V],key:V}:null}}function b(A){if((0,n.default)(A))return h(A);var k=(0,o.default)(A);return k?v(k):m(A)}e.exports=a.default}(Is,Is.exports);var _c={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=t;function t(n){return function(){for(var r=[],o=arguments.length;o--;)r[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var u=n;n=null,u.apply(this,r)}}e.exports=a.default})(_c,_c.exports);var np={exports:{}},vh={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t={};a.default=t,e.exports=a.default})(vh,vh.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=o;var t=vh.exports,n=r(t);function r(u){return u&&u.__esModule?u:{default:u}}function o(u,h,v,m){var b=!1,A=!1,k=!1,L=0,B=0;function Z(){L>=h||k||b||(k=!0,u.next().then(function(le){var be=le.value,Be=le.done;if(!(A||b)){if(k=!1,Be){b=!0,L<=0&&m(null);return}L++,v(be,B,V),B++,Z()}}).catch(K))}function V(le,be){if(L-=1,!A){if(le)return K(le);if(le===!1){b=!0,A=!0;return}if(be===n.default||b&&L<=0)return b=!0,m(null);Z()}}function K(le){A||(k=!1,b=!0,m(le))}Z()}e.exports=a.default}(np,np.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=rp.exports,n=L(t),r=Is.exports,o=L(r),u=_c.exports,h=L(u),v=sn,m=np.exports,b=L(m),A=vh.exports,k=L(A);function L(B){return B&&B.__esModule?B:{default:B}}a.default=function(B){return function(Z,V,K){if(K=(0,n.default)(K),B<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!Z)return K(null);if((0,v.isAsyncGenerator)(Z))return(0,b.default)(Z,B,V,K);if((0,v.isAsyncIterable)(Z))return(0,b.default)(Z[Symbol.asyncIterator](),B,V,K);var le=(0,o.default)(Z),be=!1,Be=!1,et=0,at=!1;function Lt(sr,Tr){if(!Be)if(et-=1,sr)be=!0,K(sr);else if(sr===!1)be=!0,Be=!0;else{if(Tr===k.default||be&&et<=0)return be=!0,K(null);at||Gt()}}function Gt(){for(at=!0;et<B&&!be;){var sr=le();if(sr===null){be=!0,et<=0&&K(null);return}et+=1,V(sr.value,sr.key,(0,h.default)(Lt))}at=!1}Gt()}},e.exports=a.default}(dh,dh.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=dh.exports,n=v(t),r=sn,o=v(r),u=yc.exports,h=v(u);function v(b){return b&&b.__esModule?b:{default:b}}function m(b,A,k,L){return(0,n.default)(A)(b,(0,o.default)(k),L)}a.default=(0,h.default)(m,4),e.exports=a.default}(jc,jc.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=jc.exports,n=u(t),r=yc.exports,o=u(r);function u(v){return v&&v.__esModule?v:{default:v}}function h(v,m,b){return(0,n.default)(v,1,m,b)}a.default=(0,o.default)(h,3),e.exports=a.default}(hl,hl.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=h;var t=Vr.exports,n=u(t),r=hl.exports,o=u(r);function u(v){return v&&v.__esModule?v:{default:v}}function h(v,m){return(0,n.default)(o.default,v,m)}e.exports=a.default}($t,$t.exports);var ld=zt($t.exports),Kl=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var a=arguments,t=[],n=0;n<arguments.length;n++)t[n]=a[n];return this.args=t,ld(this.tasks)},e.prototype.tap=function(a,t){var n=this;this.tasks.push(function(r){t.apply(void 0,je([],ft(n.args),!1)),r(null,a)})},e}(),zf={exports:{}},i0={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=En.exports,n=V(t),r=vh.exports,o=V(r),u=jc.exports,h=V(u),v=rp.exports,m=V(v),b=_c.exports,A=V(b),k=sn,L=V(k),B=yc.exports,Z=V(B);function V(Be){return Be&&Be.__esModule?Be:{default:Be}}function K(Be,et,at){at=(0,m.default)(at);var Lt=0,Gt=0,sr=Be.length,Tr=!1;sr===0&&at(null);function Er(Qr,On){Qr===!1&&(Tr=!0),Tr!==!0&&(Qr?at(Qr):(++Gt===sr||On===o.default)&&at(null))}for(;Lt<sr;Lt++)et(Be[Lt],Lt,(0,A.default)(Er))}function le(Be,et,at){return(0,h.default)(Be,Infinity,et,at)}function be(Be,et,at){var Lt=(0,n.default)(Be)?K:le;return Lt(Be,(0,L.default)(et),at)}a.default=(0,Z.default)(be,3),e.exports=a.default})(i0,i0.exports),function(e,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=h;var t=i0.exports,n=u(t),r=Vr.exports,o=u(r);function u(v){return v&&v.__esModule?v:{default:v}}function h(v,m){return(0,o.default)(n.default,v,m)}e.exports=a.default}(zf,zf.exports);var pv=zt(zf.exports),Zv=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return pv(this.tasks)},e.prototype.tapPromise=function(a,t){var n=this;this.tasks.push(function(r){return wt(n,void 0,void 0,function(){return Re(this,function(o){switch(o.label){case 0:return[4,t()];case 1:return o.sent(),r(null,a),[2]}})})})},e}(),Qs={exports:{}};(function(e,a){Object.defineProperty(a,"__esModule",{value:!0});var t=rp.exports,n=b(t),r=_c.exports,o=b(r),u=sn,h=b(u),v=yc.exports,m=b(v);function b(k){return k&&k.__esModule?k:{default:k}}function A(k,L){if(L=(0,n.default)(L),!Array.isArray(k))return L(new Error("First argument to waterfall must be an array of functions"));if(!k.length)return L();var B=0;function Z(K){var le=(0,h.default)(k[B++]);le.apply(void 0,K.concat([(0,o.default)(V)]))}function V(K){for(var le=[],be=arguments.length-1;be-- >0;)le[be]=arguments[be+1];if(K!==!1){if(K||B===k.length)return L.apply(void 0,[K].concat(le));Z(le)}}Z([])}a.default=(0,m.default)(A),e.exports=a.default})(Qs,Qs.exports);var ip=zt(Qs.exports),Dd=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ip(this.tasks)},e.prototype.tap=function(a,t){this.tasks.length===0?this.tasks.push(function(n){var r=t();n(r?null:!1,r)}):this.tasks.push(function(n,r){var o=t();r(o?null:!1,a)})},e}(),i=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return ld(this.tasks)},e.prototype.tap=function(a,t){this.tasks.push(function(n){var r=t();n(r,a)})},e}(),s=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var a=arguments,t=[],n=0;n<arguments.length;n++)t[n]=a[n];return this.args=t,ld(this.tasks)},e.prototype.tapPromise=function(a,t){var n=this;this.tasks.push(function(r){return wt(n,void 0,void 0,function(){return Re(this,function(o){switch(o.label){case 0:return[4,t.apply(void 0,je([],ft(this.args),!1))];case 1:return o.sent(),r(null,a),[2]}})})})},e}(),l=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var a=arguments,t=[],n=0;n<arguments.length;n++)t[n]=a[n];return this.args=t,ld(this.tasks)},e.prototype.tapPromise=function(a,t){var n=this;this.tasks.push(function(r){return wt(n,void 0,void 0,function(){var o;return Re(this,function(u){switch(u.label){case 0:return[4,t.apply(void 0,je([],ft(this.args),!1))];case 1:return o=u.sent(),r(o,a),[2]}})})})},e}(),d=de(96486),x=de(69848),C=de.n(x);function T(e,a){var t=a.radius,n=t===void 0?40:t,r=a.maxZoom,o=r===void 0?18:r,u=a.minZoom,h=u===void 0?0:u,v=a.zoom,m=v===void 0?2:v;if(e.pointIndex){var b=e.pointIndex.getClusters(e.extent,Math.floor(m));return e.dataArray=O(b),e}var A=new(C())({radius:n,minZoom:h,maxZoom:o}),k={type:"FeatureCollection",features:[]};return k.features=e.dataArray.map(function(L){return{type:"Feature",geometry:{type:"Point",coordinates:L.coordinates},properties:(0,ae.Z)({},L)}}),A.load(k.features),A}function O(e){return e.map(function(a,t){return(0,ae.Z)({coordinates:a.geometry.coordinates,_id:t+1},a.properties)})}function U(e){if(e.length===0)throw new Error("max requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]>a&&(a=e[t]);return a}function W(e){if(e.length===0)throw new Error("min requires at least one data point");for(var a=e[0],t=1;t<e.length;t++)e[t]<a&&(a=e[t]);return a}function $(e){if(e.length===0)return 0;for(var a=e[0],t=0,n,r=1;r<e.length;r++)n=a+e[r]*1,Math.abs(a)>=Math.abs(e[r])?t+=a-n+e[r]:t+=e[r]-n+a,a=n;return a+t*1}function te(e){if(e.length===0)throw new Error("mean requires at least one data point");return $(e)/e.length}var he={min:W,max:U,mean:te,sum:$};function Ee(e,a){return e.map(function(t){return t[a]*1})}function Ke(e){var a=Je();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Je(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mt(e,a){if(Array.isArray(a))return a}var ct=function(e){(0,Pr.Z)(t,e);var a=Ke(t);function t(n,r){var o;return(0,Zt.Z)(this,t),o=a.call(this),(0,re.Z)((0,bt.Z)(o),"inited",!1),(0,re.Z)((0,bt.Z)(o),"hooks",{init:new Kl}),(0,re.Z)((0,bt.Z)(o),"parser",{type:"geojson"}),(0,re.Z)((0,bt.Z)(o),"transforms",[]),(0,re.Z)((0,bt.Z)(o),"cluster",!1),(0,re.Z)((0,bt.Z)(o),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,re.Z)((0,bt.Z)(o),"invalidExtent",!1),(0,re.Z)((0,bt.Z)(o),"dataArrayChanged",!1),(0,re.Z)((0,bt.Z)(o),"cfg",{}),o.originData=n,o.initCfg(r),o.init(),o}return(0,kt.Z)(t,[{key:"getClusters",value:function(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}},{key:"getClustersLeaves",value:function(r){return this.clusterIndex.getLeaves(r,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(r){var o=this,u=this.clusterOptions,h=u.method,v=h===void 0?"sum":h,m=u.field,b=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,b.forEach(function(A){A.id||(A.properties.point_count=1)}),(m||(0,d.isFunction)(v))&&(b=b.map(function(A){var k=A.id;if(k){var L=o.clusterIndex.getLeaves(k,Infinity),B=L.map(function(K){return K.properties}),Z;if((0,d.isString)(v)&&m){var V=Ee(B,m);Z=he[v](V)}(0,d.isFunction)(v)&&(Z=v(B)),A.properties.stat=Z}else A.properties.point_count=1;return A})),this.data=ve("geojson")({type:"FeatureCollection",features:b}),this.executeTrans()}},{key:"getFeatureById",value:function(r){var o=this.parser.type,u=o===void 0?"geojson":o;if(u==="geojson"&&!this.cluster){var h=r<this.originData.features.length?this.originData.features[r]:"null",v=(0,d.cloneDeep)(h);if(v!=null&&v.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var m=this.data.dataArray.find(function(b){return b._id===r});v.properties=m}return v}else return r<this.data.dataArray.length?this.data.dataArray[r]:"null"}},{key:"updateFeaturePropertiesById",value:function(r,o){this.data.dataArray=this.data.dataArray.map(function(u){return u._id===r?(0,ae.Z)((0,ae.Z)({},u),o):u}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(r,o){var u=this.data.dataArray.find(function(h){return h[r]===o});return u==null?void 0:u._id}},{key:"setData",value:function(r,o){this.originData=r,this.dataArrayChanged=!1,this.initCfg(o),this.init()}},{key:"destroy",value:function(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)===null||r===void 0||r.destroy()}},{key:"handleData",value:function(){var r=this;return new Promise(function(o,u){try{r.excuteParser(),r.initCluster(),r.executeTrans(),o({})}catch(h){u(h)}})}},{key:"initCfg",value:function(r){this.cfg=(0,d.mergeWith)(this.cfg,r,mt);var o=this.cfg;o&&(o.parser&&(this.parser=o.parser),o.transforms&&(this.transforms=o.transforms),this.cluster=o.cluster||!1,o.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,ae.Z)((0,ae.Z)({},this.clusterOptions),o.clusterOptions)))}},{key:"init",value:function(){var r=this;this.inited=!1,this.handleData().then(function(){r.inited=!0,r.emit("sourceUpdate")})}},{key:"excuteParser",value:function(){var r=this.parser,o=r.type||"geojson",u=ve(o);this.data=u(this.originData,r),this.extent=Ph(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var r=this.data.tilesetOptions;if(!!r){if(this.tileset)return this.tileset.updateOptions(r),this.tileset;var o=new n0((0,ae.Z)({},r));return o}}},{key:"executeTrans",value:function(){var r=this,o=this.transforms;o.forEach(function(u){var h=u.type,v=we(h)(r.data,u);Object.assign(r.data,v)})}},{key:"initCluster",value:function(){if(!!this.cluster){var r=this.clusterOptions||{};this.clusterIndex=T(this.data,r)}}},{key:"caculClusterExtent",value:function(r){var o=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(o=ll(Jc(this.extent),r)),o[0].concat(o[1])}}]),t}(Xu.EventEmitter);function Bt(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function Kt(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=mr(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function mr(e,a){if(!!e){if(typeof e=="string")return gr(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return gr(e,a)}}function gr(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var zr=6378e3;function fn(e,a){var t=e.dataArray,n=a.size,r=n===void 0?10:n,o=r/(2*Math.PI*zr)*(256<<20)/2,u=Un(t,r),h=u.gridHash,v=u.gridOffset,m=Kn(h,v,a);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:m}}function Un(e,a){var t=Infinity,n=-Infinity,r,o=Kt(e),u;try{for(o.s();!(u=o.n()).done;){var h=u.value;r=h.coordinates[1],Number.isFinite(r)&&(t=r<t?r:t,n=r>n?r:n)}}catch(be){o.e(be)}finally{o.f()}var v=(t+n)/2,m=Ai(a,v);if(m.xOffset<=0||m.yOffset<=0)return{gridHash:{},gridOffset:m};var b={},A=Kt(e),k;try{for(A.s();!(k=A.n()).done;){var L=k.value,B=L.coordinates[1],Z=L.coordinates[0];if(Number.isFinite(B)&&Number.isFinite(Z)){var V=Math.floor((B+90)/m.yOffset),K=Math.floor((Z+180)/m.xOffset),le="".concat(V,"-").concat(K);b[le]=b[le]||{count:0,points:[]},b[le].count+=1,b[le].points.push(L)}}}catch(be){A.e(be)}finally{A.f()}return{gridHash:b,gridOffset:m}}function Ai(e,a){var t=ei(e),n=Ii(a,e);return{yOffset:t,xOffset:n}}function ei(e){return e/zr*(180/Math.PI)}function Ii(e,a){return a/zr*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Kn(e,a,t){return Object.keys(e).reduce(function(n,r,o){var u=r.split("-"),h=parseInt(u[0],10),v=parseInt(u[1],10),m={};if(t.field&&t.method){var b=Rc(e[r].points,t.field);m[t.method]=Tn[t.method](b)}return Object.assign(m,{_id:o,coordinates:Ao([-180+a.xOffset*(v+.5),-90+a.yOffset*(h+.5)]),rawData:e[r].points,count:e[r].count}),n.push(m),n},[])}var ua=Math.PI/3,qi=[0,ua,2*ua,3*ua,4*ua,5*ua];function mi(e){return e[0]}function La(e){return e[1]}function fa(){var e=0,a=0,t=1,n=1,r=mi,o=La,u,h,v;function m(A){var k={},L=[],B,Z=A.length;for(B=0;B<Z;++B)if(!(isNaN(K=+r.call(null,V=A[B],B,A))||isNaN(le=+o.call(null,V,B,A)))){var V,K,le,be=Math.round(le=le/v),Be=Math.round(K=K/h-(be&1)/2),et=le-be;if(Math.abs(et)*3>1){var at=K-Be,Lt=Be+(K<Be?-1:1)/2,Gt=be+(le<be?-1:1),sr=K-Lt,Tr=le-Gt;at*at+et*et>sr*sr+Tr*Tr&&(Be=Lt+(be&1?1:-1)/2,be=Gt)}var Er=Be+"-"+be,Qr=k[Er];Qr?Qr.push(V):(L.push(Qr=k[Er]=[V]),Qr.x=(Be+(be&1)/2)*h,Qr.y=be*v)}return L}function b(A){var k=0,L=0;return qi.map(function(B){var Z=Math.sin(B)*A,V=-Math.cos(B)*A,K=Z-k,le=V-L;return k=Z,L=V,[K,le]})}return m.hexagon=function(A){return"m"+b(A==null?u:+A).join("l")+"z"},m.centers=function(){for(var A=[],k=Math.round(a/v),L=Math.round(e/h),B=k*v;B<n+u;B+=v,++k)for(var Z=L*h+(k&1)*h/2;Z<t+h/2;Z+=h)A.push([Z,B]);return A},m.mesh=function(){var A=b(u).slice(0,4).join("l");return m.centers().map(function(k){return"M"+k+"m"+A}).join("")},m.x=function(A){return arguments.length?(r=A,m):r},m.y=function(A){return arguments.length?(o=A,m):o},m.radius=function(A){return arguments.length?(u=+A,h=u*2*Math.sin(ua),v=u*1.5,m):u},m.size=function(A){return arguments.length?(e=a=0,t=+A[0],n=+A[1],m):[t-e,n-a]},m.extent=function(A){return arguments.length?(e=+A[0][0],a=+A[0][1],t=+A[1][0],n=+A[1][1],m):[[e,a],[t,n]]},m.radius(1)}var Za=6378e3;function ki(e,a){var t=e.dataArray,n=a.size,r=n===void 0?10:n,o=a.method,u=o===void 0?"sum":o,h=r/(2*Math.PI*Za)*(256<<20)/2,v=t.map(function(k){var L=Ao(k.coordinates),B=(0,Mr.Z)(L,2),Z=B[0],V=B[1];return(0,ae.Z)((0,ae.Z)({},k),{},{coordinates:[Z,V]})}),m=fa().radius(h).x(function(k){return k.coordinates[0]}).y(function(k){return k.coordinates[1]}),b=m(v),A={dataArray:b.map(function(k,L){var B;if(a.field&&u){var Z=Rc(k,a.field);k[u]=Tn[u](Z)}return B={},(0,re.Z)(B,a.method,k[u]),(0,re.Z)(B,"count",k.length),(0,re.Z)(B,"rawData",k),(0,re.Z)(B,"coordinates",[k.x,k.y]),(0,re.Z)(B,"_id",L),B}),radius:h,xOffset:h,yOffset:h,type:"hexagon"};return A}function to(e,a){var t=a.sourceField,n=a.targetField,r=a.data,o={};return r.forEach(function(u){o[u[t]]=u}),e.dataArray=e.dataArray.map(function(u){var h=u[n];return(0,ae.Z)((0,ae.Z)({},u),o[h])}),e}function Xo(e,a){var t=a.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}lt("rasterTile",ht),lt("mvt",yr),lt("geojsonvt",$e),lt("testTile",gt),lt("geojson",wn),lt("image",hr),lt("csv",pr),lt("json",ir),lt("raster",dr),We("cluster",T),We("filter",Bt),We("join",to),We("map",Xo),We("grid",fn),We("hexagon",ki);var Zo=ct,_s=de(28660),Yr=de(86700),xs=de(84879),nr={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},au=de(31745),Yu=de.n(au);function hs(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Bu(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Bu(e,a){if(!!e){if(typeof e=="string")return bs(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return bs(e,a)}}function bs(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Es=30;function Fa(e){var a=e.characterSet,t=e.getFontWidth,n=e.fontHeight,r=e.buffer,o=e.maxCanvasWidth,u=e.mapping,h=u===void 0?{}:u,v=e.xOffset,m=v===void 0?0:v,b=e.yOffset,A=b===void 0?0:b,k=0,L=m;Array.from(a).forEach(function(Z,V){if(!h[Z]){var K=t(Z,V);L+Es>o&&(L=0,k++),h[Z]={x:L,y:A+k*Es,width:Es,height:Es,advance:K},L+=Es}});var B=n+r*2;return{mapping:h,xOffset:L,yOffset:A+k*B,canvasHeight:ja(A+(k+1)*B)}}function To(e,a,t){var n=0,r=0,o=0,u=[],h={},v=hs(e),m;try{for(v.s();!(m=v.n()).done;){var b=m.value;if(!h[b.id]){var A=b.size;n+A+a>t&&(vo(h,u,r),n=0,r=o+r+a,o=0,u=[]),u.push({icon:b,xOffset:n}),n=n+A+a,o=Math.max(o,A)}}}catch(L){v.e(L)}finally{v.f()}u.length>0&&vo(h,u,r);var k=ja(o+r+a);return{mapping:h,canvasHeight:k}}function vo(e,a,t){var n=hs(a),r;try{for(n.s();!(r=n.n()).done;){var o=r.value,u=o.icon,h=o.xOffset;e[u.id]=(0,ae.Z)((0,ae.Z)({},u),{},{x:h,y:t,image:u.image,width:u.width,height:u.height})}}catch(v){n.e(v)}finally{n.f()}}function ja(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var qu,vu;function Oo(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ws(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Ws(e,a){if(!!e){if(typeof e=="string")return mu(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return mu(e,a)}}function mu(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Ga=Dp(),Pl="sans-serif",xc="normal",pl=24,Cs=3,Gc=.25,uf=8,Rp=1024,Op=1,Fp=1,Nh=3,Bd=null;function Dp(){for(var e=[],a=32;a<128;a++)e.push(String.fromCharCode(a));return e}function ap(e,a,t,n){e.font="".concat(n," ").concat(t,"px ").concat(a),e.fillStyle="black",e.textBaseline="middle"}function op(e,a){for(var t=0;t<e.length;t++)a.data[4*t+3]=e[t]}var sp=(qu=(0,Yr.b2)(),qu(vu=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"fontAtlas",void 0),(0,re.Z)(this,"iconFontMap",void 0),(0,re.Z)(this,"iconFontGlyphs",{}),(0,re.Z)(this,"fontOptions",void 0),(0,re.Z)(this,"key",void 0),(0,re.Z)(this,"cache",new c(Nh))}return(0,kt.Z)(e,[{key:"scale",get:function(){return Fp}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Pl,fontWeight:xc,characterSet:Ga,fontSize:pl,buffer:Cs,sdf:!0,cutoff:Gc,radius:uf,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var n=this;t.forEach(function(r){n.iconFontGlyphs[r.name]=r.unicode})}},{key:"addIconFont",value:function(t,n){this.iconFontMap.set(t,n)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,ae.Z)((0,ae.Z)({},this.fontOptions),t),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),r=this.cache.get(this.key);if(!(r&&n.length===0)){var o=this.generateFontAtlas(this.key,n,r);this.fontAtlas=o,this.cache.set(this.key,o)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,n,r){var o=this.fontOptions,u=o.fontFamily,h=o.fontWeight,v=o.fontSize,m=o.buffer,b=o.sdf,A=o.radius,k=o.cutoff,L=o.iconfont,B=r&&r.data;B||(B=Ui.document.createElement("canvas"),B.width=Rp);var Z=B.getContext("2d");ap(Z,u,v,h);var V=Fa((0,ae.Z)({getFontWidth:function(ks){return Z.measureText(ks).width},fontHeight:v*Fp,buffer:m,characterSet:n,maxCanvasWidth:Rp},r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset})),K=V.mapping,le=V.canvasHeight,be=V.xOffset,Be=V.yOffset,et=Z.getImageData(0,0,B.width,B.height);if(B.height=le,Z.putImageData(et,0,0),ap(Z,u,v,h),b){var at=new(Yu())(v,m,A,k,u,h),Lt=Z.getImageData(0,0,at.size,at.size),Gt=Oo(n),sr;try{for(Gt.s();!(sr=Gt.n()).done;){var Tr=sr.value;if(L){var Er=String.fromCharCode(parseInt(Tr.replace("&#x","").replace(";",""),16)),Qr=at.draw(Er);op(Qr,Lt)}else op(at.draw(Tr),Lt);Z.putImageData(Lt,K[Tr].x,K[Tr].y)}}catch(Wa){Gt.e(Wa)}finally{Gt.f()}}else{var On=Oo(n),li;try{for(On.s();!(li=On.n()).done;){var Da=li.value;Z.fillText(Da,K[Da].x,K[Da].y+v*Op)}}catch(Wa){On.e(Wa)}finally{On.f()}}return{xOffset:be,yOffset:Be,mapping:K,data:B,width:B.width,height:B.height}}},{key:"getKey",value:function(){return"key";var t,n,r,o,u,h,v,m}},{key:"getNewChars",value:function(t,n){var r=this.cache.get(t);if(!r)return n;var o=[],u=r.mapping,h=new Set(Object.keys(u)),v=new Set(n);return v.forEach(function(m){h.has(m)||o.push(m)}),o}}]),e}())||vu),cd,Hc;function Nd(e){var a=Bp();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Bp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var up=3,Uf=1024,zh=64,Np=(cd=(0,Yr.b2)(),cd(Hc=function(e){(0,Pr.Z)(t,e);var a=Nd(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"canvasHeight",128),(0,re.Z)((0,bt.Z)(n),"texture",void 0),(0,re.Z)((0,bt.Z)(n),"canvas",void 0),(0,re.Z)((0,bt.Z)(n),"iconData",void 0),(0,re.Z)((0,bt.Z)(n),"iconMap",void 0),(0,re.Z)((0,bt.Z)(n),"ctx",void 0),(0,re.Z)((0,bt.Z)(n),"loadingImageCount",0),n}return(0,kt.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Ui.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(r,o){var u=this,h=new Image;if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:zh}),this.updateIconMap(),this.loadImage(o).then(function(v){h=v;var m=u.iconData.find(function(b){return b.id===r});m&&(m.image=h,m.width=h.width,m.height=h.height),u.update()})}},{key:"addImageMini",value:function(r,o,u){var h=this,v=u.getSceneConfig().canvas,m=v.createImage();if(this.loadingImageCount++,this.hasImage(r))throw new Error("Image Id already exists");this.iconData.push({id:r,size:zh}),this.updateIconMap(),this.loadImageMini(o,v).then(function(b){m=b;var A=h.iconData.find(function(k){return k.id===r});A&&(A.image=m,A.width=m.width,A.height=m.height),h.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(r){return this.iconMap.hasOwnProperty(r)}},{key:"removeImage",value:function(r){this.hasImage(r)&&(this.iconData=this.iconData.filter(function(o){return o.id!==r}),delete this.iconMap[r],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(r){return new Promise(function(o,u){if(r instanceof HTMLImageElement){o(r);return}var h=new Image;h.crossOrigin="anonymous",h.onload=function(){o(h)},h.onerror=function(){u(new Error("Could not load image at "+r))},h.src=r instanceof File?URL.createObjectURL(r):r})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var r=this;this.canvas.width=Uf,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(o){var u=r.iconMap[o],h=u.x,v=u.y,m=u.image,b=u.width,A=b===void 0?64:b,k=u.height,L=k===void 0?64:k,B=Math.max(A,L),Z=B/zh,V=L/Z,K=A/Z;m&&r.ctx.drawImage(m,h+(zh-K)/2,v+(zh-V)/2,K,V)})}},{key:"updateIconMap",value:function(){var r=To(this.iconData,up,Uf),o=r.mapping,u=r.canvasHeight;this.iconMap=o,this.canvasHeight=u}},{key:"loadImageMini",value:function(r,o){return new Promise(function(u,h){var v=o.createImage();v.crossOrigin="anonymous",v.onload=function(){u(v)},v.onerror=function(){h(new Error("Could not load image at "+r))},v.src=r})}}]),t}(Xu.EventEmitter))||Hc),bo=de(49685);function Wc(){var e=new bo.WT(16);return bo.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function fd(e){var a=new bo.WT(16);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function hd(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function lp(e,a,t,n,r,o,u,h,v,m,b,A,k,L,B,Z){var V=new bo.WT(16);return V[0]=e,V[1]=a,V[2]=t,V[3]=n,V[4]=r,V[5]=o,V[6]=u,V[7]=h,V[8]=v,V[9]=m,V[10]=b,V[11]=A,V[12]=k,V[13]=L,V[14]=B,V[15]=Z,V}function pd(e,a,t,n,r,o,u,h,v,m,b,A,k,L,B,Z,V){return e[0]=a,e[1]=t,e[2]=n,e[3]=r,e[4]=o,e[5]=u,e[6]=h,e[7]=v,e[8]=m,e[9]=b,e[10]=A,e[11]=k,e[12]=L,e[13]=B,e[14]=Z,e[15]=V,e}function zp(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function cp(e,a){if(e===a){var t=a[1],n=a[2],r=a[3],o=a[6],u=a[7],h=a[11];e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=t,e[6]=a[9],e[7]=a[13],e[8]=n,e[9]=o,e[11]=a[14],e[12]=r,e[13]=u,e[14]=h}else e[0]=a[0],e[1]=a[4],e[2]=a[8],e[3]=a[12],e[4]=a[1],e[5]=a[5],e[6]=a[9],e[7]=a[13],e[8]=a[2],e[9]=a[6],e[10]=a[10],e[11]=a[14],e[12]=a[3],e[13]=a[7],e[14]=a[11],e[15]=a[15];return e}function Uh(e,a){var t=a[0],n=a[1],r=a[2],o=a[3],u=a[4],h=a[5],v=a[6],m=a[7],b=a[8],A=a[9],k=a[10],L=a[11],B=a[12],Z=a[13],V=a[14],K=a[15],le=t*h-n*u,be=t*v-r*u,Be=t*m-o*u,et=n*v-r*h,at=n*m-o*h,Lt=r*m-o*v,Gt=b*Z-A*B,sr=b*V-k*B,Tr=b*K-L*B,Er=A*V-k*Z,Qr=A*K-L*Z,On=k*K-L*V,li=le*On-be*Qr+Be*Er+et*Tr-at*sr+Lt*Gt;return li?(li=1/li,e[0]=(h*On-v*Qr+m*Er)*li,e[1]=(r*Qr-n*On-o*Er)*li,e[2]=(Z*Lt-V*at+K*et)*li,e[3]=(k*at-A*Lt-L*et)*li,e[4]=(v*Tr-u*On-m*sr)*li,e[5]=(t*On-r*Tr+o*sr)*li,e[6]=(V*Be-B*Lt-K*be)*li,e[7]=(b*Lt-k*Be+L*be)*li,e[8]=(u*Qr-h*Tr+m*Gt)*li,e[9]=(n*Tr-t*Qr-o*Gt)*li,e[10]=(B*at-Z*Be+K*le)*li,e[11]=(A*Be-b*at-L*le)*li,e[12]=(h*sr-u*Er-v*Gt)*li,e[13]=(t*Er-n*sr+r*Gt)*li,e[14]=(Z*be-B*et-V*le)*li,e[15]=(b*et-A*be+k*le)*li,e):null}function fp(e,a){var t=a[0],n=a[1],r=a[2],o=a[3],u=a[4],h=a[5],v=a[6],m=a[7],b=a[8],A=a[9],k=a[10],L=a[11],B=a[12],Z=a[13],V=a[14],K=a[15];return e[0]=h*(k*K-L*V)-A*(v*K-m*V)+Z*(v*L-m*k),e[1]=-(n*(k*K-L*V)-A*(r*K-o*V)+Z*(r*L-o*k)),e[2]=n*(v*K-m*V)-h*(r*K-o*V)+Z*(r*m-o*v),e[3]=-(n*(v*L-m*k)-h*(r*L-o*k)+A*(r*m-o*v)),e[4]=-(u*(k*K-L*V)-b*(v*K-m*V)+B*(v*L-m*k)),e[5]=t*(k*K-L*V)-b*(r*K-o*V)+B*(r*L-o*k),e[6]=-(t*(v*K-m*V)-u*(r*K-o*V)+B*(r*m-o*v)),e[7]=t*(v*L-m*k)-u*(r*L-o*k)+b*(r*m-o*v),e[8]=u*(A*K-L*Z)-b*(h*K-m*Z)+B*(h*L-m*A),e[9]=-(t*(A*K-L*Z)-b*(n*K-o*Z)+B*(n*L-o*A)),e[10]=t*(h*K-m*Z)-u*(n*K-o*Z)+B*(n*m-o*h),e[11]=-(t*(h*L-m*A)-u*(n*L-o*A)+b*(n*m-o*h)),e[12]=-(u*(A*V-k*Z)-b*(h*V-v*Z)+B*(h*k-v*A)),e[13]=t*(A*V-k*Z)-b*(n*V-r*Z)+B*(n*k-r*A),e[14]=-(t*(h*V-v*Z)-u*(n*V-r*Z)+B*(n*v-r*h)),e[15]=t*(h*k-v*A)-u*(n*k-r*A)+b*(n*v-r*h),e}function Up(e){var a=e[0],t=e[1],n=e[2],r=e[3],o=e[4],u=e[5],h=e[6],v=e[7],m=e[8],b=e[9],A=e[10],k=e[11],L=e[12],B=e[13],Z=e[14],V=e[15],K=a*u-t*o,le=a*h-n*o,be=a*v-r*o,Be=t*h-n*u,et=t*v-r*u,at=n*v-r*h,Lt=m*B-b*L,Gt=m*Z-A*L,sr=m*V-k*L,Tr=b*Z-A*B,Er=b*V-k*B,Qr=A*V-k*Z;return K*Qr-le*Er+be*Tr+Be*sr-et*Gt+at*Lt}function wu(e,a,t){var n=a[0],r=a[1],o=a[2],u=a[3],h=a[4],v=a[5],m=a[6],b=a[7],A=a[8],k=a[9],L=a[10],B=a[11],Z=a[12],V=a[13],K=a[14],le=a[15],be=t[0],Be=t[1],et=t[2],at=t[3];return e[0]=be*n+Be*h+et*A+at*Z,e[1]=be*r+Be*v+et*k+at*V,e[2]=be*o+Be*m+et*L+at*K,e[3]=be*u+Be*b+et*B+at*le,be=t[4],Be=t[5],et=t[6],at=t[7],e[4]=be*n+Be*h+et*A+at*Z,e[5]=be*r+Be*v+et*k+at*V,e[6]=be*o+Be*m+et*L+at*K,e[7]=be*u+Be*b+et*B+at*le,be=t[8],Be=t[9],et=t[10],at=t[11],e[8]=be*n+Be*h+et*A+at*Z,e[9]=be*r+Be*v+et*k+at*V,e[10]=be*o+Be*m+et*L+at*K,e[11]=be*u+Be*b+et*B+at*le,be=t[12],Be=t[13],et=t[14],at=t[15],e[12]=be*n+Be*h+et*A+at*Z,e[13]=be*r+Be*v+et*k+at*V,e[14]=be*o+Be*m+et*L+at*K,e[15]=be*u+Be*b+et*B+at*le,e}function mh(e,a,t){var n=t[0],r=t[1],o=t[2],u,h,v,m,b,A,k,L,B,Z,V,K;return a===e?(e[12]=a[0]*n+a[4]*r+a[8]*o+a[12],e[13]=a[1]*n+a[5]*r+a[9]*o+a[13],e[14]=a[2]*n+a[6]*r+a[10]*o+a[14],e[15]=a[3]*n+a[7]*r+a[11]*o+a[15]):(u=a[0],h=a[1],v=a[2],m=a[3],b=a[4],A=a[5],k=a[6],L=a[7],B=a[8],Z=a[9],V=a[10],K=a[11],e[0]=u,e[1]=h,e[2]=v,e[3]=m,e[4]=b,e[5]=A,e[6]=k,e[7]=L,e[8]=B,e[9]=Z,e[10]=V,e[11]=K,e[12]=u*n+b*r+B*o+a[12],e[13]=h*n+A*r+Z*o+a[13],e[14]=v*n+k*r+V*o+a[14],e[15]=m*n+L*r+K*o+a[15]),e}function gh(e,a,t){var n=t[0],r=t[1],o=t[2];return e[0]=a[0]*n,e[1]=a[1]*n,e[2]=a[2]*n,e[3]=a[3]*n,e[4]=a[4]*r,e[5]=a[5]*r,e[6]=a[6]*r,e[7]=a[7]*r,e[8]=a[8]*o,e[9]=a[9]*o,e[10]=a[10]*o,e[11]=a[11]*o,e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e}function dd(e,a,t,n){var r=n[0],o=n[1],u=n[2],h=Math.hypot(r,o,u),v,m,b,A,k,L,B,Z,V,K,le,be,Be,et,at,Lt,Gt,sr,Tr,Er,Qr,On,li,Da;return h<bo.Ib?null:(h=1/h,r*=h,o*=h,u*=h,v=Math.sin(t),m=Math.cos(t),b=1-m,A=a[0],k=a[1],L=a[2],B=a[3],Z=a[4],V=a[5],K=a[6],le=a[7],be=a[8],Be=a[9],et=a[10],at=a[11],Lt=r*r*b+m,Gt=o*r*b+u*v,sr=u*r*b-o*v,Tr=r*o*b-u*v,Er=o*o*b+m,Qr=u*o*b+r*v,On=r*u*b+o*v,li=o*u*b-r*v,Da=u*u*b+m,e[0]=A*Lt+Z*Gt+be*sr,e[1]=k*Lt+V*Gt+Be*sr,e[2]=L*Lt+K*Gt+et*sr,e[3]=B*Lt+le*Gt+at*sr,e[4]=A*Tr+Z*Er+be*Qr,e[5]=k*Tr+V*Er+Be*Qr,e[6]=L*Tr+K*Er+et*Qr,e[7]=B*Tr+le*Er+at*Qr,e[8]=A*On+Z*li+be*Da,e[9]=k*On+V*li+Be*Da,e[10]=L*On+K*li+et*Da,e[11]=B*On+le*li+at*Da,a!==e&&(e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e)}function vd(e,a,t){var n=Math.sin(t),r=Math.cos(t),o=a[4],u=a[5],h=a[6],v=a[7],m=a[8],b=a[9],A=a[10],k=a[11];return a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[4]=o*r+m*n,e[5]=u*r+b*n,e[6]=h*r+A*n,e[7]=v*r+k*n,e[8]=m*r-o*n,e[9]=b*r-u*n,e[10]=A*r-h*n,e[11]=k*r-v*n,e}function md(e,a,t){var n=Math.sin(t),r=Math.cos(t),o=a[0],u=a[1],h=a[2],v=a[3],m=a[8],b=a[9],A=a[10],k=a[11];return a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*r-m*n,e[1]=u*r-b*n,e[2]=h*r-A*n,e[3]=v*r-k*n,e[8]=o*n+m*r,e[9]=u*n+b*r,e[10]=h*n+A*r,e[11]=v*n+k*r,e}function zd(e,a,t){var n=Math.sin(t),r=Math.cos(t),o=a[0],u=a[1],h=a[2],v=a[3],m=a[4],b=a[5],A=a[6],k=a[7];return a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]),e[0]=o*r+m*n,e[1]=u*r+b*n,e[2]=h*r+A*n,e[3]=v*r+k*n,e[4]=m*r-o*n,e[5]=b*r-u*n,e[6]=A*r-h*n,e[7]=k*r-v*n,e}function Zp(e,a){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=a[0],e[13]=a[1],e[14]=a[2],e[15]=1,e}function a0(e,a){return e[0]=a[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=a[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gd(e,a,t){var n=t[0],r=t[1],o=t[2],u=Math.hypot(n,r,o),h,v,m;return u<bo.Ib?null:(u=1/u,n*=u,r*=u,o*=u,h=Math.sin(a),v=Math.cos(a),m=1-v,e[0]=n*n*m+v,e[1]=r*n*m+o*h,e[2]=o*n*m-r*h,e[3]=0,e[4]=n*r*m-o*h,e[5]=r*r*m+v,e[6]=o*r*m+n*h,e[7]=0,e[8]=n*o*m+r*h,e[9]=r*o*m-n*h,e[10]=o*o*m+v,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Ss(e,a){var t=Math.sin(a),n=Math.cos(a);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Zf(e,a){var t=Math.sin(a),n=Math.cos(a);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Vv(e,a){var t=Math.sin(a),n=Math.cos(a);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Zh(e,a,t){var n=a[0],r=a[1],o=a[2],u=a[3],h=n+n,v=r+r,m=o+o,b=n*h,A=n*v,k=n*m,L=r*v,B=r*m,Z=o*m,V=u*h,K=u*v,le=u*m;return e[0]=1-(L+Z),e[1]=A+le,e[2]=k-K,e[3]=0,e[4]=A-le,e[5]=1-(b+Z),e[6]=B+V,e[7]=0,e[8]=k+K,e[9]=B-V,e[10]=1-(b+L),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function D0(e,a){var t=new bo.WT(3),n=-a[0],r=-a[1],o=-a[2],u=a[3],h=a[4],v=a[5],m=a[6],b=a[7],A=n*n+r*r+o*o+u*u;return A>0?(t[0]=(h*u+b*n+v*o-m*r)*2/A,t[1]=(v*u+b*r+m*n-h*o)*2/A,t[2]=(m*u+b*o+h*r-v*n)*2/A):(t[0]=(h*u+b*n+v*o-m*r)*2,t[1]=(v*u+b*r+m*n-h*o)*2,t[2]=(m*u+b*o+h*r-v*n)*2),Zh(e,a,t),e}function B0(e,a){return e[0]=a[12],e[1]=a[13],e[2]=a[14],e}function yh(e,a){var t=a[0],n=a[1],r=a[2],o=a[4],u=a[5],h=a[6],v=a[8],m=a[9],b=a[10];return e[0]=Math.hypot(t,n,r),e[1]=Math.hypot(o,u,h),e[2]=Math.hypot(v,m,b),e}function bc(e,a){var t=new bo.WT(3);yh(t,a);var n=1/t[0],r=1/t[1],o=1/t[2],u=a[0]*n,h=a[1]*r,v=a[2]*o,m=a[4]*n,b=a[5]*r,A=a[6]*o,k=a[8]*n,L=a[9]*r,B=a[10]*o,Z=u+b+B,V=0;return Z>0?(V=Math.sqrt(Z+1)*2,e[3]=.25*V,e[0]=(A-L)/V,e[1]=(k-v)/V,e[2]=(h-m)/V):u>b&&u>B?(V=Math.sqrt(1+u-b-B)*2,e[3]=(A-L)/V,e[0]=.25*V,e[1]=(h+m)/V,e[2]=(k+v)/V):b>B?(V=Math.sqrt(1+b-u-B)*2,e[3]=(k-v)/V,e[0]=(h+m)/V,e[1]=.25*V,e[2]=(A+L)/V):(V=Math.sqrt(1+B-u-b)*2,e[3]=(h-m)/V,e[0]=(k+v)/V,e[1]=(A+L)/V,e[2]=.25*V),e}function o0(e,a,t,n){var r=a[0],o=a[1],u=a[2],h=a[3],v=r+r,m=o+o,b=u+u,A=r*v,k=r*m,L=r*b,B=o*m,Z=o*b,V=u*b,K=h*v,le=h*m,be=h*b,Be=n[0],et=n[1],at=n[2];return e[0]=(1-(B+V))*Be,e[1]=(k+be)*Be,e[2]=(L-le)*Be,e[3]=0,e[4]=(k-be)*et,e[5]=(1-(A+V))*et,e[6]=(Z+K)*et,e[7]=0,e[8]=(L+le)*at,e[9]=(Z-K)*at,e[10]=(1-(A+B))*at,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Ud(e,a,t,n,r){var o=a[0],u=a[1],h=a[2],v=a[3],m=o+o,b=u+u,A=h+h,k=o*m,L=o*b,B=o*A,Z=u*b,V=u*A,K=h*A,le=v*m,be=v*b,Be=v*A,et=n[0],at=n[1],Lt=n[2],Gt=r[0],sr=r[1],Tr=r[2],Er=(1-(Z+K))*et,Qr=(L+Be)*et,On=(B-be)*et,li=(L-Be)*at,Da=(1-(k+K))*at,Wa=(V+le)*at,ks=(B+be)*Lt,Tu=(V-le)*Lt,gu=(1-(k+Z))*Lt;return e[0]=Er,e[1]=Qr,e[2]=On,e[3]=0,e[4]=li,e[5]=Da,e[6]=Wa,e[7]=0,e[8]=ks,e[9]=Tu,e[10]=gu,e[11]=0,e[12]=t[0]+Gt-(Er*Gt+li*sr+ks*Tr),e[13]=t[1]+sr-(Qr*Gt+Da*sr+Tu*Tr),e[14]=t[2]+Tr-(On*Gt+Wa*sr+gu*Tr),e[15]=1,e}function s0(e,a){var t=a[0],n=a[1],r=a[2],o=a[3],u=t+t,h=n+n,v=r+r,m=t*u,b=n*u,A=n*h,k=r*u,L=r*h,B=r*v,Z=o*u,V=o*h,K=o*v;return e[0]=1-A-B,e[1]=b+K,e[2]=k-V,e[3]=0,e[4]=b-K,e[5]=1-m-B,e[6]=L+Z,e[7]=0,e[8]=k+V,e[9]=L-Z,e[10]=1-m-A,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u0(e,a,t,n,r,o,u){var h=1/(t-a),v=1/(r-n),m=1/(o-u);return e[0]=o*2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o*2*v,e[6]=0,e[7]=0,e[8]=(t+a)*h,e[9]=(r+n)*v,e[10]=(u+o)*m,e[11]=-1,e[12]=0,e[13]=0,e[14]=u*o*2*m,e[15]=0,e}function l0(e,a,t,n,r){var o=1/Math.tan(a/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(n-r),e[10]=(r+n)*u,e[14]=2*r*n*u):(e[10]=-1,e[14]=-2*n),e}var N0=l0;function Zd(e,a,t,n,r){var o=1/Math.tan(a/2),u;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==Infinity?(u=1/(n-r),e[10]=r*u,e[14]=r*n*u):(e[10]=-1,e[14]=-n),e}function yd(e,a,t,n){var r=Math.tan(a.upDegrees*Math.PI/180),o=Math.tan(a.downDegrees*Math.PI/180),u=Math.tan(a.leftDegrees*Math.PI/180),h=Math.tan(a.rightDegrees*Math.PI/180),v=2/(u+h),m=2/(r+o);return e[0]=v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=m,e[6]=0,e[7]=0,e[8]=-((u-h)*v*.5),e[9]=(r-o)*m*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function Vd(e,a,t,n,r,o,u){var h=1/(a-t),v=1/(n-r),m=1/(o-u);return e[0]=-2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*v,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*m,e[11]=0,e[12]=(a+t)*h,e[13]=(r+n)*v,e[14]=(u+o)*m,e[15]=1,e}var c0=Vd;function Ll(e,a,t,n,r,o,u){var h=1/(a-t),v=1/(n-r),m=1/(o-u);return e[0]=-2*h,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*v,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=m,e[11]=0,e[12]=(a+t)*h,e[13]=(r+n)*v,e[14]=o*m,e[15]=1,e}function z0(e,a,t,n){var r,o,u,h,v,m,b,A,k,L,B=a[0],Z=a[1],V=a[2],K=n[0],le=n[1],be=n[2],Be=t[0],et=t[1],at=t[2];return Math.abs(B-Be)<bo.Ib&&Math.abs(Z-et)<bo.Ib&&Math.abs(V-at)<bo.Ib?zp(e):(b=B-Be,A=Z-et,k=V-at,L=1/Math.hypot(b,A,k),b*=L,A*=L,k*=L,r=le*k-be*A,o=be*b-K*k,u=K*A-le*b,L=Math.hypot(r,o,u),L?(L=1/L,r*=L,o*=L,u*=L):(r=0,o=0,u=0),h=A*u-k*o,v=k*r-b*u,m=b*o-A*r,L=Math.hypot(h,v,m),L?(L=1/L,h*=L,v*=L,m*=L):(h=0,v=0,m=0),e[0]=r,e[1]=h,e[2]=b,e[3]=0,e[4]=o,e[5]=v,e[6]=A,e[7]=0,e[8]=u,e[9]=m,e[10]=k,e[11]=0,e[12]=-(r*B+o*Z+u*V),e[13]=-(h*B+v*Z+m*V),e[14]=-(b*B+A*Z+k*V),e[15]=1,e)}function Ec(e,a,t,n){var r=a[0],o=a[1],u=a[2],h=n[0],v=n[1],m=n[2],b=r-t[0],A=o-t[1],k=u-t[2],L=b*b+A*A+k*k;L>0&&(L=1/Math.sqrt(L),b*=L,A*=L,k*=L);var B=v*k-m*A,Z=m*b-h*k,V=h*A-v*b;return L=B*B+Z*Z+V*V,L>0&&(L=1/Math.sqrt(L),B*=L,Z*=L,V*=L),e[0]=B,e[1]=Z,e[2]=V,e[3]=0,e[4]=A*V-k*Z,e[5]=k*B-b*V,e[6]=b*Z-A*B,e[7]=0,e[8]=b,e[9]=A,e[10]=k,e[11]=0,e[12]=r,e[13]=o,e[14]=u,e[15]=1,e}function f0(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function dv(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function lf(e,a,t){return e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e[3]=a[3]+t[3],e[4]=a[4]+t[4],e[5]=a[5]+t[5],e[6]=a[6]+t[6],e[7]=a[7]+t[7],e[8]=a[8]+t[8],e[9]=a[9]+t[9],e[10]=a[10]+t[10],e[11]=a[11]+t[11],e[12]=a[12]+t[12],e[13]=a[13]+t[13],e[14]=a[14]+t[14],e[15]=a[15]+t[15],e}function Cc(e,a,t){return e[0]=a[0]-t[0],e[1]=a[1]-t[1],e[2]=a[2]-t[2],e[3]=a[3]-t[3],e[4]=a[4]-t[4],e[5]=a[5]-t[5],e[6]=a[6]-t[6],e[7]=a[7]-t[7],e[8]=a[8]-t[8],e[9]=a[9]-t[9],e[10]=a[10]-t[10],e[11]=a[11]-t[11],e[12]=a[12]-t[12],e[13]=a[13]-t[13],e[14]=a[14]-t[14],e[15]=a[15]-t[15],e}function vv(e,a,t){return e[0]=a[0]*t,e[1]=a[1]*t,e[2]=a[2]*t,e[3]=a[3]*t,e[4]=a[4]*t,e[5]=a[5]*t,e[6]=a[6]*t,e[7]=a[7]*t,e[8]=a[8]*t,e[9]=a[9]*t,e[10]=a[10]*t,e[11]=a[11]*t,e[12]=a[12]*t,e[13]=a[13]*t,e[14]=a[14]*t,e[15]=a[15]*t,e}function hp(e,a,t,n){return e[0]=a[0]+t[0]*n,e[1]=a[1]+t[1]*n,e[2]=a[2]+t[2]*n,e[3]=a[3]+t[3]*n,e[4]=a[4]+t[4]*n,e[5]=a[5]+t[5]*n,e[6]=a[6]+t[6]*n,e[7]=a[7]+t[7]*n,e[8]=a[8]+t[8]*n,e[9]=a[9]+t[9]*n,e[10]=a[10]+t[10]*n,e[11]=a[11]+t[11]*n,e[12]=a[12]+t[12]*n,e[13]=a[13]+t[13]*n,e[14]=a[14]+t[14]*n,e[15]=a[15]+t[15]*n,e}function Vp(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]&&e[4]===a[4]&&e[5]===a[5]&&e[6]===a[6]&&e[7]===a[7]&&e[8]===a[8]&&e[9]===a[9]&&e[10]===a[10]&&e[11]===a[11]&&e[12]===a[12]&&e[13]===a[13]&&e[14]===a[14]&&e[15]===a[15]}function _h(e,a){var t=e[0],n=e[1],r=e[2],o=e[3],u=e[4],h=e[5],v=e[6],m=e[7],b=e[8],A=e[9],k=e[10],L=e[11],B=e[12],Z=e[13],V=e[14],K=e[15],le=a[0],be=a[1],Be=a[2],et=a[3],at=a[4],Lt=a[5],Gt=a[6],sr=a[7],Tr=a[8],Er=a[9],Qr=a[10],On=a[11],li=a[12],Da=a[13],Wa=a[14],ks=a[15];return Math.abs(t-le)<=bo.Ib*Math.max(1,Math.abs(t),Math.abs(le))&&Math.abs(n-be)<=bo.Ib*Math.max(1,Math.abs(n),Math.abs(be))&&Math.abs(r-Be)<=bo.Ib*Math.max(1,Math.abs(r),Math.abs(Be))&&Math.abs(o-et)<=bo.Ib*Math.max(1,Math.abs(o),Math.abs(et))&&Math.abs(u-at)<=bo.Ib*Math.max(1,Math.abs(u),Math.abs(at))&&Math.abs(h-Lt)<=bo.Ib*Math.max(1,Math.abs(h),Math.abs(Lt))&&Math.abs(v-Gt)<=bo.Ib*Math.max(1,Math.abs(v),Math.abs(Gt))&&Math.abs(m-sr)<=bo.Ib*Math.max(1,Math.abs(m),Math.abs(sr))&&Math.abs(b-Tr)<=bo.Ib*Math.max(1,Math.abs(b),Math.abs(Tr))&&Math.abs(A-Er)<=bo.Ib*Math.max(1,Math.abs(A),Math.abs(Er))&&Math.abs(k-Qr)<=bo.Ib*Math.max(1,Math.abs(k),Math.abs(Qr))&&Math.abs(L-On)<=bo.Ib*Math.max(1,Math.abs(L),Math.abs(On))&&Math.abs(B-li)<=bo.Ib*Math.max(1,Math.abs(B),Math.abs(li))&&Math.abs(Z-Da)<=bo.Ib*Math.max(1,Math.abs(Z),Math.abs(Da))&&Math.abs(V-Wa)<=bo.Ib*Math.max(1,Math.abs(V),Math.abs(Wa))&&Math.abs(K-ks)<=bo.Ib*Math.max(1,Math.abs(K),Math.abs(ks))}var _d=wu,xd=Cc,U0,Z0,h0=(U0=(0,Yr.b2)(),U0(Z0=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"viewport",void 0),(0,re.Z)(this,"overridedViewProjectionMatrix",void 0),(0,re.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,re.Z)(this,"jitteredProjectionMatrix",void 0),(0,re.Z)(this,"viewMatrixInverse",void 0),(0,re.Z)(this,"cameraPosition",void 0)}return(0,kt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=Wc(),Uh(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,Mr.Z)(t,2),r=n[0],o=n[1];return[r,o]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var r=Zp(Wc(),[t,n,0]);this.jitteredProjectionMatrix=wu(Wc(),r,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=wu(Wc(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Z0),p0,d0;function cf(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Vh(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Vh(e,a){if(!!e){if(typeof e=="string")return V0(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return V0(e,a)}}function V0(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var v0=(p0=(0,Yr.b2)(),p0(d0=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"container",void 0),(0,re.Z)(this,"controlCorners",void 0),(0,re.Z)(this,"controlContainer",void 0),(0,re.Z)(this,"scene",void 0),(0,re.Z)(this,"mapsService",void 0),(0,re.Z)(this,"controls",[]),(0,re.Z)(this,"unAddControls",[])}return(0,kt.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(nr.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var r=n.get(nr.IMapService);r.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=cf(this.controls),n;try{for(t.s();!(n=t.n()).done;){var r=n.value;r.remove()}}catch(o){t.e(o)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",r=this.controlContainer=Mo("div",n+"control-container",this.container);function o(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],h=u.map(function(v){return n+v}).join(" ");t[u.join("")]=Mo("div",h,r)}o(["top","left"]),o(["top","right"]),o(["bottom","left"]),o(["bottom","right"]),o(["top","center"]),o(["right","center"]),o(["left","center"]),o(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Iu(this.controlCorners[t]);this.controlContainer&&Iu(this.controlContainer)}}]),e}())||d0),bd,j0,G0=(bd=(0,Yr.b2)(),bd(j0=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"container",void 0),(0,re.Z)(this,"scene",void 0),(0,re.Z)(this,"mapsService",void 0),(0,re.Z)(this,"markers",[]),(0,re.Z)(this,"markerLayers",[]),(0,re.Z)(this,"unAddMarkers",[]),(0,re.Z)(this,"unAddMarkerLayers",[])}return(0,kt.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(nr.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||j0),jd,Gd,Hd=(jd=(0,Yr.b2)(),jd(Gd=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"scene",void 0),(0,re.Z)(this,"popup",void 0),(0,re.Z)(this,"mapsService",void 0),(0,re.Z)(this,"unAddPopup",void 0)}return(0,kt.Z)(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(nr.IMapService)}}]),e}())||Gd),m0={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},jp=m0,H0,pp,mv={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},dp={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Wd=(H0=(0,Yr.b2)(),H0(pp=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"sceneConfigCache",{}),(0,re.Z)(this,"layerConfigCache",{})}return(0,kt.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return jp[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,ae.Z)((0,ae.Z)({},mv),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,r){this.layerConfigCache[n]=(0,ae.Z)({},(0,d.merge)({},this.sceneConfigCache[t],dp,r))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||pp);function ka(e,a,t,n){!t||Object.defineProperty(e,a,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Aa(e,a,t,n,r){var o={};return Object.keys(n).forEach(function(u){o[u]=n[u]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=t.slice().reverse().reduce(function(u,h){return h(e,a,u)||u},o),r&&o.initializer!==void 0&&(o.value=o.initializer?o.initializer.call(r):void 0,o.initializer=void 0),o.initializer===void 0&&(Object.defineProperty(e,a,o),o=null),o}function gv(){var e=new bo.WT(4);return bo.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Im(e){var a=new glMatrix.ARRAY_TYPE(4);return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a}function jv(e,a,t,n){var r=new bo.WT(4);return r[0]=e,r[1]=a,r[2]=t,r[3]=n,r}function km(e,a){return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e}function Pm(e,a,t,n,r){return e[0]=a,e[1]=t,e[2]=n,e[3]=r,e}function Vf(e,a,t){return e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e[3]=a[3]+t[3],e}function W0(e,a,t){return e[0]=a[0]-t[0],e[1]=a[1]-t[1],e[2]=a[2]-t[2],e[3]=a[3]-t[3],e}function Ed(e,a,t){return e[0]=a[0]*t[0],e[1]=a[1]*t[1],e[2]=a[2]*t[2],e[3]=a[3]*t[3],e}function g0(e,a,t){return e[0]=a[0]/t[0],e[1]=a[1]/t[1],e[2]=a[2]/t[2],e[3]=a[3]/t[3],e}function Js(e,a){return e[0]=Math.ceil(a[0]),e[1]=Math.ceil(a[1]),e[2]=Math.ceil(a[2]),e[3]=Math.ceil(a[3]),e}function Gv(e,a){return e[0]=Math.floor(a[0]),e[1]=Math.floor(a[1]),e[2]=Math.floor(a[2]),e[3]=Math.floor(a[3]),e}function Ig(e,a,t){return e[0]=Math.min(a[0],t[0]),e[1]=Math.min(a[1],t[1]),e[2]=Math.min(a[2],t[2]),e[3]=Math.min(a[3],t[3]),e}function Hv(e,a,t){return e[0]=Math.max(a[0],t[0]),e[1]=Math.max(a[1],t[1]),e[2]=Math.max(a[2],t[2]),e[3]=Math.max(a[3],t[3]),e}function Wv(e,a){return e[0]=Math.round(a[0]),e[1]=Math.round(a[1]),e[2]=Math.round(a[2]),e[3]=Math.round(a[3]),e}function X0(e,a,t){return e[0]=a[0]*t,e[1]=a[1]*t,e[2]=a[2]*t,e[3]=a[3]*t,e}function kg(e,a,t,n){return e[0]=a[0]+t[0]*n,e[1]=a[1]+t[1]*n,e[2]=a[2]+t[2]*n,e[3]=a[3]+t[3]*n,e}function Pg(e,a){var t=a[0]-e[0],n=a[1]-e[1],r=a[2]-e[2],o=a[3]-e[3];return Math.hypot(t,n,r,o)}function yv(e,a){var t=a[0]-e[0],n=a[1]-e[1],r=a[2]-e[2],o=a[3]-e[3];return t*t+n*n+r*r+o*o}function Lm(e){var a=e[0],t=e[1],n=e[2],r=e[3];return Math.hypot(a,t,n,r)}function Rm(e){var a=e[0],t=e[1],n=e[2],r=e[3];return a*a+t*t+n*n+r*r}function Lg(e,a){return e[0]=-a[0],e[1]=-a[1],e[2]=-a[2],e[3]=-a[3],e}function Rg(e,a){return e[0]=1/a[0],e[1]=1/a[1],e[2]=1/a[2],e[3]=1/a[3],e}function Xv(e,a){var t=a[0],n=a[1],r=a[2],o=a[3],u=t*t+n*n+r*r+o*o;return u>0&&(u=1/Math.sqrt(u)),e[0]=t*u,e[1]=n*u,e[2]=r*u,e[3]=o*u,e}function Vy(e,a){return e[0]*a[0]+e[1]*a[1]+e[2]*a[2]+e[3]*a[3]}function jy(e,a,t,n){var r=t[0]*n[1]-t[1]*n[0],o=t[0]*n[2]-t[2]*n[0],u=t[0]*n[3]-t[3]*n[0],h=t[1]*n[2]-t[2]*n[1],v=t[1]*n[3]-t[3]*n[1],m=t[2]*n[3]-t[3]*n[2],b=a[0],A=a[1],k=a[2],L=a[3];return e[0]=A*m-k*v+L*h,e[1]=-(b*m)+k*u-L*o,e[2]=b*v-A*u+L*r,e[3]=-(b*h)+A*o-k*r,e}function Om(e,a,t,n){var r=a[0],o=a[1],u=a[2],h=a[3];return e[0]=r+n*(t[0]-r),e[1]=o+n*(t[1]-o),e[2]=u+n*(t[2]-u),e[3]=h+n*(t[3]-h),e}function Gy(e,a){a=a||1;var t,n,r,o,u,h;do t=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,u=t*t+n*n;while(u>=1);do r=glMatrix.RANDOM()*2-1,o=glMatrix.RANDOM()*2-1,h=r*r+o*o;while(h>=1);var v=Math.sqrt((1-u)/h);return e[0]=a*t,e[1]=a*n,e[2]=a*r*v,e[3]=a*o*v,e}function Yv(e,a,t){var n=a[0],r=a[1],o=a[2],u=a[3];return e[0]=t[0]*n+t[4]*r+t[8]*o+t[12]*u,e[1]=t[1]*n+t[5]*r+t[9]*o+t[13]*u,e[2]=t[2]*n+t[6]*r+t[10]*o+t[14]*u,e[3]=t[3]*n+t[7]*r+t[11]*o+t[15]*u,e}function Hy(e,a,t){var n=a[0],r=a[1],o=a[2],u=t[0],h=t[1],v=t[2],m=t[3],b=m*n+h*o-v*r,A=m*r+v*n-u*o,k=m*o+u*r-h*n,L=-u*n-h*r-v*o;return e[0]=b*m+L*-u+A*-v-k*-h,e[1]=A*m+L*-h+k*-u-b*-v,e[2]=k*m+L*-v+b*-h-A*-u,e[3]=a[3],e}function Wy(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Xy(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Xd(e,a){return e[0]===a[0]&&e[1]===a[1]&&e[2]===a[2]&&e[3]===a[3]}function Fm(e,a){var t=e[0],n=e[1],r=e[2],o=e[3],u=a[0],h=a[1],v=a[2],m=a[3];return Math.abs(t-u)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(u))&&Math.abs(n-h)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(o-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))}var Yy=null,qy=null,qv=null,$y=null,Ky=null,$v=null,Y0=null,Og=function(){var e=gv();return function(a,t,n,r,o,u){var h,v;for(t||(t=4),n||(n=0),r?v=Math.min(r*t+n,a.length):v=a.length,h=n;h<v;h+=t)e[0]=a[h],e[1]=a[h+1],e[2]=a[h+2],e[3]=a[h+3],o(e,e,u),a[h]=e[0],a[h+1]=e[1],a[h+2]=e[2],a[h+3]=e[3];return a}}(),q0=Math.PI/180,Fg=512,Dm=4003e4;function Kv(e){var a=e.latitude,t=a===void 0?0:a,n=e.zoom,r=n===void 0?0:n,o=e.scale,u=e.highPrecision,h=u===void 0?!1:u,v=e.flipY,m=v===void 0?!1:v;o=o!==void 0?o:Math.pow(2,r);var b={},A=Fg*o,k=Math.cos(t*q0),L=A/360,B=L/k,Z=A/Dm/k;if(b.pixelsPerMeter=[Z,-Z,Z],b.metersPerPixel=[1/Z,-1/Z,1/Z],b.pixelsPerDegree=[L,-B,Z],b.degreesPerPixel=[1/L,-1/B,1/Z],h){var V=q0*Math.tan(t*q0)/k,K=L*V/2,le=A/Dm*V,be=le/B*Z;b.pixelsPerDegree2=[0,-K,le],b.pixelsPerMeter2=[be,0,be],m&&(b.pixelsPerDegree2[1]=-b.pixelsPerDegree2[1],b.pixelsPerMeter2[1]=-b.pixelsPerMeter2[1])}return m&&(b.pixelsPerMeter[1]=-b.pixelsPerMeter[1],b.metersPerPixel[1]=-b.metersPerPixel[1],b.pixelsPerDegree[1]=-b.pixelsPerDegree[1],b.degreesPerPixel[1]=-b.degreesPerPixel[1]),b}var Gp;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Gp||(Gp={}));var Hp={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Qv,y0,Yd,Cd,_v,Bm=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Dg=(Qv=(0,Yr.b2)(),y0=(0,Yr.f3)(nr.ICameraService),Qv(Yd=(Cd=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"needRefresh",!0),ka(this,"cameraService",_v,this),(0,re.Z)(this,"coordinateSystem",void 0),(0,re.Z)(this,"viewportCenter",void 0),(0,re.Z)(this,"viewportCenterProjection",void 0),(0,re.Z)(this,"pixelsPerDegree",void 0),(0,re.Z)(this,"pixelsPerDegree2",void 0),(0,re.Z)(this,"pixelsPerMeter",void 0)}return(0,kt.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),r=this.cameraService.getZoomScale(),o=t||this.cameraService.getCenter(),u=Kv({latitude:o[1],zoom:n}),h=u.pixelsPerMeter,v=u.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=h,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Gp.LNGLAT||this.coordinateSystem===Gp.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Gp.LNGLAT_OFFSET?this.calculateLnglatOffset(o,n):this.coordinateSystem===Gp.P20_OFFSET&&this.calculateLnglatOffset(o,n,r,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,r,o){var u=Kv({latitude:t[1],zoom:n,scale:r,flipY:o,highPrecision:!0}),h=u.pixelsPerMeter,v=u.pixelsPerDegree,m=u.pixelsPerDegree2,b=this.cameraService.getViewMatrix(),A=this.cameraService.getProjectionMatrix(),k=wu([],A,b),L=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=Yv([],[L[0],L[1],0,1],k),b=this.cameraService.getViewMatrixUncentered()||b,k=wu([],A,b),k=wu([],k,Bm),this.cameraService.setViewProjectionMatrix(k),this.pixelsPerMeter=h,this.pixelsPerDegree=v,this.pixelsPerDegree2=m}}]),e}(),_v=Aa(Cd.prototype,"cameraService",[y0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd))||Yd),Jv=de(20396),xh=de.n(Jv),Rl;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Rl||(Rl={}));var Nm,zm,em,tm,rm;function Bg(e){var a=Ng();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Ng(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nm={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},$u=(Nm=(0,Yr.b2)(),zm=(0,Yr.f3)(nr.IMapService),Nm(em=(tm=function(e){(0,Pr.Z)(t,e);var a=Bg(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"indragging",!1),ka((0,bt.Z)(n),"mapService",rm,(0,bt.Z)(n)),(0,re.Z)((0,bt.Z)(n),"hammertime",void 0),(0,re.Z)((0,bt.Z)(n),"lastClickTime",0),(0,re.Z)((0,bt.Z)(n),"lastClickXY",[-1,-1]),(0,re.Z)((0,bt.Z)(n),"clickTimer",void 0),(0,re.Z)((0,bt.Z)(n),"$containter",void 0),(0,re.Z)((0,bt.Z)(n),"onDrag",function(h){var v=n.interactionEvent(h);v.type=nm[v.type],v.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Rl.Drag,v)}),(0,re.Z)((0,bt.Z)(n),"onHammer",function(h){h.srcEvent.stopPropagation();var v=n.interactionEvent(h);n.emit(Rl.Hover,v)}),(0,re.Z)((0,bt.Z)(n),"onTouch",function(h){var v=h.touches[0];n.onHover({x:v.pageX,y:v.pageY,type:"touch"})}),(0,re.Z)((0,bt.Z)(n),"onHover",function(h){var v=h.clientX,m=h.clientY,b=v,A=m,k=h.type,L=n.mapService.getMapContainer();if(L)if(Eu)b=b-L.left-0,A=A-L.top-0;else{var B=L.getBoundingClientRect(),Z=B.top,V=B.left;b=b-V-L.clientLeft,A=A-Z-L.clientTop}var K=n.mapService.containerToLngLat([b,A]);if(k==="click"){if(!Eu&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(b,A,K);return}if(k==="touch"){n.isDoubleTap(b,A,K);return}k!=="click"&&k!=="dblclick"&&n.emit(Rl.Hover,{x:b,y:A,lngLat:K,type:k,target:h})}),n}return(0,kt.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Rl.Hover)}},{key:"triggerHover",value:function(r){var o=r.x,u=r.y;this.emit(Rl.Hover,{x:o,y:u})}},{key:"triggerSelect",value:function(r){this.emit(Rl.Select,{featureId:r})}},{key:"triggerActive",value:function(r){this.emit(Rl.Active,{featureId:r})}},{key:"handleMiniEvent",value:function(r){this.onHover({clientX:r.touches[0].pageX,clientY:r.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var r=this.mapService.getMapContainer();if(r)if(Eu)Ui.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=new(xh()).Manager(r);o.add(new(xh()).Tap({event:"dblclick",taps:2})),o.add(new(xh()).Tap({event:"click"})),o.add(new(xh()).Pan({threshold:0,pointers:0})),o.add(new(xh()).Press({})),o.on("dblclick click",this.onHammer),o.on("panstart panmove panend pancancel",this.onDrag),r.addEventListener("mousemove",this.onHover),r.addEventListener("mousedown",this.onHover,!0),r.addEventListener("mouseup",this.onHover),r.addEventListener("contextmenu",this.onHover),this.hammertime=o}}},{key:"removeEventListenerOnMap",value:function(){if(Eu)Ui.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var r=this.mapService.getMapContainer();r&&(r.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),r.removeEventListener("mousedown",this.onHover),r.removeEventListener("mouseup",this.onHover),r.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(r){var o=r.type,u=r.pointerType,h,v;u==="touch"?(v=Math.floor(r.pointers[0].clientY),h=Math.floor(r.pointers[0].clientX)):(v=Math.floor(r.srcEvent.y),h=Math.floor(r.srcEvent.x));var m=this.mapService.getMapContainer();if(m){var b=m.getBoundingClientRect(),A=b.top,k=b.left;h-=k,v-=A}var L=this.mapService.containerToLngLat([h,v]);return{x:h,y:v,lngLat:L,type:o,target:r.srcEvent}}},{key:"isDoubleTap",value:function(r,o,u){var h=this,v=new Date().getTime(),m="click";v-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-r)<10&&Math.abs(this.lastClickXY[1]-o)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),m="dblclick",this.emit(Rl.Hover,{x:r,y:o,lngLat:u,type:m})):(this.lastClickTime=v,this.lastClickXY=[r,o],this.clickTimer=setTimeout(function(){m="click",h.emit(Rl.Hover,{x:r,y:o,lngLat:u,type:m})},400))}}]),t}(kp()),rm=Aa(tm.prototype,"mapService",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tm))||em),im=0;function $0(e){if(Eu)return null;var a=e;if(typeof e=="string"&&(a=document.getElementById(e)),a){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(im++),t.classList.add("l7-scene"),a.appendChild(t),t}return null}function vp(e){var a,t,n=!0;return e==null||(a=e.target)===null||a===void 0||(t=a.path)===null||t===void 0||t.map(function(r){if(r!=null&&r.classList){var o;r==null||(o=r.classList)===null||o===void 0||o.forEach(function(u){(u==="l7-marker"||u==="l7-popup")&&(n=!1)})}}),n}var Y;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(Y||(Y={}));var _0,K0,Um,xv,Q0,Nu,Wp,bh,bv,Xp,qd,Ev,Zm,zg=(_0=(0,Yr.b2)(),K0=(0,Yr.f3)(nr.IMapService),Um=(0,Yr.f3)(nr.IRendererService),xv=(0,Yr.f3)(nr.IGlobalConfigService),Q0=(0,Yr.f3)(nr.IInteractionService),Nu=(0,Yr.f3)(nr.ILayerService),_0(Wp=(bh=function(){function e(){var a=this;(0,Zt.Z)(this,e),(0,re.Z)(this,"pickedColors",void 0),(0,re.Z)(this,"pickedTileLayers",[]),ka(this,"mapService",bv,this),ka(this,"rendererService",Xp,this),ka(this,"configService",qd,this),ka(this,"interactionService",Ev,this),ka(this,"layerService",Zm,this),(0,re.Z)(this,"pickingFBO",void 0),(0,re.Z)(this,"width",0),(0,re.Z)(this,"height",0),(0,re.Z)(this,"alreadyInPicking",!1),(0,re.Z)(this,"pickBufferScale",1),(0,re.Z)(this,"pickedLayers",[]),(0,re.Z)(this,"pickFromPickingFBO",function(t,n){var r=n.x,o=n.y,u=n.lngLat,h=n.type,v=n.target,m=!1,b=a.rendererService,A=b.readPixels,k=b.getContainer,L=a.getContainerSize(k()),B=L.width,Z=L.height;B*=ma,Z*=ma;var V=t.getLayerConfig(),K=V.enableHighlight,le=V.enableSelect,be=r*ma,Be=o*ma;if(be>B-1*ma||be<0||Be>Z-1*ma||Be<0)return!1;var et=A({x:Math.floor(be/a.pickBufferScale),y:Math.floor((Z-(o+1)*ma)/a.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:a.pickingFBO});if(a.pickedColors=et,et[0]!==0||et[1]!==0||et[2]!==0){var at=R(et),Lt=t.getSource().getFeatureById(at);at!==t.getCurrentPickId()&&h==="mousemove"&&(h="mouseenter");var Gt={x:r,y:o,type:h,lngLat:u,featureId:at,feature:Lt,target:v};Lt&&(m=!0,t.setCurrentPickId(at),a.pickedLayers=[t],a.triggerHoverOnLayer(t,Gt))}else{var sr={x:r,y:o,lngLat:u,type:t.getCurrentPickId()!==null&&h==="mousemove"?"mouseout":"un"+h,featureId:null,target:v,feature:null};a.triggerHoverOnLayer(t,(0,ae.Z)((0,ae.Z)({},sr),{},{type:"unpick"})),a.triggerHoverOnLayer(t,sr),t.setCurrentPickId(null),a.pickedLayers=[]}if(K&&a.highlightPickedFeature(t,et),le&&h==="click"&&(et==null?void 0:et.toString())!==[0,0,0,0].toString()){var Tr=R(et);t.getCurrentSelectedId()===null||Tr!==t.getCurrentSelectedId()?(a.selectFeature(t,et),t.setCurrentSelectedId(Tr)):(a.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||a.layerService.getLayers().filter(function(Er){return Er.tileLayer}).map(function(Er){Er.tileLayer.clearPickState()})}return m})}return(0,kt.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,r=n.createTexture2D,o=n.createFramebuffer,u=n.getContainer,h=this.getContainerSize(u()),v=h.width,m=h.height;v*=ma,m*=ma,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=o({color:r({width:Math.round(v/this.pickBufferScale),height:Math.round(m/this.pickBufferScale),wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.interactionService.on(Rl.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var a=(0,_a.Z)(di().mark(function n(r,o,u){var h=this,v,m,b,A;return di().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:v=this.rendererService,m=v.useFramebuffer,b=v.clear,A=v.getContainer,this.resizePickingFBO(),m(this.pickingFBO,function(){b({framebuffer:h.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),r.hooks.beforePickingEncode.call(),r.renderModels(),r.hooks.afterPickingEncode.call();var B=h.pickBox(r,o);u(B)});case 3:case"end":return L.stop()}},n,this)}));function t(n,r,o){return a.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var r=this,o=n.map(function(Tr){var Er=Tr<0?0:Tr;return Math.floor(Er*ma/r.pickBufferScale)}),u=(0,Mr.Z)(o,4),h=u[0],v=u[1],m=u[2],b=u[3],A=this.rendererService,k=A.readPixels,L=A.getContainer,B=this.getContainerSize(L()),Z=B.width,V=B.height;if(Z*=ma,V*=ma,h>(Z-1)*ma/this.pickBufferScale||m<0||v>(V-1)*ma/this.pickBufferScale||b<0)return[];for(var K=Math.min(Z/this.pickBufferScale,m)-h,le=Math.min(V/this.pickBufferScale,b)-v,be=k({x:h,y:Math.floor(V/this.pickBufferScale-(b+1)),width:K,height:le,data:new Uint8Array(K*le*4),framebuffer:this.pickingFBO}),Be=[],et={},at=0;at<be.length/4;at=at+1){var Lt=be.slice(at*4,at*4+4),Gt=R(Lt);if(Gt!==-1&&!et[Gt]){var sr=t.getSource().getFeatureById(Gt);Be.push((0,ae.Z)((0,ae.Z)({},sr),{},{pickedFeatureIdx:Gt})),et[Gt]=!0}}return Be}},{key:"handleCursor",value:function(t,n){var r=t.getLayerConfig(),o=r.cursor,u=o===void 0?"":o,h=r.cursorEnabled;if(h){var v=this.mapService.version,m=v==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),b=m==null?void 0:m.style.getPropertyValue("cursor");n==="unmousemove"&&b!==""?m==null||m.style.setProperty("cursor",""):n==="mousemove"&&(m==null||m.style.setProperty("cursor",u))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/ma,height:t.height/ma}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var a=(0,_a.Z)(di().mark(function n(r){return di().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){u.next=2;break}return u.abrupt("return");case 2:return this.alreadyInPicking=!0,u.next=5,this.pickingLayers(r);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return u.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),r=n.width,o=n.height;r*=ma,o*=ma,(this.width!==r||this.height!==o)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(o/this.pickBufferScale)}),this.width=r,this.height=o)}},{key:"pickingLayers",value:function(){var a=(0,_a.Z)(di().mark(function n(r){var o=this,u,h,v,m,b;return di().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:u=this.rendererService,h=u.getViewportSize,v=u.useFramebuffer,m=u.clear,b=u.getContainer,this.resizePickingFBO(),v(this.pickingFBO,function(){var L=o.layerService.getRenderList();L.filter(function(B){return B.needPick(r.type)}).reverse().some(function(B){if(m({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.pickedLayers.filter(function(V){return!V.isVector}).map(function(V){o.selectFeature(V,new Uint8Array([0,0,0,0]))}),o.pickedTileLayers.map(function(V){var K;return(K=V.tileLayer)===null||K===void 0?void 0:K.clearPick(r.type)}),B.tileLayer)return B.tileLayer.pickLayers(r);B.hooks.beforePickingEncode.call(),B.masks.length>0&&B.masks.map(function(V){V.hooks.beforeRenderData.call(),V.hooks.beforeRender.call(),V.render(),V.hooks.afterRender.call()}),B.renderModels(!0),B.hooks.afterPickingEncode.call();var Z=o.pickFromPickingFBO(B,r);return o.layerService.pickedLayerId=Z?+B.id:-1,Z&&!B.getLayerConfig().enablePropagation})});case 3:case"end":return k.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){vp(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(t,n){var r=(0,Mr.Z)(n,3),o=r[0],u=r[1],h=r[2];t.hooks.beforeHighlight.call([o,u,h])}},{key:"selectFeature",value:function(t,n){var r=(0,Mr.Z)(n,3),o=r[0],u=r[1],h=r[2];t.hooks.beforeSelect.call([o,u,h])}}]),e}(),bv=Aa(bh.prototype,"mapService",[K0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=Aa(bh.prototype,"rendererService",[Um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=Aa(bh.prototype,"configService",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ev=Aa(bh.prototype,"interactionService",[Q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zm=Aa(bh.prototype,"layerService",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bh))||Wp),Ug=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Zt.Z)(this,e),(0,re.Z)(this,"autoStart",void 0),(0,re.Z)(this,"startTime",0),(0,re.Z)(this,"oldTime",0),(0,re.Z)(this,"running",!1),(0,re.Z)(this,"elapsedTime",0),this.autoStart=a}return(0,kt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),Vm,jm,am,om,sm,x0,_,w,M;function F(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=N(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function N(e,a){if(!!e){if(typeof e=="string")return ee(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ee(e,a)}}function ee(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var pe=(Vm=(0,Yr.b2)(),jm=(0,Yr.f3)(nr.IRendererService),am=(0,Yr.f3)(nr.IMapService),om=(0,Yr.f3)(nr.IGlobalConfigService),Vm(sm=(x0=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"pickedLayerId",-1),(0,re.Z)(this,"clock",new Ug),(0,re.Z)(this,"alreadyInRendering",!1),(0,re.Z)(this,"layers",[]),(0,re.Z)(this,"layerList",[]),(0,re.Z)(this,"layerRenderID",void 0),(0,re.Z)(this,"sceneInited",!1),(0,re.Z)(this,"animateInstanceCount",0),(0,re.Z)(this,"shaderPicking",!0),(0,re.Z)(this,"enableRender",!0),ka(this,"renderService",_,this),ka(this,"mapService",w,this),ka(this,"configService",M,this)}return(0,kt.Z)(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(n){return n.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(n){return n.name===t})}},{key:"cleanRemove",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.layers.indexOf(t);r>-1&&this.layers.splice(r,1),n&&(this.updateLayerRenderList(),this.renderLayers())}},{key:"remove",value:function(t,n){if(n){var r=n.layerChildren.indexOf(t);r>-1&&n.layerChildren.splice(r,1)}else{var o=this.layers.indexOf(t);o>-1&&this.layers.splice(o,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var a=(0,_a.Z)(di().mark(function n(){var r,o,u;return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){v.next=2;break}return v.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),r=F(this.layerList),v.prev=5,r.s();case 7:if((o=r.n()).done){v.next=21;break}if(u=o.value,u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(m){m.hooks.beforeRenderData.call(),m.hooks.beforeRender.call(),m.render(),m.hooks.afterRender.call()})),!u.getLayerConfig().enableMultiPassRenderer){v.next=17;break}return v.next=15,u.renderMultiPass();case 15:v.next=18;break;case 17:u.render();case 18:u.hooks.afterRender.call();case 19:v.next=7;break;case 21:v.next=26;break;case 23:v.prev=23,v.t0=v.catch(5),r.e(v.t0);case 26:return v.prev=26,r.f(),v.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return v.stop()}},n,this,[[5,23,26,29]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,r){return n.zIndex-r.zIndex}).forEach(function(n){t.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=I(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Ui.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Ui.cancelAnimationFrame(this.layerRenderID)}}]),e}(),_=Aa(x0.prototype,"renderService",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=Aa(x0.prototype,"mapService",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=Aa(x0.prototype,"configService",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x0))||sm),ue=de(81253),Oe=function(){function e(a){var t=this;(0,Zt.Z)(this,e),(0,re.Z)(this,"name",void 0),(0,re.Z)(this,"type",void 0),(0,re.Z)(this,"scale",void 0),(0,re.Z)(this,"descriptor",void 0),(0,re.Z)(this,"featureBufferLayout",[]),(0,re.Z)(this,"needRescale",!1),(0,re.Z)(this,"needRemapping",!1),(0,re.Z)(this,"needRegenerateVertices",!1),(0,re.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,re.Z)(this,"vertexAttribute",void 0),(0,re.Z)(this,"defaultCallback",function(n){if(n.length===0){var r;return((r=t.scale)===null||r===void 0?void 0:r.defaultValues)||[]}return n.map(function(o,u){var h,v=(h=t.scale)===null||h===void 0?void 0:h.scalers[u].func,m=v(o);return m})}),this.setProps(a)}return(0,kt.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var r,o=(r=this.scale)===null||r===void 0?void 0:r.callback.apply(r,(0,X.Z)(t));if(!(0,d.isNil)(o))return[o]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Ge=["modelType"],Ve=["buffer","update","name"],Jt=["buffer","update","name"],br=["buffer","update","name"],Dr,qr,kn,Cn,Dn,dn;function ai(e){return new Promise(function(a){return setTimeout(a,e)})}var Ei=(Dr={},(0,re.Z)(Dr,Y.FLOAT,4),(0,re.Z)(Dr,Y.UNSIGNED_BYTE,1),(0,re.Z)(Dr,Y.UNSIGNED_SHORT,2),Dr),Eo=(qr=(0,Yr.b2)(),kn=(0,Yr.f3)(nr.IRendererService),qr(Cn=(Dn=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"attributesAndIndices",void 0),ka(this,"rendererService",dn,this),(0,re.Z)(this,"attributes",[]),(0,re.Z)(this,"triangulation",void 0),(0,re.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,kt.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new Oe(t),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(t,n,r){var o=this.getLayerStyleAttribute(t);o||(o=this.registerStyleAttribute((0,ae.Z)((0,ae.Z)({},n),{},{name:t})));var u=n.scale;u&&o&&(o.scale=u,o.needRescale=!0,o.needRemapping=!0,o.needRegenerateVertices=!0,r&&r.featureRange&&(o.featureRange=r.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,r=this.getLayerStyleAttribute(t),o=r==null||(n=r.scale)===null||n===void 0?void 0:n.scalers;return o&&o[0]?o[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,u=this.attributes.find(function(Be){return Be.name===t});if(u&&u.descriptor){var h=u.descriptor,v=h.update,m=h.buffer,b=h.size,A=b===void 0?0:b,k=Ei[m.type||Y.FLOAT];if(v){var L=this.featureLayout,B=L.elements,Z=L.sizePerElement,V=B.slice(r,o);if(!V.length)return;var K=V[0].offset,le=K*A*k,be=V.map(function(Be,et){for(var at=Be.featureIdx,Lt=Be.vertices,Gt=Be.normals,sr=Lt.length/Z,Tr=[],Er=0;Er<sr;Er++){var Qr=Gt?Gt.slice(Er*3,Er*3+3):[];Tr.push.apply(Tr,(0,X.Z)(v(n[at],at,Lt.slice(Er*Z,Er*Z+Z),et,Qr)))}return Tr}).reduce(function(Be,et){return Be.push.apply(Be,(0,X.Z)(et)),Be},[]);u.vertexAttribute.updateBuffer({data:be,offset:le})}}}},{key:"createAttributesAndIndicesAscy",value:function(t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]};var u=this.attributes.map(function(B){return B.resetDescriptor(),B.descriptor}).filter(function(B){return B}),h=r.modelType,v=(0,ue.Z)(r,Ge),m=this.rendererService,b=m.createAttribute,A=m.createBuffer,k=m.createElements,L={};return new Promise(function(B,Z){Tp(h,(0,ae.Z)({descriptors:o.getDescriptorsWithOutFunc(u),features:t,segmentNumber:n},v)).then(function(V){V.descriptors.forEach(function(le,be){if(le){var Be=le.buffer,et=le.update,at=le.name,Lt=(0,ue.Z)(le,Ve),Gt=b((0,ae.Z)({buffer:A(Be)},Lt));L[le.name||""]=Gt,o.attributes[be].vertexAttribute=Gt}}),o.featureLayout=V.featureLayout;var K=k({data:V.indices,type:Y.UNSIGNED_INT,count:V.indices.length});o.attributesAndIndices={attributes:L,elements:K,count:null},B(o.attributesAndIndices)}).catch(function(V){console.warn(V),Z(V)})})}},{key:"createAttributesAndIndices",value:function(t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var u=this.attributes.map(function(be){return be.resetDescriptor(),be.descriptor}),h=0,v=0,m=[],b=[],A=[],k=3;t.forEach(function(be,Be){var et=o.triangulation(be,r),at=et.indices,Lt=et.vertices,Gt=et.normals,sr=et.size,Tr=et.indexes,Er=et.count;typeof Er=="number"&&(v+=Er),at.forEach(function(Da){b.push(Da+h)}),k=sr;var Qr=Lt.length/sr;o.featureLayout.sizePerElement=k,o.featureLayout.elements.push({featureIdx:Be,vertices:Lt,normals:Gt,offset:h}),h+=Qr;for(var On=function(Wa){var ks=(Gt==null?void 0:Gt.slice(Wa*3,Wa*3+3))||[],Tu=Lt.slice(Wa*sr,Wa*sr+sr),gu=0;Tr&&Tr[Wa]!==void 0&&(gu=Tr[Wa]),u.forEach(function(hf,I0){if(hf&&hf.update){var k0;(k0=hf.buffer.data).push.apply(k0,(0,X.Z)(hf.update(be,Be,Tu,Wa,ks,gu)))}})},li=0;li<Qr;li++)On(li)});var L=this.rendererService,B=L.createAttribute,Z=L.createBuffer,V=L.createElements,K={};u.forEach(function(be,Be){if(be){var et=be.buffer,at=be.update,Lt=be.name,Gt=(0,ue.Z)(be,Jt),sr=B((0,ae.Z)({buffer:Z(et)},Gt));K[be.name||""]=sr,o.attributes[Be].vertexAttribute=sr}});var le=V({data:b,type:Y.UNSIGNED_INT,count:b.length});return this.attributesAndIndices={attributes:K,elements:le,count:v},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(L){return L.resetDescriptor(),L.descriptor}),u=0,h=[],v=3;t.forEach(function(L,B){var Z=r.triangulation(L),V=Z.indices,K=Z.vertices,le=Z.normals,be=Z.size,Be=Z.indexes;V.forEach(function(Gt){h.push(Gt+u)}),v=be;var et=K.length/be;r.featureLayout.sizePerElement=v,r.featureLayout.elements.push({featureIdx:B,vertices:K,normals:le,offset:u}),u+=et;for(var at=function(sr){var Tr=(le==null?void 0:le.slice(sr*3,sr*3+3))||[],Er=K.slice(sr*be,sr*be+be),Qr=0;Be&&Be[sr]!==void 0&&(Qr=Be[sr]),o.forEach(function(On,li){if(On&&On.update){var Da;(Da=On.buffer.data).push.apply(Da,(0,X.Z)(On.update(L,B,Er,sr,Tr,Qr)))}})},Lt=0;Lt<et;Lt++)at(Lt)});var m=this.rendererService,b=m.createAttribute,A=m.createBuffer,k={};return o.forEach(function(L,B){if(L){var Z=L.buffer,V=L.update,K=L.name,le=(0,ue.Z)(L,br),be=b((0,ae.Z)({buffer:A(Z)},le));k[L.name||""]=be,r.attributes[B].vertexAttribute=be}}),{attributes:k}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}},{key:"getDescriptorsWithOutFunc",value:function(t){return t.map(function(n){return{buffer:n.buffer,name:n.name,size:n.size}})}}]),e}(),dn=Aa(Dn.prototype,"rendererService",[kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn))||Cn),ro=de(67709),$a=de.n(ro),no,io,Kr,ln,Di,Ha,xa,Ku,dl,ts,vl,ps,Eh,mp,zu,rs,Ol,Co,Fl,jf,Yp,um,J0,Cv,Qy,Jy,e_,t_,r_,n_,i_,a_,o_;function wE(e){var a=TE();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function TE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ME=(no=(0,Yr.b2)(),io=(0,Yr.f3)(nr.SceneID),Kr=(0,Yr.f3)(nr.IIconService),ln=(0,Yr.f3)(nr.IFontService),Di=(0,Yr.f3)(nr.IControlService),Ha=(0,Yr.f3)(nr.IGlobalConfigService),xa=(0,Yr.f3)(nr.IMapService),Ku=(0,Yr.f3)(nr.ICoordinateSystemService),dl=(0,Yr.f3)(nr.IRendererService),ts=(0,Yr.f3)(nr.ILayerService),vl=(0,Yr.f3)(nr.ICameraService),ps=(0,Yr.f3)(nr.IInteractionService),Eh=(0,Yr.f3)(nr.IPickingService),mp=(0,Yr.f3)(nr.IShaderModuleService),zu=(0,Yr.f3)(nr.IMarkerService),rs=(0,Yr.f3)(nr.IPopupService),no(Ol=(Co=function(e){(0,Pr.Z)(t,e);var a=wE(t);function t(){var n;return(0,Zt.Z)(this,t),n=a.call(this),(0,re.Z)((0,bt.Z)(n),"destroyed",!1),(0,re.Z)((0,bt.Z)(n),"loaded",!1),(0,re.Z)((0,bt.Z)(n),"loadFont",!1),(0,re.Z)((0,bt.Z)(n),"fontFamily",""),ka((0,bt.Z)(n),"id",Fl,(0,bt.Z)(n)),ka((0,bt.Z)(n),"iconService",jf,(0,bt.Z)(n)),ka((0,bt.Z)(n),"fontService",Yp,(0,bt.Z)(n)),ka((0,bt.Z)(n),"controlService",um,(0,bt.Z)(n)),ka((0,bt.Z)(n),"configService",J0,(0,bt.Z)(n)),ka((0,bt.Z)(n),"map",Cv,(0,bt.Z)(n)),ka((0,bt.Z)(n),"coordinateSystemService",Qy,(0,bt.Z)(n)),ka((0,bt.Z)(n),"rendererService",Jy,(0,bt.Z)(n)),ka((0,bt.Z)(n),"layerService",e_,(0,bt.Z)(n)),ka((0,bt.Z)(n),"cameraService",t_,(0,bt.Z)(n)),ka((0,bt.Z)(n),"interactionService",r_,(0,bt.Z)(n)),ka((0,bt.Z)(n),"pickingService",n_,(0,bt.Z)(n)),ka((0,bt.Z)(n),"shaderModuleService",i_,(0,bt.Z)(n)),ka((0,bt.Z)(n),"markerService",a_,(0,bt.Z)(n)),ka((0,bt.Z)(n),"popupService",o_,(0,bt.Z)(n)),(0,re.Z)((0,bt.Z)(n),"inited",!1),(0,re.Z)((0,bt.Z)(n),"initPromise",void 0),(0,re.Z)((0,bt.Z)(n),"rendering",!1),(0,re.Z)((0,bt.Z)(n),"$container",void 0),(0,re.Z)((0,bt.Z)(n),"canvas",void 0),(0,re.Z)((0,bt.Z)(n),"markerContainer",void 0),(0,re.Z)((0,bt.Z)(n),"hooks",void 0),(0,re.Z)((0,bt.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),$f(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,re.Z)((0,bt.Z)(n),"handleMapCameraChanged",function(r){n.cameraService.update(r),n.render()}),n.hooks={init:new Zv},n}return(0,kt.Z)(t,[{key:"init",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,_a.Z)(di().mark(function u(){return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,new Promise(function(m){o.map.onCameraChanged(function(b){o.cameraService.init(),o.cameraService.update(b),o.map.version!=="GAODE2.x"&&m()}),o.map.version!=="GAODE2.x"?o.map.init():m()});case 2:if(!(o.map.version==="GAODE2.x"&&o.map.initViewPort)){v.next=6;break}return v.next=5,o.map.init();case 5:o.map.initViewPort();case 6:o.map.onCameraChanged(o.handleMapCameraChanged),o.map.addMarkerContainer(),o.markerService.addMarkers(),o.markerService.addMarkerLayers(),o.popupService.initPopup(),o.interactionService.init(),o.interactionService.on(Rl.Drag,o.addSceneEvent.bind(o));case 13:case"end":return v.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,_a.Z)(di().mark(function u(){var h,v;return di().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(h=$0(o.configService.getSceneConfig(o.id).id||""),o.$container=h,!h){b.next=12;break}return o.canvas=Mo("canvas","",h),o.setCanvas(),b.next=7,o.rendererService.init(o.canvas,o.configService.getSceneConfig(o.id),r.gl);case 7:o.initContainer(),$a()(o.$container,o.handleWindowResized),Ui.matchMedia&&((v=Ui.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||v===void 0||v.addListener(o.handleWindowResized)),b.next=13;break;case 12:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 13:o.pickingService.init(o.id);case 14:case"end":return b.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(r){var o=this;this.configService.setSceneConfig(this.id,r),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return o.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,_a.Z)(di().mark(function u(){return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,new Promise(function(m){o.map.onCameraChanged(function(b){o.cameraService.init(),o.cameraService.update(b),o.map.version!=="GAODE2.x"&&m()}),o.map.initMiniMap()});case 2:o.map.onCameraChanged(o.handleMapCameraChanged),o.interactionService.init(),o.interactionService.on(Rl.Drag,o.addSceneEvent.bind(o));case 5:case"end":return v.stop()}},u)}))),this.hooks.init.tapPromise("initRenderer",(0,_a.Z)(di().mark(function u(){var h;return di().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(h=r.canvas,o.$container=h||null,!o.$container){m.next=7;break}return m.next=5,o.rendererService.init(r.canvas,o.configService.getSceneConfig(o.id),void 0);case 5:m.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:o.pickingService.init(o.id);case 9:case"end":return m.stop()}},u)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(r){this.layerService.sceneService=this,this.layerService.add(r)}},{key:"addMask",value:function(r){this.layerService.sceneService=this,this.layerService.addMask(r)}},{key:"render",value:function(){var n=(0,_a.Z)(di().mark(function o(){return di().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.rendering||this.destroyed)){h.next=2;break}return h.abrupt("return");case 2:if(this.rendering=!0,this.inited){h.next=23;break}return h.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){h.next=18;break}return h.prev=8,h.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:h.next=18;break;case 13:h.prev=13,h.t0=h.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(h.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return h.stop()}},o,this,[[8,13]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"addFontFace",value:function(r,o){this.fontFamily=r;var u=document.createElement("style");u.type="text/css",u.innerText=`
        @font-face{
            font-family: '`.concat(r,`';
            src: url('`).concat(o,`') format('woff2'),
            url('`).concat(o,`') format('woff'),
            url('`).concat(o,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(u),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(r){var o,u=(o=this.$container)===null||o===void 0?void 0:o.getElementsByTagName("canvas")[0];this.render();var h=r==="jpg"?u==null?void 0:u.toDataURL("image/jpeg"):u==null?void 0:u.toDataURL("image/png");return h}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var r=this.$container.parentElement;r!==null&&(this.markerContainer=Mo("div","l7-marker-container",r))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var r=this,o,u;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var v;(v=r.$container)===null||v===void 0||v.removeChild(r.canvas),r.canvas=null,r.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(o=this.$container)===null||o===void 0||(u=o.parentNode)===null||u===void 0||u.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,ro.unbind)(this.$container,this.handleWindowResized),Ui.matchMedia){var h;(h=Ui.matchMedia("screen and (min-resolution: 2dppx)"))===null||h===void 0||h.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var r,o,u=ma,h=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,v=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,m=this.canvas;m&&(m.width=h*u,m.height=v*u),this.rendererService.viewport({x:0,y:0,width:u*h,height:u*v})}},{key:"setCanvas",value:function(){var r,o,u=ma,h=((r=this.$container)===null||r===void 0?void 0:r.clientWidth)||400,v=((o=this.$container)===null||o===void 0?void 0:o.clientHeight)||300,m=this.canvas;m.width=h*u,m.height=v*u,m.style.width="100%",m.style.height="100%"}},{key:"addSceneEvent",value:function(r){this.emit(r.type,r)}}]),t}(Xu.EventEmitter),Fl=Aa(Co.prototype,"id",[io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jf=Aa(Co.prototype,"iconService",[Kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp=Aa(Co.prototype,"fontService",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=Aa(Co.prototype,"controlService",[Di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J0=Aa(Co.prototype,"configService",[Ha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cv=Aa(Co.prototype,"map",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=Aa(Co.prototype,"coordinateSystemService",[Ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jy=Aa(Co.prototype,"rendererService",[dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e_=Aa(Co.prototype,"layerService",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=Aa(Co.prototype,"cameraService",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r_=Aa(Co.prototype,"interactionService",[ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n_=Aa(Co.prototype,"pickingService",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_=Aa(Co.prototype,"shaderModuleService",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a_=Aa(Co.prototype,"markerService",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o_=Aa(Co.prototype,"popupService",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Co))||Ol);function IE(e){var a=0;switch(e){case"vec2":case"ivec2":a=2;break;case"vec3":case"ivec3":a=3;break;case"vec4":case"ivec4":case"mat2":a=4;break;case"mat3":a=9;break;case"mat4":a=16;break;default:}return a}var kE=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function s_(e){var a={};return e=e.replace(kE,function(t,n,r){var o=r.split(":"),u=o[0].trim(),h="";switch(o.length>1&&(h=o[1].trim()),n){case"bool":h=h==="true";break;case"float":case"int":h=Number(h);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":h?h=h.replace("[","").replace("]","").split(",").reduce(function(v,m){return v.push(Number(m.trim())),v},[]):h=new Array(IE(n)).fill(0);break;default:}return a[u]=h,"uniform ".concat(n," ").concat(u,`;
`)}),{content:e,uniforms:a}}var u_,l_,c_="#define PI 3.14159265359",PE=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,LE=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,RE=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,OE=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,FE=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,DE=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,BE=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,NE=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,zE=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,UE=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,ZE=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,VE=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,jE=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,GE=/precision\s+(high|low|medium)p\s+float/,HE=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,WE=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,XE=(u_=(0,Yr.b2)(),u_(l_=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"moduleCache",{}),(0,re.Z)(this,"rawContentCache",{})}return(0,kt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:c_,fs:c_}),this.registerModule("decode",{vs:PE,fs:""}),this.registerModule("projection",{vs:BE,fs:""}),this.registerModule("project",{vs:DE,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:NE}),this.registerModule("lighting",{vs:RE,fs:""}),this.registerModule("light",{vs:LE,fs:""}),this.registerModule("picking",{vs:FE,fs:OE}),this.registerModule("styleMapping",{vs:zE,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:jE,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:UE,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:ZE,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:VE,fs:""})}},{key:"registerModule",value:function(t,n){if(!this.rawContentCache[t]){var r=n.vs,o=n.fs,u=n.uniforms,h=s_(r),v=h.content,m=h.uniforms,b=s_(o),A=b.content,k=b.uniforms;this.rawContentCache[t]={fs:A,uniforms:(0,ae.Z)((0,ae.Z)((0,ae.Z)({},m),k),u),vs:v}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var r=this.rawContentCache[t].vs,o=this.rawContentCache[t].fs,u=this.processModule(r,[],"vs"),h=u.content,v=u.includeList,m=this.processModule(o,[],"fs"),b=m.content,A=m.includeList,k=b,L=(0,d.uniq)(v.concat(A).concat(t)).reduce(function(B,Z){return(0,ae.Z)((0,ae.Z)({},B),n.rawContentCache[Z].uniforms)},{});return GE.test(b)||(k=HE+b),this.moduleCache[t]={fs:k.trim(),uniforms:L,vs:h.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,r){var o=this,u=t.replace(WE,function(h,v){var m=v.split(" "),b=m[0].replace(/"/g,"");if(n.indexOf(b)>-1)return"";var A=o.rawContentCache[b][r];n.push(b);var k=o.processModule(A,n,r),L=k.content;return L});return{content:u,includeList:n}}}]),e}())||l_),Gm=de(66213),b0;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(b0||(b0={}));var f_,h_,Hm=(f_=(0,Yr.b2)(),f_(h_=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"shaderModuleService",void 0),(0,re.Z)(this,"rendererService",void 0),(0,re.Z)(this,"cameraService",void 0),(0,re.Z)(this,"mapService",void 0),(0,re.Z)(this,"interactionService",void 0),(0,re.Z)(this,"layerService",void 0),(0,re.Z)(this,"config",void 0)}return(0,kt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return b0.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(nr.IRendererService),this.cameraService=t.getContainer().get(nr.ICameraService),this.mapService=t.getContainer().get(nr.IMapService),this.interactionService=t.getContainer().get(nr.IInteractionService),this.layerService=t.getContainer().get(nr.ILayerService),this.shaderModuleService=t.getContainer().get(nr.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||h_),p_,d_;function YE(e){var a=qE();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function qE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $E=(p_=(0,Yr.b2)(),p_(d_=function(e){(0,Pr.Z)(t,e);var a=YE(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(r,o){(0,Gm.Z)((0,Et.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Hm))||d_),v_,m_,g_,Zg,y_;function KE(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=QE(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function QE(e,a){if(!!e){if(typeof e=="string")return __(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return __(e,a)}}function __(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var JE=(v_=(0,Yr.b2)(),m_=(0,Yr.f3)(nr.IPostProcessor),v_(g_=(Zg=function(){function e(){(0,Zt.Z)(this,e),(0,re.Z)(this,"passes",[]),ka(this,"postProcessor",y_,this),(0,re.Z)(this,"layer",void 0),(0,re.Z)(this,"renderFlag",void 0),(0,re.Z)(this,"width",0),(0,re.Z)(this,"height",0)}return(0,kt.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var a=(0,_a.Z)(di().mark(function n(){var r,o,u;return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r=KE(this.passes),v.prev=1,r.s();case 3:if((o=r.n()).done){v.next=9;break}return u=o.value,v.next=7,u.render(this.layer);case 7:v.next=3;break;case 9:v.next=14;break;case 11:v.prev=11,v.t0=v.catch(1),r.e(v.t0);case 14:return v.prev=14,r.f(),v.finish(14);case 17:return v.next=19,this.postProcessor.render(this.layer);case 19:case"end":return v.stop()}},n,this,[[1,11,14,17]])}));function t(){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===b0.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,r){t.init(this.layer,n),this.passes.splice(r,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),y_=Aa(Zg.prototype,"postProcessor",[m_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg))||g_),x_,b_;function eC(e){var a=tC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function tC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rC=(x_=(0,Yr.b2)(),x_(b_=function(e){(0,Pr.Z)(t,e);var a=eC(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"pickingFBO",void 0),(0,re.Z)((0,bt.Z)(n),"layer",void 0),(0,re.Z)((0,bt.Z)(n),"width",0),(0,re.Z)((0,bt.Z)(n),"height",0),(0,re.Z)((0,bt.Z)(n),"alreadyInRendering",!1),(0,re.Z)((0,bt.Z)(n),"pickFromPickingFBO",function(h){var v=h.x,m=h.y,b=h.lngLat,A=h.type;if(!(!n.layer.isVisible()||!n.layer.needPick(A))){var k=n.rendererService,L=k.getViewportSize,B=k.readPixels,Z=k.useFramebuffer,V=L(),K=V.width,le=V.height,be=n.layer.getLayerConfig(),Be=be.enableHighlight,et=be.enableSelect,at=v*ma,Lt=m*ma;if(!(at>K||at<0||Lt>le||Lt<0)){var Gt;Z(n.pickingFBO,function(){var sr;if(Gt=B({x:Math.round(at),y:Math.round(le-(m+1)*ma),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Gt[0]!==0||Gt[1]!==0||Gt[2]!==0){var Tr=R(Gt),Er=n.layer.getSource().getFeatureById(Tr),Qr={x:v,y:m,type:A,lngLat:b,featureId:Tr,feature:Er};Er&&(n.layer.setCurrentPickId(Tr),n.triggerHoverOnLayer(Qr))}else{var On={x:v,y:m,lngLat:b,type:n.layer.getCurrentPickId()===null?"un"+A:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,ae.Z)((0,ae.Z)({},On),{},{type:"unpick"})),n.triggerHoverOnLayer(On),n.layer.setCurrentPickId(null)}Be&&n.highlightPickedFeature(Gt),et&&A==="click"&&((sr=Gt)===null||sr===void 0?void 0:sr.toString())!==[0,0,0,0].toString()&&n.selectFeature(Gt)})}}}),n}return(0,kt.Z)(t,[{key:"getType",value:function(){return b0.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(r,o){(0,Gm.Z)((0,Et.Z)(t.prototype),"init",this).call(this,r,o),this.layer=r;var u=this.rendererService,h=u.createTexture2D,v=u.createFramebuffer,m=u.getViewportSize,b=m(),A=b.width,k=b.height;this.pickingFBO=v({color:h({width:A,height:k,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.interactionService.on(Rl.Hover,this.pickFromPickingFBO),this.interactionService.on(Rl.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Rl.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(r){var o=this;if(!this.alreadyInRendering){var u=this.rendererService,h=u.getViewportSize,v=u.useFramebuffer,m=u.clear,b=h(),A=b.width,k=b.height;this.alreadyInRendering=!0,(this.width!==A||this.height!==k)&&(this.pickingFBO.resize({width:A,height:k}),this.width=A,this.height=k),v(this.pickingFBO,function(){m({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var L=o.layer.multiPassRenderer.getRenderFlag();o.layer.multiPassRenderer.setRenderFlag(!1),r.hooks.beforePickingEncode.call(),r.render(),r.hooks.afterPickingEncode.call(),o.layer.multiPassRenderer.setRenderFlag(L),o.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(r){this.layer.emit(r.type,r)}},{key:"highlightPickedFeature",value:function(r){var o=(0,Mr.Z)(r,3),u=o[0],h=o[1],v=o[2];this.layer.hooks.beforeHighlight.call([u,h,v]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(r){var o=(0,Mr.Z)(r,3),u=o[0],h=o[1],v=o[2];this.layer.hooks.beforeSelect.call([u,h,v]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(r){var o=r.featureId,u=z(o);this.selectFeature(new Uint8Array(u))}},{key:"highlightFeatureHandle",value:function(r){var o=r.featureId,u=z(o);this.highlightPickedFeature(new Uint8Array(u))}}]),t}(Hm))||b_),E_,C_,S_,Vg,A_,nC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$d=(E_=(0,Yr.b2)(),C_=(0,Yr.f3)(nr.IShaderModuleService),E_(S_=(Vg=function(){function e(){(0,Zt.Z)(this,e),ka(this,"shaderModuleService",A_,this),(0,re.Z)(this,"rendererService",void 0),(0,re.Z)(this,"config",void 0),(0,re.Z)(this,"quad",nC),(0,re.Z)(this,"enabled",!0),(0,re.Z)(this,"renderToScreen",!1),(0,re.Z)(this,"model",void 0),(0,re.Z)(this,"name",void 0),(0,re.Z)(this,"optionsToUpdate",{})}return(0,kt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return b0.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(nr.IRendererService),this.shaderModuleService=t.getContainer().get(nr.IShaderModuleService);var r=this.rendererService,o=r.createAttribute,u=r.createBuffer,h=r.createModel,v=this.setupShaders(),m=v.vs,b=v.fs,A=v.uniforms;this.model=h({vs:m,fs:b,attributes:{a_Position:o({buffer:u({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:(0,ae.Z)((0,ae.Z)({u_Texture:null},A),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var r=this,o=t.multiPassRenderer.getPostProcessor(),u=this.rendererService,h=u.useFramebuffer,v=u.getViewportSize,m=u.clear,b=v(),A=b.width,k=b.height;h(this.renderToScreen?null:o.getWriteFBO(),function(){m({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var L=(0,ae.Z)({u_BloomFinal:0,u_Texture:o.getReadFBO(),u_ViewportSize:[A,k]},r.convertOptionsToUniforms(r.optionsToUpdate));n&&(L.u_BloomFinal=1,L.u_Texture2=n),r.model.draw({uniforms:L})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,ae.Z)((0,ae.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(r){(0,d.isNil)(t[r])||(n["u_".concat((0,d.upperFirst)((0,d.camelCase)(r)))]=t[r])}),n}}]),e}(),A_=Aa(Vg.prototype,"shaderModuleService",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vg))||S_),w_,T_;function iC(e){var a=aC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oC=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,sC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,uC=(w_=(0,Yr.b2)(),w_(T_=function(e){(0,Pr.Z)(t,e);var a=iC(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:sC,fs:oC});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,h=r.uniforms,v=this.rendererService.getViewportSize(),m=v.width,b=v.height;return{vs:o,fs:u,uniforms:(0,ae.Z)((0,ae.Z)({},h),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,d.isNil)(r.bloomRadius)||(o.u_radius=r.bloomRadius),(0,d.isNil)(r.bloomIntensity)||(o.u_intensity=r.bloomIntensity),(0,d.isNil)(r.bloomBaseRadio)||(o.u_baseRadio=r.bloomBaseRadio),o}}]),t}($d))||T_),M_,I_;function lC(e){var a=cC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,hC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,pC=(M_=(0,Yr.b2)(),M_(I_=function(e){(0,Pr.Z)(t,e);var a=lC(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:hC,fs:fC});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,h=r.uniforms,v=this.rendererService.getViewportSize(),m=v.width,b=v.height;return{vs:o,fs:u,uniforms:(0,ae.Z)((0,ae.Z)({},h),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,d.isNil)(r.blurRadius)||(o.u_BlurDir=[r.blurRadius,0]),o}}]),t}($d))||I_),k_,P_;function dC(e){var a=vC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function vC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,gC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yC=(k_=(0,Yr.b2)(),k_(P_=function(e){(0,Pr.Z)(t,e);var a=dC(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:gC,fs:mC});var r=this.shaderModuleService.getModule("blur-pass"),o=r.vs,u=r.fs,h=r.uniforms,v=this.rendererService.getViewportSize(),m=v.width,b=v.height;return{vs:o,fs:u,uniforms:(0,ae.Z)((0,ae.Z)({},h),{},{u_ViewportSize:[m,b]})}}},{key:"convertOptionsToUniforms",value:function(r){var o={};return(0,d.isNil)(r.blurRadius)||(o.u_BlurDir=[0,r.blurRadius]),o}}]),t}($d))||P_),L_,R_;function _C(e){var a=xC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,EC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,CC=(L_=(0,Yr.b2)(),L_(R_=function(e){(0,Pr.Z)(t,e);var a=_C(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:EC,fs:bC});var r=this.shaderModuleService.getModule("colorhalftone-pass"),o=r.vs,u=r.fs,h=r.uniforms,v=this.rendererService.getViewportSize(),m=v.width,b=v.height;return{vs:o,fs:u,uniforms:(0,ae.Z)((0,ae.Z)({},h),{},{u_ViewportSize:[m,b]})}}}]),t}($d))||R_),O_,F_;function SC(e){var a=AC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,TC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,MC=(O_=(0,Yr.b2)(),O_(F_=function(e){(0,Pr.Z)(t,e);var a=SC(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:TC,fs:wC}),this.shaderModuleService.getModule("copy-pass")}}]),t}($d))||F_),D_,B_;function IC(e){var a=kC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function kC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,LC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,RC=(D_=(0,Yr.b2)(),D_(B_=function(e){(0,Pr.Z)(t,e);var a=IC(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:LC,fs:PC});var r=this.shaderModuleService.getModule("hexagonalpixelate-pass"),o=r.vs,u=r.fs,h=r.uniforms,v=this.rendererService.getViewportSize(),m=v.width,b=v.height;return{vs:o,fs:u,uniforms:(0,ae.Z)((0,ae.Z)({},h),{},{u_ViewportSize:[m,b]})}}}]),t}($d))||B_),N_,z_;function OC(e){var a=FC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,BC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,NC=(N_=(0,Yr.b2)(),N_(z_=function(e){(0,Pr.Z)(t,e);var a=OC(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:BC,fs:DC});var r=this.shaderModuleService.getModule("ink-pass"),o=r.vs,u=r.fs,h=r.uniforms,v=this.rendererService.getViewportSize(),m=v.width,b=v.height;return{vs:o,fs:u,uniforms:(0,ae.Z)((0,ae.Z)({},h),{},{u_ViewportSize:[m,b]})}}}]),t}($d))||z_),U_,Z_;function zC(e){var a=UC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function UC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZC=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,VC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jC=(U_=(0,Yr.b2)(),U_(Z_=function(e){(0,Pr.Z)(t,e);var a=zC(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:VC,fs:ZC}),this.shaderModuleService.getModule("noise-pass")}}]),t}($d))||Z_),V_,j_;function GC(e){var a=HC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WC=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,XC=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,YC=(V_=(0,Yr.b2)(),V_(j_=function(e){(0,Pr.Z)(t,e);var a=GC(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:WC,fs:XC}),this.shaderModuleService.getModule("sepia-pass")}}]),t}($d))||j_),G_,H_,W_,X_,Sv,Y_,qC=(G_=(0,Yr.b2)(),H_=(0,Yr.f3)(nr.IRendererService),W_=(0,Yr.zY)(),G_(X_=(Sv=function(){function e(){(0,Zt.Z)(this,e),ka(this,"rendererService",Y_,this),(0,re.Z)(this,"passes",[]),(0,re.Z)(this,"readFBO",void 0),(0,re.Z)(this,"writeFBO",void 0)}return(0,kt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,r=t.createTexture2D,o=n(),u=o.width,h=o.height;return r({x:0,y:0,width:u,height:h,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(r,o){n(t.readFBO,(0,_a.Z)(di().mark(function u(){return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:r(t.getCurrentFBOTex());case 1:case"end":return v.stop()}},u)})))})}},{key:"renderBloomPass",value:function(){var a=(0,_a.Z)(di().mark(function n(r,o){var u,h;return di().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.getReadFBOTex();case 2:u=m.sent,h=0;case 4:if(!(h<4)){m.next=11;break}return m.next=7,o.render(r,u);case 7:this.swap(),h++,m.next=4;break;case 11:case"end":return m.stop()}},n,this)}));function t(n,r){return a.apply(this,arguments)}return t}()},{key:"render",value:function(){var a=(0,_a.Z)(di().mark(function n(r){var o,u;return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:o=0;case 1:if(!(o<this.passes.length)){v.next=15;break}if(u=this.passes[o],u.setRenderToScreen(this.isLastEnabledPass(o)),u.getName()!=="bloom"){v.next=9;break}return v.next=7,this.renderBloomPass(r,u);case 7:v.next=12;break;case 9:return v.next=11,u.render(r);case 11:o!==this.passes.length-1&&this.swap();case 12:o++,v.next=1;break;case 15:case"end":return v.stop()}},n,this)}));function t(n){return a.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,r){t.init(n,r),this.passes.push(t)}},{key:"insert",value:function(t,n,r,o){t.init(r,o),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,r=t.createTexture2D;this.readFBO=n({color:r({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.writeFBO=n({color:r({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),Y_=Aa(Sv.prototype,"rendererService",[H_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa(Sv.prototype,"init",[W_],Object.getOwnPropertyDescriptor(Sv.prototype,"init"),Sv.prototype),Sv))||X_),q_,$_;function $C(e){var a=KC();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QC=(q_=(0,Yr.b2)(),q_($_=function(e){(0,Pr.Z)(t,e);var a=$C(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getType",value:function(){return b0.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(r,o){(0,Gm.Z)((0,Et.Z)(t.prototype),"init",this).call(this,r,o)}},{key:"render",value:function(r){var o=this.rendererService,u=o.useFramebuffer,h=o.clear,v=r.multiPassRenderer.getPostProcessor().getReadFBO();u(v,function(){h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:v}),r.multiPassRenderer.setRenderFlag(!1),r.models.forEach(function(m){m.draw({uniforms:r.layerModel.getUninforms()})}),r.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Hm))||$_),K_,Q_,J_,jg,e1;function JC(e){var a=eS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function eS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tS=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,t1=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,rS=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function r1(e,a){for(var t=0,n=1/a,r=e;r>0;)t=t+n*(r%a),r=Math.floor(r/a),n=n/a;return t}var nS=1,iS=(K_=(0,Yr.b2)(),Q_=(0,Yr.f3)(nr.IShaderModuleService),K_(J_=(jg=function(e){(0,Pr.Z)(t,e);var a=JC(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),ka((0,bt.Z)(n),"shaderModuleService",e1,(0,bt.Z)(n)),(0,re.Z)((0,bt.Z)(n),"haltonSequence",[]),(0,re.Z)((0,bt.Z)(n),"accumulatingId",0),(0,re.Z)((0,bt.Z)(n),"frame",0),(0,re.Z)((0,bt.Z)(n),"timer",void 0),(0,re.Z)((0,bt.Z)(n),"sampleRenderTarget",void 0),(0,re.Z)((0,bt.Z)(n),"prevRenderTarget",void 0),(0,re.Z)((0,bt.Z)(n),"outputRenderTarget",void 0),(0,re.Z)((0,bt.Z)(n),"copyRenderTarget",void 0),(0,re.Z)((0,bt.Z)(n),"blendModel",void 0),(0,re.Z)((0,bt.Z)(n),"outputModel",void 0),(0,re.Z)((0,bt.Z)(n),"copyModel",void 0),n}return(0,kt.Z)(t,[{key:"getType",value:function(){return b0.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(r,o){(0,Gm.Z)((0,Et.Z)(t.prototype),"init",this).call(this,r,o);var u=this.rendererService,h=u.createFramebuffer,v=u.createTexture2D;this.sampleRenderTarget=h({color:v({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.prevRenderTarget=h({color:v({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.outputRenderTarget=h({color:v({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.copyRenderTarget=h({color:v({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})});for(var m=0;m<30;m++)this.haltonSequence.push([r1(m,2),r1(m,3)]);this.blendModel=this.createTriangleModel("blend-pass",tS),this.outputModel=this.createTriangleModel("copy-pass",t1,{blend:{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:Y.ONE,dstAlpha:Y.ONE_MINUS_SRC_ALPHA},equation:{rgb:Y.FUNC_ADD,alpha:Y.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",t1)}},{key:"render",value:function(r){var o=this,u=this.rendererService,h=u.clear,v=u.getViewportSize,m=u.useFramebuffer,b=v(),A=b.width,k=b.height;this.sampleRenderTarget.resize({width:A,height:k}),this.prevRenderTarget.resize({width:A,height:k}),this.outputRenderTarget.resize({width:A,height:k}),this.copyRenderTarget.resize({width:A,height:k}),this.resetFrame(),this.stopAccumulating();var L=r.multiPassRenderer.getPostProcessor().getReadFBO();m(L,function(){h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:L}),r.multiPassRenderer.setRenderFlag(!1),r.render(),r.multiPassRenderer.setRenderFlag(!0)});var B=function Z(V){!o.accumulatingId||V!==o.accumulatingId||o.isFinished()||(o.doRender(r),Ui.requestAnimationFrame(function(){Z(V)}))};this.accumulatingId=nS++,this.timer=Ui.setTimeout(function(){B(o.accumulatingId)},50)}},{key:"doRender",value:function(r){var o=this,u=this.rendererService,h=u.clear,v=u.getViewportSize,m=u.useFramebuffer,b=v(),A=b.width,k=b.height,L=r.getLayerConfig(),B=L.jitterScale,Z=B===void 0?1:B,V=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((V[0]*2-1)/A*Z,(V[1]*2-1)/k*Z),r.multiPassRenderer.setRenderFlag(!1),r.hooks.beforeRender.call(),m(this.sampleRenderTarget,function(){h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.sampleRenderTarget}),r.render()}),r.hooks.afterRender.call(),r.multiPassRenderer.setRenderFlag(!0);var K=r.getLayerConfig();m(this.outputRenderTarget,function(){o.blendModel.draw({uniforms:{u_opacity:K.opacity||1,u_MixRatio:o.frame===0?1:.9,u_Diffuse1:o.sampleRenderTarget,u_Diffuse2:o.frame===0?r.multiPassRenderer.getPostProcessor().getReadFBO():o.prevRenderTarget}})}),this.frame===0&&h({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(m(this.copyRenderTarget,function(){o.outputModel.draw({uniforms:{u_Texture:o.outputRenderTarget}})}),m(r.multiPassRenderer.getPostProcessor().getReadFBO(),function(){o.copyModel.draw({uniforms:{u_Texture:o.copyRenderTarget}})}),r.multiPassRenderer.getPostProcessor().render(r));var le=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=le,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Ui.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(r,o,u){this.shaderModuleService.registerModule(r,{vs:rS,fs:o});var h=this.shaderModuleService.getModule(r),v=h.vs,m=h.fs,b=h.uniforms,A=this.rendererService,k=A.createAttribute,L=A.createBuffer,B=A.createModel;return B((0,ae.Z)({vs:v,fs:m,attributes:{a_Position:k({buffer:L({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:(0,ae.Z)({},b),depth:{enable:!1},count:3},u))}}]),t}(Hm),e1=Aa(jg.prototype,"shaderModuleService",[Q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jg))||J_),lm=new Yr.W2;lm.bind(nr.IGlobalConfigService).to(Wd).inSingletonScope(),(0,Yr.GW)((0,Yr.b2)(),Xu.EventEmitter),lm.bind(nr.IEventEmitter).to(Xu.EventEmitter);var n1=(0,xs.Z)(lm,!1),Gg=function(a){var t=n1.lazyInject(a);return function(n,r,o){t.call(this,n,r),o&&(o.initializer=function(){return n[r]})}},nL=function(a){var t=n1.lazyMultiInject(a);return function(n,r,o){t.call(this,n,r),o&&(o.initializer=function(){return n[r]})}},jh=lm,aS=0;function oS(){var e=new Yr.W2;return e.parent=lm,e.bind(nr.SceneID).toConstantValue("".concat(aS++)),e.bind(nr.IShaderModuleService).to(XE).inSingletonScope(),e.bind(nr.ILayerService).to(pe).inSingletonScope(),e.bind(nr.ISceneService).to(ME).inSingletonScope(),e.bind(nr.ICameraService).to(h0).inSingletonScope(),e.bind(nr.ICoordinateSystemService).to(Dg).inSingletonScope(),e.bind(nr.IInteractionService).to($u).inSingletonScope(),e.bind(nr.IPickingService).to(zg).inSingletonScope(),e.bind(nr.IControlService).to(v0).inSingletonScope(),e.bind(nr.IMarkerService).to(G0).inSingletonScope(),e.bind(nr.IIconService).to(Np).inSingletonScope(),e.bind(nr.IFontService).to(sp).inSingletonScope(),e.bind(nr.IPopupService).to(Hd).inSingletonScope(),e.bind(nr.INormalPass).to($E).whenTargetNamed("clear"),e.bind(nr.INormalPass).to(rC).whenTargetNamed("pixelPicking"),e.bind(nr.INormalPass).to(QC).whenTargetNamed("render"),e.bind(nr.INormalPass).to(iS).whenTargetNamed("taa"),e.bind(nr.IFactoryNormalPass).toFactory(function(a){return function(t){return a.container.getNamed(nr.INormalPass,t)}}),e.bind(nr.IPostProcessingPass).to(MC).whenTargetNamed("copy"),e.bind(nr.IPostProcessingPass).to(uC).whenTargetNamed("bloom"),e.bind(nr.IPostProcessingPass).to(pC).whenTargetNamed("blurH"),e.bind(nr.IPostProcessingPass).to(yC).whenTargetNamed("blurV"),e.bind(nr.IPostProcessingPass).to(jC).whenTargetNamed("noise"),e.bind(nr.IPostProcessingPass).to(YC).whenTargetNamed("sepia"),e.bind(nr.IPostProcessingPass).to(CC).whenTargetNamed("colorHalftone"),e.bind(nr.IPostProcessingPass).to(RC).whenTargetNamed("hexagonalPixelate"),e.bind(nr.IPostProcessingPass).to(NC).whenTargetNamed("ink"),e.bind(nr.IFactoryPostProcessingPass).toFactory(function(a){return function(t){var n=a.container.getNamed(nr.IPostProcessingPass,t);return n.setName(t),n}}),e}function Hg(e){var a=new Yr.W2;return a.parent=e,a.bind(nr.IStyleAttributeService).to(Eo).inSingletonScope(),a.bind(nr.IMultiPassRenderer).to(JE).inSingletonScope(),a.bind(nr.IPostProcessor).to(qC).inSingletonScope(),a}var sS=null;function iL(e){return sS.indexOf(e)}var uS=2,aL=4,lS=64,oL=128,cS=256,fS=512,sL=8192,uL=16384,lL=32768,hS=null,i1=131072,cL=262144,pS=524288,fL=1048576,dS=2097152,hL=4194304,vS=8388608,mS=16777216,gS=null;function Wm(e,a){return e=clamp(Math.floor(e),0,255),a=clamp(Math.floor(a),0,255),256*e+a}function pL(e){var a=e.color,t=e.radius,n=e.tileX,r=e.tileY,o=e.shape,u=e.opacity,h=e.stroke,v=e.strokeWidth,m=e.strokeOpacity,b=[],A=[],k=[],L=[Wm(a[0],a[1]),Wm(a[2],a[3])],B=[Wm(h[0],h[1]),Wm(h[2],h[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Z){var V=_slicedToArray(Z,2),K=V[0],le=V[1];b.push([].concat(L,[(K+1)*vS+(le+1)*dS+getShapeIndex(o)*i1+t,(n+512)*pS+(r+512)*lS])),A.push([].concat(B,[v,m])),k.push([u,0,0,0])}),{packedBuffer:b,packedBuffer2:A,packedBuffer3:k}}function dL(e,a){if(e===0&&!a)return 0;if(e===1&&a)return 4294967295;var t=a?1:0,n=Math.floor(e*127);return n*gS+t*mS+n*i1+t*hS+n*fS+t*cS+n*uS+t}var Gh;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Gh||(Gh={}));var ns;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(ns||(ns={}));var E0;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(E0||(E0={}));var Vn;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Vn||(Vn={}));var yS=["mapload","mapchange","mapAfterFrameChange"],ev={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Wg=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],C0;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(C0||(C0={}));function _S(e){var a=xS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function xS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bS=0,Xm=function(e){(0,Pr.Z)(t,e);var a=_S(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this),r.controlOption=(0,ae.Z)((0,ae.Z)({},r.getDefault()),n||{}),r}return(0,kt.Z)(t,[{key:"getDefault",value:function(){return{position:C0.TOPRIGHT,name:"".concat(bS++)}}},{key:"setPosition",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C0.BOTTOMRIGHT,o=this.controlService;return o&&o.removeControl(this),this.controlOption.position=r,o&&o.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(r){this.mapsService=r.get(nr.IMapService),this.renderService=r.get(nr.IRendererService),this.layerService=r.get(nr.ILayerService),this.controlService=r.get(nr.IControlService),this.sceneContainer=r,this.isShow=!0,this.container=this.onAdd();var o=this.container,u=this.controlOption.position,h=this.controlService.controlCorners[u];return Zl(o,"l7-control"),u.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var r=this.container;Zl(r,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var r=this.container;cu(r,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Iu(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(r){if(this.mapsService&&r&&r.screenX>0&&r.screenY>0){var o=this.mapsService.getContainer();o!==null&&o.focus()}}}]),t}(Xu.EventEmitter);function ES(e){var a=CS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function CS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vL=function(e){(0,Pr.Z)(t,e);var a=ES(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.layerControlInputs=[],r.layers=[],r.lastZIndex=0,r.handlingClick=!1,r.initLayers(),p(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,bt.Z)(r)),r}return(0,kt.Z)(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:C0.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var r=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(o){o.layer.on("remove",r.onLayerChange),o.layer.on("add",r.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(r,o){return this.addLayer(r,o,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var r=this.renderService.getViewportSize(),o=r.height;Zl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var u=o-(this.container.offsetTop+50);return u<this.form.clientHeight?(Zl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=u+"px"):cu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return cu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var r=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(o){o.layer.off("remove",r.onLayerChange),o.layer.off("add",r.onLayerChange)}))}},{key:"initLayout",value:function(){var r="l7-control-layers",o=this.container=Mo("div",r),u=this.controlOption.collapsed;o.setAttribute("aria-haspopup","true");var h=this.form=Mo("form",r+"-list");u&&(this.mapsService.on("click",this.collapse),o.addEventListener("mouseenter",this.expand),o.addEventListener("mouseleave",this.collapse)),this.layersLink=Mo("a",r+"-toggle",o);var v=this.layersLink;v.title="Layers",u||this.expand(),this.baseLayersList=Mo("div",r+"-base",h),this.separator=Mo("div",r+"-separator",h),this.overlaysList=Mo("div",r+"-overlays",h),o.appendChild(h)}},{key:"initLayers",value:function(){var r=this,o=this.controlOption,u=o.baseLayers,h=u===void 0?{}:u,v=o.overlayers,m=v===void 0?{}:v;Object.keys(h).forEach(function(b,A){r.addLayer(h[b],b,!1)}),Object.keys(m).forEach(function(b,A){r.addLayer(m[b],b,!0)})}},{key:"update",value:function(){if(!this.container)return this;Vl(this.baseLayersList),Vl(this.overlaysList),this.layerControlInputs=[];var r,o,u,h,v=0;for(u=0;u<this.layers.length;u++)h=this.layers[u],this.addItem(h),o=o||h.overlay,r=r||!h.overlay,v+=h.overlay?0:1;return this.controlOption.hideSingleBase&&(r=r&&v>1,this.baseLayersList.style.display=r?"":"none"),this.separator.style.display=o&&r?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var r=this.layerControlInputs,o,u,h=this.mapsService.getZoom(),v=r.length-1;v>=0;v--)if(o=r[v],u=this.layerService.getLayer(o.layerId),u&&u.inited){var m=u.getMinZoom(),b=u.getMaxZoom();o.disabled=h<m||h>b}}},{key:"addLayer",value:function(r,o,u){this.mapsService&&(r.on("add",this.onLayerChange),r.on("remove",this.onLayerChange)),this.layers.push({layer:r,name:o,overlay:u});var h=this.controlOption,v=h.sortLayers,m=h.sortFunction,b=h.autoZIndex;v&&this.layers.sort(function(A,k){return m(A.layer,k.layer,A.name,k.name)}),b&&r.setZIndex&&(this.lastZIndex++,r.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(r){this.handlingClick||this.update();var o=this.layerService.getLayer(r.target.layerId),u=o!=null&&o.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;u&&this.emit(u,o)}},{key:"createRadioElement",value:function(r,o){var u='<input type="radio" class="l7-control-layers-selector" name="'+r+'"'+(o?' checked="checked"':"")+"/>",h=document.createElement("div");return h.innerHTML=u,h.firstChild}},{key:"addItem",value:function(r){var o=document.createElement("label"),u=this.layerService.getLayer(r.layer.id),h=u&&u.inited&&r.layer.isVisible(),v;r.overlay?(v=document.createElement("input"),v.type="checkbox",v.className="l7-control-layers-selector",v.defaultChecked=h):v=this.createRadioElement("l7-base-layers",h),this.layerControlInputs.push(v),v.layerId=r.layer.id,v.addEventListener("click",this.onInputClick);var m=document.createElement("span");m.innerHTML=" "+r.name;var b=document.createElement("div");o.appendChild(b),b.appendChild(v),b.appendChild(m);var A=r.overlay?this.overlaysList:this.baseLayersList;return A.appendChild(o),this.checkDisabledLayers(),o}},{key:"onInputClick",value:function(){var r=this.layerControlInputs,o,u,h=[],v=[];this.handlingClick=!0;for(var m=r.length-1;m>=0;m--)o=r[m],u=this.layerService.getLayer(o.layerId),o.checked?h.push(u):o.checked||v.push(u);v.forEach(function(b){b.hide()}),h.forEach(function(b){b.show()}),this.handlingClick=!1}}]),t}(Xm);function SS(e){var a=AS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function AS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wS=function(e){(0,Pr.Z)(t,e);var a=SS(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getDefault",value:function(){return{position:C0.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var r="l7-control-logo",o=Mo("div",r),u=Mo("a","l7-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://antv.alipay.com/l7",u.setAttribute("aria-label","AntV logo"),u.setAttribute("rel","noopener nofollow"),o.appendChild(u),o}},{key:"onRemove",value:function(){return null}}]),t}(Xm);function TS(e){var a=MS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mL=function(e){(0,Pr.Z)(t,e);var a=TS(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),p(["update"],(0,bt.Z)(r)),r}return(0,kt.Z)(t,[{key:"getDefault",value:function(){return{position:C0.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var r="l7-control-scale",o=Mo("div",r);this.addScales(r+"-line",o);var u=this.controlOption.updateWhenIdle;return this.mapsService.on(u?"moveend":"mapmove",this.update),this.mapsService.on(u?"zoomend":"zoomchange",this.update),this.update(),o}},{key:"onRemove",value:function(){var r=this.controlOption.updateWhenIdle;this.mapsService.off(r?"zoomend":"zoomchange",this.update),this.mapsService.off(r?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var r=this.mapsService,o=this.controlOption.maxWidth,u=r.getSize()[1]/2,h=r.containerToLngLat([0,u]),v=r.containerToLngLat([o,u]),m=th([h.lng,h.lat],[v.lng,v.lat]);this.updateScales(m)}},{key:"updateScales",value:function(r){var o=this.controlOption,u=o.metric,h=o.imperial;u&&r&&this.updateMetric(r),h&&r&&this.updateImperial(r)}},{key:"updateMetric",value:function(r){var o=this.getRoundNum(r),u=o<1e3?o+" m":o/1e3+" km";this.updateScale(this.mScale,u,o/r)}},{key:"updateImperial",value:function(r){var o=r*3.2808399,u,h,v;o>5280?(u=o/5280,h=this.getRoundNum(u),this.updateScale(this.iScale,h+" mi",h/u)):(v=this.getRoundNum(o),this.updateScale(this.iScale,v+" ft",v/o))}},{key:"updateScale",value:function(r,o,u){var h=this.controlOption.maxWidth;r.style.width=Math.round(h*u)+"px",r.innerHTML=o}},{key:"getRoundNum",value:function(r){var o=Math.pow(10,(Math.floor(r)+"").length-1),u=r/o;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,o*u}},{key:"addScales",value:function(r,o){var u=this.controlOption,h=u.metric,v=u.imperial;h&&(this.mScale=Mo("div",r,o)),v&&(this.iScale=Mo("div",r,o))}}]),t}(Xm);function IS(e){var a=kS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function kS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gL=function(e){(0,Pr.Z)(t,e);var a=IS(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),p(["updateDisabled","zoomIn","zoomOut"],(0,bt.Z)(r)),r}return(0,kt.Z)(t,[{key:"getDefault",value:function(){return{position:C0.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var r="l7-control-zoom",o=Mo("div",r+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,r+"-in",o,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,r+"-out",o,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),o}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(r,o,u,h,v){var m=Mo("a",u,h);return m.innerHTML=r,m.title=o,m.href="javascript:void(0)",m.addEventListener("click",v),m}},{key:"updateDisabled",value:function(){var r=this.mapsService,o="l7-disabled";cu(this.zoomInButton,o),cu(this.zoomOutButton,o),(this.disabled||r.getZoom()<=r.getMinZoom())&&Zl(this.zoomOutButton,o),(this.disabled||r.getZoom()>=r.getMaxZoom())&&Zl(this.zoomInButton,o)}}]),t}(Xm);function PS(e){var a=LS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function LS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a1=function(e){(0,Pr.Z)(t,e);var a=PS(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this),(0,re.Z)((0,bt.Z)(r),"added",!1),(0,re.Z)((0,bt.Z)(r),"eventHandle",function(o){r.emit(o.type,{target:o,data:r.markerOption.extData,lngLat:r.lngLat})}),r.markerOption=(0,ae.Z)((0,ae.Z)({},r.getDefault()),n),p(["update","onMove","onUp","addDragHandler","onMapClick"],(0,bt.Z)(r)),r.init(),r}return(0,kt.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:ne.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(r){this.scene=r,this.mapsService=r.get(nr.IMapService),this.sceneSerive=r.get(nr.ISceneService);var o=this.markerOption,u=o.element,h=o.draggable;return this.mapsService.getMarkerContainer().appendChild(u),this.registerMarkerEvent(u),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var r=this.markerOption.element;return r&&Iu(r),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(r){var o=this;if(!this.added)return this.once("added",function(){o.setElement(r)}),this;var u=this.markerOption.element;return u&&Iu(u),this.markerOption.element=r,this.init(),this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.update(),this}},{key:"openPopup",value:function(){var r=this;if(!this.added)return this.once("added",function(){r.openPopup()}),this;var o=this.popup;return o?(o.isOpen()||o.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var r=this;this.added||this.once("added",function(){r.closePopup()});var o=this.popup;return o&&o.remove(),this}},{key:"setPopup",value:function(r){return this.popup=r,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var r=this.popup;if(r)r.isOpen()?r.remove():r.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(r){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(r){this.markerOption.extData=r}},{key:"update",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.anchor;this.updatePosition(),nl(o,"".concat(Se[u]))}}},{key:"onMapClick",value:function(r){var o=this.markerOption.element;this.popup&&o&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var r=this.mapsService.getContainer();return{containerHeight:(r==null?void 0:r.scrollHeight)||0,containerWidth:(r==null?void 0:r.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.markerOption,o=r.element,u=r.offsets,h=this.lngLat,v=h.lng,m=h.lat,b=this.mapsService.lngLatToContainer([v,m]);if(o){o.style.display="block",o.style.whiteSpace="nowrap";var A=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),k=A.containerHeight,L=A.containerWidth,B=A.bounds;if(!B)return;if(Math.abs(B[0][0])>180||Math.abs(B[1][0])>180){if(b.x>L){var Z=this.mapsService.lngLatToContainer([v-360,m]);b.x=Z.x}if(b.x<0){var V=this.mapsService.lngLatToContainer([v+360,m]);b.x=V.x}}(b.x>L||b.x<0||b.y>k||b.y<0)&&(o.style.display="none"),o.style.left=b.x+u[0]+"px",o.style.top=b.y-u[1]+"px"}}}},{key:"init",value:function(){var r=this,o=this.markerOption.element,u=this.markerOption,h=u.color,v=u.anchor;if(!o){this.defaultMarker=!0,o=Mo("div"),this.markerOption.element=o;var m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height","48px"),m.setAttributeNS(null,"width","48px"),m.setAttributeNS(null,"viewBox","0 0 1024 1024");var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),b.setAttributeNS(null,"fill",h),m.appendChild(b),o.appendChild(m)}Zl(o,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(A){var k,L,B=((k=r.markerOption)===null||k===void 0?void 0:k.style)&&((L=r.markerOption)===null||L===void 0?void 0:L.style[A]);o&&(o.style[A]=B)}),o.addEventListener("click",function(A){r.onMapClick(A)}),o.addEventListener("click",this.eventHandle),Me(o,v,"marker")}},{key:"registerMarkerEvent",value:function(r){r.addEventListener("mousemove",this.eventHandle),r.addEventListener("click",this.eventHandle),r.addEventListener("mousedown",this.eventHandle),r.addEventListener("mouseup",this.eventHandle),r.addEventListener("dblclick",this.eventHandle),r.addEventListener("contextmenu",this.eventHandle),r.addEventListener("mouseover",this.eventHandle),r.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var r=this.getElement();r.removeEventListener("mousemove",this.eventHandle),r.removeEventListener("click",this.eventHandle),r.removeEventListener("mousedown",this.eventHandle),r.removeEventListener("mouseup",this.eventHandle),r.removeEventListener("dblclick",this.eventHandle),r.removeEventListener("contextmenu",this.eventHandle),r.removeEventListener("mouseover",this.eventHandle),r.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(r){throw new Error("Method not implemented.")}},{key:"onUp",value:function(r){throw new Error("Method not implemented.")}}]),t}(Xu.EventEmitter);function RS(e){var a=OS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function OS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yL=function(e){(0,Pr.Z)(t,e);var a=RS(t);function t(n){var r,o;return(0,Zt.Z)(this,t),o=a.call(this),(0,re.Z)((0,bt.Z)(o),"markers",[]),(0,re.Z)((0,bt.Z)(o),"points",[]),(0,re.Z)((0,bt.Z)(o),"clusterMarkers",[]),o.markerLayerOption=(0,d.merge)(o.getDefault(),n),p(["update"],(0,bt.Z)(o)),o.zoom=((r=o.markerLayerOption.clusterOption)===null||r===void 0?void 0:r.zoom)||-99,o}return(0,kt.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(r){return this.scene=r,this.mapsService=r.get(nr.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var r=this.mapsService.getContainer();this.containerSize={containerWidth:(r==null?void 0:r.scrollWidth)||0,containerHeight:(r==null?void 0:r.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(r){var o=this.markerLayerOption.cluster;if(r.getMarkerLayerContainerSize=this.getContainerSize.bind(this),o&&(this.addPoint(r,this.markers.length),this.mapsService)){var u=this.mapsService.getZoom(),h=this.mapsService.getBounds();this.bbox=ll(h,.5),this.zoom=Math.floor(u),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(r)}},{key:"removeMarker",value:function(r){this.markers.indexOf(r);var o=this.markers.indexOf(r);o>-1&&this.markers.splice(o,1)}},{key:"hide",value:function(){this.markers.map(function(r){r.getElement().style.opacity="0"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(r){r.getElement().style.opacity="1"}),this.clusterMarkers.map(function(r){r.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var r=this.markerLayerOption.cluster;return r?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var r=this;this.getMarkers().forEach(function(o){o.addTo(r.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(r){r.remove()}),this.clusterMarkers.forEach(function(r){r.remove()}),this.mapsService.off("camerachange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this)),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(r,o){var u=r.getLnglat(),h=u.lng,v=u.lat,m={geometry:{type:"Point",coordinates:[h,v]},properties:(0,ae.Z)((0,ae.Z)({},r.getExtData()),{},{marker_id:o})};this.points.push(m),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var r=this.markerLayerOption.clusterOption,o=r.radius,u=r.minZoom,h=u===void 0?0:u,v=r.maxZoom;this.clusterIndex=new(C())({radius:o,minZoom:h,maxZoom:v}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(r,o){var u=this,h=r[0].concat(r[1]),v=this.clusterIndex.getClusters(h,o);this.clusterMarkers.forEach(function(m){m.remove()}),this.clusterMarkers=[],v.forEach(function(m){var b,A=u.markerLayerOption.clusterOption,k=A.field,L=A.method;if(m.properties&&(b=m.properties)!==null&&b!==void 0&&b.cluster_id){var B,Z=u.getLeaves((B=m.properties)===null||B===void 0?void 0:B.cluster_id);if(m.properties.clusterData=Z,k&&L){var V=Z==null?void 0:Z.map(function(et){var at=(0,re.Z)({},k,et.properties[k]);return at}),K=Rc(V,k),le=Ih(L,K),be="point_"+L;m.properties[be]=le.toFixed(2)}}var Be=u.clusterMarker(m);u.clusterMarkers.push(Be),Be.addTo(u.scene)})}},{key:"getLeaves",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return r?this.clusterIndex.getLeaves(r,o,u):null}},{key:"clusterMarker",value:function(r){var o=this.markerLayerOption.clusterOption,u=o,h=u.element,v=h===void 0?this.generateElement.bind(this):h,m=new a1({element:v(r)}).setLnglat({lng:r.geometry.coordinates[0],lat:r.geometry.coordinates[1]});return m}},{key:"normalMarker",value:function(r){var o=r.properties.marker_id;return this.markers[o]}},{key:"update",value:function(){if(!!this.mapsService){var r=this.mapsService.getZoom(),o=this.mapsService.getBounds();(!this.bbox||Math.abs(r-this.zoom)>=1||!ac(this.bbox,o))&&(this.bbox=ll(o,.5),this.zoom=Math.floor(r),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(r){var o=Mo("div","l7-marker-cluster"),u=Mo("div","",o),h=Mo("span","",u),v=this.markerLayerOption.clusterOption,m=v.field,b=v.method;r.properties.point_count=r.properties.point_count||1;var A=m&&b?r.properties["point_"+b]||r.properties[m]:r.properties.point_count;return h.textContent=A,o}}]),t}(Xu.EventEmitter);function FS(e){var a=DS();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function DS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o1=function(e){(0,Pr.Z)(t,e);var a=FS(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this),r.popupOption=(0,ae.Z)((0,ae.Z)({},r.getdefault()),n),p(["update","onClickClose","remove"],(0,bt.Z)(r)),r}return(0,kt.Z)(t,[{key:"addTo",value:function(r){var o=this;return this.mapsService=r.get(nr.IMapService),this.sceneSerive=r.get(nr.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=r,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){o.mapsService.on("click",o.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(r){var o=window.document.createDocumentFragment(),u=window.document.createElement("body"),h;for(u.innerHTML=r;h=u.firstChild,!!h;)o.appendChild(h);return this.setDOMContent(o)}},{key:"setLnglat",value:function(r){return this.lngLat=r,Array.isArray(r)&&(this.lngLat={lng:r[0],lat:r[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(r){return this.setDOMContent(window.document.createTextNode(r))}},{key:"setMaxWidth",value:function(r){return this.popupOption.maxWidth=r,this.update(),this}},{key:"setDOMContent",value:function(r){return this.createContent(),this.content.appendChild(r),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Iu(this.content),this.content=Mo("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Mo("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(r,o,u){var h=window.document.createElement(r);return o!==void 0&&(h.className=o),u&&u.appendChild(h),h}},{key:"removeDom",value:function(r){r.parentNode&&r.parentNode.removeChild(r)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:ne.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(r){r.stopPropagation&&r.stopPropagation(),this.remove()}},{key:"update",value:function(){var r=this,o=this.lngLat,u=this.popupOption,h=u.className,v=u.maxWidth,m=u.anchor;if(!(!this.mapsService||!o||!this.content)){var b=this.mapsService.getMarkerContainer();if(!this.container&&b){this.container=this.creatDom("div","l7-popup",b),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),h&&h.split(" ").forEach(function(k){return r.container.classList.add(k)});var A=this.popupOption.stopPropagation;A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(k){r.container.addEventListener(k,function(L){L.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}v&&this.container.style.maxWidth!==v&&(this.container.style.maxWidth=v),this.updatePosition(),nl(this.container,"".concat(Se[m])),Me(this.container,m,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var r=this.lngLat,o=r.lng,u=r.lat,h=this.popupOption.offsets,v=this.mapsService.lngLatToContainer([o,u]);this.container.style.left=v.x+h[0]+"px",this.container.style.top=v.y-h[1]+"px"}}}]),t}(Xu.EventEmitter);function BS(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}BS(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var S0,Xg=(S0={},(0,re.Z)(S0,Gh.additive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:1,dstAlpha:1}}),(0,re.Z)(S0,Gh.none,{enable:!1}),(0,re.Z)(S0,Gh.normal,{enable:!0,func:{srcRGB:Y.SRC_ALPHA,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,re.Z)(S0,Gh.subtractive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:Y.ZERO,dstAlpha:Y.ONE_MINUS_SRC_COLOR},equation:{rgb:Y.FUNC_SUBTRACT,alpha:Y.FUNC_SUBTRACT}}),(0,re.Z)(S0,Gh.max,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MAX_EXT}}),(0,re.Z)(S0,Gh.min,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MIN_EXT}}),S0),_L=1024;function Gf(e,a,t,n,r){a.updateStyleAttribute(e,t,n,r)}function NS(e,a){e.opacity&&Ym("opacity",a,e.opacity),e.strokeWidth&&Ym("strokeWidth",a,e.strokeWidth),e.strokeOpacity&&Ym("strokeOpacity",a,e.strokeOpacity),e.stroke&&zS("stroke",a,e.stroke),e.offsets&&s1("offsets",a,e.offsets),e.textOffset&&s1("textOffset",a,e.textOffset),e.thetaOffset&&Ym("thetaOffset",a,e.thetaOffset)}function Ym(e,a,t){(0,d.isString)(t)?Gf(e,a,t,function(n){return n}):(0,d.isNumber)(t)?Gf(e,a,[t],void 0):Array.isArray(t)&&t.length===2?(0,d.isString)(t[0])&&(0,d.isFunction)(t[1])||(0,d.isString)(t[0])&&Array.isArray(t[1])&&(0,d.isNumber)(t[1][0])&&(0,d.isNumber)(t[1][1])?Gf(e,a,t[0],t[1]):Gf(e,a,[1],void 0):Gf(e,a,[1],void 0)}function s1(e,a,t){(0,d.isString)(t)?Gf(e,a,t,function(n){return n}):Array.isArray(t)&&t.length===2&&(0,d.isString)(t[0])&&(0,d.isFunction)(t[1])?Gf(e,a,t[0],t[1]):Array.isArray(t)&&t.length===2&&(0,d.isNumber)(t[0])&&(0,d.isNumber)(t[1])?Gf(e,a,t,void 0):Gf(e,a,[0,0],void 0)}function zS(e,a,t){(0,d.isString)(t)?Gf(e,a,t,void 0):Array.isArray(t)&&t.length===2&&((0,d.isString)(t[0])&&(0,d.isFunction)(t[1])||(0,d.isString)(t[0])&&Array.isArray(t[1])&&t[1].length>0)?Gf(e,a,t[0],t[1]):Gf(e,a,"#fff",void 0)}var Uu;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Uu||(Uu={}));function US(e,a){var t=[a[0]-e[0],a[1]-e[1]],n=oc(t),r=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return r}function ZS(e,a){var t=this;e.length>0&&a.version===Uu["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Uu["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=t.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Uu["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=t.mapService.lngLatToCoords(n.coordinates)}))}function VS(e,a){e.length>0&&a.version===Uu.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=jS(t.coordinates,a),t.simpleCoordinate=!0)})}function jS(e,a){if(typeof e[0]=="number")return a.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(r){var o=[];r.map(function(u){o.push(a.simpleMapCoord.unproject(u))}),t.push(o)}),t}else{var n=[];return e.map(function(r){n.push(a.simpleMapCoord.unproject(r))}),n}}function GS(e,a,t){var n;if(!e.scale)return[];var r=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],o=[];r.forEach(function(h){var v,m=h.field;(a.hasOwnProperty(m)||((v=e.scale)===null||v===void 0?void 0:v.type)==="variable")&&o.push(a[m])});var u=e.mapping?e.mapping(o):[];return e.name==="color"&&!S(u[0])?[t]:u}function HS(e,a,t,n,r,o){var u=o==null?void 0:o.getLayerConfig(),h=u.arrow,v=h===void 0?{enable:!1}:h,m=a.map(function(b){var A={id:b._id,coordinates:b.coordinates};if(e.filter(function(B){return B.scale!==void 0}).forEach(function(B){var Z=GS(B,b,r);B.needRemapping=!1,B.name==="color"&&(Z=Z.map(function(V){return I(V)})),A[B.name]=Array.isArray(Z)&&Z.length===1?Z[0]:Z,B.name==="shape"&&(A.shape=t.getIconFontKey(A[B.name]))}),A.shape==="line"&&v.enable){var k=A.coordinates,L=US(k[0],k[1]);A.coordinates.splice(1,0,L,L)}return A});return ZS(m,n),VS(m,n),m}function WS(e,a,t,n,r,o){var u=new Zo(r,o),h=e.getBottomColor(),v=n.getLayerStyleAttributes()||[],m=u.data.dataArray,b=m,A=HS(v,b,a,t,h,e);return u.destroy(),A}function u1(e){return e.map(function(a){return typeof a=="string"&&(a=[a,{}]),a})}function l1(e,a,t,n){var r=e.multiPassRenderer,o=e.getLayerConfig(),u=o.enablePicking,h=o.enableTAA;return h?r.add(n("taa")):r.add(n("render")),u1(a).forEach(function(v){var m=(0,Mr.Z)(v,2),b=m[0],A=m[1];r.add(t(b),A)}),r.add(t("copy")),r}var XS=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function YS(e,a,t){if(typeof a=="string"&&typeof t=="string"&&a!==t){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}XS.map(function(n){if(n.includes(a)&&n.includes(t)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var qS=["passes"],$S=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber","workerEnabled","workerOptions"],c1,Yg,f1;function KS(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=QS(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function QS(e,a){if(!!e){if(typeof e=="string")return h1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return h1(e,a)}}function h1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function JS(e){var a=eA();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function eA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p1=0,Sd=(c1=Gg(nr.IGlobalConfigService),Yg=function(e){(0,Pr.Z)(t,e);var a=JS(t);function t(){var n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Zt.Z)(this,t),n=a.call(this),(0,re.Z)((0,bt.Z)(n),"id","".concat(p1++)),(0,re.Z)((0,bt.Z)(n),"name","".concat(p1)),(0,re.Z)((0,bt.Z)(n),"visible",!0),(0,re.Z)((0,bt.Z)(n),"zIndex",0),(0,re.Z)((0,bt.Z)(n),"inited",!1),(0,re.Z)((0,bt.Z)(n),"layerModelNeedUpdate",!1),(0,re.Z)((0,bt.Z)(n),"pickedFeatureID",null),(0,re.Z)((0,bt.Z)(n),"selectedFeatureID",null),(0,re.Z)((0,bt.Z)(n),"styleNeedUpdate",!1),(0,re.Z)((0,bt.Z)(n),"clusterZoom",0),(0,re.Z)((0,bt.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,re.Z)((0,bt.Z)(n),"hooks",{init:new i,afterInit:new i,beforeRender:new i,beforeRenderData:new Dd,afterRender:new Kl,beforePickingEncode:new Kl,afterPickingEncode:new Kl,beforeHighlight:new Kl(["pickedColor"]),afterHighlight:new Kl,beforeSelect:new Kl(["pickedColor"]),afterSelect:new Kl,beforeDestroy:new Kl,afterDestroy:new Kl}),(0,re.Z)((0,bt.Z)(n),"models",[]),(0,re.Z)((0,bt.Z)(n),"layerChildren",[]),(0,re.Z)((0,bt.Z)(n),"masks",[]),(0,re.Z)((0,bt.Z)(n),"isVector",!1),ka((0,bt.Z)(n),"configService",f1,(0,bt.Z)(n)),(0,re.Z)((0,bt.Z)(n),"animateOptions",{enable:!1}),(0,re.Z)((0,bt.Z)(n),"currentPickId",null),(0,re.Z)((0,bt.Z)(n),"pendingStyleAttributes",[]),(0,re.Z)((0,bt.Z)(n),"scaleOptions",{}),(0,re.Z)((0,bt.Z)(n),"aniamateStatus",!1),(0,re.Z)((0,bt.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,re.Z)((0,bt.Z)(n),"isDestroied",!1),(0,re.Z)((0,bt.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var o=n.getLayerConfig();o&&o.autoFit&&n.fitBounds(o.fitBoundsOptions),n.reRender()}),n.name=r.name||n.id,n.zIndex=r.zIndex||0,n.rawConfig=r,n}return(0,kt.Z)(t,[{key:"addMaskLayer",value:function(r){this.masks.push(r)}},{key:"removeMaskLayer",value:function(r){var o=this.masks.indexOf(r);o>-1&&this.masks.splice(o,1),r.destroy()}},{key:"getAttribute",value:function(r){return this.styleAttributeService.getLayerStyleAttribute(r)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(r){var o=this;if(Object.keys(r).map(function(h){h in o.rawConfig&&(o.rawConfig[h]=r[h])}),!this.inited)this.needUpdateConfig=(0,ae.Z)((0,ae.Z)({},this.needUpdateConfig),r);else{var u=this.container.get(nr.SceneID);NS(r,this),this.configService.setLayerConfig(u,this.id,(0,ae.Z)((0,ae.Z)((0,ae.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),r)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(r,o){this.container=r,this.sceneContainer=o}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(r){this.bottomColor=r}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(r){return this.plugins.push(r),this}},{key:"init",value:function(){var r=this,o=this.container.get(nr.SceneID);this.configService.setLayerConfig(o,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(nr.IIconService),this.fontService=this.container.get(nr.IFontService),this.rendererService=this.container.get(nr.IRendererService),this.layerService=this.container.get(nr.ILayerService),this.interactionService=this.container.get(nr.IInteractionService),this.pickingService=this.container.get(nr.IPickingService),this.mapService=this.container.get(nr.IMapService);var u=this.getLayerConfig(),h=u.enableMultiPassRenderer,v=u.passes;h&&v!==null&&v!==void 0&&v.length&&v.length>0&&this.mapService.on("mapAfterFrameChange",function(){r.renderLayers()}),this.cameraService=this.container.get(nr.ICameraService),this.coordinateService=this.container.get(nr.ICoordinateSystemService),this.shaderModuleService=this.container.get(nr.IShaderModuleService),this.postProcessingPassFactory=this.container.get(nr.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(nr.IFactoryNormalPass),this.styleAttributeService=this.container.get(nr.IStyleAttributeService),this.multiPassRenderer=this.container.get(nr.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(k){var L=k.attributeName,B=k.attributeField,Z=k.attributeValues,V=k.updateOptions;r.styleAttributeService.updateStyleAttribute(L,{scale:(0,ae.Z)({field:B},r.splitValuesAndCallbackInAttribute(Z,r.getLayerConfig()[L]))},V)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(nr.ILayerPlugin);var m=KS(this.plugins),b;try{for(m.s();!(b=m.n()).done;){var A=b.value;A.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(k){m.e(k)}finally{m.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models.map(function(o){o.updateAttributesAndElements(r.attributes,r.elements)}):console.warn("data error")}},{key:"createModelData",value:function(r,o){var u;if((u=this.layerModel)!==null&&u!==void 0&&u.createModelData)return this.layerModel.createModelData(o);var h=this.calculateEncodeData(r,o),v=this.triangulation;return h&&v?this.styleAttributeService.createAttributesAndIndices(h,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(r,o){return this.inited?WS(this,this.fontService,this.mapService,this.styleAttributeService,r,o):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig((0,ae.Z)((0,ae.Z)({},this.getDefaultConfig()),this.rawConfig));var r=this.getLayerConfig(),o=r.animateOption;o!=null&&o.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(r,o,u){return this.updateStyleAttribute("color",r,o,u),this}},{key:"texture",value:function(r,o,u){return this.updateStyleAttribute("texture",r,o,u),this}},{key:"rotate",value:function(r,o,u){return this.updateStyleAttribute("rotate",r,o,u),this}},{key:"size",value:function(r,o,u){return this.updateStyleAttribute("size",r,o,u),this}},{key:"filter",value:function(r,o,u){return this.updateStyleAttribute("filter",r,o,u),this}},{key:"shape",value:function(r,o,u){var h,v,m,b=(h=this.styleAttributeService)===null||h===void 0||(v=h.getLayerStyleAttribute("shape"))===null||v===void 0||(m=v.scale)===null||m===void 0?void 0:m.field,A=r;return this.shapeOption={field:r,values:o},this.updateStyleAttribute("shape",r,o,u),this.tileLayer||YS(this,b,A),this}},{key:"label",value:function(r,o,u){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:r,attributeValues:o,updateOptions:u}),this}},{key:"animate",value:function(r){var o={};return(0,d.isObject)(r)?(o.enable=!0,o=(0,ae.Z)((0,ae.Z)({},o),r)):o.enable=r,this.updateLayerConfig({animateOption:o}),this}},{key:"source",value:function(r,o){return r!=null&&r.data?(this.setSource(r),this):(this.sourceOption={data:r,options:o},this.clusterZoom=0,this)}},{key:"setData",value:function(r,o){var u=this;return this.inited?this.layerSource.setData(r,o):this.on("inited",function(){var h=u.getSource();h?u.layerSource.setData(r,o):(u.source(new Zo(r,o)),u.sourceEvent())}),this}},{key:"style",value:function(r){var o=this,u=this.getLayerConfig(),h=r.passes,v=(0,ue.Z)(r,qS);return h&&u1(h).forEach(function(m){var b=o.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(m[0]);b&&b.updateOptions(m[1])}),this.rawConfig=(0,ae.Z)((0,ae.Z)({},this.rawConfig),v),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),u&&u.mask===!0&&r.mask===!1&&(this.clearModels(),this.layerModel.buildModels(function(m){o.models=m})),this}},{key:"scale",value:function(r,o){return(0,d.isObject)(r)?this.scaleOptions=(0,ae.Z)((0,ae.Z)({},this.scaleOptions),r):this.scaleOptions[r]=o,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer!==void 0?(this.tileLayer.render(),this):(this.getEncodedData()&&this.getEncodedData().length!==0&&this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var n=(0,_a.Z)(di().mark(function o(){return di().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(!(this.getEncodedData()&&this.getEncodedData().length!==0)){h.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){h.next=6;break}return h.next=4,this.multiPassRenderer.render();case 4:h.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return h.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"active",value:function(r){var o={};return o.enableHighlight=(0,d.isObject)(r)?!0:r,(0,d.isObject)(r)?(o.enableHighlight=!0,r.color&&(o.highlightColor=r.color),r.mix&&(o.activeMix=r.mix)):o.enableHighlight=!!r,this.updateLayerConfig(o),this}},{key:"setActive",value:function(r,o){var u=this;if((0,d.isObject)(r)){var h=r.x,v=h===void 0?0:h,m=r.y,b=m===void 0?0:m;this.updateLayerConfig({highlightColor:(0,d.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,d.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.pick({x:v,y:b})}else this.updateLayerConfig({pickedFeatureID:r,highlightColor:(0,d.isObject)(o)?o.color:this.getLayerConfig().highlightColor,activeMix:(0,d.isObject)(o)?o.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(z(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"select",value:function(r){var o={};return o.enableSelect=(0,d.isObject)(r)?!0:r,(0,d.isObject)(r)?(o.enableSelect=!0,r.color&&(o.selectColor=r.color),r.mix&&(o.selectMix=r.mix)):o.enableSelect=!!r,this.updateLayerConfig(o),this}},{key:"setSelect",value:function(r,o){var u=this;if((0,d.isObject)(r)){var h=r.x,v=h===void 0?0:h,m=r.y,b=m===void 0?0:m;this.updateLayerConfig({selectColor:(0,d.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,d.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.pick({x:v,y:b})}else this.updateLayerConfig({pickedFeatureID:r,selectColor:(0,d.isObject)(o)?o.color:this.getLayerConfig().selectColor,selectMix:(0,d.isObject)(o)?o.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(z(r)).then(function(){setTimeout(function(){u.reRender()},1)})}},{key:"setBlend",value:function(r){return this.updateLayerConfig({blend:r}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(r){return this.zIndex=r,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(r){this.currentPickId=r}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(r){this.selectedFeatureID=r}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var r=this.mapService.getZoom(),o=this.getLayerConfig(),u=o.visible,h=o.minZoom,v=h===void 0?-Infinity:h,m=o.maxZoom,b=m===void 0?Infinity:m;return!!u&&r>=v&&r<=b}},{key:"setMultiPass",value:function(r,o){if(this.updateLayerConfig({enableMultiPassRenderer:r}),o&&this.updateLayerConfig({passes:o}),r){var u=this.getLayerConfig(),h=u.passes,v=h===void 0?[]:h;this.multiPassRenderer=l1(this,v,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var m=this.rendererService.getViewportSize(),b=m.width,A=m.height;this.multiPassRenderer.resize(b,A)}return this}},{key:"setMinZoom",value:function(r){return this.updateLayerConfig({minZoom:r}),this}},{key:"getMinZoom",value:function(){var r=this.getLayerConfig(),o=r.minZoom;return o}},{key:"getMaxZoom",value:function(){var r=this.getLayerConfig(),o=r.maxZoom;return o}},{key:"get",value:function(r){var o=this.getLayerConfig();return o[r]}},{key:"setMaxZoom",value:function(r){return this.updateLayerConfig({maxZoom:r}),this}},{key:"setAutoFit",value:function(r){return this.updateLayerConfig({autoFit:r}),this}},{key:"fitBounds",value:function(r){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var o=this.getSource(),u=o.extent,h=u.some(function(v){return Math.abs(v)===Infinity});return h?this:(this.mapService.fitBounds([[u[0],u[1]],[u[2],u[3]]],r),this)}},{key:"destroy",value:function(){var r,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroied||(this.layerChildren.map(function(u){return u.destroy()}),this.layerChildren=[],this.masks.map(function(u){return u.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("sourceUpdate",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[],this.layerService.cleanRemove(this,o),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var r;this.models.forEach(function(o){return o.destroy()}),(r=this.layerModel)===null||r===void 0||r.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(r){return r.needRescale||r.needRemapping||r.needRegenerateVertices}).length}},{key:"setSource",value:function(r){var o=this;if(this.layerSource&&this.layerSource.off("sourceUpdate",this.sourceEvent),this.layerSource=r,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var u=this.mapService.getZoom();this.layerSource.updateClusterData(u)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("sourceUpdate",function(){o.sourceEvent()})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(r){this.encodedData=r}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(r){return this.styleAttributeService.getLayerAttributeScale(r)}},{key:"getLegendItems",value:function(r){var o=this.styleAttributeService.getLayerAttributeScale(r);if(!o)return[];if(o.invertExtent){var u=o.range().map(function(m){return(0,re.Z)({value:o.invertExtent(m)},r,m)});return u}else if(o.ticks){var h=o.ticks().map(function(m){return(0,re.Z)({value:m},r,o(m))});return h}else if(o!=null&&o.domain){var v=o.domain().filter(function(m){return!(0,d.isUndefined)(m)}).map(function(m){return(0,re.Z)({value:m},r,o(m))});return v}return[]}},{key:"pick",value:function(r){var o=r.x,u=r.y;this.interactionService.triggerHover({x:o,y:u})}},{key:"boxSelect",value:function(r,o){this.pickingService.boxPickLayer(this,r,o)}},{key:"buildLayerModel",value:function(r){var o=this,u=r.moduleName,h=r.vertexShader,v=r.fragmentShader,m=r.triangulation,b=r.segmentNumber,A=r.workerEnabled,k=A===void 0?!1:A,L=r.workerOptions,B=(0,ue.Z)(r,$S);this.shaderModuleService.registerModule(u,{vs:h,fs:v});var Z=this.shaderModuleService.getModule(u),V=Z.vs,K=Z.fs,le=Z.uniforms,be=this.rendererService.createModel;return new Promise(function(Be,et){if(L&&L.modelType in td&&k)o.styleAttributeService.createAttributesAndIndicesAscy(o.encodedData,b,L).then(function(Qr){var On=Qr.attributes,li=Qr.elements,Da=be((0,ae.Z)({attributes:On,uniforms:le,fs:K,vs:V,elements:li,blend:Xg[Gh.normal]},B));Be(Da)}).catch(function(Qr){return et(Qr)});else{var at=o.styleAttributeService.createAttributesAndIndices(o.encodedData,m,b),Lt=at.attributes,Gt=at.elements,sr=at.count,Tr=(0,ae.Z)({attributes:Lt,uniforms:le,fs:K,vs:V,elements:Gt,blend:Xg[Gh.normal]},B);sr&&(Tr.count=sr);var Er=be(Tr);Be(Er)}})}},{key:"createAttrubutes",value:function(r){var o=r.triangulation,u=this.styleAttributeService.createAttributes(this.encodedData,o),h=u.attributes;return h}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(r){var o=this.getLayerConfig(),u=o.enableHighlight,h=u===void 0?!0:u,v=o.enableSelect,m=v===void 0?!0:v,b=this.eventNames().indexOf(r)!==-1||this.eventNames().indexOf("un"+r)!==-1;return(r==="click"||r==="dblclick")&&m&&(b=!0),r==="mousemove"&&(h||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(b=!0),this.isVisible()&&b}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,_a.Z)(di().mark(function o(u){return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,u.render();case 2:case"end":return v.stop()}},o)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"renderModels",value:function(r){var o=this;if(this.getEncodedData()&&this.getEncodedData().length>0){var u;this.layerModelNeedUpdate&&this.layerModel&&this.layerModel.buildModels(function(h){o.models=h,o.hooks.beforeRender.call(),o.layerModelNeedUpdate=!1}),this!==null&&this!==void 0&&(u=this.layerModel)!==null&&u!==void 0&&u.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(h){h.draw({uniforms:o.layerModel.getUninforms()},r)})}return this}},{key:"updateStyleAttribute",value:function(r,o,u,h){this.inited?this.styleAttributeService.updateStyleAttribute(r,{scale:(0,ae.Z)({field:o},this.splitValuesAndCallbackInAttribute(u,this.getLayerConfig()[o]))},h):this.pendingStyleAttributes.push({attributeName:r,attributeField:o,attributeValues:u,updateOptions:h})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(r){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(r,o){return{values:(0,d.isFunction)(r)?void 0:r||o,callback:(0,d.isFunction)(r)?r:void 0}}}]),t}(Xu.EventEmitter),f1=Aa(Yg.prototype,"configService",[c1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg),d1,qg,v1;function tA(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=rA(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function rA(e,a){if(!!e){if(typeof e=="string")return m1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return m1(e,a)}}function m1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Po=(d1=Gg(nr.IGlobalConfigService),qg=function(){function e(a){(0,Zt.Z)(this,e),ka(this,"configService",v1,this),this.layer=a,this.rendererService=a.getContainer().get(nr.IRendererService),this.pickingService=a.getContainer().get(nr.IPickingService),this.shaderModuleService=a.getContainer().get(nr.IShaderModuleService),this.styleAttributeService=a.getContainer().get(nr.IStyleAttributeService),this.mapService=a.getContainer().get(nr.IMapService),this.iconService=a.getContainer().get(nr.IIconService),this.fontService=a.getContainer().get(nr.IFontService),this.cameraService=a.getContainer().get(nr.ICameraService),this.layerService=a.getContainer().get(nr.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:Y.NEAREST,min:Y.NEAREST,width:1,height:1}))}return(0,kt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var n=!1;return(0,d.isEqual)(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),(0,d.isEqual)(t.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=t.opacity),(0,d.isEqual)(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),(0,d.isEqual)(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),(0,d.isEqual)(t.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=t.stroke),(0,d.isEqual)(t.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!(0,d.isNumber)(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!(0,d.isNumber)(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!(0,d.isNumber)(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!(0,d.isNumber)(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return(0,d.isString)(t)?!!(0,g.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var n=I(t);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&(0,d.isNumber)(t[0])&&(0,d.isNumber)(t[1]))}},{key:"patchMod",value:function(t,n){for(var r=0;r<n;r++)t.push(-1)}},{key:"patchData",value:function(t,n,r){var o=tA(r),u;try{for(o.s();!(u=o.n()).done;){var h=u.value,v=h.attr,m=h.count,b=n[v];b!==void 0?v==="stroke"?t.push.apply(t,(0,X.Z)(I(b))):v==="offsets"?this.isOffsetStatic(b)?t.push(-b[0],b[1]):t.push(0,0):t.push((0,d.isNumber)(b)?b:1):this.patchMod(t,m)}}catch(A){o.e(A)}finally{o.f()}}},{key:"calDataFrame",value:function(t,n,r){for(var o=n.length,u=Math.ceil(o*t/this.DATA_TEXTURE_WIDTH),h=u*this.DATA_TEXTURE_WIDTH,v=[],m=0;m<o;m++){var b=n[m];this.patchData(v,b,r)}for(var A=v.length;A<h;A++)v.push(-1);return{data:v,width:this.DATA_TEXTURE_WIDTH,height:u}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,r=n===void 0?"normal":n;return Xg[Gh[r]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(t){throw new Error("Method not implemented.")}},{key:"initModels",value:function(t){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),v1=Aa(qg.prototype,"configService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qg),$g=100,xL=36,bL=40;function g1(e){return e/180*Math.acos(-1)}function y1(e){var a=g1(e[0])+Math.PI/2,t=g1(e[1]),n=$g+Math.random()*.4,r=n*Math.cos(t)*Math.cos(a),o=n*Math.cos(t)*Math.sin(a),u=n*Math.sin(t);return[o,u,r]}function EL(e,a){var t=mat4.create(),n=mat4.create(),r=vec3.fromValues(0,1,0),o=vec3.fromValues(0,0,0);a=a||{},e=typeof e!="undefined"?e:1;for(var u=typeof a.segments!="undefined"?a.segments:32,h=2+u,v=2*h,m=[],b=[],A=[],k=[],L=[],B=[],Z=0;Z<=h;Z++){for(var V=Z/h,K=V*Math.PI,le=0;le<=v;le++){var be=le/v,Be=be*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-K),mat4.identity(t),mat4.rotateY(t,t,Be),vec3.transformMat4(o,r,n),vec3.transformMat4(o,o,t),vec3.scale(o,o,-e),A.push(o.slice()),k.push.apply(k,_toConsumableArray(o.slice())),vec3.normalize(o,o),L.push.apply(L,_toConsumableArray(o.slice())),B.push([be,1-V]),k.push(be,1-V)}if(Z>0)for(var et=A.length,at=et-2*(v+1);at+v+2<et;at++)m.push([at,at+1,at+v+1]),b.push(at,at+1,at+v+1),m.push([at+v+1,at+1,at+v+2]),b.push(at+v+1,at+1,at+v+2)}return{cells:m,positions:A,uvs:B,positionsArr:k,indicesArr:b,normalArr:L}}var qm=un.create(),CL=un.create(),Dl=un.create(),A0=un.create(),Av=un.create();function Kg(e,a,t,n,r){un.add(e,t,n),un.normalize(e,e),a=un.fromValues(-e[1],e[0]);var o=un.fromValues(-t[1],t[0]);return[r/un.dot(a,o),a]}function w0(e,a){return un.set(e,-a[1],a[0])}function wv(e,a,t){return un.sub(e,a,t),un.normalize(e,e),e}function Qg(e,a){return e[0]===a[0]&&e[1]===a[1]}function SL(e){for(var a=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();a.get(n)?(e.splice(t,1),t++):a.set(n,n)}return e}var nA=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Zt.Z)(this,e),(0,re.Z)(this,"lastFlip",-1),(0,re.Z)(this,"miter",un.fromValues(0,0)),(0,re.Z)(this,"started",!1),(0,re.Z)(this,"dash",!1),(0,re.Z)(this,"totalDistance",0),(0,re.Z)(this,"currentIndex",0),this.join=a.join||"miter",this.cap=a.cap||"butt",this.miterLimit=a.miterLimit||10,this.thickness=a.thickness||1,this.dash=a.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,kt.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var h=t[u-1],v=t[u],m=u<t.length-1?t[u+1]:null,b=this.simpleSegment(n,o,h,v,m);o+=b}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,h=1;h<o;h++){var v,m,b,A=t[h-1];A.push((v=n[h-1][2])!==null&&v!==void 0?v:0);var k=n[h-1],L=t[h];L.push((m=n[h][2])!==null&&m!==void 0?m:0);var B=n[h],Z=h<t.length-1?[].concat((0,X.Z)(t[h+1]),[(b=n[h+1][2])!==null&&b!==void 0?b:0]):null,V=h<n.length-1?n[h+1]:null,K=this.simpleSegment(r,u,A,L,Z,k,B,V);u+=K}if(this.dash)for(var le=0;le<r.positions.length/6;le++)r.positions[le*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude_gaode2",value:function(t,n){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=t.length,u=r.startIndex,h=1;h<o;h++){var v,m,b,A=t[h-1];A.push((v=n[h-1][2])!==null&&v!==void 0?v:0);var k=n[h-1],L=t[h];L.push((m=n[h][2])!==null&&m!==void 0?m:0);var B=n[h],Z=h<t.length-1?[].concat((0,X.Z)(t[h+1]),[(b=n[h+1][2])!==null&&b!==void 0?b:0]):null,V=h<n.length-1?n[h+1]:null,K=this.segment_gaode2(r,u,A,L,Z,k,B,V);u+=K}if(this.dash)for(var le=0;le<r.positions.length/6;le++)r.positions[le*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,o=n.startIndex,u=1;u<r;u++){var h=t[u-1],v=t[u],m=u<t.length-1?t[u+1]:null,b=this.segment(n,o,h,v,m);o+=b}if(this.dash)for(var A=0;A<n.positions.length/6;A++)n.positions[A*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,r,o,u){var h=0,v=t.indices,m=t.positions,b=t.normals,A=Ao([o[0],o[1]]),k=Ao([r[0],r[1]]);wv(Dl,A,k);var L=0;if(this.dash&&(L=this.lineSegmentDistance(A,k),this.totalDistance+=L),this.normal||(this.normal=un.create(),w0(this.normal,Dl)),this.started||(this.started=!0,this.extrusions(m,b,r,this.normal,this.thickness,this.totalDistance-L)),v.push(n+0,n+1,n+2),!u)w0(this.normal,Dl),this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance),v.push.apply(v,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),h+=2;else{var B=Ao([u[0],u[1]]);Qg(A,B)&&un.add(B,A,un.normalize(B,un.subtract(B,A,k))),wv(A0,B,A);var Z=Kg(Av,un.create(),Dl,A0,this.thickness),V=(0,Mr.Z)(Z,2),K=V[0],le=V[1],be=un.dot(Av,this.normal)<0?-1:1;this.extrusions(m,b,o,le,K,this.totalDistance),v.push.apply(v,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),be=-1,un.copy(this.normal,le),h+=2,this.lastFlip=be}return h}},{key:"segment_gaode2",value:function(t,n,r,o,u,h,v,m){var b=0,A=t.indices,k=t.positions,L=t.normals,B=this.cap==="square",Z=this.join==="bevel",V=Ao([v[0],v[1]]),K=Ao([h[0],h[1]]);wv(Dl,o,r);var le=0;if(this.dash&&(le=this.lineSegmentDistance(V,K),this.totalDistance+=le),this.normal||(this.normal=un.create(),w0(this.normal,Dl)),!this.started)if(this.started=!0,B){var be=un.create(),Be=un.create();un.add(be,this.normal,Dl),un.add(Be,this.normal,Dl),L.push(Be[0],Be[1],0),L.push(be[0],be[1],0),k.push(r[0],r[1],r[2]|0,this.totalDistance-le,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),k.push(r[0],r[1],r[2]|0,this.totalDistance-le,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(k,L,r,this.normal,this.thickness,this.totalDistance-le);if(A.push(n+0,n+1,n+2),u){Qg(o,u)&&un.add(u,o,un.normalize(u,un.subtract(u,o,r))),wv(A0,u,o);var Lt=Kg(Av,un.create(),Dl,A0,this.thickness),Gt=(0,Mr.Z)(Lt,2),sr=Gt[0],Tr=Gt[1],Er=un.dot(Av,this.normal)<0?-1:1,Qr=Z;if(!Qr&&this.join==="miter"){var On=sr;On>this.miterLimit&&(Qr=!0)}Qr?(L.push(this.normal[0],this.normal[1],0),L.push(Tr[0],Tr[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Er,o[2]|0),this.complex.indexes.push(this.currentIndex),k.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*Er,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,A.push.apply(A,(0,X.Z)(this.lastFlip!==-Er?[n,n+2,n+3]:[n+2,n+1,n+3])),A.push(n+2,n+3,n+4),w0(qm,A0),un.copy(this.normal,qm),L.push(this.normal[0],this.normal[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*Er,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b+=3):(this.extrusions(k,L,o,Tr,sr,this.totalDistance),A.push.apply(A,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Er=-1,un.copy(this.normal,Tr),b+=2),this.lastFlip=Er}else{if(w0(this.normal,Dl),B){var et=un.create(),at=un.create();un.sub(at,Dl,this.normal),un.add(et,Dl,this.normal),L.push(at[0],at[1],0),L.push(et[0],et[1],0),k.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),k.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(k,L,o,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),b+=2}return b}},{key:"segment",value:function(t,n,r,o,u){var h=0,v=t.indices,m=t.positions,b=t.normals,A=this.cap==="square",k=this.join==="bevel",L=Ao([o[0],o[1]]),B=Ao([r[0],r[1]]);wv(Dl,L,B);var Z=0;if(this.dash&&(Z=this.lineSegmentDistance(L,B),this.totalDistance+=Z),this.normal||(this.normal=un.create(),w0(this.normal,Dl)),!this.started)if(this.started=!0,A){var V=un.create(),K=un.create();un.add(V,this.normal,Dl),un.add(K,this.normal,Dl),b.push(K[0],K[1],0),b.push(V[0],V[1],0),m.push(r[0],r[1],r[2]|0,this.totalDistance-Z,-this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),m.push(r[0],r[1],r[2]|0,this.totalDistance-Z,this.thickness,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,r,this.normal,this.thickness,this.totalDistance-Z);if(v.push(n+0,n+1,n+2),u){var Be=Ao([u[0],u[1]]);Qg(L,Be)&&un.add(Be,L,un.normalize(Be,un.subtract(Be,L,B))),wv(A0,Be,L);var et=Kg(Av,un.create(),Dl,A0,this.thickness),at=(0,Mr.Z)(et,2),Lt=at[0],Gt=at[1],sr=un.dot(Av,this.normal)<0?-1:1,Tr=k;if(!Tr&&this.join==="miter"){var Er=Lt;Er>this.miterLimit&&(Tr=!0)}Tr?(b.push(this.normal[0],this.normal[1],0),b.push(Gt[0],Gt[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*sr,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness*sr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v.push.apply(v,(0,X.Z)(this.lastFlip!==-sr?[n,n+2,n+3]:[n+2,n+1,n+3])),v.push(n+2,n+3,n+4),w0(qm,A0),un.copy(this.normal,qm),b.push(this.normal[0],this.normal[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,-this.thickness*sr,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,h+=3):(this.extrusions(m,b,o,Gt,Lt,this.totalDistance),v.push.apply(v,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),sr=-1,un.copy(this.normal,Gt),h+=2),this.lastFlip=sr}else{if(w0(this.normal,Dl),A){var le=un.create(),be=un.create();un.sub(be,Dl,this.normal),un.add(le,Dl,this.normal),b.push(be[0],be[1],0),b.push(le[0],le[1],0),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),m.push(o[0],o[1],o[2]|0,this.totalDistance,this.thickness,o[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(m,b,o,this.normal,this.thickness,this.totalDistance);v.push.apply(v,(0,X.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),h+=2}return h}},{key:"extrusions",value:function(t,n,r,o,u,h){n.push(o[0],o[1],0),n.push(o[0],o[1],0),t.push(r[0],r[1],r[2]|0,h,-u,r[2]|0),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],r[2]|0,h,u,r[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var r=n[0]-t[0],o=n[1]-t[1];return Math.sqrt(r*r+o*o)}}]),e}(),Ko=de(77160);function iA(e){var a=e[0][0],t=e[0][e[0].length-1];a[0]===t[0]&&a[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,r=Ou().flatten(e),o=r.vertices,u=r.dimensions,h=[],v=[],m=0;m<o.length/u;m++)u===2?h.push(o[m*2],o[m*2+1],1):h.push(o[m*3],o[m*3+1],1);var b=Ou()(r.vertices,r.holes,r.dimensions);v.push.apply(v,(0,X.Z)(b));for(var A=function(B){var Z=r.vertices.slice(B*u,(B+1)*u),V=r.vertices.slice((B+1)*u,(B+2)*u);V.length===0&&(V=r.vertices.slice(0,u));var K=h.length/3;h.push(Z[0],Z[1],1,V[0],V[1],1,Z[0],Z[1],0,V[0],V[1],0),v.push.apply(v,(0,X.Z)([0,2,1,2,3,1].map(function(le){return le+K})))},k=0;k<n;k++)A(k);return{positions:h,index:v}}function aA(e){var a=Ou().flatten(e),t=Ou()(a.vertices,a.holes,a.dimensions);return{positions:a.vertices,index:t}}function _1(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,o=Ou().flatten(e),u=o.vertices,h=o.dimensions,v=[],m=[],b=[],A=0;A<u.length/h;A++)h===2?v.push(u[A*2],u[A*2+1],1,-1,-1):v.push(u[A*3],u[A*3+1],1,-1,-1),b.push(0,0,1);var k=Ou()(o.vertices,o.holes,o.dimensions);m.push.apply(m,(0,X.Z)(k));for(var L=function(V){var K=o.vertices.slice(V*h,(V+1)*h),le=o.vertices.slice((V+1)*h,(V+2)*h);le.length===0&&(le=o.vertices.slice(0,h));var be=v.length/5;v.push(K[0],K[1],1,0,0,le[0],le[1],1,.1,0,K[0],K[1],0,0,.8,le[0],le[1],0,.1,.8);var Be=oA([le[0],le[1],1],[K[0],K[1],0],[K[0],K[1],1],a);b.push.apply(b,(0,X.Z)(Be).concat((0,X.Z)(Be),(0,X.Z)(Be),(0,X.Z)(Be))),m.push.apply(m,(0,X.Z)([1,2,0,3,2,1].map(function(et){return et+be})))},B=0;B<r;B++)L(B);return{positions:v,index:m,normals:b}}function oA(e,a,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=Ko.create(),o=Ko.create(),u=Ko.create();n&&(e=Jf(e),a=Jf(a),t=Jf(t));var h=Ko.fromValues.apply(Ko,(0,X.Z)(e)),v=Ko.fromValues.apply(Ko,(0,X.Z)(a)),m=Ko.fromValues.apply(Ko,(0,X.Z)(t));Ko.sub(r,m,v),Ko.sub(o,h,v),Ko.cross(u,r,o);var b=Ko.create();return Ko.normalize(b,u),b}var gp,tv;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(tv||(tv={}));var rv;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(rv||(rv={}));function cm(e){for(var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],r=0;r<e;r++)n.push(t*r+a*Math.PI/12);var o=n.map(function(u){var h=Math.sin(u+Math.PI/4),v=Math.cos(u+Math.PI/4);return[h,v,0]});return o}function x1(){return cm(30)}function b1(){return cm(4)}function E1(){return cm(3)}function C1(){return cm(6,1)}function S1(){return cm(5)}var Tv=(gp={},(0,re.Z)(gp,rv.CIRCLE,x1),(0,re.Z)(gp,rv.HEXAGON,C1),(0,re.Z)(gp,rv.TRIANGLE,E1),(0,re.Z)(gp,rv.SQUARE,b1),(0,re.Z)(gp,rv.PENTAGON,S1),(0,re.Z)(gp,tv.CYLINDER,x1),(0,re.Z)(gp,tv.HEXAGONCOLUMN,C1),(0,re.Z)(gp,tv.TRIANGLECOLUMN,E1),(0,re.Z)(gp,tv.SQUARECOLUMN,b1),(0,re.Z)(gp,tv.PENTAGONCOLUMN,S1),gp),$m={};function nv(e){var a=Gu(e.coordinates);return{vertices:[].concat((0,X.Z)(a),(0,X.Z)(a),(0,X.Z)(a),(0,X.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function A1(e){var a=Gu(e.coordinates),t=y1(a);return{vertices:[].concat((0,X.Z)(t),(0,X.Z)(t),(0,X.Z)(t),(0,X.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Jg(e){var a=e.shape,t=hA(a,!1),n=t.positions,r=t.index,o=t.normals;return{vertices:n,indices:r,normals:o,size:5}}function sA(e){var a=Gu(e.coordinates);return{vertices:(0,X.Z)(a),indices:[0],size:a.length}}function iv(e){var a=e.coordinates,t=e.originCoordinates,n=e.version,r=new nA({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var o=a;Array.isArray(o[0][0])||(o=[a]);var u=t;Array.isArray(u[0][0])||(u=[t]);for(var h=0;h<o.length;h++){var v=o[h],m=u[h];r.extrude_gaode2(v,m)}}else{var b=a;b[0]&&!Array.isArray(b[0][0])&&(b=[a]),b.forEach(function(k){r.extrude(k)})}var A=r.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,indexes:A.indexes,size:6}}function uA(e){var a=e.coordinates,t=[],n=lA(a),r=n.results,o=n.totalDistance;return r.map(function(u){t.push(u[0],u[1],u[2],u[3],0,o)}),{vertices:t,indices:[],normals:[],size:6,count:r.length}}function w1(e,a){var t=a[0]-e[0],n=a[1]-e[1];return Math.sqrt(t*t+n*n)}function ey(e,a){return e.length<3&&e.push(0),e.push(a),e}function lA(e){var a=0;if(e.length<2)return{results:e,totalDistance:0};var t=[],n=ey(e[0],a);t.push(n);for(var r=1;r<e.length-1;r++){var o=w1(e[r-1],e[r]);a+=o;var u=ey(e[r],a);t.push(u),t.push(u)}var h=w1(e[e.length-2],e[e.length-1]);return a+=h,t.push(ey(e[e.length-1],a)),{results:t,totalDistance:a}}function fm(e){var a=e.coordinates,t=Ou().flatten(a),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:Ou()(n,o,r),vertices:n,size:r}}function cA(e){var a=e.coordinates,t=Ou().flatten(a),n=t.vertices,r=t.dimensions,o=t.holes;return{indices:Ou()(n,o,r),vertices:fA(n),size:r+4}}function fA(e){for(var a=[],t=ef(e),n=t.center,r=t.radius,o=0;o<e.length;o+=2){var u=e[o],h=e[o+1];a.push.apply(a,[u,h,0].concat((0,X.Z)(n),[r]))}return a}function T1(e){var a=e.coordinates,t=_1(a,!0),n=t.positions,r=t.index,o=t.normals;return{vertices:n,indices:r,normals:o,size:5}}function M1(e){var a=e.shape,t=dA(a),n=t.positions,r=t.index;return{vertices:n,indices:r,size:3}}function ty(e){var a=e.coordinates,t=[].concat((0,X.Z)(a[0]),[0,0,1,a[1][0],a[0][1],0,1,1],(0,X.Z)(a[1]),[0,1,0],(0,X.Z)(a[0]),[0,0,1],(0,X.Z)(a[1]),[0,1,0,a[0][0],a[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function Km(e,a){for(var t=a||30,n=e.coordinates,r=[],o=[],u=function(m){r.push(m,1,m,n[0][0],n[0][1],n[1][0],n[1][1],m,-1,m,n[0][0],n[0][1],n[1][0],n[1][1]),m!==t-1&&o.push.apply(o,(0,X.Z)([0,1,2,1,3,2].map(function(b){return m*2+b})))},h=0;h<t;h++)u(h);return{vertices:r,indices:o,size:7}}function I1(e){var a=e.coordinates;a.length===2&&a.push(0);var t=e.size,n=Qm(-1,1),r=Qm(1,1),o=Qm(-1,-1),u=Qm(1,-1),h=[].concat((0,X.Z)(a),(0,X.Z)(n),(0,X.Z)(a),(0,X.Z)(o),(0,X.Z)(a),(0,X.Z)(u),(0,X.Z)(a),(0,X.Z)(r)),v=[0,1,2,3,0,2];return{vertices:h,indices:v,size:5}}function hA(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if($m&&$m[e])return $m[e];var t=Tv[e]?Tv[e]():Tv.cylinder(),n=_1([t],a);return $m[e]=n,n}function AL(e,a){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=new Float32Array(e.length/t*3),o,u,h,v=vec3.create(),m=vec3.create(),b=vec3.create(),A=0,k=a.length;A<k;A+=3){o=a[A+0]*3,u=a[A+1]*3,h=a[A+2]*3;var L=[e[o],e[o+1]],B=[e[u],e[u+1]],Z=[e[h],e[h+1]];n&&(L=lngLatToMeters(L),B=lngLatToMeters(B),Z=lngLatToMeters(Z));var V=L,K=_slicedToArray(V,2),le=K[0],be=K[1],Be=vec3.fromValues(le,be,e[o+2]),et=B,at=_slicedToArray(et,2),Lt=at[0],Gt=at[1],sr=vec3.fromValues(Lt,Gt,e[u+2]),Tr=Z,Er=_slicedToArray(Tr,2),Qr=Er[0],On=Er[1],li=vec3.fromValues(Qr,On,e[h+2]);vec3.sub(v,li,sr),vec3.sub(m,Be,sr),vec3.cross(b,v,m),r[o]+=v[0],r[o+1]+=v[1],r[o+2]+=v[2],r[u]+=v[0],r[u+1]+=v[1],r[u+2]+=v[2],r[h]+=v[0],r[h+1]+=v[1],r[h+2]+=v[2]}return pA(r),r}function pA(e){for(var a=0,t=e.length;a<t;a+=3){var n=vec3.fromValues(e[a],e[a+1],e[a+2]),r=vec3.create();vec3.normalize(r,n),e.set(r,a)}}function wL(e){var a=e[0][0],t=e[0][e[0].length-1];return a[0]===t[0]&&a[1]===t[1]}function dA(e){var a=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=Tv[e]?Tv[e]():Tv.circle(),n=a.indexOf(e)===-1?aA([t]):iA([t]);return n}function Qm(e,a){var t=(e+1)/2,n=(a+1)/2;return[t,n]}function TL(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:a,indices:t,size:5,normals:n}}function ML(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),a=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:a,indices:t,size:5,normals:n}}function vA(e){var a=mA();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function mA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gA=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,yA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,_A=function(e){(0,Pr.Z)(t,e);var a=vA(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.baseColor,v=h===void 0?"rgb(16,16,16)":h,m=r.brightColor,b=m===void 0?"rgb(255,176,38)":m,A=r.windowColor,k=A===void 0?"rgb(30,60,89)":A,L=r.time,B=L===void 0?0:L,Z=r.sweep,V=Z===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:Z;return{u_cityCenter:V.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*V.sweepRadius,u_circleSweep:V.enable?1:0,u_circleSweepColor:I(V.sweepColor).slice(0,3),u_circleSweepSpeed:V.sweepSpeed,u_opacity:u,u_baseColor:I(v),u_brightColor:I(b),u_windowColor:I(k),u_time:this.layer.getLayerAnimateTime()||B}}},{key:"calCityGeo",value:function(){var r=(0,Mr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],v=r[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(h+o)/2,(v+u)/2]);var m=this.mapService.lngLatToCoord([h,v]),b=this.mapService.lngLatToCoord([o,u]);this.cityMinSize=Math.sqrt(Math.pow(m[0]-b[0],2)+Math.pow(m[1]-b[1],2))/4}else{var A=h-o,k=v-u;this.cityCenter=[(h+o)/2,(v+u)/2],this.cityMinSize=Math.sqrt(Math.pow(A,2)+Math.pow(k,2))/4}}},{key:"initModels",value:function(r){this.calCityGeo(),this.startModelAnimate(),this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:yA,fragmentShader:gA,triangulation:T1,depth:{enable:!0},cull:{enable:!0,face:Y.BACK}}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.size,b=m===void 0?10:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){var m=o.size;return[h[3],h[4]]}}})}}]),t}(Po);function xA(e){var a=bA();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function bA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EA=function(e){(0,Pr.Z)(t,e);var a=xA(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","CityBuildingLayer"),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this;this.layerModel=new _A(this),this.layerModel.initModels(function(o){r.models=o,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"setLight",value:function(r){this.updateLayerConfig({time:r})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Sd);function CA(e){var a=SA();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function SA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AA=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,wA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,TA=function(e){(0,Pr.Z)(t,e);var a=CA(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,h=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:h||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:AA,fragmentShader:wA,triangulation:M1,primitive:Y.TRIANGLES,depth:{enable:!1},stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Vn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[h[0],h[1],0]}}})}}]),t}(Po);function MA(e){var a=IA();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function IA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kA=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,PA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,LA=function(e){(0,Pr.Z)(t,e);var a=MA(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,h=r.angle;return{u_opacity:o||1,u_coverage:u||1,u_angle:h||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:kA,fragmentShader:PA,triangulation:Jg,primitive:Y.TRIANGLES,depth:{enable:!0},blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.size;return Array.isArray(m)?[m[0]]:[m]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Vn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[h[0],h[1],0]}}})}}]),t}(Po);function RA(e,a){for(var t=[],n=[],r=[],o=e+1,u=a+1,h=e/2,v=a/2,m=0;m<u;m++)for(var b=m-v,A=0;A<o;A++){var k=A-h;n.push(k/h,-b/v,0),r.push(A/e),r.push(1-m/a)}for(var L=0;L<a;L++)for(var B=0;B<e;B++){var Z=B+o*L,V=B+o*(L+1),K=B+1+o*(L+1),le=B+1+o*L;t.push(Z,V,le),t.push(V,K,le)}return{vertices:n,indices:t,uvs:r}}var k1,P1;function OA(e){var a=FA();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function FA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DA=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,BA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,NA=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,zA=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,UA=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,ZA=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,L1=(k1=(0,Yr.b2)(),k1(P1=function(e){(0,Pr.Z)(t,e);var a=OA(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"render",value:function(){var r=this,o=this.rendererService,u=o.clear,h=o.useFramebuffer;h(this.heatmapFramerBuffer,function(){u({color:[0,0,0,0],depth:1,stencil:0,framebuffer:r.heatmapFramerBuffer}),r.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,_a.Z)(di().mark(function o(u){var h,v,m,b,A,k,L,B,Z,V,K,le;return di().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:return v=this.rendererService,m=v.createFramebuffer,b=v.clear,A=v.getViewportSize,k=v.createTexture2D,L=v.useFramebuffer,B=this.styleAttributeService.getLayerStyleAttribute("shape"),Z=(B==null||(h=B.scale)===null||h===void 0?void 0:h.field)||"heatmap",this.shapeType=Z,Be.next=6,this.buildHeatMapIntensity();case 6:this.intensityModel=Be.sent,this.colorModel=Z==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),V=A(),K=V.width,le=V.height,this.heatmapFramerBuffer=m({color:k({width:Math.floor(K/4),height:Math.floor(le/4),wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR}),depth:!1}),this.updateColorTexture(),u([this.intensityModel,this.colorModel]);case 12:case"end":return Be.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Vn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){return[h[3],h[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.size,b=m===void 0?1:m;return[b]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,_a.Z)(di().mark(function o(){var u;return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return this.layer.triangulation=I1,v.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:ZA,fragmentShader:UA,triangulation:I1,depth:{enable:!1},cull:{enable:!0,face:nf(this.mapService.version)},blend:{enable:!0,func:{srcRGB:Y.ONE,srcAlpha:1,dstRGB:Y.ONE,dstAlpha:1}}});case 3:return u=v.sent,v.abrupt("return",u);case 5:case"end":return v.stop()}},o,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"buildHeatmapColor",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,h=r.maskInside,v=h===void 0?!0:h;this.shaderModuleService.registerModule("heatmapColor",{vs:zA,fs:NA});var m=this.shaderModuleService.getModule("heatmapColor"),b=m.vs,A=m.fs,k=m.uniforms,L=this.rendererService,B=L.createAttribute,Z=L.createElements,V=L.createBuffer,K=L.createModel;return K({vs:b,fs:A,attributes:{a_Position:B({buffer:V({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:Y.FLOAT}),size:3}),a_Uv:B({buffer:V({data:[0,1,1,1,0,0,1,0],type:Y.FLOAT}),size:2})},uniforms:(0,ae.Z)({},k),depth:{enable:!1},blend:this.getBlend(),elements:Z({data:[0,2,1,2,3,1],type:Y.UNSIGNED_INT,count:6}),stencil:ye(u,v)})}},{key:"drawIntensityMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,h=o.intensity,v=h===void 0?10:h,m=o.radius,b=m===void 0?5:m;(r=this.intensityModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_radius:b,u_intensity:v}})}},{key:"drawColorMode",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity;(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var r,o=this.layer.getLayerConfig(),u=o.opacity,h=Wc();Uh(h,this.cameraService.getViewProjectionMatrixUncentered()),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:{u_opacity:u||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,X.Z)(h)}})}},{key:"build3dHeatMap",value:function(){var r=this.layer.getLayerConfig(),o=r.mask,u=o===void 0?!1:o,h=r.maskInside,v=h===void 0?!0:h,m=this.rendererService.getViewportSize,b=m(),A=b.width,k=b.height,L=RA(A/4,k/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:BA,fs:DA});var B=this.shaderModuleService.getModule("heatmap3dColor"),Z=B.vs,V=B.fs,K=B.uniforms,le=this.rendererService,be=le.createAttribute,Be=le.createElements,et=le.createBuffer,at=le.createModel;return at({vs:Z,fs:V,attributes:{a_Position:be({buffer:et({data:L.vertices,type:Y.FLOAT}),size:3}),a_Uv:be({buffer:et({data:L.uvs,type:Y.FLOAT}),size:2})},primitive:Y.TRIANGLES,uniforms:(0,ae.Z)({},K),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:Y.SRC_ALPHA,srcAlpha:1,dstRGB:Y.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Be({data:L.indices,type:Y.UNSIGNED_INT,count:L.indices.length}),stencil:ye(u,v)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var r=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var o=this.layer.getLayerConfig(),u=o.rampColors,h=q(u);this.colorTexture=r({data:new Uint8Array(h.data),width:h.width,height:h.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.NEAREST,mag:Y.NEAREST,flipY:!1})}}]),t}(Po))||P1);function VA(e){var a=jA();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function jA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GA=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,HA=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,WA=function(e){(0,Pr.Z)(t,e);var a=VA(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.coverage,h=r.angle;return{u_opacity:o||1,u_coverage:u||.9,u_angle:h||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:HA,fragmentShader:GA,triangulation:M1,depth:{enable:!1},primitive:Y.TRIANGLES,blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Vn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=o.version==="GAODE2.x"?o.originCoordinates:o.coordinates;return[h[0],h[1],0]}}})}}]),t}(Po),XA={heatmap:L1,heatmap3d:L1,grid:TA,grid3d:LA,hexagon:WA},YA=XA;function qA(e){var a=$A();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function $A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KA=function(e){(0,Pr.Z)(t,e);var a=qA(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","HeatMapLayer"),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new YA[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"renderModels",value:function(){var r=this,o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.layerModel.buildModels(function(u){return r.models=u}),this.layerModelNeedUpdate=!1),this.models.forEach(function(u){return u.draw({uniforms:r.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(r){r.attributes&&r.elements?this.models[0].updateAttributesAndElements(r.attributes,r.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=this.getLayerConfig(),h=u.shape3d,v=this.getSource(),m=v.data.type,b=(o==null||(r=o.scale)===null||r===void 0?void 0:r.field)||"heatmap";return b==="heatmap"||b==="heatmap3d"?"heatmap":m==="hexagon"?(h==null?void 0:h.indexOf(b))===-1?"hexagon":"grid3d":m==="grid"?(h==null?void 0:h.indexOf(b))===-1?"grid":"grid3d":"heatmap"}}]),t}(Sd);function QA(e){var a=JA();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function JA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ew=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;

uniform float u_pixelConstant;
uniform float u_pixelConstantR;
uniform float u_pixelConstantG;
uniform float u_pixelConstantB;
uniform float u_pixelConstantRGB;

void main() {
  vec4 baseColor = texture2D(u_texture, vec2(v_texCoord.x, v_texCoord.y));

  float r = baseColor.r;
  float g = baseColor.g;
  float b = baseColor.b;

  float value = u_pixelConstant + ((r * u_pixelConstantR + g * u_pixelConstantG + b * u_pixelConstantB) * u_pixelConstantRGB);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    gl_FragColor = vec4(0, 0, 0, 0);
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture2D(u_colorTexture, vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }
}
`,tw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,rw=function(e){(0,Pr.Z)(t,e);var a=QA(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=r.clampLow,h=u===void 0?!0:u,v=r.clampHigh,m=v===void 0?!0:v,b=r.noDataValue,A=b===void 0?-9999999:b,k=r.domain,L=k===void 0?[0,1]:k,B=r.rampColors,Z=r.pixelConstant,V=Z===void 0?0:Z,K=r.pixelConstantR,le=K===void 0?256*256:K,be=r.pixelConstantG,Be=be===void 0?256:be,et=r.pixelConstantB,at=et===void 0?1:et,Lt=r.pixelConstantRGB,Gt=Lt===void 0?.1:Lt;return(0,d.isEqual)(this.rampColors,B)||(this.updateColorTexure(),this.rampColors=B),{u_opacity:o||1,u_texture:this.texture,u_pixelConstant:V,u_pixelConstantR:le,u_pixelConstantG:Be,u_pixelConstantB:at,u_pixelConstantRGB:Gt,u_domain:L,u_clampLow:h,u_clampHigh:typeof m!="undefined"?m:h,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),h=u.mask,v=h===void 0?!1:h,m=u.maskInside,b=m===void 0?!0:m,A=u.rampColorsData,k=u.rampColors,L=this.layer.getSource(),B=this.rendererService.createTexture2D;if(this.texture=B({height:0,width:0}),Eu){var Z=this.layerService.sceneService.getSceneConfig().canvas,V=Z.createImage();V.crossOrigin="anonymous",V.src=L.data.originData,V.onload=function(){o.texture=B({data:V,width:V.width,height:V.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else L.data.images.then(function(le){o.texture=B({data:le[0],width:le[0].width,height:le[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});var K=A||q(k);this.colorTexture=B({data:K.data,width:K.width,height:K.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:tw,fragmentShader:ew,triangulation:ty,primitive:Y.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ye(v,b)}).then(function(le){r([le])}).catch(function(le){console.warn(le),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){return[h[3],h[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,h=q(u);this.colorTexture=r({data:h.data,width:h.width,height:h.height,flipY:!1})}}]),t}(Po);function nw(e){var a=iw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,ow=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,sw=function(e){(0,Pr.Z)(t,e);var a=nw(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity;return{u_opacity:o||1,u_texture:this.texture}}},{key:"initModels",value:function(r){var o=this,u=this.layer.getLayerConfig(),h=u.mask,v=h===void 0?!1:h,m=u.maskInside,b=m===void 0?!0:m,A=this.layer.getSource(),k=this.rendererService.createTexture2D;if(this.texture=k({height:0,width:0}),Eu){var L=this.layerService.sceneService.getSceneConfig().canvas,B=L.createImage();B.crossOrigin="anonymous",B.src=A.data.originData,B.onload=function(){o.texture=k({data:B,width:B.width,height:B.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else A.data.images.then(function(Z){o.texture=k({data:Z[0],width:Z[0].width,height:Z[0].height,mag:Y.LINEAR,min:Y.LINEAR}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:ow,fragmentShader:aw,triangulation:ty,primitive:Y.TRIANGLES,blend:{enable:!0},depth:{enable:!1},stencil:ye(v,b)}).then(function(Z){r([Z])}).catch(function(Z){console.warn(Z),r([])})}},{key:"clearModels",value:function(){var r;(r=this.texture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){return[h[3],h[4]]}}})}}]),t}(Po),uw={image:sw,dataImage:rw},lw=uw;function cw(e){var a=fw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function fw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R1=function(e){(0,Pr.Z)(t,e);var a=cw(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","ImageLayer"),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new lw[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={image:{},dataImage:{}};return o[r]}},{key:"getModelType",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;return u==="dataImage"?"dataImage":(u==="image","image")}}]),t}(Sd);function hw(e){var a=pw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function pw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dw=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,vw=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,mw=function(e){(0,Pr.Z)(t,e);var a=hw(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?0:o;return{u_opacity:(0,d.isNumber)(u)?u:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var n=(0,_a.Z)(di().mark(function o(u){return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:this.layer.buildLayerModel({moduleName:"mask",vertexShader:vw,fragmentShader:dw,triangulation:fm,depth:{enable:!1},blend:this.getBlend(),stencil:{enable:!0,mask:255,func:{cmp:Y.ALWAYS,ref:1,mask:255},opFront:{fail:Y.REPLACE,zfail:Y.REPLACE,zpass:Y.REPLACE}}}).then(function(m){u([m])}).catch(function(m){console.warn(m),u([])});case 1:case"end":return v.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Po),gw={fill:mw},yw=gw;function _w(e){var a=xw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function xw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var O1=function(e){(0,Pr.Z)(t,e);var a=_w(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","MaskLayer"),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new yw[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),t}(Sd),bw=["mvt","geojsonvt","testTile"];function ry(e){return bw.indexOf(e)>=0}function ny(e,a){a.map(function(t){var n=Hg(e.sceneContainer);t.setContainer(n,e.sceneContainer),t.init()})}function F1(e,a){var t,n=a.getAttribute("shape");if(n&&(t=n.scale)!==null&&t!==void 0&&t.field){var r;return((r=n.scale)===null||r===void 0?void 0:r.values)==="text"?[n.scale.field,n.scale.values]:n.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function Ew(e,a){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return a;default:return a}}function Cw(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function Sw(e,a,t,n){var r,o,u,h,v=(e==null||(r=e.bboxPolygon)===null||r===void 0?void 0:r.bbox)||[0,0,10,-10],m=(0,Mr.Z)(v,4),b=m[0],A=b===void 0?0:b,k=m[1],L=k===void 0?0:k,B=m[2],Z=B===void 0?10:B,V=m[3],K=V===void 0?-10:V,le=a.lngLatToContainer([A,L]),be=a.lngLatToContainer([Z,K]),Be=be.x-le.x,et=le.y-be.y,at=[(t-le.x)/Be,(n-be.y)/et],Lt=(e==null||(o=e.data)===null||o===void 0?void 0:o.width)||1,Gt=(e==null||(u=e.data)===null||u===void 0?void 0:u.height)||1,sr=Math.floor(at[0]*Lt),Tr=Math.floor(at[1]*Gt),Er=Math.max(0,Tr-1)*Lt+sr,Qr=e==null||(h=e.data)===null||h===void 0?void 0:h.data[Er];return Qr}function IL(e,a,t){var n=t.readPixels,r=t.getContainer,o=e*DOM.DPR,u=a*DOM.DPR,h=Cw(r()),v=h.width,m=h.height;if(v*=DOM.DPR,m*=DOM.DPR,o>v-1*DOM.DPR||o<0||u>m-1*DOM.DPR||u<0)return!1;var b=n({x:Math.floor(o),y:Math.floor(m-(a+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return b}function Aw(e){var a=ww();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tw=`#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6


  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Mw=`
attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform vec2 u_tileOrigin;
uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }
} else {
  vec2 pointPos = a_Position.xy;
  vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  tileWorld.xy += pointOffset;

  tileWorld.xy += offset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    tileWorld.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);


}
`,iy=function(e){(0,Pr.Z)(t,e);var a=Aw(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.textureBlend,v=h===void 0?"normal":h,m=r.lineTexture,b=m===void 0?!1:m,A=r.iconStep,k=A===void 0?100:A,L=r.vertexHeightScale,B=L===void 0?20:L,Z=r.borderWidth,V=Z===void 0?0:Z,K=r.borderColor,le=K===void 0?"#ccc":K,be=r.heightfixed,Be=be===void 0?!1:be,et=r.arrow,at=et===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:et,Lt=r.coord,Gt=Lt===void 0?"lnglat":Lt,sr=r.tileOrigin;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Tr=this.layer.getEncodedData(),Er=this.calDataFrame(this.cellLength,Tr,this.cellProperties),Qr=Er.data,On=Er.width,li=Er.height;this.rowCount=li,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:Y.LUMINANCE,type:Y.FLOAT,width:On,height:li}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_tileOrigin:sr||[0,0],u_coord:Gt==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_textureBlend:v==="normal"?0:1,u_texture:this.texture,u_line_texture:b?1:0,u_icon_step:k,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:V,u_borderColor:I(le),u_heightfixed:Number(Be),u_vertexScale:B,u_arrow:Number(at.enable),u_arrowHeight:at.arrowHeight||3,u_arrowWidth:at.arrowWidth||2,u_tailWidth:at.tailWidth===void 0?1:at.tailWidth}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,_a.Z)(di().mark(function o(u){var h,v,m,b,A,k,L;return di().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:h=this.layer.getLayerConfig(),v=h.mask,m=v===void 0?!1:v,b=h.maskInside,A=b===void 0?!0:b,k=h.depth,L=k===void 0?!1:k,this.layer.triangulation=iv,this.layer.buildLayerModel({moduleName:"lineTile",vertexShader:Mw,fragmentShader:Tw,triangulation:iv,blend:this.getBlend(),depth:{enable:L},stencil:ye(m,A)}).then(function(V){u([V])}).catch(function(V){console.warn(V),u([])});case 3:case"end":return Z.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Vn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m,b,A){return A===void 0?[v[3],10]:[v[3],A]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Vn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,v,m,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Vn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.texture,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}})}}]),t}(Po);function Iw(e){var a=kw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function kw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pw=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Lw=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];

  // styleMappingMat[3][0] \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = mix(u_sourceColor, u_targetColor, styleMappingMat[3][0]);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,D1=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  v_color = a_Color; 
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,B1=function(e){(0,Pr.Z)(t,e);var a=Iw(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,v=r.targetColor,m=r.vertexHeightScale,b=m===void 0?20:m,A=0,k=[0,0,0,0],L=[0,0,0,0];if(h&&v&&(k=I(h),L=I(v),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var B=this.layer.getEncodedData(),Z=this.calDataFrame(this.cellLength,B,this.cellProperties),V=Z.data,K=Z.width,le=Z.height;this.rowCount=le,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:Y.LUMINANCE,type:Y.FLOAT,width:K,height:le}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_linearColor:A,u_sourceColor:k,u_targetColor:L,u_vertexScale:b}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:Lw,vert:D1,type:"lineSimpleLinear"}:{frag:Pw,vert:D1,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v,b=this.getShaders(),A=b.frag,k=b.vert,L=b.type;this.layer.buildLayerModel({moduleName:L,vertexShader:k,fragmentShader:A,triangulation:uA,primitive:Y.LINES,depth:{enable:!1},blend:this.getBlend(),stencil:ye(h,m)}).then(function(B){r([B])}).catch(function(B){console.warn(B),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Vn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){return[h[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Vn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){return[h[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}})}}]),t}(Po);function Rw(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ow(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Ow(e,a){if(!!e){if(typeof e=="string")return N1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return N1(e,a)}}function N1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}var Fw=function(){function e(a,t,n){(0,Zt.Z)(this,e),(0,re.Z)(this,"boxCells",[]);var r=this.boxCells;this.xCellCount=Math.ceil(a/n),this.yCellCount=Math.ceil(t/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]);this.boxKeys=[],this.bboxes=[],this.width=a,this.height=t,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,kt.Z)(e,[{key:"insert",value:function(t,n,r,o,u){this.forEachCell(n,r,o,u,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(u)}},{key:"query",value:function(t,n,r,o,u){return this.queryHitTest(t,n,r,o,!1,u)}},{key:"hitTest",value:function(t,n,r,o,u){return this.queryHitTest(t,n,r,o,!0,u)}},{key:"insertBoxCell",value:function(t,n,r,o,u,h){this.boxCells[u].push(h)}},{key:"queryHitTest",value:function(t,n,r,o,u,h){if(r<0||t>this.width||o<0||n>this.height)return u?!1:[];var v=[];if(t<=0&&n<=0&&this.width<=r&&this.height<=o){if(u)return!0;for(var m=0;m<this.boxKeys.length;m++)v.push({key:this.boxKeys[m],x1:this.bboxes[m*4],y1:this.bboxes[m*4+1],x2:this.bboxes[m*4+2],y2:this.bboxes[m*4+3]});return h?v.filter(h):v}var b={hitTest:u,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,r,o,this.queryCell,v,b,h),u?v.length>0:v}},{key:"queryCell",value:function(t,n,r,o,u,h,v,m){var b=v.seenUids,A=this.boxCells[u];if(A!==null){var k=this.bboxes,L=Rw(A),B;try{for(L.s();!(B=L.n()).done;){var Z=B.value;if(!b.box[Z]){b.box[Z]=!0;var V=Z*4;if(t<=k[V+2]&&n<=k[V+3]&&r>=k[V+0]&&o>=k[V+1]&&(!m||m(this.boxKeys[Z]))){if(v.hitTest)return h.push(!0),!0;h.push({key:this.boxKeys[Z],x1:k[V],y1:k[V+1],x2:k[V+2],y2:k[V+3]})}}}}catch(K){L.e(K)}finally{L.f()}}return!1}},{key:"forEachCell",value:function(t,n,r,o,u,h,v,m){for(var b=this.convertToXCellCoord(t),A=this.convertToYCellCoord(n),k=this.convertToXCellCoord(r),L=this.convertToYCellCoord(o),B=b;B<=k;B++)for(var Z=A;Z<=L;Z++){var V=this.xCellCount*Z+B;if(u.call(this,t,n,r,o,V,h,v,m))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),Dw=Fw,z1=function(){function e(a,t){(0,Zt.Z)(this,e),(0,re.Z)(this,"viewportPadding",100),this.width=a,this.height=t,this.viewportPadding=Math.max(a,t),this.grid=new Dw(a+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=a+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=a+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,kt.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,r=t.y1+t.anchorPointY+this.viewportPadding,o=t.x2+t.anchorPointX+this.viewportPadding,u=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,r,o,u)||this.grid.hitTest(n,r,o,u)?{box:[]}:{box:[n,r,o,u]}}},{key:"insertCollisionBox",value:function(t,n){var r={featureIndex:n};this.grid.insert(r,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,r){var o=jv(n,r,0,1),u=gv(),h=lp.apply(He,(0,X.Z)(t));return Yv(u,o,h),{x:(u[0]/u[3]+1)/2*this.width+this.viewportPadding,y:(-u[1]/u[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,r,o){return r>=0&&t<this.gridRightBoundary&&o>=0&&n<this.gridBottomBoundary}}]),e}();function U1(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Bw(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Bw(e,a){if(!!e){if(typeof e=="string")return Z1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Z1(e,a)}}function Z1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function V1(e){var a=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0;break;default:a=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:a,verticalAlign:t}}function j1(e,a,t,n,r){if(!!r){var o=e[n],u=o.glyph;if(u)for(var h=a[u].advance*o.scale,v=(e[n].x+h)*r,m=t;m<=n;m++)e[m].x-=v}}function G1(e,a,t,n,r,o,u){var h=(a-t)*r,v=(-n*u+.5)*o,m=U1(e),b;try{for(m.s();!(b=m.n()).done;){var A=b.value;A.x+=h,A.y+=v}}catch(k){m.e(k)}finally{m.f()}}function Nw(e,a,t,n,r,o,u){var h=-8,v=0,m=h,b=0,A=e.positionedGlyphs,k=o==="right"?1:o==="left"?0:.5,L=A.length;t.forEach(function(le){if(le.split("").forEach(function(Be){var et=a[Be],at=0;et&&(A.push({glyph:Be,x:v,y:m+at,vertical:!1,scale:1,metrics:et}),v+=et.advance+u)}),A.length!==L){var be=v-u;b=Math.max(be,b),j1(A,a,L,A.length-1,k)}v=0,m-=n+5});var B=V1(r),Z=B.horizontalAlign,V=B.verticalAlign;G1(A,k,Z,V,b,n,t.length);var K=m-h;e.top+=-V*K,e.bottom=e.top-K,e.left+=-Z*b,e.right=e.left+b}function zw(e,a,t,n,r,o,u){var h=-8,v=0,m=h,b=0,A=e.positionedGlyphs,k=o==="right"?1:o==="left"?0:.5,L=A.length;t.forEach(function(le){var be=a[le],Be=0;if(be&&(A.push({glyph:le,x:be.advance/2,y:m+Be,vertical:!1,scale:1,metrics:be}),v+=be.advance+u),A.length!==L){var et=v-u;b=Math.max(et,b),j1(A,a,L,A.length-1,k)}v=0,m-=n+5});var B=V1(r),Z=B.horizontalAlign,V=B.verticalAlign;G1(A,k,Z,V,b,n,t.length);var K=m-h;e.top+=-V*K,e.bottom=e.top-K,e.left+=-Z*b,e.right=e.left+b}function H1(e,a,t,n,r,o){var u=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],h=arguments.length>7?arguments[7]:void 0,v=e.split(`
`),m=[],b={positionedGlyphs:m,top:u[1],bottom:u[1],left:u[0],right:u[0],lineCount:v.length,text:e};return h?zw(b,a,v,t,n,r,o):Nw(b,a,v,t,n,r,o),m.length?b:!1}function W1(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,r=n===void 0?[]:n,o=[],u=U1(r),h;try{for(u.s();!(h=u.n()).done;){var v=h.value,m=v.metrics,b=4,A=m.advance*v.scale/2,k=t?[v.x+A,v.y]:[0,0],L=t?[0,0]:[v.x+A+a[0],v.y+a[1]],B=(0-b)*v.scale-A+L[0],Z=(0-b)*v.scale+L[1],V=B+m.width*v.scale,K=Z+m.height*v.scale,le={x:B,y:Z},be={x:V,y:Z},Be={x:B,y:K},et={x:V,y:K};o.push({tl:le,tr:be,bl:Be,br:et,tex:m,glyphOffset:k})}}catch(at){u.e(at)}finally{u.f()}return o}function Uw(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Zw(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function Zw(e,a){if(!!e){if(typeof e=="string")return X1(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return X1(e,a)}}function X1(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function Vw(e){var a=jw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function jw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,q1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function $1(e){var a=this,t=e.id,n=[],r=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[t].glyphQuads.forEach(function(h,v){n.push.apply(n,(0,X.Z)(u).concat([h.tex.x,h.tex.y+h.tex.height,h.tl.x,h.tl.y],(0,X.Z)(u),[h.tex.x+h.tex.width,h.tex.y+h.tex.height,h.tr.x,h.tr.y],(0,X.Z)(u),[h.tex.x+h.tex.width,h.tex.y,h.br.x,h.br.y],(0,X.Z)(u),[h.tex.x,h.tex.y,h.bl.x,h.bl.y])),r.push(0+v*4,1+v*4,2+v*4,2+v*4,3+v*4,0+v*4)}),{vertices:n,indices:r,size:7}}var K1=function(e){(0,Pr.Z)(t,e);var a=Vw(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"glyphInfoMap",{}),(0,re.Z)((0,bt.Z)(n),"currentZoom",-1),(0,re.Z)((0,bt.Z)(n),"textureHeight",0),(0,re.Z)((0,bt.Z)(n),"textCount",0),(0,re.Z)((0,bt.Z)(n),"preTextStyle",{}),(0,re.Z)((0,bt.Z)(n),"buildModels",function(){var h=(0,_a.Z)(di().mark(function v(m){var b,A,k,L,B;return di().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:b=n.layer.getLayerConfig(),A=b.mask,k=A===void 0?!1:A,L=b.maskInside,B=L===void 0?!0:L,n.mapping(),n.layer.buildLayerModel({moduleName:"pointText",vertexShader:q1,fragmentShader:Y1,triangulation:$1.bind((0,bt.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:ye(k,B)}).then(function(K){m([K])}).catch(function(K){console.warn(K),m([])});case 3:case"end":return V.stop()}},v)}));return function(v){return h.apply(this,arguments)}}()),(0,re.Z)((0,bt.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.stroke,v=h===void 0?"#fff":h,m=r.strokeWidth,b=m===void 0?0:m,A=r.textAnchor,k=A===void 0?"center":A,L=r.textAllowOverlap,B=L===void 0?!1:L,Z=r.halo,V=Z===void 0?.5:Z,K=r.gamma,le=K===void 0?2:K,be=r.raisingHeight,Be=be===void 0?0:be,et=this.fontService,at=et.canvas,Lt=et.mapping;if(Object.keys(Lt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Lt).length),this.preTextStyle={textAnchor:k,textAllowOverlap:B},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:b,stroke:v})){this.judgeStyleAttributes({opacity:u,strokeWidth:b,stroke:v});var Gt=this.layer.getEncodedData(),sr=this.calDataFrame(this.cellLength,Gt,this.cellProperties),Tr=sr.data,Er=sr.width,Qr=sr.height;this.rowCount=Qr,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:Y.LUMINANCE,type:Y.FLOAT,width:Er,height:Qr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Be),u_opacity:(0,d.isNumber)(u)?u:1,u_stroke_width:(0,d.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(v),u_sdf_map:this.texture,u_halo_blur:V,u_gamma_scale:le,u_sdf_map_size:[at.width,at.height]}}},{key:"initModels",value:function(r){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,h=u===void 0?"center":u,v=o.textAllowOverlap,m=v===void 0?!0:v;this.preTextStyle={textAnchor:h,textAllowOverlap:m},this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Vn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.rotate,b=m===void 0?0:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Vn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){return[h[5],h[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.size,b=m===void 0?12:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Vn.Attribute,descriptor:{name:"a_tex",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){return[h[3],h[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return ll(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,h=r.fontFamily,v=h===void 0?"sans-serif":h,m=this.layer.getEncodedData(),b=[];m.forEach(function(A){var k=A.shape,L=k===void 0?"":k;L=L.toString();var B=Uw(L),Z;try{for(B.s();!(Z=B.n()).done;){var V=Z.value;b.indexOf(V)===-1&&b.push(V)}}catch(K){B.e(K)}finally{B.f()}}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:v,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,h=r.fontFamily,v=h===void 0?"sans-serif":h,m=this.layer.getEncodedData(),b=[];m.forEach(function(A){var k=A.shape,L=k===void 0?"":k;L="".concat(L),b.indexOf(L)===-1&&b.push(L)}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:v,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,h=this.layer.getLayerConfig(),v=h.spacing,m=v===void 0?2:v,b=h.textAnchor,A=b===void 0?"center":b,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(L){var B=L.shape,Z=B===void 0?"":B,V=L.id,K=L.size,le=K===void 0?1:K,be=L.textOffset,Be=be===void 0?[0,0]:be,et=H1(Z.toString(),u,le,A,"left",m,Be,r),at=W1(et,Be,!1);return L.shaping=et,L.glyphQuads=at,L.centroid=Gu(L.coordinates),L.originCentroid=L.version==="GAODE2.x"?Gu(L.originCoordinates):L.originCentroid=L.centroid,o.glyphInfoMap[V]={shaping:et,glyphQuads:at,centroid:Gu(L.coordinates)},L})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,h=u===void 0?[4,4]:u,v=o.textAllowOverlap,m=v===void 0?!1:v;if(!m){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var b=this.rendererService.getViewportSize(),A=b.width,k=b.height,L=new z1(A,k),B=this.glyphInfo.filter(function(Z){var V=Z.shaping,K=Z.id,le=K===void 0?0:K,be=Z.version==="GAODE2.x"?Z.originCentroid:Z.centroid,Be=Z.size,et=Be/24,at=r.mapService.lngLatToContainer(be),Lt=L.placeCollisionBox({x1:V.left*et-h[0],x2:V.right*et+h[0],y1:V.top*et-h[1],y2:V.bottom*et+h[1],anchorPointX:at.x,anchorPointY:at.y}),Gt=Lt.box;return Gt&&Gt.length?(L.insertCollisionBox(Gt,le),!0):!1});B.forEach(function(Z){r.glyphInfoMap[Z.id]=Z})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:Y.LINEAR,min:Y.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointTileText",vertexShader:q1,fragmentShader:Y1,triangulation:$1.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r.layer.models=[b],r.layer.renderLayers()}).catch(function(b){console.warn(b),r.layer.models=[]})}}]),t}(Po);function Gw(e){var a=Hw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ww=`uniform float u_additive;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Xw=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
} else {
  gl_PointSize = 24.0;
  vec2 pointPos = a_Position.xy;
  vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  world.xy += offset;
  world.xy += pointOffset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    world.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}

 
  setPickingColor(a_PickingColor);


}
`,Jm=function(e){(0,Pr.Z)(t,e);var a=Gw(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"meter2coord",1),(0,re.Z)((0,bt.Z)(n),"isMeter",!1),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.strokeOpacity,v=h===void 0?1:h,m=r.strokeWidth,b=m===void 0?0:m,A=r.stroke,k=A===void 0?"rgba(0,0,0,0)":A,L=r.offsets,B=L===void 0?[0,0]:L,Z=r.blend,V=r.blur,K=V===void 0?0:V,le=r.coord,be=le===void 0?"lnglat":le,Be=r.tileOrigin;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:b,stroke:k,offsets:B})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:b,stroke:k,offsets:B});var et=this.layer.getEncodedData(),at=this.calDataFrame(this.cellLength,et,this.cellProperties),Lt=at.data,Gt=at.width,sr=at.height;this.rowCount=sr,this.dataTexture=this.cellLength>0&&Lt.length>0?this.createTexture2D({flipY:!0,data:Lt,format:Y.LUMINANCE,type:Y.FLOAT,width:Gt,height:sr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_tileOrigin:Be||[0,0],u_coord:be==="lnglat"?1:0,u_isMeter:Number(this.isMeter),u_blur:K,u_additive:Z==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(u),u_stroke_opacity:Number(v),u_stroke_width:Number(b),u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(B)?B:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),nv)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,h=u===void 0?"l7size":u,v=this.mapService.version;h==="meter"&&v!==Uu.L7MAP&&v!==Uu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Mr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],v=r[3],m=[(o+h)/2,(u+v)/2],b=this.mapService.version;if(b===Uu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),k=1,L=k*A.meterInMercatorCoordinateUnits(),B=new window.mapboxgl.MercatorCoordinate(A.x-L,A.y,A.z),Z=B.toLngLat();this.meter2coord=m[0]-Z.lng;return}var V=this.mapService.meterToCoord(m,[o,u]),K=this.mapService.meterToCoord(m,[h===o?h+.1:h,v===u?u+.1:v]);this.meter2coord=(V+K)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v,b=o.workerEnabled,A=b===void 0?!1:b;this.layer.triangulation=nv,this.layer.buildLayerModel({moduleName:"pointTile",vertexShader:Xw,fragmentShader:Ww,triangulation:nv,depth:{enable:!1},cull:{enable:!0,face:nf(this.mapService.version)},blend:this.getBlend(),stencil:ye(h,m),workerEnabled:A,workerOptions:{modelType:"pointTile"}}).then(function(k){r([k])}).catch(function(k){console.warn(k),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Vn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,v,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=m%4*3;return[b[A],b[A+1],b[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Vn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.shape,A=b===void 0?2:b,k=r.layer.getLayerConfig().shape2d,L=k.indexOf(A);return[L]}}})}}]),t}(Po);function Yw(e){var a=qw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function qw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $w=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Kw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
} else {
    vec2 pointPos = a_Position.xy;
    vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

    vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
    world.xy += pointOffset;

    if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // Needs to be divided with project_uCommonUnitsPerMeter
      world.w *= u_PixelsPerMeter.z;
    }

    gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);
}

`,Q1=function(e){(0,Pr.Z)(t,e);var a=Yw(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.tileOrigin,v=r.coord,m=v===void 0?"lnglat":v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var b=this.layer.getEncodedData(),A=this.calDataFrame(this.cellLength,b,this.cellProperties),k=A.data,L=A.width,B=A.height;this.rowCount=B,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:Y.LUMINANCE,type:Y.FLOAT,width:L,height:B}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_tileOrigin:h||[0,0],u_coord:m==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:u}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.triangulation=fm,this.layer.buildLayerModel({moduleName:"polygonTile",vertexShader:Kw,fragmentShader:$w,triangulation:fm,primitive:Y.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(Po);function Qw(e){var a=Jw();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Jw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ay=function(e){(0,Pr.Z)(t,e);var a=Qw(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"isVector",!0),(0,re.Z)((0,bt.Z)(n),"type",n.layerType),(0,re.Z)((0,bt.Z)(n),"pickedID",null),n}return(0,kt.Z)(t,[{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return Q1;case"LineLayer":return this.getLineModel();case"PointLayer":return this.getPointModel();default:return Jm}}},{key:"getLineModel",value:function(){var r,o=this.styleAttributeService.getLayerStyleAttribute("shape"),u=o==null||(r=o.scale)===null||r===void 0?void 0:r.field;switch(u){case"tileline":case"line":return iy;case"simple":return B1;default:return iy}}},{key:"getPointModel",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,h=r.find(function(m){return m.hasOwnProperty("shape")});if(h){var v=h.shape;return(u==null?void 0:u.indexOf(v))!==-1?Jm:K1}else return Jm}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Sd),eT=de(32676);function tT(e,a,t){t===void 0&&(t={});var n=Ht(e),r=Ht(a),o=eT.union(n.coordinates,r.coordinates);return o.length===0?null:o.length===1?on(o[0],t.properties):hi(o,t.properties)}var rT=tT;function nT(e,a){a===void 0&&(a={});var t=Ht(e);switch(!a.properties&&e.type==="Feature"&&(a.properties=e.properties),t.type){case"Polygon":return iT(t,a);case"MultiPolygon":return aT(t,a);default:throw new Error("invalid poly")}}function iT(e,a){a===void 0&&(a={});var t=Ht(e),n=t.coordinates,r=a.properties?a.properties:e.type==="Feature"?e.properties:{};return J1(n,r)}function aT(e,a){a===void 0&&(a={});var t=Ht(e),n=t.coordinates,r=a.properties?a.properties:e.type==="Feature"?e.properties:{},o=[];return n.forEach(function(u){o.push(J1(u,r))}),ga(o)}function J1(e,a){return e.length>1?fi(e,a):ra(e[0],a)}var Mv=function(){function e(a){(0,Zt.Z)(this,e),(0,re.Z)(this,"outSideEventTimer",null),(0,re.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=a.parent,this.mapService=a.mapService,this.rendererService=a.rendererService;var t=this.parentLayer.getSource();this.zoomOffset=t.parser.zoomOffset||0,this.tilesetManager=t.tileset}return(0,kt.Z)(e,[{key:"createTile",value:function(t,n){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,n){var r={features:[],featureId:null,vectorTileLayer:null,source:null},o=n.sourceLayer,u=n.featureId,h=n.transforms,v=n.layerType,m=n.shape;if(!o)return r;var b=t.data.layers[o],A=b==null?void 0:b.features;if(Array.isArray(A)&&A.length>0){var k=[];v==="LineLayer"&&m==="simple"?A.map(function(B){if(B.geometry.type==="MultiPolygon"){var Z,V=nT(B).features;(Z=k).push.apply(Z,(0,X.Z)(V))}else B.geometry.type==="Polygon"&&(B.geometry.type="MultiLineString"),k.push(B)}):k=A;var L=new Zo({type:"FeatureCollection",features:k},{parser:{type:"geojson",featureId:u},transforms:h});return{features:k,featureId:u,vectorTileLayer:b,source:L}}else return r}},{key:"createLayer",value:function(t){var n=t.L7Layer,r=t.tile,o=t.initOptions,u=t.vectorTileLayer,h=t.source,v=o.mask,m=o.color,b=o.layerType,A=o.size,k=o.shape,L=n||ay,B=new L((0,ae.Z)({visible:r.isVisible,tileOrigin:u==null?void 0:u.l7TileOrigin,coord:u==null?void 0:u.l7TileCoord},this.getLayerInitOption(o)));B.isVector&&(this.emitEvent([B]),B.type=b,B.select(!0)),B.source(h),this.setScale(B),this.setStyleAttributeField(B,"shape",k),this.setStyleAttributeField(B,"color",m),this.setStyleAttributeField(B,"size",A);var Z=[B];if(v&&B.isVector){var V=new O1().source({type:"FeatureCollection",features:[r.bboxPolygon]}).shape("fill");Z.push(V),B.addMaskLayer(V)}return ny(this.parentLayer,Z),this.layers=[B],B}},{key:"updateStyle",value:function(t){return""}},{key:"getDefautStyleAttributeField",value:function(t,n){switch(n){case"size":return 2;case"color":return"#fff";case"shape":return F1(this.parentLayer.type,t);default:return""}}},{key:"setStyleAttributeField",value:function(t,n,r){if(Array.isArray(r)){t[n].apply(t,(0,X.Z)(r));return}if(typeof r=="string"){t[n](r);return}var o=this.getDefautStyleAttributeField(t,n);if(!r)return t[n](o),t;var u=this.parseScaleValue(r,n);u.length===0?t[n](o):t[n].apply(t,(0,X.Z)(u))}},{key:"parseScaleValue",value:function(t,n){if(n==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var r=t,o=r.field,u=r.values,h=r.callback;return o&&u&&Array.isArray(u)?[o,u]:o&&h?[o,h]:o?[o]:[]}},{key:"getTile",value:function(t,n){var r=this.mapService.getZoom(),o=Math.ceil(r)+this.zoomOffset,u=mc(t,n,o),h=this.tilesetManager.tiles.filter(function(m){return m.key==="".concat(u[0],",").concat(u[1],",").concat(o)}),v=h[0];return v}},{key:"emitEvent",value:function(t,n){var r=this;t.map(function(o){o.once("inited",function(){o.on("click",function(u){if(r.eventCache.click=1,r.parentLayer.type==="RasterLayer"){var h=u.lngLat,v=h.lng,m=h.lat,b=r.getTile(v,m);r.getFeatureAndEmitEvent(o,"subLayerClick",u,n,b)}else r.getFeatureAndEmitEvent(o,"subLayerClick",u)}),o.on("mousemove",function(u){if(r.eventCache.mousemove=1,r.parentLayer.type==="RasterLayer"){var h=u.lngLat,v=h.lng,m=h.lat,b=r.getTile(v,m);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,n,b)}else r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u)}),o.on("mouseup",function(u){r.eventCache.mouseup=1,r.getFeatureAndEmitEvent(o,"subLayerMouseUp",u)}),o.on("mouseenter",function(u){if(r.parentLayer.type==="RasterLayer"){var h=u.lngLat,v=h.lng,m=h.lat,b=r.getTile(v,m);r.getFeatureAndEmitEvent(o,"subLayerMouseMove",u,n,b)}else r.getFeatureAndEmitEvent(o,"subLayerMouseEnter",u)}),o.on("mouseout",function(u){r.getFeatureAndEmitEvent(o,"subLayerMouseOut",u)}),o.on("mousedown",function(u){r.eventCache.mousedown=1,r.getFeatureAndEmitEvent(o,"subLayerMouseDown",u)}),o.on("contextmenu",function(u){r.eventCache.contextmenu=1,r.getFeatureAndEmitEvent(o,"subLayerContextmenu",u)}),o.on("unclick",function(u){return r.handleOutsideEvent("click","subLayerUnClick",o,u)}),o.on("unmouseup",function(u){return r.handleOutsideEvent("mouseup","subLayerUnMouseUp",o,u)}),o.on("unmousedown",function(u){return r.handleOutsideEvent("mousedown","subLayerUnMouseDown",o,u)}),o.on("uncontextmenu",function(u){return r.handleOutsideEvent("contextmenu","subLayerUnContextmenu",o,u)})})})}},{key:"getCombineFeature",value:function(t){var n=null,r=t[0];return t.map(function(o){var u=on(o.coordinates);n===null&&(n=u),n=rT(n,u)}),r&&(n.properties=(0,ae.Z)({},r)),n}},{key:"getFeatureAndEmitEvent",value:function(t,n,r,o,u){if(o===!1)r.value=Sw(u,this.mapService,r.x,r.y);else{var h=r.featureId,v=this.getAllFeatures(h);try{r.feature=this.getCombineFeature(v)}catch(m){console.warn("Combine Featuer Err! Return First Feature!"),r.feature=v[0]}}this.parentLayer.emit(n,r)}},{key:"setScale",value:function(t){var n=this.parentLayer.tileLayer.scaleField,r=Object.keys(n);r.map(function(o){t.scale(o,n[o])})}},{key:"getAllFeatures",value:function(t){var n=this.parentLayer.tileLayer.children,r=[];return n.map(function(o){var u=o.getSource();u.data.dataArray.map(function(h){h._id===t&&r.push(h)})}),r}},{key:"getLayerInitOption",value:function(t){var n=(0,ae.Z)({},t);return delete n.color,delete n.shape,delete n.size,delete n.coords,delete n.sourceLayer,delete n.coords,n}},{key:"handleOutsideEvent",value:function(t,n,r,o){var u=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){u.eventCache[t]>0?u.eventCache[t]=0:u.getFeatureAndEmitEvent(r,n,o)},64)}}]),e}();function oT(e){var a=sT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function sT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uT=function(e){(0,Pr.Z)(t,e);var a=oT(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,kt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),h=u.features,v=u.vectorTileLayer,m=u.source;if(h.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:m});return{layers:[b],layerIDList:[b.id]}}}]),t}(Mv);function lT(e){var a=cT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function cT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fT=function(e){(0,Pr.Z)(t,e);var a=lT(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,kt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),h=u.features,v=u.vectorTileLayer,m=u.source;if(h.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:m});return{layers:[b],layerIDList:[b.id]}}}]),t}(Mv);function hT(e){var a=pT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function pT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dT=function(e){(0,Pr.Z)(t,e);var a=hT(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,kt.Z)(t,[{key:"createTile",value:function(r,o){var u=this.getFeatureData(r,o),h=u.features,v=u.vectorTileLayer,m=u.source;if(h.length===0)return{layers:[],layerIDList:[]};var b=this.createLayer({tile:r,initOptions:o,vectorTileLayer:v,source:m});return{layers:[b],layerIDList:[b.id]}}}]),t}(Mv);function vT(e){var a=mT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function mT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ex=function(e){(0,Pr.Z)(t,e);var a=vT(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,kt.Z)(t,[{key:"createTile",value:function(r,o){var u=new Zo(r.data,{parser:{type:"image",extent:r.bounds}}),h=this.createLayer({L7Layer:R1,tile:r,initOptions:o,source:u});return{layers:[h],layerIDList:[h.id]}}}]),t}(Mv);function gT(e){var a=yT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function yT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _T=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,xT=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,oy=function(e){(0,Pr.Z)(t,e);var a=gT(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.clampLow,v=h===void 0?!0:h,m=r.clampHigh,b=m===void 0?!0:m,A=r.noDataValue,k=A===void 0?-9999999:A,L=r.domain,B=L===void 0?[0,1]:L,Z=r.rampColors;return(0,d.isEqual)(this.rampColors,Z)||(this.updateColorTexure(),this.rampColors=Z),{u_opacity:u||1,u_texture:this.texture,u_domain:B,u_clampLow:v,u_clampHigh:typeof b!="undefined"?b:v,u_noDataValue:k,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v,b=o.rampColorsData,A=o.rampColors,k=this.layer.getSource(),L=this.rendererService.createTexture2D,B=k.data.dataArray[0];this.texture=L({data:B.data,width:B.width,height:B.height,format:Y.LUMINANCE,type:Y.FLOAT});var Z=b||q(A);this.colorTexture=L({data:Z.data,width:Z.width,height:Z.height,flipY:!1}),this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:xT,fragmentShader:_T,triangulation:ty,primitive:Y.TRIANGLES,depth:{enable:!1},stencil:ye(h,m)}).then(function(V){r([V])}).catch(function(V){console.warn(V),r([])})}},{key:"buildModels",value:function(r){this.initModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.colorTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){return[h[3],h[4]]}}})}},{key:"updateColorTexure",value:function(){var r=this.rendererService.createTexture2D,o=this.layer.getLayerConfig(),u=o.rampColors,h=q(u);this.colorTexture=r({data:h.data,width:h.width,height:h.height,flipY:!1})}}]),t}(Po);function bT(e){var a=ET();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CT=function(e){(0,Pr.Z)(t,e);var a=bT(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type",n.layerType),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new o(this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelType",value:function(){return oy}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Sd);function ST(e){var a=AT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function AT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wT=function(e){(0,Pr.Z)(t,e);var a=ST(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,kt.Z)(t,[{key:"createTile",value:function(r,o){var u=o.opacity,h=o.domain,v=o.clampHigh,m=o.clampLow,b=o.rampColors,A=o.rampColorsData,k=o.mask,L=r.data;if(!L.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var B=new CT({visible:r.isVisible,mask:k}).source(L.data,{parser:{type:"raster",width:L.width,height:L.height,extent:r.bboxPolygon.bbox}}).style({opacity:u,domain:h,clampHigh:v,clampLow:m,rampColors:b,rampColorsData:A});return this.emitEvent([B],!1),ny(this.parentLayer,[B]),{layers:[B],layerIDList:[B.id]}}}]),t}(Mv);function TT(e){var a=MT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function MT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IT=function(e){(0,Pr.Z)(t,e);var a=TT(t);function t(n){var r;return(0,Zt.Z)(this,t),r=a.call(this,n),r.parentLayer=n.parent,r}return(0,kt.Z)(t,[{key:"createTile",value:function(r,o){var u=o.sourceLayer;if(!u)return{layers:[],layerIDList:[]};var h=r.data.layers[u],v=h==null?void 0:h.features;if(v.length===0)return{layers:[],layerIDList:[]};var m=v[0].properties,b=new ay({layerType:"PointLayer"}).source([m],{parser:{type:"json",x:"textLng",y:"textLat"}}).shape("key","text").size(20).color("#000").style({stroke:"#fff",strokeWidth:2}),A=new ay({layerType:"LineLayer"}).source({type:"FeatureCollection",features:v}).shape("simple").color("#000");return ny(this.parentLayer,[A,b]),{layers:[A,b],layerIDList:[A.id,b.id]}}}]),t}(Mv);function kT(e,a){switch(e){case"PolygonLayer":return dT;case"LineLayer":return uT;case"PointLayer":return fT;case"TileDebugLayer":return IT;case"RasterLayer":return a.dataType==="arraybuffer"?wT:ex;default:return console.warn("Current Tile Not Exist!"),ex}}function PT(e){var a=LT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function LT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RT=function(e){(0,Pr.Z)(t,e);var a=PT(t);function t(){var n;return(0,Zt.Z)(this,t),n=a.call(this),(0,re.Z)((0,bt.Z)(n),"checkConfigList",[]),n.cacheConfig=new Map,n}return(0,kt.Z)(t,[{key:"setConfig",value:function(r,o){this.checkConfigList.includes(r)||this.checkConfigList.push(r),this.cacheConfig.set(r,o)}},{key:"removeConfig",value:function(r){var o=this.checkConfigList.indexOf(r);o>-1&&(this.cacheConfig.delete(r),this.checkConfigList.splice(o,1))}},{key:"checkConfig",value:function(r){var o=this;if(!!r.inited){var u=r.getLayerConfig(),h=[];this.checkConfigList.map(function(v){var m=o.cacheConfig.get(v),b;if(["color","size","shape"].includes(v)){var A;b=(A=r.getAttribute(v))===null||A===void 0?void 0:A.scale}else{if(!(v in u))return;b=u[v]}(0,d.isEqual)(m,b)||(h.push(v),o.setConfig(v,b))}),h.length>0&&(console.warn("tile config cache update!",h),this.emit("updateConfig",h))}}},{key:"getAttributeScale",value:function(r,o){var u=r.getAttribute(o),h={field:void 0,values:void 0,callback:void 0};if(u&&u.scale){var v=u.scale,m=v.field,b=v.values,A=v.callback;h.field=m,h.values=b,h.callback=A}return h}}]),t}(kp());function OT(e){var a=FT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function FT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DT=function(e){(0,Pr.Z)(t,e);var a=OT(t);function t(n,r,o,u,h){var v;return(0,Zt.Z)(this,t),v=a.call(this),(0,re.Z)((0,bt.Z)(v),"isLastPicked",!1),v.parent=n,v.rendererService=r,v.pickingService=o,v.layerService=h,v.children=u,v}return(0,kt.Z)(t,[{key:"normalRender",value:function(r){var o=this;r.filter(function(u){return u.inited}).filter(function(u){return u.isVisible()}).map(function(u){u.hooks.beforeRenderData.call(),u.hooks.beforeRender.call(),u.masks.length>0&&(o.rendererService.clear({stencil:0,depth:1,framebuffer:null}),u.masks.map(function(h){h.hooks.beforeRenderData.call(),h.hooks.beforeRender.call(),h.render(),h.hooks.afterRender.call()})),u.render(),u.hooks.afterRender.call()})}},{key:"pickRender",value:function(r,o){var u=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var h=r.filter(function(v){return u.parent.needPick(o.type)&&v.inited&&v.isVisible()}).some(function(v){v.hooks.beforePickingEncode.call(),v.masks.length>0&&(u.rendererService.clear({stencil:0,depth:1,framebuffer:null}),v.masks.map(function(b){b.hooks.beforeRender.call(),b.render(),b.hooks.afterRender.call()})),v.renderModels(!0),v.hooks.afterPickingEncode.call();var m=u.pickingService.pickFromPickingFBO(v,o);return m&&u.parent.type!=="RasterLayer"&&(u.emit("pick",{type:o.type,pickedColors:u.pickingService.pickedColors,layer:v}),u.pickingService.pickedTileLayers=[u.parent]),m});return this.parent.type!=="RasterLayer"&&!h&&this.isLastPicked&&o.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=h,h}},{key:"clearPick",value:function(){this.children.filter(function(r){return r.inited&&r.isVisible()}).map(function(r){r.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeHighlight.call(r)})}},{key:"beforeSelect",value:function(r){this.children.filter(function(o){return o.inited&&o.isVisible()}).map(function(o){o.hooks.beforeSelect.call(r)})}},{key:"renderMask",value:function(r){r.inited&&r.isVisible()&&(r.hooks.beforeRender.call(),r.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),r.masks.map(function(o){o.hooks.beforeRender.call(),o.render(),o.hooks.afterRender.call()})),r.hooks.afterRender.call())}}]),t}(Xu.EventEmitter),BT=function(){function e(a,t,n,r,o,u){(0,Zt.Z)(this,e),this.parent=a,this.children=a.layerChildren,this.mapService=t,this.rendererService=n,this.transforms=u,this.tilePickManager=new DT(a,n,r,this.children,o),this.tileConfigManager=new RT,this.setSubLayerInitOptipn(),this.setConfigListener(),this.initTileFactory()}return(0,kt.Z)(e,[{key:"createTile",value:function(t){return this.tileFactory.createTile(t,this.initOptions)}},{key:"updateLayersConfig",value:function(t,n,r){t.map(function(o){n==="mask"?o.style({mask:r}):o.updateLayerConfig((0,re.Z)({},n,r))})}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChilds",value:function(t){var n;(n=this.children).push.apply(n,(0,X.Z)(t))}},{key:"removeChilds",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=[],o=[];this.children.filter(function(u){t.includes(u.id)?r.push(u):o.push(u)}),r.map(function(u){return u.destroy(n)}),this.children=o}},{key:"removeChild",value:function(t){var n=this.children.indexOf(t);n>-1&&this.children.splice(n,1),t.destroy()}},{key:"getChilds",value:function(t){return this.children.filter(function(n){return t.includes(n.id)})}},{key:"getChild",value:function(t){return this.children.filter(function(n){return n.id===t})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(t){t.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"render",value:function(){var t,n;(t=this.tileConfigManager)===null||t===void 0||t.checkConfig(this.parent),(n=this.tilePickManager)===null||n===void 0||n.normalRender(this.children)}},{key:"pickLayers",value:function(t){var n;return(n=this.tilePickManager)===null||n===void 0?void 0:n.pickRender(this.children,t)}},{key:"setSubLayerInitOptipn",value:function(){var t,n=this.parent.getLayerConfig(),r=n.zIndex,o=r===void 0?0:r,u=n.opacity,h=u===void 0?1:u,v=n.mask,m=v===void 0?!1:v,b=n.stroke,A=b===void 0?"#fff":b,k=n.strokeWidth,L=k===void 0?0:k,B=n.strokeOpacity,Z=B===void 0?1:B,V=n.clampLow,K=V===void 0?!0:V,le=n.clampHigh,be=le===void 0?!0:le,Be=n.domain,et=Be===void 0?[0,1]:Be,at=n.rampColors,Lt=at===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:at,Gt=n.featureId,sr=Gt===void 0?"id":Gt,Tr=n.workerEnabled,Er=Tr===void 0?!1:Tr,Qr=n.sourceLayer,On=n.pixelConstant,li=On===void 0?0:On,Da=n.pixelConstantR,Wa=Da===void 0?256*256:Da,ks=n.pixelConstantG,Tu=ks===void 0?256:ks,gu=n.pixelConstantB,hf=gu===void 0?1:gu,I0=n.pixelConstantRGB,k0=I0===void 0?.1:I0,fv=this.tileConfigManager.getAttributeScale(this.parent,"color"),zv=this.tileConfigManager.getAttributeScale(this.parent,"size"),P0=this.parent.getSource(),Uv=(P0==null||(t=P0.data)===null||t===void 0?void 0:t.tilesetOptions)||{},Uy=Uv.coords,Zy=P0.getParserType(),Ji=F1(this.parent.type,this.parent);Lt&&(this.rampColorsData=q(Lt)),this.initOptions={layerType:this.parent.type,transforms:this.transforms,shape:Ji,zIndex:o,opacity:h,sourceLayer:this.getSourceLayer(Zy,Qr),coords:Uy,featureId:sr,color:fv,size:zv,mask:Ew(this.parent.type,m),stroke:A,strokeWidth:L,strokeOpacity:Z,clampLow:K,clampHigh:be,domain:et,rampColors:Lt,rampColorsData:this.rampColorsData,workerEnabled:Er,pixelConstant:li,pixelConstantR:Wa,pixelConstantG:Tu,pixelConstantB:hf,pixelConstantRGB:k0}}},{key:"getSourceLayer",value:function(t,n){return t==="geojsonvt"?"geojsonvt":t==="testTile"?"testTile":n}},{key:"setConfigListener",value:function(){var t=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow),this.tileConfigManager.setConfig("pixelConstant",this.initOptions.pixelConstant),this.tileConfigManager.setConfig("pixelConstantR",this.initOptions.pixelConstantR),this.tileConfigManager.setConfig("pixelConstantG",this.initOptions.pixelConstantG),this.tileConfigManager.setConfig("pixelConstantB",this.initOptions.pixelConstantB),this.tileConfigManager.setConfig("pixelConstantRGB",this.initOptions.pixelConstantRGB);else{var n,r,o;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(n=this.parent.getAttribute("color"))===null||n===void 0?void 0:n.scale),this.tileConfigManager.setConfig("shape",(r=this.parent.getAttribute("shape"))===null||r===void 0?void 0:r.scale),this.tileConfigManager.setConfig("size",(o=this.parent.getAttribute("size"))===null||o===void 0?void 0:o.scale)}this.tileConfigManager.on("updateConfig",function(u){u.map(function(h){return t.updateStyle(h),""})})}},{key:"updateStyle",value:function(t){var n=this,r=null;if(["size","color","shape"].includes(t)){var o,u=(o=this.parent.getAttribute(t))===null||o===void 0?void 0:o.scale;if(!u)return;r=u,this.children.map(function(m){return n.tileFactory.setStyleAttributeField(m,t,u),""})}else{var h=this.parent.getLayerConfig();if(!(t in h))return;var v=h[t];r=v,this.updateLayersConfig(this.children,t,v),t==="rampColors"&&v&&(this.rampColorsData=q(v))}this.initOptions[t]=r}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),n=kT(this.parent.type,t.parser);this.tileFactory=new n({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}}]),e}(),NT=function(){function e(a){var t,n=a.parent,r=a.rendererService,o=a.mapService,u=a.layerService,h=a.pickingService,v=a.transforms;(0,Zt.Z)(this,e),(0,re.Z)(this,"type","baseTile"),(0,re.Z)(this,"initedTileset",!1),(0,re.Z)(this,"pickColors",{select:null,active:null});var m=n.getSource(),b=(m==null||(t=m.data)===null||t===void 0?void 0:t.tilesetOptions)||{},A=b.sourceLayer,k=b.coords,L=b.featureId;this.sourceLayer=A,this.parent=n,this.mapService=o,this.layerService=u,this.tileLayerManager=new BT(n,o,r,h,u,v),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return(0,kt.Z)(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var t=this;this.children.filter(function(n){return n.inited&&n.isVisible()}).filter(function(n){return n.getCurrentSelectedId()!==null}).map(function(n){t.selectFeature(n,new Uint8Array([0,0,0,0])),n.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(n){return n.isLoaded}).map(function(n){if(n.layerIDList.length===0){var r=t.tileLayerManager.createTile(n),o=r.layers,u=r.layerIDList;n.layerIDList=u,t.tileLayerManager.addChilds(o)}else{if(!n.isVisibleChange)return;var h=t.tileLayerManager.getChilds(n.layerIDList);t.tileLayerManager.updateLayersConfig(h,"visible",n.isVisible)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"setPickState",value:function(t){var n=this;if(this.pickColors.select){var r=R(this.pickColors.select);t.map(function(u){n.selectFeature(u,n.pickColors.select),u.setCurrentSelectedId(r)})}if(this.pickColors.active){var o=R(this.pickColors.active);t.filter(function(u){return u.inited&&u.isVisible()}).map(function(u){u.hooks.beforeHighlight.call(n.pickColors.active),u.setCurrentPickId(o)})}}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickManager.on("pick",function(n){var r=(0,Mr.Z)(n.pickedColors,3),o=r[0],u=r[1],h=r[2];if(n.type==="click"){var v=t.children.filter(function(m){return m.inited&&m.isVisible()&&m.isVector}).filter(function(m){return m!==n.layer});t.setSelect(v,[o,u,h])}else t.setHighlight([o,u,h])}),this.tileLayerManager.tilePickManager.on("unpick",function(){t.pickColors.active=null})}},{key:"setHighlight",value:function(t){var n=R(t);this.pickColors.active=t,this.children.filter(function(r){return r.inited&&r.isVisible()&&r.isVector}).filter(function(r){return r.getPickID()!==n}).map(function(r){r.setPickID(n),r.hooks.beforeHighlight.call(t)})}},{key:"setSelect",value:function(t,n){var r=this,o=R(n);t.map(function(h){h.getCurrentSelectedId()===null||o!==h.getCurrentSelectedId()?(r.selectFeature(h,n),h.setCurrentSelectedId(o),r.pickColors.select=n):(r.selectFeature(h,new Uint8Array([0,0,0,0])),h.setCurrentSelectedId(null),r.pickColors.select=null)});var u=this.layerService.getRenderList();u.filter(function(h){return h.inited&&!h.isVector&&h.isVisible()&&h.needPick("click")}).filter(function(h){return h.getCurrentSelectedId()!==null}).map(function(h){r.selectFeature(h,new Uint8Array([0,0,0,0])),h.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(t,n){var r=(0,Mr.Z)(n,3),o=r[0],u=r[1],h=r[2];t.hooks.beforeSelect.call([o,u,h])}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(n){t.parent.emit("click",(0,ae.Z)({},n))}),this.parent.on("subLayerMouseMove",function(n){return t.parent.emit("mousemove",(0,ae.Z)({},n))}),this.parent.on("subLayerMouseUp",function(n){return t.parent.emit("mouseup",(0,ae.Z)({},n))}),this.parent.on("subLayerMouseEnter",function(n){return t.parent.emit("mouseenter",(0,ae.Z)({},n))}),this.parent.on("subLayerMouseOut",function(n){return t.parent.emit("mouseout",(0,ae.Z)({},n))}),this.parent.on("subLayerMouseDown",function(n){return t.parent.emit("mousedown",(0,ae.Z)({},n))}),this.parent.on("subLayerContextmenu",function(n){return t.parent.emit("contextmenu",(0,ae.Z)({},n))}),this.parent.on("subLayerUnClick",function(n){return t.parent.emit("unclick",(0,ae.Z)({},n))}),this.parent.on("subLayerUnMouseMove",function(n){return t.parent.emit("unmousemove",(0,ae.Z)({},n))}),this.parent.on("subLayerUnMouseUp",function(n){return t.parent.emit("unmouseup",(0,ae.Z)({},n))}),this.parent.on("subLayerUnMouseDown",function(n){return t.parent.emit("unmousedown",(0,ae.Z)({},n))}),this.parent.on("subLayerUnContextmenu",function(n){return t.parent.emit("uncontextmenu",(0,ae.Z)({},n))})}},{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var r=this.getCurrentView(),o=r.latLonBounds,u=r.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(u,o)}},{key:"mapchange",value:function(){var t,n=this.getCurrentView(),r=n.latLonBounds,o=n.zoom;if(this.mapService.version==="GAODE1.x"){var u=this.parent.getLayerConfig(),h=u.visible;o<3&&h?(this.parent.updateLayerConfig({visible:!1}),this.layerService.updateLayerRenderList()):o>=3&&!h&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.updateLayerRenderList())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===r.toString()||(this.lastViewStates={zoom:o,latLonBounds:r},this.timer&&(clearTimeout(this.timer),this.timer=null),(t=this.tilesetManager)===null||t===void 0||t.update(o,r))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,r){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.mapchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],r=this.mapService.getZoom();return{latLonBounds:n,zoom:r}}}]),e}();function zT(e){var a=UT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function UT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZT=function(e){(0,Pr.Z)(t,e);var a=zT(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","TMS"),n}return(0,kt.Z)(t,[{key:"tileUnLoad",value:function(r){this.tileLayerManager.removeChilds(r.layerIDList,!1)}},{key:"tileUpdate",value:function(){var r=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(o){return o.isLoaded}).map(function(o){var u;if((u=o.data)!==null&&u!==void 0&&u.layers&&r.sourceLayer){var h=o.data.layers[r.sourceLayer],v=h==null?void 0:h.features;if(!(Array.isArray(v)&&v.length>0))return}if(o.parentLayerIDList.includes(r.parent.id)){if(!o.isVisibleChange)return;var L=r.tileLayerManager.getChilds(o.layerIDList);r.tileLayerManager.updateLayersConfig(L,"visible",o.isVisible),r.setPickState(L)}else{var m,b=r.tileLayerManager.createTile(o),A=b.layers,k=b.layerIDList;o.parentLayerIDList.push(r.parent.id),(m=o.layerIDList).push.apply(m,(0,X.Z)(k)),r.tileLayerManager.addChilds(A),r.setPickState(A)}}),this.parent.renderLayers(),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(NT);function VT(e){var a=jT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function jT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eg=function(e){(0,Pr.Z)(t,e);var a=VT(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var r=this.layer.getSource();return r!=null&&r.data.isTile&&(this.layer.tileLayer=new ZT({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService,transforms:r.transforms})),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(Po);function GT(e){var a=HT();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function HT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WT=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,XT=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,YT=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,qT=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
     return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  float arcThetaOffset = styleMappingMat[0][1];
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, arcThetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, arcThetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,$T=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,KT=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,QT={solid:0,dash:1},JT=function(e){(0,Pr.Z)(t,e);var a=GT(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,v=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,k=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5]:L,Z=r.forward,V=Z===void 0?!0:Z,K=r.lineTexture,le=K===void 0?!1:K,be=r.iconStep,Be=be===void 0?100:be,et=r.segmentNumber,at=et===void 0?30:et,Lt=r.thetaOffset,Gt=Lt===void 0?.314:Lt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,thetaOffset:Gt})){this.judgeStyleAttributes({opacity:u,thetaOffset:Gt});var sr=this.layer.getEncodedData(),Tr=this.calDataFrame(this.cellLength,sr,this.cellProperties),Er=Tr.data,Qr=Tr.width,On=Tr.height;this.rowCount=On,this.dataTexture=this.cellLength>0&&Er.length>0?this.createTexture2D({flipY:!0,data:Er,format:Y.LUMINANCE,type:Y.FLOAT,width:Qr,height:On}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}B.length===2&&B.push(0,0);var li=0,Da=[0,0,0,0],Wa=[0,0,0,0];return h&&v&&(Da=I(h),Wa=I(v),li=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:(0,d.isNumber)(Gt)?Gt:0,u_opacity:(0,d.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:at,u_line_type:QT[k||"solid"],u_dash_array:B,u_blur:.9,u_lineDir:V?1:-1,u_texture:this.texture,u_line_texture:le?1:0,u_icon_step:Be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:li,u_sourceColor:Da,u_targetColor:Wa}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,h=r.lineType;return h==="dash"?{frag:WT,vert:XT,type:"Dash"}:o&&u?{frag:$T,vert:KT,type:"Linear"}:{frag:YT,vert:qT,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,h=u===void 0?30:u,v=o.mask,m=v===void 0?!1:v,b=o.maskInside,A=b===void 0?!0:b,k=this.getShaders(),L=k.frag,B=k.vert,Z=k.type;this.layer.buildLayerModel({moduleName:"lineArc2d"+Z,vertexShader:B,fragmentShader:L,triangulation:Km,depth:{enable:!1},blend:this.getBlend(),segmentNumber:h,stencil:ye(m,A)}).then(function(V){r([V])}).catch(function(V){console.warn(V),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Vn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(u,h,v,m){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.texture,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}})}}]),t}(Po);function eM(e){var a=tM();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function tM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,nM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,iM=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,aM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,oM={solid:0,dash:1},sM=function(e){(0,Pr.Z)(t,e);var a=eM(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,v=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,k=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5]:L,Z=r.lineTexture,V=Z===void 0?!1:Z,K=r.iconStep,le=K===void 0?100:K,be=r.segmentNumber,Be=be===void 0?30:be,et=r.globalArcHeight,at=et===void 0?10:et;B.length===2&&B.push(0,0);var Lt=0,Gt=[0,0,0,0],sr=[0,0,0,0];if(h&&v&&(Gt=I(h),sr=I(v),Lt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Tr=this.layer.getEncodedData(),Er=this.calDataFrame(this.cellLength,Tr,this.cellProperties),Qr=Er.data,On=Er.width,li=Er.height;this.rowCount=li,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:Y.LUMINANCE,type:Y.FLOAT,width:On,height:li}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:$g,u_global_height:at,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Be,u_line_type:oM[k]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:V?1:0,u_icon_step:le,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Lt,u_sourceColor:Gt,u_targetColor:sr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:iM,vert:aM,type:"Linear"}:{frag:rM,vert:nM,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,h=u===void 0?30:u,v=o.mask,m=v===void 0?!1:v,b=o.maskInside,A=b===void 0?!0:b,k=this.getShaders(),L=k.frag,B=k.vert,Z=k.type;this.layer.buildLayerModel({moduleName:"lineArc3d"+Z,vertexShader:B,fragmentShader:L,triangulation:Km,blend:this.getBlend(),segmentNumber:h,stencil:ye(m,A)}).then(function(V){r([V])}).catch(function(V){console.warn(V),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Vn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(u,h,v,m){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.texture,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}})}}]),t}(Po);function uM(e){var a=lM();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,fM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,hM=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,pM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,dM={solid:0,dash:1},vM=function(e){(0,Pr.Z)(t,e);var a=uM(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,v=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,k=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5]:L,Z=r.lineTexture,V=Z===void 0?!1:Z,K=r.iconStep,le=K===void 0?100:K,be=r.segmentNumber,Be=be===void 0?30:be,et=r.globalArcHeight,at=et===void 0?10:et;B.length===2&&B.push(0,0);var Lt=0,Gt=[0,0,0,0],sr=[0,0,0,0];if(h&&v&&(Gt=I(h),sr=I(v),Lt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Tr=this.layer.getEncodedData(),Er=this.calDataFrame(this.cellLength,Tr,this.cellProperties),Qr=Er.data,On=Er.width,li=Er.height;this.rowCount=li,this.dataTexture=this.cellLength>0&&Qr.length>0?this.createTexture2D({flipY:!0,data:Qr,format:Y.LUMINANCE,type:Y.FLOAT,width:On,height:li}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_globel:1,u_globel_radius:$g,u_global_height:at,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Be,u_line_type:dM[k]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:V?1:0,u_icon_step:le,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Lt,u_sourceColor:Gt,u_targetColor:sr}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor;return o&&u?{frag:hM,vert:pM,type:"Linear"}:{frag:cM,vert:fM,type:""}}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.segmentNumber,h=u===void 0?30:u,v=o.mask,m=v===void 0?!1:v,b=o.maskInside,A=b===void 0?!0:b,k=this.getShaders(),L=k.frag,B=k.vert,Z=k.type;this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+Z,vertexShader:B,fragmentShader:L,triangulation:Km,depth:{enable:!0},blend:this.getBlend(),segmentNumber:h,stencil:ye(m,A)}).then(function(V){r([V])}).catch(function(V){console.warn(V),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Vn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(u,h,v,m){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.texture,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}})}}]),t}(Po);function mM(e){var a=gM();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function gM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,_M=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,xM={solid:0,dash:1},bM=function(e){(0,Pr.Z)(t,e);var a=mM(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,v=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,k=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5]:L,Z=r.lineTexture,V=Z===void 0?!1:Z,K=r.iconStep,le=K===void 0?100:K,be=r.segmentNumber,Be=be===void 0?30:be;B.length===2&&B.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var et=0,at=[0,0,0,0],Lt=[0,0,0,0];if(h&&v&&(at=I(h),Lt=I(v),et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Gt=this.layer.getEncodedData(),sr=this.calDataFrame(this.cellLength,Gt,this.cellProperties),Tr=sr.data,Er=sr.width,Qr=sr.height;this.rowCount=Qr,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:Y.LUMINANCE,type:Y.FLOAT,width:Er,height:Qr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,segmentNumber:Be,u_line_type:xM[k]||0,u_dash_array:B,u_texture:this.texture,u_line_texture:V?1:0,u_icon_step:le,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:et,u_sourceColor:at,u_targetColor:Lt}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:_M,fragmentShader:yM,triangulation:Km,depth:{enable:!1},blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Vn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(u,h,v,m){return[v[3],v[4],v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.texture,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}})}}]),t}(Po);function EM(e){var a=CM();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function CM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SM=`#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
uniform float u_CoordinateSystem;
varying vec4 v_color;
uniform float u_arrow: 0.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

varying mat4 styleMappingMat;
void main() {
  float distanceAndIndex = styleMappingMat[0][3];
  float miter = styleMappingMat[0][2];

  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B


  if(u_arrow > 0.0 && distanceAndIndex < 2.0) { // arrow
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) { 
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z < 0.0) { // amap
        discard;
      }
    } else { // amap2 mapbox map
      if(cross(vec3(styleMappingMat[1].rg, 0.0), vec3(styleMappingMat[1].ba, 0.0)).z > 0.0) { 
        discard;
      }
    }
  } else { // line body
    if(miter < 0.0) {
      discard;
    }
  }


  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,AM=`attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute vec4 a_dirPoints;
attribute vec3 a_DistanceAndIndex;

uniform vec4 u_lineDir;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - a_Miter - a_DistanceAndIndex
    0.0, 0.0, 0.0, 0.0, // originX - originY - vectorX - vectorY
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );
  styleMappingMat[0][3] = a_DistanceAndIndex.y;
  styleMappingMat[0][2] = a_Miter;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  // styleMappingMat[1].rg = a_Position.xy + offset;

  vec2 copyOffset = vec2(offset.x, offset.y);

  float lineDistance = a_DistanceAndIndex.x;
  float total_Distance = a_DistanceAndIndex.z;
  float currentLinePointRatio = lineDistance / total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z); // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }
  
  if(u_arrow > 0.0 && a_DistanceAndIndex.y < 2.0) {
    vec2 startPoint = a_dirPoints.rg;
    vec2 endPoint = a_dirPoints.ba;
    vec4 t1 = project_position(vec4(startPoint, 0, 1.0));
    vec4 t2 = project_position(vec4(endPoint, 0, 1.0));
    // TODO\uFF1A \u540E\u7EED\u4F18\u5316\u53EF\u4EE5\u628A\u4F4D\u7F6E\u8BA1\u7B97\u653E\u5728 cpu \u4E2D\u5B8C\u6210
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      vec2 p1 = (u_Mvp * vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = (u_Mvp * vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    } else {
      vec2 p1 = project_common_position_to_clipspace(vec4(t1.xy, 0.0, 1.0)).xy;
      vec2 p2 = project_common_position_to_clipspace(vec4(t2.xy, 0.0, 1.0)).xy;
      styleMappingMat[1].rg = normalize(p1 - p2);
      styleMappingMat[1].ba = normalize(gl_Position.xy - p2);
    }
  }

  setPickingColor(a_PickingColor);
}
`,wM=function(e){(0,Pr.Z)(t,e);var a=EM(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,v=r.targetColor,m=r.arrow,b=m===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:m,A=0,k=[0,0,0,0],L=[0,0,0,0];if(h&&v&&(k=I(h),L=I(v),A=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var B=this.layer.getEncodedData(),Z=this.calDataFrame(this.cellLength,B,this.cellProperties),V=Z.data,K=Z.width,le=Z.height;this.rowCount=le,this.dataTexture=this.cellLength>0&&V.length>0?this.createTexture2D({flipY:!0,data:V,format:Y.LUMINANCE,type:Y.FLOAT,width:K,height:le}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_linearColor:A,u_sourceColor:k,u_targetColor:L,u_arrow:Number(b.enable),u_arrowHeight:b.arrowHeight||3,u_arrowWidth:b.arrowWidth||2,u_tailWidth:b.tailWidth===void 0?1:b.tailWidth}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"buildModels",value:function(){var n=(0,_a.Z)(di().mark(function o(u){var h,v,m,b,A,k,L,B,Z,V;return di().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:h=this.layer.getLayerConfig(),v=h.mask,m=v===void 0?!1:v,b=h.maskInside,A=b===void 0?!0:b,k=h.depth,L=k===void 0?!1:k,B=this.getShaders(),Z=B.frag,V=B.vert,this.layer.triangulation=iv,this.layer.buildLayerModel({moduleName:"lineHalf",vertexShader:V,fragmentShader:Z,triangulation:iv,depth:{enable:L},blend:this.getBlend(),stencil:ye(m,A)}).then(function(be){u([be])}).catch(function(be){console.warn(be),u([])});case 4:case"end":return le.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(){return{frag:SM,vert:AM,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Vn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v,m,b){return b===void 0?[h[3],10,h[5]]:[h[3],b,h[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"dirPoints",type:Vn.Attribute,descriptor:{name:"a_dirPoints",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(o,u,h,v){var m=o.coordinates[0]||[0,0],b=o.coordinates[3]||[0,0];return[m[0],m[1],b[0],b[1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Vn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){return[h[4]]}}})}}]),t}(Po),tx;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(tx||(tx={}));var Iv;(function(e){e.VERTICAL="vertical",e.HORIZONTAL="horizontal"})(Iv||(Iv={}));var sy;(function(e){e.NORMAL="normal",e.REPLACE="replace"})(sy||(sy={}));var rx;(function(e){e.ALWAYS="always",e.DRAGEND="dragend"})(rx||(rx={}));function TM(e){var a=MM();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function MM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IM=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,kM=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,PM=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;

uniform vec3 u_blur;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = styleMappingMat[3][3];
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,nx=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,LM=`varying vec4 v_color;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3][0]; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,RM={solid:0,dash:1},ix=function(e){(0,Pr.Z)(t,e);var a=TM(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,v=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.lineType,k=A===void 0?"solid":A,L=r.dashArray,B=L===void 0?[10,5,0,0]:L,Z=r.lineTexture,V=Z===void 0?!1:Z,K=r.iconStep,le=K===void 0?100:K,be=r.vertexHeightScale,Be=be===void 0?20:be,et=r.borderWidth,at=et===void 0?0:et,Lt=r.borderColor,Gt=Lt===void 0?"#ccc":Lt,sr=r.raisingHeight,Tr=sr===void 0?0:sr,Er=r.heightfixed,Qr=Er===void 0?!1:Er,On=r.linearDir,li=On===void 0?Iv.VERTICAL:On,Da=r.blur,Wa=Da===void 0?[1,1,1]:Da,ks=r.arrow,Tu=ks===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:ks;B.length===2&&B.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var gu=0,hf=[0,0,0,0],I0=[0,0,0,0];if(h&&v&&(hf=I(h),I0=I(v),gu=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var k0=this.layer.getEncodedData(),fv=this.calDataFrame(this.cellLength,k0,this.cellProperties),zv=fv.data,P0=fv.width,Uv=fv.height;this.rowCount=Uv,this.dataTexture=this.cellLength>0&&zv.length>0?this.createTexture2D({flipY:!0,data:zv,format:Y.LUMINANCE,type:Y.FLOAT,width:P0,height:Uv}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_textureBlend:b===sy.NORMAL?0:1,u_line_type:RM[k],u_dash_array:B,u_blur:Wa,u_texture:this.texture,u_line_texture:V?1:0,u_icon_step:le,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:at,u_borderColor:I(Gt),u_linearDir:li===Iv.VERTICAL?1:0,u_linearColor:gu,u_sourceColor:hf,u_targetColor:I0,u_heightfixed:Number(Qr),u_vertexScale:Be,u_raisingHeight:Number(Tr),u_arrow:Number(Tu.enable),u_arrowHeight:Tu.arrowHeight||3,u_arrowWidth:Tu.arrowWidth||2,u_tailWidth:Tu.tailWidth===void 0?1:Tu.tailWidth}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v,b=o.depth,A=b===void 0?!1:b,k=o.workerEnabled,L=k===void 0?!1:k,B=o.enablePicking,Z=this.getShaders(),V=Z.frag,K=Z.vert,le=Z.type;this.layer.triangulation=Fh,this.layer.buildLayerModel({moduleName:"line"+le,vertexShader:K,fragmentShader:V,triangulation:Fh,depth:{enable:A},blend:this.getBlend(),stencil:ye(h,m),workerEnabled:L,workerOptions:{modelType:"line"+le,enablePicking:B,iconMap:this.iconService.getIconMap()}}).then(function(be){r([be])}).catch(function(be){console.warn(be),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.sourceColor,u=r.targetColor,h=r.lineType;return h==="dash"?{frag:IM,vert:kM,type:"Dash"}:o&&u?{frag:LM,vert:nx,type:"Linear"}:{frag:PM,vert:nx,type:""}}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Vn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m,b,A){return A===void 0?[v[3],10]:[v[3],A]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Vn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,v,m,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Vn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.texture,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}})}}]),t}(Po);function OM(e){var a=FM();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function FM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DM=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float linearRadio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = styleMappingMat[3][3];
  }

  gl_FragColor = texture2D(u_texture, vec2(linearRadio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,BM=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,NM=function(e){(0,Pr.Z)(t,e);var a=OM(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var v=n.layer.getLayerConfig(),m=v.rampColors,b=q(m);n.colorTexture=h({data:new Uint8Array(b.data),width:b.width,height:b.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.NEAREST,mag:Y.NEAREST,flipY:!1})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.vertexHeightScale,v=h===void 0?20:h,m=r.raisingHeight,b=m===void 0?0:m,A=r.heightfixed,k=A===void 0?!1:A,L=r.linearDir,B=L===void 0?Iv.VERTICAL:L;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var Z=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,Z,this.cellProperties),K=V.data,le=V.width,be=V.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:Y.LUMINANCE,type:Y.FLOAT,width:le,height:be}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_linearDir:B===Iv.VERTICAL?1:0,u_opacity:(0,d.isNumber)(u)?u:1,u_texture:this.colorTexture,u_heightfixed:Number(k),u_vertexScale:v,u_raisingHeight:Number(b)}}},{key:"initModels",value:function(r){this.updateTexture(),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.colorTexture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v,b=o.depth,A=b===void 0?!1:b;this.layer.triangulation=iv,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:BM,fragmentShader:DM,triangulation:iv,depth:{enable:A},blend:this.getBlend(),stencil:ye(h,m)}).then(function(k){r([k])}).catch(function(k){console.warn(k),r([])})}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Vn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v,m,b){return b===void 0?[h[3],10]:[h[3],b]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Vn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){return[h[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0],b[1]]:[b,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Vn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){return[h[4]]}}})}}]),t}(Po);function zM(e){var a=UM();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function UM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZM=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,VM=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,jM=function(e){(0,Pr.Z)(t,e);var a=zM(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.sourceColor,v=r.targetColor,m=r.textureBlend,b=m===void 0?"normal":m,A=r.heightfixed,k=A===void 0?!1:A,L=r.lineTexture,B=L===void 0?!1:L,Z=r.iconStep,V=Z===void 0?100:Z,K=r.iconStepCount,le=K===void 0?1:K;this.rendererService.getDirty()&&this.texture.bind();var be=0,Be=[0,0,0,0],et=[0,0,0,0];if(h&&v&&(Be=I(h),et=I(v),be=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var at=this.layer.getEncodedData(),Lt=this.calDataFrame(this.cellLength,at,this.cellProperties),Gt=Lt.data,sr=Lt.width,Tr=Lt.height;this.rowCount=Tr,this.dataTexture=this.cellLength>0&&Gt.length>0?this.createTexture2D({flipY:!0,data:Gt,format:Y.LUMINANCE,type:Y.FLOAT,width:sr,height:Tr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_heightfixed:Number(k),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_textureBlend:b==="normal"?0:1,u_texture:this.texture,u_line_texture:B?1:0,u_iconStepCount:le,u_icon_step:V,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:be,u_sourceColor:Be,u_targetColor:et}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption;return{u_aimate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:VM,fragmentShader:ZM,triangulation:iv,depth:{enable:!1},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Vn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Vn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=u.size,A=b===void 0?1:b;return Array.isArray(A)?[A[0],A[1]]:[A,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,v,m,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Vn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){return[v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.texture,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}})}}]),t}(Po),GM={arc:JT,arc3d:sM,greatcircle:bM,wall:jM,line:ix,halfLine:wM,simple:B1,linearline:NM,vectorline:eg,tileLine:iy,earthArc3d:vM},HM=GM;function WM(e){var a=XM();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function XM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YM=function(e){(0,Pr.Z)(t,e);var a=WM(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","LineLayer"),(0,re.Z)((0,bt.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new HM[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{},halfLine:{},earthArc3d:{}};return o[r]}},{key:"getModelType",value:function(){var r;if(this.layerType)return this.layerType;var o=this.layerSource.getParserType();if(ry(o))return"vectorline";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),h=u==null||(r=u.scale)===null||r===void 0?void 0:r.field;return h||"line"}}]),t}(Sd);function qM(e){var a=$M();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function $M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KM=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,QM=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,JM=function(e){(0,Pr.Z)(t,e);var a=qM(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"raiseCount",0),(0,re.Z)((0,bt.Z)(n),"raiserepeat",0),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,h=r.opacity,v=h===void 0?1:h,m=r.sourceColor,b=r.targetColor,A=r.pickLight,k=A===void 0?!1:A,L=r.heightfixed,B=L===void 0?!1:L,Z=r.opacityLinear,V=Z===void 0?{enable:!1,dir:"up"}:Z,K=r.lightEnable,le=K===void 0?!0:K;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var be=this.layer.getEncodedData(),Be=this.calDataFrame(this.cellLength,be,this.cellProperties),et=Be.data,at=Be.width,Lt=Be.height;this.rowCount=Lt,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:Y.LUMINANCE,type:Y.FLOAT,width:at,height:Lt}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}var Gt=0,sr=[0,0,0,0],Tr=[0,0,0,0];if(m&&b&&(sr=I(m),Tr=I(b),Gt=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var Er=u.speed,Qr=Er===void 0?.01:Er,On=u.repeat,li=On===void 0?!1:On;this.raiseCount+=Qr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(k),u_heightfixed:Number(B),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(v)?v:1,u_linearColor:Gt,u_sourceColor:sr,u_targetColor:Tr,u_opacitylinear:Number(V.enable),u_opacitylinear_dir:V.dir==="up"?1:0,u_lightEnable:Number(le)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.animateOption.repeat,h=u===void 0?1:u;this.raiserepeat=h,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:QM,fragmentShader:KM,triangulation:Jg,depth:{enable:!0},cull:{enable:!0,face:nf(this.mapService.version)},blend:this.getBlend()}).then(function(v){r([v])}).catch(function(v){console.warn(v),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v){var m=o.size;if(m){var b=[];return Array.isArray(m)&&(b=m.length===2?[m[0],m[0],m[1]]:m),Array.isArray(m)||(b=[m,m,m]),b}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Vn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=Gu(o.coordinates);return y1([h[0],h[1]])}}})}}]),t}(Po);function e5(e){var a=t5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function t5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,n5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);

  setPickingColor(a_PickingColor);
}
`,i5=function(e){(0,Pr.Z)(t,e);var a=e5(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.strokeOpacity,v=h===void 0?1:h,m=r.strokeWidth,b=m===void 0?0:m,A=r.stroke,k=A===void 0?"rgba(0,0,0,0)":A,L=r.offsets,B=L===void 0?[0,0]:L,Z=r.blend,V=r.blur,K=V===void 0?0:V;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:b,stroke:k,offsets:B})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:b,stroke:k,offsets:B});var le=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,le,this.cellProperties),Be=be.data,et=be.width,at=be.height;this.rowCount=at,this.dataTexture=this.cellLength>0&&Be.length>0?this.createTexture2D({flipY:!0,data:Be,format:Y.LUMINANCE,type:Y.FLOAT,width:et,height:at}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_blur:K,u_additive:Z==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_stroke_opacity:(0,d.isNumber)(v)?v:1,u_stroke_width:(0,d.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(B)?B:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){this.layer.triangulation=A1,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:n5,fragmentShader:r5,triangulation:A1,depth:{enable:!0},blend:this.getBlend()}).then(function(o){r([o])}).catch(function(o){console.warn(o),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Vn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,v,m){var b=(0,Mr.Z)(v,3),A=b[0],k=b[1],L=b[2],B=Ko.fromValues(0,0,1),Z=Ko.fromValues(A,0,L),V=A>=0?Ko.angle(B,Z):Math.PI*2-Ko.angle(B,Z),K=Math.PI*2-Math.asin(k/100),le=Wc();md(le,le,V),vd(le,le,K);var be=Ko.fromValues(1,1,0);Ko.transformMat4(be,be,le),Ko.normalize(be,be);var Be=Ko.fromValues(-1,1,0);Ko.transformMat4(Be,Be,le),Ko.normalize(Be,Be);var et=Ko.fromValues(-1,-1,0);Ko.transformMat4(et,et,le),Ko.normalize(et,et);var at=Ko.fromValues(1,-1,0);Ko.transformMat4(at,at,le),Ko.normalize(at,at);var Lt=[].concat((0,X.Z)(be),(0,X.Z)(Be),(0,X.Z)(et),(0,X.Z)(at)),Gt=m%4*3;return[Lt[Gt],Lt[Gt+1],Lt[Gt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Vn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.shape,A=b===void 0?2:b,k=r.layer.getLayerConfig().shape2d,L=k.indexOf(A);return[L]}}})}}]),t}(Po);function a5(e){var a=o5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function o5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,u5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }

  setPickingColor(a_PickingColor);
}
`,ax=function(e){(0,Pr.Z)(t,e);var a=a5(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"raiseCount",0),(0,re.Z)((0,bt.Z)(n),"raiserepeat",0),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1,speed:.01,repeat:!1}:o,h=r.opacity,v=h===void 0?1:h,m=r.sourceColor,b=r.targetColor,A=r.pickLight,k=A===void 0?!1:A,L=r.heightfixed,B=L===void 0?!1:L,Z=r.opacityLinear,V=Z===void 0?{enable:!1,dir:"up"}:Z,K=r.lightEnable,le=K===void 0?!0:K;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var be=this.layer.getEncodedData(),Be=this.calDataFrame(this.cellLength,be,this.cellProperties),et=Be.data,at=Be.width,Lt=Be.height;this.rowCount=Lt,this.dataTexture=this.cellLength>0&&et.length>0?this.createTexture2D({flipY:!0,data:et,format:Y.LUMINANCE,type:Y.FLOAT,width:at,height:Lt}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}var Gt=0,sr=[0,0,0,0],Tr=[0,0,0,0];if(m&&b&&(sr=I(m),Tr=I(b),Gt=1),this.raiseCount<1&&this.raiserepeat>0&&u.enable){var Er=u.speed,Qr=Er===void 0?.01:Er,On=u.repeat,li=On===void 0?!1:On;this.raiseCount+=Qr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(k),u_heightfixed:Number(B),u_r:u.enable&&this.raiserepeat>0?this.raiseCount:1,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(v)?v:1,u_linearColor:Gt,u_sourceColor:sr,u_targetColor:Tr,u_opacitylinear:Number(V.enable),u_opacitylinear_dir:V.dir==="up"?1:0,u_lightEnable:Number(le)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(){var n=(0,_a.Z)(di().mark(function o(u){var h,v,m,b,A;return di().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:h=this.layer.getLayerConfig(),v=h.depth,m=v===void 0?!0:v,b=h.animateOption.repeat,A=b===void 0?1:b,this.raiserepeat=A,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:u5,fragmentShader:s5,triangulation:Jg,blend:this.getBlend(),cull:{enable:!0,face:nf(this.mapService.version)},depth:{enable:m}}).then(function(B){u([B])}).catch(function(B){console.warn(B),u([])});case 3:case"end":return L.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v){var m=o.size;if(m){var b=[];return Array.isArray(m)&&(b=m.length===2?[m[0],m[0],m[1]]:m),Array.isArray(m)||(b=[m,m,m]),b}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u,h,v,m){return m}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Vn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,u){var h=Gu(o.coordinates);return[h[0],h[1],0]}}})}}]),t}(Po);function l5(e){var a=c5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function c5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ox=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,f5=`uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,uy=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_raisingHeight;

  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }
 

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,sx=function(e){(0,Pr.Z)(t,e);var a=l5(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"meter2coord",1),(0,re.Z)((0,bt.Z)(n),"meteryScale",1),(0,re.Z)((0,bt.Z)(n),"isMeter",!1),(0,re.Z)((0,bt.Z)(n),"unit","l7size"),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.strokeOpacity,v=h===void 0?1:h,m=r.strokeWidth,b=m===void 0?0:m,A=r.stroke,k=A===void 0?"rgba(0,0,0,0)":A,L=r.offsets,B=L===void 0?[0,0]:L,Z=r.blend,V=r.blur,K=V===void 0?0:V,le=r.raisingHeight,be=le===void 0?0:le,Be=r.heightfixed,et=Be===void 0?!1:Be,at=r.unit,Lt=at===void 0?"l7size":at;if(this.updateUnit(Lt),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeOpacity:v,strokeWidth:b,stroke:k,offsets:B})){this.judgeStyleAttributes({opacity:u,strokeOpacity:v,strokeWidth:b,stroke:k,offsets:B});var Gt=this.layer.getEncodedData(),sr=this.calDataFrame(this.cellLength,Gt,this.cellProperties),Tr=sr.data,Er=sr.width,Qr=sr.height;this.rowCount=Qr,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:Y.LUMINANCE,type:Y.FLOAT,width:Er,height:Qr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(be),u_heightfixed:Number(et),u_meter2coord:this.meter2coord,u_meteryScale:this.meteryScale,u_isMeter:Number(this.isMeter),u_blur:K,u_additive:Z==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_stroke_opacity:(0,d.isNumber)(v)?v:1,u_stroke_width:(0,d.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(k),u_offsets:this.isOffsetStatic(B)?B:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),hc)}},{key:"initModels",value:function(r){this.updateUnit("l7size"),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Mr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],v=r[3],m=[(o+h)/2,(u+v)/2],b=this.mapService.version,A=Ui==null?void 0:Ui.mapboxgl;if(b===Uu.MAPBOX&&A!==null&&A!==void 0&&A.MercatorCoordinate){var k=A.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),L=k.meterInMercatorCoordinateUnits(),B=new A.MercatorCoordinate(k.x-L,k.y,k.z),Z=B.toLngLat(),V=new A.MercatorCoordinate(k.x,k.y-L,k.z),K=V.toLngLat();this.meter2coord=m[0]-Z.lng,this.meteryScale=(K.lat-m[1])/this.meter2coord;return}var le=this.mapService.meterToCoord(m,[o,u]),be=this.mapService.meterToCoord(m,[h===o?h+.1:h,v===u?u+.1:v]);this.meter2coord=(le+be)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var n=(0,_a.Z)(di().mark(function o(u){var h,v,m,b,A,k,L,B,Z,V,K,le,be,Be,et;return di().wrap(function(Lt){for(;;)switch(Lt.prev=Lt.next){case 0:h=this.layer.getLayerConfig(),v=h.mask,m=v===void 0?!1:v,b=h.maskInside,A=b===void 0?!0:b,k=h.animateOption,L=k===void 0?{enable:!1}:k,B=h.workerEnabled,Z=B===void 0?!1:B,V=h.enablePicking,K=h.shape2d,le=this.getShaders(L),be=le.frag,Be=le.vert,et=le.type,this.layer.triangulation=hc,this.layer.buildLayerModel({moduleName:et,vertexShader:Be,fragmentShader:be,triangulation:hc,depth:{enable:!1},blend:this.getBlend(),stencil:ye(m,A),workerEnabled:Z,workerOptions:{modelType:et,enablePicking:V,shape2d:K}}).then(function(Gt){u([Gt])}).catch(function(Gt){console.warn(Gt),u([])});case 4:case"end":return Lt.stop()}},o,this)}));function r(o){return n.apply(this,arguments)}return r}()},{key:"getShaders",value:function(r){if(r.enable)switch(r.type){case"wave":return{frag:ox,vert:uy,type:"pointWave"};default:return{frag:ox,vert:uy,type:"pointWave"}}else return{frag:f5,vert:uy,type:"pointFill"}}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Vn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,v,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=m%4*3;return[b[A],b[A+1],b[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Vn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.shape,A=b===void 0?2:b,k=r.indexOf(A);return[k]}}})}},{key:"updateUnit",value:function(r){var o=this.mapService.version;this.unit!==r&&(this.unit!=="meter"&&r==="meter"&&o!==Uu.L7MAP&&o!==Uu.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&r!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=r)}}]),t}(Po);function h5(e){var a=p5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function p5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d5=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,v5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,m5=function(e){(0,Pr.Z)(t,e);var a=h5(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"meter2coord",1),(0,re.Z)((0,bt.Z)(n),"isMeter",!1),(0,re.Z)((0,bt.Z)(n),"radian",0),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,v=h===void 0?[0,0]:h,m=r.rotation,b=r.raisingHeight,A=b===void 0?0:b,k=r.heightfixed,L=k===void 0?!1:k;this.rendererService.getDirty()&&this.texture.bind();var B=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(B=-1),this.radian=m!==void 0?B*Math.PI*m/180:B*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var Z=this.layer.getEncodedData(),V=this.calDataFrame(this.cellLength,Z,this.cellProperties),K=V.data,le=V.width,be=V.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:Y.LUMINANCE,type:Y.FLOAT,width:le,height:be}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(A),u_heightfixed:Number(L),u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,d.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),nv)}},{key:"initModels",value:function(r){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var o=this.layer.getLayerConfig(),u=o.unit,h=u===void 0?"l7size":u,v=this.mapService.version;h==="meter"&&v!==Uu.L7MAP&&v!==Uu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Mr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],v=r[3],m=[(o+h)/2,(u+v)/2],b=this.mapService.version;if(b===Uu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),k=1,L=k*A.meterInMercatorCoordinateUnits(),B=new window.mapboxgl.MercatorCoordinate(A.x-L,A.y,A.z),Z=B.toLngLat();this.meter2coord=m[0]-Z.lng;return}var V=this.mapService.meterToCoord(m,[o,u]),K=this.mapService.meterToCoord(m,[h===o?h+.1:h,v===u?u+.1:v]);this.meter2coord=(V+K)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:v5,fragmentShader:d5,triangulation:nv,depth:{enable:!1},blend:this.getBlend(),stencil:ye(h,m),cull:{enable:!0,face:nf(this.mapService.version)}}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r,o;this.iconService.off("imageUpdate",this.updateTexture),(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Vn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.rotate,A=b===void 0?0:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.shape,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Vn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,v,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=m%4*3;return[b[A],b[A+1],b[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}})}}]),t}(Po);function g5(e){var a=y5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function y5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,x5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(textrueOffsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,ux=function(e){(0,Pr.Z)(t,e);var a=g5(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"updateTexture",function(){var h=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=h({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,v=h===void 0?[0,0]:h,m=r.raisingHeight,b=m===void 0?0:m,A=r.heightfixed,k=A===void 0?!1:A;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var L=this.layer.getEncodedData(),B=this.calDataFrame(this.cellLength,L,this.cellProperties),Z=B.data,V=B.width,K=B.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&Z.length>0?this.createTexture2D({flipY:!0,data:Z,format:Y.LUMINANCE,type:Y.FLOAT,width:V,height:K}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(b),u_heightfixed:Number(k),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:(0,d.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(r){this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels(r)}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:x5,fragmentShader:_5,triangulation:sA,depth:{enable:!1},primitive:Y.POINTS,blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Vn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(u,h,v,m){var b=r.iconService.getIconMap(),A=u.shape,k=b[A]||{x:0,y:0},L=k.x,B=k.y;return[L,B]}}})}}]),t}(Po);function b5(e){var a=E5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function E5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,S5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function lx(e){var a=e.coordinates;return{vertices:(0,X.Z)(a),indices:[0],size:a.length}}var cx=function(e){(0,Pr.Z)(t,e);var a=b5(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,v=h===void 0?[0,0]:h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var m=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,m,this.cellProperties),A=b.data,k=b.width,L=b.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:Y.LUMINANCE,type:Y.FLOAT,width:k,height:L}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.triangulation=lx,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:S5,fragmentShader:C5,triangulation:lx,depth:{enable:!1},primitive:Y.POINTS,blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0]]:[b]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Gh.additive}}}]),t}(Po);function A5(e){var a=w5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function w5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T5=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,M5=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,I5=function(e){(0,Pr.Z)(t,e);var a=A5(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"meter2coord",1),(0,re.Z)((0,bt.Z)(n),"isMeter",!1),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,v=h===void 0?[0,0]:h,m=r.blend,b=r.speed,A=b===void 0?1:b;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var k=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,k,this.cellProperties),B=L.data,Z=L.width,V=L.height;this.rowCount=V,this.dataTexture=this.cellLength>0&&B.length>0?this.createTexture2D({flipY:!0,data:B,format:Y.LUMINANCE,type:Y.FLOAT,width:Z,height:V}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:A,u_additive:m==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"getAnimateUniforms",value:function(){var r=this.layer.getLayerConfig(),o=r.animateOption,u=o===void 0?{enable:!1}:o;return{u_aimate:this.animateOption2Array(u),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),nv)}},{key:"initModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.unit,h=u===void 0?"l7size":u,v=this.mapService.version;h==="meter"&&v!==Uu.L7MAP&&v!==Uu.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels(r)}},{key:"calMeter2Coord",value:function(){var r=(0,Mr.Z)(this.layer.getSource().extent,4),o=r[0],u=r[1],h=r[2],v=r[3],m=[(o+h)/2,(u+v)/2],b=this.mapService.version;if(b===Uu.MAPBOX&&window.mapboxgl.MercatorCoordinate){var A=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:m[0],lat:m[1]},0),k=1,L=k*A.meterInMercatorCoordinateUnits(),B=new window.mapboxgl.MercatorCoordinate(A.x-L,A.y,A.z),Z=B.toLngLat();this.meter2coord=m[0]-Z.lng;return}var V=this.mapService.meterToCoord(m,[o,u]),K=this.mapService.meterToCoord(m,[h===o?h+.1:h,v===u?u+.1:v]);this.meter2coord=(V+K)/2,this.meter2coord||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:M5,fragmentShader:T5,triangulation:nv,depth:{enable:!1},blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.speed||1,r.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var r=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Vn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(u,h,v,m){var b=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],A=m%4*3;return[b[A],b[A+1],b[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.size,A=b===void 0?5:b;return Array.isArray(A)?[A[0]*r.meter2coord]:[A*r.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Vn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(u,h,v,m){var b=u.shape,A=b===void 0?2:b,k=r.layer.getLayerConfig().shape2d,L=k.indexOf(A);return[L]}}})}}]),t}(Po);function k5(e){var a=P5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function P5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,R5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function fx(e){var a=e.coordinates;return{vertices:(0,X.Z)(a),indices:[0],size:a.length}}var O5=function(e){(0,Pr.Z)(t,e);var a=k5(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.offsets,v=h===void 0?[0,0]:h,m=r.blend,b=r.strokeOpacity,A=b===void 0?1:b,k=r.strokeWidth,L=k===void 0?0:k,B=r.stroke,Z=B===void 0?"#fff":B;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,offsets:v})){this.judgeStyleAttributes({opacity:u,offsets:v});var V=this.layer.getEncodedData(),K=this.calDataFrame(this.cellLength,V,this.cellProperties),le=K.data,be=K.width,Be=K.height;this.rowCount=Be,this.dataTexture=this.cellLength>0&&le.length>0?this.createTexture2D({flipY:!0,data:le,format:Y.LUMINANCE,type:Y.FLOAT,width:be,height:Be}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_additive:m==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1,u_offsets:this.isOffsetStatic(v)?v:[0,0],u_stroke_opacity:(0,d.isNumber)(A)?A:1,u_stroke_width:(0,d.isNumber)(L)?L:1,u_stroke_color:this.getStrokeColor(Z)}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.triangulation=fx,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:R5,fragmentShader:L5,triangulation:fx,depth:{enable:!1},primitive:Y.POINTS,blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.size,b=m===void 0?1:m;return Array.isArray(b)?[b[0]]:[b]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Gh.additive}}}]),t}(Po);function F5(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=D5(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function D5(e,a){if(!!e){if(typeof e=="string")return hx(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hx(e,a)}}function hx(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function B5(e){var a=N5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function N5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var px=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dx=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function vx(e){var a=this,t=e.id,n=[],r=[];if(!a.glyphInfoMap||!a.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var o=a.glyphInfoMap[t].centroid,u=o.length===2?[o[0],o[1],0]:o;return a.glyphInfoMap[t].glyphQuads.forEach(function(h,v){n.push.apply(n,(0,X.Z)(u).concat([h.tex.x,h.tex.y+h.tex.height,h.tl.x,h.tl.y],(0,X.Z)(u),[h.tex.x+h.tex.width,h.tex.y+h.tex.height,h.tr.x,h.tr.y],(0,X.Z)(u),[h.tex.x+h.tex.width,h.tex.y,h.br.x,h.br.y],(0,X.Z)(u),[h.tex.x,h.tex.y,h.bl.x,h.bl.y])),r.push(0+v*4,1+v*4,2+v*4,2+v*4,3+v*4,0+v*4)}),{vertices:n,indices:r,size:7}}var mx=function(e){(0,Pr.Z)(t,e);var a=B5(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"glyphInfoMap",{}),(0,re.Z)((0,bt.Z)(n),"currentZoom",-1),(0,re.Z)((0,bt.Z)(n),"textureHeight",0),(0,re.Z)((0,bt.Z)(n),"textCount",0),(0,re.Z)((0,bt.Z)(n),"preTextStyle",{}),(0,re.Z)((0,bt.Z)(n),"buildModels",function(){var h=(0,_a.Z)(di().mark(function v(m){var b,A,k,L,B;return di().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:b=n.layer.getLayerConfig(),A=b.mask,k=A===void 0?!1:A,L=b.maskInside,B=L===void 0?!0:L,n.mapping(),n.layer.buildLayerModel({moduleName:"pointText",vertexShader:dx,fragmentShader:px,triangulation:vx.bind((0,bt.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:ye(k,B)}).then(function(K){m([K])}).catch(function(K){console.warn(K),m([])});case 3:case"end":return V.stop()}},v)}));return function(v){return h.apply(this,arguments)}}()),(0,re.Z)((0,bt.Z)(n),"mapping",function(){n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel()}),n}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.stroke,v=h===void 0?"#fff":h,m=r.strokeWidth,b=m===void 0?0:m,A=r.textAnchor,k=A===void 0?"center":A,L=r.textAllowOverlap,B=L===void 0?!1:L,Z=r.halo,V=Z===void 0?.5:Z,K=r.gamma,le=K===void 0?2:K,be=r.raisingHeight,Be=be===void 0?0:be,et=this.fontService,at=et.canvas,Lt=et.mapping;if(Object.keys(Lt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Lt).length),this.preTextStyle={textAnchor:k,textAllowOverlap:B},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u,strokeWidth:b,stroke:v})){this.judgeStyleAttributes({opacity:u,strokeWidth:b,stroke:v});var Gt=this.layer.getEncodedData(),sr=this.calDataFrame(this.cellLength,Gt,this.cellProperties),Tr=sr.data,Er=sr.width,Qr=sr.height;this.rowCount=Qr,this.dataTexture=this.cellLength>0&&Tr.length>0?this.createTexture2D({flipY:!0,data:Tr,format:Y.LUMINANCE,type:Y.FLOAT,width:Er,height:Qr}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(Be),u_opacity:(0,d.isNumber)(u)?u:1,u_stroke_width:(0,d.isNumber)(b)?b:1,u_stroke_color:this.getStrokeColor(v),u_sdf_map:this.texture,u_halo_blur:V,u_gamma_scale:le,u_sdf_map_size:[at.width,at.height]}}},{key:"initModels",value:function(r){this.layer.on("remapping",this.mapping),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),u=o.textAnchor,h=u===void 0?"center":u,v=o.textAllowOverlap,m=v===void 0?!0:v;this.preTextStyle={textAnchor:h,textAllowOverlap:m},this.buildModels(r)}},{key:"needUpdate",value:function(){var r=this.layer.getLayerConfig(),o=r.textAllowOverlap,u=o===void 0?!1:o,h=this.mapService.getZoom(),v=this.mapService.getBounds(),m=ac(this.extent,v);return!u&&(Math.abs(this.currentZoom-h)>1||!m)||u!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Vn.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.rotate,b=m===void 0?0:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Vn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){return[h[5],h[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,u,h,v){var m=o.size,b=m===void 0?12:m;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Vn.Attribute,descriptor:{name:"a_tex",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,u,h,v){return[h[3],h[4]]}}})}},{key:"textExtent",value:function(){var r=this.mapService.getBounds();return ll(r,.5)}},{key:"initTextFont",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,h=r.fontFamily,v=h===void 0?"sans-serif":h,m=this.layer.getEncodedData(),b=[];m.forEach(function(A){var k=A.shape,L=k===void 0?"":k;L=L.toString();var B=F5(L),Z;try{for(B.s();!(Z=B.n()).done;){var V=Z.value;b.indexOf(V)===-1&&b.push(V)}}catch(K){B.e(K)}finally{B.f()}}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:v,iconfont:!1})}},{key:"initIconFontTex",value:function(){var r=this.layer.getLayerConfig(),o=r.fontWeight,u=o===void 0?"400":o,h=r.fontFamily,v=h===void 0?"sans-serif":h,m=this.layer.getEncodedData(),b=[];m.forEach(function(A){var k=A.shape,L=k===void 0?"":k;L="".concat(L),b.indexOf(L)===-1&&b.push(L)}),this.fontService.setFontOptions({characterSet:b,fontWeight:u,fontFamily:v,iconfont:!0})}},{key:"generateGlyphLayout",value:function(r){var o=this,u=this.fontService.mapping,h=this.layer.getLayerConfig(),v=h.spacing,m=v===void 0?2:v,b=h.textAnchor,A=b===void 0?"center":b,k=this.layer.getEncodedData();this.glyphInfo=k.map(function(L){var B=L.shape,Z=B===void 0?"":B,V=L.id,K=L.size,le=K===void 0?1:K,be=L.textOffset,Be=be===void 0?[0,0]:be,et=H1(Z.toString(),u,le,A,"left",m,Be,r),at=W1(et,Be,!1);return L.shaping=et,L.glyphQuads=at,L.centroid=Gu(L.coordinates),L.originCentroid=L.version==="GAODE2.x"?Gu(L.originCoordinates):L.originCentroid=L.centroid,o.glyphInfoMap[V]={shaping:et,glyphQuads:at,centroid:Gu(L.coordinates)},L})}},{key:"filterGlyphs",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.padding,h=u===void 0?[4,4]:u,v=o.textAllowOverlap,m=v===void 0?!1:v;if(!m){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var b=this.rendererService.getViewportSize(),A=b.width,k=b.height,L=new z1(A,k),B=this.glyphInfo.filter(function(Z){var V=Z.shaping,K=Z.id,le=K===void 0?0:K,be=Z.version==="GAODE2.x"?Z.originCentroid:Z.centroid,Be=Z.size,et=Be/24,at=r.mapService.lngLatToContainer(be),Lt=L.placeCollisionBox({x1:V.left*et-h[0],x2:V.right*et+h[0],y1:V.top*et-h[1],y2:V.bottom*et+h[1],anchorPointX:at.x,anchorPointY:at.y}),Gt=Lt.box;return Gt&&Gt.length?(L.insertCollisionBox(Gt,le),!0):!1});B.forEach(function(Z){r.glyphInfoMap[Z.id]=Z})}}},{key:"initGlyph",value:function(){var r=this.layer.getLayerConfig(),o=r.iconfont,u=o===void 0?!1:o;u?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(u)}},{key:"updateTexture",value:function(){var r=this.rendererService.createTexture2D,o=this.fontService.canvas;this.textureHeight=o.height,this.texture&&this.texture.destroy(),this.texture=r({data:o,mag:Y.LINEAR,min:Y.LINEAR,width:o.width,height:o.height})}},{key:"reBuildModel",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.filterGlyphs(),this.layer.buildLayerModel({moduleName:"pointText",vertexShader:dx,fragmentShader:px,triangulation:vx.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:ye(h,m)}).then(function(b){r.layer.models=[b],r.layer.renderLayers()}).catch(function(b){console.warn(b),r.layer.models=[]})}}]),t}(Po),z5={fillImage:m5,fill:sx,radar:I5,image:ux,normal:cx,simplePoint:O5,extrude:ax,text:mx,vectorpoint:eg,tile:Jm,tileText:K1,earthFill:i5,earthExtrude:JM},U5=z5;function Z5(e,a){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=V5(e))||a&&e&&typeof e.length=="number"){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(m){throw m},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,u=!1,h;return{s:function(){t=t.call(e)},n:function(){var m=t.next();return o=m.done,m},e:function(m){u=!0,h=m},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(u)throw h}}}}function V5(e,a){if(!!e){if(typeof e=="string")return gx(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return gx(e,a)}}function gx(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function j5(e){var a=G5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function G5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H5=function(e){(0,Pr.Z)(t,e);var a=j5(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","PointLayer"),(0,re.Z)((0,bt.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new U5[o](this),this.layerModel.initModels(function(u){r.models=u,r.layerService.updateLayerRenderList(),r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var r=this.shapeOption,o=r.field,u=r.values,h=this.getLayerConfig(),v=h.shape2d,m=this.iconService.getIconMap();if(o&&(v==null?void 0:v.indexOf(o))!==-1)return"fill";if(u&&u instanceof Array){var b=Z5(u),A;try{for(b.s();!(A=b.n()).done;){var k=A.value;if(typeof k=="string"&&m.hasOwnProperty(k))return"image"}}catch(L){b.e(L)}finally{b.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},vectorpoint:{},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.layerSource.getParserType();if(ry(r))return"vectorpoint";var o=this.getEncodedData(),u=this.getLayerConfig(),h=u.shape2d,v=u.shape3d,m=this.iconService.getIconMap(),b=o.find(function(k){return k.hasOwnProperty("shape")});if(b){var A=b.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"?"fillImage":(h==null?void 0:h.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(v==null?void 0:v.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":m.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Sd);function W5(e){var a=X5();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function X5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,q5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,$5=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,K5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,Q5=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,J5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,e4=function(e){(0,Pr.Z)(t,e);var a=W5(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.heightfixed,v=h===void 0?!1:h,m=r.raisingHeight,b=m===void 0?0:m,A=r.topsurface,k=A===void 0?!0:A,L=r.sidesurface,B=L===void 0?!0:L,Z=r.sourceColor,V=r.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var K=this.layer.getEncodedData(),le=this.calDataFrame(this.cellLength,K,this.cellProperties),be=le.data,Be=le.width,et=le.height;this.rowCount=et,this.dataTexture=this.cellLength>0&&be.length>0?this.createTexture2D({flipY:!0,data:be,format:Y.LUMINANCE,type:Y.FLOAT,width:Be,height:et}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}var at=0,Lt=[1,1,1,1],Gt=[1,1,1,1];return Z&&V&&(Lt=I(Z),Gt=I(V),at=1),{u_topsurface:Number(k),u_sidesurface:Number(B),u_heightfixed:Number(v),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(b),u_opacity:(0,d.isNumber)(u)?u:1,u_linearColor:at,u_sourceColor:Lt,u_targetColor:Gt,u_texture:this.texture}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v,b=this.getShaders(),A=b.frag,k=b.vert,L=b.type;this.layer.buildLayerModel({moduleName:L,vertexShader:k,fragmentShader:A,triangulation:T1,stencil:ye(h,m)}).then(function(B){r([B])}).catch(function(B){console.warn(B),r([])})}},{key:"getShaders",value:function(){var r=this.layer.getLayerConfig(),o=r.pickLight,u=r.mapTexture;return u?{frag:$5,vert:K5,type:"polygonExtrudeTexture"}:o?{frag:Q5,vert:J5,type:"polygonExtrudePickLight"}:{frag:Y5,vert:q5,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var r,o;(r=this.dataTexture)===null||r===void 0||r.destroy(),(o=this.texture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Mr.Z)(r,4),u=o[0],h=o[1],v=o[2],m=o[3],b=v-u,A=m-h;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Vn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(L,B,Z,V,K){var le=Z[0],be=Z[1];return[(le-u)/b,(be-h)/A,Z[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Vn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(L,B,Z,V,K){return K}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Vn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(L,B,Z,V){var K=L.size,le=K===void 0?10:K;return Array.isArray(le)?[le[0]]:[le]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.mapTexture,h=this.rendererService.createTexture2D;if(this.texture=h({height:0,width:0}),u){var v=new Image;v.crossOrigin="",v.src=u,v.onload=function(){r.texture=h({data:v,width:v.width,height:v.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}}]),t}(Po);function t4(e){var a=r4();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function r4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n4=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,i4=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,a4=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,o4=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,s4=function(e){(0,Pr.Z)(t,e);var a=t4(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.raisingHeight,u=o===void 0?0:o,h=r.opacity,v=h===void 0?1:h,m=r.opacityLinear,b=m===void 0?{enable:!1,dir:"in"}:m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:v})){this.judgeStyleAttributes({opacity:v});var A=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,A,this.cellProperties),L=k.data,B=k.width,Z=k.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:Y.LUMINANCE,type:Y.FLOAT,width:B,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(u),u_opacity:(0,d.isNumber)(v)?v:1,u_opacitylinear:Number(b.enable),u_dir:b.dir==="in"?1:0}}},{key:"initModels",value:function(r){this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.getModelParams(),u=o.frag,h=o.vert,v=o.triangulation,m=o.type,b=this.layer.getLayerConfig(),A=b.mask,k=A===void 0?!1:A,L=b.maskInside,B=L===void 0?!0:L,Z=b.workerEnabled,V=Z===void 0?!1:Z,K=b.enablePicking;this.layer.triangulation=v,this.layer.buildLayerModel({moduleName:m,vertexShader:h,fragmentShader:u,triangulation:v,primitive:Y.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:ye(k,B),workerEnabled:V,workerOptions:{modelType:m,enablePicking:K}}).then(function(le){r([le])}).catch(function(le){console.warn(le),r([])})}},{key:"clearModels",value:function(){var r;(r=this.dataTexture)===null||r===void 0||r.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1,dir:"in"}:o;u.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Vn.Attribute,descriptor:{name:"a_linear",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(v,m,b,A,k){return[b[3],b[4],b[5]]}}})}},{key:"getModelParams",value:function(){var r=this.layer.getLayerConfig(),o=r.opacityLinear,u=o===void 0?{enable:!1}:o;return u.enable?{frag:i4,vert:a4,type:"polygonLinear",triangulation:cA}:{frag:n4,vert:o4,type:"polygonFill",triangulation:sh}}}]),t}(Po);function u4(e){var a=l4();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function l4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c4=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,f4=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,h4=function(e){(0,Pr.Z)(t,e);var a=u4(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.watercolor,v=h===void 0?"#6D99A8":h,m=r.watercolor2,b=m===void 0?"#0F121C":m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var A=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,A,this.cellProperties),L=k.data,B=k.width,Z=k.height;this.rowCount=Z,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:Y.LUMINANCE,type:Y.FLOAT,width:B,height:Z}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:I(v),u_watercolor2:I(b),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:(0,d.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:f4,fragmentShader:c4,triangulation:fm,primitive:Y.TRIANGLES,depth:{enable:!1},stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r,o,u,h;(r=this.texture1)===null||r===void 0||r.destroy(),(o=this.texture2)===null||o===void 0||o.destroy(),(u=this.texture3)===null||u===void 0||u.destroy(),(h=this.dataTexture)===null||h===void 0||h.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Mr.Z)(r,4),u=o[0],h=o[1],v=o[2],m=o[3],b=v-u,A=m-h;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Vn.Attribute,descriptor:{name:"a_uv",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(L,B,Z,V,K){var le=(0,Mr.Z)(Z,2),be=le[0],Be=le[1];return[(be-u)/b,(Be-h)/A]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.rendererService.createTexture2D,u={height:0,width:0};this.texture1=o(u),this.texture2=o(u),this.texture3=o(u),h(function(m){r.texture1=v(m[0]),r.texture2=v(m[1]),r.texture3=v(m[2]),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()});function h(m){var b=0,A=[],k=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];k.map(function(L){var B=new Image;B.crossOrigin="",B.src=L,A.push(B),B.onload=function(){b++,b===3&&m(A)}})}function v(m){return o({data:m,width:m.width,height:m.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR})}}}]),t}(Po);function p4(e){var a=d4();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function d4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v4=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,m4=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,g4=function(e){(0,Pr.Z)(t,e);var a=p4(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getUninforms",value:function(){var r=this.layer.getLayerConfig(),o=r.opacity,u=o===void 0?1:o,h=r.speed,v=h===void 0?.5:h;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:u})){this.judgeStyleAttributes({opacity:u});var m=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,m,this.cellProperties),A=b.data,k=b.width,L=b.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:Y.LUMINANCE,type:Y.FLOAT,width:k,height:L}):this.createTexture2D({flipY:!0,data:[1],format:Y.LUMINANCE,type:Y.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:v,u_opacity:(0,d.isNumber)(u)?u:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(r){this.loadTexture(),this.buildModels(r)}},{key:"buildModels",value:function(r){var o=this.layer.getLayerConfig(),u=o.mask,h=u===void 0?!1:u,v=o.maskInside,m=v===void 0?!0:v;this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:m4,fragmentShader:v4,triangulation:fm,primitive:Y.TRIANGLES,depth:{enable:!1},stencil:ye(h,m)}).then(function(b){r([b])}).catch(function(b){console.warn(b),r([])})}},{key:"clearModels",value:function(){var r,o;(r=this.texture)===null||r===void 0||r.destroy(),(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var r=this.layer.getSource().extent,o=(0,Mr.Z)(r,4),u=o[0],h=o[1],v=o[2],m=o[3],b=v-u,A=m-h;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Vn.Attribute,descriptor:{name:"a_uv",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(L,B,Z,V,K){var le=(0,Mr.Z)(Z,2),be=le[0],Be=le[1];return[(be-u)/b,(Be-h)/A]}}})}},{key:"loadTexture",value:function(){var r=this,o=this.layer.getLayerConfig(),u=o.waterTexture,h=this.rendererService.createTexture2D;this.texture=h({height:0,width:0});var v=new Image;v.crossOrigin="",u?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),v.src=u):v.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",v.onload=function(){r.texture=h({data:v,width:v.width,height:v.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR}),r.layerService.updateLayerRenderList(),r.layerService.renderLayers()}}}]),t}(Po),y4={fill:s4,line:ix,extrude:e4,text:mx,point_fill:sx,point_image:ux,point_normal:cx,point_extrude:ax,water:g4,ocean:h4,vectorpolygon:eg,tile:Q1},_4=y4;function x4(e){var a=b4();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function b4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yx=function(e){(0,Pr.Z)(t,e);var a=x4(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","PolygonLayer"),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new _4[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var r,o=this.layerSource.getParserType();if(ry(o))return"vectorpolygon";var u=this.styleAttributeService.getLayerStyleAttribute("shape"),h=u==null||(r=u.scale)===null||r===void 0?void 0:r.field;return h==="fill"?"fill":h==="extrude"?"extrude":h==="water"?"water":h==="ocean"?"ocean":h==="line"?"line":h==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var r=this.getEncodedData(),o=this.getLayerConfig(),u=o.shape2d,h=o.shape3d,v=this.iconService.getIconMap(),m=r.find(function(A){return A.hasOwnProperty("shape")});if(m){var b=m.shape;return b==="dot"?"point_normal":(u==null?void 0:u.indexOf(b))!==-1?"point_fill":(h==null?void 0:h.indexOf(b))!==-1?"point_extrude":v.hasOwnProperty(b)?"point_image":"text"}else return"fill"}}]),t}(Sd),E4={raster:oy,raster3d:oy,rasterTile:eg},C4=E4;function S4(e){var a=A4();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function A4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w4=function(e){(0,Pr.Z)(t,e);var a=S4(t);function t(){var n;(0,Zt.Z)(this,t);for(var r=arguments.length,o=new Array(r),u=0;u<r;u++)o[u]=arguments[u];return n=a.call.apply(a,[this].concat(o)),(0,re.Z)((0,bt.Z)(n),"type","RasterLayer"),n}return(0,kt.Z)(t,[{key:"buildModels",value:function(){var r=this,o=this.getModelType();this.layerModel=new C4[o](this),this.layerModel.initModels(function(u){r.models=u,r.renderLayers()})}},{key:"rebuildModels",value:function(){var r=this;this.layerModel.buildModels(function(o){return r.models=o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var r=this.getModelType(),o={raster:{},raster3d:{},rasterTile:{}};return o[r]}},{key:"getModelType",value:function(){var r=this.layerSource.getParserType();switch(r){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),t}(Sd),_x,xx,bx,Ex,Cx,hm,Sx,Ax,Tx,T4=(_x=(0,Yr.b2)(),xx=(0,Yr.f3)(nr.IGlobalConfigService),bx=(0,Yr.f3)(nr.IMapService),Ex=(0,Yr.f3)(nr.IFontService),_x(Cx=(hm=function(){function e(){(0,Zt.Z)(this,e),ka(this,"configService",Sx,this),ka(this,"mapService",Ax,this),ka(this,"fontService",Tx,this)}return(0,kt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){var u=t.getSource();u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){t.dataState.dataMappingNeedUpdate=!1;var u=t.getSource();return u.inited?r.generateMaping(t,{styleAttributeService:o}):u.once("sourceUpdate",function(){r.generateMaping(t,{styleAttributeService:o})}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var u=t.getSource();if(!(t.layerModelNeedUpdate||!u||!u.inited)){var h=t.getBottomColor(),v=o.getLayerStyleAttributes()||[],m=o.getLayerStyleAttribute("filter"),b=u.data.dataArray,A=v.filter(function(L){return L.needRemapping}),k=b;m!=null&&m.needRemapping&&m!==null&&m!==void 0&&m.scale&&(k=b.filter(function(L){return r.applyAttributeMapping(m,L,h)[0]})),A.length&&(m!=null&&m.needRemapping?(t.setEncodedData(r.mapping(t,v,k,void 0,h)),m.needRemapping=!1):t.setEncodedData(r.mapping(t,A,k,t.getEncodedData(),h)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,n){var r=this,o=n.styleAttributeService,u=t.getBottomColor(),h=o.getLayerStyleAttributes()||[],v=o.getLayerStyleAttribute("filter"),m=t.getSource().data.dataArray,b=m;v!=null&&v.scale&&(b=m.filter(function(A){return r.applyAttributeMapping(v,A,u)[0]})),t.setEncodedData(this.mapping(t,h,b,void 0,u)),t.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(t,n){var r=[n[0]-t[0],n[1]-t[1]],o=oc(r),u=[t[0]+o[0]*1e-4,t[1]+o[1]*1e-4];return u}},{key:"mapping",value:function(t,n,r,o,u){var h=this,v=t.getLayerConfig(),m=v.arrow,b=m===void 0?{enable:!1}:m,A=r.map(function(k,L){var B=o?o[L]:{},Z=(0,ae.Z)({id:k._id,coordinates:k.coordinates},B);if(n.filter(function(le){return le.scale!==void 0}).forEach(function(le){var be=h.applyAttributeMapping(le,k,u);le.needRemapping=!1,le.name==="color"&&(be=be.map(function(Be){return I(Be)})),Z[le.name]=Array.isArray(be)&&be.length===1?be[0]:be,le.name==="shape"&&(Z.shape=h.fontService.getIconFontKey(Z[le.name]))}),b.enable&&(Z.shape==="line"||Z.shape==="halfLine")){var V=Z.coordinates,K=h.getArrowPoints(V[0],V[1]);Z.coordinates.splice(1,0,K,K)}return Z});return this.adjustData2Amap2Coordinates(A,t),this.adjustData2SimpleCoordinates(A),A}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var r=this;if(t.length>0&&this.mapService.version===Uu["GAODE2.x"]){var o=this.getLayerCenter(n);typeof t[0].coordinates[0]=="number"?t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Uu["GAODE2.x"],u.originCoordinates=(0,d.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordByLayer(u.coordinates,o)}):t.filter(function(u){return!u.originCoordinates}).map(function(u){u.version=Uu["GAODE2.x"],u.originCoordinates=(0,d.cloneDeep)(u.coordinates),u.coordinates=r.mapService.lngLatToCoordsByLayer(u.coordinates,o)})}}},{key:"getLayerCenter",value:function(t){var n=t.getSource();return n.center}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version===Uu.SIMPLE&&t.map(function(r){r.simpleCoordinate||(r.coordinates=n.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var r=[];return t.map(function(u){var h=[];u.map(function(v){h.push(n.mapService.simpleMapCoord.unproject(v))}),r.push(h)}),r}else{var o=[];return t.map(function(u){o.push(n.mapService.simpleMapCoord.unproject(u))}),o}}},{key:"applyAttributeMapping",value:function(t,n,r){var o;if(!t.scale)return[];var u=(t==null||(o=t.scale)===null||o===void 0?void 0:o.scalers)||[],h=[];u.forEach(function(m){var b,A=m.field;(n.hasOwnProperty(A)||((b=t.scale)===null||b===void 0?void 0:b.type)==="variable")&&h.push(n[A])});var v=t.mapping?t.mapping(h):[];return t.name==="color"&&!S(v[0])?[r]:v}}]),e}(),Sx=Aa(hm.prototype,"configService",[xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax=Aa(hm.prototype,"mapService",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tx=Aa(hm.prototype,"fontService",[Ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm))||Cx),Mx,Ix,M4=(Mx=(0,Yr.b2)(),Mx(Ix=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(nr.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var r=t.getSource();if(!r){var o=t.sourceOption||t.defaultSourceConfig,u=o.data,h=o.options;r=new Zo(u,h),t.setSource(r)}r.inited?n.updateClusterData(t):r.once("sourceUpdate",function(){n.updateClusterData(t)})}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=n.updateClusterData(t),o=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,r||o})}},{key:"updateClusterData",value:function(t){var n=t.getSource(),r=n.cluster,o=n.clusterOptions.zoom,u=o===void 0?0:o,h=this.mapService.getZoom()-1,v=t.dataState.dataSourceNeedUpdate;return r&&v&&n.updateClusterData(Math.floor(h)),r&&Math.abs(t.clusterZoom-h)>=1?(u!==Math.floor(h)&&n.updateClusterData(Math.floor(h)),t.clusterZoom=h,!0):!1}}]),e}())||Ix);function ly(e,a){return e<a?-1:e>a?1:e>=a?0:NaN}function kx(e){return e.length===1&&(e=I4(e)),{left:function(a,t,n,r){for(n==null&&(n=0),r==null&&(r=a.length);n<r;){var o=n+r>>>1;e(a[o],t)<0?n=o+1:r=o}return n},right:function(a,t,n,r){for(n==null&&(n=0),r==null&&(r=a.length);n<r;){var o=n+r>>>1;e(a[o],t)>0?r=o:n=o+1}return n}}}function I4(e){return function(a,t){return ly(e(a),t)}}var Px=kx(ly),k4=Px.right,kL=Px.left,tg=k4;function Lx(e,a){var t=e.length,n=-1,r,o,u;if(a==null){for(;++n<t;)if((r=e[n])!=null&&r>=r)for(o=u=r;++n<t;)(r=e[n])!=null&&(o>r&&(o=r),u<r&&(u=r))}else for(;++n<t;)if((r=a(e[n],n,e))!=null&&r>=r)for(o=u=r;++n<t;)(r=a(e[n],n,e))!=null&&(o>r&&(o=r),u<r&&(u=r));return[o,u]}var Rx=Array.prototype,PL=Rx.slice,LL=Rx.map,cy=Math.sqrt(50),fy=Math.sqrt(10),hy=Math.sqrt(2);function Ox(e,a,t){var n,r=-1,o,u,h;if(a=+a,e=+e,t=+t,e===a&&t>0)return[e];if((n=a<e)&&(o=e,e=a,a=o),(h=rg(e,a,t))===0||!isFinite(h))return[];if(h>0)for(e=Math.ceil(e/h),a=Math.floor(a/h),u=new Array(o=Math.ceil(a-e+1));++r<o;)u[r]=(e+r)*h;else for(e=Math.floor(e*h),a=Math.ceil(a*h),u=new Array(o=Math.ceil(e-a+1));++r<o;)u[r]=(e-r)/h;return n&&u.reverse(),u}function rg(e,a,t){var n=(a-e)/Math.max(0,t),r=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,r);return r>=0?(o>=cy?10:o>=fy?5:o>=hy?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=cy?10:o>=fy?5:o>=hy?2:1)}function py(e,a,t){var n=Math.abs(a-e)/Math.max(0,t),r=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/r;return o>=cy?r*=10:o>=fy?r*=5:o>=hy&&(r*=2),a<e?-r:r}function RL(){var e=identity,a=extent,t=sturges;function n(r){var o,u=r.length,h,v=new Array(u);for(o=0;o<u;++o)v[o]=e(r[o],o,r);var m=a(v),b=m[0],A=m[1],k=t(v,b,A);Array.isArray(k)||(k=tickStep(b,A,k),k=range(Math.ceil(b/k)*k,A,k));for(var L=k.length;k[0]<=b;)k.shift(),--L;for(;k[L-1]>A;)k.pop(),--L;var B=new Array(L+1),Z;for(o=0;o<=L;++o)Z=B[o]=[],Z.x0=o>0?k[o-1]:b,Z.x1=o<L?k[o]:A;for(o=0;o<u;++o)h=v[o],b<=h&&h<=A&&B[bisect(k,h,0,L)].push(r[o]);return B}return n.value=function(r){return arguments.length?(e=typeof r=="function"?r:constant(r),n):e},n.domain=function(r){return arguments.length?(a=typeof r=="function"?r:constant([r[0],r[1]]),n):a},n.thresholds=function(r){return arguments.length?(t=typeof r=="function"?r:Array.isArray(r)?constant(slice.call(r)):constant(r),n):t},n}function OL(e,a,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-a)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function P4(e){return e===null?NaN:+e}function L4(e,a,t){if(t==null&&(t=P4),!!(n=e.length)){if((a=+a)<=0||n<2)return+t(e[0],0,e);if(a>=1)return+t(e[n-1],n-1,e);var n,r=(n-1)*a,o=Math.floor(r),u=+t(e[o],o,e),h=+t(e[o+1],o+1,e);return u+(h-u)*(r-o)}}var R4=de(87765),yp="$";function ng(){}ng.prototype=Fx.prototype={constructor:ng,has:function(e){return yp+e in this},get:function(e){return this[yp+e]},set:function(e,a){return this[yp+e]=a,this},remove:function(e){var a=yp+e;return a in this&&delete this[a]},clear:function(){for(var e in this)e[0]===yp&&delete this[e]},keys:function(){var e=[];for(var a in this)a[0]===yp&&e.push(a.slice(1));return e},values:function(){var e=[];for(var a in this)a[0]===yp&&e.push(this[a]);return e},entries:function(){var e=[];for(var a in this)a[0]===yp&&e.push({key:a.slice(1),value:this[a]});return e},size:function(){var e=0;for(var a in this)a[0]===yp&&++e;return e},empty:function(){for(var e in this)if(e[0]===yp)return!1;return!0},each:function(e){for(var a in this)a[0]===yp&&e(this[a],a.slice(1),this)}};function Fx(e,a){var t=new ng;if(e instanceof ng)e.each(function(h,v){t.set(v,h)});else if(Array.isArray(e)){var n=-1,r=e.length,o;if(a==null)for(;++n<r;)t.set(n,e[n]);else for(;++n<r;)t.set(a(o=e[n],n,e),o)}else if(e)for(var u in e)t.set(u,e[u]);return t}var dy=Fx;function FL(){var e=[],a=[],t,n,r;function o(h,v,m,b){if(v>=e.length)return t!=null&&h.sort(t),n!=null?n(h):h;for(var A=-1,k=h.length,L=e[v++],B,Z,V=map(),K,le=m();++A<k;)(K=V.get(B=L(Z=h[A])+""))?K.push(Z):V.set(B,[Z]);return V.each(function(be,Be){b(le,Be,o(be,v,m,b))}),le}function u(h,v){if(++v>e.length)return h;var m,b=a[v-1];return n!=null&&v>=e.length?m=h.entries():(m=[],h.each(function(A,k){m.push({key:k,values:u(A,v)})})),b!=null?m.sort(function(A,k){return b(A.key,k.key)}):m}return r={object:function(h){return o(h,0,O4,F4)},map:function(h){return o(h,0,Dx,Bx)},entries:function(h){return u(o(h,0,Dx,Bx),0)},key:function(h){return e.push(h),r},sortKeys:function(h){return a[e.length-1]=h,r},sortValues:function(h){return t=h,r},rollup:function(h){return n=h,r}}}function O4(){return{}}function F4(e,a,t){e[a]=t}function Dx(){return map()}function Bx(e,a,t){e.set(a,t)}function ig(){}var av=dy.prototype;ig.prototype=D4.prototype={constructor:ig,has:av.has,add:function(e){return e+="",this[yp+e]=e,this},remove:av.remove,clear:av.clear,values:av.keys,size:av.size,empty:av.empty,each:av.each};function D4(e,a){var t=new ig;if(e instanceof ig)e.each(function(o){t.add(o)});else if(e){var n=-1,r=e.length;if(a==null)for(;++n<r;)t.add(e[n]);else for(;++n<r;)t.add(a(e[n],n,e))}return t}var DL=null,Nx=Array.prototype,ag=Nx.map,ov=Nx.slice;function T0(e,a){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(a).domain(e);break}return this}function zx(e,a){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(a).domain(e);break}return this}var Ux={name:"implicit"};function og(){var e=dy(),a=[],t=[],n=Ux;function r(o){var u=o+"",h=e.get(u);if(!h){if(n!==Ux)return n;e.set(u,h=a.push(o))}return t[(h-1)%t.length]}return r.domain=function(o){if(!arguments.length)return a.slice();a=[],e=dy();for(var u=-1,h=o.length,v,m;++u<h;)e.has(m=(v=o[u])+"")||e.set(m,a.push(v));return r},r.range=function(o){return arguments.length?(t=ov.call(o),r):t.slice()},r.unknown=function(o){return arguments.length?(n=o,r):n},r.copy=function(){return og(a,t).unknown(n)},T0.apply(r,arguments),r}function Zx(){var e=ordinal().unknown(void 0),a=e.domain,t=e.range,n=[0,1],r,o,u=!1,h=0,v=0,m=.5;delete e.unknown;function b(){var A=a().length,k=n[1]<n[0],L=n[k-0],B=n[1-k];r=(B-L)/Math.max(1,A-h+v*2),u&&(r=Math.floor(r)),L+=(B-L-r*(A-h))*m,o=r*(1-h),u&&(L=Math.round(L),o=Math.round(o));var Z=sequence(A).map(function(V){return L+r*V});return t(k?Z.reverse():Z)}return e.domain=function(A){return arguments.length?(a(A),b()):a()},e.range=function(A){return arguments.length?(n=[+A[0],+A[1]],b()):n.slice()},e.rangeRound=function(A){return n=[+A[0],+A[1]],u=!0,b()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(A){return arguments.length?(u=!!A,b()):u},e.padding=function(A){return arguments.length?(h=Math.min(1,v=+A),b()):h},e.paddingInner=function(A){return arguments.length?(h=Math.min(1,A),b()):h},e.paddingOuter=function(A){return arguments.length?(v=+A,b()):v},e.align=function(A){return arguments.length?(m=Math.max(0,Math.min(1,A)),b()):m},e.copy=function(){return Zx(a(),n).round(u).paddingInner(h).paddingOuter(v).align(m)},initRange.apply(b(),arguments)}function Vx(e){var a=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Vx(a())},e}function BL(){return Vx(Zx.apply(null,arguments).paddingInner(1))}var B4=de(21775),N4=de(73626);function z4(e,a){return e=+e,a=+a,function(t){return Math.round(e*(1-t)+a*t)}}function U4(e){return function(){return e}}function vy(e){return+e}var jx=[0,1];function ff(e){return e}function gy(e,a){return(a-=e=+e)?function(t){return(t-e)/a}:U4(isNaN(a)?NaN:.5)}function Gx(e){var a=e[0],t=e[e.length-1],n;return a>t&&(n=a,a=t,t=n),function(r){return Math.max(a,Math.min(t,r))}}function Z4(e,a,t){var n=e[0],r=e[1],o=a[0],u=a[1];return r<n?(n=gy(r,n),o=t(u,o)):(n=gy(n,r),o=t(o,u)),function(h){return o(n(h))}}function V4(e,a,t){var n=Math.min(e.length,a.length)-1,r=new Array(n),o=new Array(n),u=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),a=a.slice().reverse());++u<n;)r[u]=gy(e[u],e[u+1]),o[u]=t(a[u],a[u+1]);return function(h){var v=tg(e,h,1,n)-1;return o[v](r[v](h))}}function sg(e,a){return a.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function yy(){var e=jx,a=jx,t=B4.Z,n,r,o,u=ff,h,v,m;function b(){return h=Math.min(e.length,a.length)>2?V4:Z4,v=m=null,A}function A(k){return isNaN(k=+k)?o:(v||(v=h(e.map(n),a,t)))(n(u(k)))}return A.invert=function(k){return u(r((m||(m=h(a,e.map(n),N4.Z)))(k)))},A.domain=function(k){return arguments.length?(e=ag.call(k,vy),u===ff||(u=Gx(e)),b()):e.slice()},A.range=function(k){return arguments.length?(a=ov.call(k),b()):a.slice()},A.rangeRound=function(k){return a=ov.call(k),t=z4,b()},A.clamp=function(k){return arguments.length?(u=k?Gx(e):ff,A):u!==ff},A.interpolate=function(k){return arguments.length?(t=k,b()):t},A.unknown=function(k){return arguments.length?(o=k,A):o},function(k,L){return n=k,r=L,b()}}function Hx(e,a){return yy()(e,a)}var j4=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ug(e){if(!(a=j4.exec(e)))throw new Error("invalid format: "+e);var a;return new _y({fill:a[1],align:a[2],sign:a[3],symbol:a[4],zero:a[5],width:a[6],comma:a[7],precision:a[8]&&a[8].slice(1),trim:a[9],type:a[10]})}ug.prototype=_y.prototype;function _y(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}_y.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function G4(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function lg(e,a){if((t=(e=a?e.toExponential(a-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function kv(e){return e=lg(Math.abs(e)),e?e[1]:NaN}function H4(e,a){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(kv(a)/3)))*3-kv(Math.abs(e)))}function W4(e,a){return function(t,n){for(var r=t.length,o=[],u=0,h=e[0],v=0;r>0&&h>0&&(v+h+1>n&&(h=Math.max(1,n-v)),o.push(t.substring(r-=h,r+h)),!((v+=h+1)>n));)h=e[u=(u+1)%e.length];return o.reverse().join(a)}}function X4(e){return function(a){return a.replace(/[0-9]/g,function(t){return e[+t]})}}function Y4(e){e:for(var a=e.length,t=1,n=-1,r;t<a;++t)switch(e[t]){case".":n=r=t;break;case"0":n===0&&(n=t),r=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(r+1):e}var Wx;function q4(e,a){var t=lg(e,a);if(!t)return e+"";var n=t[0],r=t[1],o=r-(Wx=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,u=n.length;return o===u?n:o>u?n+new Array(o-u+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+lg(e,Math.max(0,a+o-1))[0]}function Xx(e,a){var t=lg(e,a);if(!t)return e+"";var n=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+n:n.length>r+1?n.slice(0,r+1)+"."+n.slice(r+1):n+new Array(r-n.length+2).join("0")}var Yx={"%":function(e,a){return(e*100).toFixed(a)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:G4,e:function(e,a){return e.toExponential(a)},f:function(e,a){return e.toFixed(a)},g:function(e,a){return e.toPrecision(a)},o:function(e){return Math.round(e).toString(8)},p:function(e,a){return Xx(e*100,a)},r:Xx,s:q4,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function qx(e){return e}var $x=Array.prototype.map,Kx=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function $4(e){var a=e.grouping===void 0||e.thousands===void 0?qx:W4($x.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?qx:X4($x.call(e.numerals,String)),u=e.percent===void 0?"%":e.percent+"",h=e.minus===void 0?"-":e.minus+"",v=e.nan===void 0?"NaN":e.nan+"";function m(A){A=ug(A);var k=A.fill,L=A.align,B=A.sign,Z=A.symbol,V=A.zero,K=A.width,le=A.comma,be=A.precision,Be=A.trim,et=A.type;et==="n"?(le=!0,et="g"):Yx[et]||(be===void 0&&(be=12),Be=!0,et="g"),(V||k==="0"&&L==="=")&&(V=!0,k="0",L="=");var at=Z==="$"?t:Z==="#"&&/[boxX]/.test(et)?"0"+et.toLowerCase():"",Lt=Z==="$"?n:/[%p]/.test(et)?u:"",Gt=Yx[et],sr=/[defgprs%]/.test(et);be=be===void 0?6:/[gprs]/.test(et)?Math.max(1,Math.min(21,be)):Math.max(0,Math.min(20,be));function Tr(Er){var Qr=at,On=Lt,li,Da,Wa;if(et==="c")On=Gt(Er)+On,Er="";else{Er=+Er;var ks=Er<0||1/Er<0;if(Er=isNaN(Er)?v:Gt(Math.abs(Er),be),Be&&(Er=Y4(Er)),ks&&+Er==0&&B!=="+"&&(ks=!1),Qr=(ks?B==="("?B:h:B==="-"||B==="("?"":B)+Qr,On=(et==="s"?Kx[8+Wx/3]:"")+On+(ks&&B==="("?")":""),sr){for(li=-1,Da=Er.length;++li<Da;)if(Wa=Er.charCodeAt(li),48>Wa||Wa>57){On=(Wa===46?r+Er.slice(li+1):Er.slice(li))+On,Er=Er.slice(0,li);break}}}le&&!V&&(Er=a(Er,Infinity));var Tu=Qr.length+Er.length+On.length,gu=Tu<K?new Array(K-Tu+1).join(k):"";switch(le&&V&&(Er=a(gu+Er,gu.length?K-On.length:Infinity),gu=""),L){case"<":Er=Qr+Er+On+gu;break;case"=":Er=Qr+gu+Er+On;break;case"^":Er=gu.slice(0,Tu=gu.length>>1)+Qr+Er+On+gu.slice(Tu);break;default:Er=gu+Qr+Er+On;break}return o(Er)}return Tr.toString=function(){return A+""},Tr}function b(A,k){var L=m((A=ug(A),A.type="f",A)),B=Math.max(-8,Math.min(8,Math.floor(kv(k)/3)))*3,Z=Math.pow(10,-B),V=Kx[8+B/3];return function(K){return L(Z*K)+V}}return{format:m,formatPrefix:b}}var cg,xy,Qx;K4({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function K4(e){return cg=$4(e),xy=cg.format,Qx=cg.formatPrefix,cg}function Q4(e,a){return e=Math.abs(e),a=Math.abs(a)-e,Math.max(0,kv(a)-kv(e))+1}function J4(e){return Math.max(0,-kv(Math.abs(e)))}function e3(e,a,t,n){var r=py(e,a,t),o;switch(n=ug(n==null?",f":n),n.type){case"s":{var u=Math.max(Math.abs(e),Math.abs(a));return n.precision==null&&!isNaN(o=H4(r,u))&&(n.precision=o),Qx(n,u)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=Q4(r,Math.max(Math.abs(e),Math.abs(a))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=J4(r))&&(n.precision=o-(n.type==="%")*2);break}}return xy(n)}function Pv(e){var a=e.domain;return e.ticks=function(t){var n=a();return Ox(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var r=a();return e3(r[0],r[r.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=a(),r=0,o=n.length-1,u=n[r],h=n[o],v;return h<u&&(v=u,u=h,h=v,v=r,r=o,o=v),v=rg(u,h,t),v>0?(u=Math.floor(u/v)*v,h=Math.ceil(h/v)*v,v=rg(u,h,t)):v<0&&(u=Math.ceil(u*v)/v,h=Math.floor(h*v)/v,v=rg(u,h,t)),v>0?(n[r]=Math.floor(u/v)*v,n[o]=Math.ceil(h/v)*v,a(n)):v<0&&(n[r]=Math.ceil(u*v)/v,n[o]=Math.floor(h*v)/v,a(n)),e},e}function Jx(){var e=Hx(ff,ff);return e.copy=function(){return sg(e,Jx())},T0.apply(e,arguments),Pv(e)}function eb(e){var a;function t(n){return isNaN(n=+n)?a:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=ag.call(n,vy),t):e.slice()},t.unknown=function(n){return arguments.length?(a=n,t):a},t.copy=function(){return eb(e).unknown(a)},e=arguments.length?ag.call(e,vy):[0,1],Pv(t)}function tb(e,a){e=e.slice();var t=0,n=e.length-1,r=e[t],o=e[n],u;return o<r&&(u=t,t=n,n=u,u=r,r=o,o=u),e[t]=a.floor(r),e[n]=a.ceil(o),e}function rb(e){return Math.log(e)}function nb(e){return Math.exp(e)}function t3(e){return-Math.log(-e)}function r3(e){return-Math.exp(-e)}function n3(e){return isFinite(e)?+("1e"+e):e<0?0:e}function i3(e){return e===10?n3:e===Math.E?Math.exp:function(a){return Math.pow(e,a)}}function a3(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(a){return Math.log(a)/e})}function ib(e){return function(a){return-e(-a)}}function o3(e){var a=e(rb,nb),t=a.domain,n=10,r,o;function u(){return r=a3(n),o=i3(n),t()[0]<0?(r=ib(r),o=ib(o),e(t3,r3)):e(rb,nb),a}return a.base=function(h){return arguments.length?(n=+h,u()):n},a.domain=function(h){return arguments.length?(t(h),u()):t()},a.ticks=function(h){var v=t(),m=v[0],b=v[v.length-1],A;(A=b<m)&&(k=m,m=b,b=k);var k=r(m),L=r(b),B,Z,V,K=h==null?10:+h,le=[];if(!(n%1)&&L-k<K){if(k=Math.round(k)-1,L=Math.round(L)+1,m>0){for(;k<L;++k)for(Z=1,B=o(k);Z<n;++Z)if(V=B*Z,!(V<m)){if(V>b)break;le.push(V)}}else for(;k<L;++k)for(Z=n-1,B=o(k);Z>=1;--Z)if(V=B*Z,!(V<m)){if(V>b)break;le.push(V)}}else le=Ox(k,L,Math.min(L-k,K)).map(o);return A?le.reverse():le},a.tickFormat=function(h,v){if(v==null&&(v=n===10?".0e":","),typeof v!="function"&&(v=xy(v)),h===Infinity)return v;h==null&&(h=10);var m=Math.max(1,n*h/a.ticks().length);return function(b){var A=b/o(Math.round(r(b)));return A*n<n-.5&&(A*=n),A<=m?v(b):""}},a.nice=function(){return t(tb(t(),{floor:function(h){return o(Math.floor(r(h)))},ceil:function(h){return o(Math.ceil(r(h)))}}))},a}function ab(){var e=o3(yy()).domain([1,10]);return e.copy=function(){return sg(e,ab()).base(e.base())},T0.apply(e,arguments),e}function ob(e){return function(a){return Math.sign(a)*Math.log1p(Math.abs(a/e))}}function sb(e){return function(a){return Math.sign(a)*Math.expm1(Math.abs(a))*e}}function s3(e){var a=1,t=e(ob(a),sb(a));return t.constant=function(n){return arguments.length?e(ob(a=+n),sb(a)):a},linearish(t)}function u3(){var e=s3(transformer());return e.copy=function(){return copy(e,u3()).constant(e.constant())},initRange.apply(e,arguments)}function ub(e){return function(a){return a<0?-Math.pow(-a,e):Math.pow(a,e)}}function l3(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function c3(e){return e<0?-e*e:e*e}function f3(e){var a=e(ff,ff),t=1;function n(){return t===1?e(ff,ff):t===.5?e(l3,c3):e(ub(t),ub(1/t))}return a.exponent=function(r){return arguments.length?(t=+r,n()):t},Pv(a)}function by(){var e=f3(yy());return e.copy=function(){return sg(e,by()).exponent(e.exponent())},T0.apply(e,arguments),e}function NL(){return by.apply(null,arguments).exponent(.5)}function lb(){var e=[],a=[],t=[],n;function r(){var u=0,h=Math.max(1,a.length);for(t=new Array(h-1);++u<h;)t[u-1]=L4(e,u/h);return o}function o(u){return isNaN(u=+u)?n:a[tg(t,u)]}return o.invertExtent=function(u){var h=a.indexOf(u);return h<0?[NaN,NaN]:[h>0?t[h-1]:e[0],h<t.length?t[h]:e[e.length-1]]},o.domain=function(u){if(!arguments.length)return e.slice();e=[];for(var h=0,v=u.length,m;h<v;++h)m=u[h],m!=null&&!isNaN(m=+m)&&e.push(m);return e.sort(ly),r()},o.range=function(u){return arguments.length?(a=ov.call(u),r()):a.slice()},o.unknown=function(u){return arguments.length?(n=u,o):n},o.quantiles=function(){return t.slice()},o.copy=function(){return lb().domain(e).range(a).unknown(n)},T0.apply(o,arguments)}function cb(){var e=0,a=1,t=1,n=[.5],r=[0,1],o;function u(v){return v<=v?r[tg(n,v,0,t)]:o}function h(){var v=-1;for(n=new Array(t);++v<t;)n[v]=((v+1)*a-(v-t)*e)/(t+1);return u}return u.domain=function(v){return arguments.length?(e=+v[0],a=+v[1],h()):[e,a]},u.range=function(v){return arguments.length?(t=(r=ov.call(v)).length-1,h()):r.slice()},u.invertExtent=function(v){var m=r.indexOf(v);return m<0?[NaN,NaN]:m<1?[e,n[0]]:m>=t?[n[t-1],a]:[n[m-1],n[m]]},u.unknown=function(v){return arguments.length&&(o=v),u},u.thresholds=function(){return n.slice()},u.copy=function(){return cb().domain([e,a]).range(r).unknown(o)},T0.apply(Pv(u),arguments)}function fb(){var e=[.5],a=[0,1],t,n=1;function r(o){return o<=o?a[tg(e,o,0,n)]:t}return r.domain=function(o){return arguments.length?(e=ov.call(o),n=Math.min(e.length,a.length-1),r):e.slice()},r.range=function(o){return arguments.length?(a=ov.call(o),n=Math.min(e.length,a.length-1),r):a.slice()},r.invertExtent=function(o){var u=a.indexOf(o);return[e[u-1],e[u]]},r.unknown=function(o){return arguments.length?(t=o,r):t},r.copy=function(){return fb().domain(e).range(a).unknown(t)},T0.apply(r,arguments)}var Ey=new Date,Cy=new Date;function Hf(e,a,t,n){function r(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=function(o){return e(o=new Date(+o)),o},r.ceil=function(o){return e(o=new Date(o-1)),a(o,1),e(o),o},r.round=function(o){var u=r(o),h=r.ceil(o);return o-u<h-o?u:h},r.offset=function(o,u){return a(o=new Date(+o),u==null?1:Math.floor(u)),o},r.range=function(o,u,h){var v=[],m;if(o=r.ceil(o),h=h==null?1:Math.floor(h),!(o<u)||!(h>0))return v;do v.push(m=new Date(+o)),a(o,h),e(o);while(m<o&&o<u);return v},r.filter=function(o){return Hf(function(u){if(u>=u)for(;e(u),!o(u);)u.setTime(u-1)},function(u,h){if(u>=u)if(h<0)for(;++h<=0;)for(;a(u,-1),!o(u););else for(;--h>=0;)for(;a(u,1),!o(u););})},t&&(r.count=function(o,u){return Ey.setTime(+o),Cy.setTime(+u),e(Ey),e(Cy),Math.floor(t(Ey,Cy))},r.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(n?function(u){return n(u)%o==0}:function(u){return r.count(0,u)%o==0}):r}),r}var Sy=Hf(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,a){e.setFullYear(e.getFullYear()+a)},function(e,a){return a.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Sy.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Hf(function(a){a.setFullYear(Math.floor(a.getFullYear()/e)*e),a.setMonth(0,1),a.setHours(0,0,0,0)},function(a,t){a.setFullYear(a.getFullYear()+t*e)})};var Lv=Sy,zL=Sy.range,hb=Hf(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,a){e.setMonth(e.getMonth()+a)},function(e,a){return a.getMonth()-e.getMonth()+(a.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),h3=hb,UL=hb.range,fg=1e3,pm=6e4,pb=36e5,db=864e5,vb=6048e5;function sv(e){return Hf(function(a){a.setDate(a.getDate()-(a.getDay()+7-e)%7),a.setHours(0,0,0,0)},function(a,t){a.setDate(a.getDate()+t*7)},function(a,t){return(t-a-(t.getTimezoneOffset()-a.getTimezoneOffset())*pm)/vb})}var Ay=sv(0),hg=sv(1),p3=sv(2),d3=sv(3),Rv=sv(4),v3=sv(5),m3=sv(6),ZL=Ay.range,VL=hg.range,jL=p3.range,GL=d3.range,HL=Rv.range,WL=v3.range,XL=m3.range,mb=Hf(function(e){e.setHours(0,0,0,0)},function(e,a){e.setDate(e.getDate()+a)},function(e,a){return(a-e-(a.getTimezoneOffset()-e.getTimezoneOffset())*pm)/db},function(e){return e.getDate()-1}),wy=mb,YL=mb.range,gb=Hf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*fg-e.getMinutes()*pm)},function(e,a){e.setTime(+e+a*pb)},function(e,a){return(a-e)/pb},function(e){return e.getHours()}),g3=gb,qL=gb.range,yb=Hf(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*fg)},function(e,a){e.setTime(+e+a*pm)},function(e,a){return(a-e)/pm},function(e){return e.getMinutes()}),y3=yb,$L=yb.range,_b=Hf(function(e){e.setTime(e-e.getMilliseconds())},function(e,a){e.setTime(+e+a*fg)},function(e,a){return(a-e)/fg},function(e){return e.getUTCSeconds()}),_3=_b,KL=_b.range,pg=Hf(function(){},function(e,a){e.setTime(+e+a)},function(e,a){return a-e});pg.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Hf(function(a){a.setTime(Math.floor(a/e)*e)},function(a,t){a.setTime(+a+t*e)},function(a,t){return(t-a)/e}):pg};var x3=pg,QL=pg.range;function uv(e){return Hf(function(a){a.setUTCDate(a.getUTCDate()-(a.getUTCDay()+7-e)%7),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCDate(a.getUTCDate()+t*7)},function(a,t){return(t-a)/vb})}var xb=uv(0),dg=uv(1),b3=uv(2),E3=uv(3),Ov=uv(4),C3=uv(5),S3=uv(6),JL=xb.range,eR=dg.range,tR=b3.range,rR=E3.range,nR=Ov.range,iR=C3.range,aR=S3.range,bb=Hf(function(e){e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCDate(e.getUTCDate()+a)},function(e,a){return(a-e)/db},function(e){return e.getUTCDate()-1}),Eb=bb,oR=bb.range,Ty=Hf(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,a){e.setUTCFullYear(e.getUTCFullYear()+a)},function(e,a){return a.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Ty.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Hf(function(a){a.setUTCFullYear(Math.floor(a.getUTCFullYear()/e)*e),a.setUTCMonth(0,1),a.setUTCHours(0,0,0,0)},function(a,t){a.setUTCFullYear(a.getUTCFullYear()+t*e)})};var dm=Ty,sR=Ty.range;function My(e){if(0<=e.y&&e.y<100){var a=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return a.setFullYear(e.y),a}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Iy(e){if(0<=e.y&&e.y<100){var a=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return a.setUTCFullYear(e.y),a}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function vm(e,a,t){return{y:e,m:a,d:t,H:0,M:0,S:0,L:0}}function A3(e){var a=e.dateTime,t=e.date,n=e.time,r=e.periods,o=e.days,u=e.shortDays,h=e.months,v=e.shortMonths,m=mm(r),b=gm(r),A=mm(o),k=gm(o),L=mm(u),B=gm(u),Z=mm(h),V=gm(h),K=mm(v),le=gm(v),be={a:ks,A:Tu,b:gu,B:hf,c:null,d:Mb,e:Mb,f:Y3,g:iI,G:oI,H:H3,I:W3,j:X3,L:Ib,m:q3,M:$3,p:I0,q:k0,Q:Fb,s:Db,S:K3,u:Q3,U:J3,V:eI,w:tI,W:rI,x:null,X:null,y:nI,Y:aI,Z:sI,"%":Ob},Be={a:fv,A:zv,b:P0,B:Uv,c:null,d:Pb,e:Pb,f:fI,g:bI,G:CI,H:uI,I:lI,j:cI,L:Lb,m:hI,M:pI,p:Uy,q:Zy,Q:Fb,s:Db,S:dI,u:vI,U:mI,V:gI,w:yI,W:_I,x:null,X:null,y:xI,Y:EI,Z:SI,"%":Ob},et={a:Tr,A:Er,b:Qr,B:On,c:li,d:wb,e:wb,f:Z3,g:Ab,G:Sb,H:Tb,I:Tb,j:B3,L:U3,m:D3,M:N3,p:sr,q:F3,Q:j3,s:G3,S:z3,u:k3,U:P3,V:L3,w:I3,W:R3,x:Da,X:Wa,y:Ab,Y:Sb,Z:O3,"%":V3};be.x=at(t,be),be.X=at(n,be),be.c=at(a,be),Be.x=at(t,Be),Be.X=at(n,Be),Be.c=at(a,Be);function at(Ji,Fo){return function(as){var ui=[],Ch=-1,ou=0,Wh=Ji.length,Xh,hv,AE;for(as instanceof Date||(as=new Date(+as));++Ch<Wh;)Ji.charCodeAt(Ch)===37&&(ui.push(Ji.slice(ou,Ch)),(hv=Cb[Xh=Ji.charAt(++Ch)])!=null?Xh=Ji.charAt(++Ch):hv=Xh==="e"?" ":"0",(AE=Fo[Xh])&&(Xh=AE(as,hv)),ui.push(Xh),ou=Ch+1);return ui.push(Ji.slice(ou,Ch)),ui.join("")}}function Lt(Ji,Fo){return function(as){var ui=vm(1900,void 0,1),Ch=Gt(ui,Ji,as+="",0),ou,Wh;if(Ch!=as.length)return null;if("Q"in ui)return new Date(ui.Q);if("s"in ui)return new Date(ui.s*1e3+("L"in ui?ui.L:0));if(Fo&&!("Z"in ui)&&(ui.Z=0),"p"in ui&&(ui.H=ui.H%12+ui.p*12),ui.m===void 0&&(ui.m="q"in ui?ui.q:0),"V"in ui){if(ui.V<1||ui.V>53)return null;"w"in ui||(ui.w=1),"Z"in ui?(ou=Iy(vm(ui.y,0,1)),Wh=ou.getUTCDay(),ou=Wh>4||Wh===0?dg.ceil(ou):dg(ou),ou=Eb.offset(ou,(ui.V-1)*7),ui.y=ou.getUTCFullYear(),ui.m=ou.getUTCMonth(),ui.d=ou.getUTCDate()+(ui.w+6)%7):(ou=My(vm(ui.y,0,1)),Wh=ou.getDay(),ou=Wh>4||Wh===0?hg.ceil(ou):hg(ou),ou=wy.offset(ou,(ui.V-1)*7),ui.y=ou.getFullYear(),ui.m=ou.getMonth(),ui.d=ou.getDate()+(ui.w+6)%7)}else("W"in ui||"U"in ui)&&("w"in ui||(ui.w="u"in ui?ui.u%7:"W"in ui?1:0),Wh="Z"in ui?Iy(vm(ui.y,0,1)).getUTCDay():My(vm(ui.y,0,1)).getDay(),ui.m=0,ui.d="W"in ui?(ui.w+6)%7+ui.W*7-(Wh+5)%7:ui.w+ui.U*7-(Wh+6)%7);return"Z"in ui?(ui.H+=ui.Z/100|0,ui.M+=ui.Z%100,Iy(ui)):My(ui)}}function Gt(Ji,Fo,as,ui){for(var Ch=0,ou=Fo.length,Wh=as.length,Xh,hv;Ch<ou;){if(ui>=Wh)return-1;if(Xh=Fo.charCodeAt(Ch++),Xh===37){if(Xh=Fo.charAt(Ch++),hv=et[Xh in Cb?Fo.charAt(Ch++):Xh],!hv||(ui=hv(Ji,as,ui))<0)return-1}else if(Xh!=as.charCodeAt(ui++))return-1}return ui}function sr(Ji,Fo,as){var ui=m.exec(Fo.slice(as));return ui?(Ji.p=b[ui[0].toLowerCase()],as+ui[0].length):-1}function Tr(Ji,Fo,as){var ui=L.exec(Fo.slice(as));return ui?(Ji.w=B[ui[0].toLowerCase()],as+ui[0].length):-1}function Er(Ji,Fo,as){var ui=A.exec(Fo.slice(as));return ui?(Ji.w=k[ui[0].toLowerCase()],as+ui[0].length):-1}function Qr(Ji,Fo,as){var ui=K.exec(Fo.slice(as));return ui?(Ji.m=le[ui[0].toLowerCase()],as+ui[0].length):-1}function On(Ji,Fo,as){var ui=Z.exec(Fo.slice(as));return ui?(Ji.m=V[ui[0].toLowerCase()],as+ui[0].length):-1}function li(Ji,Fo,as){return Gt(Ji,a,Fo,as)}function Da(Ji,Fo,as){return Gt(Ji,t,Fo,as)}function Wa(Ji,Fo,as){return Gt(Ji,n,Fo,as)}function ks(Ji){return u[Ji.getDay()]}function Tu(Ji){return o[Ji.getDay()]}function gu(Ji){return v[Ji.getMonth()]}function hf(Ji){return h[Ji.getMonth()]}function I0(Ji){return r[+(Ji.getHours()>=12)]}function k0(Ji){return 1+~~(Ji.getMonth()/3)}function fv(Ji){return u[Ji.getUTCDay()]}function zv(Ji){return o[Ji.getUTCDay()]}function P0(Ji){return v[Ji.getUTCMonth()]}function Uv(Ji){return h[Ji.getUTCMonth()]}function Uy(Ji){return r[+(Ji.getUTCHours()>=12)]}function Zy(Ji){return 1+~~(Ji.getUTCMonth()/3)}return{format:function(Ji){var Fo=at(Ji+="",be);return Fo.toString=function(){return Ji},Fo},parse:function(Ji){var Fo=Lt(Ji+="",!1);return Fo.toString=function(){return Ji},Fo},utcFormat:function(Ji){var Fo=at(Ji+="",Be);return Fo.toString=function(){return Ji},Fo},utcParse:function(Ji){var Fo=Lt(Ji+="",!0);return Fo.toString=function(){return Ji},Fo}}}var Cb={"-":"",_:" ","0":"0"},Sc=/^\s*\d+/,w3=/^%/,T3=/[\\^$*+?|[\]().{}]/g;function is(e,a,t){var n=e<0?"-":"",r=(n?-e:e)+"",o=r.length;return n+(o<t?new Array(t-o+1).join(a)+r:r)}function M3(e){return e.replace(T3,"\\$&")}function mm(e){return new RegExp("^(?:"+e.map(M3).join("|")+")","i")}function gm(e){for(var a={},t=-1,n=e.length;++t<n;)a[e[t].toLowerCase()]=t;return a}function I3(e,a,t){var n=Sc.exec(a.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function k3(e,a,t){var n=Sc.exec(a.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function P3(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function L3(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function R3(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function Sb(e,a,t){var n=Sc.exec(a.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function Ab(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function O3(e,a,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(a.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function F3(e,a,t){var n=Sc.exec(a.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function D3(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function wb(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function B3(e,a,t){var n=Sc.exec(a.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function Tb(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function N3(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function z3(e,a,t){var n=Sc.exec(a.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function U3(e,a,t){var n=Sc.exec(a.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function Z3(e,a,t){var n=Sc.exec(a.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function V3(e,a,t){var n=w3.exec(a.slice(t,t+1));return n?t+n[0].length:-1}function j3(e,a,t){var n=Sc.exec(a.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function G3(e,a,t){var n=Sc.exec(a.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function Mb(e,a){return is(e.getDate(),a,2)}function H3(e,a){return is(e.getHours(),a,2)}function W3(e,a){return is(e.getHours()%12||12,a,2)}function X3(e,a){return is(1+wy.count(Lv(e),e),a,3)}function Ib(e,a){return is(e.getMilliseconds(),a,3)}function Y3(e,a){return Ib(e,a)+"000"}function q3(e,a){return is(e.getMonth()+1,a,2)}function $3(e,a){return is(e.getMinutes(),a,2)}function K3(e,a){return is(e.getSeconds(),a,2)}function Q3(e){var a=e.getDay();return a===0?7:a}function J3(e,a){return is(Ay.count(Lv(e)-1,e),a,2)}function kb(e){var a=e.getDay();return a>=4||a===0?Rv(e):Rv.ceil(e)}function eI(e,a){return e=kb(e),is(Rv.count(Lv(e),e)+(Lv(e).getDay()===4),a,2)}function tI(e){return e.getDay()}function rI(e,a){return is(hg.count(Lv(e)-1,e),a,2)}function nI(e,a){return is(e.getFullYear()%100,a,2)}function iI(e,a){return e=kb(e),is(e.getFullYear()%100,a,2)}function aI(e,a){return is(e.getFullYear()%1e4,a,4)}function oI(e,a){var t=e.getDay();return e=t>=4||t===0?Rv(e):Rv.ceil(e),is(e.getFullYear()%1e4,a,4)}function sI(e){var a=e.getTimezoneOffset();return(a>0?"-":(a*=-1,"+"))+is(a/60|0,"0",2)+is(a%60,"0",2)}function Pb(e,a){return is(e.getUTCDate(),a,2)}function uI(e,a){return is(e.getUTCHours(),a,2)}function lI(e,a){return is(e.getUTCHours()%12||12,a,2)}function cI(e,a){return is(1+Eb.count(dm(e),e),a,3)}function Lb(e,a){return is(e.getUTCMilliseconds(),a,3)}function fI(e,a){return Lb(e,a)+"000"}function hI(e,a){return is(e.getUTCMonth()+1,a,2)}function pI(e,a){return is(e.getUTCMinutes(),a,2)}function dI(e,a){return is(e.getUTCSeconds(),a,2)}function vI(e){var a=e.getUTCDay();return a===0?7:a}function mI(e,a){return is(xb.count(dm(e)-1,e),a,2)}function Rb(e){var a=e.getUTCDay();return a>=4||a===0?Ov(e):Ov.ceil(e)}function gI(e,a){return e=Rb(e),is(Ov.count(dm(e),e)+(dm(e).getUTCDay()===4),a,2)}function yI(e){return e.getUTCDay()}function _I(e,a){return is(dg.count(dm(e)-1,e),a,2)}function xI(e,a){return is(e.getUTCFullYear()%100,a,2)}function bI(e,a){return e=Rb(e),is(e.getUTCFullYear()%100,a,2)}function EI(e,a){return is(e.getUTCFullYear()%1e4,a,4)}function CI(e,a){var t=e.getUTCDay();return e=t>=4||t===0?Ov(e):Ov.ceil(e),is(e.getUTCFullYear()%1e4,a,4)}function SI(){return"+0000"}function Ob(){return"%"}function Fb(e){return+e}function Db(e){return Math.floor(+e/1e3)}var Fv,Bb,AI,wI,TI;MI({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function MI(e){return Fv=A3(e),Bb=Fv.format,AI=Fv.parse,wI=Fv.utcFormat,TI=Fv.utcParse,Fv}var ym=1e3,_m=ym*60,xm=_m*60,bm=xm*24,II=bm*7,Nb=bm*30,ky=bm*365;function kI(e){return new Date(e)}function PI(e){return e instanceof Date?+e:+new Date(+e)}function zb(e,a,t,n,r,o,u,h,v){var m=Hx(ff,ff),b=m.invert,A=m.domain,k=v(".%L"),L=v(":%S"),B=v("%I:%M"),Z=v("%I %p"),V=v("%a %d"),K=v("%b %d"),le=v("%B"),be=v("%Y"),Be=[[u,1,ym],[u,5,5*ym],[u,15,15*ym],[u,30,30*ym],[o,1,_m],[o,5,5*_m],[o,15,15*_m],[o,30,30*_m],[r,1,xm],[r,3,3*xm],[r,6,6*xm],[r,12,12*xm],[n,1,bm],[n,2,2*bm],[t,1,II],[a,1,Nb],[a,3,3*Nb],[e,1,ky]];function et(Lt){return(u(Lt)<Lt?k:o(Lt)<Lt?L:r(Lt)<Lt?B:n(Lt)<Lt?Z:a(Lt)<Lt?t(Lt)<Lt?V:K:e(Lt)<Lt?le:be)(Lt)}function at(Lt,Gt,sr,Tr){if(Lt==null&&(Lt=10),typeof Lt=="number"){var Er=Math.abs(sr-Gt)/Lt,Qr=kx(function(On){return On[2]}).right(Be,Er);Qr===Be.length?(Tr=py(Gt/ky,sr/ky,Lt),Lt=e):Qr?(Qr=Be[Er/Be[Qr-1][2]<Be[Qr][2]/Er?Qr-1:Qr],Tr=Qr[1],Lt=Qr[0]):(Tr=Math.max(py(Gt,sr,Lt),1),Lt=h)}return Tr==null?Lt:Lt.every(Tr)}return m.invert=function(Lt){return new Date(b(Lt))},m.domain=function(Lt){return arguments.length?A(ag.call(Lt,PI)):A().map(kI)},m.ticks=function(Lt,Gt){var sr=A(),Tr=sr[0],Er=sr[sr.length-1],Qr=Er<Tr,On;return Qr&&(On=Tr,Tr=Er,Er=On),On=at(Lt,Tr,Er,Gt),On=On?On.range(Tr,Er+1):[],Qr?On.reverse():On},m.tickFormat=function(Lt,Gt){return Gt==null?et:v(Gt)},m.nice=function(Lt,Gt){var sr=A();return(Lt=at(Lt,sr[0],sr[sr.length-1],Gt))?A(tb(sr,Lt)):m},m.copy=function(){return sg(m,zb(e,a,t,n,r,o,u,h,v))},m}function LI(){return T0.apply(zb(Lv,h3,Ay,wy,g3,y3,_3,x3,Bb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function uR(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function vg(){var e=0,a=1,t,n,r,o,u=ff,h=!1,v;function m(b){return isNaN(b=+b)?v:u(r===0?.5:(b=(o(b)-t)*r,h?Math.max(0,Math.min(1,b)):b))}return m.domain=function(b){return arguments.length?(t=o(e=+b[0]),n=o(a=+b[1]),r=t===n?0:1/(n-t),m):[e,a]},m.clamp=function(b){return arguments.length?(h=!!b,m):h},m.interpolator=function(b){return arguments.length?(u=b,m):u},m.unknown=function(b){return arguments.length?(v=b,m):v},function(b){return o=b,t=b(e),n=b(a),r=t===n?0:1/(n-t),m}}function Em(e,a){return a.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Ub(){var e=Pv(vg()(ff));return e.copy=function(){return Em(e,Ub())},zx.apply(e,arguments)}function RI(){var e=loggish(vg()).domain([1,10]);return e.copy=function(){return Em(e,RI()).base(e.base())},initInterpolator.apply(e,arguments)}function OI(){var e=symlogish(vg());return e.copy=function(){return Em(e,OI()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Zb(){var e=powish(vg());return e.copy=function(){return Em(e,Zb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function lR(){return Zb.apply(null,arguments).exponent(.5)}function FI(){var e=[],a=identity;function t(n){if(!isNaN(n=+n))return a((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var r=0,o=n.length,u;r<o;++r)u=n[r],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(a=n,t):a},t.copy=function(){return FI(a).domain(e)},initInterpolator.apply(t,arguments)}function mg(){var e=0,a=.5,t=1,n,r,o,u,h,v=ff,m,b=!1,A;function k(L){return isNaN(L=+L)?A:(L=.5+((L=+m(L))-r)*(L<r?u:h),v(b?Math.max(0,Math.min(1,L)):L))}return k.domain=function(L){return arguments.length?(n=m(e=+L[0]),r=m(a=+L[1]),o=m(t=+L[2]),u=n===r?0:.5/(r-n),h=r===o?0:.5/(o-r),k):[e,a,t]},k.clamp=function(L){return arguments.length?(b=!!L,k):b},k.interpolator=function(L){return arguments.length?(v=L,k):v},k.unknown=function(L){return arguments.length?(A=L,k):A},function(L){return m=L,n=L(e),r=L(a),o=L(t),u=n===r?0:.5/(r-n),h=r===o?0:.5/(o-r),k}}function Vb(){var e=Pv(mg()(ff));return e.copy=function(){return Em(e,Vb())},zx.apply(e,arguments)}function DI(){var e=loggish(mg()).domain([.1,1,10]);return e.copy=function(){return copy(e,DI()).base(e.base())},initInterpolator.apply(e,arguments)}function BI(){var e=symlogish(mg());return e.copy=function(){return copy(e,BI()).constant(e.constant())},initInterpolator.apply(e,arguments)}function jb(){var e=powish(mg());return e.copy=function(){return copy(e,jb()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function cR(){return jb.apply(null,arguments).exponent(.5)}var Hh,Gb,Hb,Wb,Py,Xb,NI=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,zI=(Hh={},(0,re.Z)(Hh,ns.LINEAR,Jx),(0,re.Z)(Hh,ns.POWER,by),(0,re.Z)(Hh,ns.LOG,ab),(0,re.Z)(Hh,ns.IDENTITY,eb),(0,re.Z)(Hh,ns.SEQUENTIAL,Ub),(0,re.Z)(Hh,ns.TIME,LI),(0,re.Z)(Hh,ns.QUANTILE,lb),(0,re.Z)(Hh,ns.QUANTIZE,cb),(0,re.Z)(Hh,ns.THRESHOLD,fb),(0,re.Z)(Hh,ns.CAT,og),(0,re.Z)(Hh,ns.DIVERGING,Vb),Hh),UI=(Gb=(0,Yr.b2)(),Hb=(0,Yr.f3)(nr.IGlobalConfigService),Gb(Wb=(Py=function(){function e(){(0,Zt.Z)(this,e),ka(this,"configService",Xb,this),(0,re.Z)(this,"scaleCache",{}),(0,re.Z)(this,"scaleOptions",{})}return(0,kt.Z)(e,[{key:"getSourceData",value:function(t,n){var r=t.getSource();r.inited?n(r.data):r.once("sourceUpdate",function(){n(r.data)})}},{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();r.getSourceData(t,function(h){var v=h.dataArray;Array.isArray(v)&&v.length===0||r.caculateScalesForAttributes(u||[],v)})}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();return r.getSourceData(t,function(h){var v=h.dataArray;Array.isArray(v)&&v.length===0||(r.caculateScalesForAttributes(u||[],v),t.layerModelNeedUpdate=!0)}),!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){r.scaleOptions=t.getScaleOptions();var u=o.getLayerStyleAttributes();u&&r.getSourceData(t,function(h){var v=h.dataArray;if(v.length!==0){var m=u.filter(function(b){return b.needRescale});m.length&&r.caculateScalesForAttributes(m,v)}})}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var r=this;this.scaleCache={},t.forEach(function(o){if(o.scale){var u=o.scale;u.names=r.parseFields(o.scale.field||[]);var h=[];u.names.forEach(function(v){var m;h.push(r.createScale(v,o.name,(m=o.scale)===null||m===void 0?void 0:m.values,n))}),h.some(function(v){return v.type===E0.VARIABLE})?(u.type=E0.VARIABLE,h.forEach(function(v){var m;if(!u.callback&&u.values!=="text")switch((m=v.option)===null||m===void 0?void 0:m.type){case ns.LOG:case ns.LINEAR:case ns.POWER:if(u.values&&u.values.length>2){var b=v.scale.ticks(u.values.length);v.scale.domain(b)}u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case ns.QUANTILE:case ns.QUANTIZE:case ns.THRESHOLD:v.scale.range(u.values);break;case ns.CAT:u.values?v.scale.range(u.values):v.scale.range(v.option.domain);break;case ns.DIVERGING:case ns.SEQUENTIAL:v.scale.interpolator(R4.hD(u.values));break}if(u.values==="text"){var A;v.scale.range((A=v.option)===null||A===void 0?void 0:A.domain)}})):(u.type=E0.CONSTANT,u.defaultValues=h.map(function(v,m){return v.scale(u.names[m])})),u.scalers=h.map(function(v){return{field:v.field,func:v.scale,option:v.option}}),o.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,d.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,r,o){var u,h,v=this.scaleOptions[n]&&((u=this.scaleOptions[n])===null||u===void 0?void 0:u.field)===t?this.scaleOptions[n]:this.scaleOptions[t],m={field:t,scale:void 0,type:E0.VARIABLE,option:v};if(!o||!o.length)return v&&v.type?m.scale=this.createDefaultScale(v):(m.scale=og([t]),m.type=E0.CONSTANT),m;var b=(h=o.find(function(L){return!(0,d.isNil)(L[t])}))===null||h===void 0?void 0:h[t];if(this.isNumber(t)||(0,d.isNil)(b)&&!v)m.scale=og([t]),m.type=E0.CONSTANT;else{var A=v&&v.type||this.getDefaultType(b);r==="text"&&(A=ns.CAT);var k=this.createScaleConfig(A,t,v,o);m.scale=this.createDefaultScale(k),m.option=k}return m}},{key:"getDefaultType",value:function(t){var n=ns.LINEAR;return typeof t=="string"&&(n=NI.test(t)?ns.TIME:ns.CAT),n}},{key:"createScaleConfig",value:function(t,n,r,o){var u={type:t},h=(o==null?void 0:o.map(function(b){return b[n]}))||[];if(r!=null&&r.domain)u.domain=r==null?void 0:r.domain;else if(t!==ns.CAT&&t!==ns.QUANTILE&&t!==ns.DIVERGING)u.domain=Lx(h);else if(t===ns.CAT)u.domain=(0,d.uniq)(h);else if(t===ns.QUANTILE)u.domain=h;else if(t===ns.DIVERGING){var v=Lx(h),m=(r==null?void 0:r.neutral)!==void 0?r==null?void 0:r.neutral:(v[0]+v[1])/2;u.domain=[v[0],m,v[1]]}return(0,ae.Z)((0,ae.Z)({},u),r)}},{key:"createDefaultScale",value:function(t){var n=t.type,r=t.domain,o=t.unknown,u=t.clamp,h=t.nice,v=zI[n]();return r&&v.domain&&v.domain(r),o&&v.unknown(o),u!==void 0&&v.clamp&&v.clamp(u),h!==void 0&&v.nice&&v.nice(h),v}}]),e}(),Xb=Aa(Py.prototype,"configService",[Hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py))||Wb),Yb,qb,$b,Kb,gg,Qb,Jb,ZI=(Yb=(0,Yr.b2)(),qb=(0,Yr.f3)(nr.ICameraService),$b=(0,Yr.f3)(nr.IRendererService),Yb(Kb=(gg=function(){function e(){(0,Zt.Z)(this,e),ka(this,"cameraService",Qb,this),ka(this,"rendererService",Jb,this)}return(0,kt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(n){n.addUniforms((0,ae.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),Qb=Aa(gg.prototype,"cameraService",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jb=Aa(gg.prototype,"rendererService",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gg))||Kb),e2,t2,VI=(e2=(0,Yr.b2)(),e2(t2=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"initLayerModel",value:function(t){t.prepareBuildModel(),t.buildModels(),t.emit("modelLoaded",null),t.styleNeedUpdate=!1}},{key:"prepareLayerModel",value:function(t){t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.emit("modelLoaded",null),t.layerModelNeedUpdate=!1}},{key:"apply",value:function(t){var n=this;t.hooks.init.tap("LayerModelPlugin",function(){t.inited=!0;var r=t.getSource();r.inited&&n.initLayerModel(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var r=t.getSource();return r.inited?n.prepareLayerModel(t):r.once("sourceUpdate",function(){n.prepareLayerModel(t)}),!1})}}]),e}())||t2),r2,n2,jI=(r2=(0,Yr.b2)(),r2(n2=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var n=t.getLayerConfig(),r=n.autoFit,o=n.fitBoundsOptions;r&&setTimeout(function(){t.fitBounds(o)},100)})}}]),e}())||n2),i2,a2,GI=["type"],o2={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},HI={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},WI={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},XI={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},fR=null;function YI(e){var a={u_DirectionalLights:new Array(3).fill((0,ae.Z)({},WI)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,ae.Z)({},XI)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[HI]),e.forEach(function(t,n){var r=t.type,o=r===void 0?"directional":r,u=(0,ue.Z)(t,GI),h=o2[o].lights,v=o2[o].num,m=a[v];a[h][m]=(0,ae.Z)((0,ae.Z)({},a[h][m]),u),a[v]++}),a}var qI=(i2=(0,Yr.b2)(),i2(a2=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),r=n.enableLighting;r&&t.models.forEach(function(o){return o.addUniforms((0,ae.Z)({},YI()))})})}}]),e}())||a2),s2,u2,l2,Ly,c2,$I=(s2=(0,Yr.b2)(),u2=(0,Yr.f3)(nr.IGlobalConfigService),s2(l2=(Ly=function(){function e(){(0,Zt.Z)(this,e),ka(this,"configService",c2,this)}return(0,kt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.rendererService,u=n.postProcessingPassFactory,h=n.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var v=t.getLayerConfig(),m=v.enableMultiPassRenderer,b=v.passes,A=b===void 0?[]:b;r.enabled=!!m&&t.getLayerConfig().enableMultiPassRenderer!==!1,r.enabled&&(t.multiPassRenderer=l1(t,A,u,h),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(r.enabled){var v=o.getViewportSize(),m=v.width,b=v.height;t.multiPassRenderer.resize(m,b)}})}}]),e}(),c2=Aa(Ly.prototype,"configService",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly))||l2),f2,h2,yg={NONE:0,ENCODE:1,HIGHLIGHT:2},KI=(f2=(0,Yr.b2)(),f2(h2=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(t,n){var r=n.rendererService,o=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),h=u.enablePicking,v=u.enableMultiPassRenderer;o.registerStyleAttribute({name:"pickingColor",type:Vn.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:Y.FLOAT},size:3,update:function(b,A){var k=b.id;return h?z(k):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),h=u.enablePicking;h&&t.isVisible()&&t.models.forEach(function(v){return v.addUniforms({u_PickingStage:yg.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var u=t.getLayerConfig(),h=u.enablePicking;h&&t.isVisible()&&t.models.forEach(function(v){return v.addUniforms({u_PickingStage:yg.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(u){var h=t.getLayerConfig(),v=h.highlightColor,m=h.activeMix,b=m===void 0?0:m,A=typeof v=="string"?I(v):v||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:R(new Uint8Array(u))}),t.models.forEach(function(k){return k.addUniforms({u_PickingStage:yg.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:A.map(function(L){return L*255}),u_activeMix:b})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(u){var h=t.getLayerConfig(),v=h.selectColor,m=h.selectMix,b=m===void 0?0:m,A=typeof v=="string"?I(v):v||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:R(new Uint8Array(u))}),t.models.forEach(function(k){return k.addUniforms({u_PickingStage:yg.HIGHLIGHT,u_PickingColor:u,u_HighlightColor:A.map(function(L){return L*255}),u_activeMix:b,u_CurrentSelectedId:u,u_SelectColor:A.map(function(L){return L*255}),u_EnableSelect:1})})})}}]),e}())||h2),p2,d2,QI=(p2=(0,Yr.b2)(),p2(d2=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){r.registerBuiltinAttributes(o)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:Vn.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:Y.FLOAT},size:3,update:function(r,o,u){return u.length===2?[u[0],u[1],0]:[u[0],u[1],u[2]]}}}),t.registerStyleAttribute({name:"filter",type:Vn.Attribute,descriptor:{name:"filter",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(r,o){var u=r.filter;return u?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:Vn.Attribute,descriptor:{name:"a_Color",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(r,o){var u=r.color;return!u||!u.length?[1,1,1,1]:u}}}),t.registerStyleAttribute({name:"vertexId",type:Vn.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(r,o,u,h){return[o]}}})}}]),e}())||d2),v2,m2,g2,y2,_2,x2,Dv,b2,E2,C2,S2,JI=(v2=(0,Yr.b2)(),m2=(0,Yr.f3)(nr.ICameraService),g2=(0,Yr.f3)(nr.ICoordinateSystemService),y2=(0,Yr.f3)(nr.IRendererService),_2=(0,Yr.f3)(nr.IMapService),v2(x2=(Dv=function(){function e(){(0,Zt.Z)(this,e),ka(this,"cameraService",b2,this),ka(this,"coordinateSystemService",E2,this),ka(this,"rendererService",C2,this),ka(this,"mapService",S2,this)}return(0,kt.Z)(e,[{key:"apply",value:function(t){var n=this,r=this.mapService.version,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var h=t.getLayerConfig().tileOrigin;if(n.coordinateSystemService.refresh(h),r==="GAODE2.x"){var v=n.getLayerCenter(t);n.mapService.map.customCoords.setCenter(v),n.mapService.setCustomCoordCenter(v),o=n.mapService.map.customCoords.getMVPMatrix(),u=n.mapService.getCustomCoordCenter()}var m=n.rendererService.getViewportSize(),b=m.width,A=m.height;t.models.forEach(function(k){var L;k.addUniforms((L={},(0,re.Z)(L,ev.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,re.Z)(L,ev.ViewMatrix,n.cameraService.getViewMatrix()),(0,re.Z)(L,ev.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,re.Z)(L,ev.Zoom,n.cameraService.getZoom()),(0,re.Z)(L,ev.ZoomScale,n.cameraService.getZoomScale()),(0,re.Z)(L,ev.FocalDistance,n.cameraService.getFocalDistance()),(0,re.Z)(L,ev.CameraPosition,n.cameraService.getCameraPosition()),(0,re.Z)(L,Hp.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,re.Z)(L,Hp.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,re.Z)(L,Hp.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,re.Z)(L,Hp.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,re.Z)(L,Hp.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,re.Z)(L,Hp.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,re.Z)(L,Hp.Mvp,o),(0,re.Z)(L,"u_SceneCenterMKT",u),(0,re.Z)(L,"u_ViewportSize",[b,A]),(0,re.Z)(L,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,re.Z)(L,"u_DevicePixelRatio",Ui.devicePixelRatio),(0,re.Z)(L,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,re.Z)(L,"u_shaderPick",Number(t.getShaderPickStat())),L))})})}},{key:"getLayerCenter",value:function(t){var n=t.getSource();return n.center}}]),e}(),b2=Aa(Dv.prototype,"cameraService",[m2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E2=Aa(Dv.prototype,"coordinateSystemService",[g2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C2=Aa(Dv.prototype,"rendererService",[y2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S2=Aa(Dv.prototype,"mapService",[_2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dv))||x2),A2,w2,ek=(A2=(0,Yr.b2)(),A2(w2=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||w2),T2,M2,tk=(T2=(0,Yr.b2)(),T2(M2=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"apply",value:function(t,n){var r=this,o=n.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){r.initStyleAttribute(t,{styleAttributeService:o})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||r.updateStyleAtrribute(t,{styleAttributeService:o})})}},{key:"updateStyleAtrribute",value:function(t,n){var r=n.styleAttributeService,o=r.getLayerStyleAttributes()||[],u=r.getLayerStyleAttribute("filter"),h=r.getLayerStyleAttribute("shape");if(u&&u.needRegenerateVertices){t.layerModelNeedUpdate=!0,o.forEach(function(v){return v.needRegenerateVertices=!1});return}o.filter(function(v){return v.needRegenerateVertices}).forEach(function(v){r.updateAttributeByFeatureRange(v.name,t.getEncodedData(),v.featureRange.startIndex,v.featureRange.endIndex),v.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var r=n.styleAttributeService,o=r.getLayerStyleAttributes()||[];o.filter(function(u){return u.needRegenerateVertices}).forEach(function(u){r.updateAttributeByFeatureRange(u.name,t.getEncodedData(),u.featureRange.startIndex,u.featureRange.endIndex),u.needRegenerateVertices=!1})}}]),e}())||M2);jh.bind(nr.ILayerPlugin).to(M4).inRequestScope(),jh.bind(nr.ILayerPlugin).to(QI).inRequestScope(),jh.bind(nr.ILayerPlugin).to(UI).inRequestScope(),jh.bind(nr.ILayerPlugin).to(T4).inRequestScope(),jh.bind(nr.ILayerPlugin).to(jI).inRequestScope(),jh.bind(nr.ILayerPlugin).to(tk).inRequestScope(),jh.bind(nr.ILayerPlugin).to(ek).inRequestScope(),jh.bind(nr.ILayerPlugin).to($I).inRequestScope(),jh.bind(nr.ILayerPlugin).to(JI).inRequestScope(),jh.bind(nr.ILayerPlugin).to(ZI).inRequestScope(),jh.bind(nr.ILayerPlugin).to(qI).inRequestScope(),jh.bind(nr.ILayerPlugin).to(KI).inRequestScope(),jh.bind(nr.ILayerPlugin).to(VI).inRequestScope();var rk=de(88307),nk=de.n(rk),ik=function(){function e(a,t){(0,Zt.Z)(this,e);var n=t.buffer,r=t.offset,o=t.stride,u=t.normalized,h=t.size,v=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:r||0,stride:o||0,normalized:u||!1,divisor:v||0},h&&(this.attribute.size=h)}return(0,kt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Kd,Cm,Qd,_p,Sm,M0,Am,_g,Ad,lv,Xc,wd,Td,xg,ak=(Kd={},(0,re.Z)(Kd,Y.POINTS,"points"),(0,re.Z)(Kd,Y.LINES,"lines"),(0,re.Z)(Kd,Y.LINE_LOOP,"line loop"),(0,re.Z)(Kd,Y.LINE_STRIP,"line strip"),(0,re.Z)(Kd,Y.TRIANGLES,"triangles"),(0,re.Z)(Kd,Y.TRIANGLE_FAN,"triangle fan"),(0,re.Z)(Kd,Y.TRIANGLE_STRIP,"triangle strip"),Kd),I2=(Cm={},(0,re.Z)(Cm,Y.STATIC_DRAW,"static"),(0,re.Z)(Cm,Y.DYNAMIC_DRAW,"dynamic"),(0,re.Z)(Cm,Y.STREAM_DRAW,"stream"),Cm),Ry=(Qd={},(0,re.Z)(Qd,Y.BYTE,"int8"),(0,re.Z)(Qd,Y.UNSIGNED_INT,"int16"),(0,re.Z)(Qd,Y.INT,"int32"),(0,re.Z)(Qd,Y.UNSIGNED_BYTE,"uint8"),(0,re.Z)(Qd,Y.UNSIGNED_SHORT,"uint16"),(0,re.Z)(Qd,Y.UNSIGNED_INT,"uint32"),(0,re.Z)(Qd,Y.FLOAT,"float"),Qd),ok=(_p={},(0,re.Z)(_p,Y.ALPHA,"alpha"),(0,re.Z)(_p,Y.LUMINANCE,"luminance"),(0,re.Z)(_p,Y.LUMINANCE_ALPHA,"luminance alpha"),(0,re.Z)(_p,Y.RGB,"rgb"),(0,re.Z)(_p,Y.RGBA,"rgba"),(0,re.Z)(_p,Y.RGBA4,"rgba4"),(0,re.Z)(_p,Y.RGB5_A1,"rgb5 a1"),(0,re.Z)(_p,Y.RGB565,"rgb565"),(0,re.Z)(_p,Y.DEPTH_COMPONENT,"depth"),(0,re.Z)(_p,Y.DEPTH_STENCIL,"depth stencil"),_p),sk=(Sm={},(0,re.Z)(Sm,Y.DONT_CARE,"dont care"),(0,re.Z)(Sm,Y.NICEST,"nice"),(0,re.Z)(Sm,Y.FASTEST,"fast"),Sm),k2=(M0={},(0,re.Z)(M0,Y.NEAREST,"nearest"),(0,re.Z)(M0,Y.LINEAR,"linear"),(0,re.Z)(M0,Y.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,re.Z)(M0,Y.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,re.Z)(M0,Y.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,re.Z)(M0,Y.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),M0),P2=(Am={},(0,re.Z)(Am,Y.REPEAT,"repeat"),(0,re.Z)(Am,Y.CLAMP_TO_EDGE,"clamp"),(0,re.Z)(Am,Y.MIRRORED_REPEAT,"mirror"),Am),uk=(_g={},(0,re.Z)(_g,Y.NONE,"none"),(0,re.Z)(_g,Y.BROWSER_DEFAULT_WEBGL,"browser"),_g),lk=(Ad={},(0,re.Z)(Ad,Y.NEVER,"never"),(0,re.Z)(Ad,Y.ALWAYS,"always"),(0,re.Z)(Ad,Y.LESS,"less"),(0,re.Z)(Ad,Y.LEQUAL,"lequal"),(0,re.Z)(Ad,Y.GREATER,"greater"),(0,re.Z)(Ad,Y.GEQUAL,"gequal"),(0,re.Z)(Ad,Y.EQUAL,"equal"),(0,re.Z)(Ad,Y.NOTEQUAL,"notequal"),Ad),L2=(lv={},(0,re.Z)(lv,Y.FUNC_ADD,"add"),(0,re.Z)(lv,Y.MIN_EXT,"min"),(0,re.Z)(lv,Y.MAX_EXT,"max"),(0,re.Z)(lv,Y.FUNC_SUBTRACT,"subtract"),(0,re.Z)(lv,Y.FUNC_REVERSE_SUBTRACT,"reverse subtract"),lv),bg=(Xc={},(0,re.Z)(Xc,Y.ZERO,"zero"),(0,re.Z)(Xc,Y.ONE,"one"),(0,re.Z)(Xc,Y.SRC_COLOR,"src color"),(0,re.Z)(Xc,Y.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,re.Z)(Xc,Y.SRC_ALPHA,"src alpha"),(0,re.Z)(Xc,Y.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,re.Z)(Xc,Y.DST_COLOR,"dst color"),(0,re.Z)(Xc,Y.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,re.Z)(Xc,Y.DST_ALPHA,"dst alpha"),(0,re.Z)(Xc,Y.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,re.Z)(Xc,Y.CONSTANT_COLOR,"constant color"),(0,re.Z)(Xc,Y.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,re.Z)(Xc,Y.CONSTANT_ALPHA,"constant alpha"),(0,re.Z)(Xc,Y.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,re.Z)(Xc,Y.SRC_ALPHA_SATURATE,"src alpha saturate"),Xc),ck=(wd={},(0,re.Z)(wd,Y.NEVER,"never"),(0,re.Z)(wd,Y.ALWAYS,"always"),(0,re.Z)(wd,Y.LESS,"less"),(0,re.Z)(wd,Y.LEQUAL,"lequal"),(0,re.Z)(wd,Y.GREATER,"greater"),(0,re.Z)(wd,Y.GEQUAL,"gequal"),(0,re.Z)(wd,Y.EQUAL,"equal"),(0,re.Z)(wd,Y.NOTEQUAL,"notequal"),wd),Bv=(Td={},(0,re.Z)(Td,Y.ZERO,"zero"),(0,re.Z)(Td,Y.KEEP,"keep"),(0,re.Z)(Td,Y.REPLACE,"replace"),(0,re.Z)(Td,Y.INVERT,"invert"),(0,re.Z)(Td,Y.INCR,"increment"),(0,re.Z)(Td,Y.DECR,"decrement"),(0,re.Z)(Td,Y.INCR_WRAP,"increment wrap"),(0,re.Z)(Td,Y.DECR_WRAP,"decrement wrap"),Td),fk=(xg={},(0,re.Z)(xg,Y.FRONT,"front"),(0,re.Z)(xg,Y.BACK,"back"),xg),hk=function(){function e(a,t){(0,Zt.Z)(this,e);var n=t.data,r=t.usage,o=t.type;this.buffer=a.buffer({data:n,usage:I2[r||Y.STATIC_DRAW],type:Ry[o||Y.UNSIGNED_BYTE]})}return(0,kt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var n=t.data,r=t.offset;this.buffer.subdata(n,r)}}]),e}(),pk=function(){function e(a,t){(0,Zt.Z)(this,e);var n=t.data,r=t.usage,o=t.type,u=t.count;this.elements=a.elements({data:n,usage:I2[r||Y.STATIC_DRAW],type:Ry[o||Y.UNSIGNED_BYTE],count:u})}return(0,kt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),dk=function(){function e(a,t){(0,Zt.Z)(this,e);var n=t.width,r=t.height,o=t.color,u=t.colors,h=t.depth,v=t.stencil,m={width:n,height:r};Array.isArray(u)&&(m.colors=u.map(function(b){return b.get()})),o&&typeof o!="boolean"&&(m.color=o.get()),this.framebuffer=a.framebuffer(m)}return(0,kt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,r=t.height;this.framebuffer.resize(n,r)}}]),e}(),vk=function(){function e(a,t){(0,Zt.Z)(this,e),(0,re.Z)(this,"destroyed",!1),(0,re.Z)(this,"uniforms",{}),this.reGl=a;var n=t.vs,r=t.fs,o=t.attributes,u=t.uniforms,h=t.primitive,v=t.count,m=t.elements,b=t.depth,A=t.blend,k=t.stencil,L=t.cull,B=t.instances,Z={};this.options=t,u&&(this.uniforms=this.extractUniforms(u),Object.keys(u).forEach(function(be){Z[be]=a.prop(be)}));var V={};Object.keys(o).forEach(function(be){V[be]=o[be].get()});var K={attributes:V,frag:r,uniforms:Z,vert:n,blend:{},primitive:ak[h===void 0?Y.TRIANGLES:h]};B&&(K.instances=B),v?K.count=v:m&&(K.elements=m.get()),this.initDepthDrawParams({depth:b},K),this.initBlendDrawParams({blend:A},K),this.initStencilDrawParams({stencil:k},K),this.initCullDrawParams({cull:L},K),this.drawCommand=a(K);var le=(0,d.cloneDeep)(K);le.blend=(0,ae.Z)((0,ae.Z)({},le.blend),{},{enable:!1}),this.drawPickCommand=a(le),this.drawParams=K}return(0,kt.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var r={};Object.keys(t).forEach(function(u){r[u]=t[u].get()}),this.drawParams.attributes=r,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var o=(0,d.cloneDeep)(this.drawParams);o.blend=(0,ae.Z)((0,ae.Z)({},o.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(o)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(o){n[o]=t[o].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var r=(0,d.cloneDeep)(this.drawParams);r.blend=(0,ae.Z)((0,ae.Z)({},r.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(r)}},{key:"addUniforms",value:function(t){this.uniforms=(0,ae.Z)((0,ae.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var r=(0,ae.Z)((0,ae.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),o={};Object.keys(r).forEach(function(u){var h=(0,oe.Z)(r[u]);h==="boolean"||h==="number"||Array.isArray(r[u])||r[u].BYTES_PER_ELEMENT?o[u]=r[u]:o[u]=r[u].get()}),n?this.drawPickCommand(o):this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var r=t.depth;r&&(n.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:lk[r.func||Y.LESS],range:r.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var r=t.blend;if(r){var o=r.enable,u=r.func,h=r.equation,v=r.color,m=v===void 0?[0,0,0,0]:v;n.blend={enable:!!o,func:{srcRGB:bg[u&&u.srcRGB||Y.SRC_ALPHA],srcAlpha:bg[u&&u.srcAlpha||Y.SRC_ALPHA],dstRGB:bg[u&&u.dstRGB||Y.ONE_MINUS_SRC_ALPHA],dstAlpha:bg[u&&u.dstAlpha||Y.ONE_MINUS_SRC_ALPHA]},equation:{rgb:L2[h&&h.rgb||Y.FUNC_ADD],alpha:L2[h&&h.alpha||Y.FUNC_ADD]},color:m}}}},{key:"initStencilDrawParams",value:function(t,n){var r=t.stencil;if(r){var o=r.enable,u=r.mask,h=u===void 0?-1:u,v=r.func,m=v===void 0?{cmp:Y.ALWAYS,ref:0,mask:-1}:v,b=r.opFront,A=b===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:b,k=r.opBack,L=k===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:k;n.stencil={enable:!!o,mask:h,func:(0,ae.Z)((0,ae.Z)({},m),{},{cmp:ck[m.cmp]}),opFront:{fail:Bv[A.fail],zfail:Bv[A.zfail],zpass:Bv[A.zpass]},opBack:{fail:Bv[L.fail],zfail:Bv[L.zfail],zpass:Bv[L.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var r=t.cull;if(r){var o=r.enable,u=r.face,h=u===void 0?Y.BACK:u;n.cull={enable:!!o,face:fk[h]}}}},{key:"extractUniforms",value:function(t){var n=this,r={};return Object.keys(t).forEach(function(o){n.extractUniformsRecursively(o,t[o],r,"")}),r}},{key:"extractUniformsRecursively",value:function(t,n,r,o){var u=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||(0,d.isTypedArray)(n)||n===""||"resize"in n){r["".concat(o&&o+".").concat(t)]=n;return}(0,d.isPlainObject)(n)&&Object.keys(n).forEach(function(h){u.extractUniformsRecursively(h,n[h],r,"".concat(o&&o+".").concat(t))}),Array.isArray(n)&&n.forEach(function(h,v){Object.keys(h).forEach(function(m){u.extractUniformsRecursively(m,h[m],r,"".concat(o&&o+".").concat(t,"[").concat(v,"]"))})})}}]),e}(),mk=function(){function e(a,t){(0,Zt.Z)(this,e),(0,re.Z)(this,"isDistroy",!1);var n=t.data,r=t.type,o=r===void 0?Y.UNSIGNED_BYTE:r,u=t.width,h=t.height,v=t.flipY,m=v===void 0?!1:v,b=t.format,A=b===void 0?Y.RGBA:b,k=t.mipmap,L=k===void 0?!1:k,B=t.wrapS,Z=B===void 0?Y.CLAMP_TO_EDGE:B,V=t.wrapT,K=V===void 0?Y.CLAMP_TO_EDGE:V,le=t.aniso,be=le===void 0?0:le,Be=t.alignment,et=Be===void 0?1:Be,at=t.premultiplyAlpha,Lt=at===void 0?!1:at,Gt=t.mag,sr=Gt===void 0?Y.NEAREST:Gt,Tr=t.min,Er=Tr===void 0?Y.NEAREST:Tr,Qr=t.colorSpace,On=Qr===void 0?Y.BROWSER_DEFAULT_WEBGL:Qr,li=t.x,Da=li===void 0?0:li,Wa=t.y,ks=Wa===void 0?0:Wa,Tu=t.copy,gu=Tu===void 0?!1:Tu;this.width=u,this.height=h;var hf={width:u,height:h,type:Ry[o],format:ok[A],wrapS:P2[Z],wrapT:P2[K],mag:k2[sr],min:k2[Er],alignment:et,flipY:m,colorSpace:uk[On],premultiplyAlpha:Lt,aniso:be,x:Da,y:ks,copy:gu};n&&(hf.data=n),typeof L=="number"?hf.mipmap=sk[L]:typeof L=="boolean"&&(hf.mipmap=L),this.texture=a.texture(hf)}return(0,kt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,r=t.height;this.texture.resize(n,r),this.width=n,this.height=r}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),e}(),R2,O2,gk=(R2=(0,Yr.b2)(),R2(O2=function(){function e(){var a=this;(0,Zt.Z)(this,e),(0,re.Z)(this,"createModel",function(t){return new vk(a.gl,t)}),(0,re.Z)(this,"createAttribute",function(t){return new ik(a.gl,t)}),(0,re.Z)(this,"createBuffer",function(t){return new hk(a.gl,t)}),(0,re.Z)(this,"createElements",function(t){return new pk(a.gl,t)}),(0,re.Z)(this,"createTexture2D",function(t){return new mk(a.gl,t)}),(0,re.Z)(this,"createFramebuffer",function(t){return new dk(a.gl,t)}),(0,re.Z)(this,"useFramebuffer",function(t,n){a.gl({framebuffer:t?t.get():null})(n)}),(0,re.Z)(this,"clear",function(t){var n,r=t.color,o=t.depth,u=t.stencil,h=t.framebuffer,v=h===void 0?null:h,m={color:r,depth:o,stencil:u};m.framebuffer=v===null?v:v.get(),(n=a.gl)===null||n===void 0||n.clear(m)}),(0,re.Z)(this,"viewport",function(t){var n=t.x,r=t.y,o=t.width,u=t.height;a.gl._gl.viewport(n,r,o,u),a.width=o,a.height=u,a.gl._refresh()}),(0,re.Z)(this,"readPixels",function(t){var n=t.framebuffer,r=t.x,o=t.y,u=t.width,h=t.height,v={x:r,y:o,width:u,height:h};return n&&(v.framebuffer=n.get()),a.gl.read(v)}),(0,re.Z)(this,"getViewportSize",function(){return{width:a.gl._gl.drawingBufferWidth,height:a.gl._gl.drawingBufferHeight}}),(0,re.Z)(this,"getContainer",function(){if(Eu)return a.canvas;var t;return(t=a.canvas)===null||t===void 0?void 0:t.parentElement}),(0,re.Z)(this,"getCanvas",function(){return a.canvas}),(0,re.Z)(this,"getGLContext",function(){return a.gl._gl}),(0,re.Z)(this,"destroy",function(){var t,n,r;a.canvas=null,(t=a.gl)===null||t===void 0||(n=t._gl)===null||n===void 0||(r=n.getExtension("WEBGL_lose_context"))===null||r===void 0||r.loseContext(),a.gl.destroy(),a.gl=null})}return(0,kt.Z)(e,[{key:"init",value:function(){var a=(0,_a.Z)(di().mark(function n(r,o,u){var h=this;return di().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(this.canvas=r,!u){m.next=5;break}this.gl=u,m.next=8;break;case 5:return m.next=7,new Promise(function(b,A){nk()({canvas:h.canvas,attributes:{alpha:!0,antialias:o.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:o.preserveDrawingBuffer,stencil:o.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(L,B){(L||!B)&&A(L),b(B)}})});case 7:this.gl=m.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return m.stop()}},n,this)}));function t(n,r,o){return a.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||O2),yk=function(){function e(a){(0,Zt.Z)(this,e);var t=a.id,n=a.map,r=a.canvas,o=a.hasBaseMap,u=oS();this.container=u,n.setContainer(u,t,r,o),u.bind(nr.IRendererService).to(gk).inSingletonScope(),this.sceneService=u.get(nr.ISceneService),this.mapService=u.get(nr.IMapService),this.iconService=u.get(nr.IIconService),this.fontService=u.get(nr.IFontService),this.controlService=u.get(nr.IControlService),this.layerService=u.get(nr.ILayerService),this.markerService=u.get(nr.IMarkerService),this.interactionService=u.get(nr.IInteractionService),this.popupService=u.get(nr.IPopupService),Eu?this.sceneService.initMiniScene(a):(this.initComponent(t),this.sceneService.init(a),this.initControl())}return(0,kt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var r=new t(this);r.init()}else this.on("loaded",function(){var o=new t(n);o.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=Hg(this.container);t.setContainer(n,this.container),this.sceneService.addLayer(t);var r=t.getLayerConfig();if(r){var o=r.mask,u=r.maskfence,h=r.maskColor,v=h===void 0?"#000":h,m=r.maskOpacity,b=m===void 0?0:m;if(o&&u){var A=new O1().source(u).shape("fill").color(v).style({opacity:b});this.addMask(A,t.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,n){var r=this.getLayer(n);if(r){var o=Hg(this.container);t.setContainer(o,this.container),r.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,n){this.layerService.remove(t,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(r){var o=(0,Mr.Z)(r,2),u=o[0],h=o[1];n.fontService.addIconFont(u,h)})}},{key:"addFontFace",value:function(t,n){this.sceneService.addFontFace(t,n)}},{key:"addImage",value:function(t,n){Eu?this.iconService.addImageMini(t,n,this.sceneService):this.iconService.addImage(t,n)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,n){Wg.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.on(t,n)}},{key:"once",value:function(t,n){Wg.indexOf(t)===-1?this.mapService.once(t,n):this.sceneService.once(t,n)}},{key:"off",value:function(t,n){Wg.indexOf(t)===-1?this.mapService.off(t,n):this.sceneService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var r=this.sceneService.getSceneConfig(),o=r.fitBoundsOptions,u=r.animate;this.mapService.fitBounds(t,n||(0,ae.Z)((0,ae.Z)({},o),{},{animate:u}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(nr.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:bl(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,r=t.logoPosition;n&&this.addControl(new wS({position:r}))}}]),e}(),hR="2.9.26";function F2(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function pR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?F2(Object(t),!0).forEach(function(n){_k(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):F2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function _k(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function dR(e,a){return Ck(e)||Ek(e,a)||bk(e,a)||xk()}function xk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bk(e,a){if(!!e){if(typeof e=="string")return D2(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return D2(e,a)}}function D2(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function Ek(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(v){o=!0,h=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function Ck(e){if(Array.isArray(e))return e}var vR=null,mR=null,B2,Oy,N2,Sk=(B2=Gg(nr.IGlobalConfigService),Oy=function(){function e(a){(0,Zt.Z)(this,e),ka(this,"configService",N2,this),this.config=a}return(0,kt.Z)(e,[{key:"setContainer",value:function(t,n,r,o){t.bind(nr.MapConfig).toConstantValue((0,ae.Z)((0,ae.Z)({},this.config),{},{id:n,canvas:r,hasBaseMap:o})),t.bind(nr.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),N2=Aa(Oy.prototype,"configService",[B2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy),Ak=de(6158),wm=de.n(Ak);function Tm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Eg(e,a){var t=Yv([],a,e);return X0(t,t,1/t[3]),t}function gR(e,a){var t=e%a;return t<0?a+t:t}function yR(e,a,t){return t*a+(1-t)*e}function cv(e,a){if(!e)throw new Error(a||"viewport-mercator-project: assertion failed.")}var qp=Math.PI,z2=qp/4,Jd=qp/180,U2=180/qp,Fy=512,Dy=4003e4,wk=1.5;function Z2(e){return Math.pow(2,e)}function Tk(e){return Math.log2(e)}function Cg(e,a){var t=(0,Mr.Z)(e,2),n=t[0],r=t[1];cv(Number.isFinite(n)&&Number.isFinite(a)),cv(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude"),a*=Fy;var o=n*Jd,u=r*Jd,h=a*(o+qp)/(2*qp),v=a*(qp-Math.log(Math.tan(z2+u*.5)))/(2*qp);return[h,v]}function By(e,a){var t=(0,Mr.Z)(e,2),n=t[0],r=t[1];a*=Fy;var o=n/a*(2*qp)-qp,u=2*(Math.atan(Math.exp(qp-r/a*(2*qp)))-z2);return[o*U2,u*U2]}function _R(e){var a=e.latitude;assert(Number.isFinite(a));var t=Math.cos(a*Jd);return Tk(Dy*t)-9}function V2(e){var a=e.latitude,t=e.longitude,n=e.zoom,r=e.scale,o=e.highPrecision,u=o===void 0?!1:o;r=r!==void 0?r:Z2(n),cv(Number.isFinite(a)&&Number.isFinite(t)&&Number.isFinite(r));var h={},v=Fy*r,m=Math.cos(a*Jd),b=v/360,A=b/m,k=v/Dy/m;if(h.pixelsPerMeter=[k,-k,k],h.metersPerPixel=[1/k,-1/k,1/k],h.pixelsPerDegree=[b,-A,k],h.degreesPerPixel=[1/b,-1/A,1/k],u){var L=Jd*Math.tan(a*Jd)/m,B=b*L/2,Z=v/Dy*L,V=Z/A*k;h.pixelsPerDegree2=[0,-B,Z],h.pixelsPerMeter2=[V,0,V]}return h}function xR(e,a){var t=_slicedToArray(e,3),n=t[0],r=t[1],o=t[2],u=_slicedToArray(a,3),h=u[0],v=u[1],m=u[2],b=1,A=V2({longitude:n,latitude:r,scale:b,highPrecision:!0}),k=A.pixelsPerMeter,L=A.pixelsPerMeter2,B=Cg(e,b);B[0]+=h*(k[0]+L[0]*v),B[1]+=v*(k[1]+L[1]*v);var Z=By(B,b),V=(o||0)+(m||0);return Number.isFinite(o)||Number.isFinite(m)?[Z[0],Z[1],V]:Z}function Mk(e){var a=e.height,t=e.pitch,n=e.bearing,r=e.altitude,o=e.center,u=o===void 0?null:o,h=e.flipY,v=h===void 0?!1:h,m=Tm();return mh(m,m,[0,0,-r]),gh(m,m,[1,1,1/a]),vd(m,m,-t*Jd),zd(m,m,n*Jd),v&&gh(m,m,[1,-1,1]),u&&mh(m,m,Ko.negate([],u)),m}function Ik(e){var a=e.width,t=e.height,n=e.altitude,r=n===void 0?wk:n,o=e.pitch,u=o===void 0?0:o,h=e.nearZMultiplier,v=h===void 0?1:h,m=e.farZMultiplier,b=m===void 0?1:m,A=u*Jd,k=Math.atan(.5/r),L=Math.sin(k)*r/Math.sin(Math.PI/2-A-k),B=Math.cos(Math.PI/2-A)*L+r;return{fov:2*Math.atan(t/2/r),aspect:a/t,focalDistance:r,near:v,far:B*b}}function kk(e){var a=e.width,t=e.height,n=e.pitch,r=e.altitude,o=e.nearZMultiplier,u=e.farZMultiplier,h=Ik({width:a,height:t,altitude:r,pitch:n,nearZMultiplier:o,farZMultiplier:u}),v=h.fov,m=h.aspect,b=h.near,A=h.far,k=N0([],v,m,b,A);return k}function Pk(e,a){var t=(0,Mr.Z)(e,3),n=t[0],r=t[1],o=t[2],u=o===void 0?0:o;return cv(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(u)),Eg(a,[n,r,u,1])}function j2(e,a){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Mr.Z)(e,3),r=n[0],o=n[1],u=n[2];if(cv(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(u)){var h=Eg(a,[r,o,u,1]);return h}var v=Eg(a,[r,o,0,1]),m=Eg(a,[r,o,1,1]),b=v[2],A=m[2],k=b===A?0:((t||0)-b)/(A-b);return un.lerp([],v,m,k)}var G2=Tm(),Lk=function(){function e(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=a.width,n=a.height,r=a.viewMatrix,o=r===void 0?G2:r,u=a.projectionMatrix,h=u===void 0?G2:u;(0,Zt.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=h;var v=Tm();wu(v,v,this.projectionMatrix),wu(v,v,this.viewMatrix),this.viewProjectionMatrix=v;var m=Tm();gh(m,m,[this.width/2,-this.height/2,1]),mh(m,m,[1,-1,0]),wu(m,m,this.viewProjectionMatrix);var b=Uh(Tm(),m);if(!b)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=m,this.pixelUnprojectionMatrix=b,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,kt.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&_h(t.projectionMatrix,this.projectionMatrix)&&_h(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.topLeft,o=r===void 0?!0:r,u=this.projectPosition(t),h=Pk(u,this.pixelProjectionMatrix),v=(0,Mr.Z)(h,2),m=v[0],b=v[1],A=o?b:this.height-b;return t.length===2?[m,A]:[m,A,h[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=n.topLeft,o=r===void 0?!0:r,u=n.targetZ,h=(0,Mr.Z)(t,3),v=h[0],m=h[1],b=h[2],A=o?m:this.height-m,k=u&&u*this.pixelsPerMeter,L=j2([v,A,b],this.pixelUnprojectionMatrix,k),B=this.unprojectPosition(L),Z=(0,Mr.Z)(B,3),V=Z[0],K=Z[1],le=Z[2];return Number.isFinite(b)?[V,K,le]:Number.isFinite(u)?[V,K,u]:[V,K]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),r=(0,Mr.Z)(n,2),o=r[0],u=r[1],h=(t[2]||0)*this.pixelsPerMeter;return[o,u,h]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),r=(0,Mr.Z)(n,2),o=r[0],u=r[1],h=(t[2]||0)/this.pixelsPerMeter;return[o,u,h]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function Rk(e){var a=e.width,t=e.height,n=e.bounds,r=e.minExtent,o=r===void 0?0:r,u=e.maxZoom,h=u===void 0?24:u,v=e.padding,m=v===void 0?0:v,b=e.offset,A=b===void 0?[0,0]:b,k=(0,Mr.Z)(n,2),L=(0,Mr.Z)(k[0],2),B=L[0],Z=L[1],V=(0,Mr.Z)(k[1],2),K=V[0],le=V[1];if(Number.isFinite(m)){var be=m;m={top:be,bottom:be,left:be,right:be}}else cv(Number.isFinite(m.top)&&Number.isFinite(m.bottom)&&Number.isFinite(m.left)&&Number.isFinite(m.right));var Be=new H2({width:a,height:t,longitude:0,latitude:0,zoom:0}),et=Be.project([B,le]),at=Be.project([K,Z]),Lt=[Math.max(Math.abs(at[0]-et[0]),o),Math.max(Math.abs(at[1]-et[1]),o)],Gt=[a-m.left-m.right-Math.abs(A[0])*2,t-m.top-m.bottom-Math.abs(A[1])*2];cv(Gt[0]>0&&Gt[1]>0);var sr=Gt[0]/Lt[0],Tr=Gt[1]/Lt[1],Er=(m.right-m.left)/2/sr,Qr=(m.bottom-m.top)/2/Tr,On=[(at[0]+et[0])/2+Er,(at[1]+et[1])/2+Qr],li=Be.unproject(On),Da=Be.zoom+Math.log2(Math.abs(Math.min(sr,Tr)));return{longitude:li[0],latitude:li[1],zoom:Math.min(Da,h)}}var H2=function(e){(0,Pr.Z)(a,e);function a(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,o=n.height,u=n.latitude,h=u===void 0?0:u,v=n.longitude,m=v===void 0?0:v,b=n.zoom,A=b===void 0?0:b,k=n.pitch,L=k===void 0?0:k,B=n.bearing,Z=B===void 0?0:B,V=n.altitude,K=V===void 0?1.5:V,le=n.nearZMultiplier,be=n.farZMultiplier;(0,Zt.Z)(this,a),r=r||1,o=o||1;var Be=Z2(A);K=Math.max(.75,K);var et=Cg([m,h],Be);et[2]=0;var at=kk({width:r,height:o,pitch:L,bearing:Z,altitude:K,nearZMultiplier:le||1/o,farZMultiplier:be||1.01}),Lt=Mk({height:o,center:et,pitch:L,bearing:Z,altitude:K,flipY:!0});return t=(0,Or.Z)(this,(0,Et.Z)(a).call(this,{width:r,height:o,viewMatrix:Lt,projectionMatrix:at})),t.latitude=h,t.longitude=m,t.zoom=A,t.pitch=L,t.bearing=Z,t.altitude=K,t.scale=Be,t.center=et,t.pixelsPerMeter=V2((0,bt.Z)((0,bt.Z)(t))).pixelsPerMeter[2],Object.freeze((0,bt.Z)((0,bt.Z)(t))),t}return(0,kt.Z)(a,[{key:"projectFlat",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Cg(n,r)}},{key:"unprojectFlat",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return By(n,r)}},{key:"getMapCenterByLngLatPosition",value:function(n){var r=n.lngLat,o=n.pos,u=j2(o,this.pixelUnprojectionMatrix),h=Cg(r,this.scale),v=un.add([],h,un.negate([],u)),m=un.add([],this.center,v);return By(m,this.scale)}},{key:"getLocationAtPoint",value:function(n){var r=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:r,pos:o})}},{key:"fitBounds",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,u=this.height,h=Rk(Object.assign({width:o,height:u,bounds:n},r)),v=h.longitude,m=h.latitude,b=h.zoom;return new a({width:o,height:u,longitude:v,latitude:m,zoom:b})}}]),a}(Lk),Ok=function(){function e(){(0,Zt.Z)(this,e)}return(0,kt.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,r=t.zoom,o=t.pitch,u=t.bearing,h=t.viewportHeight,v=t.viewportWidth;this.viewport=new H2({width:v,height:h,longitude:n&&n[0],latitude:n&&n[1],zoom:r,pitch:o,bearing:u})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),Fk=function(){function e(a){(0,Zt.Z)(this,e),(0,re.Z)(this,"size",1e4),this.size=a||1e4}return(0,kt.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),r=this.mercatorYfromLat(t[1]);return[n,r]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),r=this.latFromMercatorY(t[1]);return[n,r]}}]),e}(),W2={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Dk=["id","attributionControl","style","token","rotation","mapInstance"],X2,Y2,q2,$2,K2,Q2,Nv,J2,eE,tE,rE;function Bk(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}Bk(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=wm();var nE={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Nk=0,zk=12,iE="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",Uk=(X2=(0,Yr.b2)(),Y2=(0,Yr.f3)(nr.MapConfig),q2=(0,Yr.f3)(nr.IGlobalConfigService),$2=(0,Yr.f3)(nr.ICoordinateSystemService),K2=(0,Yr.f3)(nr.IEventEmitter),X2(Q2=(Nv=function(){function e(){var a=this;(0,Zt.Z)(this,e),(0,re.Z)(this,"version",Uu.MAPBOX),(0,re.Z)(this,"simpleMapCoord",new Fk),(0,re.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),ka(this,"config",J2,this),ka(this,"configService",eE,this),ka(this,"coordinateSystemService",tE,this),ka(this,"eventEmitter",rE,this),(0,re.Z)(this,"handleCameraChanged",function(){var t=a.map.getCenter().wrap(),n=t.lat,r=t.lng;a.emit("mapchange"),a.viewport.syncWithMapCamera({bearing:a.map.getBearing(),center:[r,n],viewportHeight:a.map.transform.height,pitch:a.map.getPitch(),viewportWidth:a.map.transform.width,zoom:a.map.getZoom(),cameraHeight:0});var o=a.config.offsetZoom,u=o===void 0?zk:o;a.viewport.getZoom()>u?a.coordinateSystemService.setCoordinateSystem(Gp.LNGLAT_OFFSET):a.coordinateSystemService.setCoordinateSystem(Gp.LNGLAT),a.cameraChangedCallback(a.viewport)})}return(0,kt.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Mo("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){yS.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(nE[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(nE[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,n){this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},r=this.lngLatToMercator(t,0),o=r.x,u=r.y;return[o-n.x,u-n.y]}},{key:"lngLatToMercator",value:function(t,n){var r=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),o=r.x,u=o===void 0?0:o,h=r.y,v=h===void 0?0:h,m=r.z,b=m===void 0?0:m;return{x:u,y:v,z:b}}},{key:"getModelMatrix",value:function(t,n,r){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},h=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),v=h.meterInMercatorCoordinateUnits(),m=Wc();return mh(m,m,Ko.fromValues(h.x-u.x,h.y-u.y,h.z||0-u.z)),gh(m,m,Ko.fromValues(v*o[0],-v*o[1],v*o[2])),vd(m,m,r[0]),md(m,m,r[1]),zd(m,m,r[2]),m}},{key:"init",value:function(){var a=(0,_a.Z)(di().mark(function n(){var r,o,u,h,v,m,b,A,k,L,B,Z,V;return di().wrap(function(le){for(;;)switch(le.prev=le.next){case 0:r=this.config,o=r.id,u=o===void 0?"map":o,h=r.attributionControl,v=h===void 0?!1:h,m=r.style,b=m===void 0?"light":m,A=r.token,k=A===void 0?iE:A,L=r.rotation,B=L===void 0?0:L,Z=r.mapInstance,V=(0,ue.Z)(r,Dk),this.viewport=new Ok,!Z&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),k===iE&&b!=="blank"&&!window.mapboxgl.accessToken&&!Z&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Z&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=k),Z?(this.map=Z,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(u),this.map=new window.mapboxgl.Map((0,ae.Z)({container:this.$mapContainer,style:this.getMapStyle(b),attributionControl:v,bearing:B},V))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return le.stop()}},n,this)}));function t(){return a.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(n=this.eventEmitter).emit.apply(n,[t].concat(o))}},{key:"once",value:function(t){for(var n,r=arguments.length,o=new Array(r>1?r-1:0),u=1;u<r;u++)o[u-1]=arguments[u];(n=this.eventEmitter).once.apply(n,[t].concat(o))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,n){var r=new(wm()).LngLat(t[0],t[1]),o=new(wm()).LngLat(n[0],n[1]),u=r.distanceTo(o),h=wm().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),v=wm().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),m=h.x,b=h.y,A=v.x,k=v.y,L=Math.sqrt(Math.pow(m-A,2)+Math.pow(b-k,2))*4194304*2;return L/u}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),r=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return r}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,r.id="l7_mapbox_div"+Nk++,n.appendChild(r),r}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:W2[t]?W2[t]:t}}]),e}(),J2=Aa(Nv.prototype,"config",[Y2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eE=Aa(Nv.prototype,"configService",[q2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tE=Aa(Nv.prototype,"coordinateSystemService",[$2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rE=Aa(Nv.prototype,"eventEmitter",[K2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv))||Q2);function Zk(e){var a=Vk();return function(){var n=(0,Et.Z)(e),r;if(a){var o=(0,Et.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,Or.Z)(this,r)}}function Vk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function jk(e,a){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(a||(a=document),!!a)){var r=a.head||a.getElementsByTagName("head")[0];if(!r){r=a.createElement("head");var o=a.body||a.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(r,o):a.documentElement.appendChild(r)}var u=a.createElement("style");return u.type="text/css",u.styleSheet?u.styleSheet.cssText=e:u.appendChild(a.createTextNode(e)),r.appendChild(u),u}}jk(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Gk=function(e){(0,Pr.Z)(t,e);var a=Zk(t);function t(){return(0,Zt.Z)(this,t),a.apply(this,arguments)}return(0,kt.Z)(t,[{key:"getServiceConstructor",value:function(){return Uk}}]),t}(Sk);function aE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function oE(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?aE(Object(t),!0).forEach(function(n){Hk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):aE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Hk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function Wk(e,a){return $k(e)||qk(e,a)||Yk(e,a)||Xk()}function Xk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yk(e,a){if(!!e){if(typeof e=="string")return sE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return sE(e,a)}}function sE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function qk(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(v){o=!0,h=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function $k(e){if(Array.isArray(e))return e}var Kk=ge.memo(function(e){var a=e.style,t=e.className,n=e.map,r=e.option,o=e.onSceneLoaded,u=(0,ge.createRef)(),h=(0,ge.useState)(),v=Wk(h,2),m=v[0],b=v[1];return(0,ge.useEffect)(function(){var A=new yk(oE(oE({id:u.current},r),{},{map:new Gk(n)}));return A.on("loaded",function(){b(A),o&&o(A)}),function(){A.destroy()}},[]),(0,ge.useEffect)(function(){m&&n.style&&m.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ge.useEffect)(function(){m&&n.zoom&&m.setZoom(n.zoom)},[n.zoom]),(0,ge.useEffect)(function(){m&&n.center&&m.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ge.useEffect)(function(){m&&n.pitch!==void 0&&m.setPitch(n.pitch||0)},[n.pitch]),(0,ge.useEffect)(function(){m&&n.rotation&&m.setRotation(n.rotation)},[n.rotation]),ge.createElement(y.Provider,{value:m},(0,ge.createElement)("div",{ref:u,style:a,className:t},m&&e.children))}),Qk=Kk;function uE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function bR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?uE(Object(t),!0).forEach(function(n){Jk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):uE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Jk(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function ER(e,a){return nP(e)||rP(e,a)||tP(e,a)||eP()}function eP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tP(e,a){if(!!e){if(typeof e=="string")return lE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return lE(e,a)}}function lE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function rP(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(v){o=!0,h=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function nP(e){if(Array.isArray(e))return e}var CR=null,SR=null;function cE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function AR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?cE(Object(t),!0).forEach(function(n){iP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):cE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function iP(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function wR(e,a){return uP(e)||sP(e,a)||oP(e,a)||aP()}function aP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oP(e,a){if(!!e){if(typeof e=="string")return fE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fE(e,a)}}function fE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function sP(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(v){o=!0,h=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function uP(e){if(Array.isArray(e))return e}var TR=null,MR=null;function IR(e,a){return hP(e)||fP(e,a)||cP(e,a)||lP()}function lP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cP(e,a){if(!!e){if(typeof e=="string")return hE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hE(e,a)}}function hE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function fP(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(v){o=!0,h=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function hP(e){if(Array.isArray(e))return e}var kR=null,PR=null;function pE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function LR(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?pE(Object(t),!0).forEach(function(n){pP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function pP(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function RR(e,a){if(e==null)return{};var t=dP(e,a),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(a.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function dP(e,a){if(e==null)return{};var t={},n=Object.keys(e),r,o;for(o=0;o<n.length;o++)r=n[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var OR=null,dE=de(73935);function vE(e,a){return yP(e)||gP(e,a)||mP(e,a)||vP()}function vP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mP(e,a){if(!!e){if(typeof e=="string")return mE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return mE(e,a)}}function mE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function gP(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(v){o=!0,h=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function yP(e){if(Array.isArray(e))return e}var gE=ge.useEffect,yE=ge.useState,_P=/\B([A-Z])/g,xP=function(a){return a.replace(_P,"-$1").toLowerCase()};function FR(e){var a=e.className,t=e.style,n=e.children,r=e.position,o=yE(),u=vE(o,2),h=u[0],v=u[1],m=useSceneValue(),b=yE(function(){return document.createElement("div")}),A=vE(b,1),k=A[0];return gE(function(){var L=new Control({position:r});return L.onAdd=function(){if(a&&(k.className=a),t){var B=Object.keys(t).map(function(Z){return"".concat(xP(Z),":").concat(t[Z])}).join(";");k.style.cssText=B}return k},L.onRemove=function(){},v(L),m.addControl(L),function(){m.removeControl(L)}},[]),gE(function(){h&&h.setPosition(r||"bottomleft")},[r]),createPortal(n,k)}var _E=(0,ge.createContext)({});function DR(){return useContext(_E)}var BR=ge.useEffect,bP=ge.memo(function(a){var t=a.layer,n=a.active;return t.active(n.option),null},d.isEqual),NR=ge.useEffect,EP=ge.memo(function(a){var t=a.layer,n=a.animate;return t.animate(n),null},d.isEqual),zR=ge.useEffect,CP=ge.memo(function(a){var t=a.layer,n=a.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},d.isEqual),SP=ge.memo(function(a){var t=a.layer,n=a.filter;return n.field&&t.filter(n.field,n.values),null},d.isEqual),AP=ge.memo(function(a){var t=a.layer,n=a.scale;return t.scale(n.values),null},d.isEqual),UR=ge.useEffect,wP=ge.memo(function(a){var t=a.layer,n=a.select;return t.select(n.option),null},d.isEqual),TP=ge.memo(function(a){var t=a.layer,n=a.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},d.isEqual),MP=ge.memo(function(a){var t=a.layer,n=a.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},d.isEqual),IP=["data"];function kP(e,a){if(e==null)return{};var t=PP(e,a),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(a.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function PP(e,a){if(e==null)return{};var t={},n=Object.keys(e),r,o;for(o=0;o<n.length;o++)r=n[o],!(a.indexOf(r)>=0)&&(t[r]=e[r]);return t}var LP=ge.memo(function(a){var t=a.layer,n=a.source,r=n.data,o=kP(n,IP);return t.inited?t.setData(r,o):t.source(r,o),o.autoFit&&t.fitBounds(o&&o.fitBoundsOptions),null},d.isEqual),ZR=ge.useEffect,RP=ge.memo(function(a){var t=a.layer,n=a.style;return t.style(n),null},d.isEqual);function OP(e,a){return NP(e)||BP(e,a)||DP(e,a)||FP()}function FP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DP(e,a){if(!!e){if(typeof e=="string")return xE(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xE(e,a)}}function xE(e,a){(a==null||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function BP(e,a){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],r=!0,o=!1,u,h;try{for(t=t.call(e);!(r=(u=t.next()).done)&&(n.push(u.value),!(a&&n.length===a));r=!0);}catch(v){o=!0,h=v}finally{try{!r&&t.return!=null&&t.return()}finally{if(o)throw h}}return n}}function NP(e){if(Array.isArray(e))return e}var Mm=ge.useEffect,zP=ge.useState;function bE(e,a){var t=a.source,n=a.color,r=a.shape,o=a.style,u=a.size,h=a.scale,v=a.active,m=a.select,b=a.filter,A=a.animate,k=a.options,L=a.onLayerLoaded,B=Ne(),Z=zP(function(){var le;switch(e){case"polygonLayer":le=new yx(k);break;case"lineLayer":le=new YM(k);break;case"pointLayer":le=new H5(k);break;case"heatmapLayer":le=new KA(k);break;case"rasterLayer":le=new w4(k);break;case"imageLayer":le=new R1(k);break;case"citybuildingLayer":le=new EA(k);break;default:le=new yx(k)}return le.on("inited",function(){L&&L(le,B)}),le}),V=OP(Z,1),K=V[0];return Mm(function(){return B.addLayer(K),function(){B.removeLayer(K)}},[]),Mm(function(){K.inited&&k&&K.updateLayerConfig(k)},[k==null?void 0:k.minZoom,k==null?void 0:k.maxZoom,k==null?void 0:k.visible]),Mm(function(){K.inited&&(k==null?void 0:k.zIndex)&&K.setIndex(k.zIndex)},[k==null?void 0:k.zIndex]),Mm(function(){K.inited&&(k==null?void 0:k.blend)&&K.setBlend(k.blend)},[k==null?void 0:k.blend]),Mm(function(){B.render()}),ge.createElement(_E.Provider,{value:K},ge.createElement(LP,{layer:K,source:t}),h&&ge.createElement(AP,{layer:K,scale:h}),n&&ge.createElement(CP,{layer:K,color:n}),u&&ge.createElement(MP,{layer:K,size:u}),r&&ge.createElement(TP,{layer:K,shape:r}),o&&ge.createElement(RP,{layer:K,style:o}),v&&ge.createElement(bP,{layer:K,active:v}),m&&ge.createElement(wP,{layer:K,select:m}),b&&ge.createElement(SP,{layer:K,filter:b}),A&&ge.createElement(EP,{layer:K,animate:A}),a.children)}var VR=null,jR=null,UP=ge.memo(function(a){return bE("pointLayer",a)}),ZP=ge.memo(function(a){return bE("heatmapLayer",a)}),GR=null,HR=null,WR=null,XR=ge.useEffect,YR=null,qR=null;function Sg(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sg=function(t){return typeof t}:Sg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sg(e)}function EE(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,n)}return t}function Ag(e){for(var a=1;a<arguments.length;a++){var t=arguments[a]!=null?arguments[a]:{};a%2?EE(Object(t),!0).forEach(function(n){VP(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):EE(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function VP(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function jP(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function CE(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function GP(e,a,t){return a&&CE(e.prototype,a),t&&CE(e,t),e}function HP(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&Ny(e,a)}function Ny(e,a){return Ny=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},Ny(e,a)}function WP(e){var a=qP();return function(){var n=wg(e),r;if(a){var o=wg(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return XP(this,r)}}function XP(e,a){if(a&&(Sg(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return YP(e)}function YP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function qP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function wg(e){return wg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},wg(e)}var $R=function(e){HP(t,e);var a=WP(t);function t(n){var r;return jP(this,t),r=a.call(this,n),r.el=void 0,r.scene=void 0,r.popup=void 0,r.el=document.createElement("div"),r}return GP(t,[{key:"componentDidMount",value:function(){var r,o=this.props,u=o.lnglat,h=o.children,v=o.option,m=o.lngLat,b=new o1(Ag(Ag({},v),{},{stopPropagation:(r=this.props.option)===null||r===void 0?void 0:r.stopPropagation}));u&&b.setLnglat(u),m&&b.setLnglat(m),h&&b.setDOMContent(this.el),this.popup=b,this.scene.addPopup(b)}},{key:"componentDidUpdate",value:function(r){var o,u,h,v,m,b,A=Array.isArray(r.lnglat)?r.lnglat:[r==null||(o=r.lnglat)===null||o===void 0?void 0:o.lng,r==null||(u=r.lnglat)===null||u===void 0?void 0:u.lat],k=Array.isArray(this.props.lnglat)?this.props.lnglat:[(h=this.props)===null||h===void 0||(v=h.lnglat)===null||v===void 0?void 0:v.lng,(m=this.props)===null||m===void 0||(b=m.lnglat)===null||b===void 0?void 0:b.lat],L=A.toString()!==k.toString();if(L){var B;this.popup.remove(),this.popup=new o1(Ag(Ag({},this.props.option),{},{stopPropagation:(B=this.props.option)===null||B===void 0?void 0:B.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var r=this;return ge.createElement(y.Consumer,{},function(o){return o&&(r.scene=o),(0,dE.createPortal)(r.props.children,r.el)})}}]),t}(ge.PureComponent);function Tg(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Tg=function(t){return typeof t}:Tg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tg(e)}function $P(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}function SE(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function KP(e,a,t){return a&&SE(e.prototype,a),t&&SE(e,t),e}function QP(e,a){if(typeof a!="function"&&a!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),a&&zy(e,a)}function zy(e,a){return zy=Object.setPrototypeOf||function(n,r){return n.__proto__=r,n},zy(e,a)}function JP(e){var a=rL();return function(){var n=Mg(e),r;if(a){var o=Mg(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return eL(this,r)}}function eL(e,a){if(a&&(Tg(a)==="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tL(e)}function tL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function rL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Mg(e){return Mg=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Mg(e)}var KR=function(e){QP(t,e);var a=JP(t);function t(n){var r;return $P(this,t),r=a.call(this,n),r.el=void 0,r.scene=void 0,r.marker=void 0,r.el=document.createElement("div"),r}return KP(t,[{key:"componentDidMount",value:function(){var r=this.props,o=r.lnglat,u=r.children,h=r.option,v=r.onMarkerLoaded,m=new a1(h);o&&m.setLnglat(o),u&&m.setElement(this.el),this.marker=m,v&&v(m),this.scene.addMarker(m)}},{key:"componentDidUpdate",value:function(r){var o,u=(r==null?void 0:r.lnglat.toString())!==((o=this.props)===null||o===void 0?void 0:o.lnglat.toString());u&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var r=this;return ge.createElement(y.Consumer,{},function(o){return o&&(r.scene=o),(0,dE.createPortal)(r.props.children,r.el)})}}]),t}(ge.PureComponent),QR=ge.useEffect,JR=null,eO=null,tO=ge.useEffect,rO=null},75174:function(ci,Ae,de){var He=function(ge){"use strict";function y(_,w){var M=Object.keys(_);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(_);w&&(F=F.filter(function(N){return Object.getOwnPropertyDescriptor(_,N).enumerable})),M.push.apply(M,F)}return M}function Ne(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ne=function(){return _};var _={},w=Object.prototype,M=w.hasOwnProperty,F=typeof Symbol=="function"?Symbol:{},N=F.iterator||"@@iterator",ee=F.asyncIterator||"@@asyncIterator",pe=F.toStringTag||"@@toStringTag";function ue(Kr,ln,Di){return Object.defineProperty(Kr,ln,{value:Di,enumerable:!0,configurable:!0,writable:!0}),Kr[ln]}try{ue({},"")}catch(Kr){ue=function(ln,Di,Ha){return ln[Di]=Ha}}function Oe(Kr,ln,Di,Ha){var xa=ln&&ln.prototype instanceof Jt?ln:Jt,Ku=Object.create(xa.prototype),dl=new $a(Ha||[]);return Ku._invoke=function(ts,vl,ps){var Eh="suspendedStart";return function(mp,zu){if(Eh==="executing")throw new Error("Generator is already running");if(Eh==="completed"){if(mp==="throw")throw zu;return io()}for(ps.method=mp,ps.arg=zu;;){var rs=ps.delegate;if(rs){var Ol=Ei(rs,ps);if(Ol){if(Ol===Ve)continue;return Ol}}if(ps.method==="next")ps.sent=ps._sent=ps.arg;else if(ps.method==="throw"){if(Eh==="suspendedStart")throw Eh="completed",ps.arg;ps.dispatchException(ps.arg)}else ps.method==="return"&&ps.abrupt("return",ps.arg);Eh="executing";var Co=Ge(ts,vl,ps);if(Co.type==="normal"){if(Eh=ps.done?"completed":"suspendedYield",Co.arg===Ve)continue;return{value:Co.arg,done:ps.done}}Co.type==="throw"&&(Eh="completed",ps.method="throw",ps.arg=Co.arg)}}}(Kr,Di,dl),Ku}function Ge(Kr,ln,Di){try{return{type:"normal",arg:Kr.call(ln,Di)}}catch(Ha){return{type:"throw",arg:Ha}}}_.wrap=Oe;var Ve={};function Jt(){}function br(){}function Dr(){}var qr={};ue(qr,N,function(){return this});var kn=Object.getPrototypeOf,Cn=kn&&kn(kn(no([])));Cn&&Cn!==w&&M.call(Cn,N)&&(qr=Cn);var Dn=Dr.prototype=Jt.prototype=Object.create(qr);function dn(Kr){["next","throw","return"].forEach(function(ln){ue(Kr,ln,function(Di){return this._invoke(ln,Di)})})}function ai(Kr,ln){var Di;this._invoke=function(Ha,xa){function Ku(){return new ln(function(dl,ts){(function vl(ps,Eh,mp,zu){var rs=Ge(Kr[ps],Kr,Eh);if(rs.type!=="throw"){var Ol=rs.arg,Co=Ol.value;return Co&&typeof Co=="object"&&M.call(Co,"__await")?ln.resolve(Co.__await).then(function(Fl){vl("next",Fl,mp,zu)},function(Fl){vl("throw",Fl,mp,zu)}):ln.resolve(Co).then(function(Fl){Ol.value=Fl,mp(Ol)},function(Fl){return vl("throw",Fl,mp,zu)})}zu(rs.arg)})(Ha,xa,dl,ts)})}return Di=Di?Di.then(Ku,Ku):Ku()}}function Ei(Kr,ln){var Di=Kr.iterator[ln.method];if(Di===void 0){if(ln.delegate=null,ln.method==="throw"){if(Kr.iterator.return&&(ln.method="return",ln.arg=void 0,Ei(Kr,ln),ln.method==="throw"))return Ve;ln.method="throw",ln.arg=new TypeError("The iterator does not provide a 'throw' method")}return Ve}var Ha=Ge(Di,Kr.iterator,ln.arg);if(Ha.type==="throw")return ln.method="throw",ln.arg=Ha.arg,ln.delegate=null,Ve;var xa=Ha.arg;return xa?xa.done?(ln[Kr.resultName]=xa.value,ln.next=Kr.nextLoc,ln.method!=="return"&&(ln.method="next",ln.arg=void 0),ln.delegate=null,Ve):xa:(ln.method="throw",ln.arg=new TypeError("iterator result is not an object"),ln.delegate=null,Ve)}function Eo(Kr){var ln={tryLoc:Kr[0]};1 in Kr&&(ln.catchLoc=Kr[1]),2 in Kr&&(ln.finallyLoc=Kr[2],ln.afterLoc=Kr[3]),this.tryEntries.push(ln)}function ro(Kr){var ln=Kr.completion||{};ln.type="normal",delete ln.arg,Kr.completion=ln}function $a(Kr){this.tryEntries=[{tryLoc:"root"}],Kr.forEach(Eo,this),this.reset(!0)}function no(Kr){if(Kr){var ln=Kr[N];if(ln)return ln.call(Kr);if(typeof Kr.next=="function")return Kr;if(!isNaN(Kr.length)){var Di=-1,Ha=function xa(){for(;++Di<Kr.length;)if(M.call(Kr,Di))return xa.value=Kr[Di],xa.done=!1,xa;return xa.value=void 0,xa.done=!0,xa};return Ha.next=Ha}}return{next:io}}function io(){return{value:void 0,done:!0}}return br.prototype=Dr,ue(Dn,"constructor",Dr),ue(Dr,"constructor",br),br.displayName=ue(Dr,pe,"GeneratorFunction"),_.isGeneratorFunction=function(Kr){var ln=typeof Kr=="function"&&Kr.constructor;return!!ln&&(ln===br||(ln.displayName||ln.name)==="GeneratorFunction")},_.mark=function(Kr){return Object.setPrototypeOf?Object.setPrototypeOf(Kr,Dr):(Kr.__proto__=Dr,ue(Kr,pe,"GeneratorFunction")),Kr.prototype=Object.create(Dn),Kr},_.awrap=function(Kr){return{__await:Kr}},dn(ai.prototype),ue(ai.prototype,ee,function(){return this}),_.AsyncIterator=ai,_.async=function(Kr,ln,Di,Ha,xa){xa===void 0&&(xa=Promise);var Ku=new ai(Oe(Kr,ln,Di,Ha),xa);return _.isGeneratorFunction(ln)?Ku:Ku.next().then(function(dl){return dl.done?dl.value:Ku.next()})},dn(Dn),ue(Dn,pe,"Generator"),ue(Dn,N,function(){return this}),ue(Dn,"toString",function(){return"[object Generator]"}),_.keys=function(Kr){var ln=[];for(var Di in Kr)ln.push(Di);return ln.reverse(),function Ha(){for(;ln.length;){var xa=ln.pop();if(xa in Kr)return Ha.value=xa,Ha.done=!1,Ha}return Ha.done=!0,Ha}},_.values=no,$a.prototype={constructor:$a,reset:function(Kr){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(ro),!Kr)for(var ln in this)ln.charAt(0)==="t"&&M.call(this,ln)&&!isNaN(+ln.slice(1))&&(this[ln]=void 0)},stop:function(){this.done=!0;var Kr=this.tryEntries[0].completion;if(Kr.type==="throw")throw Kr.arg;return this.rval},dispatchException:function(Kr){if(this.done)throw Kr;var ln=this;function Di(vl,ps){return Ku.type="throw",Ku.arg=Kr,ln.next=vl,ps&&(ln.method="next",ln.arg=void 0),!!ps}for(var Ha=this.tryEntries.length-1;Ha>=0;--Ha){var xa=this.tryEntries[Ha],Ku=xa.completion;if(xa.tryLoc==="root")return Di("end");if(xa.tryLoc<=this.prev){var dl=M.call(xa,"catchLoc"),ts=M.call(xa,"finallyLoc");if(dl&&ts){if(this.prev<xa.catchLoc)return Di(xa.catchLoc,!0);if(this.prev<xa.finallyLoc)return Di(xa.finallyLoc)}else if(dl){if(this.prev<xa.catchLoc)return Di(xa.catchLoc,!0)}else{if(!ts)throw new Error("try statement without catch or finally");if(this.prev<xa.finallyLoc)return Di(xa.finallyLoc)}}}},abrupt:function(Kr,ln){for(var Di=this.tryEntries.length-1;Di>=0;--Di){var Ha=this.tryEntries[Di];if(Ha.tryLoc<=this.prev&&M.call(Ha,"finallyLoc")&&this.prev<Ha.finallyLoc){var xa=Ha;break}}xa&&(Kr==="break"||Kr==="continue")&&xa.tryLoc<=ln&&ln<=xa.finallyLoc&&(xa=null);var Ku=xa?xa.completion:{};return Ku.type=Kr,Ku.arg=ln,xa?(this.method="next",this.next=xa.finallyLoc,Ve):this.complete(Ku)},complete:function(Kr,ln){if(Kr.type==="throw")throw Kr.arg;return Kr.type==="break"||Kr.type==="continue"?this.next=Kr.arg:Kr.type==="return"?(this.rval=this.arg=Kr.arg,this.method="return",this.next="end"):Kr.type==="normal"&&ln&&(this.next=ln),Ve},finish:function(Kr){for(var ln=this.tryEntries.length-1;ln>=0;--ln){var Di=this.tryEntries[ln];if(Di.finallyLoc===Kr)return this.complete(Di.completion,Di.afterLoc),ro(Di),Ve}},catch:function(Kr){for(var ln=this.tryEntries.length-1;ln>=0;--ln){var Di=this.tryEntries[ln];if(Di.tryLoc===Kr){var Ha=Di.completion;if(Ha.type==="throw"){var xa=Ha.arg;ro(Di)}return xa}}throw new Error("illegal catch attempt")},delegateYield:function(Kr,ln,Di){return this.delegate={iterator:no(Kr),resultName:ln,nextLoc:Di},this.method==="next"&&(this.arg=void 0),Ve}},_}function Q(_,w,M,F,N,ee,pe){try{var ue=_[ee](pe),Oe=ue.value}catch(Ge){return void M(Ge)}ue.done?w(Oe):Promise.resolve(Oe).then(F,N)}function Pe(_){return function(){var w=this,M=arguments;return new Promise(function(F,N){var ee=_.apply(w,M);function pe(Oe){Q(ee,F,N,pe,ue,"next",Oe)}function ue(Oe){Q(ee,F,N,pe,ue,"throw",Oe)}pe(void 0)})}}function ve(_,w){if(!(_ instanceof w))throw new TypeError("Cannot call a class as a function")}function lt(_,w){for(var M=0;M<w.length;M++){var F=w[M];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(_,F.key,F)}}function we(_,w,M){return w&&lt(_.prototype,w),M&&lt(_,M),Object.defineProperty(_,"prototype",{writable:!1}),_}function We(_,w,M){return w in _?Object.defineProperty(_,w,{value:M,enumerable:!0,configurable:!0,writable:!0}):_[w]=M,_}function St(_,w){if(typeof w!="function"&&w!==null)throw new TypeError("Super expression must either be null or a function");_.prototype=Object.create(w&&w.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),Object.defineProperty(_,"prototype",{writable:!1}),w&&tr(_,w)}function Rt(_){return(Rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(w){return w.__proto__||Object.getPrototypeOf(w)})(_)}function tr(_,w){return(tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(M,F){return M.__proto__=F,M})(_,w)}function qt(_){if(_===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _}function Yt(_,w){if(w&&(typeof w=="object"||typeof w=="function"))return w;if(w!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qt(_)}function Sr(_){var w=function(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(M){return!1}}();return function(){var M,F=Rt(_);if(w){var N=Rt(this).constructor;M=Reflect.construct(F,arguments,N)}else M=F.apply(this,arguments);return Yt(this,M)}}function fr(_,w){return function(M){if(Array.isArray(M))return M}(_)||function(M,F){var N=M==null?null:typeof Symbol!="undefined"&&M[Symbol.iterator]||M["@@iterator"];if(N!=null){var ee,pe,ue=[],Oe=!0,Ge=!1;try{for(N=N.call(M);!(Oe=(ee=N.next()).done)&&(ue.push(ee.value),!F||ue.length!==F);Oe=!0);}catch(Ve){Ge=!0,pe=Ve}finally{try{Oe||N.return==null||N.return()}finally{if(Ge)throw pe}}return ue}}(_,w)||jt(_,w)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function It(_){return function(w){if(Array.isArray(w))return Rr(w)}(_)||function(w){if(typeof Symbol!="undefined"&&w[Symbol.iterator]!=null||w["@@iterator"]!=null)return Array.from(w)}(_)||jt(_)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function jt(_,w){if(_){if(typeof _=="string")return Rr(_,w);var M=Object.prototype.toString.call(_).slice(8,-1);return M==="Object"&&_.constructor&&(M=_.constructor.name),M==="Map"||M==="Set"?Array.from(_):M==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(M)?Rr(_,w):void 0}}function Rr(_,w){(w==null||w>_.length)&&(w=_.length);for(var M=0,F=new Array(w);M<w;M++)F[M]=_[M];return F}var ie=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof de.g!="undefined"?de.g:typeof self!="undefined"?self:{};function _r(_,w){return _(w={exports:{}},w.exports),w.exports}var Ot,yt,Qt=function(_){return _&&_.Math==Math&&_},Ue=Qt(typeof globalThis=="object"&&globalThis)||Qt(typeof window=="object"&&window)||Qt(typeof self=="object"&&self)||Qt(typeof ie=="object"&&ie)||function(){return this}()||Function("return this")(),Ar=Object.defineProperty,an=function(_,w){try{Ar(Ue,_,{value:w,configurable:!0,writable:!0})}catch(M){Ue[_]=w}return w},fe=Ue["__core-js_shared__"]||an("__core-js_shared__",{}),rt=_r(function(_){(_.exports=function(w,M){return fe[w]||(fe[w]=M!==void 0?M:{})})("versions",[]).push({version:"3.24.1",mode:"global",copyright:"\xA9 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.24.1/LICENSE",source:"https://github.com/zloirock/core-js"})}),X=function(_){try{return!!_()}catch(w){return!0}},ae=!X(function(){var _=function(){}.bind();return typeof _!="function"||_.hasOwnProperty("prototype")}),ze=Function.prototype,At=ze.bind,Ft=ze.call,ur=ae&&At.bind(Ft,Ft),Tt=ae?function(_){return _&&ur(_)}:function(_){return _&&function(){return Ft.apply(_,arguments)}},Br=TypeError,Bn=function(_){if(_==null)throw Br("Can't call method on "+_);return _},Sn=Object,Li=function(_){return Sn(Bn(_))},gi=Tt({}.hasOwnProperty),on=Object.hasOwn||function(_,w){return gi(Li(_),w)},Xa=0,ra=Math.random(),Vi=Tt(1 .toString),ga=function(_){return"Symbol("+(_===void 0?"":_)+")_"+Vi(++Xa+ra,36)},fi=function(_){return typeof _=="function"},$i=function(_){return fi(_)?_:void 0},hi=function(_,w){return arguments.length<2?$i(Ue[_]):Ue[_]&&Ue[_][w]},yi=hi("navigator","userAgent")||"",os=Ue.process,mo=Ue.Deno,Ya=os&&os.versions||mo&&mo.version,Pt=Ya&&Ya.v8;Pt&&(yt=(Ot=Pt.split("."))[0]>0&&Ot[0]<4?1:+(Ot[0]+Ot[1])),!yt&&yi&&(!(Ot=yi.match(/Edge\/(\d+)/))||Ot[1]>=74)&&(Ot=yi.match(/Chrome\/(\d+)/))&&(yt=+Ot[1]);var xe=yt,ce=!!Object.getOwnPropertySymbols&&!X(function(){var _=Symbol();return!String(_)||!(Object(_)instanceof Symbol)||!Symbol.sham&&xe&&xe<41}),Te=ce&&!Symbol.sham&&typeof Symbol.iterator=="symbol",j=rt("wks"),st=Ue.Symbol,ar=st&&st.for,Jr=Te?st:st&&st.withoutSetter||ga,tt=function(_){if(!on(j,_)||!ce&&typeof j[_]!="string"){var w="Symbol."+_;ce&&on(st,_)?j[_]=st[_]:j[_]=Te&&ar?ar(w):Jr(w)}return j[_]},Ut={};Ut[tt("toStringTag")]="z";var xr=String(Ut)==="[object z]",Cr=!X(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Lr=function(_){return typeof _=="object"?_!==null:fi(_)},vn=Ue.document,vi=Lr(vn)&&Lr(vn.createElement),ni=function(_){return vi?vn.createElement(_):{}},An=!Cr&&!X(function(){return Object.defineProperty(ni("div"),"a",{get:function(){return 7}}).a!=7}),Oi=Cr&&X(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),zi=String,Pa=TypeError,ia=function(_){if(Lr(_))return _;throw Pa(zi(_)+" is not an object")},ao=Function.prototype.call,Ci=ae?ao.bind(ao):function(){return ao.apply(ao,arguments)},da=Tt({}.isPrototypeOf),J=Object,se=Te?function(_){return typeof _=="symbol"}:function(_){var w=hi("Symbol");return fi(w)&&da(w.prototype,J(_))},_e=String,ke=function(_){try{return _e(_)}catch(w){return"Object"}},Ye=TypeError,ut=function(_){if(fi(_))return _;throw Ye(ke(_)+" is not a function")},xt=function(_,w){var M=_[w];return M==null?void 0:ut(M)},Ie=TypeError,nt=TypeError,Ht=tt("toPrimitive"),jr=function(_,w){if(!Lr(_)||se(_))return _;var M,F=xt(_,Ht);if(F){if(w===void 0&&(w="default"),M=Ci(F,_,w),!Lr(M)||se(M))return M;throw nt("Can't convert object to primitive value")}return w===void 0&&(w="number"),function(N,ee){var pe,ue;if(ee==="string"&&fi(pe=N.toString)&&!Lr(ue=Ci(pe,N))||fi(pe=N.valueOf)&&!Lr(ue=Ci(pe,N))||ee!=="string"&&fi(pe=N.toString)&&!Lr(ue=Ci(pe,N)))return ue;throw Ie("Can't convert object to primitive value")}(_,w)},ir=function(_){var w=jr(_,"string");return se(w)?w:w+""},pr=TypeError,Hr=Object.defineProperty,oi=Object.getOwnPropertyDescriptor,wn={f:Cr?Oi?function(_,w,M){if(ia(_),w=ir(w),ia(M),typeof _=="function"&&w==="prototype"&&"value"in M&&"writable"in M&&!M.writable){var F=oi(_,w);F&&F.writable&&(_[w]=M.value,M={configurable:"configurable"in M?M.configurable:F.configurable,enumerable:"enumerable"in M?M.enumerable:F.enumerable,writable:!1})}return Hr(_,w,M)}:Hr:function(_,w,M){if(ia(_),w=ir(w),ia(M),An)try{return Hr(_,w,M)}catch(F){}if("get"in M||"set"in M)throw pr("Accessors not supported");return"value"in M&&(_[w]=M.value),_}},rr=Function.prototype,Wn=Cr&&Object.getOwnPropertyDescriptor,Mr=on(rr,"name"),mn={EXISTS:Mr,PROPER:Mr&&function(){}.name==="something",CONFIGURABLE:Mr&&(!Cr||Cr&&Wn(rr,"name").configurable)},ea=Tt(Function.toString);fi(fe.inspectSource)||(fe.inspectSource=function(_){return ea(_)});var Zn,na,Zt,kt=fe.inspectSource,va=Ue.WeakMap,aa=fi(va)&&/native code/.test(kt(va)),Fi=function(_,w){return{enumerable:!(1&_),configurable:!(2&_),writable:!(4&_),value:w}},Mi=Cr?function(_,w,M){return wn.f(_,w,Fi(1,M))}:function(_,w,M){return _[w]=M,_},go=rt("keys"),Ba=function(_){return go[_]||(go[_]=ga(_))},Pr={},Or=Ue.TypeError,Et=Ue.WeakMap;if(aa||fe.state){var ss=fe.state||(fe.state=new Et),bt=Tt(ss.get),oo=Tt(ss.has),yu=Tt(ss.set);Zn=function(_,w){if(oo(ss,_))throw new Or("Object already initialized");return w.facade=_,yu(ss,_,w),w},na=function(_){return bt(ss,_)||{}},Zt=function(_){return oo(ss,_)}}else{var Qo=Ba("state");Pr[Qo]=!0,Zn=function(_,w){if(on(_,Qo))throw new Or("Object already initialized");return w.facade=_,Mi(_,Qo,w),w},na=function(_){return on(_,Qo)?_[Qo]:{}},Zt=function(_){return on(_,Qo)}}var Bi={set:Zn,get:na,has:Zt,enforce:function(_){return Zt(_)?na(_):Zn(_,{})},getterFor:function(_){return function(w){var M;if(!Lr(w)||(M=na(w)).type!==_)throw Or("Incompatible receiver, "+_+" required");return M}}},ml=_r(function(_){var w=mn.CONFIGURABLE,M=Bi.enforce,F=Bi.get,N=Object.defineProperty,ee=Cr&&!X(function(){return N(function(){},"length",{value:8}).length!==8}),pe=String(String).split("String"),ue=_.exports=function(Oe,Ge,Ve){String(Ge).slice(0,7)==="Symbol("&&(Ge="["+String(Ge).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),Ve&&Ve.getter&&(Ge="get "+Ge),Ve&&Ve.setter&&(Ge="set "+Ge),(!on(Oe,"name")||w&&Oe.name!==Ge)&&(Cr?N(Oe,"name",{value:Ge,configurable:!0}):Oe.name=Ge),ee&&Ve&&on(Ve,"arity")&&Oe.length!==Ve.arity&&N(Oe,"length",{value:Ve.arity});try{Ve&&on(Ve,"constructor")&&Ve.constructor?Cr&&N(Oe,"prototype",{writable:!1}):Oe.prototype&&(Oe.prototype=void 0)}catch(br){}var Jt=M(Oe);return on(Jt,"source")||(Jt.source=pe.join(typeof Ge=="string"?Ge:"")),Oe};Function.prototype.toString=ue(function(){return fi(this)&&F(this).source||kt(this)},"toString")}),Ra=function(_,w,M,F){F||(F={});var N=F.enumerable,ee=F.name!==void 0?F.name:w;if(fi(M)&&ml(M,ee,F),F.global)N?_[w]=M:an(w,M);else{try{F.unsafe?_[w]&&(N=!0):delete _[w]}catch(pe){}N?_[w]=M:wn.f(_,w,{value:M,enumerable:!1,configurable:!F.nonConfigurable,writable:!F.nonWritable})}return _},Lo=Tt({}.toString),Do=Tt("".slice),ba=function(_){return Do(Lo(_),8,-1)},Ps=tt("toStringTag"),Ls=Object,Ql=ba(function(){return arguments}())=="Arguments",fo=xr?ba:function(_){var w,M,F;return _===void 0?"Undefined":_===null?"Null":typeof(M=function(N,ee){try{return N[ee]}catch(pe){}}(w=Ls(_),Ps))=="string"?M:Ql?ba(w):(F=ba(w))=="Object"&&fi(w.callee)?"Arguments":F},ds=xr?{}.toString:function(){return"[object "+fo(this)+"]"};xr||Ra(Object.prototype,"toString",ds,{unsafe:!0});var Va={}.propertyIsEnumerable,Bo=Object.getOwnPropertyDescriptor,vs={f:Bo&&!Va.call({1:2},1)?function(_){var w=Bo(this,_);return!!w&&w.enumerable}:Va},No=Object,Qu=Tt("".split),Zu=X(function(){return!No("z").propertyIsEnumerable(0)})?function(_){return ba(_)=="String"?Qu(_,""):No(_)}:No,Vo=function(_){return Zu(Bn(_))},me=Object.getOwnPropertyDescriptor,De={f:Cr?me:function(_,w){if(_=Vo(_),w=ir(w),An)try{return me(_,w)}catch(M){}if(on(_,w))return Fi(!Ci(vs.f,_,w),_[w])}},_t=Math.ceil,lr=Math.floor,xn=Math.trunc||function(_){var w=+_;return(w>0?lr:_t)(w)},ti=function(_){var w=+_;return w!=w||w===0?0:xn(w)},ya=Math.max,jo=Math.min,Oa=function(_,w){var M=ti(_);return M<0?ya(M+w,0):jo(M,w)},zo=Math.min,So=function(_){return _>0?zo(ti(_),9007199254740991):0},so=function(_){return So(_.length)},Rs=function(_){return function(w,M,F){var N,ee=Vo(w),pe=so(ee),ue=Oa(F,pe);if(_&&M!=M){for(;pe>ue;)if((N=ee[ue++])!=N)return!0}else for(;pe>ue;ue++)if((_||ue in ee)&&ee[ue]===M)return _||ue||0;return!_&&-1}},eu={includes:Rs(!0),indexOf:Rs(!1)},su=eu.indexOf,_u=Tt([].push),Vu=function(_,w){var M,F=Vo(_),N=0,ee=[];for(M in F)!on(Pr,M)&&on(F,M)&&_u(ee,M);for(;w.length>N;)on(F,M=w[N++])&&(~su(ee,M)||_u(ee,M));return ee},xu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ro=xu.concat("length","prototype"),ha={f:Object.getOwnPropertyNames||function(_){return Vu(_,Ro)}},As={f:Object.getOwnPropertySymbols},Sh=Tt([].concat),Ju=hi("Reflect","ownKeys")||function(_){var w=ha.f(ia(_)),M=As.f;return M?Sh(w,M(_)):w},pf=function(_,w,M){for(var F=Ju(w),N=wn.f,ee=De.f,pe=0;pe<F.length;pe++){var ue=F[pe];on(_,ue)||M&&on(M,ue)||N(_,ue,ee(w,ue))}},Wf=/#|\.prototype\./,gl=function(_,w){var M=yl[Ac(_)];return M==E||M!=df&&(fi(w)?X(w):!!w)},Ac=gl.normalize=function(_){return String(_).replace(Wf,".").toLowerCase()},yl=gl.data={},df=gl.NATIVE="N",E=gl.POLYFILL="P",P=gl,G=De.f,D=function(_,w){var M,F,N,ee,pe,ue=_.target,Oe=_.global,Ge=_.stat;if(M=Oe?Ue:Ge?Ue[ue]||an(ue,{}):(Ue[ue]||{}).prototype)for(F in w){if(ee=w[F],N=_.dontCallGetSet?(pe=G(M,F))&&pe.value:M[F],!P(Oe?F:ue+(Ge?".":"#")+F,_.forced)&&N!==void 0){if(typeof ee==typeof N)continue;pf(ee,N)}(_.sham||N&&N.sham)&&Mi(ee,"sham",!0),Ra(M,F,ee,_)}},oe=ba(Ue.process)=="process",Fe=String,vt=TypeError,Mt=Object.setPrototypeOf||("__proto__"in{}?function(){var _,w=!1,M={};try{(_=Tt(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(M,[]),w=M instanceof Array}catch(F){}return function(F,N){return ia(F),function(ee){if(typeof ee=="object"||fi(ee))return ee;throw vt("Can't set "+Fe(ee)+" as a prototype")}(N),w?_(F,N):F.__proto__=N,F}}():void 0),Dt=wn.f,Nr=tt("toStringTag"),Xr=function(_,w,M){_&&!M&&(_=_.prototype),_&&!on(_,Nr)&&Dt(_,Nr,{configurable:!0,value:w})},Qn=tt("species"),Ki=function(_){var w=hi(_),M=wn.f;Cr&&w&&!w[Qn]&&M(w,Qn,{configurable:!0,get:function(){return this}})},ji=TypeError,pa=function(_,w){if(da(w,_))return _;throw ji("Incorrect invocation")},Ka=function(){},yo=[],wa=hi("Reflect","construct"),Xs=/^\s*(?:class|function)\b/,Bl=Tt(Xs.exec),Yc=!Xs.exec(Ka),qc=function(_){if(!fi(_))return!1;try{return wa(Ka,yo,_),!0}catch(w){return!1}},wc=function(_){if(!fi(_))return!1;switch(fo(_)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Yc||!!Bl(Xs,kt(_))}catch(w){return!0}};wc.sham=!0;var Tc,Mu,Nl,_l,Go=!wa||X(function(){var _;return qc(qc.call)||!qc(Object)||!qc(function(){_=!0})||_})?wc:qc,Ah=TypeError,wh=function(_){if(Go(_))return _;throw Ah(ke(_)+" is not a constructor")},bu=tt("species"),Yh=function(_,w){var M,F=ia(_).constructor;return F===void 0||(M=ia(F)[bu])==null?w:wh(M)},zl=Function.prototype,el=zl.apply,Ul=zl.call,xl=typeof Reflect=="object"&&Reflect.apply||(ae?Ul.bind(el):function(){return Ul.apply(el,arguments)}),lo=Tt(Tt.bind),tl=function(_,w){return ut(_),w===void 0?_:ae?lo(_,w):function(){return _.apply(w,arguments)}},Xf=hi("document","documentElement"),ju=Tt([].slice),xp=TypeError,e0=function(_,w){if(_<w)throw xp("Not enough arguments");return _},$p=/(?:ipad|iphone|ipod).*applewebkit/i.test(yi),Th=Ue.setImmediate,vf=Ue.clearImmediate,mf=Ue.process,Mc=Ue.Dispatch,gf=Ue.Function,Jl=Ue.MessageChannel,yf=Ue.String,ec=0,uu={};try{Tc=Ue.location}catch(_){}var Yf=function(_){if(on(uu,_)){var w=uu[_];delete uu[_],w()}},tc=function(_){return function(){Yf(_)}},qh=function(_){Yf(_.data)},Ic=function(_){Ue.postMessage(yf(_),Tc.protocol+"//"+Tc.host)};Th&&vf||(Th=function(_){e0(arguments.length,1);var w=fi(_)?_:gf(_),M=ju(arguments,1);return uu[++ec]=function(){xl(w,void 0,M)},Mu(ec),ec},vf=function(_){delete uu[_]},oe?Mu=function(_){mf.nextTick(tc(_))}:Mc&&Mc.now?Mu=function(_){Mc.now(tc(_))}:Jl&&!$p?(_l=(Nl=new Jl).port2,Nl.port1.onmessage=qh,Mu=tl(_l.postMessage,_l)):Ue.addEventListener&&fi(Ue.postMessage)&&!Ue.importScripts&&Tc&&Tc.protocol!=="file:"&&!X(Ic)?(Mu=Ic,Ue.addEventListener("message",qh,!1)):Mu="onreadystatechange"in ni("script")?function(_){Xf.appendChild(ni("script")).onreadystatechange=function(){Xf.removeChild(this),Yf(_)}}:function(_){setTimeout(tc(_),0)});var rc,rl,_f,kc,bp,xf,nc,$h,bf={set:Th,clear:vf},Ef=/ipad|iphone|ipod/i.test(yi)&&Ue.Pebble!==void 0,Kp=/web0s(?!.*chrome)/i.test(yi),Qp=De.f,Mh=bf.set,$c=Ue.MutationObserver||Ue.WebKitMutationObserver,Eu=Ue.document,Kc=Ue.process,Ui=Ue.Promise,Cf=Qp(Ue,"queueMicrotask"),Sf=Cf&&Cf.value;Sf||(rc=function(){var _,w;for(oe&&(_=Kc.domain)&&_.exit();rl;){w=rl.fn,rl=rl.next;try{w()}catch(M){throw rl?kc():_f=void 0,M}}_f=void 0,_&&_.enter()},$p||oe||Kp||!$c||!Eu?!Ef&&Ui&&Ui.resolve?((nc=Ui.resolve(void 0)).constructor=Ui,$h=tl(nc.then,nc),kc=function(){$h(rc)}):oe?kc=function(){Kc.nextTick(rc)}:(Mh=tl(Mh,Ue),kc=function(){Mh(rc)}):(bp=!0,xf=Eu.createTextNode(""),new $c(rc).observe(xf,{characterData:!0}),kc=function(){xf.data=bp=!bp}));var bl=Sf||function(_){var w={fn:_,next:void 0};_f&&(_f.next=w),rl||(rl=w,kc()),_f=w},Sa=function(_){try{return{error:!1,value:_()}}catch(w){return{error:!0,value:w}}},_o=function(){this.head=null,this.tail=null};_o.prototype={add:function(_){var w={item:_,next:null};this.head?this.tail.next=w:this.head=w,this.tail=w},get:function(){var _=this.head;if(_)return this.head=_.next,this.tail===_&&(this.tail=null),_.item}};var lu,Mo,Iu,Zl=_o,cu=Ue.Promise,Jp=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",qf=!Jp&&!oe&&typeof window=="object"&&typeof document=="object",Af=(cu&&cu.prototype,tt("species")),Vl=!1,ms=fi(Ue.PromiseRejectionEvent),nl={CONSTRUCTOR:P("Promise",function(){var _=kt(cu),w=_!==String(cu);if(!w&&xe===66)return!0;if(!xe||xe<51||!/native code/.test(_)){var M=new cu(function(N){N(1)}),F=function(N){N(function(){},function(){})};if((M.constructor={})[Af]=F,!(Vl=M.then(function(){})instanceof F))return!0}return!w&&(qf||Jp)&&!ms}),REJECTION_EVENT:ms,SUBCLASSING:Vl},$f=function(_){var w,M;this.promise=new _(function(F,N){if(w!==void 0||M!==void 0)throw TypeError("Bad Promise constructor");w=F,M=N}),this.resolve=ut(w),this.reject=ut(M)},Ho={f:function(_){return new $f(_)}},ri=bf.set,ma=nl.CONSTRUCTOR,Pc=nl.REJECTION_EVENT,wf=nl.SUBCLASSING,ku=Bi.getterFor("Promise"),Pu=Bi.set,Lc=cu&&cu.prototype,Tn=cu,Rc=Lc,Ih=Ue.TypeError,_a=Ue.document,ho=Ue.process,fu=Ho.f,kh=fu,il=!!(_a&&_a.createEvent&&Ue.dispatchEvent),tu=function(_){var w;return!(!Lr(_)||!fi(w=_.then))&&w},jl=function(_,w){var M,F,N,ee=w.value,pe=w.state==1,ue=pe?_.ok:_.fail,Oe=_.resolve,Ge=_.reject,Ve=_.domain;try{ue?(pe||(w.rejection===2&&al(w),w.rejection=1),ue===!0?M=ee:(Ve&&Ve.enter(),M=ue(ee),Ve&&(Ve.exit(),N=!0)),M===_.promise?Ge(Ih("Promise-chain cycle")):(F=tu(M))?Ci(F,M,Oe,Ge):Oe(M)):Ge(ee)}catch(Jt){Ve&&!N&&Ve.exit(),Ge(Jt)}},di=function(_,w){_.notified||(_.notified=!0,bl(function(){for(var M,F=_.reactions;M=F.get();)jl(M,_);_.notified=!1,w&&!_.rejection&&Ep(_)}))},Kf=function(_,w,M){var F,N;il?((F=_a.createEvent("Event")).promise=w,F.reason=M,F.initEvent(_,!1,!0),Ue.dispatchEvent(F)):F={promise:w,reason:M},!Pc&&(N=Ue["on"+_])?N(F):_==="unhandledrejection"&&function(ee,pe){var ue=Ue.console;ue&&ue.error&&(arguments.length==1?ue.error(ee):ue.error(ee,pe))}("Unhandled promise rejection",M)},Ep=function(_){Ci(ri,Ue,function(){var w,M=_.facade,F=_.value;if(Cp(_)&&(w=Sa(function(){oe?ho.emit("unhandledRejection",F,M):Kf("unhandledrejection",M,F)}),_.rejection=oe||Cp(_)?2:1,w.error))throw w.value})},Cp=function(_){return _.rejection!==1&&!_.parent},al=function(_){Ci(ri,Ue,function(){var w=_.facade;oe?ho.emit("rejectionHandled",w):Kf("rejectionhandled",w,_.value)})},Ys=function(_,w,M){return function(F){_(w,F,M)}},la=function(_,w,M){_.done||(_.done=!0,M&&(_=M),_.value=w,_.state=2,di(_,!0))},El=function(_,w,M){if(!_.done){_.done=!0,M&&(_=M);try{if(_.facade===w)throw Ih("Promise can't be resolved itself");var F=tu(w);F?bl(function(){var N={done:!1};try{Ci(F,w,Ys(El,N,_),Ys(la,N,_))}catch(ee){la(N,ee,_)}}):(_.value=w,_.state=1,di(_,!1))}catch(N){la({done:!1},N,_)}}};if(ma&&(Rc=(Tn=function(_){pa(this,Rc),ut(_),Ci(lu,this);var w=ku(this);try{_(Ys(El,w),Ys(la,w))}catch(M){la(w,M)}}).prototype,(lu=function(_){Pu(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new Zl,rejection:!1,state:0,value:void 0})}).prototype=Ra(Rc,"then",function(_,w){var M=ku(this),F=fu(Yh(this,Tn));return M.parent=!0,F.ok=!fi(_)||_,F.fail=fi(w)&&w,F.domain=oe?ho.domain:void 0,M.state==0?M.reactions.add(F):bl(function(){jl(F,M)}),F.promise}),Mo=function(){var _=new lu,w=ku(_);this.promise=_,this.resolve=Ys(El,w),this.reject=Ys(la,w)},Ho.f=fu=function(_){return _===Tn||_===void 0?new Mo(_):kh(_)},fi(cu)&&Lc!==Object.prototype)){Iu=Lc.then,wf||Ra(Lc,"then",function(_,w){var M=this;return new Tn(function(F,N){Ci(Iu,M,F,N)}).then(_,w)},{unsafe:!0});try{delete Lc.constructor}catch(_){}Mt&&Mt(Lc,Rc)}D({global:!0,constructor:!0,wrap:!0,forced:ma},{Promise:Tn}),Xr(Tn,"Promise",!1),Ki("Promise");var hu={},ws=tt("iterator"),Tf=Array.prototype,Gl=function(_){return _!==void 0&&(hu.Array===_||Tf[ws]===_)},ol=tt("iterator"),pu=function(_){if(_!=null)return xt(_,ol)||xt(_,"@@iterator")||hu[fo(_)]},sl=TypeError,_i=function(_,w){var M=arguments.length<2?pu(_):w;if(ut(M))return ia(Ci(M,_));throw sl(ke(_)+" is not iterable")},pi=function(_,w,M){var F,N;ia(_);try{if(!(F=xt(_,"return"))){if(w==="throw")throw M;return M}F=Ci(F,_)}catch(ee){N=!0,F=ee}if(w==="throw")throw M;if(N)throw F;return ia(F),M},Mf=TypeError,Os=function(_,w){this.stopped=_,this.result=w},ul=Os.prototype,Yo=function(_,w,M){var F,N,ee,pe,ue,Oe,Ge,Ve=M&&M.that,Jt=!(!M||!M.AS_ENTRIES),br=!(!M||!M.IS_RECORD),Dr=!(!M||!M.IS_ITERATOR),qr=!(!M||!M.INTERRUPTED),kn=tl(w,Ve),Cn=function(dn){return F&&pi(F,"normal",dn),new Os(!0,dn)},Dn=function(dn){return Jt?(ia(dn),qr?kn(dn[0],dn[1],Cn):kn(dn[0],dn[1])):qr?kn(dn,Cn):kn(dn)};if(br)F=_.iterator;else if(Dr)F=_;else{if(!(N=pu(_)))throw Mf(ke(_)+" is not iterable");if(Gl(N)){for(ee=0,pe=so(_);pe>ee;ee++)if((ue=Dn(_[ee]))&&da(ul,ue))return ue;return new Os(!1)}F=_i(_,N)}for(Oe=br?_.next:F.next;!(Ge=Ci(Oe,F)).done;){try{ue=Dn(Ge.value)}catch(dn){pi(F,"throw",dn)}if(typeof ue=="object"&&ue&&da(ul,ue))return ue}return new Os(!1)},Lu=tt("iterator"),Ph=!1;try{var Qf=0,Qa={next:function(){return{done:!!Qf++}},return:function(){Ph=!0}};Qa[Lu]=function(){return this},Array.from(Qa,function(){throw 2})}catch(_){}var po=function(_,w){if(!w&&!Ph)return!1;var M=!1;try{var F={};F[Lu]=function(){return{next:function(){return{done:M=!0}}}},_(F)}catch(N){}return M},Jf=nl.CONSTRUCTOR||!po(function(_){cu.all(_).then(void 0,function(){})});D({target:"Promise",stat:!0,forced:Jf},{all:function(_){var w=this,M=Ho.f(w),F=M.resolve,N=M.reject,ee=Sa(function(){var pe=ut(w.resolve),ue=[],Oe=0,Ge=1;Yo(_,function(Ve){var Jt=Oe++,br=!1;Ge++,Ci(pe,w,Ve).then(function(Dr){br||(br=!0,ue[Jt]=Dr,--Ge||F(ue))},N)}),--Ge||F(ue)});return ee.error&&N(ee.value),M.promise}});var eh=nl.CONSTRUCTOR,Cl=cu&&cu.prototype;if(D({target:"Promise",proto:!0,forced:eh,real:!0},{catch:function(_){return this.then(void 0,_)}}),fi(cu)){var Sl=hi("Promise").prototype.catch;Cl.catch!==Sl&&Ra(Cl,"catch",Sl,{unsafe:!0})}D({target:"Promise",stat:!0,forced:Jf},{race:function(_){var w=this,M=Ho.f(w),F=M.reject,N=Sa(function(){var ee=ut(w.resolve);Yo(_,function(pe){Ci(ee,w,pe).then(M.resolve,F)})});return N.error&&F(N.value),M.promise}}),D({target:"Promise",stat:!0,forced:nl.CONSTRUCTOR},{reject:function(_){var w=Ho.f(this);return Ci(w.reject,void 0,_),w.promise}});var Fs=nl.CONSTRUCTOR;hi("Promise");function Ao(_,w){if(!_)throw new Error(w||"web worker helper assertion failed.")}D({target:"Promise",stat:!0,forced:Fs},{resolve:function(_){return function(w,M){if(ia(w),Lr(M)&&M.constructor===w)return M;var F=Ho.f(w);return(0,F.resolve)(M),F.promise}(this,_)}});var ic=typeof window!="undefined"&&window.orientation!==void 0,Kh=function(){function _(w,M){var F=this;this.name=w,this.workerThread=M,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(N,ee){F.resolve=N,F.reject=ee})}return _.prototype.postMessage=function(w,M){this.workerThread.postMessage({source:"Main thread",type:w,payload:M})},_.prototype.done=function(w){Ao(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(w)},_.prototype.error=function(w){Ao(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(w)},_}(),Qc=new Map;function th(_){Ao(_.source&&!_.url||!_.source&&_.url);var w=Qc.get(_.source||_.url);return w||(_.url&&(w=function(M){if(!M.startsWith("http"))return M;return Qh((F=M,`try {
  importScripts('`+F+`');
} catch (error) {
  console.error(error);
  throw error;
}`));var F}(_.url),Qc.set(_.url,w)),_.source&&(w=Qh(_.source),Qc.set(_.source,w))),Ao(w),w}function Qh(_){var w=new Blob([_],{type:"application/javascript"});return URL.createObjectURL(w)}function ll(_,w,M){w===void 0&&(w=!0);var F=M||new Set;if(_){if(ac(_))F.add(_);else if(ac(_.buffer))F.add(_.buffer);else if(!ArrayBuffer.isView(_)){if(w&&typeof _=="object")for(var N in _)ll(_[N],w,F)}}return M===void 0?Array.from(F):[]}function ac(_){return!!_&&(_ instanceof ArrayBuffer||typeof MessagePort!="undefined"&&_ instanceof MessagePort||typeof ImageBitmap!="undefined"&&_ instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&_ instanceof OffscreenCanvas)}var Jc=function(){},oc=function(){function _(w){this.terminated=!1,this.loadableURL="";var M=w.name,F=w.source,N=w.url;Ao(F||N),this.name=M,this.source=F,this.url=N,this.onMessage=Jc,this.onError=function(ee){return console.log(ee)},this.worker=this.createBrowserWorker()}return _.isSupported=function(){return typeof Worker!="undefined"},_.prototype.destroy=function(){this.onMessage=Jc,this.onError=Jc,this.worker.terminate(),this.terminated=!0},Object.defineProperty(_.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),_.prototype.postMessage=function(w,M){M=M||ll(w),this.worker.postMessage(w,M)},_.prototype.getErrorFromErrorEvent=function(w){var M="Failed to load ";return M+="worker "+this.name+" from "+this.url+". ",w.message&&(M+=w.message+" in "),w.lineno&&(M+=":"+w.lineno+":"+w.colno),new Error(M)},_.prototype.createBrowserWorker=function(){var w=this;this.loadableURL=th({source:this.source,url:this.url});var M=new Worker(this.loadableURL,{name:this.name});return M.onmessage=function(F){F.data?w.onMessage(F.data):w.onError(new Error("No data received"))},M.onerror=function(F){w.onError(w.getErrorFromErrorEvent(F)),w.terminated=!0},M.onmessageerror=function(F){return console.error("worker "+w.name+", message error: "+F)},M},_}(),Hl=self&&self.__assign||function(){return(Hl=Object.assign||function(_){for(var w,M=1,F=arguments.length;M<F;M++)for(var N in w=arguments[M])Object.prototype.hasOwnProperty.call(w,N)&&(_[N]=w[N]);return _}).apply(this,arguments)},Lh=self&&self.__awaiter||function(_,w,M,F){return new(M||(M=Promise))(function(N,ee){function pe(Ge){try{Oe(F.next(Ge))}catch(Ve){ee(Ve)}}function ue(Ge){try{Oe(F.throw(Ge))}catch(Ve){ee(Ve)}}function Oe(Ge){var Ve;Ge.done?N(Ge.value):(Ve=Ge.value,Ve instanceof M?Ve:new M(function(Jt){Jt(Ve)})).then(pe,ue)}Oe((F=F.apply(_,w||[])).next())})},sc=self&&self.__generator||function(_,w){var M,F,N,ee,pe={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return ee={next:ue(0),throw:ue(1),return:ue(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function ue(Oe){return function(Ge){return function(Ve){if(M)throw new TypeError("Generator is already executing.");for(;pe;)try{if(M=1,F&&(N=2&Ve[0]?F.return:Ve[0]?F.throw||((N=F.return)&&N.call(F),0):F.next)&&!(N=N.call(F,Ve[1])).done)return N;switch(F=0,N&&(Ve=[2&Ve[0],N.value]),Ve[0]){case 0:case 1:N=Ve;break;case 4:return pe.label++,{value:Ve[1],done:!1};case 5:pe.label++,F=Ve[1],Ve=[0];continue;case 7:Ve=pe.ops.pop(),pe.trys.pop();continue;default:if(N=pe.trys,!((N=N.length>0&&N[N.length-1])||Ve[0]!==6&&Ve[0]!==2)){pe=0;continue}if(Ve[0]===3&&(!N||Ve[1]>N[0]&&Ve[1]<N[3])){pe.label=Ve[1];break}if(Ve[0]===6&&pe.label<N[1]){pe.label=N[1],N=Ve;break}if(N&&pe.label<N[2]){pe.label=N[2],pe.ops.push(Ve);break}N[2]&&pe.ops.pop(),pe.trys.pop();continue}Ve=w.call(_,pe)}catch(Jt){Ve=[6,Jt],F=0}finally{M=N=0}if(5&Ve[0])throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}([Oe,Ge])}}},Al=function(){function _(w){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=w.source,this.url=w.url,this.setProps(w)}return _.prototype.destroy=function(){this.idleQueue.forEach(function(w){return w.destroy()}),this.isDestroyed=!0},_.prototype.setProps=function(w){this.props=Hl(Hl({},this.props),w),w.name!==void 0&&(this.name=w.name),w.maxConcurrency!==void 0&&(this.maxConcurrency=w.maxConcurrency),w.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=w.maxMobileConcurrency),w.reuseWorkers!==void 0&&(this.reuseWorkers=w.reuseWorkers),w.onDebug!==void 0&&(this.onDebug=w.onDebug)},_.prototype.startJob=function(w,M,F){return M===void 0&&(M=function(N,ee,pe){return N.done(pe)}),F===void 0&&(F=function(N,ee){return N.error(ee)}),Lh(this,void 0,void 0,function(){var N,ee=this;return sc(this,function(pe){switch(pe.label){case 0:return N=new Promise(function(ue){return ee.jobQueue.push({name:w,onMessage:M,onError:F,onStart:ue}),ee}),this.startQueuedJob(),[4,N];case 1:return[2,pe.sent()]}})})},_.prototype.startQueuedJob=function(){return Lh(this,void 0,void 0,function(){var w,M,F;return sc(this,function(N){switch(N.label){case 0:if(!this.jobQueue.length)return[2];if(!(w=this.getAvailableWorker()))return[2];if(!(M=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:M.name,backlog:this.jobQueue.length,workerThread:w}),F=new Kh(M.name,w),w.onMessage=function(ee){return M.onMessage(F,ee.type,ee.payload)},w.onError=function(ee){return M.onError(F,ee)},M.onStart(F),N.label=1;case 1:return N.trys.push([1,,3,4]),[4,F.result];case 2:return N.sent(),[3,4];case 3:return this.returnWorkerToQueue(w),[7];case 4:return[2]}})})},_.prototype.returnWorkerToQueue=function(w){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(w.destroy(),this.count--):this.idleQueue.push(w),this.isDestroyed||this.startQueuedJob()},_.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var w=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new oc({name:w,source:this.source,url:this.url})}return null},_.prototype.getMaxConcurrency=function(){return ic?this.maxMobileConcurrency:this.maxConcurrency},_}(),If=self&&self.__assign||function(){return(If=Object.assign||function(_){for(var w,M=1,F=arguments.length;M<F;M++)for(var N in w=arguments[M])Object.prototype.hasOwnProperty.call(w,N)&&(_[N]=w[N]);return _}).apply(this,arguments)},Rh=self&&self.__values||function(_){var w=typeof Symbol=="function"&&Symbol.iterator,M=w&&_[w],F=0;if(M)return M.call(_);if(_&&typeof _.length=="number")return{next:function(){return _&&F>=_.length&&(_=void 0),{value:_&&_[F++],done:!_}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")},Gu={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ef=(function(){function _(w){this.workerPools=new Map,this.props=If({},Gu),this.setProps(w),this.workerPools=new Map}_.isSupported=function(){return oc.isSupported()},_.getWorkerFarm=function(w){return w===void 0&&(w={}),_.workerFarm=_.workerFarm||new _({}),_.workerFarm.setProps(w),_.workerFarm},_.prototype.destroy=function(){var w,M;try{for(var F=Rh(this.workerPools.values()),N=F.next();!N.done;N=F.next())N.value.destroy()}catch(ee){w={error:ee}}finally{try{N&&!N.done&&(M=F.return)&&M.call(F)}finally{if(w)throw w.error}}},_.prototype.setProps=function(w){var M,F;this.props=If(If({},this.props),w);try{for(var N=Rh(this.workerPools.values()),ee=N.next();!ee.done;ee=N.next())ee.value.setProps(this.getWorkerPoolProps())}catch(pe){M={error:pe}}finally{try{ee&&!ee.done&&(F=N.return)&&F.call(N)}finally{if(M)throw M.error}}},_.prototype.getWorkerPool=function(w){var M=w.name,F=w.source,N=w.url,ee=this.workerPools.get(M);return ee||((ee=new Al({name:M,source:F,url:N})).setProps(this.getWorkerPoolProps()),this.workerPools.set(M,ee)),ee},_.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),c=function(){function _(){}return Object.defineProperty(_,"onmessage",{set:function(w){self.onmessage=function(M){if(p(M)){var F=M.data,N=F.type,ee=F.payload;w(N,ee)}}},enumerable:!1,configurable:!0}),_.addEventListener=function(w){var M=ef.get(w);M||(M=function(F){if(p(F)){var N=F.data,ee=N.type,pe=N.payload;w(ee,pe)}}),self.addEventListener("message",M)},_.removeEventListener=function(w){var M=ef.get(w);ef.delete(w),self.removeEventListener("message",M)},_.postMessage=function(w,M){if(self){var F={source:"Worker thread",type:w,payload:M},N=ll(M);self.postMessage(F,N)}},_}();function p(_){var w=_.type,M=_.data;return w==="message"&&M&&typeof M.source=="string"&&M.source==="Main thread"}self&&self.__awaiter,self&&self.__generator;var f,g,S=function(){function _(){this._values=[],this._settlers=[],this._closed=!1}return _.prototype[Symbol.asyncIterator]=function(){return this},_.prototype.push=function(w){return this.enqueue(w)},_.prototype.enqueue=function(w){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var M=this._settlers.shift();w instanceof Error?M.reject(w):M.resolve({value:w})}else this._values.push(w)},_.prototype.close=function(){for(;this._settlers.length>0;)this._settlers.shift().resolve({done:!0});this._closed=!0},_.prototype.next=function(){var w=this;if(this._values.length>0){var M=this._values.shift();return M instanceof Error?Promise.reject(M):Promise.resolve({done:!1,value:M})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(F,N){w._settlers.push({resolve:F,reject:N})})},_}(),I=self&&self.__awaiter||function(_,w,M,F){return new(M||(M=Promise))(function(N,ee){function pe(Ge){try{Oe(F.next(Ge))}catch(Ve){ee(Ve)}}function ue(Ge){try{Oe(F.throw(Ge))}catch(Ve){ee(Ve)}}function Oe(Ge){var Ve;Ge.done?N(Ge.value):(Ve=Ge.value,Ve instanceof M?Ve:new M(function(Jt){Jt(Ve)})).then(pe,ue)}Oe((F=F.apply(_,w||[])).next())})},R=self&&self.__generator||function(_,w){var M,F,N,ee,pe={label:0,sent:function(){if(1&N[0])throw N[1];return N[1]},trys:[],ops:[]};return ee={next:ue(0),throw:ue(1),return:ue(2)},typeof Symbol=="function"&&(ee[Symbol.iterator]=function(){return this}),ee;function ue(Oe){return function(Ge){return function(Ve){if(M)throw new TypeError("Generator is already executing.");for(;pe;)try{if(M=1,F&&(N=2&Ve[0]?F.return:Ve[0]?F.throw||((N=F.return)&&N.call(F),0):F.next)&&!(N=N.call(F,Ve[1])).done)return N;switch(F=0,N&&(Ve=[2&Ve[0],N.value]),Ve[0]){case 0:case 1:N=Ve;break;case 4:return pe.label++,{value:Ve[1],done:!1};case 5:pe.label++,F=Ve[1],Ve=[0];continue;case 7:Ve=pe.ops.pop(),pe.trys.pop();continue;default:if(N=pe.trys,!((N=N.length>0&&N[N.length-1])||Ve[0]!==6&&Ve[0]!==2)){pe=0;continue}if(Ve[0]===3&&(!N||Ve[1]>N[0]&&Ve[1]<N[3])){pe.label=Ve[1];break}if(Ve[0]===6&&pe.label<N[1]){pe.label=N[1],N=Ve;break}if(N&&pe.label<N[2]){pe.label=N[2],pe.ops.push(Ve);break}N[2]&&pe.ops.pop(),pe.trys.pop();continue}Ve=w.call(_,pe)}catch(Jt){Ve=[6,Jt],F=0}finally{M=N=0}if(5&Ve[0])throw Ve[1];return{value:Ve[0]?Ve[1]:void 0,done:!0}}([Oe,Ge])}}},z=self&&self.__asyncValues||function(_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var w,M=_[Symbol.asyncIterator];return M?M.call(_):(_=typeof __values=="function"?__values(_):_[Symbol.iterator](),w={},F("next"),F("throw"),F("return"),w[Symbol.asyncIterator]=function(){return this},w);function F(N){w[N]=_[N]&&function(ee){return new Promise(function(pe,ue){(function(Oe,Ge,Ve,Jt){Promise.resolve(Jt).then(function(br){Oe({value:br,done:Ve})},Ge)})(pe,ue,(ee=_[N](ee)).done,ee.value)})}}},q=0;function ne(_,w){var M=this;if(typeof self!="undefined"){var F={process:Se};c.onmessage=function(N,ee){return I(M,void 0,void 0,function(){var pe,ue,Oe,Ge,Ve,Jt,br,Dr,qr,kn;return R(this,function(Cn){switch(Cn.label){case 0:switch(Cn.trys.push([0,19,,20]),N){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!_)throw new Error("Worker does not support atomic processing");return[4,_(ee.input,ee.options||{},F)];case 2:return pe=Cn.sent(),c.postMessage("done",{result:pe}),[3,18];case 3:if(!w)throw new Error("Worker does not support batched processing");f=new S,g=ee.options||{},ue=w(f,g,F),Cn.label=4;case 4:Cn.trys.push([4,9,10,15]),Oe=z(ue),Cn.label=5;case 5:return[4,Oe.next()];case 6:if((Ge=Cn.sent()).done)return[3,8];Ve=Ge.value,c.postMessage("output-batch",{result:Ve}),Cn.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return Jt=Cn.sent(),qr={error:Jt},[3,15];case 10:return Cn.trys.push([10,,13,14]),Ge&&!Ge.done&&(kn=Oe.return)?[4,kn.call(Oe)]:[3,12];case 11:Cn.sent(),Cn.label=12;case 12:return[3,14];case 13:if(qr)throw qr.error;return[7];case 14:return[7];case 15:return c.postMessage("done",{}),[3,18];case 16:return f.push(ee.input),[3,18];case 17:return f.close(),[3,18];case 18:return[3,20];case 19:return br=Cn.sent(),Dr=br instanceof Error?br.message:"",c.postMessage("error",{error:Dr}),[3,20];case 20:return[2]}})})}}}function Se(_,w){return w===void 0&&(w={}),new Promise(function(M,F){var N=q++,ee=function(ue,Oe){if(Oe.id===N)switch(ue){case"done":c.removeEventListener(ee),M(Oe.result);break;case"error":c.removeEventListener(ee),F(Oe.error)}};c.addEventListener(ee);var pe={id:N,input:_,options:w};c.postMessage("process",pe)})}self&&self.__awaiter,self&&self.__generator;var Me={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ye=ni("span").classList,Qe=ye&&ye.constructor&&ye.constructor.prototype,qe=Qe===Object.prototype?void 0:Qe,pt=Array.isArray||function(_){return ba(_)=="Array"},Xe=tt("species"),dt=Array,Ct=function(_,w){return new(function(M){var F;return pt(M)&&(F=M.constructor,(Go(F)&&(F===dt||pt(F.prototype))||Lr(F)&&(F=F[Xe])===null)&&(F=void 0)),F===void 0?dt:F}(_))(w===0?0:w)},Wt=Tt([].push),vr=function(_){var w=_==1,M=_==2,F=_==3,N=_==4,ee=_==6,pe=_==7,ue=_==5||ee;return function(Oe,Ge,Ve,Jt){for(var br,Dr,qr=Li(Oe),kn=Zu(qr),Cn=tl(Ge,Ve),Dn=so(kn),dn=0,ai=Jt||Ct,Ei=w?ai(Oe,Dn):M||pe?ai(Oe,0):void 0;Dn>dn;dn++)if((ue||dn in kn)&&(Dr=Cn(br=kn[dn],dn,qr),_))if(w)Ei[dn]=Dr;else if(Dr)switch(_){case 3:return!0;case 5:return br;case 6:return dn;case 2:Wt(Ei,br)}else switch(_){case 4:return!1;case 7:Wt(Ei,br)}return ee?-1:F||N?N:Ei}},er={forEach:vr(0),map:vr(1),filter:vr(2),some:vr(3),every:vr(4),find:vr(5),findIndex:vr(6),filterReject:vr(7)},wr=function(_,w){var M=[][_];return!!M&&X(function(){M.call(null,w||function(){return 1},1)})},Wr=er.forEach,bn=wr("forEach")?[].forEach:function(_){return Wr(this,_,arguments.length>1?arguments[1]:void 0)},gn=function(_){if(_&&_.forEach!==bn)try{Mi(_,"forEach",bn)}catch(w){_.forEach=bn}};for(var Gn in Me)Me[Gn]&&gn(Ue[Gn]&&Ue[Gn].prototype);gn(qe);var xi=function(_,w,M){var F=ir(w);F in _?wn.f(_,F,Fi(0,M)):_[F]=M},Si=tt("species"),bi=function(_){return xe>=51||!X(function(){var w=[];return(w.constructor={})[Si]=function(){return{foo:1}},w[_](Boolean).foo!==1})},Ea=bi("slice"),Xn=tt("species"),Hi=Array,Qi=Math.max;D({target:"Array",proto:!0,forced:!Ea},{slice:function(_,w){var M,F,N,ee=Vo(this),pe=so(ee),ue=Oa(_,pe),Oe=Oa(w===void 0?pe:w,pe);if(pt(ee)&&(M=ee.constructor,(Go(M)&&(M===Hi||pt(M.prototype))||Lr(M)&&(M=M[Xn])===null)&&(M=void 0),M===Hi||M===void 0))return ju(ee,ue,Oe);for(F=new(M===void 0?Hi:M)(Qi(Oe-ue,0)),N=0;ue<Oe;ue++,N++)ue in ee&&xi(F,N,ee[ue]);return F.length=N,F}});var Wi=mn.EXISTS,Ri=wn.f,oa=Function.prototype,Zi=Tt(oa.toString),wi=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,us=Tt(wi.exec);Cr&&!Wi&&Ri(oa,"name",{configurable:!0,get:function(){try{return us(wi,Zi(this))[1]}catch(_){return""}}});var Wo=er.map,Ds=bi("map");D({target:"Array",proto:!0,forced:!Ds},{map:function(_){return Wo(this,_,arguments.length>1?arguments[1]:void 0)}});var ls,co=Object.keys||function(_){return Vu(_,xu)},Jo={f:Cr&&!Oi?Object.defineProperties:function(_,w){ia(_);for(var M,F=Vo(w),N=co(w),ee=N.length,pe=0;ee>pe;)wn.f(_,M=N[pe++],F[M]);return _}},es=Ba("IE_PROTO"),Bs=function(){},uc=function(_){return"<script>"+_+"</script>"},ru=function(_){_.write(uc("")),_.close();var w=_.parentWindow.Object;return _=null,w},Hu=function(){try{ls=new ActiveXObject("htmlfile")}catch(F){}var _,w;Hu=typeof document!="undefined"?document.domain&&ls?ru(ls):((w=ni("iframe")).style.display="none",Xf.appendChild(w),w.src=String("javascript:"),(_=w.contentWindow.document).open(),_.write(uc("document.F=Object")),_.close(),_.F):ru(ls);for(var M=xu.length;M--;)delete Hu.prototype[xu[M]];return Hu()};Pr[es]=!0;var Cu=Object.create||function(_,w){var M;return _!==null?(Bs.prototype=ia(_),M=new Bs,Bs.prototype=null,M[es]=_):M=Hu(),w===void 0?M:Jo.f(M,w)},kf=wn.f,lc=tt("unscopables"),Wl=Array.prototype;Wl[lc]==null&&kf(Wl,lc,{configurable:!0,value:Cu(null)});var wl,Pf,cl,cc=function(_){Wl[lc][_]=!0},Xl=!X(function(){function _(){}return _.prototype.constructor=null,Object.getPrototypeOf(new _)!==_.prototype}),cs=Ba("IE_PROTO"),Tl=Object,Oc=Tl.prototype,Ns=Xl?Tl.getPrototypeOf:function(_){var w=Li(_);if(on(w,cs))return w[cs];var M=w.constructor;return fi(M)&&w instanceof M?M.prototype:w instanceof Tl?Oc:null},Na=tt("iterator"),Ru=!1;[].keys&&("next"in(cl=[].keys())?(Pf=Ns(Ns(cl)))!==Object.prototype&&(wl=Pf):Ru=!0),(wl==null||X(function(){var _={};return wl[Na].call(_)!==_}))&&(wl={}),fi(wl[Na])||Ra(wl,Na,function(){return this});var qs={IteratorPrototype:wl,BUGGY_SAFARI_ITERATORS:Ru},fc=qs.IteratorPrototype,rh=function(){return this},Lf=mn.PROPER,Sp=mn.CONFIGURABLE,Wu=qs.IteratorPrototype,Fc=qs.BUGGY_SAFARI_ITERATORS,Su=tt("iterator"),Rf=function(){return this},nh=function(_,w,M,F,N,ee,pe){(function(Dn,dn,ai,Ei){var Eo=dn+" Iterator";Dn.prototype=Cu(fc,{next:Fi(+!Ei,ai)}),Xr(Dn,Eo,!1),hu[Eo]=rh})(M,w,F);var ue,Oe,Ge,Ve=function(Dn){if(Dn===N&&kn)return kn;if(!Fc&&Dn in Dr)return Dr[Dn];switch(Dn){case"keys":case"values":case"entries":return function(){return new M(this,Dn)}}return function(){return new M(this)}},Jt=w+" Iterator",br=!1,Dr=_.prototype,qr=Dr[Su]||Dr["@@iterator"]||N&&Dr[N],kn=!Fc&&qr||Ve(N),Cn=w=="Array"&&Dr.entries||qr;if(Cn&&(ue=Ns(Cn.call(new _)))!==Object.prototype&&ue.next&&(Ns(ue)!==Wu&&(Mt?Mt(ue,Wu):fi(ue[Su])||Ra(ue,Su,Rf)),Xr(ue,Jt,!0)),Lf&&N=="values"&&qr&&qr.name!=="values"&&(Sp?Mi(Dr,"name","values"):(br=!0,kn=function(){return Ci(qr,this)})),N)if(Oe={values:Ve("values"),keys:ee?kn:Ve("keys"),entries:Ve("entries")},pe)for(Ge in Oe)(Fc||br||!(Ge in Dr))&&Ra(Dr,Ge,Oe[Ge]);else D({target:w,proto:!0,forced:Fc||br},Oe);return Dr[Su]!==kn&&Ra(Dr,Su,kn,{name:N}),hu[w]=kn,Oe},Yl=wn.f,zs=Bi.set,Of=Bi.getterFor("Array Iterator"),Ml=nh(Array,"Array",function(_,w){zs(this,{type:"Array Iterator",target:Vo(_),index:0,kind:w})},function(){var _=Of(this),w=_.target,M=_.kind,F=_.index++;return!w||F>=w.length?(_.target=void 0,{value:void 0,done:!0}):M=="keys"?{value:F,done:!1}:M=="values"?{value:w[F],done:!1}:{value:[F,w[F]],done:!1}},"values"),Oh=hu.Arguments=hu.Array;if(cc("keys"),cc("values"),cc("entries"),Cr&&Oh.name!=="values")try{Yl(Oh,"name",{value:"values"})}catch(_){}var nu,ih,Ou,re=typeof ArrayBuffer!="undefined"&&typeof DataView!="undefined",un=wn.f,ah=Bi.enforce,L0=Bi.get,Io=Ue.Int8Array,fl=Io&&Io.prototype,oh=Ue.Uint8ClampedArray,ed=oh&&oh.prototype,Us=Io&&Ns(Io),Au=fl&&Ns(fl),Md=Object.prototype,t0=Ue.TypeError,Id=tt("toStringTag"),Fh=ga("TYPED_ARRAY_TAG"),hc=re&&!!Mt&&fo(Ue.opera)!=="Opera",sh=!1,Ff={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fs={BigInt64Array:8,BigUint64Array:8},Ap=function(_){var w=Ns(_);if(Lr(w)){var M=L0(w);return M&&on(M,"TypedArrayConstructor")?M.TypedArrayConstructor:Ap(w)}},td=function(_){if(!Lr(_))return!1;var w=fo(_);return on(Ff,w)||on(fs,w)};for(nu in Ff)(Ou=(ih=Ue[nu])&&ih.prototype)?ah(Ou).TypedArrayConstructor=ih:hc=!1;for(nu in fs)(Ou=(ih=Ue[nu])&&ih.prototype)&&(ah(Ou).TypedArrayConstructor=ih);if((!hc||!fi(Us)||Us===Function.prototype)&&(Us=function(){throw t0("Incorrect invocation")},hc))for(nu in Ff)Ue[nu]&&Mt(Ue[nu],Us);if((!hc||!Au||Au===Md)&&(Au=Us.prototype,hc))for(nu in Ff)Ue[nu]&&Mt(Ue[nu].prototype,Au);if(hc&&Ns(ed)!==Au&&Mt(ed,Au),Cr&&!on(Au,Id))for(nu in sh=!0,un(Au,Id,{get:function(){return Lr(this)?this[Fh]:void 0}}),Ff)Ue[nu]&&Mi(Ue[nu],Fh,nu);var Xi={NATIVE_ARRAY_BUFFER_VIEWS:hc,TYPED_ARRAY_TAG:sh&&Fh,aTypedArray:function(_){if(td(_))return _;throw t0("Target is not a typed array")},aTypedArrayConstructor:function(_){if(fi(_)&&(!Mt||da(Us,_)))return _;throw t0(ke(_)+" is not a typed array constructor")},exportTypedArrayMethod:function(_,w,M,F){if(Cr){if(M)for(var N in Ff){var ee=Ue[N];if(ee&&on(ee.prototype,_))try{delete ee.prototype[_]}catch(pe){try{ee.prototype[_]=w}catch(ue){}}}Au[_]&&!M||Ra(Au,_,M?w:hc&&fl[_]||w,F)}},exportTypedArrayStaticMethod:function(_,w,M){var F,N;if(Cr){if(Mt){if(M){for(F in Ff)if((N=Ue[F])&&on(N,_))try{delete N[_]}catch(ee){}}if(Us[_]&&!M)return;try{return Ra(Us,_,M?w:hc&&Us[_]||w)}catch(ee){}}for(F in Ff)!(N=Ue[F])||N[_]&&!M||Ra(N,_,w)}},getTypedArrayConstructor:Ap,isView:function(_){if(!Lr(_))return!1;var w=fo(_);return w==="DataView"||on(Ff,w)||on(fs,w)},isTypedArray:td,TypedArray:Us,TypedArrayPrototype:Au},rd=Xi.NATIVE_ARRAY_BUFFER_VIEWS,Dh=Ue.ArrayBuffer,Dc=Ue.Int8Array,wp=!rd||!X(function(){Dc(1)})||!X(function(){new Dc(-1)})||!po(function(_){new Dc,new Dc(null),new Dc(1.5),new Dc(_)},!0)||X(function(){return new Dc(new Dh(2),1,void 0).length!==1}),Il=function(_,w,M){for(var F in w)Ra(_,F,w[F],M);return _},tf=RangeError,rf=function(_){if(_===void 0)return 0;var w=ti(_),M=So(w);if(w!==M)throw tf("Wrong length or index");return M},nd=Array,uh=Math.abs,pc=Math.pow,Tp=Math.floor,Jh=Math.log,dc=Math.LN2,nf=function(_,w,M){var F,N,ee,pe=nd(M),ue=8*M-w-1,Oe=(1<<ue)-1,Ge=Oe>>1,Ve=w===23?pc(2,-24)-pc(2,-77):0,Jt=_<0||_===0&&1/_<0?1:0,br=0;for((_=uh(_))!=_||_===1/0?(N=_!=_?1:0,F=Oe):(F=Tp(Jh(_)/dc),_*(ee=pc(2,-F))<1&&(F--,ee*=2),(_+=F+Ge>=1?Ve/ee:Ve*pc(2,1-Ge))*ee>=2&&(F++,ee/=2),F+Ge>=Oe?(N=0,F=Oe):F+Ge>=1?(N=(_*ee-1)*pc(2,w),F+=Ge):(N=_*pc(2,Ge-1)*pc(2,w),F=0));w>=8;)pe[br++]=255&N,N/=256,w-=8;for(F=F<<w|N,ue+=w;ue>0;)pe[br++]=255&F,F/=256,ue-=8;return pe[--br]|=128*Jt,pe},kl=function(_,w){var M,F=_.length,N=8*F-w-1,ee=(1<<N)-1,pe=ee>>1,ue=N-7,Oe=F-1,Ge=_[Oe--],Ve=127&Ge;for(Ge>>=7;ue>0;)Ve=256*Ve+_[Oe--],ue-=8;for(M=Ve&(1<<-ue)-1,Ve>>=-ue,ue+=w;ue>0;)M=256*M+_[Oe--],ue-=8;if(Ve===0)Ve=1-pe;else{if(Ve===ee)return M?NaN:Ge?-1/0:1/0;M+=pc(2,w),Ve-=pe}return(Ge?-1:1)*M*pc(2,Ve-w)},lh=function(_){for(var w=Li(this),M=so(w),F=arguments.length,N=Oa(F>1?arguments[1]:void 0,M),ee=F>2?arguments[2]:void 0,pe=ee===void 0?M:Oa(ee,M);pe>N;)w[N++]=_;return w},af=Array,Fu=Math.max,ch=function(_,w,M){for(var F=so(_),N=Oa(w,F),ee=Oa(M===void 0?F:M,F),pe=af(Fu(ee-N,0)),ue=0;N<ee;N++,ue++)xi(pe,ue,_[N]);return pe.length=ue,pe},Mp=ha.f,Bc=wn.f,of=mn.PROPER,kd=mn.CONFIGURABLE,Df=Bi.get,Pd=Bi.set,vc=Ue.ArrayBuffer,ql=vc,Zs=ql&&ql.prototype,Bf=Ue.DataView,Nc=Bf&&Bf.prototype,Bh=Object.prototype,zc=Ue.Array,Ip=Ue.RangeError,R0=Tt(lh),mc=Tt([].reverse),fh=nf,hh=kl,Nf=function(_){return[255&_]},Ld=function(_){return[255&_,_>>8&255]},id=function(_){return[255&_,_>>8&255,_>>16&255,_>>24&255]},Xu=function(_){return _[3]<<24|_[2]<<16|_[1]<<8|_[0]},kp=function(_){return fh(_,23,4)},uo=function(_){return fh(_,52,8)},Uc=function(_,w){Bc(_.prototype,w,{get:function(){return Df(this)[w]}})},Ja=function(_,w,M,F){var N=rf(M),ee=Df(_);if(N+w>ee.byteLength)throw Ip("Wrong index");var pe=Df(ee.buffer).bytes,ue=N+ee.byteOffset,Oe=ch(pe,ue,ue+w);return F?Oe:mc(Oe)},Vs=function(_,w,M,F,N,ee){var pe=rf(M),ue=Df(_);if(pe+w>ue.byteLength)throw Ip("Wrong index");for(var Oe=Df(ue.buffer).bytes,Ge=pe+ue.byteOffset,Ve=F(+N),Jt=0;Jt<w;Jt++)Oe[Ge+Jt]=Ve[ee?Jt:w-Jt-1]};if(re){var ad=of&&vc.name!=="ArrayBuffer";if(X(function(){vc(1)})&&X(function(){new vc(-1)})&&!X(function(){return new vc,new vc(1.5),new vc(NaN),ad&&!kd}))ad&&kd&&Mi(vc,"name","ArrayBuffer");else{(ql=function(_){return pa(this,Zs),new vc(rf(_))}).prototype=Zs;for(var od,r0=Mp(vc),n0=0;r0.length>n0;)(od=r0[n0++])in ql||Mi(ql,od,vc[od]);Zs.constructor=ql}Mt&&Ns(Nc)!==Bh&&Mt(Nc,Bh);var Pp=new Bf(new ql(2)),Rd=Tt(Nc.setInt8);Pp.setInt8(0,2147483648),Pp.setInt8(1,2147483649),!Pp.getInt8(0)&&Pp.getInt8(1)||Il(Nc,{setInt8:function(_,w){Rd(this,_,w<<24>>24)},setUint8:function(_,w){Rd(this,_,w<<24>>24)}},{unsafe:!0})}else Zs=(ql=function(_){pa(this,Zs);var w=rf(_);Pd(this,{bytes:R0(zc(w),0),byteLength:w}),Cr||(this.byteLength=w)}).prototype,Nc=(Bf=function(_,w,M){pa(this,Nc),pa(_,Zs);var F=Df(_).byteLength,N=ti(w);if(N<0||N>F)throw Ip("Wrong offset");if(N+(M=M===void 0?F-N:So(M))>F)throw Ip("Wrong length");Pd(this,{buffer:_,byteLength:M,byteOffset:N}),Cr||(this.buffer=_,this.byteLength=M,this.byteOffset=N)}).prototype,Cr&&(Uc(ql,"byteLength"),Uc(Bf,"buffer"),Uc(Bf,"byteLength"),Uc(Bf,"byteOffset")),Il(Nc,{getInt8:function(_){return Ja(this,1,_)[0]<<24>>24},getUint8:function(_){return Ja(this,1,_)[0]},getInt16:function(_){var w=Ja(this,2,_,arguments.length>1?arguments[1]:void 0);return(w[1]<<8|w[0])<<16>>16},getUint16:function(_){var w=Ja(this,2,_,arguments.length>1?arguments[1]:void 0);return w[1]<<8|w[0]},getInt32:function(_){return Xu(Ja(this,4,_,arguments.length>1?arguments[1]:void 0))},getUint32:function(_){return Xu(Ja(this,4,_,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(_){return hh(Ja(this,4,_,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(_){return hh(Ja(this,8,_,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(_,w){Vs(this,1,_,Nf,w)},setUint8:function(_,w){Vs(this,1,_,Nf,w)},setInt16:function(_,w){Vs(this,2,_,Ld,w,arguments.length>2?arguments[2]:void 0)},setUint16:function(_,w){Vs(this,2,_,Ld,w,arguments.length>2?arguments[2]:void 0)},setInt32:function(_,w){Vs(this,4,_,id,w,arguments.length>2?arguments[2]:void 0)},setUint32:function(_,w){Vs(this,4,_,id,w,arguments.length>2?arguments[2]:void 0)},setFloat32:function(_,w){Vs(this,4,_,kp,w,arguments.length>2?arguments[2]:void 0)},setFloat64:function(_,w){Vs(this,8,_,uo,w,arguments.length>2?arguments[2]:void 0)}});Xr(ql,"ArrayBuffer"),Xr(Bf,"DataView");var Lp={ArrayBuffer:ql,DataView:Bf},O0=Math.floor,ep=Number.isInteger||function(_){return!Lr(_)&&isFinite(_)&&O0(_)===_},Od=RangeError,F0=RangeError,ph=function(_,w){var M=function(F){var N=ti(F);if(N<0)throw Od("The argument can't be less than 0");return N}(_);if(M%w)throw F0("Wrong offset");return M},xo=Xi.aTypedArrayConstructor,sd=function(_){var w,M,F,N,ee,pe,ue=wh(this),Oe=Li(_),Ge=arguments.length,Ve=Ge>1?arguments[1]:void 0,Jt=Ve!==void 0,br=pu(Oe);if(br&&!Gl(br))for(pe=(ee=_i(Oe,br)).next,Oe=[];!(N=Ci(pe,ee)).done;)Oe.push(N.value);for(Jt&&Ge>2&&(Ve=tl(Ve,arguments[2])),M=so(Oe),F=new(xo(ue))(M),w=0;M>w;w++)F[w]=Jt?Ve(Oe[w],w):Oe[w];return F},Zc=function(_,w,M){var F,N;return Mt&&fi(F=w.constructor)&&F!==M&&Lr(N=F.prototype)&&N!==M.prototype&&Mt(_,N),_},tp=_r(function(_){var w=ha.f,M=er.forEach,F=Bi.get,N=Bi.set,ee=Bi.enforce,pe=wn.f,ue=De.f,Oe=Math.round,Ge=Ue.RangeError,Ve=Lp.ArrayBuffer,Jt=Ve.prototype,br=Lp.DataView,Dr=Xi.NATIVE_ARRAY_BUFFER_VIEWS,qr=Xi.TYPED_ARRAY_TAG,kn=Xi.TypedArray,Cn=Xi.TypedArrayPrototype,Dn=Xi.aTypedArrayConstructor,dn=Xi.isTypedArray,ai=function(io,Kr){Dn(io);for(var ln=0,Di=Kr.length,Ha=new io(Di);Di>ln;)Ha[ln]=Kr[ln++];return Ha},Ei=function(io,Kr){pe(io,Kr,{get:function(){return F(this)[Kr]}})},Eo=function(io){var Kr;return da(Jt,io)||(Kr=fo(io))=="ArrayBuffer"||Kr=="SharedArrayBuffer"},ro=function(io,Kr){return dn(io)&&!se(Kr)&&Kr in io&&ep(+Kr)&&Kr>=0},$a=function(io,Kr){return Kr=ir(Kr),ro(io,Kr)?Fi(2,io[Kr]):ue(io,Kr)},no=function(io,Kr,ln){return Kr=ir(Kr),!(ro(io,Kr)&&Lr(ln)&&on(ln,"value"))||on(ln,"get")||on(ln,"set")||ln.configurable||on(ln,"writable")&&!ln.writable||on(ln,"enumerable")&&!ln.enumerable?pe(io,Kr,ln):(io[Kr]=ln.value,io)};Cr?(Dr||(De.f=$a,wn.f=no,Ei(Cn,"buffer"),Ei(Cn,"byteOffset"),Ei(Cn,"byteLength"),Ei(Cn,"length")),D({target:"Object",stat:!0,forced:!Dr},{getOwnPropertyDescriptor:$a,defineProperty:no}),_.exports=function(io,Kr,ln){var Di=io.match(/\d+$/)[0]/8,Ha=io+(ln?"Clamped":"")+"Array",xa="get"+io,Ku="set"+io,dl=Ue[Ha],ts=dl,vl=ts&&ts.prototype,ps={},Eh=function(zu,rs){pe(zu,rs,{get:function(){return function(Ol,Co){var Fl=F(Ol);return Fl.view[xa](Co*Di+Fl.byteOffset,!0)}(this,rs)},set:function(Ol){return function(Co,Fl,jf){var Yp=F(Co);ln&&(jf=(jf=Oe(jf))<0?0:jf>255?255:255&jf),Yp.view[Ku](Fl*Di+Yp.byteOffset,jf,!0)}(this,rs,Ol)},enumerable:!0})};Dr?wp&&(ts=Kr(function(zu,rs,Ol,Co){return pa(zu,vl),Zc(Lr(rs)?Eo(rs)?Co!==void 0?new dl(rs,ph(Ol,Di),Co):Ol!==void 0?new dl(rs,ph(Ol,Di)):new dl(rs):dn(rs)?ai(ts,rs):Ci(sd,ts,rs):new dl(rf(rs)),zu,ts)}),Mt&&Mt(ts,kn),M(w(dl),function(zu){zu in ts||Mi(ts,zu,dl[zu])}),ts.prototype=vl):(ts=Kr(function(zu,rs,Ol,Co){pa(zu,vl);var Fl,jf,Yp,um=0,J0=0;if(Lr(rs)){if(!Eo(rs))return dn(rs)?ai(ts,rs):Ci(sd,ts,rs);Fl=rs,J0=ph(Ol,Di);var Cv=rs.byteLength;if(Co===void 0){if(Cv%Di||(jf=Cv-J0)<0)throw Ge("Wrong length")}else if((jf=So(Co)*Di)+J0>Cv)throw Ge("Wrong length");Yp=jf/Di}else Yp=rf(rs),Fl=new Ve(jf=Yp*Di);for(N(zu,{buffer:Fl,byteOffset:J0,byteLength:jf,length:Yp,view:new br(Fl)});um<Yp;)Eh(zu,um++)}),Mt&&Mt(ts,kn),vl=ts.prototype=Cu(Cn)),vl.constructor!==ts&&Mi(vl,"constructor",ts),ee(vl).TypedArrayConstructor=ts,qr&&Mi(vl,qr,Ha);var mp=ts!=dl;ps[Ha]=ts,D({global:!0,constructor:!0,forced:mp,sham:!Dr},ps),"BYTES_PER_ELEMENT"in ts||Mi(ts,"BYTES_PER_ELEMENT",Di),"BYTES_PER_ELEMENT"in vl||Mi(vl,"BYTES_PER_ELEMENT",Di),Ki(Ha)}):_.exports=function(){}});tp("Uint8",function(_){return function(w,M,F){return _(this,w,M,F)}},!0);var Fd=TypeError,ud=function(_,w){if(!delete _[w])throw Fd("Cannot delete property "+ke(w)+" of "+ke(_))},H=Math.min,Le=Tt([].copyWithin||function(_,w){var M=Li(this),F=so(M),N=Oa(_,F),ee=Oa(w,F),pe=arguments.length>2?arguments[2]:void 0,ue=H((pe===void 0?F:Oa(pe,F))-ee,F-N),Oe=1;for(ee<N&&N<ee+ue&&(Oe=-1,ee+=ue-1,N+=ue-1);ue-- >0;)ee in M?M[N]=M[ee]:ud(M,N),N+=Oe,ee+=Oe;return M}),ot=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("copyWithin",function(_,w){return Le(ot(this),_,w,arguments.length>2?arguments[2]:void 0)});var hr=er.every,Ur=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("every",function(_){return hr(Ur(this),_,arguments.length>1?arguments[1]:void 0)});var cr=TypeError,kr=function(_){var w=jr(_,"number");if(typeof w=="number")throw cr("Can't convert number to bigint");return BigInt(w)},Gr=Xi.aTypedArray,$r=Xi.exportTypedArrayMethod,tn=Tt("".slice);$r("fill",function(_){var w=arguments.length;Gr(this);var M=tn(fo(this),0,3)==="Big"?kr(_):+_;return Ci(lh,this,M,w>1?arguments[1]:void 0,w>2?arguments[2]:void 0)},X(function(){var _=0;return new Int8Array(2).fill({valueOf:function(){return _++}}),_!==1}));var hn=Xi.aTypedArrayConstructor,pn=Xi.getTypedArrayConstructor,In=function(_){return hn(Yh(_,pn(_)))},rn=function(_,w){return function(M,F){for(var N=0,ee=so(F),pe=new M(ee);ee>N;)pe[N]=F[N++];return pe}(In(_),w)},cn=er.filter,Nt=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("filter",function(_){var w=cn(Nt(this),_,arguments.length>1?arguments[1]:void 0);return rn(this,w)});var yr=er.find,en=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("find",function(_){return yr(en(this),_,arguments.length>1?arguments[1]:void 0)});var Pn=er.findIndex,Zr=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("findIndex",function(_){return Pn(Zr(this),_,arguments.length>1?arguments[1]:void 0)});var yn=er.forEach,Nn=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("forEach",function(_){yn(Nn(this),_,arguments.length>1?arguments[1]:void 0)});var Ti=eu.includes,Ir=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("includes",function(_){return Ti(Ir(this),_,arguments.length>1?arguments[1]:void 0)});var Fr=eu.indexOf,ii=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("indexOf",function(_){return Fr(ii(this),_,arguments.length>1?arguments[1]:void 0)});var Ln=tt("iterator"),nn=Ue.Uint8Array,zn=Tt(Ml.values),Mn=Tt(Ml.keys),ca=Tt(Ml.entries),Gi=Xi.aTypedArray,Rn=Xi.exportTypedArrayMethod,Fn=nn&&nn.prototype,Pi=!X(function(){Fn[Ln].call([1])}),ta=!!Fn&&Fn.values&&Fn[Ln]===Fn.values&&Fn.values.name==="values",Ta=function(){return zn(Gi(this))};Rn("entries",function(){return ca(Gi(this))},Pi),Rn("keys",function(){return Mn(Gi(this))},Pi),Rn("values",Ta,Pi||!ta,{name:"values"}),Rn(Ln,Ta,Pi||!ta,{name:"values"});var qo=Xi.aTypedArray,$o=Xi.exportTypedArrayMethod,Ca=Tt([].join);$o("join",function(_){return Ca(qo(this),_)});var $s=Math.min,wo=[].lastIndexOf,js=!!wo&&1/[1].lastIndexOf(1,-0)<0,gs=wr("lastIndexOf"),Ts=js||!gs?function(_){if(js)return xl(wo,this,arguments)||0;var w=Vo(this),M=so(w),F=M-1;for(arguments.length>1&&(F=$s(F,ti(arguments[1]))),F<0&&(F=M+F);F>=0;F--)if(F in w&&w[F]===_)return F||0;return-1}:wo,Gs=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("lastIndexOf",function(_){var w=arguments.length;return xl(Ts,Gs(this),w>1?[_,arguments[1]]:[_])});var du=er.map,Uo=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("map",function(_){return du(Uo(this),_,arguments.length>1?arguments[1]:void 0,function(w,M){return new(In(w))(M)})});var sa=TypeError,Ms=function(_){return function(w,M,F,N){ut(M);var ee=Li(w),pe=Zu(ee),ue=so(ee),Oe=_?ue-1:0,Ge=_?-1:1;if(F<2)for(;;){if(Oe in pe){N=pe[Oe],Oe+=Ge;break}if(Oe+=Ge,_?Oe<0:ue<=Oe)throw sa("Reduce of empty array with no initial value")}for(;_?Oe>=0:ue>Oe;Oe+=Ge)Oe in pe&&(N=M(N,pe[Oe],Oe,ee));return N}},Ua={left:Ms(!1),right:Ms(!0)},iu=Ua.left,Yi=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("reduce",function(_){var w=arguments.length;return iu(Yi(this),_,w,w>1?arguments[1]:void 0)});var Ma=Ua.right,eo=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("reduceRight",function(_){var w=arguments.length;return Ma(eo(this),_,w,w>1?arguments[1]:void 0)});var ys=Xi.aTypedArray,sf=Xi.exportTypedArrayMethod,$e=Math.floor;sf("reverse",function(){for(var _,w=ys(this).length,M=$e(w/2),F=0;F<M;)_=this[F],this[F++]=this[--w],this[w]=_;return this});var dr=Ue.RangeError,Xt=Ue.Int8Array,Jn=Xt&&Xt.prototype,Ia=Jn&&Jn.set,Ze=Xi.aTypedArray,Ce=Xi.exportTypedArrayMethod,ht=!X(function(){var _=new Uint8ClampedArray(2);return Ci(Ia,_,{length:1,0:3},1),_[1]!==3}),Vt=ht&&Xi.NATIVE_ARRAY_BUFFER_VIEWS&&X(function(){var _=new Xt(2);return _.set(1),_.set("2",1),_[0]!==0||_[1]!==2});Ce("set",function(_){Ze(this);var w=ph(arguments.length>1?arguments[1]:void 0,1),M=Li(_);if(ht)return Ci(Ia,this,M,w);var F=this.length,N=so(M),ee=0;if(N+w>F)throw dr("Wrong length");for(;ee<N;)this[w+ee]=M[ee++]},!ht||Vt);var or=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("slice",function(_,w){for(var M=ju(or(this),_,w),F=In(this),N=0,ee=M.length,pe=new F(ee);ee>N;)pe[N]=M[N++];return pe},X(function(){new Int8Array(1).slice()}));var gt=er.some,it=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("some",function(_){return gt(it(this),_,arguments.length>1?arguments[1]:void 0)});var wt=Math.floor,Re=function(_,w){var M=_.length,F=wt(M/2);return M<8?ft(_,w):je(_,Re(ch(_,0,F),w),Re(ch(_,F),w),w)},ft=function(_,w){for(var M,F,N=_.length,ee=1;ee<N;){for(F=ee,M=_[ee];F&&w(_[F-1],M)>0;)_[F]=_[--F];F!==ee++&&(_[F]=M)}return _},je=function(_,w,M,F){for(var N=w.length,ee=M.length,pe=0,ue=0;pe<N||ue<ee;)_[pe+ue]=pe<N&&ue<ee?F(w[pe],M[ue])<=0?w[pe++]:M[ue++]:pe<N?w[pe++]:M[ue++];return _},zt=Re,$t=yi.match(/firefox\/(\d+)/i),Vr=!!$t&&+$t[1],En=/MSIE|Trident/.test(yi),sn=yi.match(/AppleWebKit\/(\d+)\./),jn=!!sn&&+sn[1],_n=Xi.aTypedArray,Yn=Xi.exportTypedArrayMethod,Hn=Ue.Uint16Array,qn=Hn&&Tt(Hn.prototype.sort),si=!(!qn||X(function(){qn(new Hn(2),null)})&&X(function(){qn(new Hn(2),{})})),$n=!!qn&&!X(function(){if(xe)return xe<74;if(Vr)return Vr<67;if(En)return!0;if(jn)return jn<602;var _,w,M=new Hn(516),F=Array(516);for(_=0;_<516;_++)w=_%4,M[_]=515-_,F[_]=_-2*w+3;for(qn(M,function(N,ee){return(N/4|0)-(ee/4|0)}),_=0;_<516;_++)if(M[_]!==F[_])return!0});Yn("sort",function(_){return _!==void 0&&ut(_),$n?qn(this,_):zt(_n(this),function(w){return function(M,F){return w!==void 0?+w(M,F)||0:F!=F?-1:M!=M?1:M===0&&F===0?1/M>0&&1/F<0?1:-1:M>F}}(_))},!$n||si);var Ni=Xi.aTypedArray;(0,Xi.exportTypedArrayMethod)("subarray",function(_,w){var M=Ni(this),F=M.length,N=Oa(_,F);return new(In(M))(M.buffer,M.byteOffset+N*M.BYTES_PER_ELEMENT,So((w===void 0?F:Oa(w,F))-N))});var za=Ue.Int8Array,Ks=Xi.aTypedArray,ko=Xi.exportTypedArrayMethod,qa=[].toLocaleString,Vc=!!za&&X(function(){qa.call(new za(1))});ko("toLocaleString",function(){return xl(qa,Vc?ju(Ks(this)):Ks(this),ju(arguments))},X(function(){return[1,2].toLocaleString()!=new za([1,2]).toLocaleString()})||!X(function(){za.prototype.toLocaleString.call([1,2])}));var Du=Xi.exportTypedArrayMethod,gc=Ue.Uint8Array,$l=gc&&gc.prototype||{},yc=[].toString,hl=Tt([].join);X(function(){yc.call({})})&&(yc=function(){return hl(this)});var jc=$l.toString!=yc;Du("toString",yc,jc);var dh,rp,Is=String,Hs=function(_){if(fo(_)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Is(_)},_c=function(){var _=ia(this),w="";return _.hasIndices&&(w+="d"),_.global&&(w+="g"),_.ignoreCase&&(w+="i"),_.multiline&&(w+="m"),_.dotAll&&(w+="s"),_.unicode&&(w+="u"),_.unicodeSets&&(w+="v"),_.sticky&&(w+="y"),w},np=Ue.RegExp,vh=X(function(){var _=np("a","y");return _.lastIndex=2,_.exec("abcd")!=null}),ld=vh||X(function(){return!np("a","y").sticky}),Kl={BROKEN_CARET:vh||X(function(){var _=np("^r","gy");return _.lastIndex=2,_.exec("str")!=null}),MISSED_STICKY:ld,UNSUPPORTED_Y:vh},zf=Ue.RegExp,i0=X(function(){var _=zf(".","s");return!(_.dotAll&&_.exec(`
`)&&_.flags==="s")}),pv=Ue.RegExp,Zv=X(function(){var _=pv("(?<a>b)","g");return _.exec("b").groups.a!=="b"||"b".replace(_,"$<a>c")!=="bc"}),Qs=Bi.get,ip=rt("native-string-replace",String.prototype.replace),Dd=RegExp.prototype.exec,i=Dd,s=Tt("".charAt),l=Tt("".indexOf),d=Tt("".replace),x=Tt("".slice),C=(rp=/b*/g,Ci(Dd,dh=/a/,"a"),Ci(Dd,rp,"a"),dh.lastIndex!==0||rp.lastIndex!==0),T=Kl.BROKEN_CARET,O=/()??/.exec("")[1]!==void 0;(C||O||T||i0||Zv)&&(i=function(_){var w,M,F,N,ee,pe,ue,Oe=this,Ge=Qs(Oe),Ve=Hs(_),Jt=Ge.raw;if(Jt)return Jt.lastIndex=Oe.lastIndex,w=Ci(i,Jt,Ve),Oe.lastIndex=Jt.lastIndex,w;var br=Ge.groups,Dr=T&&Oe.sticky,qr=Ci(_c,Oe),kn=Oe.source,Cn=0,Dn=Ve;if(Dr&&(qr=d(qr,"y",""),l(qr,"g")===-1&&(qr+="g"),Dn=x(Ve,Oe.lastIndex),Oe.lastIndex>0&&(!Oe.multiline||Oe.multiline&&s(Ve,Oe.lastIndex-1)!==`
`)&&(kn="(?: "+kn+")",Dn=" "+Dn,Cn++),M=new RegExp("^(?:"+kn+")",qr)),O&&(M=new RegExp("^"+kn+"$(?!\\s)",qr)),C&&(F=Oe.lastIndex),N=Ci(Dd,Dr?M:Oe,Dn),Dr?N?(N.input=x(N.input,Cn),N[0]=x(N[0],Cn),N.index=Oe.lastIndex,Oe.lastIndex+=N[0].length):Oe.lastIndex=0:C&&N&&(Oe.lastIndex=Oe.global?N.index+N[0].length:F),O&&N&&N.length>1&&Ci(ip,N[0],M,function(){for(ee=1;ee<arguments.length-2;ee++)arguments[ee]===void 0&&(N[ee]=void 0)}),N&&br)for(N.groups=pe=Cu(null),ee=0;ee<br.length;ee++)pe[(ue=br[ee])[0]]=N[ue[1]];return N});var U=i;D({target:"RegExp",proto:!0,forced:/./.exec!==U},{exec:U});var W,$=tt("species"),te=RegExp.prototype,he=function(_,w,M,F){var N=tt(_),ee=!X(function(){var Ge={};return Ge[N]=function(){return 7},""[_](Ge)!=7}),pe=ee&&!X(function(){var Ge=!1,Ve=/a/;return _==="split"&&((Ve={}).constructor={},Ve.constructor[$]=function(){return Ve},Ve.flags="",Ve[N]=/./[N]),Ve.exec=function(){return Ge=!0,null},Ve[N](""),!Ge});if(!ee||!pe||M){var ue=Tt(/./[N]),Oe=w(N,""[_],function(Ge,Ve,Jt,br,Dr){var qr=Tt(Ge),kn=Ve.exec;return kn===U||kn===te.exec?ee&&!Dr?{done:!0,value:ue(Ve,Jt,br)}:{done:!0,value:qr(Jt,Ve,br)}:{done:!1}});Ra(String.prototype,_,Oe[0]),Ra(te,N,Oe[1])}F&&Mi(te[N],"sham",!0)},Ee=Tt("".charAt),Ke=Tt("".charCodeAt),Je=Tt("".slice),mt=function(_){return function(w,M){var F,N,ee=Hs(Bn(w)),pe=ti(M),ue=ee.length;return pe<0||pe>=ue?_?"":void 0:(F=Ke(ee,pe))<55296||F>56319||pe+1===ue||(N=Ke(ee,pe+1))<56320||N>57343?_?Ee(ee,pe):F:_?Je(ee,pe,pe+2):N-56320+(F-55296<<10)+65536}},ct={codeAt:mt(!1),charAt:mt(!0)},Bt=ct.charAt,Kt=function(_,w,M){return w+(M?Bt(_,w).length:1)},mr=Math.floor,gr=Tt("".charAt),zr=Tt("".replace),fn=Tt("".slice),Un=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Ai=/\$([$&'`]|\d{1,2})/g,ei=function(_,w,M,F,N,ee){var pe=M+_.length,ue=F.length,Oe=Ai;return N!==void 0&&(N=Li(N),Oe=Un),zr(ee,Oe,function(Ge,Ve){var Jt;switch(gr(Ve,0)){case"$":return"$";case"&":return _;case"`":return fn(w,0,M);case"'":return fn(w,pe);case"<":Jt=N[fn(Ve,1,-1)];break;default:var br=+Ve;if(br===0)return Ge;if(br>ue){var Dr=mr(br/10);return Dr===0?Ge:Dr<=ue?F[Dr-1]===void 0?gr(Ve,1):F[Dr-1]+gr(Ve,1):Ge}Jt=F[br-1]}return Jt===void 0?"":Jt})},Ii=TypeError,Kn=function(_,w){var M=_.exec;if(fi(M)){var F=Ci(M,_,w);return F!==null&&ia(F),F}if(ba(_)==="RegExp")return Ci(U,_,w);throw Ii("RegExp#exec called on incompatible receiver")},ua=tt("replace"),qi=Math.max,mi=Math.min,La=Tt([].concat),fa=Tt([].push),Za=Tt("".indexOf),ki=Tt("".slice),to="a".replace(/./,"$0")==="$0",Xo=!!/./[ua]&&/./[ua]("a","$0")==="";function Zo(_){this.message=_}he("replace",function(_,w,M){var F=Xo?"$":"$0";return[function(N,ee){var pe=Bn(this),ue=N==null?void 0:xt(N,ua);return ue?Ci(ue,N,pe,ee):Ci(w,Hs(pe),N,ee)},function(N,ee){var pe=ia(this),ue=Hs(N);if(typeof ee=="string"&&Za(ee,F)===-1&&Za(ee,"$<")===-1){var Oe=M(w,pe,ue,ee);if(Oe.done)return Oe.value}var Ge=fi(ee);Ge||(ee=Hs(ee));var Ve=pe.global;if(Ve){var Jt=pe.unicode;pe.lastIndex=0}for(var br=[];;){var Dr=Kn(pe,ue);if(Dr===null||(fa(br,Dr),!Ve))break;Hs(Dr[0])===""&&(pe.lastIndex=Kt(ue,So(pe.lastIndex),Jt))}for(var qr,kn="",Cn=0,Dn=0;Dn<br.length;Dn++){for(var dn=Hs((Dr=br[Dn])[0]),ai=qi(mi(ti(Dr.index),ue.length),0),Ei=[],Eo=1;Eo<Dr.length;Eo++)fa(Ei,(qr=Dr[Eo])===void 0?qr:String(qr));var ro=Dr.groups;if(Ge){var $a=La([dn],Ei,ai,ue);ro!==void 0&&fa($a,ro);var no=Hs(xl(ee,void 0,$a))}else no=ei(dn,ue,ai,Ei,ro,ee);ai>=Cn&&(kn+=ki(ue,Cn,ai)+no,Cn=ai+dn.length)}return kn+ki(ue,Cn)}]},!!X(function(){var _=/./;return _.exec=function(){var w=[];return w.groups={a:"7"},w},"".replace(_,"$<a>")!=="7"})||!to||Xo),Zo.prototype=new Error,Zo.prototype.name="InvalidCharacterError",D({global:!0},{globalThis:Ue}),W=typeof window=="undefined"?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(_){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(_){return null},clearMeasures:function(_){return null},clearMarks:function(_){return null},measure:function(_,w,M){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(_){return!0},Event:function(_,w){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0?my.getSystemInfoSync().pixelRatio:W.devicePixelRatio;var _s=TypeError,Yr=function(_){if(_>9007199254740991)throw _s("Maximum allowed index exceeded");return _},xs=bi("splice"),nr=Math.max,au=Math.min;D({target:"Array",proto:!0,forced:!xs},{splice:function(_,w){var M,F,N,ee,pe,ue,Oe=Li(this),Ge=so(Oe),Ve=Oa(_,Ge),Jt=arguments.length;for(Jt===0?M=F=0:Jt===1?(M=0,F=Ge-Ve):(M=Jt-2,F=au(nr(ti(w),0),Ge-Ve)),Yr(Ge+M-F),N=Ct(Oe,F),ee=0;ee<F;ee++)(pe=Ve+ee)in Oe&&xi(N,ee,Oe[pe]);if(N.length=F,M<F){for(ee=Ve;ee<Ge-F;ee++)ue=ee+M,(pe=ee+F)in Oe?Oe[ue]=Oe[pe]:ud(Oe,ue);for(ee=Ge;ee>Ge-F+M;ee--)ud(Oe,ee-1)}else if(M>F)for(ee=Ge-F;ee>Ve;ee--)ue=ee+M-1,(pe=ee+F-1)in Oe?Oe[ue]=Oe[pe]:ud(Oe,ue);for(ee=0;ee<M;ee++)Oe[ee+Ve]=arguments[ee+2];return Oe.length=Ge-F+M,N}});var Yu=we(function _(w,M){ve(this,_),We(this,"cancelBubble",void 0),We(this,"cancelable",void 0),We(this,"target",void 0),We(this,"currentTarget",void 0),We(this,"preventDefault",void 0),We(this,"stopPropagation",void 0),We(this,"type",void 0),We(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=w,this.timeStamp=Date.now()}),hs=Object.assign,Bu=Object.defineProperty,bs=Tt([].concat),Es=!hs||X(function(){if(Cr&&hs({b:1},hs(Bu({},"a",{enumerable:!0,get:function(){Bu(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var _={},w={},M=Symbol();return _[M]=7,"abcdefghijklmnopqrst".split("").forEach(function(F){w[F]=F}),hs({},_)[M]!=7||co(hs({},w)).join("")!="abcdefghijklmnopqrst"})?function(_,w){for(var M=Li(_),F=arguments.length,N=1,ee=As.f,pe=vs.f;F>N;)for(var ue,Oe=Zu(arguments[N++]),Ge=ee?bs(co(Oe),ee(Oe)):co(Oe),Ve=Ge.length,Jt=0;Ve>Jt;)ue=Ge[Jt++],Cr&&!Ci(pe,Oe,ue)||(M[ue]=Oe[ue]);return M}:hs;D({target:"Object",stat:!0,arity:2,forced:Object.assign!==Es},{assign:Es});var Fa=er.findIndex,To=!0;"findIndex"in[]&&Array(1).findIndex(function(){To=!1}),D({target:"Array",proto:!0,forced:To},{findIndex:function(_){return Fa(this,_,arguments.length>1?arguments[1]:void 0)}}),cc("findIndex");var vo=ct.charAt,ja=Bi.set,qu=Bi.getterFor("String Iterator");nh(String,"String",function(_){ja(this,{type:"String Iterator",string:Hs(_),index:0})},function(){var _,w=qu(this),M=w.string,F=w.index;return F>=M.length?{value:void 0,done:!0}:(_=vo(M,F),w.index+=_.length,{value:_,done:!1})});var vu=ha.f,Oo=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Ws={f:function(_){return Oo&&ba(_)=="Window"?function(w){try{return vu(w)}catch(M){return ch(Oo)}}(_):vu(Vo(_))}},mu=X(function(){if(typeof ArrayBuffer=="function"){var _=new ArrayBuffer(8);Object.isExtensible(_)&&Object.defineProperty(_,"a",{value:8})}}),Ga=Object.isExtensible,Pl=X(function(){Ga(1)})||mu?function(_){return!!Lr(_)&&(!mu||ba(_)!="ArrayBuffer")&&(!Ga||Ga(_))}:Ga,xc=!X(function(){return Object.isExtensible(Object.preventExtensions({}))}),pl=_r(function(_){var w=wn.f,M=!1,F=ga("meta"),N=0,ee=function(ue){w(ue,F,{value:{objectID:"O"+N++,weakData:{}}})},pe=_.exports={enable:function(){pe.enable=function(){},M=!0;var ue=ha.f,Oe=Tt([].splice),Ge={};Ge[F]=1,ue(Ge).length&&(ha.f=function(Ve){for(var Jt=ue(Ve),br=0,Dr=Jt.length;br<Dr;br++)if(Jt[br]===F){Oe(Jt,br,1);break}return Jt},D({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Ws.f}))},fastKey:function(ue,Oe){if(!Lr(ue))return typeof ue=="symbol"?ue:(typeof ue=="string"?"S":"P")+ue;if(!on(ue,F)){if(!Pl(ue))return"F";if(!Oe)return"E";ee(ue)}return ue[F].objectID},getWeakData:function(ue,Oe){if(!on(ue,F)){if(!Pl(ue))return!0;if(!Oe)return!1;ee(ue)}return ue[F].weakData},onFreeze:function(ue){return xc&&M&&Pl(ue)&&!on(ue,F)&&ee(ue),ue}};Pr[F]=!0}),Cs=(pl.enable,pl.fastKey,pl.getWeakData,pl.onFreeze,function(_,w,M){var F=_.indexOf("Map")!==-1,N=_.indexOf("Weak")!==-1,ee=F?"set":"add",pe=Ue[_],ue=pe&&pe.prototype,Oe=pe,Ge={},Ve=function(Cn){var Dn=Tt(ue[Cn]);Ra(ue,Cn,Cn=="add"?function(dn){return Dn(this,dn===0?0:dn),this}:Cn=="delete"?function(dn){return!(N&&!Lr(dn))&&Dn(this,dn===0?0:dn)}:Cn=="get"?function(dn){return N&&!Lr(dn)?void 0:Dn(this,dn===0?0:dn)}:Cn=="has"?function(dn){return!(N&&!Lr(dn))&&Dn(this,dn===0?0:dn)}:function(dn,ai){return Dn(this,dn===0?0:dn,ai),this})};if(P(_,!fi(pe)||!(N||ue.forEach&&!X(function(){new pe().entries().next()}))))Oe=M.getConstructor(w,_,F,ee),pl.enable();else if(P(_,!0)){var Jt=new Oe,br=Jt[ee](N?{}:-0,1)!=Jt,Dr=X(function(){Jt.has(1)}),qr=po(function(Cn){new pe(Cn)}),kn=!N&&X(function(){for(var Cn=new pe,Dn=5;Dn--;)Cn[ee](Dn,Dn);return!Cn.has(-0)});qr||((Oe=w(function(Cn,Dn){pa(Cn,ue);var dn=Zc(new pe,Cn,Oe);return Dn!=null&&Yo(Dn,dn[ee],{that:dn,AS_ENTRIES:F}),dn})).prototype=ue,ue.constructor=Oe),(Dr||kn)&&(Ve("delete"),Ve("has"),F&&Ve("get")),(kn||br)&&Ve(ee),N&&ue.clear&&delete ue.clear}return Ge[_]=Oe,D({global:!0,constructor:!0,forced:Oe!=pe},Ge),Xr(Oe,_),N||M.setStrong(Oe,_,F),Oe}),Gc=pl.getWeakData,uf=Bi.set,Rp=Bi.getterFor,Op=er.find,Fp=er.findIndex,Nh=Tt([].splice),Bd=0,Dp=function(_){return _.frozen||(_.frozen=new ap)},ap=function(){this.entries=[]},op=function(_,w){return Op(_.entries,function(M){return M[0]===w})};ap.prototype={get:function(_){var w=op(this,_);if(w)return w[1]},has:function(_){return!!op(this,_)},set:function(_,w){var M=op(this,_);M?M[1]=w:this.entries.push([_,w])},delete:function(_){var w=Fp(this.entries,function(M){return M[0]===_});return~w&&Nh(this.entries,w,1),!!~w}};var sp,cd={getConstructor:function(_,w,M,F){var N=_(function(Oe,Ge){pa(Oe,ee),uf(Oe,{type:w,id:Bd++,frozen:void 0}),Ge!=null&&Yo(Ge,Oe[F],{that:Oe,AS_ENTRIES:M})}),ee=N.prototype,pe=Rp(w),ue=function(Oe,Ge,Ve){var Jt=pe(Oe),br=Gc(ia(Ge),!0);return br===!0?Dp(Jt).set(Ge,Ve):br[Jt.id]=Ve,Oe};return Il(ee,{delete:function(Oe){var Ge=pe(this);if(!Lr(Oe))return!1;var Ve=Gc(Oe);return Ve===!0?Dp(Ge).delete(Oe):Ve&&on(Ve,Ge.id)&&delete Ve[Ge.id]},has:function(Oe){var Ge=pe(this);if(!Lr(Oe))return!1;var Ve=Gc(Oe);return Ve===!0?Dp(Ge).has(Oe):Ve&&on(Ve,Ge.id)}}),Il(ee,M?{get:function(Oe){var Ge=pe(this);if(Lr(Oe)){var Ve=Gc(Oe);return Ve===!0?Dp(Ge).get(Oe):Ve?Ve[Ge.id]:void 0}},set:function(Oe,Ge){return ue(this,Oe,Ge)}}:{add:function(Oe){return ue(this,Oe,!0)}}),N}},Hc=Bi.enforce,Nd=!Ue.ActiveXObject&&"ActiveXObject"in Ue,Bp=function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},up=Cs("WeakMap",Bp,cd);if(aa&&Nd){sp=cd.getConstructor(Bp,"WeakMap",!0),pl.enable();var Uf=up.prototype,zh=Tt(Uf.delete),Np=Tt(Uf.has),bo=Tt(Uf.get),Wc=Tt(Uf.set);Il(Uf,{delete:function(_){if(Lr(_)&&!Pl(_)){var w=Hc(this);return w.frozen||(w.frozen=new sp),zh(this,_)||w.frozen.delete(_)}return zh(this,_)},has:function(_){if(Lr(_)&&!Pl(_)){var w=Hc(this);return w.frozen||(w.frozen=new sp),Np(this,_)||w.frozen.has(_)}return Np(this,_)},get:function(_){if(Lr(_)&&!Pl(_)){var w=Hc(this);return w.frozen||(w.frozen=new sp),Np(this,_)?bo(this,_):w.frozen.get(_)}return bo(this,_)},set:function(_,w){if(Lr(_)&&!Pl(_)){var M=Hc(this);M.frozen||(M.frozen=new sp),Np(this,_)?Wc(this,_,w):M.frozen.set(_,w)}else Wc(this,_,w);return this}})}var fd=tt("iterator"),hd=tt("toStringTag"),lp=Ml.values,pd=function(_,w){if(_){if(_[fd]!==lp)try{Mi(_,fd,lp)}catch(F){_[fd]=lp}if(_[hd]||Mi(_,hd,w),Me[w]){for(var M in Ml)if(_[M]!==Ml[M])try{Mi(_,M,Ml[M])}catch(F){_[M]=Ml[M]}}}};for(var zp in Me)pd(Ue[zp]&&Ue[zp].prototype,zp);pd(qe,"DOMTokenList");var cp,Uh,fp,Up,wu=new WeakMap,mh=function(){function _(){ve(this,_),wu.set(this,{})}return we(_,[{key:"addEventListener",value:function(w,M){var F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},N=wu.get(this);N||(N={}),N[w]||(N[w]=[]),N[w].push(M),wu.set(this,N),F.capture,F.once,F.passive}},{key:"removeEventListener",value:function(w,M){var F=wu.get(this);if(F){var N=F[w];if(N&&N.length>0){for(var ee=N.length;ee--;ee>0)if(N[ee]===M){N.splice(ee,1);break}}}}},{key:"dispatchEvent",value:function(w){var M=wu.get(this)[w.type];if(M){var F,N=function(ee,pe){var ue=typeof Symbol!="undefined"&&ee[Symbol.iterator]||ee["@@iterator"];if(!ue){if(Array.isArray(ee)||(ue=jt(ee))||pe&&ee&&typeof ee.length=="number"){ue&&(ee=ue);var Oe=0,Ge=function(){};return{s:Ge,n:function(){return Oe>=ee.length?{done:!0}:{done:!1,value:ee[Oe++]}},e:function(Dr){throw Dr},f:Ge}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Ve,Jt=!0,br=!1;return{s:function(){ue=ue.call(ee)},n:function(){var Dr=ue.next();return Jt=Dr.done,Dr},e:function(Dr){br=!0,Ve=Dr},f:function(){try{Jt||ue.return==null||ue.return()}finally{if(br)throw Ve}}}}(M);try{for(N.s();!(F=N.n()).done;)(0,F.value)(w)}catch(ee){N.e(ee)}finally{N.f()}}}}]),_}(),gh=function(_){St(M,_);var w=Sr(M);function M(){var F;return ve(this,M),We(qt(F=w.call(this)),"className",void 0),We(qt(F),"children",void 0),F.className="",F.children=[],F}return we(M,[{key:"setAttribute",value:function(F,N){this[F]=N}},{key:"getAttribute",value:function(F){return this[F]}},{key:"setAttributeNS",value:function(F,N){this[F]=N}},{key:"getAttributeNS",value:function(F){return this[F]}}]),M}(function(_){St(M,_);var w=Sr(M);function M(){var F;return ve(this,M),We(qt(F=w.call(this)),"childNodes",void 0),F.childNodes=[],F}return we(M,[{key:"appendChild",value:function(F){this.childNodes.push(F)}},{key:"cloneNode",value:function(){var F=Object.create(this);return Object.assign(F,this),F}},{key:"removeChild",value:function(F){var N=this.childNodes.findIndex(function(ee){return ee===F});return N>-1?this.childNodes.splice(N,1):null}}]),M}(mh));if(typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var dd=my.getSystemInfoSync();cp=dd.screenWidth,Uh=dd.screenHeight,fp=dd.windowWidth,Up=dd.windowHeight}else{var vd=W.innerWidth,md=W.innerHeight;cp=vd,Uh=md,fp=vd,Up=md}var zd={width:cp,height:Uh,availWidth:fp,availHeight:Up,availLeft:0,availTop:0},Zp=zd.availWidth,a0=zd.availHeight,gd={style:[]};function Ss(_,w){var M,F;"parentNode"in _||(M=w===0?function(){return null}:w===1?function(){return gd}:function(){return null},Object.defineProperty(_,"parentNode",{enumerable:!0,get:M})),"parentElement"in _||(F=w===0?function(){return null}:w===1?function(){return gd}:function(){return null},Object.defineProperty(_,"parentElement",{enumerable:!0,get:F}))}function Zf(_){_.style=_.style||{},Object.assign(_.style,{top:"0px",left:"0px",width:Zp+"px",height:a0+"px",margin:"0px",padding:"0px"})}function Vv(_){"clientLeft"in _||(_.clientLeft=0,_.clientTop=0),"clientWidth"in _||(_.clientWidth=Zp,_.clientHeight=a0),"getBoundingClientRect"in _||(_.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function Zh(_){"offsetLeft"in _||(_.offsetLeft=0,_.offsetTop=0),"offsetWidth"in _||(_.offsetWidth=Zp,_.offsetHeight=a0)}function D0(_){"scrollLeft"in _||(_.scrollLeft=0,_.scrollTop=0),"scrollWidth"in _||(_.scrollWidth=Zp,_.scrollHeight=a0)}function B0(_){var w=function(){return!0};_.classList=[],_.classList.add=w,_.classList.remove=w,_.classList.contains=w,_.classList.toggle=w}function yh(){}var bc=function(_){St(M,_);var w=Sr(M);function M(){var F,N=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",ee=arguments.length>1?arguments[1]:void 0;return ve(this,M),We(qt(F=w.call(this)),"className",void 0),We(qt(F),"children",void 0),We(qt(F),"focus",void 0),We(qt(F),"blur",void 0),We(qt(F),"insertBefore",void 0),We(qt(F),"appendChild",void 0),We(qt(F),"removeChild",void 0),We(qt(F),"remove",void 0),We(qt(F),"innerHTML",void 0),We(qt(F),"tagName",void 0),F.className="",F.children=[],F.focus=yh,F.blur=yh,F.insertBefore=yh,F.appendChild=yh,F.removeChild=yh,F.remove=yh,F.innerHTML="",F.tagName=N.toUpperCase(),Ss(qt(F),ee),Zf(qt(F)),B0(qt(F)),Vv(qt(F)),Zh(qt(F)),D0(qt(F)),F}return we(M)}(gh),o0=function(_){St(M,_);var w=Sr(M);function M(){return ve(this,M),w.call(this,"video")}return we(M)}(function(_){St(M,_);var w=Sr(M);function M(F){return ve(this,M),w.call(this,F)}return we(M,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),M}(bc)),Ud={};function s0(){return Ud}var u0=we(function _(){ve(this,_);var w=s0(),M=w.createImage&&w.createImage()||{};return"tagName"in M||(M.tagName="IMG",M.__proto__=_.prototype),Ss(M),B0(M),Object.assign(M,{addEventListener:function(F,N){M["on".concat(F)]=N.bind(M)},removeEventListener:function(F){M["on".concat(F)]=null}}),M}),l0={href:"",protocol:"",host:""},N0=function(_){St(M,_);var w=Sr(M);function M(){return ve(this,M),w.call(this,"body",0)}return we(M,[{key:"addEventListener",value:function(F,N){}},{key:"removeEventListener",value:function(F,N,ee){}},{key:"dispatchEvent",value:function(F){}}]),M}(bc),Zd=function(_){St(M,_);var w=Sr(M);function M(){return ve(this,M),w.call(this,"html",0)}return we(M,[{key:"addEventListener",value:function(F,N){}},{key:"removeEventListener",value:function(F,N){}},{key:"dispatchEvent",value:function(F){}}]),M}(bc),yd={},Vd={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:l0,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(_){return(_=_.toLowerCase())==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):_==="img"?new u0:_==="video"?new o0:new bc(_)},createElementNS:function(_,w){return this.createElement(w)},createTextNode:function(_){return _},getElementById:function(_){return null},getElementsByTagName:function(_){return _=_.toLowerCase(),[]},getElementsByTagNameNS:function(_,w){return this.getElementsByTagName(w)},getElementsByName:function(_){return[]},querySelector:function(_){return null},querySelectorAll:function(_){return[]},addEventListener:function(_,w,M){yd[_]||(yd[_]=[]),yd[_].push(w)},removeEventListener:function(_,w){var M=yd[_];if(M&&M.length>0){for(var F=M.length;F--;F>0)if(M[F]===w){M.splice(F,1);break}}},dispatchEvent:function(_){var w=_.type,M=yd[w];if(M)for(var F=0;F<M.length;F++)M[F](_);_.target&&typeof _.target["on"+w]=="function"&&_.target["on"+w](_)},createEvent:function(_){return new Yu(_)}};Vd.documentElement=new Zd,Vd.head=new bc("head"),Vd.body=new N0,he("match",function(_,w,M){return[function(F){var N=Bn(this),ee=F==null?void 0:xt(F,_);return ee?Ci(ee,F,N):new RegExp(F)[_](Hs(N))},function(F){var N=ia(this),ee=Hs(F),pe=M(w,N,ee);if(pe.done)return pe.value;if(!N.global)return Kn(N,ee);var ue=N.unicode;N.lastIndex=0;for(var Oe,Ge=[],Ve=0;(Oe=Kn(N,ee))!==null;){var Jt=Hs(Oe[0]);Ge[Ve]=Jt,Jt===""&&(N.lastIndex=Kt(ee,So(N.lastIndex),ue)),Ve++}return Ve===0?null:Ge}]});var c0,Ll,z0=tt("isConcatSpreadable"),Ec=xe>=51||!X(function(){var _=[];return _[z0]=!1,_.concat()[0]!==_}),f0=bi("concat"),dv=function(_){if(!Lr(_))return!1;var w=_[z0];return w!==void 0?!!w:pt(_)};if(D({target:"Array",proto:!0,arity:1,forced:!Ec||!f0},{concat:function(_){var w,M,F,N,ee,pe=Li(this),ue=Ct(pe,0),Oe=0;for(w=-1,F=arguments.length;w<F;w++)if(dv(ee=w===-1?pe:arguments[w]))for(N=so(ee),Yr(Oe+N),M=0;M<N;M++,Oe++)M in ee&&xi(ue,Oe,ee[M]);else Yr(Oe+1),xi(ue,Oe++,ee);return ue.length=Oe,ue}}),typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0){var lf=my.getSystemInfoSync();c0=lf.system,lf.platform,lf.language}else{var Cc={versions:(Ll=W.navigator.userAgent,{trident:Ll.indexOf("Trident")>-1,presto:Ll.indexOf("Presto")>-1,webKit:Ll.indexOf("AppleWebKit")>-1,gecko:Ll.indexOf("Gecko")>-1&&Ll.indexOf("KHTML")===-1,mobile:!!Ll.match(/AppleWebKit.*Mobile.*/),ios:!!Ll.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Ll.indexOf("Android")>-1||Ll.indexOf("Linux")>-1,iPhone:Ll.indexOf("iPhone")>-1,iPad:Ll.indexOf("iPad")>-1,webApp:Ll.indexOf("Safari")===-1,weixin:Ll.indexOf("MicroMessenger")>-1,qq:Ll.match(/\sQQ/i)===" qq"}),language:(W.navigator.browserLanguage||W.navigator.language).toLowerCase()};Cc.versions.android||Cc.versions.trident||Cc.versions.presto||Cc.versions.webKit||Cc.versions.gecko||Cc.versions.mobile||Cc.versions.ios||Cc.versions.iPhone||Cc.versions.iPad||Cc.versions.webApp||Cc.versions.weixin||Cc.versions.qq,c0=W.navigator.userAgent,Cc.language}c0.toLowerCase().indexOf("android"),tp("Uint8",function(_){return function(w,M,F){return _(this,w,M,F)}});var vv=wn.f,hp=pl.fastKey,Vp=Bi.set,_h=Bi.getterFor;Cs("Map",function(_){return function(){return _(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(_,w,M,F){var N=_(function(Ge,Ve){pa(Ge,ee),Vp(Ge,{type:w,index:Cu(null),first:void 0,last:void 0,size:0}),Cr||(Ge.size=0),Ve!=null&&Yo(Ve,Ge[F],{that:Ge,AS_ENTRIES:M})}),ee=N.prototype,pe=_h(w),ue=function(Ge,Ve,Jt){var br,Dr,qr=pe(Ge),kn=Oe(Ge,Ve);return kn?kn.value=Jt:(qr.last=kn={index:Dr=hp(Ve,!0),key:Ve,value:Jt,previous:br=qr.last,next:void 0,removed:!1},qr.first||(qr.first=kn),br&&(br.next=kn),Cr?qr.size++:Ge.size++,Dr!=="F"&&(qr.index[Dr]=kn)),Ge},Oe=function(Ge,Ve){var Jt,br=pe(Ge),Dr=hp(Ve);if(Dr!=="F")return br.index[Dr];for(Jt=br.first;Jt;Jt=Jt.next)if(Jt.key==Ve)return Jt};return Il(ee,{clear:function(){for(var Ge=pe(this),Ve=Ge.index,Jt=Ge.first;Jt;)Jt.removed=!0,Jt.previous&&(Jt.previous=Jt.previous.next=void 0),delete Ve[Jt.index],Jt=Jt.next;Ge.first=Ge.last=void 0,Cr?Ge.size=0:this.size=0},delete:function(Ge){var Ve=pe(this),Jt=Oe(this,Ge);if(Jt){var br=Jt.next,Dr=Jt.previous;delete Ve.index[Jt.index],Jt.removed=!0,Dr&&(Dr.next=br),br&&(br.previous=Dr),Ve.first==Jt&&(Ve.first=br),Ve.last==Jt&&(Ve.last=Dr),Cr?Ve.size--:this.size--}return!!Jt},forEach:function(Ge){for(var Ve,Jt=pe(this),br=tl(Ge,arguments.length>1?arguments[1]:void 0);Ve=Ve?Ve.next:Jt.first;)for(br(Ve.value,Ve.key,this);Ve&&Ve.removed;)Ve=Ve.previous},has:function(Ge){return!!Oe(this,Ge)}}),Il(ee,M?{get:function(Ge){var Ve=Oe(this,Ge);return Ve&&Ve.value},set:function(Ge,Ve){return ue(this,Ge===0?0:Ge,Ve)}}:{add:function(Ge){return ue(this,Ge=Ge===0?0:Ge,Ge)}}),Cr&&vv(ee,"size",{get:function(){return pe(this).size}}),N},setStrong:function(_,w,M){var F=w+" Iterator",N=_h(w),ee=_h(F);nh(_,w,function(pe,ue){Vp(this,{type:F,target:pe,state:N(pe),kind:ue,last:void 0})},function(){for(var pe=ee(this),ue=pe.kind,Oe=pe.last;Oe&&Oe.removed;)Oe=Oe.previous;return pe.target&&(pe.last=Oe=Oe?Oe.next:pe.state.first)?ue=="keys"?{value:Oe.key,done:!1}:ue=="values"?{value:Oe.value,done:!1}:{value:[Oe.key,Oe.value],done:!1}:(pe.target=void 0,{value:void 0,done:!0})},M?"entries":"values",!M,!0),Ki(w)}});var _d=Tt([].join),xd=Zu!=Object,U0=wr("join",",");D({target:"Array",proto:!0,forced:xd||!U0},{join:function(_){return _d(Vo(this),_===void 0?",":_)}});var Z0=X(function(){co(1)});D({target:"Object",stat:!0,forced:Z0},{keys:function(_){return co(Li(_))}});var h0=new Map,p0=new Map,d0=new Map,cf=function(_){St(M,_);var w=Sr(M);function M(){var F;return ve(this,M),We(qt(F=w.call(this)),"onabort",void 0),We(qt(F),"onerror",void 0),We(qt(F),"onload",void 0),We(qt(F),"onloadstart",void 0),We(qt(F),"onprogress",void 0),We(qt(F),"ontimeout",void 0),We(qt(F),"onloadend",void 0),We(qt(F),"onreadystatechange",void 0),We(qt(F),"readyState",void 0),We(qt(F),"response",void 0),We(qt(F),"responseText",void 0),We(qt(F),"_responseType",void 0),We(qt(F),"responseXML",void 0),We(qt(F),"status",void 0),We(qt(F),"statusText",void 0),We(qt(F),"upload",void 0),We(qt(F),"withCredentials",void 0),We(qt(F),"timeout",void 0),We(qt(F),"_url",void 0),We(qt(F),"_method",void 0),F.onabort=null,F.onerror=null,F.onload=null,F.onloadstart=null,F.onprogress=null,F.ontimeout=null,F.onloadend=null,F.onreadystatechange=null,F.readyState=0,F.response=null,F.responseText=null,F._responseType="text",F.responseXML=null,F.status=0,F.statusText="",F.upload={},F.withCredentials=!1,h0.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),F}return we(M,[{key:"responseType",set:function(F){this._responseType=F}},{key:"abort",value:function(){var F=d0.get("requestTask");F&&F.abort()}},{key:"getAllResponseHeaders",value:function(){var F=p0.get("responseHeader");return Object.keys(F).map(function(N){return"".concat(N,": ").concat(F[N])}).join(`
`)}},{key:"getResponseHeader",value:function(F){return p0.get("responseHeader")[F]}},{key:"open",value:function(F,N,ee){this._method=F,this._url=N}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(F,N){var ee=h0.get("requestHeader");ee[F]=N,h0.set("requestHeader",ee)}},{key:"addEventListener",value:function(F,N){var ee=this;typeof N=="function"&&(this["on"+F]=function(){var pe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};pe.target=pe.target||ee,N.call(ee,pe)})}},{key:"removeEventListener",value:function(F,N){this["on"+F]===N&&(this["on"+F]=null)}}]),M}(mh);We(cf,"UNSEND",void 0),We(cf,"OPENED",void 0),We(cf,"HEADERS_RECEIVED",void 0),We(cf,"LOADING",void 0),We(cf,"DONE",void 0),cf.UNSEND=0,cf.OPENED=1,cf.HEADERS_RECEIVED=2,cf.LOADING=3,cf.DONE=4;var Vh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,V0=typeof wx!="undefined"&&wx!==null&&(wx.request!==void 0||wx.miniProgram!==void 0),v0=Vh||V0;v0||W.XMLHttpRequest,v0||W.location;function bd(_){return[_+1&255,_+1>>8&255,_+1>>8>>8&255]}var j0=er.filter,G0=bi("filter");function jd(_,w){var M=_.color;return M&&M.length?M:[1,1,1,1]}function Gd(_,w,M){return M.length===2?[M[0],M[1],0]:[M[0],M[1],M[2]]}function Hd(_,w){return _.filter?[1]:[0]}function m0(_,w,M,F){return[w]}D({target:"Array",proto:!0,forced:!G0},{filter:function(_){return j0(this,_,arguments.length>1?arguments[1]:void 0)}});var jp=pp,H0=pp;function pp(_,w,M){M=M||2;var F,N,ee,pe,ue,Oe,Ge,Ve=w&&w.length,Jt=Ve?w[0]*M:_.length,br=mv(_,0,Jt,M,!0),Dr=[];if(!br||br.next===br.prev)return Dr;if(Ve&&(br=function(kn,Cn,Dn,dn){var ai,Ei,Eo,ro,$a,no=[];for(ai=0,Ei=Cn.length;ai<Ei;ai++)Eo=Cn[ai]*dn,ro=ai<Ei-1?Cn[ai+1]*dn:kn.length,($a=mv(kn,Eo,ro,dn,!1))===$a.next&&($a.steiner=!0),no.push(W0($a));for(no.sort(jv),ai=0;ai<no.length;ai++)Dn=km(no[ai],Dn);return Dn}(_,w,br,M)),_.length>80*M){F=ee=_[0],N=pe=_[1];for(var qr=M;qr<Jt;qr+=M)(ue=_[qr])<F&&(F=ue),(Oe=_[qr+1])<N&&(N=Oe),ue>ee&&(ee=ue),Oe>pe&&(pe=Oe);Ge=(Ge=Math.max(ee-F,pe-N))!==0?32767/Ge:0}return Wd(br,Dr,M,F,N,Ge,0),Dr}function mv(_,w,M,F,N){var ee,pe;if(N===Rm(_,w,M,F)>0)for(ee=w;ee<M;ee+=F)pe=Pg(ee,_[ee],_[ee+1],pe);else for(ee=M-F;ee>=w;ee-=F)pe=Pg(ee,_[ee],_[ee+1],pe);return pe&&Gv(pe,pe.next)&&(yv(pe),pe=pe.next),pe}function dp(_,w){if(!_)return _;w||(w=_);var M,F=_;do if(M=!1,F.steiner||!Gv(F,F.next)&&Js(F.prev,F,F.next)!==0)F=F.next;else{if(yv(F),(F=w=F.prev)===F.next)break;M=!0}while(M||F!==w);return w}function Wd(_,w,M,F,N,ee,pe){if(_){!pe&&ee&&function(Ve,Jt,br,Dr){var qr=Ve;do qr.z===0&&(qr.z=Vf(qr.x,qr.y,Jt,br,Dr)),qr.prevZ=qr.prev,qr.nextZ=qr.next,qr=qr.next;while(qr!==Ve);qr.prevZ.nextZ=null,qr.prevZ=null,function(kn){var Cn,Dn,dn,ai,Ei,Eo,ro,$a,no=1;do{for(Dn=kn,kn=null,Ei=null,Eo=0;Dn;){for(Eo++,dn=Dn,ro=0,Cn=0;Cn<no&&(ro++,dn=dn.nextZ);Cn++);for($a=no;ro>0||$a>0&&dn;)ro!==0&&($a===0||!dn||Dn.z<=dn.z)?(ai=Dn,Dn=Dn.nextZ,ro--):(ai=dn,dn=dn.nextZ,$a--),Ei?Ei.nextZ=ai:kn=ai,ai.prevZ=Ei,Ei=ai;Dn=dn}Ei.nextZ=null,no*=2}while(Eo>1)}(qr)}(_,F,N,ee);for(var ue,Oe,Ge=_;_.prev!==_.next;)if(ue=_.prev,Oe=_.next,ee?Aa(_,F,N,ee):ka(_))w.push(ue.i/M|0),w.push(_.i/M|0),w.push(Oe.i/M|0),yv(_),_=Oe.next,Ge=Oe.next;else if((_=Oe)===Ge){pe?pe===1?Wd(_=gv(dp(_),w,M),w,M,F,N,ee,2):pe===2&&Im(_,w,M,F,N,ee):Wd(dp(_),w,M,F,N,ee,1);break}}}function ka(_){var w=_.prev,M=_,F=_.next;if(Js(w,M,F)>=0)return!1;for(var N=w.x,ee=M.x,pe=F.x,ue=w.y,Oe=M.y,Ge=F.y,Ve=N<ee?N<pe?N:pe:ee<pe?ee:pe,Jt=ue<Oe?ue<Ge?ue:Ge:Oe<Ge?Oe:Ge,br=N>ee?N>pe?N:pe:ee>pe?ee:pe,Dr=ue>Oe?ue>Ge?ue:Ge:Oe>Ge?Oe:Ge,qr=F.next;qr!==w;){if(qr.x>=Ve&&qr.x<=br&&qr.y>=Jt&&qr.y<=Dr&&Ed(N,ue,ee,Oe,pe,Ge,qr.x,qr.y)&&Js(qr.prev,qr,qr.next)>=0)return!1;qr=qr.next}return!0}function Aa(_,w,M,F){var N=_.prev,ee=_,pe=_.next;if(Js(N,ee,pe)>=0)return!1;for(var ue=N.x,Oe=ee.x,Ge=pe.x,Ve=N.y,Jt=ee.y,br=pe.y,Dr=ue<Oe?ue<Ge?ue:Ge:Oe<Ge?Oe:Ge,qr=Ve<Jt?Ve<br?Ve:br:Jt<br?Jt:br,kn=ue>Oe?ue>Ge?ue:Ge:Oe>Ge?Oe:Ge,Cn=Ve>Jt?Ve>br?Ve:br:Jt>br?Jt:br,Dn=Vf(Dr,qr,w,M,F),dn=Vf(kn,Cn,w,M,F),ai=_.prevZ,Ei=_.nextZ;ai&&ai.z>=Dn&&Ei&&Ei.z<=dn;){if(ai.x>=Dr&&ai.x<=kn&&ai.y>=qr&&ai.y<=Cn&&ai!==N&&ai!==pe&&Ed(ue,Ve,Oe,Jt,Ge,br,ai.x,ai.y)&&Js(ai.prev,ai,ai.next)>=0||(ai=ai.prevZ,Ei.x>=Dr&&Ei.x<=kn&&Ei.y>=qr&&Ei.y<=Cn&&Ei!==N&&Ei!==pe&&Ed(ue,Ve,Oe,Jt,Ge,br,Ei.x,Ei.y)&&Js(Ei.prev,Ei,Ei.next)>=0))return!1;Ei=Ei.nextZ}for(;ai&&ai.z>=Dn;){if(ai.x>=Dr&&ai.x<=kn&&ai.y>=qr&&ai.y<=Cn&&ai!==N&&ai!==pe&&Ed(ue,Ve,Oe,Jt,Ge,br,ai.x,ai.y)&&Js(ai.prev,ai,ai.next)>=0)return!1;ai=ai.prevZ}for(;Ei&&Ei.z<=dn;){if(Ei.x>=Dr&&Ei.x<=kn&&Ei.y>=qr&&Ei.y<=Cn&&Ei!==N&&Ei!==pe&&Ed(ue,Ve,Oe,Jt,Ge,br,Ei.x,Ei.y)&&Js(Ei.prev,Ei,Ei.next)>=0)return!1;Ei=Ei.nextZ}return!0}function gv(_,w,M){var F=_;do{var N=F.prev,ee=F.next.next;!Gv(N,ee)&&Ig(N,F,F.next,ee)&&X0(N,ee)&&X0(ee,N)&&(w.push(N.i/M|0),w.push(F.i/M|0),w.push(ee.i/M|0),yv(F),yv(F.next),F=_=ee),F=F.next}while(F!==_);return dp(F)}function Im(_,w,M,F,N,ee){var pe=_;do{for(var ue=pe.next.next;ue!==pe.prev;){if(pe.i!==ue.i&&g0(pe,ue)){var Oe=kg(pe,ue);return pe=dp(pe,pe.next),Oe=dp(Oe,Oe.next),Wd(pe,w,M,F,N,ee,0),void Wd(Oe,w,M,F,N,ee,0)}ue=ue.next}pe=pe.next}while(pe!==_)}function jv(_,w){return _.x-w.x}function km(_,w){var M=function(N,ee){var pe,ue=ee,Oe=N.x,Ge=N.y,Ve=-1/0;do{if(Ge<=ue.y&&Ge>=ue.next.y&&ue.next.y!==ue.y){var Jt=ue.x+(Ge-ue.y)*(ue.next.x-ue.x)/(ue.next.y-ue.y);if(Jt<=Oe&&Jt>Ve&&(Ve=Jt,pe=ue.x<ue.next.x?ue:ue.next,Jt===Oe))return pe}ue=ue.next}while(ue!==ee);if(!pe)return null;var br,Dr=pe,qr=pe.x,kn=pe.y,Cn=1/0;ue=pe;do Oe>=ue.x&&ue.x>=qr&&Oe!==ue.x&&Ed(Ge<kn?Oe:Ve,Ge,qr,kn,Ge<kn?Ve:Oe,Ge,ue.x,ue.y)&&(br=Math.abs(Ge-ue.y)/(Oe-ue.x),X0(ue,N)&&(br<Cn||br===Cn&&(ue.x>pe.x||ue.x===pe.x&&Pm(pe,ue)))&&(pe=ue,Cn=br)),ue=ue.next;while(ue!==Dr);return pe}(_,w);if(!M)return w;var F=kg(M,_);return dp(F,F.next),dp(M,M.next)}function Pm(_,w){return Js(_.prev,_,w.prev)<0&&Js(w.next,_,_.next)<0}function Vf(_,w,M,F,N){return(_=1431655765&((_=858993459&((_=252645135&((_=16711935&((_=(_-M)*N|0)|_<<8))|_<<4))|_<<2))|_<<1))|(w=1431655765&((w=858993459&((w=252645135&((w=16711935&((w=(w-F)*N|0)|w<<8))|w<<4))|w<<2))|w<<1))<<1}function W0(_){var w=_,M=_;do(w.x<M.x||w.x===M.x&&w.y<M.y)&&(M=w),w=w.next;while(w!==_);return M}function Ed(_,w,M,F,N,ee,pe,ue){return(N-pe)*(w-ue)>=(_-pe)*(ee-ue)&&(_-pe)*(F-ue)>=(M-pe)*(w-ue)&&(M-pe)*(ee-ue)>=(N-pe)*(F-ue)}function g0(_,w){return _.next.i!==w.i&&_.prev.i!==w.i&&!function(M,F){var N=M;do{if(N.i!==M.i&&N.next.i!==M.i&&N.i!==F.i&&N.next.i!==F.i&&Ig(N,N.next,M,F))return!0;N=N.next}while(N!==M);return!1}(_,w)&&(X0(_,w)&&X0(w,_)&&function(M,F){var N=M,ee=!1,pe=(M.x+F.x)/2,ue=(M.y+F.y)/2;do N.y>ue!=N.next.y>ue&&N.next.y!==N.y&&pe<(N.next.x-N.x)*(ue-N.y)/(N.next.y-N.y)+N.x&&(ee=!ee),N=N.next;while(N!==M);return ee}(_,w)&&(Js(_.prev,_,w.prev)||Js(_,w.prev,w))||Gv(_,w)&&Js(_.prev,_,_.next)>0&&Js(w.prev,w,w.next)>0)}function Js(_,w,M){return(w.y-_.y)*(M.x-w.x)-(w.x-_.x)*(M.y-w.y)}function Gv(_,w){return _.x===w.x&&_.y===w.y}function Ig(_,w,M,F){var N=Wv(Js(_,w,M)),ee=Wv(Js(_,w,F)),pe=Wv(Js(M,F,_)),ue=Wv(Js(M,F,w));return N!==ee&&pe!==ue||!(N!==0||!Hv(_,M,w))||!(ee!==0||!Hv(_,F,w))||!(pe!==0||!Hv(M,_,F))||!(ue!==0||!Hv(M,w,F))}function Hv(_,w,M){return w.x<=Math.max(_.x,M.x)&&w.x>=Math.min(_.x,M.x)&&w.y<=Math.max(_.y,M.y)&&w.y>=Math.min(_.y,M.y)}function Wv(_){return _>0?1:_<0?-1:0}function X0(_,w){return Js(_.prev,_,_.next)<0?Js(_,w,_.next)>=0&&Js(_,_.prev,w)>=0:Js(_,w,_.prev)<0||Js(_,_.next,w)<0}function kg(_,w){var M=new Lm(_.i,_.x,_.y),F=new Lm(w.i,w.x,w.y),N=_.next,ee=w.prev;return _.next=w,w.prev=_,M.next=N,N.prev=M,F.next=M,M.prev=F,ee.next=F,F.prev=ee,F}function Pg(_,w,M,F){var N=new Lm(_,w,M);return F?(N.next=F.next,N.prev=F,F.next.prev=N,F.next=N):(N.prev=N,N.next=N),N}function yv(_){_.next.prev=_.prev,_.prev.next=_.next,_.prevZ&&(_.prevZ.nextZ=_.nextZ),_.nextZ&&(_.nextZ.prevZ=_.prevZ)}function Lm(_,w,M){this.i=_,this.x=w,this.y=M,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rm(_,w,M,F){for(var N=0,ee=w,pe=M-F;ee<M;ee+=F)N+=(_[pe]-_[ee])*(_[ee+1]+_[pe+1]),pe=ee;return N}pp.deviation=function(_,w,M,F){var N=w&&w.length,ee=N?w[0]*M:_.length,pe=Math.abs(Rm(_,0,ee,M));if(N)for(var ue=0,Oe=w.length;ue<Oe;ue++){var Ge=w[ue]*M,Ve=ue<Oe-1?w[ue+1]*M:_.length;pe-=Math.abs(Rm(_,Ge,Ve,M))}var Jt=0;for(ue=0;ue<F.length;ue+=3){var br=F[ue]*M,Dr=F[ue+1]*M,qr=F[ue+2]*M;Jt+=Math.abs((_[br]-_[qr])*(_[Dr+1]-_[br+1])-(_[br]-_[Dr])*(_[qr+1]-_[br+1]))}return pe===0&&Jt===0?0:Math.abs((Jt-pe)/pe)},pp.flatten=function(_){for(var w=_[0][0].length,M={vertices:[],holes:[],dimensions:w},F=0,N=0;N<_.length;N++){for(var ee=0;ee<_[N].length;ee++)for(var pe=0;pe<w;pe++)M.vertices.push(_[N][ee][pe]);N>0&&(F+=_[N-1].length,M.holes.push(F))}return M},jp.default=H0;var Lg=Tt(1 .valueOf),Rg=Tt("".replace),Xv=`[	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]`,Vy=RegExp("^"+Xv+Xv+"*"),jy=RegExp(Xv+Xv+"*$"),Om=function(_){return function(w){var M=Hs(Bn(w));return 1&_&&(M=Rg(M,Vy,"")),2&_&&(M=Rg(M,jy,"")),M}},Gy={start:Om(1),end:Om(2),trim:Om(3)},Yv=ha.f,Hy=De.f,Wy=wn.f,Xy=Gy.trim,Xd=Ue.Number,Fm=Xd.prototype,Yy=Ue.TypeError,qy=Tt("".slice),qv=Tt("".charCodeAt),$y=function(_){var w=jr(_,"number");return typeof w=="bigint"?w:Ky(w)},Ky=function(_){var w,M,F,N,ee,pe,ue,Oe,Ge=jr(_,"number");if(se(Ge))throw Yy("Cannot convert a Symbol value to a number");if(typeof Ge=="string"&&Ge.length>2){if(Ge=Xy(Ge),(w=qv(Ge,0))===43||w===45){if((M=qv(Ge,2))===88||M===120)return NaN}else if(w===48){switch(qv(Ge,1)){case 66:case 98:F=2,N=49;break;case 79:case 111:F=8,N=55;break;default:return+Ge}for(pe=(ee=qy(Ge,2)).length,ue=0;ue<pe;ue++)if((Oe=qv(ee,ue))<48||Oe>N)return NaN;return parseInt(ee,F)}}return+Ge};if(P("Number",!Xd(" 0o1")||!Xd("0b1")||Xd("+0x1"))){for(var $v,Y0=function(_){var w=arguments.length<1?0:Xd($y(_)),M=this;return da(Fm,M)&&X(function(){Lg(M)})?Zc(Object(w),M,Y0):w},Og=Cr?Yv(Xd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),q0=0;Og.length>q0;q0++)on(Xd,$v=Og[q0])&&!on(Y0,$v)&&Wy(Y0,$v,Hy(Xd,$v));Y0.prototype=Fm,Fm.constructor=Y0,Ra(Ue,"Number",Y0,{constructor:!0})}var Fg=RangeError,Dm=RangeError,Kv=String,Gp=Math.floor,Hp=Tt(function(_){var w=Hs(Bn(this)),M="",F=ti(_);if(F<0||F==1/0)throw Fg("Wrong number of repetitions");for(;F>0;(F>>>=1)&&(w+=w))1&F&&(M+=w);return M}),Qv=Tt("".slice),y0=Tt(1 .toFixed),Yd=function(_,w,M){return w===0?M:w%2==1?Yd(_,w-1,M*_):Yd(_*_,w/2,M)},Cd=function(_,w,M){for(var F=-1,N=M;++F<6;)N+=w*_[F],_[F]=N%1e7,N=Gp(N/1e7)},_v=function(_,w){for(var M=6,F=0;--M>=0;)F+=_[M],_[M]=Gp(F/w),F=F%w*1e7},Bm=function(_){for(var w=6,M="";--w>=0;)if(M!==""||w===0||_[w]!==0){var F=Kv(_[w]);M=M===""?F:M+Hp("0",7-F.length)+F}return M},Dg=X(function(){return y0(8e-5,3)!=="0.000"||y0(.9,0)!=="1"||y0(1.255,2)!=="1.25"||y0(1000000000000000100,0)!=="1000000000000000128"})||!X(function(){y0({})});function Jv(_){return typeof _=="number"}function xh(_){var w=Math.max(Math.min(85.0511287798,_[1]),-85.0511287798),M=Math.PI/180,F=_[0]*M,N=w*M;return N=Math.log(Math.tan(Math.PI/4+N/2)),F=(256<<20)*(.5/Math.PI*F+.5),N=(256<<20)*(-.5/Math.PI*N+(M=.5)),[Math.floor(F),Math.floor(N)]}D({target:"Number",proto:!0,forced:Dg},{toFixed:function(_){var w,M,F,N,ee=Lg(this),pe=ti(_),ue=[0,0,0,0,0,0],Oe="",Ge="0";if(pe<0||pe>20)throw Dm("Incorrect fraction digits");if(ee!=ee)return"NaN";if(ee<=-1e21||ee>=1e21)return Kv(ee);if(ee<0&&(Oe="-",ee=-ee),ee>1e-21)if(M=(w=function(Ve){for(var Jt=0,br=Ve;br>=4096;)Jt+=12,br/=4096;for(;br>=2;)Jt+=1,br/=2;return Jt}(ee*Yd(2,69,1))-69)<0?ee*Yd(2,-w,1):ee/Yd(2,w,1),M*=4503599627370496,(w=52-w)>0){for(Cd(ue,0,M),F=pe;F>=7;)Cd(ue,1e7,0),F-=7;for(Cd(ue,Yd(10,F,1),0),F=w-1;F>=23;)_v(ue,1<<23),F-=23;_v(ue,1<<F),Cd(ue,1,1),_v(ue,2),Ge=Bm(ue)}else Cd(ue,0,M),Cd(ue,1<<-w,0),Ge=Bm(ue)+Hp("0",pe);return Ge=pe>0?Oe+((N=Ge.length)<=pe?"0."+Hp("0",pe-N)+Ge:Qv(Ge,0,N-pe)+"."+Qv(Ge,N-pe)):Oe+Ge}});var Rl,Nm=/"/g,zm=Tt("".replace);D({target:"String",proto:!0,forced:(Rl="sub",X(function(){var _=""[Rl]('"');return _!==_.toLowerCase()||_.split('"').length>3}))},{sub:function(){return _="sub",w="",M="",F=Hs(Bn(this)),N="<"+_,w!==""&&(N+=" "+w+'="'+zm(Hs(M),Nm,"&quot;")+'"'),N+">"+F+"</"+_+">";var _,w,M,F,N}});var em=RegExp.prototype,tm=mn.PROPER,rm=RegExp.prototype.toString,Bg=X(function(){return rm.call({source:"a",flags:"b"})!="/a/b"}),Ng=tm&&rm.name!="toString";(Bg||Ng)&&Ra(RegExp.prototype,"toString",function(){var _=ia(this);return"/"+Hs(_.source)+"/"+Hs(function(w){var M=w.flags;return M!==void 0||"flags"in em||on(w,"flags")||!da(em,w)?M:Ci(_c,w)}(_))},{unsafe:!0});var nm=typeof Float32Array!="undefined"?Float32Array:Array;function $u(){var _=new nm(2);return nm!=Float32Array&&(_[0]=0,_[1]=0),_}function im(_,w){var M=new nm(2);return M[0]=_,M[1]=w,M}function $0(_,w){return _[0]=w[0],_[1]=w[1],_}function vp(_,w,M){return _[0]=w[0]+M[0],_[1]=w[1]+M[1],_}function Y(_,w,M){return _[0]=w[0]-M[0],_[1]=w[1]-M[1],_}function _0(_,w){var M=w[0],F=w[1],N=M*M+F*F;return N>0&&(N=1/Math.sqrt(N)),_[0]=w[0]*N,_[1]=w[1]*N,_}function K0(_,w){return _[0]*w[0]+_[1]*w[1]}Math.hypot||(Math.hypot=function(){for(var _=0,w=arguments.length;w--;)_+=arguments[w]*arguments[w];return Math.sqrt(_)});var Um,xv=Y,Q0=(Um=$u(),$u()),Nu=($u(),$u()),Wp=$u(),bh=$u();function bv(_,w,M,F,N){return vp(_,M,F),_0(_,_),[N/K0(w=im(-_[1],_[0]),im(-M[1],M[0])),w]}function Xp(_,w){return function(M,F,N){return M[0]=F,M[1]=N,M}(_,-w[1],w[0])}function qd(_,w,M){return xv(_,w,M),_0(_,_),_}function Ev(_,w){return _[0]===w[0]&&_[1]===w[1]}var Zm=function(){function _(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};ve(this,_),We(this,"complex",void 0),We(this,"join",void 0),We(this,"cap",void 0),We(this,"miterLimit",void 0),We(this,"thickness",void 0),We(this,"normal",void 0),We(this,"lastFlip",-1),We(this,"miter",im(0,0)),We(this,"started",!1),We(this,"dash",!1),We(this,"totalDistance",0),We(this,"currentIndex",0),this.join=w.join||"miter",this.cap=w.cap||"butt",this.miterLimit=w.miterLimit||10,this.thickness=w.thickness||1,this.dash=w.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return we(_,[{key:"extrude_gaode2",value:function(w,M){var F=this.complex;if(w.length<=1)return F;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var N=w.length,ee=F.startIndex,pe=1;pe<N;pe++){var ue,Oe,Ge,Ve=w[pe-1];Ve.push((ue=M[pe-1][2])!==null&&ue!==void 0?ue:0);var Jt=M[pe-1],br=w[pe];br.push((Oe=M[pe][2])!==null&&Oe!==void 0?Oe:0);var Dr=M[pe],qr=pe<w.length-1?[].concat(It(w[pe+1]),[(Ge=M[pe+1][2])!==null&&Ge!==void 0?Ge:0]):null,kn=pe<M.length-1?M[pe+1]:null;ee+=this.segment_gaode2(F,ee,Ve,br,qr,Jt,Dr,kn)}if(this.dash)for(var Cn=0;Cn<F.positions.length/6;Cn++)F.positions[6*Cn+5]=this.totalDistance;return F.startIndex=F.positions.length/6,F}},{key:"simpleExtrude_gaode2",value:function(w,M){var F=this.complex;if(w.length<=1)return F;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var N=w.length,ee=F.startIndex,pe=1;pe<N;pe++){var ue,Oe,Ge,Ve=w[pe-1];Ve.push((ue=M[pe-1][2])!==null&&ue!==void 0?ue:0);var Jt=M[pe-1],br=w[pe];br.push((Oe=M[pe][2])!==null&&Oe!==void 0?Oe:0);var Dr=M[pe],qr=pe<w.length-1?[].concat(It(w[pe+1]),[(Ge=M[pe+1][2])!==null&&Ge!==void 0?Ge:0]):null,kn=pe<M.length-1?M[pe+1]:null;ee+=this.simpleSegment(F,ee,Ve,br,qr,Jt,Dr,kn)}if(this.dash)for(var Cn=0;Cn<F.positions.length/6;Cn++)F.positions[6*Cn+5]=this.totalDistance;return F.startIndex=F.positions.length/6,F}},{key:"extrude",value:function(w){var M=this.complex;if(w.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var F=w.length,N=M.startIndex,ee=1;ee<F;ee++){var pe=w[ee-1],ue=w[ee],Oe=ee<w.length-1?w[ee+1]:null;N+=this.segment(M,N,pe,ue,Oe)}if(this.dash)for(var Ge=0;Ge<M.positions.length/6;Ge++)M.positions[6*Ge+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"simpleExtrude",value:function(w){var M=this.complex;if(w.length<=1)return M;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var F=w.length,N=M.startIndex,ee=1;ee<F;ee++){var pe=w[ee-1],ue=w[ee],Oe=ee<w.length-1?w[ee+1]:null;N+=this.simpleSegment(M,N,pe,ue,Oe)}if(this.dash)for(var Ge=0;Ge<M.positions.length/6;Ge++)M.positions[6*Ge+5]=this.totalDistance;return M.startIndex=M.positions.length/6,M}},{key:"segment_gaode2",value:function(w,M,F,N,ee,pe,ue,Oe){var Ge=0,Ve=w.indices,Jt=w.positions,br=w.normals,Dr=this.cap==="square",qr=this.join==="bevel",kn=xh([ue[0],ue[1]]),Cn=xh([pe[0],pe[1]]);qd(Nu,N,F);var Dn=0;if(this.dash&&(Dn=this.lineSegmentDistance(kn,Cn),this.totalDistance+=Dn),this.normal||(this.normal=$u(),Xp(this.normal,Nu)),!this.started)if(this.started=!0,Dr){var dn=$u(),ai=$u();vp(dn,this.normal,Nu),vp(ai,this.normal,Nu),br.push(ai[0],ai[1],0),br.push(dn[0],dn[1],0),Jt.push(F[0],F[1],0|F[2],this.totalDistance-Dn,-this.thickness,0|F[2]),this.complex.indexes.push(this.currentIndex),Jt.push(F[0],F[1],0|F[2],this.totalDistance-Dn,this.thickness,0|F[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Jt,br,F,this.normal,this.thickness,this.totalDistance-Dn);if(Ve.push(M+0,M+1,M+2),ee){Ev(N,ee)&&vp(ee,N,_0(ee,Y(ee,N,F))),qd(Wp,ee,N);var Ei=fr(bv(bh,$u(),Nu,Wp,this.thickness),2),Eo=Ei[0],ro=Ei[1],$a=K0(bh,this.normal)<0?-1:1,no=qr;!no&&this.join==="miter"&&Eo>this.miterLimit&&(no=!0),no?(br.push(this.normal[0],this.normal[1],0),br.push(ro[0],ro[1],0),Jt.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*$a,0|N[2]),this.complex.indexes.push(this.currentIndex),Jt.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness*$a,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Ve.push.apply(Ve,It(this.lastFlip!==-$a?[M,M+2,M+3]:[M+2,M+1,M+3])),Ve.push(M+2,M+3,M+4),Xp(Q0,Wp),$0(this.normal,Q0),br.push(this.normal[0],this.normal[1],0),Jt.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*$a,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,Ge+=3):(this.extrusions(Jt,br,N,ro,Eo,this.totalDistance),Ve.push.apply(Ve,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),$a=-1,$0(this.normal,ro),Ge+=2),this.lastFlip=$a}else{if(Xp(this.normal,Nu),Dr){var io=$u(),Kr=$u();xv(Kr,Nu,this.normal),vp(io,Nu,this.normal),br.push(Kr[0],Kr[1],0),br.push(io[0],io[1],0),Jt.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),Jt.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Jt,br,N,this.normal,this.thickness,this.totalDistance);Ve.push.apply(Ve,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Ge+=2}return Ge}},{key:"simpleSegment",value:function(w,M,F,N,ee){var pe=0,ue=w.indices,Oe=w.positions,Ge=w.normals,Ve=xh([N[0],N[1]]),Jt=xh([F[0],F[1]]);qd(Nu,Ve,Jt);var br=0;if(this.dash&&(br=this.lineSegmentDistance(Ve,Jt),this.totalDistance+=br),this.normal||(this.normal=$u(),Xp(this.normal,Nu)),this.started||(this.started=!0,this.extrusions(Oe,Ge,F,this.normal,this.thickness,this.totalDistance-br)),ue.push(M+0,M+1,M+2),ee){var Dr=xh([ee[0],ee[1]]);Ev(Ve,Dr)&&vp(Dr,Ve,_0(Dr,Y(Dr,Ve,Jt))),qd(Wp,Dr,Ve);var qr=fr(bv(bh,$u(),Nu,Wp,this.thickness),2),kn=qr[0],Cn=qr[1];K0(bh,this.normal),this.extrusions(Oe,Ge,N,Cn,kn,this.totalDistance),ue.push.apply(ue,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),$0(this.normal,Cn),pe+=2,this.lastFlip=-1}else Xp(this.normal,Nu),this.extrusions(Oe,Ge,N,this.normal,this.thickness,this.totalDistance),ue.push.apply(ue,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),pe+=2;return pe}},{key:"segment",value:function(w,M,F,N,ee){var pe=0,ue=w.indices,Oe=w.positions,Ge=w.normals,Ve=this.cap==="square",Jt=this.join==="bevel",br=xh([N[0],N[1]]),Dr=xh([F[0],F[1]]);qd(Nu,br,Dr);var qr=0;if(this.dash&&(qr=this.lineSegmentDistance(br,Dr),this.totalDistance+=qr),this.normal||(this.normal=$u(),Xp(this.normal,Nu)),!this.started)if(this.started=!0,Ve){var kn=$u(),Cn=$u();vp(kn,this.normal,Nu),vp(Cn,this.normal,Nu),Ge.push(Cn[0],Cn[1],0),Ge.push(kn[0],kn[1],0),Oe.push(F[0],F[1],0|F[2],this.totalDistance-qr,-this.thickness,0|F[2]),this.complex.indexes.push(this.currentIndex),Oe.push(F[0],F[1],0|F[2],this.totalDistance-qr,this.thickness,0|F[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Oe,Ge,F,this.normal,this.thickness,this.totalDistance-qr);if(ue.push(M+0,M+1,M+2),ee){var Dn=xh([ee[0],ee[1]]);Ev(br,Dn)&&vp(Dn,br,_0(Dn,Y(Dn,br,Dr))),qd(Wp,Dn,br);var dn=fr(bv(bh,$u(),Nu,Wp,this.thickness),2),ai=dn[0],Ei=dn[1],Eo=K0(bh,this.normal)<0?-1:1,ro=Jt;!ro&&this.join==="miter"&&ai>this.miterLimit&&(ro=!0),ro?(Ge.push(this.normal[0],this.normal[1],0),Ge.push(Ei[0],Ei[1],0),Oe.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*Eo,0|N[2]),this.complex.indexes.push(this.currentIndex),Oe.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness*Eo,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,ue.push.apply(ue,It(this.lastFlip!==-Eo?[M,M+2,M+3]:[M+2,M+1,M+3])),ue.push(M+2,M+3,M+4),Xp(Q0,Wp),$0(this.normal,Q0),Ge.push(this.normal[0],this.normal[1],0),Oe.push(N[0],N[1],0|N[2],this.totalDistance,-this.thickness*Eo,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,pe+=3):(this.extrusions(Oe,Ge,N,Ei,ai,this.totalDistance),ue.push.apply(ue,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),Eo=-1,$0(this.normal,Ei),pe+=2),this.lastFlip=Eo}else{if(Xp(this.normal,Nu),Ve){var $a=$u(),no=$u();xv(no,Nu,this.normal),vp($a,Nu,this.normal),Ge.push(no[0],no[1],0),Ge.push($a[0],$a[1],0),Oe.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),Oe.push(N[0],N[1],0|N[2],this.totalDistance,this.thickness,0|N[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(Oe,Ge,N,this.normal,this.thickness,this.totalDistance);ue.push.apply(ue,It(this.lastFlip===1?[M,M+2,M+3]:[M+2,M+1,M+3])),pe+=2}return pe}},{key:"extrusions",value:function(w,M,F,N,ee,pe){M.push(N[0],N[1],0),M.push(N[0],N[1],0),w.push(F[0],F[1],0|F[2],pe,-ee,0|F[2]),this.complex.indexes.push(this.currentIndex),w.push(F[0],F[1],0|F[2],pe,ee,0|F[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(w,M){var F=M[0]-w[0],N=M[1]-w[1];return Math.sqrt(F*F+N*N)}}]),_}();function zg(_){var w=_.coordinates,M=_.originCoordinates,F=_.version,N=new Zm({dash:!0,join:"bevel"});if(F==="GAODE2.x"){var ee=w;Array.isArray(ee[0][0])||(ee=[w]);var pe=M;Array.isArray(pe[0][0])||(pe=[M]);for(var ue=0;ue<ee.length;ue++){var Oe=ee[ue],Ge=pe[ue];N.extrude_gaode2(Oe,Ge)}}else{var Ve=w;Ve[0]&&!Array.isArray(Ve[0][0])&&(Ve=[w]),Ve.forEach(function(br){N.extrude(br)})}var Jt=N.complex;return{vertices:Jt.positions,indices:Jt.indices,normals:Jt.normals,indexes:Jt.indexes,size:6}}function Ug(_){var w=function(M){if(Jv(M[0]))return M;if(Jv(M[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Jv(M[0][0][0])){var F=0,N=0,ee=0;return M.forEach(function(pe){pe.forEach(function(ue){F+=ue[0],N+=ue[1],ee++})}),[F/ee,N/ee,0]}throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}(_.coordinates);return{vertices:[].concat(It(w),It(w),It(w),It(w)),indices:[0,1,2,2,3,0],size:w.length}}function Vm(_){var w=_.coordinates,M=jp.flatten(w),F=M.vertices,N=M.dimensions,ee=M.holes;return{indices:jp(F,ee,N),vertices:F,size:N}}var jm=function(){var _=Pe(Ne().mark(function w(M){var F,N,ee,pe,ue,Oe,Ge,Ve,Jt;return Ne().wrap(function(br){for(;;)switch(br.prev=br.next){case 0:return F=M.descriptors,N=M.features,ee=M.enablePicking,pe=M.iconMap,ue={a_Color:jd,a_Position:Gd,filter:Hd,a_vertexId:m0,a_PickingColor:function(Dr,qr){var kn=Dr.id;return ee?bd(kn):[0,0,0]},a_DistanceAndIndex:function(Dr,qr,kn,Cn,Dn,dn){return dn===void 0?[kn[3],10]:[kn[3],dn]},a_Total_Distance:function(Dr,qr,kn,Cn){return[kn[5]]},a_Size:function(Dr,qr,kn,Cn){var Dn=Dr.size,dn=Dn===void 0?1:Dn;return Array.isArray(dn)?[dn[0],dn[1]]:[dn,0]},a_Normal:function(Dr,qr,kn,Cn,Dn){return Dn},a_Miter:function(Dr,qr,kn,Cn){return[kn[4]]},a_iconMapUV:function(Dr,qr,kn,Cn){var Dn=Dr.texture,dn=pe[Dn]||{x:0,y:0};return[dn.x,dn.y]}},Oe={sizePerElement:0,elements:[]},Ge=0,Ve=[],Jt=3,N.forEach(function(Dr,qr){var kn=zg(Dr),Cn=kn.indices,Dn=kn.vertices,dn=kn.normals,ai=kn.size,Ei=kn.indexes;Cn.forEach(function(no){Ve.push(no+Ge)}),Jt=ai;var Eo=Dn.length/ai;Oe.sizePerElement=Jt,Oe.elements.push({featureIdx:qr,vertices:Dn,normals:dn,offset:Ge}),Ge+=Eo;for(var ro=function(no){var io=(dn==null?void 0:dn.slice(3*no,3*no+3))||[],Kr=Dn.slice(no*ai,no*ai+ai),ln=0;Ei&&Ei[no]!==void 0&&(ln=Ei[no]),F.forEach(function(Di,Ha){var xa;Di&&ue[Di.name]&&(xa=Di.buffer.data).push.apply(xa,It(ue[Di.name](Dr,qr,Kr,no,io,ln)))})},$a=0;$a<Eo;$a++)ro($a)}),br.abrupt("return",{descriptors:F,featureLayout:Oe,indices:Ve});case 8:case"end":return br.stop()}},w)}));return function(w){return _.apply(this,arguments)}}(),am={pointFill:function(){var _=Pe(Ne().mark(function w(M){var F,N,ee,pe,ue,Oe,Ge,Ve,Jt;return Ne().wrap(function(br){for(;;)switch(br.prev=br.next){case 0:return F=M.descriptors,N=M.features,ee=M.enablePicking,pe=M.shape2d,ue={a_Color:jd,a_Position:Gd,filter:Hd,a_vertexId:m0,a_PickingColor:function(Dr,qr){var kn=Dr.id;return ee?bd(kn):[0,0,0]},a_Shape:function(Dr,qr,kn,Cn){var Dn=Dr.shape,dn=Dn===void 0?2:Dn;return[pe.indexOf(dn)]},a_Extrude:function(Dr,qr,kn,Cn){var Dn=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],dn=Cn%4*3;return[Dn[dn],Dn[dn+1],Dn[dn+2]]},a_Size:function(Dr,qr,kn,Cn){var Dn=Dr.size,dn=Dn===void 0?5:Dn;return Array.isArray(dn)?[dn[0]]:[dn]}},Oe={sizePerElement:0,elements:[]},Ge=0,Ve=[],Jt=3,N.forEach(function(Dr,qr){var kn=Ug(Dr),Cn=kn.indices,Dn=kn.vertices,dn=kn.normals,ai=kn.size;Cn.forEach(function($a){Ve.push($a+Ge)}),Jt=ai;var Ei=Dn.length/ai;Oe.sizePerElement=Jt,Oe.elements.push({featureIdx:qr,vertices:Dn,normals:dn,offset:Ge}),Ge+=Ei;for(var Eo=function($a){var no=[],io=Dn.slice($a*ai,$a*ai+ai);F.forEach(function(Kr,ln){var Di;Kr&&ue[Kr.name]&&(Di=Kr.buffer.data).push.apply(Di,It(ue[Kr.name](Dr,qr,io,$a,no,0)))})},ro=0;ro<Ei;ro++)Eo(ro)}),br.abrupt("return",{descriptors:F,featureLayout:Oe,indices:Ve});case 8:case"end":return br.stop()}},w)}));return function(w){return _.apply(this,arguments)}}(),line:jm,polygonFill:function(){var _=Pe(Ne().mark(function w(M){var F,N,ee,pe,ue,Oe,Ge,Ve;return Ne().wrap(function(Jt){for(;;)switch(Jt.prev=Jt.next){case 0:return F=M.descriptors,N=M.features,ee=M.enablePicking,pe={a_Color:jd,a_Position:Gd,filter:Hd,a_vertexId:m0,a_PickingColor:function(br,Dr){var qr=br.id;return ee?bd(qr):[0,0,0]}},ue={sizePerElement:0,elements:[]},Oe=0,Ge=[],Ve=3,N.forEach(function(br,Dr){var qr=Vm(br),kn=qr.indices,Cn=qr.vertices,Dn=qr.normals,dn=qr.size;kn.forEach(function(ro){Ge.push(ro+Oe)}),Ve=dn;var ai=Cn.length/dn;ue.sizePerElement=Ve,ue.elements.push({featureIdx:Dr,vertices:Cn,normals:Dn,offset:Oe}),Oe+=ai;for(var Ei=function(ro){var $a=[],no=Cn.slice(ro*dn,ro*dn+dn);F.forEach(function(io,Kr){var ln;io&&pe[io.name]&&(ln=io.buffer.data).push.apply(ln,It(pe[io.name](br,Dr,no,ro,$a,0)))})},Eo=0;Eo<ai;Eo++)Ei(Eo)}),Jt.abrupt("return",{descriptors:F,featureLayout:ue,indices:Ge});case 8:case"end":return Jt.stop()}},w)}));return function(w){return _.apply(this,arguments)}}()},om=function(_){for(var w=1;w<arguments.length;w++){var M=arguments[w]!=null?arguments[w]:{};w%2?y(Object(M),!0).forEach(function(F){We(_,F,M[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(M)):y(Object(M)).forEach(function(F){Object.defineProperty(_,F,Object.getOwnPropertyDescriptor(M,F))})}return _}({},am);function sm(_){return x0.apply(this,arguments)}function x0(){return(x0=Pe(Ne().mark(function _(w){var M,F;return Ne().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(M=w.workerType,F=w.data,!om[M]){N.next=3;break}return N.abrupt("return",om[M](F));case 3:return N.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(M,'" non-existent.'))));case 4:case"end":return N.stop()}},_)}))).apply(this,arguments)}return ne(sm),ge.WorkerSourceMap=am,ge.createWorker=ne,ge.worker=sm,ge}({})},66213:function(ci,Ae,de){"use strict";de.d(Ae,{Z:function(){return y}});var He=de(77608);function ge(Ne,Q){for(;!Object.prototype.hasOwnProperty.call(Ne,Q)&&(Ne=(0,He.Z)(Ne),Ne!==null););return Ne}function y(){return typeof Reflect!="undefined"&&Reflect.get?y=Reflect.get.bind():y=function(Q,Pe,ve){var lt=ge(Q,Pe);if(!!lt){var we=Object.getOwnPropertyDescriptor(lt,Pe);return we.get?we.get.call(arguments.length<3?Q:ve):we.value}},y.apply(this,arguments)}},38163:function(ci){ci.exports=Ae;function Ae(ge,y){var Ne=ge&&ge.type,Q;if(Ne==="FeatureCollection")for(Q=0;Q<ge.features.length;Q++)Ae(ge.features[Q],y);else if(Ne==="GeometryCollection")for(Q=0;Q<ge.geometries.length;Q++)Ae(ge.geometries[Q],y);else if(Ne==="Feature")Ae(ge.geometry,y);else if(Ne==="Polygon")de(ge.coordinates,y);else if(Ne==="MultiPolygon")for(Q=0;Q<ge.coordinates.length;Q++)de(ge.coordinates[Q],y);return ge}function de(ge,y){if(ge.length!==0){He(ge[0],y);for(var Ne=1;Ne<ge.length;Ne++)He(ge[Ne],!y)}}function He(ge,y){for(var Ne=0,Q=0,Pe=0,ve=ge.length,lt=ve-1;Pe<ve;lt=Pe++){var we=(ge[Pe][0]-ge[lt][0])*(ge[lt][1]+ge[Pe][1]),We=Ne+we;Q+=Math.abs(Ne)>=Math.abs(we)?Ne-We+we:we-We+Ne,Ne=We}Ne+Q>=0!=!!y&&ge.reverse()}},75550:function(ci){"use strict";ci.exports=Ae;function Ae(de,He){this.x=de,this.y=He}Ae.prototype={clone:function(){return new Ae(this.x,this.y)},add:function(de){return this.clone()._add(de)},sub:function(de){return this.clone()._sub(de)},multByPoint:function(de){return this.clone()._multByPoint(de)},divByPoint:function(de){return this.clone()._divByPoint(de)},mult:function(de){return this.clone()._mult(de)},div:function(de){return this.clone()._div(de)},rotate:function(de){return this.clone()._rotate(de)},rotateAround:function(de,He){return this.clone()._rotateAround(de,He)},matMult:function(de){return this.clone()._matMult(de)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(de){return this.x===de.x&&this.y===de.y},dist:function(de){return Math.sqrt(this.distSqr(de))},distSqr:function(de){var He=de.x-this.x,ge=de.y-this.y;return He*He+ge*ge},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(de){return Math.atan2(this.y-de.y,this.x-de.x)},angleWith:function(de){return this.angleWithSep(de.x,de.y)},angleWithSep:function(de,He){return Math.atan2(this.x*He-this.y*de,this.x*de+this.y*He)},_matMult:function(de){var He=de[0]*this.x+de[1]*this.y,ge=de[2]*this.x+de[3]*this.y;return this.x=He,this.y=ge,this},_add:function(de){return this.x+=de.x,this.y+=de.y,this},_sub:function(de){return this.x-=de.x,this.y-=de.y,this},_mult:function(de){return this.x*=de,this.y*=de,this},_div:function(de){return this.x/=de,this.y/=de,this},_multByPoint:function(de){return this.x*=de.x,this.y*=de.y,this},_divByPoint:function(de){return this.x/=de.x,this.y/=de.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var de=this.y;return this.y=this.x,this.x=-de,this},_rotate:function(de){var He=Math.cos(de),ge=Math.sin(de),y=He*this.x-ge*this.y,Ne=ge*this.x+He*this.y;return this.x=y,this.y=Ne,this},_rotateAround:function(de,He){var ge=Math.cos(de),y=Math.sin(de),Ne=He.x+ge*(this.x-He.x)-y*(this.y-He.y),Q=He.y+y*(this.x-He.x)+ge*(this.y-He.y);return this.x=Ne,this.y=Q,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ae.convert=function(de){return de instanceof Ae?de:Array.isArray(de)?new Ae(de[0],de[1]):de}},38929:function(ci,Ae,de){ci.exports.VectorTile=de(22779),de(66024),de(59701)},22779:function(ci,Ae,de){"use strict";var He=de(59701);ci.exports=ge;function ge(Ne,Q){this.layers=Ne.readFields(y,{},Q)}function y(Ne,Q,Pe){if(Ne===3){var ve=new He(Pe,Pe.readVarint()+Pe.pos);ve.length&&(Q[ve.name]=ve)}}},66024:function(ci,Ae,de){"use strict";var He=de(75550);ci.exports=ge;function ge(ve,lt,we,We,St){this.properties={},this.extent=we,this.type=0,this._pbf=ve,this._geometry=-1,this._keys=We,this._values=St,ve.readFields(y,this,lt)}function y(ve,lt,we){ve==1?lt.id=we.readVarint():ve==2?Ne(we,lt):ve==3?lt.type=we.readVarint():ve==4&&(lt._geometry=we.pos)}function Ne(ve,lt){for(var we=ve.readVarint()+ve.pos;ve.pos<we;){var We=lt._keys[ve.readVarint()],St=lt._values[ve.readVarint()];lt.properties[We]=St}}ge.types=["Unknown","Point","LineString","Polygon"],ge.prototype.loadGeometry=function(){var ve=this._pbf;ve.pos=this._geometry;for(var lt=ve.readVarint()+ve.pos,we=1,We=0,St=0,Rt=0,tr=[],qt;ve.pos<lt;){if(We<=0){var Yt=ve.readVarint();we=Yt&7,We=Yt>>3}if(We--,we===1||we===2)St+=ve.readSVarint(),Rt+=ve.readSVarint(),we===1&&(qt&&tr.push(qt),qt=[]),qt.push(new He(St,Rt));else if(we===7)qt&&qt.push(qt[0].clone());else throw new Error("unknown command "+we)}return qt&&tr.push(qt),tr},ge.prototype.bbox=function(){var ve=this._pbf;ve.pos=this._geometry;for(var lt=ve.readVarint()+ve.pos,we=1,We=0,St=0,Rt=0,tr=Infinity,qt=-Infinity,Yt=Infinity,Sr=-Infinity;ve.pos<lt;){if(We<=0){var fr=ve.readVarint();we=fr&7,We=fr>>3}if(We--,we===1||we===2)St+=ve.readSVarint(),Rt+=ve.readSVarint(),St<tr&&(tr=St),St>qt&&(qt=St),Rt<Yt&&(Yt=Rt),Rt>Sr&&(Sr=Rt);else if(we!==7)throw new Error("unknown command "+we)}return[tr,Yt,qt,Sr]},ge.prototype.toGeoJSON=function(ve,lt,we){var We=this.extent*Math.pow(2,we),St=this.extent*ve,Rt=this.extent*lt,tr=this.loadGeometry(),qt=ge.types[this.type],Yt,Sr;function fr(Rr){for(var ie=0;ie<Rr.length;ie++){var _r=Rr[ie],Ot=180-(_r.y+Rt)*360/We;Rr[ie]=[(_r.x+St)*360/We-180,360/Math.PI*Math.atan(Math.exp(Ot*Math.PI/180))-90]}}switch(this.type){case 1:var It=[];for(Yt=0;Yt<tr.length;Yt++)It[Yt]=tr[Yt][0];tr=It,fr(tr);break;case 2:for(Yt=0;Yt<tr.length;Yt++)fr(tr[Yt]);break;case 3:for(tr=Q(tr),Yt=0;Yt<tr.length;Yt++)for(Sr=0;Sr<tr[Yt].length;Sr++)fr(tr[Yt][Sr]);break}tr.length===1?tr=tr[0]:qt="Multi"+qt;var jt={type:"Feature",geometry:{type:qt,coordinates:tr},properties:this.properties};return"id"in this&&(jt.id=this.id),jt};function Q(ve){var lt=ve.length;if(lt<=1)return[ve];for(var we=[],We,St,Rt=0;Rt<lt;Rt++){var tr=Pe(ve[Rt]);tr!==0&&(St===void 0&&(St=tr<0),St===tr<0?(We&&we.push(We),We=[ve[Rt]]):We.push(ve[Rt]))}return We&&we.push(We),we}function Pe(ve){for(var lt=0,we=0,We=ve.length,St=We-1,Rt,tr;we<We;St=we++)Rt=ve[we],tr=ve[St],lt+=(tr.x-Rt.x)*(Rt.y+tr.y);return lt}},59701:function(ci,Ae,de){"use strict";var He=de(66024);ci.exports=ge;function ge(Q,Pe){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=Q,this._keys=[],this._values=[],this._features=[],Q.readFields(y,this,Pe),this.length=this._features.length}function y(Q,Pe,ve){Q===15?Pe.version=ve.readVarint():Q===1?Pe.name=ve.readString():Q===5?Pe.extent=ve.readVarint():Q===2?Pe._features.push(ve.pos):Q===3?Pe._keys.push(ve.readString()):Q===4&&Pe._values.push(Ne(ve))}function Ne(Q){for(var Pe=null,ve=Q.readVarint()+Q.pos;Q.pos<ve;){var lt=Q.readVarint()>>3;Pe=lt===1?Q.readString():lt===2?Q.readFloat():lt===3?Q.readDouble():lt===4?Q.readVarint64():lt===5?Q.readVarint():lt===6?Q.readSVarint():lt===7?Q.readBoolean():null}return Pe}ge.prototype.feature=function(Q){if(Q<0||Q>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[Q];var Pe=this._pbf.readVarint()+this._pbf.pos;return new He(this._pbf,Pe,this.extent,this._keys,this._values)}},53645:function(){},9187:function(ci){"use strict";ci.exports=Ae,ci.exports.default=Ae;function Ae(X,ae,ze){ze=ze||2;var At=ae&&ae.length,Ft=At?ae[0]*ze:X.length,ur=de(X,0,Ft,ze,!0),Tt=[];if(!ur||ur.next===ur.prev)return Tt;var Br,Bn,Sn,Li,gi,on,Xa;if(At&&(ur=ve(X,ae,ur,ze)),X.length>80*ze){Br=Sn=X[0],Bn=Li=X[1];for(var ra=ze;ra<Ft;ra+=ze)gi=X[ra],on=X[ra+1],gi<Br&&(Br=gi),on<Bn&&(Bn=on),gi>Sn&&(Sn=gi),on>Li&&(Li=on);Xa=Math.max(Sn-Br,Li-Bn),Xa=Xa!==0?32767/Xa:0}return ge(ur,Tt,ze,Br,Bn,Xa,0),Tt}function de(X,ae,ze,At,Ft){var ur,Tt;if(Ft===rt(X,ae,ze,At)>0)for(ur=ae;ur<ze;ur+=At)Tt=Ar(ur,X[ur],X[ur+1],Tt);else for(ur=ze-At;ur>=ae;ur-=At)Tt=Ar(ur,X[ur],X[ur+1],Tt);return Tt&&jt(Tt,Tt.next)&&(an(Tt),Tt=Tt.next),Tt}function He(X,ae){if(!X)return X;ae||(ae=X);var ze=X,At;do if(At=!1,!ze.steiner&&(jt(ze,ze.next)||It(ze.prev,ze,ze.next)===0)){if(an(ze),ze=ae=ze.prev,ze===ze.next)break;At=!0}else ze=ze.next;while(At||ze!==ae);return ae}function ge(X,ae,ze,At,Ft,ur,Tt){if(!!X){!Tt&&ur&&Rt(X,At,Ft,ur);for(var Br=X,Bn,Sn;X.prev!==X.next;){if(Bn=X.prev,Sn=X.next,ur?Ne(X,At,Ft,ur):y(X)){ae.push(Bn.i/ze|0),ae.push(X.i/ze|0),ae.push(Sn.i/ze|0),an(X),X=Sn.next,Br=Sn.next;continue}if(X=Sn,X===Br){Tt?Tt===1?(X=Q(He(X),ae,ze),ge(X,ae,ze,At,Ft,ur,2)):Tt===2&&Pe(X,ae,ze,At,Ft,ur):ge(He(X),ae,ze,At,Ft,ur,1);break}}}}function y(X){var ae=X.prev,ze=X,At=X.next;if(It(ae,ze,At)>=0)return!1;for(var Ft=ae.x,ur=ze.x,Tt=At.x,Br=ae.y,Bn=ze.y,Sn=At.y,Li=Ft<ur?Ft<Tt?Ft:Tt:ur<Tt?ur:Tt,gi=Br<Bn?Br<Sn?Br:Sn:Bn<Sn?Bn:Sn,on=Ft>ur?Ft>Tt?Ft:Tt:ur>Tt?ur:Tt,Xa=Br>Bn?Br>Sn?Br:Sn:Bn>Sn?Bn:Sn,ra=At.next;ra!==ae;){if(ra.x>=Li&&ra.x<=on&&ra.y>=gi&&ra.y<=Xa&&Sr(Ft,Br,ur,Bn,Tt,Sn,ra.x,ra.y)&&It(ra.prev,ra,ra.next)>=0)return!1;ra=ra.next}return!0}function Ne(X,ae,ze,At){var Ft=X.prev,ur=X,Tt=X.next;if(It(Ft,ur,Tt)>=0)return!1;for(var Br=Ft.x,Bn=ur.x,Sn=Tt.x,Li=Ft.y,gi=ur.y,on=Tt.y,Xa=Br<Bn?Br<Sn?Br:Sn:Bn<Sn?Bn:Sn,ra=Li<gi?Li<on?Li:on:gi<on?gi:on,Vi=Br>Bn?Br>Sn?Br:Sn:Bn>Sn?Bn:Sn,ga=Li>gi?Li>on?Li:on:gi>on?gi:on,fi=qt(Xa,ra,ae,ze,At),$i=qt(Vi,ga,ae,ze,At),hi=X.prevZ,yi=X.nextZ;hi&&hi.z>=fi&&yi&&yi.z<=$i;){if(hi.x>=Xa&&hi.x<=Vi&&hi.y>=ra&&hi.y<=ga&&hi!==Ft&&hi!==Tt&&Sr(Br,Li,Bn,gi,Sn,on,hi.x,hi.y)&&It(hi.prev,hi,hi.next)>=0||(hi=hi.prevZ,yi.x>=Xa&&yi.x<=Vi&&yi.y>=ra&&yi.y<=ga&&yi!==Ft&&yi!==Tt&&Sr(Br,Li,Bn,gi,Sn,on,yi.x,yi.y)&&It(yi.prev,yi,yi.next)>=0))return!1;yi=yi.nextZ}for(;hi&&hi.z>=fi;){if(hi.x>=Xa&&hi.x<=Vi&&hi.y>=ra&&hi.y<=ga&&hi!==Ft&&hi!==Tt&&Sr(Br,Li,Bn,gi,Sn,on,hi.x,hi.y)&&It(hi.prev,hi,hi.next)>=0)return!1;hi=hi.prevZ}for(;yi&&yi.z<=$i;){if(yi.x>=Xa&&yi.x<=Vi&&yi.y>=ra&&yi.y<=ga&&yi!==Ft&&yi!==Tt&&Sr(Br,Li,Bn,gi,Sn,on,yi.x,yi.y)&&It(yi.prev,yi,yi.next)>=0)return!1;yi=yi.nextZ}return!0}function Q(X,ae,ze){var At=X;do{var Ft=At.prev,ur=At.next.next;!jt(Ft,ur)&&Rr(Ft,At,At.next,ur)&&yt(Ft,ur)&&yt(ur,Ft)&&(ae.push(Ft.i/ze|0),ae.push(At.i/ze|0),ae.push(ur.i/ze|0),an(At),an(At.next),At=X=ur),At=At.next}while(At!==X);return He(At)}function Pe(X,ae,ze,At,Ft,ur){var Tt=X;do{for(var Br=Tt.next.next;Br!==Tt.prev;){if(Tt.i!==Br.i&&fr(Tt,Br)){var Bn=Ue(Tt,Br);Tt=He(Tt,Tt.next),Bn=He(Bn,Bn.next),ge(Tt,ae,ze,At,Ft,ur,0),ge(Bn,ae,ze,At,Ft,ur,0);return}Br=Br.next}Tt=Tt.next}while(Tt!==X)}function ve(X,ae,ze,At){var Ft=[],ur,Tt,Br,Bn,Sn;for(ur=0,Tt=ae.length;ur<Tt;ur++)Br=ae[ur]*At,Bn=ur<Tt-1?ae[ur+1]*At:X.length,Sn=de(X,Br,Bn,At,!1),Sn===Sn.next&&(Sn.steiner=!0),Ft.push(Yt(Sn));for(Ft.sort(lt),ur=0;ur<Ft.length;ur++)ze=we(Ft[ur],ze);return ze}function lt(X,ae){return X.x-ae.x}function we(X,ae){var ze=We(X,ae);if(!ze)return ae;var At=Ue(ze,X);return He(At,At.next),He(ze,ze.next)}function We(X,ae){var ze=ae,At=X.x,Ft=X.y,ur=-Infinity,Tt;do{if(Ft<=ze.y&&Ft>=ze.next.y&&ze.next.y!==ze.y){var Br=ze.x+(Ft-ze.y)*(ze.next.x-ze.x)/(ze.next.y-ze.y);if(Br<=At&&Br>ur&&(ur=Br,Tt=ze.x<ze.next.x?ze:ze.next,Br===At))return Tt}ze=ze.next}while(ze!==ae);if(!Tt)return null;var Bn=Tt,Sn=Tt.x,Li=Tt.y,gi=Infinity,on;ze=Tt;do At>=ze.x&&ze.x>=Sn&&At!==ze.x&&Sr(Ft<Li?At:ur,Ft,Sn,Li,Ft<Li?ur:At,Ft,ze.x,ze.y)&&(on=Math.abs(Ft-ze.y)/(At-ze.x),yt(ze,X)&&(on<gi||on===gi&&(ze.x>Tt.x||ze.x===Tt.x&&St(Tt,ze)))&&(Tt=ze,gi=on)),ze=ze.next;while(ze!==Bn);return Tt}function St(X,ae){return It(X.prev,X,ae.prev)<0&&It(ae.next,X,X.next)<0}function Rt(X,ae,ze,At){var Ft=X;do Ft.z===0&&(Ft.z=qt(Ft.x,Ft.y,ae,ze,At)),Ft.prevZ=Ft.prev,Ft.nextZ=Ft.next,Ft=Ft.next;while(Ft!==X);Ft.prevZ.nextZ=null,Ft.prevZ=null,tr(Ft)}function tr(X){var ae,ze,At,Ft,ur,Tt,Br,Bn,Sn=1;do{for(ze=X,X=null,ur=null,Tt=0;ze;){for(Tt++,At=ze,Br=0,ae=0;ae<Sn&&(Br++,At=At.nextZ,!!At);ae++);for(Bn=Sn;Br>0||Bn>0&&At;)Br!==0&&(Bn===0||!At||ze.z<=At.z)?(Ft=ze,ze=ze.nextZ,Br--):(Ft=At,At=At.nextZ,Bn--),ur?ur.nextZ=Ft:X=Ft,Ft.prevZ=ur,ur=Ft;ze=At}ur.nextZ=null,Sn*=2}while(Tt>1);return X}function qt(X,ae,ze,At,Ft){return X=(X-ze)*Ft|0,ae=(ae-At)*Ft|0,X=(X|X<<8)&16711935,X=(X|X<<4)&252645135,X=(X|X<<2)&858993459,X=(X|X<<1)&1431655765,ae=(ae|ae<<8)&16711935,ae=(ae|ae<<4)&252645135,ae=(ae|ae<<2)&858993459,ae=(ae|ae<<1)&1431655765,X|ae<<1}function Yt(X){var ae=X,ze=X;do(ae.x<ze.x||ae.x===ze.x&&ae.y<ze.y)&&(ze=ae),ae=ae.next;while(ae!==X);return ze}function Sr(X,ae,ze,At,Ft,ur,Tt,Br){return(Ft-Tt)*(ae-Br)>=(X-Tt)*(ur-Br)&&(X-Tt)*(At-Br)>=(ze-Tt)*(ae-Br)&&(ze-Tt)*(ur-Br)>=(Ft-Tt)*(At-Br)}function fr(X,ae){return X.next.i!==ae.i&&X.prev.i!==ae.i&&!Ot(X,ae)&&(yt(X,ae)&&yt(ae,X)&&Qt(X,ae)&&(It(X.prev,X,ae.prev)||It(X,ae.prev,ae))||jt(X,ae)&&It(X.prev,X,X.next)>0&&It(ae.prev,ae,ae.next)>0)}function It(X,ae,ze){return(ae.y-X.y)*(ze.x-ae.x)-(ae.x-X.x)*(ze.y-ae.y)}function jt(X,ae){return X.x===ae.x&&X.y===ae.y}function Rr(X,ae,ze,At){var Ft=_r(It(X,ae,ze)),ur=_r(It(X,ae,At)),Tt=_r(It(ze,At,X)),Br=_r(It(ze,At,ae));return!!(Ft!==ur&&Tt!==Br||Ft===0&&ie(X,ze,ae)||ur===0&&ie(X,At,ae)||Tt===0&&ie(ze,X,At)||Br===0&&ie(ze,ae,At))}function ie(X,ae,ze){return ae.x<=Math.max(X.x,ze.x)&&ae.x>=Math.min(X.x,ze.x)&&ae.y<=Math.max(X.y,ze.y)&&ae.y>=Math.min(X.y,ze.y)}function _r(X){return X>0?1:X<0?-1:0}function Ot(X,ae){var ze=X;do{if(ze.i!==X.i&&ze.next.i!==X.i&&ze.i!==ae.i&&ze.next.i!==ae.i&&Rr(ze,ze.next,X,ae))return!0;ze=ze.next}while(ze!==X);return!1}function yt(X,ae){return It(X.prev,X,X.next)<0?It(X,ae,X.next)>=0&&It(X,X.prev,ae)>=0:It(X,ae,X.prev)<0||It(X,X.next,ae)<0}function Qt(X,ae){var ze=X,At=!1,Ft=(X.x+ae.x)/2,ur=(X.y+ae.y)/2;do ze.y>ur!=ze.next.y>ur&&ze.next.y!==ze.y&&Ft<(ze.next.x-ze.x)*(ur-ze.y)/(ze.next.y-ze.y)+ze.x&&(At=!At),ze=ze.next;while(ze!==X);return At}function Ue(X,ae){var ze=new fe(X.i,X.x,X.y),At=new fe(ae.i,ae.x,ae.y),Ft=X.next,ur=ae.prev;return X.next=ae,ae.prev=X,ze.next=Ft,Ft.prev=ze,At.next=ze,ze.prev=At,ur.next=At,At.prev=ur,At}function Ar(X,ae,ze,At){var Ft=new fe(X,ae,ze);return At?(Ft.next=At.next,Ft.prev=At,At.next.prev=Ft,At.next=Ft):(Ft.prev=Ft,Ft.next=Ft),Ft}function an(X){X.next.prev=X.prev,X.prev.next=X.next,X.prevZ&&(X.prevZ.nextZ=X.nextZ),X.nextZ&&(X.nextZ.prevZ=X.prevZ)}function fe(X,ae,ze){this.i=X,this.x=ae,this.y=ze,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ae.deviation=function(X,ae,ze,At){var Ft=ae&&ae.length,ur=Ft?ae[0]*ze:X.length,Tt=Math.abs(rt(X,0,ur,ze));if(Ft)for(var Br=0,Bn=ae.length;Br<Bn;Br++){var Sn=ae[Br]*ze,Li=Br<Bn-1?ae[Br+1]*ze:X.length;Tt-=Math.abs(rt(X,Sn,Li,ze))}var gi=0;for(Br=0;Br<At.length;Br+=3){var on=At[Br]*ze,Xa=At[Br+1]*ze,ra=At[Br+2]*ze;gi+=Math.abs((X[on]-X[ra])*(X[Xa+1]-X[on+1])-(X[on]-X[Xa])*(X[ra+1]-X[on+1]))}return Tt===0&&gi===0?0:Math.abs((gi-Tt)/Tt)};function rt(X,ae,ze,At){for(var Ft=0,ur=ae,Tt=ze-At;ur<ze;ur+=At)Ft+=(X[Tt]-X[ur])*(X[ur+1]+X[Tt+1]),Tt=ur;return Ft}Ae.flatten=function(X){for(var ae=X[0][0].length,ze={vertices:[],holes:[],dimensions:ae},At=0,Ft=0;Ft<X.length;Ft++){for(var ur=0;ur<X[Ft].length;ur++)for(var Tt=0;Tt<ae;Tt++)ze.vertices.push(X[Ft][ur][Tt]);Ft>0&&(At+=X[Ft-1].length,ze.holes.push(At))}return ze}},67709:function(ci){function Ae(He){var ge=He.target||He.srcElement;ge.__resizeRAF__&&cancelAnimationFrame(ge.__resizeRAF__),ge.__resizeRAF__=requestAnimationFrame(function(){var y=ge.__resizeTrigger__,Ne=y&&y.__resizeListeners__;Ne&&Ne.forEach(function(Q){Q.call(y,He)})})}var de=function(ge,y){var Ne=this,Q=Ne.document,Pe,ve=Q.attachEvent;typeof navigator!="undefined"&&(Pe=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function lt(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Ae)}if(!ge.__resizeListeners__)if(ge.__resizeListeners__=[],ve)ge.__resizeTrigger__=ge,ge.attachEvent("onresize",Ae);else{getComputedStyle(ge).position==="static"&&(ge.style.position="relative");var we=ge.__resizeTrigger__=Q.createElement("object");we.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),we.setAttribute("class","resize-sensor"),we.setAttribute("tabindex","-1"),we.setAttribute("title",""),we.__resizeElement__=ge,we.onload=lt,we.type="text/html",Pe&&ge.appendChild(we),we.data="about:blank",Pe||ge.appendChild(we)}ge.__resizeListeners__.push(y)};ci.exports=typeof window=="undefined"?de:de.bind(window),ci.exports.unbind=function(He,ge){var y=document.attachEvent,Ne=He.__resizeListeners__||[];if(ge){var Q=Ne.indexOf(ge);Q!==-1&&Ne.splice(Q,1)}else Ne=He.__resizeListeners__=[];if(!Ne.length){if(y)He.detachEvent("onresize",Ae);else if(He.__resizeTrigger__){var Pe=He.__resizeTrigger__.contentDocument,ve=Pe&&Pe.defaultView;ve&&(ve.removeEventListener("resize",Ae),delete ve.__resizeTrigger__),He.__resizeTrigger__=!He.removeChild(He.__resizeTrigger__)}delete He.__resizeListeners__}}},26729:function(ci){"use strict";var Ae=Object.prototype.hasOwnProperty,de="~";function He(){}Object.create&&(He.prototype=Object.create(null),new He().__proto__||(de=!1));function ge(Pe,ve,lt){this.fn=Pe,this.context=ve,this.once=lt||!1}function y(Pe,ve,lt,we,We){if(typeof lt!="function")throw new TypeError("The listener must be a function");var St=new ge(lt,we||Pe,We),Rt=de?de+ve:ve;return Pe._events[Rt]?Pe._events[Rt].fn?Pe._events[Rt]=[Pe._events[Rt],St]:Pe._events[Rt].push(St):(Pe._events[Rt]=St,Pe._eventsCount++),Pe}function Ne(Pe,ve){--Pe._eventsCount==0?Pe._events=new He:delete Pe._events[ve]}function Q(){this._events=new He,this._eventsCount=0}Q.prototype.eventNames=function(){var ve=[],lt,we;if(this._eventsCount===0)return ve;for(we in lt=this._events)Ae.call(lt,we)&&ve.push(de?we.slice(1):we);return Object.getOwnPropertySymbols?ve.concat(Object.getOwnPropertySymbols(lt)):ve},Q.prototype.listeners=function(ve){var lt=de?de+ve:ve,we=this._events[lt];if(!we)return[];if(we.fn)return[we.fn];for(var We=0,St=we.length,Rt=new Array(St);We<St;We++)Rt[We]=we[We].fn;return Rt},Q.prototype.listenerCount=function(ve){var lt=de?de+ve:ve,we=this._events[lt];return we?we.fn?1:we.length:0},Q.prototype.emit=function(ve,lt,we,We,St,Rt){var tr=de?de+ve:ve;if(!this._events[tr])return!1;var qt=this._events[tr],Yt=arguments.length,Sr,fr;if(qt.fn){switch(qt.once&&this.removeListener(ve,qt.fn,void 0,!0),Yt){case 1:return qt.fn.call(qt.context),!0;case 2:return qt.fn.call(qt.context,lt),!0;case 3:return qt.fn.call(qt.context,lt,we),!0;case 4:return qt.fn.call(qt.context,lt,we,We),!0;case 5:return qt.fn.call(qt.context,lt,we,We,St),!0;case 6:return qt.fn.call(qt.context,lt,we,We,St,Rt),!0}for(fr=1,Sr=new Array(Yt-1);fr<Yt;fr++)Sr[fr-1]=arguments[fr];qt.fn.apply(qt.context,Sr)}else{var It=qt.length,jt;for(fr=0;fr<It;fr++)switch(qt[fr].once&&this.removeListener(ve,qt[fr].fn,void 0,!0),Yt){case 1:qt[fr].fn.call(qt[fr].context);break;case 2:qt[fr].fn.call(qt[fr].context,lt);break;case 3:qt[fr].fn.call(qt[fr].context,lt,we);break;case 4:qt[fr].fn.call(qt[fr].context,lt,we,We);break;default:if(!Sr)for(jt=1,Sr=new Array(Yt-1);jt<Yt;jt++)Sr[jt-1]=arguments[jt];qt[fr].fn.apply(qt[fr].context,Sr)}}return!0},Q.prototype.on=function(ve,lt,we){return y(this,ve,lt,we,!1)},Q.prototype.once=function(ve,lt,we){return y(this,ve,lt,we,!0)},Q.prototype.removeListener=function(ve,lt,we,We){var St=de?de+ve:ve;if(!this._events[St])return this;if(!lt)return Ne(this,St),this;var Rt=this._events[St];if(Rt.fn)Rt.fn===lt&&(!We||Rt.once)&&(!we||Rt.context===we)&&Ne(this,St);else{for(var tr=0,qt=[],Yt=Rt.length;tr<Yt;tr++)(Rt[tr].fn!==lt||We&&!Rt[tr].once||we&&Rt[tr].context!==we)&&qt.push(Rt[tr]);qt.length?this._events[St]=qt.length===1?qt[0]:qt:Ne(this,St)}return this},Q.prototype.removeAllListeners=function(ve){var lt;return ve?(lt=de?de+ve:ve,this._events[lt]&&Ne(this,lt)):(this._events=new He,this._eventsCount=0),this},Q.prototype.off=Q.prototype.removeListener,Q.prototype.addListener=Q.prototype.on,Q.prefixed=de,Q.EventEmitter=Q,ci.exports=Q},80645:function(ci,Ae){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ae.read=function(de,He,ge,y,Ne){var Q,Pe,ve=Ne*8-y-1,lt=(1<<ve)-1,we=lt>>1,We=-7,St=ge?Ne-1:0,Rt=ge?-1:1,tr=de[He+St];for(St+=Rt,Q=tr&(1<<-We)-1,tr>>=-We,We+=ve;We>0;Q=Q*256+de[He+St],St+=Rt,We-=8);for(Pe=Q&(1<<-We)-1,Q>>=-We,We+=y;We>0;Pe=Pe*256+de[He+St],St+=Rt,We-=8);if(Q===0)Q=1-we;else{if(Q===lt)return Pe?NaN:(tr?-1:1)*Infinity;Pe=Pe+Math.pow(2,y),Q=Q-we}return(tr?-1:1)*Pe*Math.pow(2,Q-y)},Ae.write=function(de,He,ge,y,Ne,Q){var Pe,ve,lt,we=Q*8-Ne-1,We=(1<<we)-1,St=We>>1,Rt=Ne===23?Math.pow(2,-24)-Math.pow(2,-77):0,tr=y?0:Q-1,qt=y?1:-1,Yt=He<0||He===0&&1/He<0?1:0;for(He=Math.abs(He),isNaN(He)||He===Infinity?(ve=isNaN(He)?1:0,Pe=We):(Pe=Math.floor(Math.log(He)/Math.LN2),He*(lt=Math.pow(2,-Pe))<1&&(Pe--,lt*=2),Pe+St>=1?He+=Rt/lt:He+=Rt*Math.pow(2,1-St),He*lt>=2&&(Pe++,lt/=2),Pe+St>=We?(ve=0,Pe=We):Pe+St>=1?(ve=(He*lt-1)*Math.pow(2,Ne),Pe=Pe+St):(ve=He*Math.pow(2,St-1)*Math.pow(2,Ne),Pe=0));Ne>=8;de[ge+tr]=ve&255,tr+=qt,ve/=256,Ne-=8);for(Pe=Pe<<Ne|ve,we+=Ne;we>0;de[ge+tr]=Pe&255,tr+=qt,Pe/=256,we-=8);de[ge+tr-qt]|=Yt*128}},7375:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});var de=Symbol.for("INJECTION");function He(Pe,ve,lt,we){function We(){return we&&!Reflect.hasMetadata(de,this,ve)&&Reflect.defineMetadata(de,lt(),this,ve),Reflect.hasMetadata(de,this,ve)?Reflect.getMetadata(de,this,ve):lt()}function St(Rt){Reflect.defineMetadata(de,Rt,this,ve)}Object.defineProperty(Pe,ve,{configurable:!0,enumerable:!0,get:We,set:St})}function ge(Pe,ve){return function(lt){return function(we,We){var St=function(){return Pe.get(lt)};He(we,We,St,ve)}}}Ae.makePropertyInjectDecorator=ge;function y(Pe,ve){return function(lt,we){return function(We,St){var Rt=function(){return Pe.getNamed(lt,we)};He(We,St,Rt,ve)}}}Ae.makePropertyInjectNamedDecorator=y;function Ne(Pe,ve){return function(lt,we,We){return function(St,Rt){var tr=function(){return Pe.getTagged(lt,we,We)};He(St,Rt,tr,ve)}}}Ae.makePropertyInjectTaggedDecorator=Ne;function Q(Pe,ve){return function(lt){return function(we,We){var St=function(){return Pe.getAll(lt)};He(we,We,St,ve)}}}Ae.makePropertyMultiInjectDecorator=Q},84879:function(ci,Ae,de){"use strict";var He;He={value:!0};var ge=de(7375);function y(Ne,Q){Q===void 0&&(Q=!0);var Pe=ge.makePropertyInjectDecorator(Ne,Q),ve=ge.makePropertyInjectNamedDecorator(Ne,Q),lt=ge.makePropertyInjectTaggedDecorator(Ne,Q),we=ge.makePropertyMultiInjectDecorator(Ne,Q);return{lazyInject:Pe,lazyInjectNamed:ve,lazyInjectTagged:lt,lazyMultiInject:we}}Ae.Z=y},99934:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.tagProperty=Ae.tagParameter=Ae.decorate=void 0;var He=de(16674),ge=de(6867);function y(we,We,St,Rt){var tr=ge.TAGGED;Q(tr,we,We,Rt,St)}Ae.tagParameter=y;function Ne(we,We,St){var Rt=ge.TAGGED_PROP;Q(Rt,we.constructor,We,St)}Ae.tagProperty=Ne;function Q(we,We,St,Rt,tr){var qt={},Yt=typeof tr=="number",Sr=tr!==void 0&&Yt?tr.toString():St;if(Yt&&St!==void 0)throw new Error(He.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(we,We)&&(qt=Reflect.getMetadata(we,We));var fr=qt[Sr];if(!Array.isArray(fr))fr=[];else for(var It=0,jt=fr;It<jt.length;It++){var Rr=jt[It];if(Rr.key===Rt.key)throw new Error(He.DUPLICATED_METADATA+" "+Rr.key.toString())}fr.push(Rt),qt[Sr]=fr,Reflect.defineMetadata(we,qt,We)}function Pe(we,We){Reflect.decorate(we,We)}function ve(we,We){return function(St,Rt){We(St,Rt,we)}}function lt(we,We,St){typeof St=="number"?Pe([ve(St,we)],We):typeof St=="string"?Reflect.decorate([we],We,St):Pe([we],We)}Ae.decorate=lt},5744:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.inject=Ae.LazyServiceIdentifer=void 0;var He=de(16674),ge=de(6867),y=de(47738),Ne=de(99934),Q=function(){function ve(lt){this._cb=lt}return ve.prototype.unwrap=function(){return this._cb()},ve}();Ae.LazyServiceIdentifer=Q;function Pe(ve){return function(lt,we,We){if(ve===void 0)throw new Error(He.UNDEFINED_INJECT_ANNOTATION(lt.name));var St=new y.Metadata(ge.INJECT_TAG,ve);typeof We=="number"?Ne.tagParameter(lt,we,We,St):Ne.tagProperty(lt,we,St)}}Ae.inject=Pe},64315:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.injectable=void 0;var He=de(16674),ge=de(6867);function y(){return function(Ne){if(Reflect.hasOwnMetadata(ge.PARAM_TYPES,Ne))throw new Error(He.DUPLICATED_INJECTABLE_DECORATOR);var Q=Reflect.getMetadata(ge.DESIGN_PARAM_TYPES,Ne)||[];return Reflect.defineMetadata(ge.PARAM_TYPES,Q,Ne),Ne}}Ae.injectable=y},71693:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.multiInject=void 0;var He=de(6867),ge=de(47738),y=de(99934);function Ne(Q){return function(Pe,ve,lt){var we=new ge.Metadata(He.MULTI_INJECT_TAG,Q);typeof lt=="number"?y.tagParameter(Pe,ve,lt,we):y.tagProperty(Pe,ve,we)}}Ae.multiInject=Ne},38085:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.named=void 0;var He=de(6867),ge=de(47738),y=de(99934);function Ne(Q){return function(Pe,ve,lt){var we=new ge.Metadata(He.NAMED_TAG,Q);typeof lt=="number"?y.tagParameter(Pe,ve,lt,we):y.tagProperty(Pe,ve,we)}}Ae.named=Ne},6515:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.optional=void 0;var He=de(6867),ge=de(47738),y=de(99934);function Ne(){return function(Q,Pe,ve){var lt=new ge.Metadata(He.OPTIONAL_TAG,!0);typeof ve=="number"?y.tagParameter(Q,Pe,ve,lt):y.tagProperty(Q,Pe,lt)}}Ae.optional=Ne},7014:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.postConstruct=void 0;var He=de(16674),ge=de(6867),y=de(47738);function Ne(){return function(Q,Pe,ve){var lt=new y.Metadata(ge.POST_CONSTRUCT,Pe);if(Reflect.hasOwnMetadata(ge.POST_CONSTRUCT,Q.constructor))throw new Error(He.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ge.POST_CONSTRUCT,lt,Q.constructor)}}Ae.postConstruct=Ne},32052:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.tagged=void 0;var He=de(47738),ge=de(99934);function y(Ne,Q){return function(Pe,ve,lt){var we=new He.Metadata(Ne,Q);typeof lt=="number"?ge.tagParameter(Pe,ve,lt,we):ge.tagProperty(Pe,ve,we)}}Ae.tagged=y},55638:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.targetName=void 0;var He=de(6867),ge=de(47738),y=de(99934);function Ne(Q){return function(Pe,ve,lt){var we=new ge.Metadata(He.NAME_TAG,Q);y.tagParameter(Pe,ve,lt,we)}}Ae.targetName=Ne},86757:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.unmanaged=void 0;var He=de(6867),ge=de(47738),y=de(99934);function Ne(){return function(Q,Pe,ve){var lt=new ge.Metadata(He.UNMANAGED_TAG,!0);y.tagParameter(Q,Pe,ve,lt)}}Ae.unmanaged=Ne},44290:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Binding=void 0;var He=de(28421),ge=de(37791),y=function(){function Ne(Q,Pe){this.id=ge.id(),this.activated=!1,this.serviceIdentifier=Q,this.scope=Pe,this.type=He.BindingTypeEnum.Invalid,this.constraint=function(ve){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return Ne.prototype.clone=function(){var Q=new Ne(this.serviceIdentifier,this.scope);return Q.activated=Q.scope===He.BindingScopeEnum.Singleton?this.activated:!1,Q.implementationType=this.implementationType,Q.dynamicValue=this.dynamicValue,Q.scope=this.scope,Q.type=this.type,Q.factory=this.factory,Q.provider=this.provider,Q.constraint=this.constraint,Q.onActivation=this.onActivation,Q.cache=this.cache,Q},Ne}();Ae.Binding=y},23184:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingCount=void 0;var de={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Ae.BindingCount=de},16674:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.STACK_OVERFLOW=Ae.CIRCULAR_DEPENDENCY_IN_FACTORY=Ae.POST_CONSTRUCT_ERROR=Ae.MULTIPLE_POST_CONSTRUCT_METHODS=Ae.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Ae.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Ae.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Ae.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Ae.ARGUMENTS_LENGTH_MISMATCH=Ae.INVALID_DECORATOR_OPERATION=Ae.INVALID_TO_SELF_VALUE=Ae.INVALID_FUNCTION_BINDING=Ae.INVALID_MIDDLEWARE_RETURN=Ae.NO_MORE_SNAPSHOTS_AVAILABLE=Ae.INVALID_BINDING_TYPE=Ae.NOT_IMPLEMENTED=Ae.CIRCULAR_DEPENDENCY=Ae.UNDEFINED_INJECT_ANNOTATION=Ae.MISSING_INJECT_ANNOTATION=Ae.MISSING_INJECTABLE_ANNOTATION=Ae.NOT_REGISTERED=Ae.CANNOT_UNBIND=Ae.AMBIGUOUS_MATCH=Ae.KEY_NOT_FOUND=Ae.NULL_ARGUMENT=Ae.DUPLICATED_METADATA=Ae.DUPLICATED_INJECTABLE_DECORATOR=void 0,Ae.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Ae.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Ae.NULL_ARGUMENT="NULL argument",Ae.KEY_NOT_FOUND="Key Not Found",Ae.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Ae.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Ae.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Ae.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Ae.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var de=function(Ne){return"@inject called with undefined this could mean that the class "+Ne+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Ae.UNDEFINED_INJECT_ANNOTATION=de,Ae.CIRCULAR_DEPENDENCY="Circular dependency found:",Ae.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Ae.INVALID_BINDING_TYPE="Invalid binding type:",Ae.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Ae.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Ae.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Ae.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Ae.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var He=function(){for(var Ne=[],Q=0;Q<arguments.length;Q++)Ne[Q]=arguments[Q];return"The number of constructor arguments in the derived class "+(Ne[0]+" must be >= than the number of constructor arguments of its base class.")};Ae.ARGUMENTS_LENGTH_MISMATCH=He,Ae.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Ae.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Ae.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Ae.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Ae.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ge=function(){for(var Ne=[],Q=0;Q<arguments.length;Q++)Ne[Q]=arguments[Q];return"@postConstruct error in class "+Ne[0]+": "+Ne[1]};Ae.POST_CONSTRUCT_ERROR=ge;var y=function(){for(var Ne=[],Q=0;Q<arguments.length;Q++)Ne[Q]=arguments[Q];return"It looks like there is a circular dependency "+("in one of the '"+Ne[0]+"' bindings. Please investigate bindings with")+("service identifier '"+Ne[1]+"'.")};Ae.CIRCULAR_DEPENDENCY_IN_FACTORY=y,Ae.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.TargetTypeEnum=Ae.BindingTypeEnum=Ae.BindingScopeEnum=void 0;var de={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Ae.BindingScopeEnum=de;var He={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Ae.BindingTypeEnum=He;var ge={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Ae.TargetTypeEnum=ge},6867:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.NON_CUSTOM_TAG_KEYS=Ae.POST_CONSTRUCT=Ae.DESIGN_PARAM_TYPES=Ae.PARAM_TYPES=Ae.TAGGED_PROP=Ae.TAGGED=Ae.MULTI_INJECT_TAG=Ae.INJECT_TAG=Ae.OPTIONAL_TAG=Ae.UNMANAGED_TAG=Ae.NAME_TAG=Ae.NAMED_TAG=void 0,Ae.NAMED_TAG="named",Ae.NAME_TAG="name",Ae.UNMANAGED_TAG="unmanaged",Ae.OPTIONAL_TAG="optional",Ae.INJECT_TAG="inject",Ae.MULTI_INJECT_TAG="multi_inject",Ae.TAGGED="inversify:tagged",Ae.TAGGED_PROP="inversify:tagged_props",Ae.PARAM_TYPES="inversify:paramtypes",Ae.DESIGN_PARAM_TYPES="design:paramtypes",Ae.POST_CONSTRUCT="post_construct";function de(){return[Ae.INJECT_TAG,Ae.MULTI_INJECT_TAG,Ae.NAME_TAG,Ae.UNMANAGED_TAG,Ae.NAMED_TAG,Ae.OPTIONAL_TAG]}Ae.NON_CUSTOM_TAG_KEYS=de()},51389:function(ci,Ae,de){"use strict";var He=this&&this.__awaiter||function(fr,It,jt,Rr){function ie(_r){return _r instanceof jt?_r:new jt(function(Ot){Ot(_r)})}return new(jt||(jt=Promise))(function(_r,Ot){function yt(Ar){try{Ue(Rr.next(Ar))}catch(an){Ot(an)}}function Qt(Ar){try{Ue(Rr.throw(Ar))}catch(an){Ot(an)}}function Ue(Ar){Ar.done?_r(Ar.value):ie(Ar.value).then(yt,Qt)}Ue((Rr=Rr.apply(fr,It||[])).next())})},ge=this&&this.__generator||function(fr,It){var jt={label:0,sent:function(){if(_r[0]&1)throw _r[1];return _r[1]},trys:[],ops:[]},Rr,ie,_r,Ot;return Ot={next:yt(0),throw:yt(1),return:yt(2)},typeof Symbol=="function"&&(Ot[Symbol.iterator]=function(){return this}),Ot;function yt(Ue){return function(Ar){return Qt([Ue,Ar])}}function Qt(Ue){if(Rr)throw new TypeError("Generator is already executing.");for(;jt;)try{if(Rr=1,ie&&(_r=Ue[0]&2?ie.return:Ue[0]?ie.throw||((_r=ie.return)&&_r.call(ie),0):ie.next)&&!(_r=_r.call(ie,Ue[1])).done)return _r;switch(ie=0,_r&&(Ue=[Ue[0]&2,_r.value]),Ue[0]){case 0:case 1:_r=Ue;break;case 4:return jt.label++,{value:Ue[1],done:!1};case 5:jt.label++,ie=Ue[1],Ue=[0];continue;case 7:Ue=jt.ops.pop(),jt.trys.pop();continue;default:if(_r=jt.trys,!(_r=_r.length>0&&_r[_r.length-1])&&(Ue[0]===6||Ue[0]===2)){jt=0;continue}if(Ue[0]===3&&(!_r||Ue[1]>_r[0]&&Ue[1]<_r[3])){jt.label=Ue[1];break}if(Ue[0]===6&&jt.label<_r[1]){jt.label=_r[1],_r=Ue;break}if(_r&&jt.label<_r[2]){jt.label=_r[2],jt.ops.push(Ue);break}_r[2]&&jt.ops.pop(),jt.trys.pop();continue}Ue=It.call(fr,jt)}catch(Ar){Ue=[6,Ar],ie=0}finally{Rr=_r=0}if(Ue[0]&5)throw Ue[1];return{value:Ue[0]?Ue[1]:void 0,done:!0}}},y=this&&this.__spreadArray||function(fr,It){for(var jt=0,Rr=It.length,ie=fr.length;jt<Rr;jt++,ie++)fr[ie]=It[jt];return fr};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Container=void 0;var Ne=de(44290),Q=de(16674),Pe=de(28421),ve=de(6867),lt=de(51377),we=de(86311),We=de(31927),St=de(15451),Rt=de(37791),tr=de(55800),qt=de(85700),Yt=de(80175),Sr=function(){function fr(It){this._appliedMiddleware=[];var jt=It||{};if(typeof jt!="object")throw new Error(""+Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(jt.defaultScope===void 0)jt.defaultScope=Pe.BindingScopeEnum.Transient;else if(jt.defaultScope!==Pe.BindingScopeEnum.Singleton&&jt.defaultScope!==Pe.BindingScopeEnum.Transient&&jt.defaultScope!==Pe.BindingScopeEnum.Request)throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(jt.autoBindInjectable===void 0)jt.autoBindInjectable=!1;else if(typeof jt.autoBindInjectable!="boolean")throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(jt.skipBaseClassChecks===void 0)jt.skipBaseClassChecks=!1;else if(typeof jt.skipBaseClassChecks!="boolean")throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:jt.autoBindInjectable,defaultScope:jt.defaultScope,skipBaseClassChecks:jt.skipBaseClassChecks},this.id=Rt.id(),this._bindingDictionary=new Yt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new lt.MetadataReader}return fr.merge=function(It,jt){for(var Rr=[],ie=2;ie<arguments.length;ie++)Rr[ie-2]=arguments[ie];var _r=new fr,Ot=y([It,jt],Rr).map(function(Ue){return we.getBindingDictionary(Ue)}),yt=we.getBindingDictionary(_r);function Qt(Ue,Ar){Ue.traverse(function(an,fe){fe.forEach(function(rt){Ar.add(rt.serviceIdentifier,rt.clone())})})}return Ot.forEach(function(Ue){Qt(Ue,yt)}),_r},fr.prototype.load=function(){for(var It=[],jt=0;jt<arguments.length;jt++)It[jt]=arguments[jt];for(var Rr=this._getContainerModuleHelpersFactory(),ie=0,_r=It;ie<_r.length;ie++){var Ot=_r[ie],yt=Rr(Ot.id);Ot.registry(yt.bindFunction,yt.unbindFunction,yt.isboundFunction,yt.rebindFunction)}},fr.prototype.loadAsync=function(){for(var It=[],jt=0;jt<arguments.length;jt++)It[jt]=arguments[jt];return He(this,void 0,void 0,function(){var Rr,ie,_r,Ot,yt;return ge(this,function(Qt){switch(Qt.label){case 0:Rr=this._getContainerModuleHelpersFactory(),ie=0,_r=It,Qt.label=1;case 1:return ie<_r.length?(Ot=_r[ie],yt=Rr(Ot.id),[4,Ot.registry(yt.bindFunction,yt.unbindFunction,yt.isboundFunction,yt.rebindFunction)]):[3,4];case 2:Qt.sent(),Qt.label=3;case 3:return ie++,[3,1];case 4:return[2]}})})},fr.prototype.unload=function(){for(var It=this,jt=[],Rr=0;Rr<arguments.length;Rr++)jt[Rr]=arguments[Rr];var ie=function(_r){return function(Ot){return Ot.moduleId===_r}};jt.forEach(function(_r){var Ot=ie(_r.id);It._bindingDictionary.removeByCondition(Ot)})},fr.prototype.bind=function(It){var jt=this.options.defaultScope||Pe.BindingScopeEnum.Transient,Rr=new Ne.Binding(It,jt);return this._bindingDictionary.add(It,Rr),new St.BindingToSyntax(Rr)},fr.prototype.rebind=function(It){return this.unbind(It),this.bind(It)},fr.prototype.unbind=function(It){try{this._bindingDictionary.remove(It)}catch(jt){throw new Error(Q.CANNOT_UNBIND+" "+tr.getServiceIdentifierAsString(It))}},fr.prototype.unbindAll=function(){this._bindingDictionary=new Yt.Lookup},fr.prototype.isBound=function(It){var jt=this._bindingDictionary.hasKey(It);return!jt&&this.parent&&(jt=this.parent.isBound(It)),jt},fr.prototype.isBoundNamed=function(It,jt){return this.isBoundTagged(It,ve.NAMED_TAG,jt)},fr.prototype.isBoundTagged=function(It,jt,Rr){var ie=!1;if(this._bindingDictionary.hasKey(It)){var _r=this._bindingDictionary.get(It),Ot=we.createMockRequest(this,It,jt,Rr);ie=_r.some(function(yt){return yt.constraint(Ot)})}return!ie&&this.parent&&(ie=this.parent.isBoundTagged(It,jt,Rr)),ie},fr.prototype.snapshot=function(){this._snapshots.push(qt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},fr.prototype.restore=function(){var It=this._snapshots.pop();if(It===void 0)throw new Error(Q.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=It.bindings,this._middleware=It.middleware},fr.prototype.createChild=function(It){var jt=new fr(It||this.options);return jt.parent=this,jt},fr.prototype.applyMiddleware=function(){for(var It=[],jt=0;jt<arguments.length;jt++)It[jt]=arguments[jt];this._appliedMiddleware=this._appliedMiddleware.concat(It);var Rr=this._middleware?this._middleware:this._planAndResolve();this._middleware=It.reduce(function(ie,_r){return _r(ie)},Rr)},fr.prototype.applyCustomMetadataReader=function(It){this._metadataReader=It},fr.prototype.get=function(It){return this._get(!1,!1,Pe.TargetTypeEnum.Variable,It)},fr.prototype.getTagged=function(It,jt,Rr){return this._get(!1,!1,Pe.TargetTypeEnum.Variable,It,jt,Rr)},fr.prototype.getNamed=function(It,jt){return this.getTagged(It,ve.NAMED_TAG,jt)},fr.prototype.getAll=function(It){return this._get(!0,!0,Pe.TargetTypeEnum.Variable,It)},fr.prototype.getAllTagged=function(It,jt,Rr){return this._get(!1,!0,Pe.TargetTypeEnum.Variable,It,jt,Rr)},fr.prototype.getAllNamed=function(It,jt){return this.getAllTagged(It,ve.NAMED_TAG,jt)},fr.prototype.resolve=function(It){var jt=this.createChild();return jt.bind(It).toSelf(),this._appliedMiddleware.forEach(function(Rr){jt.applyMiddleware(Rr)}),jt.get(It)},fr.prototype._getContainerModuleHelpersFactory=function(){var It=this,jt=function(yt,Qt){yt._binding.moduleId=Qt},Rr=function(yt){return function(Qt){var Ue=It.bind.bind(It),Ar=Ue(Qt);return jt(Ar,yt),Ar}},ie=function(yt){return function(Qt){var Ue=It.unbind.bind(It);Ue(Qt)}},_r=function(yt){return function(Qt){var Ue=It.isBound.bind(It);return Ue(Qt)}},Ot=function(yt){return function(Qt){var Ue=It.rebind.bind(It),Ar=Ue(Qt);return jt(Ar,yt),Ar}};return function(yt){return{bindFunction:Rr(yt),isboundFunction:_r(yt),rebindFunction:Ot(yt),unbindFunction:ie(yt)}}},fr.prototype._get=function(It,jt,Rr,ie,_r,Ot){var yt=null,Qt={avoidConstraints:It,contextInterceptor:function(Ue){return Ue},isMultiInject:jt,key:_r,serviceIdentifier:ie,targetType:Rr,value:Ot};if(this._middleware){if(yt=this._middleware(Qt),yt==null)throw new Error(Q.INVALID_MIDDLEWARE_RETURN)}else yt=this._planAndResolve()(Qt);return yt},fr.prototype._planAndResolve=function(){var It=this;return function(jt){var Rr=we.plan(It._metadataReader,It,jt.isMultiInject,jt.targetType,jt.serviceIdentifier,jt.key,jt.value,jt.avoidConstraints);Rr=jt.contextInterceptor(Rr);var ie=We.resolve(Rr);return ie}},fr}();Ae.Container=Sr},33244:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.AsyncContainerModule=Ae.ContainerModule=void 0;var He=de(37791),ge=function(){function Ne(Q){this.id=He.id(),this.registry=Q}return Ne}();Ae.ContainerModule=ge;var y=function(){function Ne(Q){this.id=He.id(),this.registry=Q}return Ne}();Ae.AsyncContainerModule=y},85700:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.ContainerSnapshot=void 0;var de=function(){function He(){}return He.of=function(ge,y){var Ne=new He;return Ne.bindings=ge,Ne.middleware=y,Ne},He}();Ae.ContainerSnapshot=de},80175:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Lookup=void 0;var He=de(16674),ge=function(){function y(){this._map=new Map}return y.prototype.getMap=function(){return this._map},y.prototype.add=function(Ne,Q){if(Ne==null)throw new Error(He.NULL_ARGUMENT);if(Q==null)throw new Error(He.NULL_ARGUMENT);var Pe=this._map.get(Ne);Pe!==void 0?(Pe.push(Q),this._map.set(Ne,Pe)):this._map.set(Ne,[Q])},y.prototype.get=function(Ne){if(Ne==null)throw new Error(He.NULL_ARGUMENT);var Q=this._map.get(Ne);if(Q!==void 0)return Q;throw new Error(He.KEY_NOT_FOUND)},y.prototype.remove=function(Ne){if(Ne==null)throw new Error(He.NULL_ARGUMENT);if(!this._map.delete(Ne))throw new Error(He.KEY_NOT_FOUND)},y.prototype.removeByCondition=function(Ne){var Q=this;this._map.forEach(function(Pe,ve){var lt=Pe.filter(function(we){return!Ne(we)});lt.length>0?Q._map.set(ve,lt):Q._map.delete(ve)})},y.prototype.hasKey=function(Ne){if(Ne==null)throw new Error(He.NULL_ARGUMENT);return this._map.has(Ne)},y.prototype.clone=function(){var Ne=new y;return this._map.forEach(function(Q,Pe){Q.forEach(function(ve){return Ne.add(Pe,ve.clone())})}),Ne},y.prototype.traverse=function(Ne){this._map.forEach(function(Q,Pe){Ne(Pe,Q)})},y}();Ae.Lookup=ge},86700:function(ci,Ae,de){"use strict";var He;He={value:!0},He=He=He=He=He=He=Ae.GW=He=He=Ae.zY=He=He=He=He=He=Ae.f3=He=He=Ae.b2=He=He=He=He=He=Ae.W2=He=void 0;var ge=de(6867);He=ge;var y=de(51389);Object.defineProperty(Ae,"W2",{enumerable:!0,get:function(){return y.Container}});var Ne=de(28421);He={enumerable:!0,get:function(){return Ne.BindingScopeEnum}},He={enumerable:!0,get:function(){return Ne.BindingTypeEnum}},He={enumerable:!0,get:function(){return Ne.TargetTypeEnum}};var Q=de(33244);He={enumerable:!0,get:function(){return Q.AsyncContainerModule}},He={enumerable:!0,get:function(){return Q.ContainerModule}};var Pe=de(64315);Object.defineProperty(Ae,"b2",{enumerable:!0,get:function(){return Pe.injectable}});var ve=de(32052);He={enumerable:!0,get:function(){return ve.tagged}};var lt=de(38085);He={enumerable:!0,get:function(){return lt.named}};var we=de(5744);Object.defineProperty(Ae,"f3",{enumerable:!0,get:function(){return we.inject}}),He={enumerable:!0,get:function(){return we.LazyServiceIdentifer}};var We=de(6515);He={enumerable:!0,get:function(){return We.optional}};var St=de(86757);He={enumerable:!0,get:function(){return St.unmanaged}};var Rt=de(71693);He={enumerable:!0,get:function(){return Rt.multiInject}};var tr=de(55638);He={enumerable:!0,get:function(){return tr.targetName}};var qt=de(7014);Object.defineProperty(Ae,"zY",{enumerable:!0,get:function(){return qt.postConstruct}});var Yt=de(51377);He={enumerable:!0,get:function(){return Yt.MetadataReader}};var Sr=de(37791);He={enumerable:!0,get:function(){return Sr.id}};var fr=de(99934);Object.defineProperty(Ae,"GW",{enumerable:!0,get:function(){return fr.decorate}});var It=de(80758);He={enumerable:!0,get:function(){return It.traverseAncerstors}},He={enumerable:!0,get:function(){return It.taggedConstraint}},He={enumerable:!0,get:function(){return It.namedConstraint}},He={enumerable:!0,get:function(){return It.typeConstraint}};var jt=de(55800);He={enumerable:!0,get:function(){return jt.getServiceIdentifierAsString}};var Rr=de(70600);He={enumerable:!0,get:function(){return Rr.multiBindToService}}},95228:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Context=void 0;var He=de(37791),ge=function(){function y(Ne){this.id=He.id(),this.container=Ne}return y.prototype.addPlan=function(Ne){this.plan=Ne},y.prototype.setCurrentRequest=function(Ne){this.currentRequest=Ne},y}();Ae.Context=ge},47738:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Metadata=void 0;var He=de(6867),ge=function(){function y(Ne,Q){this.key=Ne,this.value=Q}return y.prototype.toString=function(){return this.key===He.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},y}();Ae.Metadata=ge},51377:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.MetadataReader=void 0;var He=de(6867),ge=function(){function y(){}return y.prototype.getConstructorMetadata=function(Ne){var Q=Reflect.getMetadata(He.PARAM_TYPES,Ne),Pe=Reflect.getMetadata(He.TAGGED,Ne);return{compilerGeneratedMetadata:Q,userGeneratedMetadata:Pe||{}}},y.prototype.getPropertiesMetadata=function(Ne){var Q=Reflect.getMetadata(He.TAGGED_PROP,Ne)||[];return Q},y}();Ae.MetadataReader=ge},55314:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Plan=void 0;var de=function(){function He(ge,y){this.parentContext=ge,this.rootRequest=y}return He}();Ae.Plan=de},86311:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.getBindingDictionary=Ae.createMockRequest=Ae.plan=void 0;var He=de(23184),ge=de(16674),y=de(28421),Ne=de(6867),Q=de(85265),Pe=de(55800),ve=de(95228),lt=de(47738),we=de(55314),We=de(6e3),St=de(6748),Rt=de(18924);function tr(ie){return ie._bindingDictionary}Ae.getBindingDictionary=tr;function qt(ie,_r,Ot,yt,Qt,Ue){var Ar=ie?Ne.MULTI_INJECT_TAG:Ne.INJECT_TAG,an=new lt.Metadata(Ar,Ot),fe=new Rt.Target(_r,yt,Ot,an);if(Qt!==void 0){var rt=new lt.Metadata(Qt,Ue);fe.metadata.push(rt)}return fe}function Yt(ie,_r,Ot,yt,Qt){var Ue=It(Ot.container,Qt.serviceIdentifier),Ar=[];return Ue.length===He.BindingCount.NoBindingsAvailable&&Ot.container.options.autoBindInjectable&&typeof Qt.serviceIdentifier=="function"&&ie.getConstructorMetadata(Qt.serviceIdentifier).compilerGeneratedMetadata&&(Ot.container.bind(Qt.serviceIdentifier).toSelf(),Ue=It(Ot.container,Qt.serviceIdentifier)),_r?Ar=Ue:Ar=Ue.filter(function(an){var fe=new St.Request(an.serviceIdentifier,Ot,yt,an,Qt);return an.constraint(fe)}),Sr(Qt.serviceIdentifier,Ar,Qt,Ot.container),Ar}function Sr(ie,_r,Ot,yt){switch(_r.length){case He.BindingCount.NoBindingsAvailable:if(Ot.isOptional())return _r;var Qt=Pe.getServiceIdentifierAsString(ie),Ue=ge.NOT_REGISTERED;throw Ue+=Pe.listMetadataForTarget(Qt,Ot),Ue+=Pe.listRegisteredBindingsForServiceIdentifier(yt,Qt,It),new Error(Ue);case He.BindingCount.OnlyOneBindingAvailable:if(!Ot.isArray())return _r;case He.BindingCount.MultipleBindingsAvailable:default:if(Ot.isArray())return _r;var Qt=Pe.getServiceIdentifierAsString(ie),Ue=ge.AMBIGUOUS_MATCH+" "+Qt;throw Ue+=Pe.listRegisteredBindingsForServiceIdentifier(yt,Qt,It),new Error(Ue)}}function fr(ie,_r,Ot,yt,Qt,Ue){var Ar,an;if(Qt===null){Ar=Yt(ie,_r,yt,null,Ue),an=new St.Request(Ot,yt,null,Ar,Ue);var fe=new we.Plan(yt,an);yt.addPlan(fe)}else Ar=Yt(ie,_r,yt,Qt,Ue),an=Qt.addChildRequest(Ue.serviceIdentifier,Ar,Ue);Ar.forEach(function(rt){var X=null;if(Ue.isArray())X=an.addChildRequest(rt.serviceIdentifier,rt,Ue);else{if(rt.cache)return;X=an}if(rt.type===y.BindingTypeEnum.Instance&&rt.implementationType!==null){var ae=We.getDependencies(ie,rt.implementationType);if(!yt.container.options.skipBaseClassChecks){var ze=We.getBaseClassDependencyCount(ie,rt.implementationType);if(ae.length<ze){var At=ge.ARGUMENTS_LENGTH_MISMATCH(We.getFunctionName(rt.implementationType));throw new Error(At)}}ae.forEach(function(Ft){fr(ie,!1,Ft.serviceIdentifier,yt,X,Ft)})}})}function It(ie,_r){var Ot=[],yt=tr(ie);return yt.hasKey(_r)?Ot=yt.get(_r):ie.parent!==null&&(Ot=It(ie.parent,_r)),Ot}function jt(ie,_r,Ot,yt,Qt,Ue,Ar,an){an===void 0&&(an=!1);var fe=new ve.Context(_r),rt=qt(Ot,yt,Qt,"",Ue,Ar);try{return fr(ie,an,Qt,fe,null,rt),fe}catch(X){throw Q.isStackOverflowExeption(X)&&fe.plan&&Pe.circularDependencyToException(fe.plan.rootRequest),X}}Ae.plan=jt;function Rr(ie,_r,Ot,yt){var Qt=new Rt.Target(y.TargetTypeEnum.Variable,"",_r,new lt.Metadata(Ot,yt)),Ue=new ve.Context(ie),Ar=new St.Request(_r,Ue,null,[],Qt);return Ar}Ae.createMockRequest=Rr},88460:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.QueryableString=void 0;var de=function(){function He(ge){this.str=ge}return He.prototype.startsWith=function(ge){return this.str.indexOf(ge)===0},He.prototype.endsWith=function(ge){var y="",Ne=ge.split("").reverse().join("");return y=this.str.split("").reverse().join(""),this.startsWith.call({str:y},Ne)},He.prototype.contains=function(ge){return this.str.indexOf(ge)!==-1},He.prototype.equals=function(ge){return this.str===ge},He.prototype.value=function(){return this.str},He}();Ae.QueryableString=de},6e3:function(ci,Ae,de){"use strict";var He=this&&this.__spreadArray||function(Yt,Sr){for(var fr=0,It=Sr.length,jt=Yt.length;fr<It;fr++,jt++)Yt[jt]=Sr[fr];return Yt};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.getFunctionName=Ae.getBaseClassDependencyCount=Ae.getDependencies=void 0;var ge=de(5744),y=de(16674),Ne=de(28421),Q=de(6867),Pe=de(55800);Object.defineProperty(Ae,"getFunctionName",{enumerable:!0,get:function(){return Pe.getFunctionName}});var ve=de(18924);function lt(Yt,Sr){var fr=Pe.getFunctionName(Sr),It=we(Yt,fr,Sr,!1);return It}Ae.getDependencies=lt;function we(Yt,Sr,fr,It){var jt=Yt.getConstructorMetadata(fr),Rr=jt.compilerGeneratedMetadata;if(Rr===void 0){var ie=y.MISSING_INJECTABLE_ANNOTATION+" "+Sr+".";throw new Error(ie)}var _r=jt.userGeneratedMetadata,Ot=Object.keys(_r),yt=fr.length===0&&Ot.length>0,Qt=Ot.length>fr.length,Ue=yt||Qt?Ot.length:fr.length,Ar=St(It,Sr,Rr,_r,Ue),an=Rt(Yt,fr),fe=He(He([],Ar),an);return fe}function We(Yt,Sr,fr,It,jt){var Rr=jt[Yt.toString()]||[],ie=qt(Rr),_r=ie.unmanaged!==!0,Ot=It[Yt],yt=ie.inject||ie.multiInject;if(Ot=yt||Ot,Ot instanceof ge.LazyServiceIdentifer&&(Ot=Ot.unwrap()),_r){var Qt=Ot===Object,Ue=Ot===Function,Ar=Ot===void 0,an=Qt||Ue||Ar;if(!Sr&&an){var fe=y.MISSING_INJECT_ANNOTATION+" argument "+Yt+" in class "+fr+".";throw new Error(fe)}var rt=new ve.Target(Ne.TargetTypeEnum.ConstructorArgument,ie.targetName,Ot);return rt.metadata=Rr,rt}return null}function St(Yt,Sr,fr,It,jt){for(var Rr=[],ie=0;ie<jt;ie++){var _r=ie,Ot=We(_r,Yt,Sr,fr,It);Ot!==null&&Rr.push(Ot)}return Rr}function Rt(Yt,Sr){for(var fr=Yt.getPropertiesMetadata(Sr),It=[],jt=Object.keys(fr),Rr=0,ie=jt;Rr<ie.length;Rr++){var _r=ie[Rr],Ot=fr[_r],yt=qt(fr[_r]),Qt=yt.targetName||_r,Ue=yt.inject||yt.multiInject,Ar=new ve.Target(Ne.TargetTypeEnum.ClassProperty,Qt,Ue);Ar.metadata=Ot,It.push(Ar)}var an=Object.getPrototypeOf(Sr.prototype).constructor;if(an!==Object){var fe=Rt(Yt,an);It=He(He([],It),fe)}return It}function tr(Yt,Sr){var fr=Object.getPrototypeOf(Sr.prototype).constructor;if(fr!==Object){var It=Pe.getFunctionName(fr),jt=we(Yt,It,fr,!0),Rr=jt.map(function(Ot){return Ot.metadata.filter(function(yt){return yt.key===Q.UNMANAGED_TAG})}),ie=[].concat.apply([],Rr).length,_r=jt.length-ie;return _r>0?_r:tr(Yt,fr)}else return 0}Ae.getBaseClassDependencyCount=tr;function qt(Yt){var Sr={};return Yt.forEach(function(fr){Sr[fr.key.toString()]=fr.value}),{inject:Sr[Q.INJECT_TAG],multiInject:Sr[Q.MULTI_INJECT_TAG],targetName:Sr[Q.NAME_TAG],unmanaged:Sr[Q.UNMANAGED_TAG]}}},6748:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Request=void 0;var He=de(37791),ge=function(){function y(Ne,Q,Pe,ve,lt){this.id=He.id(),this.serviceIdentifier=Ne,this.parentContext=Q,this.parentRequest=Pe,this.target=lt,this.childRequests=[],this.bindings=Array.isArray(ve)?ve:[ve],this.requestScope=Pe===null?new Map:null}return y.prototype.addChildRequest=function(Ne,Q,Pe){var ve=new y(Ne,this.parentContext,this,Q,Pe);return this.childRequests.push(ve),ve},y}();Ae.Request=ge},18924:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Target=void 0;var He=de(6867),ge=de(37791),y=de(47738),Ne=de(88460),Q=function(){function Pe(ve,lt,we,We){this.id=ge.id(),this.type=ve,this.serviceIdentifier=we,this.name=new Ne.QueryableString(lt||""),this.metadata=new Array;var St=null;typeof We=="string"?St=new y.Metadata(He.NAMED_TAG,We):We instanceof y.Metadata&&(St=We),St!==null&&this.metadata.push(St)}return Pe.prototype.hasTag=function(ve){for(var lt=0,we=this.metadata;lt<we.length;lt++){var We=we[lt];if(We.key===ve)return!0}return!1},Pe.prototype.isArray=function(){return this.hasTag(He.MULTI_INJECT_TAG)},Pe.prototype.matchesArray=function(ve){return this.matchesTag(He.MULTI_INJECT_TAG)(ve)},Pe.prototype.isNamed=function(){return this.hasTag(He.NAMED_TAG)},Pe.prototype.isTagged=function(){return this.metadata.some(function(ve){return He.NON_CUSTOM_TAG_KEYS.every(function(lt){return ve.key!==lt})})},Pe.prototype.isOptional=function(){return this.matchesTag(He.OPTIONAL_TAG)(!0)},Pe.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ve){return ve.key===He.NAMED_TAG})[0]:null},Pe.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ve){return He.NON_CUSTOM_TAG_KEYS.every(function(lt){return ve.key!==lt})}):null},Pe.prototype.matchesNamedTag=function(ve){return this.matchesTag(He.NAMED_TAG)(ve)},Pe.prototype.matchesTag=function(ve){var lt=this;return function(we){for(var We=0,St=lt.metadata;We<St.length;We++){var Rt=St[We];if(Rt.key===ve&&Rt.value===we)return!0}return!1}},Pe}();Ae.Target=Q},52279:function(ci,Ae,de){"use strict";var He=this&&this.__spreadArray||function(we,We){for(var St=0,Rt=We.length,tr=we.length;St<Rt;St++,tr++)we[tr]=We[St];return we};Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.resolveInstance=void 0;var ge=de(16674),y=de(28421),Ne=de(6867);function Q(we,We,St){var Rt=We.filter(function(qt){return qt.target!==null&&qt.target.type===y.TargetTypeEnum.ClassProperty}),tr=Rt.map(St);return Rt.forEach(function(qt,Yt){var Sr="";Sr=qt.target.name.value();var fr=tr[Yt];we[Sr]=fr}),we}function Pe(we,We){return new(we.bind.apply(we,He([void 0],We)))}function ve(we,We){if(Reflect.hasMetadata(Ne.POST_CONSTRUCT,we)){var St=Reflect.getMetadata(Ne.POST_CONSTRUCT,we);try{We[St.value]()}catch(Rt){throw new Error(ge.POST_CONSTRUCT_ERROR(we.name,Rt.message))}}}function lt(we,We,St){var Rt=null;if(We.length>0){var tr=We.filter(function(Yt){return Yt.target!==null&&Yt.target.type===y.TargetTypeEnum.ConstructorArgument}),qt=tr.map(St);Rt=Pe(we,qt),Rt=Q(Rt,We,St)}else Rt=new we;return ve(we,Rt),Rt}Ae.resolveInstance=lt},31927:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.resolve=void 0;var He=de(16674),ge=de(28421),y=de(85265),Ne=de(55800),Q=de(52279),Pe=function(we,We,St){try{return St()}catch(Rt){throw y.isStackOverflowExeption(Rt)?new Error(He.CIRCULAR_DEPENDENCY_IN_FACTORY(we,We.toString())):Rt}},ve=function(we){return function(We){We.parentContext.setCurrentRequest(We);var St=We.bindings,Rt=We.childRequests,tr=We.target&&We.target.isArray(),qt=!We.parentRequest||!We.parentRequest.target||!We.target||!We.parentRequest.target.matchesArray(We.target.serviceIdentifier);if(tr&&qt)return Rt.map(function(Rr){var ie=ve(we);return ie(Rr)});var Yt=null;if(We.target.isOptional()&&St.length===0)return;var Sr=St[0],fr=Sr.scope===ge.BindingScopeEnum.Singleton,It=Sr.scope===ge.BindingScopeEnum.Request;if(fr&&Sr.activated)return Sr.cache;if(It&&we!==null&&we.has(Sr.id))return we.get(Sr.id);if(Sr.type===ge.BindingTypeEnum.ConstantValue)Yt=Sr.cache,Sr.activated=!0;else if(Sr.type===ge.BindingTypeEnum.Function)Yt=Sr.cache,Sr.activated=!0;else if(Sr.type===ge.BindingTypeEnum.Constructor)Yt=Sr.implementationType;else if(Sr.type===ge.BindingTypeEnum.DynamicValue&&Sr.dynamicValue!==null)Yt=Pe("toDynamicValue",Sr.serviceIdentifier,function(){return Sr.dynamicValue(We.parentContext)});else if(Sr.type===ge.BindingTypeEnum.Factory&&Sr.factory!==null)Yt=Pe("toFactory",Sr.serviceIdentifier,function(){return Sr.factory(We.parentContext)});else if(Sr.type===ge.BindingTypeEnum.Provider&&Sr.provider!==null)Yt=Pe("toProvider",Sr.serviceIdentifier,function(){return Sr.provider(We.parentContext)});else if(Sr.type===ge.BindingTypeEnum.Instance&&Sr.implementationType!==null)Yt=Q.resolveInstance(Sr.implementationType,Rt,ve(we));else{var jt=Ne.getServiceIdentifierAsString(We.serviceIdentifier);throw new Error(He.INVALID_BINDING_TYPE+" "+jt)}return typeof Sr.onActivation=="function"&&(Yt=Sr.onActivation(We.parentContext,Yt)),fr&&(Sr.cache=Yt,Sr.activated=!0),It&&we!==null&&!we.has(Sr.id)&&we.set(Sr.id,Yt),Yt}};function lt(we){var We=ve(we.plan.rootRequest.requestScope);return We(we.plan.rootRequest)}Ae.resolve=lt},83366:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingInSyntax=void 0;var He=de(28421),ge=de(71325),y=function(){function Ne(Q){this._binding=Q}return Ne.prototype.inRequestScope=function(){return this._binding.scope=He.BindingScopeEnum.Request,new ge.BindingWhenOnSyntax(this._binding)},Ne.prototype.inSingletonScope=function(){return this._binding.scope=He.BindingScopeEnum.Singleton,new ge.BindingWhenOnSyntax(this._binding)},Ne.prototype.inTransientScope=function(){return this._binding.scope=He.BindingScopeEnum.Transient,new ge.BindingWhenOnSyntax(this._binding)},Ne}();Ae.BindingInSyntax=y},74889:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingInWhenOnSyntax=void 0;var He=de(83366),ge=de(51811),y=de(98370),Ne=function(){function Q(Pe){this._binding=Pe,this._bindingWhenSyntax=new y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ge.BindingOnSyntax(this._binding),this._bindingInSyntax=new He.BindingInSyntax(Pe)}return Q.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Q.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Q.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Q.prototype.when=function(Pe){return this._bindingWhenSyntax.when(Pe)},Q.prototype.whenTargetNamed=function(Pe){return this._bindingWhenSyntax.whenTargetNamed(Pe)},Q.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Q.prototype.whenTargetTagged=function(Pe,ve){return this._bindingWhenSyntax.whenTargetTagged(Pe,ve)},Q.prototype.whenInjectedInto=function(Pe){return this._bindingWhenSyntax.whenInjectedInto(Pe)},Q.prototype.whenParentNamed=function(Pe){return this._bindingWhenSyntax.whenParentNamed(Pe)},Q.prototype.whenParentTagged=function(Pe,ve){return this._bindingWhenSyntax.whenParentTagged(Pe,ve)},Q.prototype.whenAnyAncestorIs=function(Pe){return this._bindingWhenSyntax.whenAnyAncestorIs(Pe)},Q.prototype.whenNoAncestorIs=function(Pe){return this._bindingWhenSyntax.whenNoAncestorIs(Pe)},Q.prototype.whenAnyAncestorNamed=function(Pe){return this._bindingWhenSyntax.whenAnyAncestorNamed(Pe)},Q.prototype.whenAnyAncestorTagged=function(Pe,ve){return this._bindingWhenSyntax.whenAnyAncestorTagged(Pe,ve)},Q.prototype.whenNoAncestorNamed=function(Pe){return this._bindingWhenSyntax.whenNoAncestorNamed(Pe)},Q.prototype.whenNoAncestorTagged=function(Pe,ve){return this._bindingWhenSyntax.whenNoAncestorTagged(Pe,ve)},Q.prototype.whenAnyAncestorMatches=function(Pe){return this._bindingWhenSyntax.whenAnyAncestorMatches(Pe)},Q.prototype.whenNoAncestorMatches=function(Pe){return this._bindingWhenSyntax.whenNoAncestorMatches(Pe)},Q.prototype.onActivation=function(Pe){return this._bindingOnSyntax.onActivation(Pe)},Q}();Ae.BindingInWhenOnSyntax=Ne},51811:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingOnSyntax=void 0;var He=de(98370),ge=function(){function y(Ne){this._binding=Ne}return y.prototype.onActivation=function(Ne){return this._binding.onActivation=Ne,new He.BindingWhenSyntax(this._binding)},y}();Ae.BindingOnSyntax=ge},15451:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingToSyntax=void 0;var He=de(16674),ge=de(28421),y=de(74889),Ne=de(71325),Q=function(){function Pe(ve){this._binding=ve}return Pe.prototype.to=function(ve){return this._binding.type=ge.BindingTypeEnum.Instance,this._binding.implementationType=ve,new y.BindingInWhenOnSyntax(this._binding)},Pe.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+He.INVALID_TO_SELF_VALUE);var ve=this._binding.serviceIdentifier;return this.to(ve)},Pe.prototype.toConstantValue=function(ve){return this._binding.type=ge.BindingTypeEnum.ConstantValue,this._binding.cache=ve,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ge.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Pe.prototype.toDynamicValue=function(ve){return this._binding.type=ge.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ve,this._binding.implementationType=null,new y.BindingInWhenOnSyntax(this._binding)},Pe.prototype.toConstructor=function(ve){return this._binding.type=ge.BindingTypeEnum.Constructor,this._binding.implementationType=ve,this._binding.scope=ge.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Pe.prototype.toFactory=function(ve){return this._binding.type=ge.BindingTypeEnum.Factory,this._binding.factory=ve,this._binding.scope=ge.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Pe.prototype.toFunction=function(ve){if(typeof ve!="function")throw new Error(He.INVALID_FUNCTION_BINDING);var lt=this.toConstantValue(ve);return this._binding.type=ge.BindingTypeEnum.Function,this._binding.scope=ge.BindingScopeEnum.Singleton,lt},Pe.prototype.toAutoFactory=function(ve){return this._binding.type=ge.BindingTypeEnum.Factory,this._binding.factory=function(lt){var we=function(){return lt.container.get(ve)};return we},this._binding.scope=ge.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Pe.prototype.toProvider=function(ve){return this._binding.type=ge.BindingTypeEnum.Provider,this._binding.provider=ve,this._binding.scope=ge.BindingScopeEnum.Singleton,new Ne.BindingWhenOnSyntax(this._binding)},Pe.prototype.toService=function(ve){this.toDynamicValue(function(lt){return lt.container.get(ve)})},Pe}();Ae.BindingToSyntax=Q},71325:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingWhenOnSyntax=void 0;var He=de(51811),ge=de(98370),y=function(){function Ne(Q){this._binding=Q,this._bindingWhenSyntax=new ge.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new He.BindingOnSyntax(this._binding)}return Ne.prototype.when=function(Q){return this._bindingWhenSyntax.when(Q)},Ne.prototype.whenTargetNamed=function(Q){return this._bindingWhenSyntax.whenTargetNamed(Q)},Ne.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Ne.prototype.whenTargetTagged=function(Q,Pe){return this._bindingWhenSyntax.whenTargetTagged(Q,Pe)},Ne.prototype.whenInjectedInto=function(Q){return this._bindingWhenSyntax.whenInjectedInto(Q)},Ne.prototype.whenParentNamed=function(Q){return this._bindingWhenSyntax.whenParentNamed(Q)},Ne.prototype.whenParentTagged=function(Q,Pe){return this._bindingWhenSyntax.whenParentTagged(Q,Pe)},Ne.prototype.whenAnyAncestorIs=function(Q){return this._bindingWhenSyntax.whenAnyAncestorIs(Q)},Ne.prototype.whenNoAncestorIs=function(Q){return this._bindingWhenSyntax.whenNoAncestorIs(Q)},Ne.prototype.whenAnyAncestorNamed=function(Q){return this._bindingWhenSyntax.whenAnyAncestorNamed(Q)},Ne.prototype.whenAnyAncestorTagged=function(Q,Pe){return this._bindingWhenSyntax.whenAnyAncestorTagged(Q,Pe)},Ne.prototype.whenNoAncestorNamed=function(Q){return this._bindingWhenSyntax.whenNoAncestorNamed(Q)},Ne.prototype.whenNoAncestorTagged=function(Q,Pe){return this._bindingWhenSyntax.whenNoAncestorTagged(Q,Pe)},Ne.prototype.whenAnyAncestorMatches=function(Q){return this._bindingWhenSyntax.whenAnyAncestorMatches(Q)},Ne.prototype.whenNoAncestorMatches=function(Q){return this._bindingWhenSyntax.whenNoAncestorMatches(Q)},Ne.prototype.onActivation=function(Q){return this._bindingOnSyntax.onActivation(Q)},Ne}();Ae.BindingWhenOnSyntax=y},98370:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.BindingWhenSyntax=void 0;var He=de(51811),ge=de(80758),y=function(){function Ne(Q){this._binding=Q}return Ne.prototype.when=function(Q){return this._binding.constraint=Q,new He.BindingOnSyntax(this._binding)},Ne.prototype.whenTargetNamed=function(Q){return this._binding.constraint=ge.namedConstraint(Q),new He.BindingOnSyntax(this._binding)},Ne.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Q){var Pe=Q.target!==null&&!Q.target.isNamed()&&!Q.target.isTagged();return Pe},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenTargetTagged=function(Q,Pe){return this._binding.constraint=ge.taggedConstraint(Q)(Pe),new He.BindingOnSyntax(this._binding)},Ne.prototype.whenInjectedInto=function(Q){return this._binding.constraint=function(Pe){return ge.typeConstraint(Q)(Pe.parentRequest)},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenParentNamed=function(Q){return this._binding.constraint=function(Pe){return ge.namedConstraint(Q)(Pe.parentRequest)},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenParentTagged=function(Q,Pe){return this._binding.constraint=function(ve){return ge.taggedConstraint(Q)(Pe)(ve.parentRequest)},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenAnyAncestorIs=function(Q){return this._binding.constraint=function(Pe){return ge.traverseAncerstors(Pe,ge.typeConstraint(Q))},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenNoAncestorIs=function(Q){return this._binding.constraint=function(Pe){return!ge.traverseAncerstors(Pe,ge.typeConstraint(Q))},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenAnyAncestorNamed=function(Q){return this._binding.constraint=function(Pe){return ge.traverseAncerstors(Pe,ge.namedConstraint(Q))},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenNoAncestorNamed=function(Q){return this._binding.constraint=function(Pe){return!ge.traverseAncerstors(Pe,ge.namedConstraint(Q))},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenAnyAncestorTagged=function(Q,Pe){return this._binding.constraint=function(ve){return ge.traverseAncerstors(ve,ge.taggedConstraint(Q)(Pe))},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenNoAncestorTagged=function(Q,Pe){return this._binding.constraint=function(ve){return!ge.traverseAncerstors(ve,ge.taggedConstraint(Q)(Pe))},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenAnyAncestorMatches=function(Q){return this._binding.constraint=function(Pe){return ge.traverseAncerstors(Pe,Q)},new He.BindingOnSyntax(this._binding)},Ne.prototype.whenNoAncestorMatches=function(Q){return this._binding.constraint=function(Pe){return!ge.traverseAncerstors(Pe,Q)},new He.BindingOnSyntax(this._binding)},Ne}();Ae.BindingWhenSyntax=y},80758:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.typeConstraint=Ae.namedConstraint=Ae.taggedConstraint=Ae.traverseAncerstors=void 0;var He=de(6867),ge=de(47738),y=function(ve,lt){var we=ve.parentRequest;return we!==null?lt(we)?!0:y(we,lt):!1};Ae.traverseAncerstors=y;var Ne=function(ve){return function(lt){var we=function(We){return We!==null&&We.target!==null&&We.target.matchesTag(ve)(lt)};return we.metaData=new ge.Metadata(ve,lt),we}};Ae.taggedConstraint=Ne;var Q=Ne(He.NAMED_TAG);Ae.namedConstraint=Q;var Pe=function(ve){return function(lt){var we=null;if(lt!==null)if(we=lt.bindings[0],typeof ve=="string"){var We=we.serviceIdentifier;return We===ve}else{var St=lt.bindings[0].implementationType;return ve===St}return!1}};Ae.typeConstraint=Pe},70600:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.multiBindToService=void 0;var de=function(He){return function(ge){return function(){for(var y=[],Ne=0;Ne<arguments.length;Ne++)y[Ne]=arguments[Ne];return y.forEach(function(Q){return He.bind(Q).toService(ge)})}}};Ae.multiBindToService=de},85265:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.isStackOverflowExeption=void 0;var He=de(16674);function ge(y){return y instanceof RangeError||y.message===He.STACK_OVERFLOW}Ae.isStackOverflowExeption=ge},37791:function(ci,Ae){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.id=void 0;var de=0;function He(){return de++}Ae.id=He},55800:function(ci,Ae,de){"use strict";Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.circularDependencyToException=Ae.listMetadataForTarget=Ae.listRegisteredBindingsForServiceIdentifier=Ae.getServiceIdentifierAsString=Ae.getFunctionName=void 0;var He=de(16674);function ge(we){if(typeof we=="function"){var We=we;return We.name}else{if(typeof we=="symbol")return we.toString();var We=we;return We}}Ae.getServiceIdentifierAsString=ge;function y(we,We,St){var Rt="",tr=St(we,We);return tr.length!==0&&(Rt=`
Registered bindings:`,tr.forEach(function(qt){var Yt="Object";qt.implementationType!==null&&(Yt=lt(qt.implementationType)),Rt=Rt+`
 `+Yt,qt.constraint.metaData&&(Rt=Rt+" - "+qt.constraint.metaData)})),Rt}Ae.listRegisteredBindingsForServiceIdentifier=y;function Ne(we,We){return we.parentRequest===null?!1:we.parentRequest.serviceIdentifier===We?!0:Ne(we.parentRequest,We)}function Q(we){function We(Rt,tr){tr===void 0&&(tr=[]);var qt=ge(Rt.serviceIdentifier);return tr.push(qt),Rt.parentRequest!==null?We(Rt.parentRequest,tr):tr}var St=We(we);return St.reverse().join(" --> ")}function Pe(we){we.childRequests.forEach(function(We){if(Ne(We,We.serviceIdentifier)){var St=Q(We);throw new Error(He.CIRCULAR_DEPENDENCY+" "+St)}else Pe(We)})}Ae.circularDependencyToException=Pe;function ve(we,We){if(We.isTagged()||We.isNamed()){var St="",Rt=We.getNamedTag(),tr=We.getCustomTags();return Rt!==null&&(St+=Rt.toString()+`
`),tr!==null&&tr.forEach(function(qt){St+=qt.toString()+`
`})," "+we+`
 `+we+" - "+St}else return" "+we}Ae.listMetadataForTarget=ve;function lt(we){if(we.name)return we.name;var We=we.toString(),St=We.match(/^function\s*([^\s(]+)/);return St?St[1]:"Anonymous function: "+We}Ae.getFunctionName=lt},31745:function(ci){"use strict";ci.exports=de,ci.exports.default=de;var Ae=1e20;function de(Q,Pe,ve,lt,we,We){this.fontSize=Q||24,this.buffer=Pe===void 0?3:Pe,this.cutoff=lt||.25,this.fontFamily=we||"sans-serif",this.fontWeight=We||"normal",this.radius=ve||8;var St=this.size=this.fontSize+this.buffer*2,Rt=St+this.buffer*2,tr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;tr?this.canvas=my.createOffscreenCanvas(St,St,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=St),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Rt*Rt),this.gridInner=new Float64Array(Rt*Rt),this.f=new Float64Array(Rt),this.z=new Float64Array(Rt+1),this.v=new Uint16Array(Rt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,tr?this.middle=Math.round(St/2*1):this.middle=Math.round(St/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function He(Q,Pe,ve,lt,we,We,St){We.fill(Ae,0,Pe*ve),St.fill(0,0,Pe*ve);for(var Rt=(Pe-lt)/2,tr=0;tr<we;tr++)for(var qt=0;qt<lt;qt++){var Yt=(tr+Rt)*Pe+qt+Rt,Sr=Q.data[4*(tr*lt+qt)+3]/255;if(Sr===1)We[Yt]=0,St[Yt]=Ae;else if(Sr===0)We[Yt]=Ae,St[Yt]=0;else{var fr=Math.max(0,.5-Sr),It=Math.max(0,Sr-.5);We[Yt]=fr*fr,St[Yt]=It*It}}}function ge(Q,Pe,ve,lt,we,We,St){for(var Rt=0;Rt<Pe*ve;Rt++){var tr=Math.sqrt(lt[Rt])-Math.sqrt(we[Rt]);Q[Rt]=Math.round(255-255*(tr/We+St))}}de.prototype._draw=function(Q,Pe){var ve=this.ctx.measureText(Q),lt=ve.width,we=2*this.buffer,We,St,Rt,tr,qt,Yt,Sr,fr;Pe&&this.useMetrics?(qt=Math.floor(ve.actualBoundingBoxAscent),fr=this.buffer+Math.ceil(ve.actualBoundingBoxAscent),Yt=this.buffer,Sr=this.buffer,St=Math.min(this.size,Math.ceil(ve.actualBoundingBoxRight-ve.actualBoundingBoxLeft)),tr=Math.min(this.size-Yt,Math.ceil(ve.actualBoundingBoxAscent+ve.actualBoundingBoxDescent)),We=St+we,Rt=tr+we,this.ctx.textBaseline="alphabetic"):(We=St=this.size,Rt=tr=this.size,qt=19*this.fontSize/24,Yt=Sr=0,fr=this.middle,this.ctx.textBaseline="middle");var It;St&&tr&&(this.ctx.clearRect(Sr,Yt,St,tr),this.ctx.fillText(Q,this.buffer,fr),It=this.ctx.getImageData(Sr,Yt,St,tr));var jt=new Uint8ClampedArray(We*Rt);return He(It,We,Rt,St,tr,this.gridOuter,this.gridInner),y(this.gridOuter,We,Rt,this.f,this.v,this.z),y(this.gridInner,We,Rt,this.f,this.v,this.z),ge(jt,We,Rt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:jt,metrics:{width:St,height:tr,sdfWidth:We,sdfHeight:Rt,top:qt,left:0,advance:lt}}},de.prototype.draw=function(Q){return this._draw(Q,!1).data},de.prototype.drawWithMetrics=function(Q){return this._draw(Q,!0)};function y(Q,Pe,ve,lt,we,We){for(var St=0;St<Pe;St++)Ne(Q,St,Pe,ve,lt,we,We);for(var Rt=0;Rt<ve;Rt++)Ne(Q,Rt*Pe,1,Pe,lt,we,We)}function Ne(Q,Pe,ve,lt,we,We,St){var Rt,tr,qt,Yt;for(We[0]=0,St[0]=-Ae,St[1]=Ae,Rt=0;Rt<lt;Rt++)we[Rt]=Q[Pe+Rt*ve];for(Rt=1,tr=0,qt=0;Rt<lt;Rt++){do Yt=We[tr],qt=(we[Rt]-we[Yt]+Rt*Rt-Yt*Yt)/(Rt-Yt)/2;while(qt<=St[tr]&&--tr>-1);tr++,We[tr]=Rt,St[tr]=qt,St[tr+1]=Ae}for(Rt=0,tr=0;Rt<lt;Rt++){for(;St[tr+1]<Rt;)tr++;Yt=We[tr],Q[Pe+Rt*ve]=we[Yt]+(Rt-Yt)*(Rt-Yt)}}},18857:function(ci,Ae,de){"use strict";de.r(Ae),de.d(Ae,{Function:function(){return yl},Interpreter:function(){return As},default:function(){return df},evaluate:function(){return Ac},vm:function(){return He}});var He={};de.r(He),de.d(He,{Script:function(){return gl},compileFunction:function(){return Ju},createContext:function(){return Sh},runInContext:function(){return pf},runInNewContext:function(){return Wf}});var ge={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},y="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",Ne={5:y,"5module":y+" export import",6:y+" const class extends export import super"},Q=/^in(stanceof)?$/,Pe="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ve="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",lt=new RegExp("["+Pe+"]"),we=new RegExp("["+Pe+ve+"]");Pe=ve=null;var We=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],St=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Rt(E,P){for(var G=65536,D=0;D<P.length;D+=2){if(G+=P[D],G>E)return!1;if(G+=P[D+1],G>=E)return!0}}function tr(E,P){return E<65?E===36:E<91?!0:E<97?E===95:E<123?!0:E<=65535?E>=170&&lt.test(String.fromCharCode(E)):P===!1?!1:Rt(E,We)}function qt(E,P){return E<48?E===36:E<58?!0:E<65?!1:E<91?!0:E<97?E===95:E<123?!0:E<=65535?E>=170&&we.test(String.fromCharCode(E)):P===!1?!1:Rt(E,We)||Rt(E,St)}var Yt=function(P,G){G===void 0&&(G={}),this.label=P,this.keyword=G.keyword,this.beforeExpr=!!G.beforeExpr,this.startsExpr=!!G.startsExpr,this.isLoop=!!G.isLoop,this.isAssign=!!G.isAssign,this.prefix=!!G.prefix,this.postfix=!!G.postfix,this.binop=G.binop||null,this.updateContext=null};function Sr(E,P){return new Yt(E,{beforeExpr:!0,binop:P})}var fr={beforeExpr:!0},It={startsExpr:!0},jt={};function Rr(E,P){return P===void 0&&(P={}),P.keyword=E,jt[E]=new Yt(E,P)}var ie={num:new Yt("num",It),regexp:new Yt("regexp",It),string:new Yt("string",It),name:new Yt("name",It),eof:new Yt("eof"),bracketL:new Yt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Yt("]"),braceL:new Yt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Yt("}"),parenL:new Yt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Yt(")"),comma:new Yt(",",fr),semi:new Yt(";",fr),colon:new Yt(":",fr),dot:new Yt("."),question:new Yt("?",fr),questionDot:new Yt("?."),arrow:new Yt("=>",fr),template:new Yt("template"),invalidTemplate:new Yt("invalidTemplate"),ellipsis:new Yt("...",fr),backQuote:new Yt("`",It),dollarBraceL:new Yt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Yt("=",{beforeExpr:!0,isAssign:!0}),assign:new Yt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Yt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Yt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Sr("||",1),logicalAND:Sr("&&",2),bitwiseOR:Sr("|",3),bitwiseXOR:Sr("^",4),bitwiseAND:Sr("&",5),equality:Sr("==/!=/===/!==",6),relational:Sr("</>/<=/>=",7),bitShift:Sr("<</>>/>>>",8),plusMin:new Yt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Sr("%",10),star:Sr("*",10),slash:Sr("/",10),starstar:new Yt("**",{beforeExpr:!0}),coalesce:Sr("??",1),_break:Rr("break"),_case:Rr("case",fr),_catch:Rr("catch"),_continue:Rr("continue"),_debugger:Rr("debugger"),_default:Rr("default",fr),_do:Rr("do",{isLoop:!0,beforeExpr:!0}),_else:Rr("else",fr),_finally:Rr("finally"),_for:Rr("for",{isLoop:!0}),_function:Rr("function",It),_if:Rr("if"),_return:Rr("return",fr),_switch:Rr("switch"),_throw:Rr("throw",fr),_try:Rr("try"),_var:Rr("var"),_const:Rr("const"),_while:Rr("while",{isLoop:!0}),_with:Rr("with"),_new:Rr("new",{beforeExpr:!0,startsExpr:!0}),_this:Rr("this",It),_super:Rr("super",It),_class:Rr("class",It),_extends:Rr("extends",fr),_export:Rr("export"),_import:Rr("import",It),_null:Rr("null",It),_true:Rr("true",It),_false:Rr("false",It),_in:Rr("in",{beforeExpr:!0,binop:7}),_instanceof:Rr("instanceof",{beforeExpr:!0,binop:7}),_typeof:Rr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Rr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Rr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},_r=/\r\n?|\n|\u2028|\u2029/,Ot=new RegExp(_r.source,"g");function yt(E,P){return E===10||E===13||!P&&(E===8232||E===8233)}var Qt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Ue=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ar=Object.prototype,an=Ar.hasOwnProperty,fe=Ar.toString;function rt(E,P){return an.call(E,P)}var X=Array.isArray||function(E){return fe.call(E)==="[object Array]"};function ae(E){return new RegExp("^(?:"+E.replace(/ /g,"|")+")$")}var ze=function(P,G){this.line=P,this.column=G};ze.prototype.offset=function(P){return new ze(this.line,this.column+P)};var At=function(P,G,D){this.start=G,this.end=D,P.sourceFile!==null&&(this.source=P.sourceFile)};function Ft(E,P){for(var G=1,D=0;;){Ot.lastIndex=D;var oe=Ot.exec(E);if(oe&&oe.index<P)++G,D=oe.index+oe[0].length;else return new ze(G,P-D)}}var ur={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Tt(E){var P={};for(var G in ur)P[G]=E&&rt(E,G)?E[G]:ur[G];if(P.ecmaVersion>=2015&&(P.ecmaVersion-=2009),P.allowReserved==null&&(P.allowReserved=P.ecmaVersion<5),X(P.onToken)){var D=P.onToken;P.onToken=function(oe){return D.push(oe)}}return X(P.onComment)&&(P.onComment=Br(P,P.onComment)),P}function Br(E,P){return function(G,D,oe,Fe,vt,Mt){var Dt={type:G?"Block":"Line",value:D,start:oe,end:Fe};E.locations&&(Dt.loc=new At(this,vt,Mt)),E.ranges&&(Dt.range=[oe,Fe]),P.push(Dt)}}var Bn=1,Sn=2,Li=Bn|Sn,gi=4,on=8,Xa=16,ra=32,Vi=64,ga=128;function fi(E,P){return Sn|(E?gi:0)|(P?on:0)}var $i=0,hi=1,yi=2,os=3,mo=4,Ya=5,Pt=function(P,G,D){this.options=P=Tt(P),this.sourceFile=P.sourceFile,this.keywords=ae(Ne[P.ecmaVersion>=6?6:P.sourceType==="module"?"5module":5]);var oe="";if(P.allowReserved!==!0){for(var Fe=P.ecmaVersion;!(oe=ge[Fe]);Fe--);P.sourceType==="module"&&(oe+=" await")}this.reservedWords=ae(oe);var vt=(oe?oe+" ":"")+ge.strict;this.reservedWordsStrict=ae(vt),this.reservedWordsStrictBind=ae(vt+" "+ge.strictBind),this.input=String(G),this.containsEsc=!1,D?(this.pos=D,this.lineStart=this.input.lastIndexOf(`
`,D-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(_r).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ie.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=P.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&P.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Bn),this.regexpState=null},xe={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Pt.prototype.parse=function(){var P=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(P)},xe.inFunction.get=function(){return(this.currentVarScope().flags&Sn)>0},xe.inGenerator.get=function(){return(this.currentVarScope().flags&on)>0},xe.inAsync.get=function(){return(this.currentVarScope().flags&gi)>0},xe.allowSuper.get=function(){return(this.currentThisScope().flags&Vi)>0},xe.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ga)>0},xe.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Pt.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&Sn)>0},Pt.extend=function(){for(var P=[],G=arguments.length;G--;)P[G]=arguments[G];for(var D=this,oe=0;oe<P.length;oe++)D=P[oe](D);return D},Pt.parse=function(P,G){return new this(G,P).parse()},Pt.parseExpressionAt=function(P,G,D){var oe=new this(D,P,G);return oe.nextToken(),oe.parseExpression()},Pt.tokenizer=function(P,G){return new this(G,P)},Object.defineProperties(Pt.prototype,xe);var ce=Pt.prototype,Te=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ce.strictDirective=function(E){for(;;){Ue.lastIndex=E,E+=Ue.exec(this.input)[0].length;var P=Te.exec(this.input.slice(E));if(!P)return!1;if((P[1]||P[2])==="use strict"){Ue.lastIndex=E+P[0].length;var G=Ue.exec(this.input),D=G.index+G[0].length,oe=this.input.charAt(D);return oe===";"||oe==="}"||_r.test(G[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(oe)||oe==="!"&&this.input.charAt(D+1)==="=")}E+=P[0].length,Ue.lastIndex=E,E+=Ue.exec(this.input)[0].length,this.input[E]===";"&&E++}},ce.eat=function(E){return this.type===E?(this.next(),!0):!1},ce.isContextual=function(E){return this.type===ie.name&&this.value===E&&!this.containsEsc},ce.eatContextual=function(E){return this.isContextual(E)?(this.next(),!0):!1},ce.expectContextual=function(E){this.eatContextual(E)||this.unexpected()},ce.canInsertSemicolon=function(){return this.type===ie.eof||this.type===ie.braceR||_r.test(this.input.slice(this.lastTokEnd,this.start))},ce.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ce.semicolon=function(){!this.eat(ie.semi)&&!this.insertSemicolon()&&this.unexpected()},ce.afterTrailingComma=function(E,P){if(this.type===E)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),P||this.next(),!0},ce.expect=function(E){this.eat(E)||this.unexpected()},ce.unexpected=function(E){this.raise(E!=null?E:this.start,"Unexpected token")};function j(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ce.checkPatternErrors=function(E,P){if(!!E){E.trailingComma>-1&&this.raiseRecoverable(E.trailingComma,"Comma is not permitted after the rest element");var G=P?E.parenthesizedAssign:E.parenthesizedBind;G>-1&&this.raiseRecoverable(G,"Parenthesized pattern")}},ce.checkExpressionErrors=function(E,P){if(!E)return!1;var G=E.shorthandAssign,D=E.doubleProto;if(!P)return G>=0||D>=0;G>=0&&this.raise(G,"Shorthand property assignments are valid only in destructuring patterns"),D>=0&&this.raiseRecoverable(D,"Redefinition of __proto__ property")},ce.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ce.isSimpleAssignTarget=function(E){return E.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(E.expression):E.type==="Identifier"||E.type==="MemberExpression"};var st=Pt.prototype;st.parseTopLevel=function(E){var P={};for(E.body||(E.body=[]);this.type!==ie.eof;){var G=this.parseStatement(null,!0,P);E.body.push(G)}if(this.inModule)for(var D=0,oe=Object.keys(this.undefinedExports);D<oe.length;D+=1){var Fe=oe[D];this.raiseRecoverable(this.undefinedExports[Fe].start,"Export '"+Fe+"' is not defined")}return this.adaptDirectivePrologue(E.body),this.next(),E.sourceType=this.options.sourceType,this.finishNode(E,"Program")};var ar={kind:"loop"},Jr={kind:"switch"};st.isLet=function(E){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Ue.lastIndex=this.pos;var P=Ue.exec(this.input),G=this.pos+P[0].length,D=this.input.charCodeAt(G);if(D===91)return!0;if(E)return!1;if(D===123)return!0;if(tr(D,!0)){for(var oe=G+1;qt(this.input.charCodeAt(oe),!0);)++oe;var Fe=this.input.slice(G,oe);if(!Q.test(Fe))return!0}return!1},st.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Ue.lastIndex=this.pos;var E=Ue.exec(this.input),P=this.pos+E[0].length;return!_r.test(this.input.slice(this.pos,P))&&this.input.slice(P,P+8)==="function"&&(P+8===this.input.length||!qt(this.input.charAt(P+8)))},st.parseStatement=function(E,P,G){var D=this.type,oe=this.startNode(),Fe;switch(this.isLet(E)&&(D=ie._var,Fe="let"),D){case ie._break:case ie._continue:return this.parseBreakContinueStatement(oe,D.keyword);case ie._debugger:return this.parseDebuggerStatement(oe);case ie._do:return this.parseDoStatement(oe);case ie._for:return this.parseForStatement(oe);case ie._function:return E&&(this.strict||E!=="if"&&E!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(oe,!1,!E);case ie._class:return E&&this.unexpected(),this.parseClass(oe,!0);case ie._if:return this.parseIfStatement(oe);case ie._return:return this.parseReturnStatement(oe);case ie._switch:return this.parseSwitchStatement(oe);case ie._throw:return this.parseThrowStatement(oe);case ie._try:return this.parseTryStatement(oe);case ie._const:case ie._var:return Fe=Fe||this.value,E&&Fe!=="var"&&this.unexpected(),this.parseVarStatement(oe,Fe);case ie._while:return this.parseWhileStatement(oe);case ie._with:return this.parseWithStatement(oe);case ie.braceL:return this.parseBlock(!0,oe);case ie.semi:return this.parseEmptyStatement(oe);case ie._export:case ie._import:if(this.options.ecmaVersion>10&&D===ie._import){Ue.lastIndex=this.pos;var vt=Ue.exec(this.input),Mt=this.pos+vt[0].length,Dt=this.input.charCodeAt(Mt);if(Dt===40||Dt===46)return this.parseExpressionStatement(oe,this.parseExpression())}return this.options.allowImportExportEverywhere||(P||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),D===ie._import?this.parseImport(oe):this.parseExport(oe,G);default:if(this.isAsyncFunction())return E&&this.unexpected(),this.next(),this.parseFunctionStatement(oe,!0,!E);var Nr=this.value,Xr=this.parseExpression();return D===ie.name&&Xr.type==="Identifier"&&this.eat(ie.colon)?this.parseLabeledStatement(oe,Nr,Xr,E):this.parseExpressionStatement(oe,Xr)}},st.parseBreakContinueStatement=function(E,P){var G=P==="break";this.next(),this.eat(ie.semi)||this.insertSemicolon()?E.label=null:this.type!==ie.name?this.unexpected():(E.label=this.parseIdent(),this.semicolon());for(var D=0;D<this.labels.length;++D){var oe=this.labels[D];if((E.label==null||oe.name===E.label.name)&&(oe.kind!=null&&(G||oe.kind==="loop")||E.label&&G))break}return D===this.labels.length&&this.raise(E.start,"Unsyntactic "+P),this.finishNode(E,G?"BreakStatement":"ContinueStatement")},st.parseDebuggerStatement=function(E){return this.next(),this.semicolon(),this.finishNode(E,"DebuggerStatement")},st.parseDoStatement=function(E){return this.next(),this.labels.push(ar),E.body=this.parseStatement("do"),this.labels.pop(),this.expect(ie._while),E.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ie.semi):this.semicolon(),this.finishNode(E,"DoWhileStatement")},st.parseForStatement=function(E){this.next();var P=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(ar),this.enterScope(0),this.expect(ie.parenL),this.type===ie.semi)return P>-1&&this.unexpected(P),this.parseFor(E,null);var G=this.isLet();if(this.type===ie._var||this.type===ie._const||G){var D=this.startNode(),oe=G?"let":this.value;return this.next(),this.parseVar(D,!0,oe),this.finishNode(D,"VariableDeclaration"),(this.type===ie._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&D.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===ie._in?P>-1&&this.unexpected(P):E.await=P>-1),this.parseForIn(E,D)):(P>-1&&this.unexpected(P),this.parseFor(E,D))}var Fe=new j,vt=this.parseExpression(!0,Fe);return this.type===ie._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ie._in?P>-1&&this.unexpected(P):E.await=P>-1),this.toAssignable(vt,!1,Fe),this.checkLVal(vt),this.parseForIn(E,vt)):(this.checkExpressionErrors(Fe,!0),P>-1&&this.unexpected(P),this.parseFor(E,vt))},st.parseFunctionStatement=function(E,P,G){return this.next(),this.parseFunction(E,Ut|(G?0:xr),!1,P)},st.parseIfStatement=function(E){return this.next(),E.test=this.parseParenExpression(),E.consequent=this.parseStatement("if"),E.alternate=this.eat(ie._else)?this.parseStatement("if"):null,this.finishNode(E,"IfStatement")},st.parseReturnStatement=function(E){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ie.semi)||this.insertSemicolon()?E.argument=null:(E.argument=this.parseExpression(),this.semicolon()),this.finishNode(E,"ReturnStatement")},st.parseSwitchStatement=function(E){this.next(),E.discriminant=this.parseParenExpression(),E.cases=[],this.expect(ie.braceL),this.labels.push(Jr),this.enterScope(0);for(var P,G=!1;this.type!==ie.braceR;)if(this.type===ie._case||this.type===ie._default){var D=this.type===ie._case;P&&this.finishNode(P,"SwitchCase"),E.cases.push(P=this.startNode()),P.consequent=[],this.next(),D?P.test=this.parseExpression():(G&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),G=!0,P.test=null),this.expect(ie.colon)}else P||this.unexpected(),P.consequent.push(this.parseStatement(null));return this.exitScope(),P&&this.finishNode(P,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(E,"SwitchStatement")},st.parseThrowStatement=function(E){return this.next(),_r.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),E.argument=this.parseExpression(),this.semicolon(),this.finishNode(E,"ThrowStatement")};var tt=[];st.parseTryStatement=function(E){if(this.next(),E.block=this.parseBlock(),E.handler=null,this.type===ie._catch){var P=this.startNode();if(this.next(),this.eat(ie.parenL)){P.param=this.parseBindingAtom();var G=P.param.type==="Identifier";this.enterScope(G?ra:0),this.checkLVal(P.param,G?mo:yi),this.expect(ie.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),P.param=null,this.enterScope(0);P.body=this.parseBlock(!1),this.exitScope(),E.handler=this.finishNode(P,"CatchClause")}return E.finalizer=this.eat(ie._finally)?this.parseBlock():null,!E.handler&&!E.finalizer&&this.raise(E.start,"Missing catch or finally clause"),this.finishNode(E,"TryStatement")},st.parseVarStatement=function(E,P){return this.next(),this.parseVar(E,!1,P),this.semicolon(),this.finishNode(E,"VariableDeclaration")},st.parseWhileStatement=function(E){return this.next(),E.test=this.parseParenExpression(),this.labels.push(ar),E.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(E,"WhileStatement")},st.parseWithStatement=function(E){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),E.object=this.parseParenExpression(),E.body=this.parseStatement("with"),this.finishNode(E,"WithStatement")},st.parseEmptyStatement=function(E){return this.next(),this.finishNode(E,"EmptyStatement")},st.parseLabeledStatement=function(E,P,G,D){for(var oe=0,Fe=this.labels;oe<Fe.length;oe+=1){var vt=Fe[oe];vt.name===P&&this.raise(G.start,"Label '"+P+"' is already declared")}for(var Mt=this.type.isLoop?"loop":this.type===ie._switch?"switch":null,Dt=this.labels.length-1;Dt>=0;Dt--){var Nr=this.labels[Dt];if(Nr.statementStart===E.start)Nr.statementStart=this.start,Nr.kind=Mt;else break}return this.labels.push({name:P,kind:Mt,statementStart:this.start}),E.body=this.parseStatement(D?D.indexOf("label")===-1?D+"label":D:"label"),this.labels.pop(),E.label=G,this.finishNode(E,"LabeledStatement")},st.parseExpressionStatement=function(E,P){return E.expression=P,this.semicolon(),this.finishNode(E,"ExpressionStatement")},st.parseBlock=function(E,P,G){for(E===void 0&&(E=!0),P===void 0&&(P=this.startNode()),P.body=[],this.expect(ie.braceL),E&&this.enterScope(0);this.type!==ie.braceR;){var D=this.parseStatement(null);P.body.push(D)}return G&&(this.strict=!1),this.next(),E&&this.exitScope(),this.finishNode(P,"BlockStatement")},st.parseFor=function(E,P){return E.init=P,this.expect(ie.semi),E.test=this.type===ie.semi?null:this.parseExpression(),this.expect(ie.semi),E.update=this.type===ie.parenR?null:this.parseExpression(),this.expect(ie.parenR),E.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(E,"ForStatement")},st.parseForIn=function(E,P){var G=this.type===ie._in;return this.next(),P.type==="VariableDeclaration"&&P.declarations[0].init!=null&&(!G||this.options.ecmaVersion<8||this.strict||P.kind!=="var"||P.declarations[0].id.type!=="Identifier")?this.raise(P.start,(G?"for-in":"for-of")+" loop variable declaration may not have an initializer"):P.type==="AssignmentPattern"&&this.raise(P.start,"Invalid left-hand side in for-loop"),E.left=P,E.right=G?this.parseExpression():this.parseMaybeAssign(),this.expect(ie.parenR),E.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(E,G?"ForInStatement":"ForOfStatement")},st.parseVar=function(E,P,G){for(E.declarations=[],E.kind=G;;){var D=this.startNode();if(this.parseVarId(D,G),this.eat(ie.eq)?D.init=this.parseMaybeAssign(P):G==="const"&&!(this.type===ie._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():D.id.type!=="Identifier"&&!(P&&(this.type===ie._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):D.init=null,E.declarations.push(this.finishNode(D,"VariableDeclarator")),!this.eat(ie.comma))break}return E},st.parseVarId=function(E,P){E.id=this.parseBindingAtom(),this.checkLVal(E.id,P==="var"?hi:yi,!1)};var Ut=1,xr=2,Cr=4;st.parseFunction=function(E,P,G,D){this.initFunction(E),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!D)&&(this.type===ie.star&&P&xr&&this.unexpected(),E.generator=this.eat(ie.star)),this.options.ecmaVersion>=8&&(E.async=!!D),P&Ut&&(E.id=P&Cr&&this.type!==ie.name?null:this.parseIdent(),E.id&&!(P&xr)&&this.checkLVal(E.id,this.strict||E.generator||E.async?this.treatFunctionsAsVar?hi:yi:os));var oe=this.yieldPos,Fe=this.awaitPos,vt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(fi(E.async,E.generator)),P&Ut||(E.id=this.type===ie.name?this.parseIdent():null),this.parseFunctionParams(E),this.parseFunctionBody(E,G,!1),this.yieldPos=oe,this.awaitPos=Fe,this.awaitIdentPos=vt,this.finishNode(E,P&Ut?"FunctionDeclaration":"FunctionExpression")},st.parseFunctionParams=function(E){this.expect(ie.parenL),E.params=this.parseBindingList(ie.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},st.parseClass=function(E,P){this.next();var G=this.strict;this.strict=!0,this.parseClassId(E,P),this.parseClassSuper(E);var D=this.startNode(),oe=!1;for(D.body=[],this.expect(ie.braceL);this.type!==ie.braceR;){var Fe=this.parseClassElement(E.superClass!==null);Fe&&(D.body.push(Fe),Fe.type==="MethodDefinition"&&Fe.kind==="constructor"&&(oe&&this.raise(Fe.start,"Duplicate constructor in the same class"),oe=!0))}return this.strict=G,this.next(),E.body=this.finishNode(D,"ClassBody"),this.finishNode(E,P?"ClassDeclaration":"ClassExpression")},st.parseClassElement=function(E){var P=this;if(this.eat(ie.semi))return null;var G=this.startNode(),D=function(Dt,Nr){Nr===void 0&&(Nr=!1);var Xr=P.start,Qn=P.startLoc;return P.eatContextual(Dt)?P.type!==ie.parenL&&(!Nr||!P.canInsertSemicolon())?!0:(G.key&&P.unexpected(),G.computed=!1,G.key=P.startNodeAt(Xr,Qn),G.key.name=Dt,P.finishNode(G.key,"Identifier"),!1):!1};G.kind="method",G.static=D("static");var oe=this.eat(ie.star),Fe=!1;oe||(this.options.ecmaVersion>=8&&D("async",!0)?(Fe=!0,oe=this.options.ecmaVersion>=9&&this.eat(ie.star)):D("get")?G.kind="get":D("set")&&(G.kind="set")),G.key||this.parsePropertyName(G);var vt=G.key,Mt=!1;return!G.computed&&!G.static&&(vt.type==="Identifier"&&vt.name==="constructor"||vt.type==="Literal"&&vt.value==="constructor")?(G.kind!=="method"&&this.raise(vt.start,"Constructor can't have get/set modifier"),oe&&this.raise(vt.start,"Constructor can't be a generator"),Fe&&this.raise(vt.start,"Constructor can't be an async method"),G.kind="constructor",Mt=E):G.static&&vt.type==="Identifier"&&vt.name==="prototype"&&this.raise(vt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(G,oe,Fe,Mt),G.kind==="get"&&G.value.params.length!==0&&this.raiseRecoverable(G.value.start,"getter should have no params"),G.kind==="set"&&G.value.params.length!==1&&this.raiseRecoverable(G.value.start,"setter should have exactly one param"),G.kind==="set"&&G.value.params[0].type==="RestElement"&&this.raiseRecoverable(G.value.params[0].start,"Setter cannot use rest params"),G},st.parseClassMethod=function(E,P,G,D){return E.value=this.parseMethod(P,G,D),this.finishNode(E,"MethodDefinition")},st.parseClassId=function(E,P){this.type===ie.name?(E.id=this.parseIdent(),P&&this.checkLVal(E.id,yi,!1)):(P===!0&&this.unexpected(),E.id=null)},st.parseClassSuper=function(E){E.superClass=this.eat(ie._extends)?this.parseExprSubscripts():null},st.parseExport=function(E,P){if(this.next(),this.eat(ie.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(E.exported=this.parseIdent(!0),this.checkExport(P,E.exported.name,this.lastTokStart)):E.exported=null),this.expectContextual("from"),this.type!==ie.string&&this.unexpected(),E.source=this.parseExprAtom(),this.semicolon(),this.finishNode(E,"ExportAllDeclaration");if(this.eat(ie._default)){this.checkExport(P,"default",this.lastTokStart);var G;if(this.type===ie._function||(G=this.isAsyncFunction())){var D=this.startNode();this.next(),G&&this.next(),E.declaration=this.parseFunction(D,Ut|Cr,!1,G)}else if(this.type===ie._class){var oe=this.startNode();E.declaration=this.parseClass(oe,"nullableID")}else E.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(E,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())E.declaration=this.parseStatement(null),E.declaration.type==="VariableDeclaration"?this.checkVariableExport(P,E.declaration.declarations):this.checkExport(P,E.declaration.id.name,E.declaration.id.start),E.specifiers=[],E.source=null;else{if(E.declaration=null,E.specifiers=this.parseExportSpecifiers(P),this.eatContextual("from"))this.type!==ie.string&&this.unexpected(),E.source=this.parseExprAtom();else{for(var Fe=0,vt=E.specifiers;Fe<vt.length;Fe+=1){var Mt=vt[Fe];this.checkUnreserved(Mt.local),this.checkLocalExport(Mt.local)}E.source=null}this.semicolon()}return this.finishNode(E,"ExportNamedDeclaration")},st.checkExport=function(E,P,G){!E||(rt(E,P)&&this.raiseRecoverable(G,"Duplicate export '"+P+"'"),E[P]=!0)},st.checkPatternExport=function(E,P){var G=P.type;if(G==="Identifier")this.checkExport(E,P.name,P.start);else if(G==="ObjectPattern")for(var D=0,oe=P.properties;D<oe.length;D+=1){var Fe=oe[D];this.checkPatternExport(E,Fe)}else if(G==="ArrayPattern")for(var vt=0,Mt=P.elements;vt<Mt.length;vt+=1){var Dt=Mt[vt];Dt&&this.checkPatternExport(E,Dt)}else G==="Property"?this.checkPatternExport(E,P.value):G==="AssignmentPattern"?this.checkPatternExport(E,P.left):G==="RestElement"?this.checkPatternExport(E,P.argument):G==="ParenthesizedExpression"&&this.checkPatternExport(E,P.expression)},st.checkVariableExport=function(E,P){if(!!E)for(var G=0,D=P;G<D.length;G+=1){var oe=D[G];this.checkPatternExport(E,oe.id)}},st.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},st.parseExportSpecifiers=function(E){var P=[],G=!0;for(this.expect(ie.braceL);!this.eat(ie.braceR);){if(G)G=!1;else if(this.expect(ie.comma),this.afterTrailingComma(ie.braceR))break;var D=this.startNode();D.local=this.parseIdent(!0),D.exported=this.eatContextual("as")?this.parseIdent(!0):D.local,this.checkExport(E,D.exported.name,D.exported.start),P.push(this.finishNode(D,"ExportSpecifier"))}return P},st.parseImport=function(E){return this.next(),this.type===ie.string?(E.specifiers=tt,E.source=this.parseExprAtom()):(E.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),E.source=this.type===ie.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(E,"ImportDeclaration")},st.parseImportSpecifiers=function(){var E=[],P=!0;if(this.type===ie.name){var G=this.startNode();if(G.local=this.parseIdent(),this.checkLVal(G.local,yi),E.push(this.finishNode(G,"ImportDefaultSpecifier")),!this.eat(ie.comma))return E}if(this.type===ie.star){var D=this.startNode();return this.next(),this.expectContextual("as"),D.local=this.parseIdent(),this.checkLVal(D.local,yi),E.push(this.finishNode(D,"ImportNamespaceSpecifier")),E}for(this.expect(ie.braceL);!this.eat(ie.braceR);){if(P)P=!1;else if(this.expect(ie.comma),this.afterTrailingComma(ie.braceR))break;var oe=this.startNode();oe.imported=this.parseIdent(!0),this.eatContextual("as")?oe.local=this.parseIdent():(this.checkUnreserved(oe.imported),oe.local=oe.imported),this.checkLVal(oe.local,yi),E.push(this.finishNode(oe,"ImportSpecifier"))}return E},st.adaptDirectivePrologue=function(E){for(var P=0;P<E.length&&this.isDirectiveCandidate(E[P]);++P)E[P].directive=E[P].expression.raw.slice(1,-1)},st.isDirectiveCandidate=function(E){return E.type==="ExpressionStatement"&&E.expression.type==="Literal"&&typeof E.expression.value=="string"&&(this.input[E.start]==='"'||this.input[E.start]==="'")};var Lr=Pt.prototype;Lr.toAssignable=function(E,P,G){if(this.options.ecmaVersion>=6&&E)switch(E.type){case"Identifier":this.inAsync&&E.name==="await"&&this.raise(E.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":E.type="ObjectPattern",G&&this.checkPatternErrors(G,!0);for(var D=0,oe=E.properties;D<oe.length;D+=1){var Fe=oe[D];this.toAssignable(Fe,P),Fe.type==="RestElement"&&(Fe.argument.type==="ArrayPattern"||Fe.argument.type==="ObjectPattern")&&this.raise(Fe.argument.start,"Unexpected token")}break;case"Property":E.kind!=="init"&&this.raise(E.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(E.value,P);break;case"ArrayExpression":E.type="ArrayPattern",G&&this.checkPatternErrors(G,!0),this.toAssignableList(E.elements,P);break;case"SpreadElement":E.type="RestElement",this.toAssignable(E.argument,P),E.argument.type==="AssignmentPattern"&&this.raise(E.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":E.operator!=="="&&this.raise(E.left.end,"Only '=' operator can be used for specifying default value."),E.type="AssignmentPattern",delete E.operator,this.toAssignable(E.left,P);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(E.expression,P,G);break;case"ChainExpression":this.raiseRecoverable(E.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!P)break;default:this.raise(E.start,"Assigning to rvalue")}else G&&this.checkPatternErrors(G,!0);return E},Lr.toAssignableList=function(E,P){for(var G=E.length,D=0;D<G;D++){var oe=E[D];oe&&this.toAssignable(oe,P)}if(G){var Fe=E[G-1];this.options.ecmaVersion===6&&P&&Fe&&Fe.type==="RestElement"&&Fe.argument.type!=="Identifier"&&this.unexpected(Fe.argument.start)}return E},Lr.parseSpread=function(E){var P=this.startNode();return this.next(),P.argument=this.parseMaybeAssign(!1,E),this.finishNode(P,"SpreadElement")},Lr.parseRestBinding=function(){var E=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==ie.name&&this.unexpected(),E.argument=this.parseBindingAtom(),this.finishNode(E,"RestElement")},Lr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ie.bracketL:var E=this.startNode();return this.next(),E.elements=this.parseBindingList(ie.bracketR,!0,!0),this.finishNode(E,"ArrayPattern");case ie.braceL:return this.parseObj(!0)}return this.parseIdent()},Lr.parseBindingList=function(E,P,G){for(var D=[],oe=!0;!this.eat(E);)if(oe?oe=!1:this.expect(ie.comma),P&&this.type===ie.comma)D.push(null);else{if(G&&this.afterTrailingComma(E))break;if(this.type===ie.ellipsis){var Fe=this.parseRestBinding();this.parseBindingListItem(Fe),D.push(Fe),this.type===ie.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(E);break}else{var vt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(vt),D.push(vt)}}return D},Lr.parseBindingListItem=function(E){return E},Lr.parseMaybeDefault=function(E,P,G){if(G=G||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ie.eq))return G;var D=this.startNodeAt(E,P);return D.left=G,D.right=this.parseMaybeAssign(),this.finishNode(D,"AssignmentPattern")},Lr.checkLVal=function(E,P,G){switch(P===void 0&&(P=$i),E.type){case"Identifier":P===yi&&E.name==="let"&&this.raiseRecoverable(E.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(E.name)&&this.raiseRecoverable(E.start,(P?"Binding ":"Assigning to ")+E.name+" in strict mode"),G&&(rt(G,E.name)&&this.raiseRecoverable(E.start,"Argument name clash"),G[E.name]=!0),P!==$i&&P!==Ya&&this.declareName(E.name,P,E.start);break;case"ChainExpression":this.raiseRecoverable(E.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":P&&this.raiseRecoverable(E.start,"Binding member expression");break;case"ObjectPattern":for(var D=0,oe=E.properties;D<oe.length;D+=1){var Fe=oe[D];this.checkLVal(Fe,P,G)}break;case"Property":this.checkLVal(E.value,P,G);break;case"ArrayPattern":for(var vt=0,Mt=E.elements;vt<Mt.length;vt+=1){var Dt=Mt[vt];Dt&&this.checkLVal(Dt,P,G)}break;case"AssignmentPattern":this.checkLVal(E.left,P,G);break;case"RestElement":this.checkLVal(E.argument,P,G);break;case"ParenthesizedExpression":this.checkLVal(E.expression,P,G);break;default:this.raise(E.start,(P?"Binding":"Assigning to")+" rvalue")}};var vn=Pt.prototype;vn.checkPropClash=function(E,P,G){if(!(this.options.ecmaVersion>=9&&E.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(E.computed||E.method||E.shorthand))){var D=E.key,oe;switch(D.type){case"Identifier":oe=D.name;break;case"Literal":oe=String(D.value);break;default:return}var Fe=E.kind;if(this.options.ecmaVersion>=6){oe==="__proto__"&&Fe==="init"&&(P.proto&&(G?G.doubleProto<0&&(G.doubleProto=D.start):this.raiseRecoverable(D.start,"Redefinition of __proto__ property")),P.proto=!0);return}oe="$"+oe;var vt=P[oe];if(vt){var Mt;Fe==="init"?Mt=this.strict&&vt.init||vt.get||vt.set:Mt=vt.init||vt[Fe],Mt&&this.raiseRecoverable(D.start,"Redefinition of property")}else vt=P[oe]={init:!1,get:!1,set:!1};vt[Fe]=!0}},vn.parseExpression=function(E,P){var G=this.start,D=this.startLoc,oe=this.parseMaybeAssign(E,P);if(this.type===ie.comma){var Fe=this.startNodeAt(G,D);for(Fe.expressions=[oe];this.eat(ie.comma);)Fe.expressions.push(this.parseMaybeAssign(E,P));return this.finishNode(Fe,"SequenceExpression")}return oe},vn.parseMaybeAssign=function(E,P,G){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(E);this.exprAllowed=!1}var D=!1,oe=-1,Fe=-1;P?(oe=P.parenthesizedAssign,Fe=P.trailingComma,P.parenthesizedAssign=P.trailingComma=-1):(P=new j,D=!0);var vt=this.start,Mt=this.startLoc;(this.type===ie.parenL||this.type===ie.name)&&(this.potentialArrowAt=this.start);var Dt=this.parseMaybeConditional(E,P);if(G&&(Dt=G.call(this,Dt,vt,Mt)),this.type.isAssign){var Nr=this.startNodeAt(vt,Mt);return Nr.operator=this.value,Nr.left=this.type===ie.eq?this.toAssignable(Dt,!1,P):Dt,D||(P.parenthesizedAssign=P.trailingComma=P.doubleProto=-1),P.shorthandAssign>=Nr.left.start&&(P.shorthandAssign=-1),this.checkLVal(Dt),this.next(),Nr.right=this.parseMaybeAssign(E),this.finishNode(Nr,"AssignmentExpression")}else D&&this.checkExpressionErrors(P,!0);return oe>-1&&(P.parenthesizedAssign=oe),Fe>-1&&(P.trailingComma=Fe),Dt},vn.parseMaybeConditional=function(E,P){var G=this.start,D=this.startLoc,oe=this.parseExprOps(E,P);if(this.checkExpressionErrors(P))return oe;if(this.eat(ie.question)){var Fe=this.startNodeAt(G,D);return Fe.test=oe,Fe.consequent=this.parseMaybeAssign(),this.expect(ie.colon),Fe.alternate=this.parseMaybeAssign(E),this.finishNode(Fe,"ConditionalExpression")}return oe},vn.parseExprOps=function(E,P){var G=this.start,D=this.startLoc,oe=this.parseMaybeUnary(P,!1);return this.checkExpressionErrors(P)||oe.start===G&&oe.type==="ArrowFunctionExpression"?oe:this.parseExprOp(oe,G,D,-1,E)},vn.parseExprOp=function(E,P,G,D,oe){var Fe=this.type.binop;if(Fe!=null&&(!oe||this.type!==ie._in)&&Fe>D){var vt=this.type===ie.logicalOR||this.type===ie.logicalAND,Mt=this.type===ie.coalesce;Mt&&(Fe=ie.logicalAND.binop);var Dt=this.value;this.next();var Nr=this.start,Xr=this.startLoc,Qn=this.parseExprOp(this.parseMaybeUnary(null,!1),Nr,Xr,Fe,oe),Ki=this.buildBinary(P,G,E,Qn,Dt,vt||Mt);return(vt&&this.type===ie.coalesce||Mt&&(this.type===ie.logicalOR||this.type===ie.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Ki,P,G,D,oe)}return E},vn.buildBinary=function(E,P,G,D,oe,Fe){var vt=this.startNodeAt(E,P);return vt.left=G,vt.operator=oe,vt.right=D,this.finishNode(vt,Fe?"LogicalExpression":"BinaryExpression")},vn.parseMaybeUnary=function(E,P){var G=this.start,D=this.startLoc,oe;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))oe=this.parseAwait(),P=!0;else if(this.type.prefix){var Fe=this.startNode(),vt=this.type===ie.incDec;Fe.operator=this.value,Fe.prefix=!0,this.next(),Fe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(E,!0),vt?this.checkLVal(Fe.argument):this.strict&&Fe.operator==="delete"&&Fe.argument.type==="Identifier"?this.raiseRecoverable(Fe.start,"Deleting local variable in strict mode"):P=!0,oe=this.finishNode(Fe,vt?"UpdateExpression":"UnaryExpression")}else{if(oe=this.parseExprSubscripts(E),this.checkExpressionErrors(E))return oe;for(;this.type.postfix&&!this.canInsertSemicolon();){var Mt=this.startNodeAt(G,D);Mt.operator=this.value,Mt.prefix=!1,Mt.argument=oe,this.checkLVal(oe),this.next(),oe=this.finishNode(Mt,"UpdateExpression")}}return!P&&this.eat(ie.starstar)?this.buildBinary(G,D,oe,this.parseMaybeUnary(null,!1),"**",!1):oe},vn.parseExprSubscripts=function(E){var P=this.start,G=this.startLoc,D=this.parseExprAtom(E);if(D.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return D;var oe=this.parseSubscripts(D,P,G);return E&&oe.type==="MemberExpression"&&(E.parenthesizedAssign>=oe.start&&(E.parenthesizedAssign=-1),E.parenthesizedBind>=oe.start&&(E.parenthesizedBind=-1)),oe},vn.parseSubscripts=function(E,P,G,D){for(var oe=this.options.ecmaVersion>=8&&E.type==="Identifier"&&E.name==="async"&&this.lastTokEnd===E.end&&!this.canInsertSemicolon()&&E.end-E.start==5&&this.potentialArrowAt===E.start,Fe=!1;;){var vt=this.parseSubscript(E,P,G,D,oe,Fe);if(vt.optional&&(Fe=!0),vt===E||vt.type==="ArrowFunctionExpression"){if(Fe){var Mt=this.startNodeAt(P,G);Mt.expression=vt,vt=this.finishNode(Mt,"ChainExpression")}return vt}E=vt}},vn.parseSubscript=function(E,P,G,D,oe,Fe){var vt=this.options.ecmaVersion>=11,Mt=vt&&this.eat(ie.questionDot);D&&Mt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Dt=this.eat(ie.bracketL);if(Dt||Mt&&this.type!==ie.parenL&&this.type!==ie.backQuote||this.eat(ie.dot)){var Nr=this.startNodeAt(P,G);Nr.object=E,Nr.property=Dt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Nr.computed=!!Dt,Dt&&this.expect(ie.bracketR),vt&&(Nr.optional=Mt),E=this.finishNode(Nr,"MemberExpression")}else if(!D&&this.eat(ie.parenL)){var Xr=new j,Qn=this.yieldPos,Ki=this.awaitPos,ji=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var pa=this.parseExprList(ie.parenR,this.options.ecmaVersion>=8,!1,Xr);if(oe&&!Mt&&!this.canInsertSemicolon()&&this.eat(ie.arrow))return this.checkPatternErrors(Xr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Qn,this.awaitPos=Ki,this.awaitIdentPos=ji,this.parseArrowExpression(this.startNodeAt(P,G),pa,!0);this.checkExpressionErrors(Xr,!0),this.yieldPos=Qn||this.yieldPos,this.awaitPos=Ki||this.awaitPos,this.awaitIdentPos=ji||this.awaitIdentPos;var Ka=this.startNodeAt(P,G);Ka.callee=E,Ka.arguments=pa,vt&&(Ka.optional=Mt),E=this.finishNode(Ka,"CallExpression")}else if(this.type===ie.backQuote){(Mt||Fe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var yo=this.startNodeAt(P,G);yo.tag=E,yo.quasi=this.parseTemplate({isTagged:!0}),E=this.finishNode(yo,"TaggedTemplateExpression")}return E},vn.parseExprAtom=function(E){this.type===ie.slash&&this.readRegexp();var P,G=this.potentialArrowAt===this.start;switch(this.type){case ie._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),P=this.startNode(),this.next(),this.type===ie.parenL&&!this.allowDirectSuper&&this.raise(P.start,"super() call outside constructor of a subclass"),this.type!==ie.dot&&this.type!==ie.bracketL&&this.type!==ie.parenL&&this.unexpected(),this.finishNode(P,"Super");case ie._this:return P=this.startNode(),this.next(),this.finishNode(P,"ThisExpression");case ie.name:var D=this.start,oe=this.startLoc,Fe=this.containsEsc,vt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Fe&&vt.name==="async"&&!this.canInsertSemicolon()&&this.eat(ie._function))return this.parseFunction(this.startNodeAt(D,oe),0,!1,!0);if(G&&!this.canInsertSemicolon()){if(this.eat(ie.arrow))return this.parseArrowExpression(this.startNodeAt(D,oe),[vt],!1);if(this.options.ecmaVersion>=8&&vt.name==="async"&&this.type===ie.name&&!Fe)return vt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(ie.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(D,oe),[vt],!0)}return vt;case ie.regexp:var Mt=this.value;return P=this.parseLiteral(Mt.value),P.regex={pattern:Mt.pattern,flags:Mt.flags},P;case ie.num:case ie.string:return this.parseLiteral(this.value);case ie._null:case ie._true:case ie._false:return P=this.startNode(),P.value=this.type===ie._null?null:this.type===ie._true,P.raw=this.type.keyword,this.next(),this.finishNode(P,"Literal");case ie.parenL:var Dt=this.start,Nr=this.parseParenAndDistinguishExpression(G);return E&&(E.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Nr)&&(E.parenthesizedAssign=Dt),E.parenthesizedBind<0&&(E.parenthesizedBind=Dt)),Nr;case ie.bracketL:return P=this.startNode(),this.next(),P.elements=this.parseExprList(ie.bracketR,!0,!0,E),this.finishNode(P,"ArrayExpression");case ie.braceL:return this.parseObj(!1,E);case ie._function:return P=this.startNode(),this.next(),this.parseFunction(P,0);case ie._class:return this.parseClass(this.startNode(),!1);case ie._new:return this.parseNew();case ie.backQuote:return this.parseTemplate();case ie._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},vn.parseExprImport=function(){var E=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var P=this.parseIdent(!0);switch(this.type){case ie.parenL:return this.parseDynamicImport(E);case ie.dot:return E.meta=P,this.parseImportMeta(E);default:this.unexpected()}},vn.parseDynamicImport=function(E){if(this.next(),E.source=this.parseMaybeAssign(),!this.eat(ie.parenR)){var P=this.start;this.eat(ie.comma)&&this.eat(ie.parenR)?this.raiseRecoverable(P,"Trailing comma is not allowed in import()"):this.unexpected(P)}return this.finishNode(E,"ImportExpression")},vn.parseImportMeta=function(E){this.next();var P=this.containsEsc;return E.property=this.parseIdent(!0),E.property.name!=="meta"&&this.raiseRecoverable(E.property.start,"The only valid meta property for import is 'import.meta'"),P&&this.raiseRecoverable(E.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(E.start,"Cannot use 'import.meta' outside a module"),this.finishNode(E,"MetaProperty")},vn.parseLiteral=function(E){var P=this.startNode();return P.value=E,P.raw=this.input.slice(this.start,this.end),P.raw.charCodeAt(P.raw.length-1)===110&&(P.bigint=P.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(P,"Literal")},vn.parseParenExpression=function(){this.expect(ie.parenL);var E=this.parseExpression();return this.expect(ie.parenR),E},vn.parseParenAndDistinguishExpression=function(E){var P=this.start,G=this.startLoc,D,oe=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Fe=this.start,vt=this.startLoc,Mt=[],Dt=!0,Nr=!1,Xr=new j,Qn=this.yieldPos,Ki=this.awaitPos,ji;for(this.yieldPos=0,this.awaitPos=0;this.type!==ie.parenR;)if(Dt?Dt=!1:this.expect(ie.comma),oe&&this.afterTrailingComma(ie.parenR,!0)){Nr=!0;break}else if(this.type===ie.ellipsis){ji=this.start,Mt.push(this.parseParenItem(this.parseRestBinding())),this.type===ie.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Mt.push(this.parseMaybeAssign(!1,Xr,this.parseParenItem));var pa=this.start,Ka=this.startLoc;if(this.expect(ie.parenR),E&&!this.canInsertSemicolon()&&this.eat(ie.arrow))return this.checkPatternErrors(Xr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Qn,this.awaitPos=Ki,this.parseParenArrowList(P,G,Mt);(!Mt.length||Nr)&&this.unexpected(this.lastTokStart),ji&&this.unexpected(ji),this.checkExpressionErrors(Xr,!0),this.yieldPos=Qn||this.yieldPos,this.awaitPos=Ki||this.awaitPos,Mt.length>1?(D=this.startNodeAt(Fe,vt),D.expressions=Mt,this.finishNodeAt(D,"SequenceExpression",pa,Ka)):D=Mt[0]}else D=this.parseParenExpression();if(this.options.preserveParens){var yo=this.startNodeAt(P,G);return yo.expression=D,this.finishNode(yo,"ParenthesizedExpression")}else return D},vn.parseParenItem=function(E){return E},vn.parseParenArrowList=function(E,P,G){return this.parseArrowExpression(this.startNodeAt(E,P),G)};var vi=[];vn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var E=this.startNode(),P=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ie.dot)){E.meta=P;var G=this.containsEsc;return E.property=this.parseIdent(!0),E.property.name!=="target"&&this.raiseRecoverable(E.property.start,"The only valid meta property for new is 'new.target'"),G&&this.raiseRecoverable(E.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(E.start,"'new.target' can only be used in functions"),this.finishNode(E,"MetaProperty")}var D=this.start,oe=this.startLoc,Fe=this.type===ie._import;return E.callee=this.parseSubscripts(this.parseExprAtom(),D,oe,!0),Fe&&E.callee.type==="ImportExpression"&&this.raise(D,"Cannot use new with import()"),this.eat(ie.parenL)?E.arguments=this.parseExprList(ie.parenR,this.options.ecmaVersion>=8,!1):E.arguments=vi,this.finishNode(E,"NewExpression")},vn.parseTemplateElement=function(E){var P=E.isTagged,G=this.startNode();return this.type===ie.invalidTemplate?(P||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),G.value={raw:this.value,cooked:null}):G.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),G.tail=this.type===ie.backQuote,this.finishNode(G,"TemplateElement")},vn.parseTemplate=function(E){E===void 0&&(E={});var P=E.isTagged;P===void 0&&(P=!1);var G=this.startNode();this.next(),G.expressions=[];var D=this.parseTemplateElement({isTagged:P});for(G.quasis=[D];!D.tail;)this.type===ie.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ie.dollarBraceL),G.expressions.push(this.parseExpression()),this.expect(ie.braceR),G.quasis.push(D=this.parseTemplateElement({isTagged:P}));return this.next(),this.finishNode(G,"TemplateLiteral")},vn.isAsyncProp=function(E){return!E.computed&&E.key.type==="Identifier"&&E.key.name==="async"&&(this.type===ie.name||this.type===ie.num||this.type===ie.string||this.type===ie.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ie.star)&&!_r.test(this.input.slice(this.lastTokEnd,this.start))},vn.parseObj=function(E,P){var G=this.startNode(),D=!0,oe={};for(G.properties=[],this.next();!this.eat(ie.braceR);){if(D)D=!1;else if(this.expect(ie.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ie.braceR))break;var Fe=this.parseProperty(E,P);E||this.checkPropClash(Fe,oe,P),G.properties.push(Fe)}return this.finishNode(G,E?"ObjectPattern":"ObjectExpression")},vn.parseProperty=function(E,P){var G=this.startNode(),D,oe,Fe,vt;if(this.options.ecmaVersion>=9&&this.eat(ie.ellipsis))return E?(G.argument=this.parseIdent(!1),this.type===ie.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(G,"RestElement")):(this.type===ie.parenL&&P&&(P.parenthesizedAssign<0&&(P.parenthesizedAssign=this.start),P.parenthesizedBind<0&&(P.parenthesizedBind=this.start)),G.argument=this.parseMaybeAssign(!1,P),this.type===ie.comma&&P&&P.trailingComma<0&&(P.trailingComma=this.start),this.finishNode(G,"SpreadElement"));this.options.ecmaVersion>=6&&(G.method=!1,G.shorthand=!1,(E||P)&&(Fe=this.start,vt=this.startLoc),E||(D=this.eat(ie.star)));var Mt=this.containsEsc;return this.parsePropertyName(G),!E&&!Mt&&this.options.ecmaVersion>=8&&!D&&this.isAsyncProp(G)?(oe=!0,D=this.options.ecmaVersion>=9&&this.eat(ie.star),this.parsePropertyName(G,P)):oe=!1,this.parsePropertyValue(G,E,D,oe,Fe,vt,P,Mt),this.finishNode(G,"Property")},vn.parsePropertyValue=function(E,P,G,D,oe,Fe,vt,Mt){if((G||D)&&this.type===ie.colon&&this.unexpected(),this.eat(ie.colon))E.value=P?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,vt),E.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ie.parenL)P&&this.unexpected(),E.kind="init",E.method=!0,E.value=this.parseMethod(G,D);else if(!P&&!Mt&&this.options.ecmaVersion>=5&&!E.computed&&E.key.type==="Identifier"&&(E.key.name==="get"||E.key.name==="set")&&this.type!==ie.comma&&this.type!==ie.braceR&&this.type!==ie.eq){(G||D)&&this.unexpected(),E.kind=E.key.name,this.parsePropertyName(E),E.value=this.parseMethod(!1);var Dt=E.kind==="get"?0:1;if(E.value.params.length!==Dt){var Nr=E.value.start;E.kind==="get"?this.raiseRecoverable(Nr,"getter should have no params"):this.raiseRecoverable(Nr,"setter should have exactly one param")}else E.kind==="set"&&E.value.params[0].type==="RestElement"&&this.raiseRecoverable(E.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!E.computed&&E.key.type==="Identifier"?((G||D)&&this.unexpected(),this.checkUnreserved(E.key),E.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=oe),E.kind="init",P?E.value=this.parseMaybeDefault(oe,Fe,E.key):this.type===ie.eq&&vt?(vt.shorthandAssign<0&&(vt.shorthandAssign=this.start),E.value=this.parseMaybeDefault(oe,Fe,E.key)):E.value=E.key,E.shorthand=!0):this.unexpected()},vn.parsePropertyName=function(E){if(this.options.ecmaVersion>=6){if(this.eat(ie.bracketL))return E.computed=!0,E.key=this.parseMaybeAssign(),this.expect(ie.bracketR),E.key;E.computed=!1}return E.key=this.type===ie.num||this.type===ie.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},vn.initFunction=function(E){E.id=null,this.options.ecmaVersion>=6&&(E.generator=E.expression=!1),this.options.ecmaVersion>=8&&(E.async=!1)},vn.parseMethod=function(E,P,G){var D=this.startNode(),oe=this.yieldPos,Fe=this.awaitPos,vt=this.awaitIdentPos;return this.initFunction(D),this.options.ecmaVersion>=6&&(D.generator=E),this.options.ecmaVersion>=8&&(D.async=!!P),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(fi(P,D.generator)|Vi|(G?ga:0)),this.expect(ie.parenL),D.params=this.parseBindingList(ie.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(D,!1,!0),this.yieldPos=oe,this.awaitPos=Fe,this.awaitIdentPos=vt,this.finishNode(D,"FunctionExpression")},vn.parseArrowExpression=function(E,P,G){var D=this.yieldPos,oe=this.awaitPos,Fe=this.awaitIdentPos;return this.enterScope(fi(G,!1)|Xa),this.initFunction(E),this.options.ecmaVersion>=8&&(E.async=!!G),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,E.params=this.toAssignableList(P,!0),this.parseFunctionBody(E,!0,!1),this.yieldPos=D,this.awaitPos=oe,this.awaitIdentPos=Fe,this.finishNode(E,"ArrowFunctionExpression")},vn.parseFunctionBody=function(E,P,G){var D=P&&this.type!==ie.braceL,oe=this.strict,Fe=!1;if(D)E.body=this.parseMaybeAssign(),E.expression=!0,this.checkParams(E,!1);else{var vt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(E.params);(!oe||vt)&&(Fe=this.strictDirective(this.end),Fe&&vt&&this.raiseRecoverable(E.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Mt=this.labels;this.labels=[],Fe&&(this.strict=!0),this.checkParams(E,!oe&&!Fe&&!P&&!G&&this.isSimpleParamList(E.params)),this.strict&&E.id&&this.checkLVal(E.id,Ya),E.body=this.parseBlock(!1,void 0,Fe&&!oe),E.expression=!1,this.adaptDirectivePrologue(E.body.body),this.labels=Mt}this.exitScope()},vn.isSimpleParamList=function(E){for(var P=0,G=E;P<G.length;P+=1){var D=G[P];if(D.type!=="Identifier")return!1}return!0},vn.checkParams=function(E,P){for(var G={},D=0,oe=E.params;D<oe.length;D+=1){var Fe=oe[D];this.checkLVal(Fe,hi,P?null:G)}},vn.parseExprList=function(E,P,G,D){for(var oe=[],Fe=!0;!this.eat(E);){if(Fe)Fe=!1;else if(this.expect(ie.comma),P&&this.afterTrailingComma(E))break;var vt=void 0;G&&this.type===ie.comma?vt=null:this.type===ie.ellipsis?(vt=this.parseSpread(D),D&&this.type===ie.comma&&D.trailingComma<0&&(D.trailingComma=this.start)):vt=this.parseMaybeAssign(!1,D),oe.push(vt)}return oe},vn.checkUnreserved=function(E){var P=E.start,G=E.end,D=E.name;if(this.inGenerator&&D==="yield"&&this.raiseRecoverable(P,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&D==="await"&&this.raiseRecoverable(P,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(D)&&this.raise(P,"Unexpected keyword '"+D+"'"),!(this.options.ecmaVersion<6&&this.input.slice(P,G).indexOf("\\")!==-1)){var oe=this.strict?this.reservedWordsStrict:this.reservedWords;oe.test(D)&&(!this.inAsync&&D==="await"&&this.raiseRecoverable(P,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(P,"The keyword '"+D+"' is reserved"))}},vn.parseIdent=function(E,P){var G=this.startNode();return this.type===ie.name?G.name=this.value:this.type.keyword?(G.name=this.type.keyword,(G.name==="class"||G.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!E),this.finishNode(G,"Identifier"),E||(this.checkUnreserved(G),G.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=G.start)),G},vn.parseYield=function(E){this.yieldPos||(this.yieldPos=this.start);var P=this.startNode();return this.next(),this.type===ie.semi||this.canInsertSemicolon()||this.type!==ie.star&&!this.type.startsExpr?(P.delegate=!1,P.argument=null):(P.delegate=this.eat(ie.star),P.argument=this.parseMaybeAssign(E)),this.finishNode(P,"YieldExpression")},vn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var E=this.startNode();return this.next(),E.argument=this.parseMaybeUnary(null,!1),this.finishNode(E,"AwaitExpression")};var ni=Pt.prototype;ni.raise=function(E,P){var G=Ft(this.input,E);P+=" ("+G.line+":"+G.column+")";var D=new SyntaxError(P);throw D.pos=E,D.loc=G,D.raisedAt=this.pos,D},ni.raiseRecoverable=ni.raise,ni.curPosition=function(){if(this.options.locations)return new ze(this.curLine,this.pos-this.lineStart)};var An=Pt.prototype,Oi=function(P){this.flags=P,this.var=[],this.lexical=[],this.functions=[]};An.enterScope=function(E){this.scopeStack.push(new Oi(E))},An.exitScope=function(){this.scopeStack.pop()},An.treatFunctionsAsVarInScope=function(E){return E.flags&Sn||!this.inModule&&E.flags&Bn},An.declareName=function(E,P,G){var D=!1;if(P===yi){var oe=this.currentScope();D=oe.lexical.indexOf(E)>-1||oe.functions.indexOf(E)>-1||oe.var.indexOf(E)>-1,oe.lexical.push(E),this.inModule&&oe.flags&Bn&&delete this.undefinedExports[E]}else if(P===mo){var Fe=this.currentScope();Fe.lexical.push(E)}else if(P===os){var vt=this.currentScope();this.treatFunctionsAsVar?D=vt.lexical.indexOf(E)>-1:D=vt.lexical.indexOf(E)>-1||vt.var.indexOf(E)>-1,vt.functions.push(E)}else for(var Mt=this.scopeStack.length-1;Mt>=0;--Mt){var Dt=this.scopeStack[Mt];if(Dt.lexical.indexOf(E)>-1&&!(Dt.flags&ra&&Dt.lexical[0]===E)||!this.treatFunctionsAsVarInScope(Dt)&&Dt.functions.indexOf(E)>-1){D=!0;break}if(Dt.var.push(E),this.inModule&&Dt.flags&Bn&&delete this.undefinedExports[E],Dt.flags&Li)break}D&&this.raiseRecoverable(G,"Identifier '"+E+"' has already been declared")},An.checkLocalExport=function(E){this.scopeStack[0].lexical.indexOf(E.name)===-1&&this.scopeStack[0].var.indexOf(E.name)===-1&&(this.undefinedExports[E.name]=E)},An.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},An.currentVarScope=function(){for(var E=this.scopeStack.length-1;;E--){var P=this.scopeStack[E];if(P.flags&Li)return P}},An.currentThisScope=function(){for(var E=this.scopeStack.length-1;;E--){var P=this.scopeStack[E];if(P.flags&Li&&!(P.flags&Xa))return P}};var zi=function(P,G,D){this.type="",this.start=G,this.end=0,P.options.locations&&(this.loc=new At(P,D)),P.options.directSourceFile&&(this.sourceFile=P.options.directSourceFile),P.options.ranges&&(this.range=[G,0])},Pa=Pt.prototype;Pa.startNode=function(){return new zi(this,this.start,this.startLoc)},Pa.startNodeAt=function(E,P){return new zi(this,E,P)};function ia(E,P,G,D){return E.type=P,E.end=G,this.options.locations&&(E.loc.end=D),this.options.ranges&&(E.range[1]=G),E}Pa.finishNode=function(E,P){return ia.call(this,E,P,this.lastTokEnd,this.lastTokEndLoc)},Pa.finishNodeAt=function(E,P,G,D){return ia.call(this,E,P,G,D)};var ao=function(P,G,D,oe,Fe){this.token=P,this.isExpr=!!G,this.preserveSpace=!!D,this.override=oe,this.generator=!!Fe},Ci={b_stat:new ao("{",!1),b_expr:new ao("{",!0),b_tmpl:new ao("${",!1),p_stat:new ao("(",!1),p_expr:new ao("(",!0),q_tmpl:new ao("`",!0,!0,function(E){return E.tryReadTemplateToken()}),f_stat:new ao("function",!1),f_expr:new ao("function",!0),f_expr_gen:new ao("function",!0,!1,null,!0),f_gen:new ao("function",!1,!1,null,!0)},da=Pt.prototype;da.initialContext=function(){return[Ci.b_stat]},da.braceIsBlock=function(E){var P=this.curContext();return P===Ci.f_expr||P===Ci.f_stat?!0:E===ie.colon&&(P===Ci.b_stat||P===Ci.b_expr)?!P.isExpr:E===ie._return||E===ie.name&&this.exprAllowed?_r.test(this.input.slice(this.lastTokEnd,this.start)):E===ie._else||E===ie.semi||E===ie.eof||E===ie.parenR||E===ie.arrow?!0:E===ie.braceL?P===Ci.b_stat:E===ie._var||E===ie._const||E===ie.name?!1:!this.exprAllowed},da.inGeneratorContext=function(){for(var E=this.context.length-1;E>=1;E--){var P=this.context[E];if(P.token==="function")return P.generator}return!1},da.updateContext=function(E){var P,G=this.type;G.keyword&&E===ie.dot?this.exprAllowed=!1:(P=G.updateContext)?P.call(this,E):this.exprAllowed=G.beforeExpr},ie.parenR.updateContext=ie.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var E=this.context.pop();E===Ci.b_stat&&this.curContext().token==="function"&&(E=this.context.pop()),this.exprAllowed=!E.isExpr},ie.braceL.updateContext=function(E){this.context.push(this.braceIsBlock(E)?Ci.b_stat:Ci.b_expr),this.exprAllowed=!0},ie.dollarBraceL.updateContext=function(){this.context.push(Ci.b_tmpl),this.exprAllowed=!0},ie.parenL.updateContext=function(E){var P=E===ie._if||E===ie._for||E===ie._with||E===ie._while;this.context.push(P?Ci.p_stat:Ci.p_expr),this.exprAllowed=!0},ie.incDec.updateContext=function(){},ie._function.updateContext=ie._class.updateContext=function(E){E.beforeExpr&&E!==ie.semi&&E!==ie._else&&!(E===ie._return&&_r.test(this.input.slice(this.lastTokEnd,this.start)))&&!((E===ie.colon||E===ie.braceL)&&this.curContext()===Ci.b_stat)?this.context.push(Ci.f_expr):this.context.push(Ci.f_stat),this.exprAllowed=!1},ie.backQuote.updateContext=function(){this.curContext()===Ci.q_tmpl?this.context.pop():this.context.push(Ci.q_tmpl),this.exprAllowed=!1},ie.star.updateContext=function(E){if(E===ie._function){var P=this.context.length-1;this.context[P]===Ci.f_expr?this.context[P]=Ci.f_expr_gen:this.context[P]=Ci.f_gen}this.exprAllowed=!0},ie.name.updateContext=function(E){var P=!1;this.options.ecmaVersion>=6&&E!==ie.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(P=!0),this.exprAllowed=P};var J="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",se=J+" Extended_Pictographic",_e=se,ke={9:J,10:se,11:_e},Ye="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ut="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",xt=ut+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Ie=xt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",nt={9:ut,10:xt,11:Ie},Ht={};function jr(E){var P=Ht[E]={binary:ae(ke[E]+" "+Ye),nonBinary:{General_Category:ae(Ye),Script:ae(nt[E])}};P.nonBinary.Script_Extensions=P.nonBinary.Script,P.nonBinary.gc=P.nonBinary.General_Category,P.nonBinary.sc=P.nonBinary.Script,P.nonBinary.scx=P.nonBinary.Script_Extensions}jr(9),jr(10),jr(11);var ir=Pt.prototype,pr=function(P){this.parser=P,this.validFlags="gim"+(P.options.ecmaVersion>=6?"uy":"")+(P.options.ecmaVersion>=9?"s":""),this.unicodeProperties=Ht[P.options.ecmaVersion>=11?11:P.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};pr.prototype.reset=function(P,G,D){var oe=D.indexOf("u")!==-1;this.start=P|0,this.source=G+"",this.flags=D,this.switchU=oe&&this.parser.options.ecmaVersion>=6,this.switchN=oe&&this.parser.options.ecmaVersion>=9},pr.prototype.raise=function(P){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+P)},pr.prototype.at=function(P,G){G===void 0&&(G=!1);var D=this.source,oe=D.length;if(P>=oe)return-1;var Fe=D.charCodeAt(P);if(!(G||this.switchU)||Fe<=55295||Fe>=57344||P+1>=oe)return Fe;var vt=D.charCodeAt(P+1);return vt>=56320&&vt<=57343?(Fe<<10)+vt-56613888:Fe},pr.prototype.nextIndex=function(P,G){G===void 0&&(G=!1);var D=this.source,oe=D.length;if(P>=oe)return oe;var Fe=D.charCodeAt(P),vt;return!(G||this.switchU)||Fe<=55295||Fe>=57344||P+1>=oe||(vt=D.charCodeAt(P+1))<56320||vt>57343?P+1:P+2},pr.prototype.current=function(P){return P===void 0&&(P=!1),this.at(this.pos,P)},pr.prototype.lookahead=function(P){return P===void 0&&(P=!1),this.at(this.nextIndex(this.pos,P),P)},pr.prototype.advance=function(P){P===void 0&&(P=!1),this.pos=this.nextIndex(this.pos,P)},pr.prototype.eat=function(P,G){return G===void 0&&(G=!1),this.current(G)===P?(this.advance(G),!0):!1};function Hr(E){return E<=65535?String.fromCharCode(E):(E-=65536,String.fromCharCode((E>>10)+55296,(E&1023)+56320))}ir.validateRegExpFlags=function(E){for(var P=E.validFlags,G=E.flags,D=0;D<G.length;D++){var oe=G.charAt(D);P.indexOf(oe)===-1&&this.raise(E.start,"Invalid regular expression flag"),G.indexOf(oe,D+1)>-1&&this.raise(E.start,"Duplicate regular expression flag")}},ir.validateRegExpPattern=function(E){this.regexp_pattern(E),!E.switchN&&this.options.ecmaVersion>=9&&E.groupNames.length>0&&(E.switchN=!0,this.regexp_pattern(E))},ir.regexp_pattern=function(E){E.pos=0,E.lastIntValue=0,E.lastStringValue="",E.lastAssertionIsQuantifiable=!1,E.numCapturingParens=0,E.maxBackReference=0,E.groupNames.length=0,E.backReferenceNames.length=0,this.regexp_disjunction(E),E.pos!==E.source.length&&(E.eat(41)&&E.raise("Unmatched ')'"),(E.eat(93)||E.eat(125))&&E.raise("Lone quantifier brackets")),E.maxBackReference>E.numCapturingParens&&E.raise("Invalid escape");for(var P=0,G=E.backReferenceNames;P<G.length;P+=1){var D=G[P];E.groupNames.indexOf(D)===-1&&E.raise("Invalid named capture referenced")}},ir.regexp_disjunction=function(E){for(this.regexp_alternative(E);E.eat(124);)this.regexp_alternative(E);this.regexp_eatQuantifier(E,!0)&&E.raise("Nothing to repeat"),E.eat(123)&&E.raise("Lone quantifier brackets")},ir.regexp_alternative=function(E){for(;E.pos<E.source.length&&this.regexp_eatTerm(E););},ir.regexp_eatTerm=function(E){return this.regexp_eatAssertion(E)?(E.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(E)&&E.switchU&&E.raise("Invalid quantifier"),!0):(E.switchU?this.regexp_eatAtom(E):this.regexp_eatExtendedAtom(E))?(this.regexp_eatQuantifier(E),!0):!1},ir.regexp_eatAssertion=function(E){var P=E.pos;if(E.lastAssertionIsQuantifiable=!1,E.eat(94)||E.eat(36))return!0;if(E.eat(92)){if(E.eat(66)||E.eat(98))return!0;E.pos=P}if(E.eat(40)&&E.eat(63)){var G=!1;if(this.options.ecmaVersion>=9&&(G=E.eat(60)),E.eat(61)||E.eat(33))return this.regexp_disjunction(E),E.eat(41)||E.raise("Unterminated group"),E.lastAssertionIsQuantifiable=!G,!0}return E.pos=P,!1},ir.regexp_eatQuantifier=function(E,P){return P===void 0&&(P=!1),this.regexp_eatQuantifierPrefix(E,P)?(E.eat(63),!0):!1},ir.regexp_eatQuantifierPrefix=function(E,P){return E.eat(42)||E.eat(43)||E.eat(63)||this.regexp_eatBracedQuantifier(E,P)},ir.regexp_eatBracedQuantifier=function(E,P){var G=E.pos;if(E.eat(123)){var D=0,oe=-1;if(this.regexp_eatDecimalDigits(E)&&(D=E.lastIntValue,E.eat(44)&&this.regexp_eatDecimalDigits(E)&&(oe=E.lastIntValue),E.eat(125)))return oe!==-1&&oe<D&&!P&&E.raise("numbers out of order in {} quantifier"),!0;E.switchU&&!P&&E.raise("Incomplete quantifier"),E.pos=G}return!1},ir.regexp_eatAtom=function(E){return this.regexp_eatPatternCharacters(E)||E.eat(46)||this.regexp_eatReverseSolidusAtomEscape(E)||this.regexp_eatCharacterClass(E)||this.regexp_eatUncapturingGroup(E)||this.regexp_eatCapturingGroup(E)},ir.regexp_eatReverseSolidusAtomEscape=function(E){var P=E.pos;if(E.eat(92)){if(this.regexp_eatAtomEscape(E))return!0;E.pos=P}return!1},ir.regexp_eatUncapturingGroup=function(E){var P=E.pos;if(E.eat(40)){if(E.eat(63)&&E.eat(58)){if(this.regexp_disjunction(E),E.eat(41))return!0;E.raise("Unterminated group")}E.pos=P}return!1},ir.regexp_eatCapturingGroup=function(E){if(E.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(E):E.current()===63&&E.raise("Invalid group"),this.regexp_disjunction(E),E.eat(41))return E.numCapturingParens+=1,!0;E.raise("Unterminated group")}return!1},ir.regexp_eatExtendedAtom=function(E){return E.eat(46)||this.regexp_eatReverseSolidusAtomEscape(E)||this.regexp_eatCharacterClass(E)||this.regexp_eatUncapturingGroup(E)||this.regexp_eatCapturingGroup(E)||this.regexp_eatInvalidBracedQuantifier(E)||this.regexp_eatExtendedPatternCharacter(E)},ir.regexp_eatInvalidBracedQuantifier=function(E){return this.regexp_eatBracedQuantifier(E,!0)&&E.raise("Nothing to repeat"),!1},ir.regexp_eatSyntaxCharacter=function(E){var P=E.current();return oi(P)?(E.lastIntValue=P,E.advance(),!0):!1};function oi(E){return E===36||E>=40&&E<=43||E===46||E===63||E>=91&&E<=94||E>=123&&E<=125}ir.regexp_eatPatternCharacters=function(E){for(var P=E.pos,G=0;(G=E.current())!==-1&&!oi(G);)E.advance();return E.pos!==P},ir.regexp_eatExtendedPatternCharacter=function(E){var P=E.current();return P!==-1&&P!==36&&!(P>=40&&P<=43)&&P!==46&&P!==63&&P!==91&&P!==94&&P!==124?(E.advance(),!0):!1},ir.regexp_groupSpecifier=function(E){if(E.eat(63)){if(this.regexp_eatGroupName(E)){E.groupNames.indexOf(E.lastStringValue)!==-1&&E.raise("Duplicate capture group name"),E.groupNames.push(E.lastStringValue);return}E.raise("Invalid group")}},ir.regexp_eatGroupName=function(E){if(E.lastStringValue="",E.eat(60)){if(this.regexp_eatRegExpIdentifierName(E)&&E.eat(62))return!0;E.raise("Invalid capture group name")}return!1},ir.regexp_eatRegExpIdentifierName=function(E){if(E.lastStringValue="",this.regexp_eatRegExpIdentifierStart(E)){for(E.lastStringValue+=Hr(E.lastIntValue);this.regexp_eatRegExpIdentifierPart(E);)E.lastStringValue+=Hr(E.lastIntValue);return!0}return!1},ir.regexp_eatRegExpIdentifierStart=function(E){var P=E.pos,G=this.options.ecmaVersion>=11,D=E.current(G);return E.advance(G),D===92&&this.regexp_eatRegExpUnicodeEscapeSequence(E,G)&&(D=E.lastIntValue),wn(D)?(E.lastIntValue=D,!0):(E.pos=P,!1)};function wn(E){return tr(E,!0)||E===36||E===95}ir.regexp_eatRegExpIdentifierPart=function(E){var P=E.pos,G=this.options.ecmaVersion>=11,D=E.current(G);return E.advance(G),D===92&&this.regexp_eatRegExpUnicodeEscapeSequence(E,G)&&(D=E.lastIntValue),rr(D)?(E.lastIntValue=D,!0):(E.pos=P,!1)};function rr(E){return qt(E,!0)||E===36||E===95||E===8204||E===8205}ir.regexp_eatAtomEscape=function(E){return this.regexp_eatBackReference(E)||this.regexp_eatCharacterClassEscape(E)||this.regexp_eatCharacterEscape(E)||E.switchN&&this.regexp_eatKGroupName(E)?!0:(E.switchU&&(E.current()===99&&E.raise("Invalid unicode escape"),E.raise("Invalid escape")),!1)},ir.regexp_eatBackReference=function(E){var P=E.pos;if(this.regexp_eatDecimalEscape(E)){var G=E.lastIntValue;if(E.switchU)return G>E.maxBackReference&&(E.maxBackReference=G),!0;if(G<=E.numCapturingParens)return!0;E.pos=P}return!1},ir.regexp_eatKGroupName=function(E){if(E.eat(107)){if(this.regexp_eatGroupName(E))return E.backReferenceNames.push(E.lastStringValue),!0;E.raise("Invalid named reference")}return!1},ir.regexp_eatCharacterEscape=function(E){return this.regexp_eatControlEscape(E)||this.regexp_eatCControlLetter(E)||this.regexp_eatZero(E)||this.regexp_eatHexEscapeSequence(E)||this.regexp_eatRegExpUnicodeEscapeSequence(E,!1)||!E.switchU&&this.regexp_eatLegacyOctalEscapeSequence(E)||this.regexp_eatIdentityEscape(E)},ir.regexp_eatCControlLetter=function(E){var P=E.pos;if(E.eat(99)){if(this.regexp_eatControlLetter(E))return!0;E.pos=P}return!1},ir.regexp_eatZero=function(E){return E.current()===48&&!na(E.lookahead())?(E.lastIntValue=0,E.advance(),!0):!1},ir.regexp_eatControlEscape=function(E){var P=E.current();return P===116?(E.lastIntValue=9,E.advance(),!0):P===110?(E.lastIntValue=10,E.advance(),!0):P===118?(E.lastIntValue=11,E.advance(),!0):P===102?(E.lastIntValue=12,E.advance(),!0):P===114?(E.lastIntValue=13,E.advance(),!0):!1},ir.regexp_eatControlLetter=function(E){var P=E.current();return Wn(P)?(E.lastIntValue=P%32,E.advance(),!0):!1};function Wn(E){return E>=65&&E<=90||E>=97&&E<=122}ir.regexp_eatRegExpUnicodeEscapeSequence=function(E,P){P===void 0&&(P=!1);var G=E.pos,D=P||E.switchU;if(E.eat(117)){if(this.regexp_eatFixedHexDigits(E,4)){var oe=E.lastIntValue;if(D&&oe>=55296&&oe<=56319){var Fe=E.pos;if(E.eat(92)&&E.eat(117)&&this.regexp_eatFixedHexDigits(E,4)){var vt=E.lastIntValue;if(vt>=56320&&vt<=57343)return E.lastIntValue=(oe-55296)*1024+(vt-56320)+65536,!0}E.pos=Fe,E.lastIntValue=oe}return!0}if(D&&E.eat(123)&&this.regexp_eatHexDigits(E)&&E.eat(125)&&Mr(E.lastIntValue))return!0;D&&E.raise("Invalid unicode escape"),E.pos=G}return!1};function Mr(E){return E>=0&&E<=1114111}ir.regexp_eatIdentityEscape=function(E){if(E.switchU)return this.regexp_eatSyntaxCharacter(E)?!0:E.eat(47)?(E.lastIntValue=47,!0):!1;var P=E.current();return P!==99&&(!E.switchN||P!==107)?(E.lastIntValue=P,E.advance(),!0):!1},ir.regexp_eatDecimalEscape=function(E){E.lastIntValue=0;var P=E.current();if(P>=49&&P<=57){do E.lastIntValue=10*E.lastIntValue+(P-48),E.advance();while((P=E.current())>=48&&P<=57);return!0}return!1},ir.regexp_eatCharacterClassEscape=function(E){var P=E.current();if(mn(P))return E.lastIntValue=-1,E.advance(),!0;if(E.switchU&&this.options.ecmaVersion>=9&&(P===80||P===112)){if(E.lastIntValue=-1,E.advance(),E.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(E)&&E.eat(125))return!0;E.raise("Invalid property name")}return!1};function mn(E){return E===100||E===68||E===115||E===83||E===119||E===87}ir.regexp_eatUnicodePropertyValueExpression=function(E){var P=E.pos;if(this.regexp_eatUnicodePropertyName(E)&&E.eat(61)){var G=E.lastStringValue;if(this.regexp_eatUnicodePropertyValue(E)){var D=E.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(E,G,D),!0}}if(E.pos=P,this.regexp_eatLoneUnicodePropertyNameOrValue(E)){var oe=E.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(E,oe),!0}return!1},ir.regexp_validateUnicodePropertyNameAndValue=function(E,P,G){rt(E.unicodeProperties.nonBinary,P)||E.raise("Invalid property name"),E.unicodeProperties.nonBinary[P].test(G)||E.raise("Invalid property value")},ir.regexp_validateUnicodePropertyNameOrValue=function(E,P){E.unicodeProperties.binary.test(P)||E.raise("Invalid property name")},ir.regexp_eatUnicodePropertyName=function(E){var P=0;for(E.lastStringValue="";ea(P=E.current());)E.lastStringValue+=Hr(P),E.advance();return E.lastStringValue!==""};function ea(E){return Wn(E)||E===95}ir.regexp_eatUnicodePropertyValue=function(E){var P=0;for(E.lastStringValue="";Zn(P=E.current());)E.lastStringValue+=Hr(P),E.advance();return E.lastStringValue!==""};function Zn(E){return ea(E)||na(E)}ir.regexp_eatLoneUnicodePropertyNameOrValue=function(E){return this.regexp_eatUnicodePropertyValue(E)},ir.regexp_eatCharacterClass=function(E){if(E.eat(91)){if(E.eat(94),this.regexp_classRanges(E),E.eat(93))return!0;E.raise("Unterminated character class")}return!1},ir.regexp_classRanges=function(E){for(;this.regexp_eatClassAtom(E);){var P=E.lastIntValue;if(E.eat(45)&&this.regexp_eatClassAtom(E)){var G=E.lastIntValue;E.switchU&&(P===-1||G===-1)&&E.raise("Invalid character class"),P!==-1&&G!==-1&&P>G&&E.raise("Range out of order in character class")}}},ir.regexp_eatClassAtom=function(E){var P=E.pos;if(E.eat(92)){if(this.regexp_eatClassEscape(E))return!0;if(E.switchU){var G=E.current();(G===99||va(G))&&E.raise("Invalid class escape"),E.raise("Invalid escape")}E.pos=P}var D=E.current();return D!==93?(E.lastIntValue=D,E.advance(),!0):!1},ir.regexp_eatClassEscape=function(E){var P=E.pos;if(E.eat(98))return E.lastIntValue=8,!0;if(E.switchU&&E.eat(45))return E.lastIntValue=45,!0;if(!E.switchU&&E.eat(99)){if(this.regexp_eatClassControlLetter(E))return!0;E.pos=P}return this.regexp_eatCharacterClassEscape(E)||this.regexp_eatCharacterEscape(E)},ir.regexp_eatClassControlLetter=function(E){var P=E.current();return na(P)||P===95?(E.lastIntValue=P%32,E.advance(),!0):!1},ir.regexp_eatHexEscapeSequence=function(E){var P=E.pos;if(E.eat(120)){if(this.regexp_eatFixedHexDigits(E,2))return!0;E.switchU&&E.raise("Invalid escape"),E.pos=P}return!1},ir.regexp_eatDecimalDigits=function(E){var P=E.pos,G=0;for(E.lastIntValue=0;na(G=E.current());)E.lastIntValue=10*E.lastIntValue+(G-48),E.advance();return E.pos!==P};function na(E){return E>=48&&E<=57}ir.regexp_eatHexDigits=function(E){var P=E.pos,G=0;for(E.lastIntValue=0;Zt(G=E.current());)E.lastIntValue=16*E.lastIntValue+kt(G),E.advance();return E.pos!==P};function Zt(E){return E>=48&&E<=57||E>=65&&E<=70||E>=97&&E<=102}function kt(E){return E>=65&&E<=70?10+(E-65):E>=97&&E<=102?10+(E-97):E-48}ir.regexp_eatLegacyOctalEscapeSequence=function(E){if(this.regexp_eatOctalDigit(E)){var P=E.lastIntValue;if(this.regexp_eatOctalDigit(E)){var G=E.lastIntValue;P<=3&&this.regexp_eatOctalDigit(E)?E.lastIntValue=P*64+G*8+E.lastIntValue:E.lastIntValue=P*8+G}else E.lastIntValue=P;return!0}return!1},ir.regexp_eatOctalDigit=function(E){var P=E.current();return va(P)?(E.lastIntValue=P-48,E.advance(),!0):(E.lastIntValue=0,!1)};function va(E){return E>=48&&E<=55}ir.regexp_eatFixedHexDigits=function(E,P){var G=E.pos;E.lastIntValue=0;for(var D=0;D<P;++D){var oe=E.current();if(!Zt(oe))return E.pos=G,!1;E.lastIntValue=16*E.lastIntValue+kt(oe),E.advance()}return!0};var aa=function(P){this.type=P.type,this.value=P.value,this.start=P.start,this.end=P.end,P.options.locations&&(this.loc=new At(P,P.startLoc,P.endLoc)),P.options.ranges&&(this.range=[P.start,P.end])},Fi=Pt.prototype;Fi.next=function(E){!E&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new aa(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Fi.getToken=function(){return this.next(),new aa(this)},typeof Symbol!="undefined"&&(Fi[Symbol.iterator]=function(){var E=this;return{next:function(){var P=E.getToken();return{done:P.type===ie.eof,value:P}}}}),Fi.curContext=function(){return this.context[this.context.length-1]},Fi.nextToken=function(){var E=this.curContext();if((!E||!E.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(ie.eof);if(E.override)return E.override(this);this.readToken(this.fullCharCodeAtPos())},Fi.readToken=function(E){return tr(E,this.options.ecmaVersion>=6)||E===92?this.readWord():this.getTokenFromCode(E)},Fi.fullCharCodeAtPos=function(){var E=this.input.charCodeAt(this.pos);if(E<=55295||E>=57344)return E;var P=this.input.charCodeAt(this.pos+1);return(E<<10)+P-56613888},Fi.skipBlockComment=function(){var E=this.options.onComment&&this.curPosition(),P=this.pos,G=this.input.indexOf("*/",this.pos+=2);if(G===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=G+2,this.options.locations){Ot.lastIndex=P;for(var D;(D=Ot.exec(this.input))&&D.index<this.pos;)++this.curLine,this.lineStart=D.index+D[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(P+2,G),P,this.pos,E,this.curPosition())},Fi.skipLineComment=function(E){for(var P=this.pos,G=this.options.onComment&&this.curPosition(),D=this.input.charCodeAt(this.pos+=E);this.pos<this.input.length&&!yt(D);)D=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(P+E,this.pos),P,this.pos,G,this.curPosition())},Fi.skipSpace=function(){e:for(;this.pos<this.input.length;){var E=this.input.charCodeAt(this.pos);switch(E){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(E>8&&E<14||E>=5760&&Qt.test(String.fromCharCode(E)))++this.pos;else break e}}},Fi.finishToken=function(E,P){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var G=this.type;this.type=E,this.value=P,this.updateContext(G)},Fi.readToken_dot=function(){var E=this.input.charCodeAt(this.pos+1);if(E>=48&&E<=57)return this.readNumber(!0);var P=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&E===46&&P===46?(this.pos+=3,this.finishToken(ie.ellipsis)):(++this.pos,this.finishToken(ie.dot))},Fi.readToken_slash=function(){var E=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):E===61?this.finishOp(ie.assign,2):this.finishOp(ie.slash,1)},Fi.readToken_mult_modulo_exp=function(E){var P=this.input.charCodeAt(this.pos+1),G=1,D=E===42?ie.star:ie.modulo;return this.options.ecmaVersion>=7&&E===42&&P===42&&(++G,D=ie.starstar,P=this.input.charCodeAt(this.pos+2)),P===61?this.finishOp(ie.assign,G+1):this.finishOp(D,G)},Fi.readToken_pipe_amp=function(E){var P=this.input.charCodeAt(this.pos+1);if(P===E){if(this.options.ecmaVersion>=12){var G=this.input.charCodeAt(this.pos+2);if(G===61)return this.finishOp(ie.assign,3)}return this.finishOp(E===124?ie.logicalOR:ie.logicalAND,2)}return P===61?this.finishOp(ie.assign,2):this.finishOp(E===124?ie.bitwiseOR:ie.bitwiseAND,1)},Fi.readToken_caret=function(){var E=this.input.charCodeAt(this.pos+1);return E===61?this.finishOp(ie.assign,2):this.finishOp(ie.bitwiseXOR,1)},Fi.readToken_plus_min=function(E){var P=this.input.charCodeAt(this.pos+1);return P===E?P===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||_r.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(ie.incDec,2):P===61?this.finishOp(ie.assign,2):this.finishOp(ie.plusMin,1)},Fi.readToken_lt_gt=function(E){var P=this.input.charCodeAt(this.pos+1),G=1;return P===E?(G=E===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+G)===61?this.finishOp(ie.assign,G+1):this.finishOp(ie.bitShift,G)):P===33&&E===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(P===61&&(G=2),this.finishOp(ie.relational,G))},Fi.readToken_eq_excl=function(E){var P=this.input.charCodeAt(this.pos+1);return P===61?this.finishOp(ie.equality,this.input.charCodeAt(this.pos+2)===61?3:2):E===61&&P===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ie.arrow)):this.finishOp(E===61?ie.eq:ie.prefix,1)},Fi.readToken_question=function(){var E=this.options.ecmaVersion;if(E>=11){var P=this.input.charCodeAt(this.pos+1);if(P===46){var G=this.input.charCodeAt(this.pos+2);if(G<48||G>57)return this.finishOp(ie.questionDot,2)}if(P===63){if(E>=12){var D=this.input.charCodeAt(this.pos+2);if(D===61)return this.finishOp(ie.assign,3)}return this.finishOp(ie.coalesce,2)}}return this.finishOp(ie.question,1)},Fi.getTokenFromCode=function(E){switch(E){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ie.parenL);case 41:return++this.pos,this.finishToken(ie.parenR);case 59:return++this.pos,this.finishToken(ie.semi);case 44:return++this.pos,this.finishToken(ie.comma);case 91:return++this.pos,this.finishToken(ie.bracketL);case 93:return++this.pos,this.finishToken(ie.bracketR);case 123:return++this.pos,this.finishToken(ie.braceL);case 125:return++this.pos,this.finishToken(ie.braceR);case 58:return++this.pos,this.finishToken(ie.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ie.backQuote);case 48:var P=this.input.charCodeAt(this.pos+1);if(P===120||P===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(P===111||P===79)return this.readRadixNumber(8);if(P===98||P===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(E);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(E);case 124:case 38:return this.readToken_pipe_amp(E);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(E);case 60:case 62:return this.readToken_lt_gt(E);case 61:case 33:return this.readToken_eq_excl(E);case 63:return this.readToken_question();case 126:return this.finishOp(ie.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ba(E)+"'")},Fi.finishOp=function(E,P){var G=this.input.slice(this.pos,this.pos+P);return this.pos+=P,this.finishToken(E,G)},Fi.readRegexp=function(){for(var E,P,G=this.pos;;){this.pos>=this.input.length&&this.raise(G,"Unterminated regular expression");var D=this.input.charAt(this.pos);if(_r.test(D)&&this.raise(G,"Unterminated regular expression"),E)E=!1;else{if(D==="[")P=!0;else if(D==="]"&&P)P=!1;else if(D==="/"&&!P)break;E=D==="\\"}++this.pos}var oe=this.input.slice(G,this.pos);++this.pos;var Fe=this.pos,vt=this.readWord1();this.containsEsc&&this.unexpected(Fe);var Mt=this.regexpState||(this.regexpState=new pr(this));Mt.reset(G,oe,vt),this.validateRegExpFlags(Mt),this.validateRegExpPattern(Mt);var Dt=null;try{Dt=new RegExp(oe,vt)}catch(Nr){}return this.finishToken(ie.regexp,{pattern:oe,flags:vt,value:Dt})},Fi.readInt=function(E,P,G){for(var D=this.options.ecmaVersion>=12&&P===void 0,oe=G&&this.input.charCodeAt(this.pos)===48,Fe=this.pos,vt=0,Mt=0,Dt=0,Nr=P==null?Infinity:P;Dt<Nr;++Dt,++this.pos){var Xr=this.input.charCodeAt(this.pos),Qn=void 0;if(D&&Xr===95){oe&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Mt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Dt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Mt=Xr;continue}if(Xr>=97?Qn=Xr-97+10:Xr>=65?Qn=Xr-65+10:Xr>=48&&Xr<=57?Qn=Xr-48:Qn=Infinity,Qn>=E)break;Mt=Xr,vt=vt*E+Qn}return D&&Mt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Fe||P!=null&&this.pos-Fe!==P?null:vt};function Mi(E,P){return P?parseInt(E,8):parseFloat(E.replace(/_/g,""))}function go(E){return typeof BigInt!="function"?null:BigInt(E.replace(/_/g,""))}Fi.readRadixNumber=function(E){var P=this.pos;this.pos+=2;var G=this.readInt(E);return G==null&&this.raise(this.start+2,"Expected number in radix "+E),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(G=go(this.input.slice(P,this.pos)),++this.pos):tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ie.num,G)},Fi.readNumber=function(E){var P=this.pos;!E&&this.readInt(10,void 0,!0)===null&&this.raise(P,"Invalid number");var G=this.pos-P>=2&&this.input.charCodeAt(P)===48;G&&this.strict&&this.raise(P,"Invalid number");var D=this.input.charCodeAt(this.pos);if(!G&&!E&&this.options.ecmaVersion>=11&&D===110){var oe=go(this.input.slice(P,this.pos));return++this.pos,tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ie.num,oe)}G&&/[89]/.test(this.input.slice(P,this.pos))&&(G=!1),D===46&&!G&&(++this.pos,this.readInt(10),D=this.input.charCodeAt(this.pos)),(D===69||D===101)&&!G&&(D=this.input.charCodeAt(++this.pos),(D===43||D===45)&&++this.pos,this.readInt(10)===null&&this.raise(P,"Invalid number")),tr(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Fe=Mi(this.input.slice(P,this.pos),G);return this.finishToken(ie.num,Fe)},Fi.readCodePoint=function(){var E=this.input.charCodeAt(this.pos),P;if(E===123){this.options.ecmaVersion<6&&this.unexpected();var G=++this.pos;P=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,P>1114111&&this.invalidStringToken(G,"Code point out of bounds")}else P=this.readHexChar(4);return P};function Ba(E){return E<=65535?String.fromCharCode(E):(E-=65536,String.fromCharCode((E>>10)+55296,(E&1023)+56320))}Fi.readString=function(E){for(var P="",G=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var D=this.input.charCodeAt(this.pos);if(D===E)break;D===92?(P+=this.input.slice(G,this.pos),P+=this.readEscapedChar(!1),G=this.pos):(yt(D,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return P+=this.input.slice(G,this.pos++),this.finishToken(ie.string,P)};var Pr={};Fi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(E){if(E===Pr)this.readInvalidTemplateToken();else throw E}this.inTemplateElement=!1},Fi.invalidStringToken=function(E,P){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Pr;this.raise(E,P)},Fi.readTmplToken=function(){for(var E="",P=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var G=this.input.charCodeAt(this.pos);if(G===96||G===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===ie.template||this.type===ie.invalidTemplate)?G===36?(this.pos+=2,this.finishToken(ie.dollarBraceL)):(++this.pos,this.finishToken(ie.backQuote)):(E+=this.input.slice(P,this.pos),this.finishToken(ie.template,E));if(G===92)E+=this.input.slice(P,this.pos),E+=this.readEscapedChar(!0),P=this.pos;else if(yt(G)){switch(E+=this.input.slice(P,this.pos),++this.pos,G){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:E+=`
`;break;default:E+=String.fromCharCode(G);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),P=this.pos}else++this.pos}},Fi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(ie.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Fi.readEscapedChar=function(E){var P=this.input.charCodeAt(++this.pos);switch(++this.pos,P){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ba(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(E){var G=this.pos-1;return this.invalidStringToken(G,"Invalid escape sequence in template string"),null}default:if(P>=48&&P<=55){var D=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],oe=parseInt(D,8);return oe>255&&(D=D.slice(0,-1),oe=parseInt(D,8)),this.pos+=D.length-1,P=this.input.charCodeAt(this.pos),(D!=="0"||P===56||P===57)&&(this.strict||E)&&this.invalidStringToken(this.pos-1-D.length,E?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(oe)}return yt(P)?"":String.fromCharCode(P)}},Fi.readHexChar=function(E){var P=this.pos,G=this.readInt(16,E);return G===null&&this.invalidStringToken(P,"Bad character escape sequence"),G},Fi.readWord1=function(){this.containsEsc=!1;for(var E="",P=!0,G=this.pos,D=this.options.ecmaVersion>=6;this.pos<this.input.length;){var oe=this.fullCharCodeAtPos();if(qt(oe,D))this.pos+=oe<=65535?1:2;else if(oe===92){this.containsEsc=!0,E+=this.input.slice(G,this.pos);var Fe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var vt=this.readCodePoint();(P?tr:qt)(vt,D)||this.invalidStringToken(Fe,"Invalid Unicode escape"),E+=Ba(vt),G=this.pos}else break;P=!1}return E+this.input.slice(G,this.pos)},Fi.readWord=function(){var E=this.readWord1(),P=ie.name;return this.keywords.test(E)&&(P=jt[E]),this.finishToken(P,E)};var Or="7.4.1";Pt.acorn={Parser:Pt,version:Or,defaultOptions:ur,Position:ze,SourceLocation:At,getLineInfo:Ft,Node:zi,TokenType:Yt,tokTypes:ie,keywordTypes:jt,TokContext:ao,tokContexts:Ci,isIdentifierChar:qt,isIdentifierStart:tr,Token:aa,isNewLine:yt,lineBreak:_r,lineBreakG:Ot,nonASCIIwhitespace:Qt};function Et(E,P){return Pt.parse(E,P)}function ss(E,P,G){return Pt.parseExpressionAt(E,P,G)}function bt(E,P){return Pt.tokenizer(E,P)}function oo(E,P){E.prototype=Object.create(P.prototype),E.prototype.constructor=E,E.__proto__=P}function yu(E){var P=typeof Map=="function"?new Map:void 0;return yu=function(D){if(D===null||!ml(D))return D;if(typeof D!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(D))return P.get(D);P.set(D,oe)}function oe(){return Bi(D,arguments,Lo(this).constructor)}return oe.prototype=Object.create(D.prototype,{constructor:{value:oe,enumerable:!1,writable:!0,configurable:!0}}),Ra(oe,D)},yu(E)}function Qo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(E){return!1}}function Bi(E,P,G){return Qo()?Bi=Reflect.construct:Bi=function(oe,Fe,vt){var Mt=[null];Mt.push.apply(Mt,Fe);var Dt=Function.bind.apply(oe,Mt),Nr=new Dt;return vt&&Ra(Nr,vt.prototype),Nr},Bi.apply(null,arguments)}function ml(E){return Function.toString.call(E).indexOf("[native code]")!==-1}function Ra(E,P){return Ra=Object.setPrototypeOf||function(D,oe){return D.__proto__=oe,D},Ra(E,P)}function Lo(E){return Lo=Object.setPrototypeOf?Object.getPrototypeOf:function(G){return G.__proto__||Object.getPrototypeOf(G)},Lo(E)}var Do=function(E){oo(P,E);function P(){return E.apply(this,arguments)||this}return P}(yu(Error)),ba=function(E){oo(P,E);function P(){return E.apply(this,arguments)||this}return P}(yu(SyntaxError)),Ps=function(E){oo(P,E);function P(){return E.apply(this,arguments)||this}return P}(yu(ReferenceError)),Ls=function(E){oo(P,E);function P(){return E.apply(this,arguments)||this}return P}(yu(TypeError)),Ql=function(E){oo(P,E);function P(){return E.apply(this,arguments)||this}return P}(Do),fo=function(E){oo(P,E);function P(){return E.apply(this,arguments)||this}return P}(ba),ds=function(E){oo(P,E);function P(){return E.apply(this,arguments)||this}return P}(Ps),Va={UnknownError:[3001,"%0",Ql],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Ql],NodeTypeSyntaxError:[1001,"Unknown node type: %0",ds],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",ds],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",ds],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",ds],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",ds],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",ds],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",ds],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",ds],ParamTypeSyntaxError:[1009,"Unknown param type: %0",ds],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",ds],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ps],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ps],IsNotConstructor:[2003,"%0 is not a constructor",Ls]};function Bo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(E){return!1}}function vs(E,P,G){return Bo()?vs=Reflect.construct:vs=function(oe,Fe,vt){var Mt=[null];Mt.push.apply(Mt,Fe);var Dt=Function.bind.apply(oe,Mt),Nr=new Dt;return vt&&No(Nr,vt.prototype),Nr},vs.apply(null,arguments)}function No(E,P){return No=Object.setPrototypeOf||function(D,oe){return D.__proto__=oe,D},No(E,P)}var Qu="0.0.3";function Zu(E,P){Object.defineProperty(E,"name",{value:P,writable:!1,enumerable:!1,configurable:!0})}var Vo=Object.prototype.hasOwnProperty,me=Symbol("Break"),De=Symbol("Continue"),_t=Symbol("DefaultCase"),lr=Symbol("EmptyStatementReturn"),xn=Symbol("WithScopeName"),ti=Symbol("SuperScopeName"),ya=Symbol("RootScopeName"),jo=Symbol("GlobalScopeName");function Oa(E){return typeof E=="function"}var zo=function(){function E(G){this.interpreter=G}var P=E.prototype;return P.generator=function(){var D=this.interpreter;function oe(){return this.getCurrentScope()}function Fe(){return this.getGlobalScope()}function vt(){return this.getCurrentContext()}return{getOptions:D.getOptions.bind(D),getCurrentScope:oe.bind(D),getGlobalScope:Fe.bind(D),getCurrentContext:vt.bind(D),getExecStartTime:D.getExecStartTime.bind(D)}},E}();function So(E,P,G){if(G===void 0&&(G=!0),!(E instanceof zo))throw new Error("Illegal call");if(typeof P!="string")return P;if(!!P){var D=E.generator(),oe=D.getOptions(),Fe={timeout:oe.timeout,_initEnv:function(){G||this.setCurrentContext(D.getCurrentContext()),this.execStartTime=D.getExecStartTime(),this.execEndTime=this.execStartTime}},vt=G?D.getGlobalScope():D.getCurrentScope(),Mt=new As(vt,Fe);return Mt.evaluate(P)}}Object.defineProperty(So,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function so(E){if(!(E instanceof zo))throw new Error("Illegal call");for(var P=E.generator(),G=arguments.length,D=new Array(G>1?G-1:0),oe=1;oe<G;oe++)D[oe-1]=arguments[oe];var Fe=D.pop(),vt=new As(P.getGlobalScope(),P.getOptions()),Mt=`
		    (function anonymous(`+D.join(",")+`){
		        `+Fe+`
		    });
		    `;return vt.evaluate(Mt)}Object.defineProperty(so,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Rs=function(P){this.value=P},eu=function(P){this.value=P},su=function(P){this.value=P},_u=function(P,G,D){G===void 0&&(G=null),this.name=D,this.parent=G,this.data=P,this.labelStack=[]};function Vu(){}function xu(E,P){return E===void 0&&(E=null),new _u(Object.create(null),E,P)}function Ro(E){return Object.create(E)}var ha={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:So,Function:so};typeof JSON!="undefined"&&(ha.JSON=JSON),typeof Promise!="undefined"&&(ha.Promise=Promise),typeof Set!="undefined"&&(ha.Set=Set),typeof Map!="undefined"&&(ha.Map=Map),typeof Symbol!="undefined"&&(ha.Symbol=Symbol),typeof Proxy!="undefined"&&(ha.Proxy=Proxy),typeof WeakMap!="undefined"&&(ha.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ha.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ha.Reflect=Reflect);var As=function(){function E(G,D){G===void 0&&(G=E.global),D===void 0&&(D={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:D.ecmaVersion||E.ecmaVersion,timeout:D.timeout||0,rootContext:D.rootContext,globalContextInFunction:D.globalContextInFunction===void 0?E.globalContextInFunction:D.globalContextInFunction,_initEnv:D._initEnv},this.context=G||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var P=E.prototype;return P.initEnvironment=function(D){var oe;if(D instanceof _u)oe=D;else{var Fe=null,vt=this.createSuperScope(D);this.options.rootContext&&(Fe=new _u(Ro(this.options.rootContext),vt,ya)),oe=new _u(D,Fe||vt,jo)}this.globalScope=oe,this.currentScope=this.globalScope,this.globalContext=oe.data,this.currentContext=oe.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Mt=this.options._initEnv;Mt&&Mt.call(this)},P.getExecStartTime=function(){return this.execStartTime},P.getExecutionTime=function(){return this.execEndTime-this.execStartTime},P.setExecTimeout=function(D){D===void 0&&(D=0),this.options.timeout=D},P.getOptions=function(){return this.options},P.getGlobalScope=function(){return this.globalScope},P.getCurrentScope=function(){return this.currentScope},P.getCurrentContext=function(){return this.currentContext},P.isInterruptThrow=function(D){return D instanceof Ql||D instanceof ds||D instanceof fo},P.createSuperScope=function(D){var oe=Object.assign({},ha),Fe=Object.keys(oe);return Fe.forEach(function(vt){vt in D&&delete oe[vt]}),new _u(oe,null,ti)},P.setCurrentContext=function(D){this.currentContext=D},P.setCurrentScope=function(D){this.currentScope=D},P.evaluate=function(D){D===void 0&&(D="");var oe;if(!!D)return oe=Et(D,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||E.ecmaVersion}),this.evaluateNode(oe,D)},P.appendCode=function(D){return this.evaluate(D)},P.evaluateNode=function(D,oe){var Fe=this;oe===void 0&&(oe=""),this.value=void 0,this.source=oe,this.sourceList.push(oe),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var vt=this.getCurrentScope(),Mt=this.getCurrentContext(),Dt=vt.labelStack.concat([]),Nr=this.callStack.concat([]),Xr=function(){Fe.setCurrentScope(vt),Fe.setCurrentContext(Mt),vt.labelStack=Dt,Fe.callStack=Nr};try{var Qn=this.createClosure(D);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Qn()}catch(Ki){throw Ki}finally{Xr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},P.createErrorMessage=function(D,oe,Fe){var vt=D[1].replace("%0",String(oe));return Fe!==null&&(vt+=this.getNodePosition(Fe||this.lastExecNode)),vt},P.createError=function(D,oe){return new oe(D)},P.createThrowError=function(D,oe){return this.createError(D,oe)},P.createInternalThrowError=function(D,oe,Fe){return this.createError(this.createErrorMessage(D,oe,Fe),D[2])},P.checkTimeout=function(){if(!this.isRunning)return!1;var D=this.options.timeout||0,oe=Date.now();return oe-this.execStartTime>D},P.getNodePosition=function(D){if(D){var oe="";return D.loc?" ["+D.loc.start.line+":"+D.loc.start.column+"]"+oe:""}return""},P.createClosure=function(D){var oe=this,Fe;switch(D.type){case"BinaryExpression":Fe=this.binaryExpressionHandler(D);break;case"LogicalExpression":Fe=this.logicalExpressionHandler(D);break;case"UnaryExpression":Fe=this.unaryExpressionHandler(D);break;case"UpdateExpression":Fe=this.updateExpressionHandler(D);break;case"ObjectExpression":Fe=this.objectExpressionHandler(D);break;case"ArrayExpression":Fe=this.arrayExpressionHandler(D);break;case"CallExpression":Fe=this.callExpressionHandler(D);break;case"NewExpression":Fe=this.newExpressionHandler(D);break;case"MemberExpression":Fe=this.memberExpressionHandler(D);break;case"ThisExpression":Fe=this.thisExpressionHandler(D);break;case"SequenceExpression":Fe=this.sequenceExpressionHandler(D);break;case"Literal":Fe=this.literalHandler(D);break;case"Identifier":Fe=this.identifierHandler(D);break;case"AssignmentExpression":Fe=this.assignmentExpressionHandler(D);break;case"FunctionDeclaration":Fe=this.functionDeclarationHandler(D);break;case"VariableDeclaration":Fe=this.variableDeclarationHandler(D);break;case"BlockStatement":case"Program":Fe=this.programHandler(D);break;case"ExpressionStatement":Fe=this.expressionStatementHandler(D);break;case"EmptyStatement":Fe=this.emptyStatementHandler(D);break;case"ReturnStatement":Fe=this.returnStatementHandler(D);break;case"FunctionExpression":Fe=this.functionExpressionHandler(D);break;case"IfStatement":Fe=this.ifStatementHandler(D);break;case"ConditionalExpression":Fe=this.conditionalExpressionHandler(D);break;case"ForStatement":Fe=this.forStatementHandler(D);break;case"WhileStatement":Fe=this.whileStatementHandler(D);break;case"DoWhileStatement":Fe=this.doWhileStatementHandler(D);break;case"ForInStatement":Fe=this.forInStatementHandler(D);break;case"WithStatement":Fe=this.withStatementHandler(D);break;case"ThrowStatement":Fe=this.throwStatementHandler(D);break;case"TryStatement":Fe=this.tryStatementHandler(D);break;case"ContinueStatement":Fe=this.continueStatementHandler(D);break;case"BreakStatement":Fe=this.breakStatementHandler(D);break;case"SwitchStatement":Fe=this.switchStatementHandler(D);break;case"LabeledStatement":Fe=this.labeledStatementHandler(D);break;case"DebuggerStatement":Fe=this.debuggerStatementHandler(D);break;default:throw this.createInternalThrowError(Va.NodeTypeSyntaxError,D.type,D)}return function(){var vt=oe.options.timeout;if(vt&&vt>0&&oe.checkTimeout())throw oe.createInternalThrowError(Va.ExecutionTimeOutError,vt,null);return oe.lastExecNode=D,Fe.apply(void 0,arguments)}},P.binaryExpressionHandler=function(D){var oe=this,Fe=this.createClosure(D.left),vt=this.createClosure(D.right);return function(){var Mt=Fe(),Dt=vt();switch(D.operator){case"==":return Mt==Dt;case"!=":return Mt!=Dt;case"===":return Mt===Dt;case"!==":return Mt!==Dt;case"<":return Mt<Dt;case"<=":return Mt<=Dt;case">":return Mt>Dt;case">=":return Mt>=Dt;case"<<":return Mt<<Dt;case">>":return Mt>>Dt;case">>>":return Mt>>>Dt;case"+":return Mt+Dt;case"-":return Mt-Dt;case"*":return Mt*Dt;case"**":return Math.pow(Mt,Dt);case"/":return Mt/Dt;case"%":return Mt%Dt;case"|":return Mt|Dt;case"^":return Mt^Dt;case"&":return Mt&Dt;case"in":return Mt in Dt;case"instanceof":return Mt instanceof Dt;default:throw oe.createInternalThrowError(Va.BinaryOperatorSyntaxError,D.operator,D)}}},P.logicalExpressionHandler=function(D){var oe=this,Fe=this.createClosure(D.left),vt=this.createClosure(D.right);return function(){switch(D.operator){case"||":return Fe()||vt();case"&&":return Fe()&&vt();default:throw oe.createInternalThrowError(Va.LogicalOperatorSyntaxError,D.operator,D)}}},P.unaryExpressionHandler=function(D){var oe=this;switch(D.operator){case"delete":var Fe=this.createObjectGetter(D.argument),vt=this.createNameGetter(D.argument);return function(){var Xr=Fe(),Qn=vt();return delete Xr[Qn]};default:var Mt;if(D.operator==="typeof"&&D.argument.type==="Identifier"){var Dt=this.createObjectGetter(D.argument),Nr=this.createNameGetter(D.argument);Mt=function(){return Dt()[Nr()]}}else Mt=this.createClosure(D.argument);return function(){var Xr=Mt();switch(D.operator){case"-":return-Xr;case"+":return+Xr;case"!":return!Xr;case"~":return~Xr;case"void":return;case"typeof":return typeof Xr;default:throw oe.createInternalThrowError(Va.UnaryOperatorSyntaxError,D.operator,D)}}}},P.updateExpressionHandler=function(D){var oe=this,Fe=this.createObjectGetter(D.argument),vt=this.createNameGetter(D.argument);return function(){var Mt=Fe(),Dt=vt();switch(oe.assertVariable(Mt,Dt,D),D.operator){case"++":return D.prefix?++Mt[Dt]:Mt[Dt]++;case"--":return D.prefix?--Mt[Dt]:Mt[Dt]--;default:throw oe.createInternalThrowError(Va.UpdateOperatorSyntaxError,D.operator,D)}}},P.objectExpressionHandler=function(D){var oe=this,Fe=[];function vt(Dt){return Dt.type==="Identifier"?Dt.name:Dt.type==="Literal"?Dt.value:this.throwError(Va.ObjectStructureSyntaxError,Dt.type,Dt)}var Mt=Object.create(null);return D.properties.forEach(function(Dt){var Nr=Dt.kind,Xr=vt(Dt.key);(!Mt[Xr]||Nr==="init")&&(Mt[Xr]={}),Mt[Xr][Nr]=oe.createClosure(Dt.value),Fe.push({key:Xr,property:Dt})}),function(){for(var Dt={},Nr=Fe.length,Xr=0;Xr<Nr;Xr++){var Qn=Fe[Xr],Ki=Qn.key,ji=Mt[Ki],pa=ji.init?ji.init():void 0,Ka=ji.get?ji.get():function(){},yo=ji.set?ji.set():function(Yc){};if("set"in ji||"get"in ji){var wa={configurable:!0,enumerable:!0,get:Ka,set:yo};Object.defineProperty(Dt,Ki,wa)}else{var Xs=Qn.property,Bl=Xs.kind;Xs.key.type==="Identifier"&&Xs.value.type==="FunctionExpression"&&Bl==="init"&&!Xs.value.id&&Zu(pa,Xs.key.name),Dt[Ki]=pa}}return Dt}},P.arrayExpressionHandler=function(D){var oe=this,Fe=D.elements.map(function(vt){return vt&&oe.createClosure(vt)});return function(){for(var vt=Fe.length,Mt=Array(vt),Dt=0;Dt<vt;Dt++){var Nr=Fe[Dt];Nr&&(Mt[Dt]=Nr())}return Mt}},P.safeObjectGet=function(D,oe,Fe){return D[oe]},P.createCallFunctionGetter=function(D){var oe=this;switch(D.type){case"MemberExpression":var Fe=this.createClosure(D.object),vt=this.createMemberKeyGetter(D),Mt=this.source;return function(){var Nr=Fe(),Xr=vt(),Qn=oe.safeObjectGet(Nr,Xr,D);if(!Qn||!Oa(Qn)){var Ki=Mt.slice(D.start,D.end);throw oe.createInternalThrowError(Va.FunctionUndefinedReferenceError,Ki,D)}return Qn.__IS_EVAL_FUNC?function(ji){return Qn(new zo(oe),ji,!0)}:Qn.__IS_FUNCTION_FUNC?function(){for(var ji=arguments.length,pa=new Array(ji),Ka=0;Ka<ji;Ka++)pa[Ka]=arguments[Ka];return Qn.apply(void 0,[new zo(oe)].concat(pa))}:Qn.bind(Nr)};default:var Dt=this.createClosure(D);return function(){var Nr="";D.type==="Identifier"&&(Nr=D.name);var Xr=Dt();if(!Xr||!Oa(Xr))throw oe.createInternalThrowError(Va.FunctionUndefinedReferenceError,Nr,D);if(D.type==="Identifier"&&Xr.__IS_EVAL_FUNC&&Nr==="eval")return function(ji){var pa=oe.getScopeFromName(Nr,oe.getCurrentScope()),Ka=pa.name===ti||pa.name===jo||pa.name===ya;return Xr(new zo(oe),ji,!Ka)};if(Xr.__IS_EVAL_FUNC)return function(ji){return Xr(new zo(oe),ji,!0)};if(Xr.__IS_FUNCTION_FUNC)return function(){for(var ji=arguments.length,pa=new Array(ji),Ka=0;Ka<ji;Ka++)pa[Ka]=arguments[Ka];return Xr.apply(void 0,[new zo(oe)].concat(pa))};var Qn=oe.options.globalContextInFunction;if(D.type==="Identifier"){var Ki=oe.getIdentifierScope(D);Ki.name===xn&&(Qn=Ki.data)}return Xr.bind(Qn)}}},P.callExpressionHandler=function(D){var oe=this,Fe=this.createCallFunctionGetter(D.callee),vt=D.arguments.map(function(Mt){return oe.createClosure(Mt)});return function(){return Fe().apply(void 0,vt.map(function(Mt){return Mt()}))}},P.functionExpressionHandler=function(D){var oe=this,Fe=this,vt=this.source,Mt=this.collectDeclVars,Dt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Nr=D.id?D.id.name:"",Xr=D.params.length,Qn=D.params.map(function(Ka){return oe.createParamNameGetter(Ka)}),Ki=this.createClosure(D.body),ji=this.collectDeclVars,pa=this.collectDeclFuncs;return this.collectDeclVars=Mt,this.collectDeclFuncs=Dt,function(){var Ka=Fe.getCurrentScope(),yo=function wa(){for(var Xs=arguments.length,Bl=new Array(Xs),Yc=0;Yc<Xs;Yc++)Bl[Yc]=arguments[Yc];Fe.callStack.push(""+Nr);var qc=Fe.getCurrentScope(),wc=xu(Ka,"FunctionScope("+Nr+")");Fe.setCurrentScope(wc),Fe.addDeclarationsToScope(ji,pa,wc),Nr&&(wc.data[Nr]=wa),wc.data.arguments=arguments,Qn.forEach(function(Nl,_l){wc.data[Nl()]=Bl[_l]});var Tc=Fe.getCurrentContext();Fe.setCurrentContext(this);var Mu=Ki();if(Fe.setCurrentContext(Tc),Fe.setCurrentScope(qc),Fe.callStack.pop(),Mu instanceof Rs)return Mu.value};return Zu(yo,Nr),Object.defineProperty(yo,"length",{value:Xr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(yo,"toString",{value:function(){return vt.slice(D.start,D.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(yo,"valueOf",{value:function(){return vt.slice(D.start,D.end)},writable:!0,configurable:!0,enumerable:!1}),yo}},P.newExpressionHandler=function(D){var oe=this,Fe=this.source,vt=this.createClosure(D.callee),Mt=D.arguments.map(function(Dt){return oe.createClosure(Dt)});return function(){var Dt=vt();if(!Oa(Dt)||Dt.__IS_EVAL_FUNC){var Nr=D.callee,Xr=Fe.slice(Nr.start,Nr.end);throw oe.createInternalThrowError(Va.IsNotConstructor,Xr,D)}return Dt.__IS_FUNCTION_FUNC?Dt.apply(void 0,[new zo(oe)].concat(Mt.map(function(Qn){return Qn()}))):vs(Dt,Mt.map(function(Qn){return Qn()}))}},P.memberExpressionHandler=function(D){var oe=this.createClosure(D.object),Fe=this.createMemberKeyGetter(D);return function(){var vt=oe(),Mt=Fe();return vt[Mt]}},P.thisExpressionHandler=function(D){var oe=this;return function(){return oe.getCurrentContext()}},P.sequenceExpressionHandler=function(D){var oe=this,Fe=D.expressions.map(function(vt){return oe.createClosure(vt)});return function(){for(var vt,Mt=Fe.length,Dt=0;Dt<Mt;Dt++){var Nr=Fe[Dt];vt=Nr()}return vt}},P.literalHandler=function(D){return function(){return D.regex?new RegExp(D.regex.pattern,D.regex.flags):D.value}},P.identifierHandler=function(D){var oe=this;return function(){var Fe=oe.getCurrentScope(),vt=oe.getScopeDataFromName(D.name,Fe);return oe.assertVariable(vt,D.name,D),vt[D.name]}},P.getIdentifierScope=function(D){var oe=this.getCurrentScope(),Fe=this.getScopeFromName(D.name,oe);return Fe},P.assignmentExpressionHandler=function(D){var oe=this;D.left.type==="Identifier"&&D.right.type==="FunctionExpression"&&!D.right.id&&(D.right.id={type:"Identifier",name:D.left.name});var Fe=this.createObjectGetter(D.left),vt=this.createNameGetter(D.left),Mt=this.createClosure(D.right);return function(){var Dt=Fe(),Nr=vt(),Xr=Mt();switch(D.operator!=="="&&oe.assertVariable(Dt,Nr,D),D.operator){case"=":return Dt[Nr]=Xr;case"+=":return Dt[Nr]+=Xr;case"-=":return Dt[Nr]-=Xr;case"*=":return Dt[Nr]*=Xr;case"**=":return Dt[Nr]=Math.pow(Dt[Nr],Xr);case"/=":return Dt[Nr]/=Xr;case"%=":return Dt[Nr]%=Xr;case"<<=":return Dt[Nr]<<=Xr;case">>=":return Dt[Nr]>>=Xr;case">>>=":return Dt[Nr]>>>=Xr;case"&=":return Dt[Nr]&=Xr;case"^=":return Dt[Nr]^=Xr;case"|=":return Dt[Nr]|=Xr;default:throw oe.createInternalThrowError(Va.AssignmentExpressionSyntaxError,D.type,D)}}},P.functionDeclarationHandler=function(D){if(D.id){var oe=this.functionExpressionHandler(D);Object.defineProperty(oe,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(D.id.name,oe)}return function(){return lr}},P.getVariableName=function(D){if(D.type==="Identifier")return D.name;throw this.createInternalThrowError(Va.VariableTypeSyntaxError,D.type,D)},P.variableDeclarationHandler=function(D){for(var oe=this,Fe,vt=[],Mt=0;Mt<D.declarations.length;Mt++){var Dt=D.declarations[Mt];this.varDeclaration(this.getVariableName(Dt.id)),Dt.init&&vt.push({type:"AssignmentExpression",operator:"=",left:Dt.id,right:Dt.init})}return vt.length&&(Fe=this.createClosure({type:"BlockStatement",body:vt})),function(){if(Fe){var Nr=oe.isVarDeclMode;oe.isVarDeclMode=!0,Fe(),oe.isVarDeclMode=Nr}return lr}},P.assertVariable=function(D,oe,Fe){if(D===this.globalScope.data&&!(oe in D))throw this.createInternalThrowError(Va.VariableUndefinedReferenceError,oe,Fe)},P.programHandler=function(D){var oe=this,Fe=D.body.map(function(vt){return oe.createClosure(vt)});return function(){for(var vt=lr,Mt=0;Mt<Fe.length;Mt++){var Dt=Fe[Mt],Nr=oe.setValue(Dt());if(Nr!==lr&&(vt=Nr,vt instanceof Rs||vt instanceof eu||vt instanceof su||vt===me||vt===De))break}return vt}},P.expressionStatementHandler=function(D){return this.createClosure(D.expression)},P.emptyStatementHandler=function(D){return function(){return lr}},P.returnStatementHandler=function(D){var oe=D.argument?this.createClosure(D.argument):Vu;return function(){return new Rs(oe())}},P.ifStatementHandler=function(D){var oe=this.createClosure(D.test),Fe=this.createClosure(D.consequent),vt=D.alternate?this.createClosure(D.alternate):function(){return lr};return function(){return oe()?Fe():vt()}},P.conditionalExpressionHandler=function(D){return this.ifStatementHandler(D)},P.forStatementHandler=function(D){var oe=this,Fe=Vu,vt=D.test?this.createClosure(D.test):function(){return!0},Mt=Vu,Dt=this.createClosure(D.body);return D.type==="ForStatement"&&(Fe=D.init?this.createClosure(D.init):Fe,Mt=D.update?this.createClosure(D.update):Vu),function(Nr){var Xr,Qn=lr,Ki=D.type==="DoWhileStatement";for(Nr&&Nr.type==="LabeledStatement"&&(Xr=Nr.label.name),Fe();Ki||vt();Mt()){Ki=!1;var ji=oe.setValue(Dt());if(!(ji===lr||ji===De)){if(ji===me)break;if(Qn=ji,Qn instanceof su&&Qn.value===Xr){Qn=lr;continue}if(Qn instanceof Rs||Qn instanceof eu||Qn instanceof su)break}}return Qn}},P.whileStatementHandler=function(D){return this.forStatementHandler(D)},P.doWhileStatementHandler=function(D){return this.forStatementHandler(D)},P.forInStatementHandler=function(D){var oe=this,Fe=D.left,vt=this.createClosure(D.right),Mt=this.createClosure(D.body);return D.left.type==="VariableDeclaration"&&(this.createClosure(D.left)(),Fe=D.left.declarations[0].id),function(Dt){var Nr,Xr=lr,Qn;Dt&&Dt.type==="LabeledStatement"&&(Nr=Dt.label.name);var Ki=vt();for(Qn in Ki){oe.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Fe,right:{type:"Literal",value:Qn}})();var ji=oe.setValue(Mt());if(!(ji===lr||ji===De)){if(ji===me)break;if(Xr=ji,Xr instanceof su&&Xr.value===Nr){Xr=lr;continue}if(Xr instanceof Rs||Xr instanceof eu||Xr instanceof su)break}}return Xr}},P.withStatementHandler=function(D){var oe=this,Fe=this.createClosure(D.object),vt=this.createClosure(D.body);return function(){var Mt=Fe(),Dt=oe.getCurrentScope(),Nr=new _u(Mt,Dt,xn);oe.setCurrentScope(Nr);var Xr=oe.setValue(vt());return oe.setCurrentScope(Dt),Xr}},P.throwStatementHandler=function(D){var oe=this,Fe=this.createClosure(D.argument);return function(){throw oe.setValue(void 0),Fe()}},P.tryStatementHandler=function(D){var oe=this,Fe=this.createClosure(D.block),vt=D.handler?this.catchClauseHandler(D.handler):null,Mt=D.finalizer?this.createClosure(D.finalizer):null;return function(){var Dt=oe.getCurrentScope(),Nr=oe.getCurrentContext(),Xr=Dt.labelStack.concat([]),Qn=oe.callStack.concat([]),Ki=lr,ji,pa,Ka=function(){oe.setCurrentScope(Dt),oe.setCurrentContext(Nr),Dt.labelStack=Xr,oe.callStack=Qn};try{Ki=oe.setValue(Fe()),Ki instanceof Rs&&(ji=Ki)}catch(yo){if(Ka(),oe.isInterruptThrow(yo))throw yo;if(vt)try{Ki=oe.setValue(vt(yo)),Ki instanceof Rs&&(ji=Ki)}catch(wa){if(Ka(),oe.isInterruptThrow(wa))throw wa;pa=wa}}if(Mt)try{Ki=Mt(),Ki instanceof Rs&&(ji=Ki)}catch(yo){if(Ka(),oe.isInterruptThrow(yo))throw yo;pa=yo}if(pa)throw pa;return ji||Ki}},P.catchClauseHandler=function(D){var oe=this,Fe=this.createParamNameGetter(D.param),vt=this.createClosure(D.body);return function(Mt){var Dt,Nr=oe.getCurrentScope(),Xr=Nr.data,Qn=Fe(),Ki=Vo.call(Xr,Qn),ji=Xr[Qn];return Xr[Qn]=Mt,Dt=vt(),Ki?Xr[Qn]=ji:delete Xr[Qn],Dt}},P.continueStatementHandler=function(D){return function(){return D.label?new su(D.label.name):De}},P.breakStatementHandler=function(D){return function(){return D.label?new eu(D.label.name):me}},P.switchStatementHandler=function(D){var oe=this,Fe=this.createClosure(D.discriminant),vt=D.cases.map(function(Mt){return oe.switchCaseHandler(Mt)});return function(){for(var Mt=Fe(),Dt=!1,Nr,Xr,Qn,Ki=0;Ki<vt.length;Ki++){var ji=vt[Ki](),pa=ji.testClosure();if(pa===_t){Qn=ji;continue}if(Dt||pa===Mt){if(Dt=!0,Xr=oe.setValue(ji.bodyClosure()),Xr===lr)continue;if(Xr===me||(Nr=Xr,Nr instanceof Rs||Nr instanceof eu||Nr instanceof su||Nr===De))break}}if(!Dt&&Qn){Xr=oe.setValue(Qn.bodyClosure());var Ka=Xr===lr||Xr===me||Xr===De;Ka||(Nr=Xr)}return Nr}},P.switchCaseHandler=function(D){var oe=D.test?this.createClosure(D.test):function(){return _t},Fe=this.createClosure({type:"BlockStatement",body:D.consequent});return function(){return{testClosure:oe,bodyClosure:Fe}}},P.labeledStatementHandler=function(D){var oe=this,Fe=D.label.name,vt=this.createClosure(D.body);return function(){var Mt,Dt=oe.getCurrentScope();return Dt.labelStack.push(Fe),Mt=vt(D),Mt instanceof eu&&Mt.value===Fe&&(Mt=lr),Dt.labelStack.pop(),Mt}},P.debuggerStatementHandler=function(D){return function(){debugger;return lr}},P.createParamNameGetter=function(D){if(D.type==="Identifier")return function(){return D.name};throw this.createInternalThrowError(Va.ParamTypeSyntaxError,D.type,D)},P.createObjectKeyGetter=function(D){var oe;return D.type==="Identifier"?oe=function(){return D.name}:oe=this.createClosure(D),function(){return oe()}},P.createMemberKeyGetter=function(D){return D.computed?this.createClosure(D.property):this.createObjectKeyGetter(D.property)},P.createObjectGetter=function(D){var oe=this;switch(D.type){case"Identifier":return function(){return oe.getScopeDataFromName(D.name,oe.getCurrentScope())};case"MemberExpression":return this.createClosure(D.object);default:throw this.createInternalThrowError(Va.AssignmentTypeSyntaxError,D.type,D)}},P.createNameGetter=function(D){switch(D.type){case"Identifier":return function(){return D.name};case"MemberExpression":return this.createMemberKeyGetter(D);default:throw this.createInternalThrowError(Va.AssignmentTypeSyntaxError,D.type,D)}},P.varDeclaration=function(D){var oe=this.collectDeclVars;oe[D]=void 0},P.funcDeclaration=function(D,oe){var Fe=this.collectDeclFuncs;Fe[D]=oe},P.addDeclarationsToScope=function(D,oe,Fe){var vt=Fe.data;for(var Mt in oe){var Dt=oe[Mt];vt[Mt]=Dt&&Dt()}for(var Nr in D)Nr in vt||(vt[Nr]=void 0)},P.getScopeValue=function(D,oe){var Fe=this.getScopeFromName(D,oe);return Fe.data[D]},P.getScopeDataFromName=function(D,oe){return this.getScopeFromName(D,oe).data},P.getScopeFromName=function(D,oe){var Fe=oe;do if(D in Fe.data)return Fe;while(Fe=Fe.parent);return this.globalScope},P.setValue=function(D){var oe=this.callStack.length;return this.isVarDeclMode||oe||D===lr||D===me||D===De||D instanceof eu||D instanceof su||(this.value=D instanceof Rs?D.value:D),D},P.getValue=function(){return this.value},E}();As.version=Qu,As.eval=So,As.Function=so,As.ecmaVersion=5,As.globalContextInFunction=void 0,As.global=Object.create(null);function Sh(E){return E===void 0&&(E=Object.create(null)),E}function Ju(E,P,G){P===void 0&&(P=[]),G===void 0&&(G={});var D=G.parsingContext,oe=G.timeout===void 0?0:G.timeout,Fe=`
    (function anonymous(`+P.join(",")+`){
         `+E+`
    });
    `,vt=new As(D,{ecmaVersion:G.ecmaVersion,timeout:oe,rootContext:G.rootContext,globalContextInFunction:G.globalContextInFunction});return vt.evaluate(Fe)}function pf(E,P,G){var D=new As(P,G);return D.evaluate(E)}var Wf=pf,gl=function(){function E(G){this._code=G}var P=E.prototype;return P.runInContext=function(D){return pf(this._code,D)},P.runInNewContext=function(D){return pf(this._code,D)},E}(),Ac=function(E,P,G){return pf(E,P,G)};function yl(){for(var E=arguments.length,P=new Array(E),G=0;G<E;G++)P[G]=arguments[G];var D=P.pop();return Ju(D||"",P)}var df=Ac},20396:function(ci,Ae,de){var He;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ge,y,Ne,Q){"use strict";var Pe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ve=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),lt=Pe||ve,we=["","webkit","Moz","MS","ms","o"],We=lt?"":y.createElement("div"),St="function",Rt=Math.round,tr=Math.abs,qt=Date.now;function Yt(me,De,_t){return setTimeout(Ot(me,_t),De)}function Sr(me,De,_t){return Array.isArray(me)?(fr(me,_t[De],_t),!0):!1}function fr(me,De,_t){var lr;if(!!me)if(me.forEach)me.forEach(De,_t);else if(me.length!==Q)for(lr=0;lr<me.length;)De.call(_t,me[lr],lr,me),lr++;else for(lr in me)me.hasOwnProperty(lr)&&De.call(_t,me[lr],lr,me)}function It(me,De,_t){var lr="DEPRECATED METHOD: "+De+`
`+_t+` AT 
`;return function(){var xn=new Error("get-stack-trace"),ti=xn&&xn.stack?xn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ya=ge.console&&(ge.console.warn||ge.console.log);return ya&&ya.call(ge.console,lr,ti),me.apply(this,arguments)}}var jt;typeof Object.assign!="function"?jt=function(De){if(De===Q||De===null)throw new TypeError("Cannot convert undefined or null to object");for(var _t=Object(De),lr=1;lr<arguments.length;lr++){var xn=arguments[lr];if(xn!==Q&&xn!==null)for(var ti in xn)xn.hasOwnProperty(ti)&&(_t[ti]=xn[ti])}return _t}:jt=Object.assign;var Rr=It(function(De,_t,lr){for(var xn=Object.keys(_t),ti=0;ti<xn.length;)(!lr||lr&&De[xn[ti]]===Q)&&(De[xn[ti]]=_t[xn[ti]]),ti++;return De},"extend","Use `assign`."),ie=It(function(De,_t){return Rr(De,_t,!0)},"merge","Use `assign`.");function _r(me,De,_t){var lr=De.prototype,xn;xn=me.prototype=Object.create(lr),xn.constructor=me,xn._super=lr,_t&&jt(xn,_t)}function Ot(me,De){return function(){return me.apply(De,arguments)}}function yt(me,De){return typeof me==St?me.apply(De&&De[0]||Q,De):me}function Qt(me,De){return me===Q?De:me}function Ue(me,De,_t){fr(rt(De),function(lr){me.addEventListener(lr,_t,!1)})}function Ar(me,De,_t){fr(rt(De),function(lr){me.removeEventListener(lr,_t,!1)})}function an(me,De){for(;me;){if(me==De)return!0;me=me.parentNode}return!1}function fe(me,De){return me.indexOf(De)>-1}function rt(me){return me.trim().split(/\s+/g)}function X(me,De,_t){if(me.indexOf&&!_t)return me.indexOf(De);for(var lr=0;lr<me.length;){if(_t&&me[lr][_t]==De||!_t&&me[lr]===De)return lr;lr++}return-1}function ae(me){return Array.prototype.slice.call(me,0)}function ze(me,De,_t){for(var lr=[],xn=[],ti=0;ti<me.length;){var ya=De?me[ti][De]:me[ti];X(xn,ya)<0&&lr.push(me[ti]),xn[ti]=ya,ti++}return _t&&(De?lr=lr.sort(function(Oa,zo){return Oa[De]>zo[De]}):lr=lr.sort()),lr}function At(me,De){for(var _t,lr,xn=De[0].toUpperCase()+De.slice(1),ti=0;ti<we.length;){if(_t=we[ti],lr=_t?_t+xn:De,lr in me)return lr;ti++}return Q}var Ft=1;function ur(){return Ft++}function Tt(me){var De=me.ownerDocument||me;return De.defaultView||De.parentWindow||ge}var Br=/mobile|tablet|ip(ad|hone|od)|android/i,Bn="ontouchstart"in ge,Sn=At(ge,"PointerEvent")!==Q,Li=Bn&&Br.test(navigator.userAgent),gi="touch",on="pen",Xa="mouse",ra="kinect",Vi=25,ga=1,fi=2,$i=4,hi=8,yi=1,os=2,mo=4,Ya=8,Pt=16,xe=os|mo,ce=Ya|Pt,Te=xe|ce,j=["x","y"],st=["clientX","clientY"];function ar(me,De){var _t=this;this.manager=me,this.callback=De,this.element=me.element,this.target=me.options.inputTarget,this.domHandler=function(lr){yt(me.options.enable,[me])&&_t.handler(lr)},this.init()}ar.prototype={handler:function(){},init:function(){this.evEl&&Ue(this.element,this.evEl,this.domHandler),this.evTarget&&Ue(this.target,this.evTarget,this.domHandler),this.evWin&&Ue(Tt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ar(this.element,this.evEl,this.domHandler),this.evTarget&&Ar(this.target,this.evTarget,this.domHandler),this.evWin&&Ar(Tt(this.element),this.evWin,this.domHandler)}};function Jr(me){var De,_t=me.options.inputClass;return _t?De=_t:Sn?De=Ye:Li?De=pr:Bn?De=rr:De=da,new De(me,tt)}function tt(me,De,_t){var lr=_t.pointers.length,xn=_t.changedPointers.length,ti=De&ga&&lr-xn==0,ya=De&($i|hi)&&lr-xn==0;_t.isFirst=!!ti,_t.isFinal=!!ya,ti&&(me.session={}),_t.eventType=De,Ut(me,_t),me.emit("hammer.input",_t),me.recognize(_t),me.session.prevInput=_t}function Ut(me,De){var _t=me.session,lr=De.pointers,xn=lr.length;_t.firstInput||(_t.firstInput=Lr(De)),xn>1&&!_t.firstMultiple?_t.firstMultiple=Lr(De):xn===1&&(_t.firstMultiple=!1);var ti=_t.firstInput,ya=_t.firstMultiple,jo=ya?ya.center:ti.center,Oa=De.center=vn(lr);De.timeStamp=qt(),De.deltaTime=De.timeStamp-ti.timeStamp,De.angle=Oi(jo,Oa),De.distance=An(jo,Oa),xr(_t,De),De.offsetDirection=ni(De.deltaX,De.deltaY);var zo=vi(De.deltaTime,De.deltaX,De.deltaY);De.overallVelocityX=zo.x,De.overallVelocityY=zo.y,De.overallVelocity=tr(zo.x)>tr(zo.y)?zo.x:zo.y,De.scale=ya?Pa(ya.pointers,lr):1,De.rotation=ya?zi(ya.pointers,lr):0,De.maxPointers=_t.prevInput?De.pointers.length>_t.prevInput.maxPointers?De.pointers.length:_t.prevInput.maxPointers:De.pointers.length,Cr(_t,De);var So=me.element;an(De.srcEvent.target,So)&&(So=De.srcEvent.target),De.target=So}function xr(me,De){var _t=De.center,lr=me.offsetDelta||{},xn=me.prevDelta||{},ti=me.prevInput||{};(De.eventType===ga||ti.eventType===$i)&&(xn=me.prevDelta={x:ti.deltaX||0,y:ti.deltaY||0},lr=me.offsetDelta={x:_t.x,y:_t.y}),De.deltaX=xn.x+(_t.x-lr.x),De.deltaY=xn.y+(_t.y-lr.y)}function Cr(me,De){var _t=me.lastInterval||De,lr=De.timeStamp-_t.timeStamp,xn,ti,ya,jo;if(De.eventType!=hi&&(lr>Vi||_t.velocity===Q)){var Oa=De.deltaX-_t.deltaX,zo=De.deltaY-_t.deltaY,So=vi(lr,Oa,zo);ti=So.x,ya=So.y,xn=tr(So.x)>tr(So.y)?So.x:So.y,jo=ni(Oa,zo),me.lastInterval=De}else xn=_t.velocity,ti=_t.velocityX,ya=_t.velocityY,jo=_t.direction;De.velocity=xn,De.velocityX=ti,De.velocityY=ya,De.direction=jo}function Lr(me){for(var De=[],_t=0;_t<me.pointers.length;)De[_t]={clientX:Rt(me.pointers[_t].clientX),clientY:Rt(me.pointers[_t].clientY)},_t++;return{timeStamp:qt(),pointers:De,center:vn(De),deltaX:me.deltaX,deltaY:me.deltaY}}function vn(me){var De=me.length;if(De===1)return{x:Rt(me[0].clientX),y:Rt(me[0].clientY)};for(var _t=0,lr=0,xn=0;xn<De;)_t+=me[xn].clientX,lr+=me[xn].clientY,xn++;return{x:Rt(_t/De),y:Rt(lr/De)}}function vi(me,De,_t){return{x:De/me||0,y:_t/me||0}}function ni(me,De){return me===De?yi:tr(me)>=tr(De)?me<0?os:mo:De<0?Ya:Pt}function An(me,De,_t){_t||(_t=j);var lr=De[_t[0]]-me[_t[0]],xn=De[_t[1]]-me[_t[1]];return Math.sqrt(lr*lr+xn*xn)}function Oi(me,De,_t){_t||(_t=j);var lr=De[_t[0]]-me[_t[0]],xn=De[_t[1]]-me[_t[1]];return Math.atan2(xn,lr)*180/Math.PI}function zi(me,De){return Oi(De[1],De[0],st)+Oi(me[1],me[0],st)}function Pa(me,De){return An(De[0],De[1],st)/An(me[0],me[1],st)}var ia={mousedown:ga,mousemove:fi,mouseup:$i},ao="mousedown",Ci="mousemove mouseup";function da(){this.evEl=ao,this.evWin=Ci,this.pressed=!1,ar.apply(this,arguments)}_r(da,ar,{handler:function(De){var _t=ia[De.type];_t&ga&&De.button===0&&(this.pressed=!0),_t&fi&&De.which!==1&&(_t=$i),!!this.pressed&&(_t&$i&&(this.pressed=!1),this.callback(this.manager,_t,{pointers:[De],changedPointers:[De],pointerType:Xa,srcEvent:De}))}});var J={pointerdown:ga,pointermove:fi,pointerup:$i,pointercancel:hi,pointerout:hi},se={2:gi,3:on,4:Xa,5:ra},_e="pointerdown",ke="pointermove pointerup pointercancel";!lt&&ge.MSPointerEvent&&!ge.PointerEvent&&(_e="MSPointerDown",ke="MSPointerMove MSPointerUp MSPointerCancel");function Ye(){this.evEl=_e,this.evWin=ke,ar.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}_r(Ye,ar,{handler:function(De){var _t=this.store,lr=!1,xn=De.type.toLowerCase().replace("ms",""),ti=J[xn],ya=se[De.pointerType]||De.pointerType,jo=ya==gi,Oa=X(_t,De.pointerId,"pointerId");ti&ga&&(De.button===0||jo)?Oa<0&&(_t.push(De),Oa=_t.length-1):ti&($i|hi)&&(lr=!0),!(Oa<0)&&(_t[Oa]=De,this.callback(this.manager,ti,{pointers:_t,changedPointers:[De],pointerType:ya,srcEvent:De}),lr&&_t.splice(Oa,1))}});var ut={touchstart:ga,touchmove:fi,touchend:$i,touchcancel:hi},xt="touchstart",Ie="touchstart touchmove touchend touchcancel";function nt(){this.evTarget=xt,this.evWin=Ie,this.started=!1,ar.apply(this,arguments)}_r(nt,ar,{handler:function(De){var _t=ut[De.type];if(_t===ga&&(this.started=!0),!!this.started){var lr=Ht.call(this,De,_t);_t&($i|hi)&&lr[0].length-lr[1].length==0&&(this.started=!1),this.callback(this.manager,_t,{pointers:lr[0],changedPointers:lr[1],pointerType:gi,srcEvent:De})}}});function Ht(me,De){var _t=ae(me.touches),lr=ae(me.changedTouches);return De&($i|hi)&&(_t=ze(_t.concat(lr),"identifier",!0)),[_t,lr]}var jr={touchstart:ga,touchmove:fi,touchend:$i,touchcancel:hi},ir="touchstart touchmove touchend touchcancel";function pr(){this.evTarget=ir,this.targetIds={},ar.apply(this,arguments)}_r(pr,ar,{handler:function(De){var _t=jr[De.type],lr=Hr.call(this,De,_t);!lr||this.callback(this.manager,_t,{pointers:lr[0],changedPointers:lr[1],pointerType:gi,srcEvent:De})}});function Hr(me,De){var _t=ae(me.touches),lr=this.targetIds;if(De&(ga|fi)&&_t.length===1)return lr[_t[0].identifier]=!0,[_t,_t];var xn,ti,ya=ae(me.changedTouches),jo=[],Oa=this.target;if(ti=_t.filter(function(zo){return an(zo.target,Oa)}),De===ga)for(xn=0;xn<ti.length;)lr[ti[xn].identifier]=!0,xn++;for(xn=0;xn<ya.length;)lr[ya[xn].identifier]&&jo.push(ya[xn]),De&($i|hi)&&delete lr[ya[xn].identifier],xn++;if(!!jo.length)return[ze(ti.concat(jo),"identifier",!0),jo]}var oi=2500,wn=25;function rr(){ar.apply(this,arguments);var me=Ot(this.handler,this);this.touch=new pr(this.manager,me),this.mouse=new da(this.manager,me),this.primaryTouch=null,this.lastTouches=[]}_r(rr,ar,{handler:function(De,_t,lr){var xn=lr.pointerType==gi,ti=lr.pointerType==Xa;if(!(ti&&lr.sourceCapabilities&&lr.sourceCapabilities.firesTouchEvents)){if(xn)Wn.call(this,_t,lr);else if(ti&&mn.call(this,lr))return;this.callback(De,_t,lr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Wn(me,De){me&ga?(this.primaryTouch=De.changedPointers[0].identifier,Mr.call(this,De)):me&($i|hi)&&Mr.call(this,De)}function Mr(me){var De=me.changedPointers[0];if(De.identifier===this.primaryTouch){var _t={x:De.clientX,y:De.clientY};this.lastTouches.push(_t);var lr=this.lastTouches,xn=function(){var ti=lr.indexOf(_t);ti>-1&&lr.splice(ti,1)};setTimeout(xn,oi)}}function mn(me){for(var De=me.srcEvent.clientX,_t=me.srcEvent.clientY,lr=0;lr<this.lastTouches.length;lr++){var xn=this.lastTouches[lr],ti=Math.abs(De-xn.x),ya=Math.abs(_t-xn.y);if(ti<=wn&&ya<=wn)return!0}return!1}var ea=lt?Q:At(We.style,"touchAction"),Zn=ea!==Q,na="compute",Zt="auto",kt="manipulation",va="none",aa="pan-x",Fi="pan-y",Mi=Pr();function go(me,De){this.manager=me,this.set(De)}go.prototype={set:function(me){me==na&&(me=this.compute()),Zn&&this.manager.element.style&&Mi[me]&&(this.manager.element.style[ea]=me),this.actions=me.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var me=[];return fr(this.manager.recognizers,function(De){yt(De.options.enable,[De])&&(me=me.concat(De.getTouchAction()))}),Ba(me.join(" "))},preventDefaults:function(me){var De=me.srcEvent,_t=me.offsetDirection;if(this.manager.session.prevented){De.preventDefault();return}var lr=this.actions,xn=fe(lr,va)&&!Mi[va],ti=fe(lr,Fi)&&!Mi[Fi],ya=fe(lr,aa)&&!Mi[aa];if(xn){var jo=me.pointers.length===1,Oa=me.distance<2,zo=me.deltaTime<250;if(jo&&Oa&&zo)return}if(!(ya&&ti)&&(xn||ti&&_t&xe||ya&&_t&ce))return this.preventSrc(De)},preventSrc:function(me){this.manager.session.prevented=!0,me.preventDefault()}};function Ba(me){if(fe(me,va))return va;var De=fe(me,aa),_t=fe(me,Fi);return De&&_t?va:De||_t?De?aa:Fi:fe(me,kt)?kt:Zt}function Pr(){if(!Zn)return!1;var me={};if(lt)return me;var De=ge.CSS&&ge.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(_t){me[_t]=De?ge.CSS.supports("touch-action",_t):!0}),me}var Or=1,Et=2,ss=4,bt=8,oo=bt,yu=16,Qo=32;function Bi(me){this.options=jt({},this.defaults,me||{}),this.id=ur(),this.manager=null,this.options.enable=Qt(this.options.enable,!0),this.state=Or,this.simultaneous={},this.requireFail=[]}Bi.prototype={defaults:{},set:function(me){return jt(this.options,me),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(me){if(Sr(me,"recognizeWith",this))return this;var De=this.simultaneous;return me=Lo(me,this),De[me.id]||(De[me.id]=me,me.recognizeWith(this)),this},dropRecognizeWith:function(me){return Sr(me,"dropRecognizeWith",this)?this:(me=Lo(me,this),delete this.simultaneous[me.id],this)},requireFailure:function(me){if(Sr(me,"requireFailure",this))return this;var De=this.requireFail;return me=Lo(me,this),X(De,me)===-1&&(De.push(me),me.requireFailure(this)),this},dropRequireFailure:function(me){if(Sr(me,"dropRequireFailure",this))return this;me=Lo(me,this);var De=X(this.requireFail,me);return De>-1&&this.requireFail.splice(De,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(me){return!!this.simultaneous[me.id]},emit:function(me){var De=this,_t=this.state;function lr(xn){De.manager.emit(xn,me)}_t<bt&&lr(De.options.event+ml(_t)),lr(De.options.event),me.additionalEvent&&lr(me.additionalEvent),_t>=bt&&lr(De.options.event+ml(_t))},tryEmit:function(me){if(this.canEmit())return this.emit(me);this.state=Qo},canEmit:function(){for(var me=0;me<this.requireFail.length;){if(!(this.requireFail[me].state&(Qo|Or)))return!1;me++}return!0},recognize:function(me){var De=jt({},me);if(!yt(this.options.enable,[this,De])){this.reset(),this.state=Qo;return}this.state&(oo|yu|Qo)&&(this.state=Or),this.state=this.process(De),this.state&(Et|ss|bt|yu)&&this.tryEmit(De)},process:function(me){},getTouchAction:function(){},reset:function(){}};function ml(me){return me&yu?"cancel":me&bt?"end":me&ss?"move":me&Et?"start":""}function Ra(me){return me==Pt?"down":me==Ya?"up":me==os?"left":me==mo?"right":""}function Lo(me,De){var _t=De.manager;return _t?_t.get(me):me}function Do(){Bi.apply(this,arguments)}_r(Do,Bi,{defaults:{pointers:1},attrTest:function(me){var De=this.options.pointers;return De===0||me.pointers.length===De},process:function(me){var De=this.state,_t=me.eventType,lr=De&(Et|ss),xn=this.attrTest(me);return lr&&(_t&hi||!xn)?De|yu:lr||xn?_t&$i?De|bt:De&Et?De|ss:Et:Qo}});function ba(){Do.apply(this,arguments),this.pX=null,this.pY=null}_r(ba,Do,{defaults:{event:"pan",threshold:10,pointers:1,direction:Te},getTouchAction:function(){var me=this.options.direction,De=[];return me&xe&&De.push(Fi),me&ce&&De.push(aa),De},directionTest:function(me){var De=this.options,_t=!0,lr=me.distance,xn=me.direction,ti=me.deltaX,ya=me.deltaY;return xn&De.direction||(De.direction&xe?(xn=ti===0?yi:ti<0?os:mo,_t=ti!=this.pX,lr=Math.abs(me.deltaX)):(xn=ya===0?yi:ya<0?Ya:Pt,_t=ya!=this.pY,lr=Math.abs(me.deltaY))),me.direction=xn,_t&&lr>De.threshold&&xn&De.direction},attrTest:function(me){return Do.prototype.attrTest.call(this,me)&&(this.state&Et||!(this.state&Et)&&this.directionTest(me))},emit:function(me){this.pX=me.deltaX,this.pY=me.deltaY;var De=Ra(me.direction);De&&(me.additionalEvent=this.options.event+De),this._super.emit.call(this,me)}});function Ps(){Do.apply(this,arguments)}_r(Ps,Do,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[va]},attrTest:function(me){return this._super.attrTest.call(this,me)&&(Math.abs(me.scale-1)>this.options.threshold||this.state&Et)},emit:function(me){if(me.scale!==1){var De=me.scale<1?"in":"out";me.additionalEvent=this.options.event+De}this._super.emit.call(this,me)}});function Ls(){Bi.apply(this,arguments),this._timer=null,this._input=null}_r(Ls,Bi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Zt]},process:function(me){var De=this.options,_t=me.pointers.length===De.pointers,lr=me.distance<De.threshold,xn=me.deltaTime>De.time;if(this._input=me,!lr||!_t||me.eventType&($i|hi)&&!xn)this.reset();else if(me.eventType&ga)this.reset(),this._timer=Yt(function(){this.state=oo,this.tryEmit()},De.time,this);else if(me.eventType&$i)return oo;return Qo},reset:function(){clearTimeout(this._timer)},emit:function(me){this.state===oo&&(me&&me.eventType&$i?this.manager.emit(this.options.event+"up",me):(this._input.timeStamp=qt(),this.manager.emit(this.options.event,this._input)))}});function Ql(){Do.apply(this,arguments)}_r(Ql,Do,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[va]},attrTest:function(me){return this._super.attrTest.call(this,me)&&(Math.abs(me.rotation)>this.options.threshold||this.state&Et)}});function fo(){Do.apply(this,arguments)}_r(fo,Do,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:xe|ce,pointers:1},getTouchAction:function(){return ba.prototype.getTouchAction.call(this)},attrTest:function(me){var De=this.options.direction,_t;return De&(xe|ce)?_t=me.overallVelocity:De&xe?_t=me.overallVelocityX:De&ce&&(_t=me.overallVelocityY),this._super.attrTest.call(this,me)&&De&me.offsetDirection&&me.distance>this.options.threshold&&me.maxPointers==this.options.pointers&&tr(_t)>this.options.velocity&&me.eventType&$i},emit:function(me){var De=Ra(me.offsetDirection);De&&this.manager.emit(this.options.event+De,me),this.manager.emit(this.options.event,me)}});function ds(){Bi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}_r(ds,Bi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[kt]},process:function(me){var De=this.options,_t=me.pointers.length===De.pointers,lr=me.distance<De.threshold,xn=me.deltaTime<De.time;if(this.reset(),me.eventType&ga&&this.count===0)return this.failTimeout();if(lr&&xn&&_t){if(me.eventType!=$i)return this.failTimeout();var ti=this.pTime?me.timeStamp-this.pTime<De.interval:!0,ya=!this.pCenter||An(this.pCenter,me.center)<De.posThreshold;this.pTime=me.timeStamp,this.pCenter=me.center,!ya||!ti?this.count=1:this.count+=1,this._input=me;var jo=this.count%De.taps;if(jo===0)return this.hasRequireFailures()?(this._timer=Yt(function(){this.state=oo,this.tryEmit()},De.interval,this),Et):oo}return Qo},failTimeout:function(){return this._timer=Yt(function(){this.state=Qo},this.options.interval,this),Qo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==oo&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Va(me,De){return De=De||{},De.recognizers=Qt(De.recognizers,Va.defaults.preset),new No(me,De)}Va.VERSION="2.0.7",Va.defaults={domEvents:!1,touchAction:na,enable:!0,inputTarget:null,inputClass:null,preset:[[Ql,{enable:!1}],[Ps,{enable:!1},["rotate"]],[fo,{direction:xe}],[ba,{direction:xe},["swipe"]],[ds],[ds,{event:"doubletap",taps:2},["tap"]],[Ls]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Bo=1,vs=2;function No(me,De){this.options=jt({},Va.defaults,De||{}),this.options.inputTarget=this.options.inputTarget||me,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=me,this.input=Jr(this),this.touchAction=new go(this,this.options.touchAction),Qu(this,!0),fr(this.options.recognizers,function(_t){var lr=this.add(new _t[0](_t[1]));_t[2]&&lr.recognizeWith(_t[2]),_t[3]&&lr.requireFailure(_t[3])},this)}No.prototype={set:function(me){return jt(this.options,me),me.touchAction&&this.touchAction.update(),me.inputTarget&&(this.input.destroy(),this.input.target=me.inputTarget,this.input.init()),this},stop:function(me){this.session.stopped=me?vs:Bo},recognize:function(me){var De=this.session;if(!De.stopped){this.touchAction.preventDefaults(me);var _t,lr=this.recognizers,xn=De.curRecognizer;(!xn||xn&&xn.state&oo)&&(xn=De.curRecognizer=null);for(var ti=0;ti<lr.length;)_t=lr[ti],De.stopped!==vs&&(!xn||_t==xn||_t.canRecognizeWith(xn))?_t.recognize(me):_t.reset(),!xn&&_t.state&(Et|ss|bt)&&(xn=De.curRecognizer=_t),ti++}},get:function(me){if(me instanceof Bi)return me;for(var De=this.recognizers,_t=0;_t<De.length;_t++)if(De[_t].options.event==me)return De[_t];return null},add:function(me){if(Sr(me,"add",this))return this;var De=this.get(me.options.event);return De&&this.remove(De),this.recognizers.push(me),me.manager=this,this.touchAction.update(),me},remove:function(me){if(Sr(me,"remove",this))return this;if(me=this.get(me),me){var De=this.recognizers,_t=X(De,me);_t!==-1&&(De.splice(_t,1),this.touchAction.update())}return this},on:function(me,De){if(me!==Q&&De!==Q){var _t=this.handlers;return fr(rt(me),function(lr){_t[lr]=_t[lr]||[],_t[lr].push(De)}),this}},off:function(me,De){if(me!==Q){var _t=this.handlers;return fr(rt(me),function(lr){De?_t[lr]&&_t[lr].splice(X(_t[lr],De),1):delete _t[lr]}),this}},emit:function(me,De){this.options.domEvents&&Zu(me,De);var _t=this.handlers[me]&&this.handlers[me].slice();if(!(!_t||!_t.length)){De.type=me,De.preventDefault=function(){De.srcEvent.preventDefault()};for(var lr=0;lr<_t.length;)_t[lr](De),lr++}},destroy:function(){this.element&&Qu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Qu(me,De){var _t=me.element;if(!!_t.style){var lr;fr(me.options.cssProps,function(xn,ti){lr=At(_t.style,ti),De?(me.oldCssProps[lr]=_t.style[lr],_t.style[lr]=xn):_t.style[lr]=me.oldCssProps[lr]||""}),De||(me.oldCssProps={})}}function Zu(me,De){if(!lt){var _t=y.createEvent("Event");_t.initEvent(me,!0,!0),_t.gesture=De,De.target.dispatchEvent(_t)}}if(!lt){jt(Va,{INPUT_START:ga,INPUT_MOVE:fi,INPUT_END:$i,INPUT_CANCEL:hi,STATE_POSSIBLE:Or,STATE_BEGAN:Et,STATE_CHANGED:ss,STATE_ENDED:bt,STATE_RECOGNIZED:oo,STATE_CANCELLED:yu,STATE_FAILED:Qo,DIRECTION_NONE:yi,DIRECTION_LEFT:os,DIRECTION_RIGHT:mo,DIRECTION_UP:Ya,DIRECTION_DOWN:Pt,DIRECTION_HORIZONTAL:xe,DIRECTION_VERTICAL:ce,DIRECTION_ALL:Te,Manager:No,Input:ar,TouchAction:go,TouchInput:pr,MouseInput:da,PointerEventInput:Ye,TouchMouseInput:rr,SingleTouchInput:nt,Recognizer:Bi,AttrRecognizer:Do,Tap:ds,Pan:ba,Swipe:fo,Pinch:Ps,Rotate:Ql,Press:Ls,on:Ue,off:Ar,each:fr,merge:ie,extend:Rr,assign:jt,inherit:_r,bindFn:Ot,prefixed:At});var Vo=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Vo.Hammer=Va,He=function(){return Va}.call(Ae,de,Ae,ci),He!==Q&&(ci.exports=He)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(ci,Ae,de){(function(He,ge){ci.exports=ge(de(18857))})(this,function(He){"use strict";var ge=function(H){return H instanceof Uint8Array||H instanceof Uint16Array||H instanceof Uint32Array||H instanceof Int8Array||H instanceof Int16Array||H instanceof Int32Array||H instanceof Float32Array||H instanceof Float64Array||H instanceof Uint8ClampedArray},y=function(H,Le){for(var ot=Object.keys(Le),hr=0;hr<ot.length;++hr)H[ot[hr]]=Le[ot[hr]];return H},Ne=`
`;function Q(H){return typeof atob!="undefined"?atob(H):"base64:"+H}function Pe(H){var Le=new Error("(regl) "+H);throw console.error(Le),Le}function ve(H,Le){H||Pe(Le)}function lt(H){return H?": "+H:""}function we(H,Le,ot){H in Le||Pe("unknown parameter ("+H+")"+lt(ot)+". possible values: "+Object.keys(Le).join())}function We(H,Le){ge(H)||Pe("invalid parameter type"+lt(Le)+". must be a typed array")}function St(H,Le){switch(Le){case"number":return typeof H=="number";case"object":return typeof H=="object";case"string":return typeof H=="string";case"boolean":return typeof H=="boolean";case"function":return typeof H=="function";case"undefined":return typeof H=="undefined";case"symbol":return typeof H=="symbol"}}function Rt(H,Le,ot){St(H,Le)||Pe("invalid parameter type"+lt(ot)+". expected "+Le+", got "+typeof H)}function tr(H,Le){H>=0&&(H|0)===H||Pe("invalid parameter type, ("+H+")"+lt(Le)+". must be a nonnegative integer")}function qt(H,Le,ot){Le.indexOf(H)<0&&Pe("invalid value"+lt(ot)+". must be one of: "+Le)}var Yt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Sr(H){Object.keys(H).forEach(function(Le){Yt.indexOf(Le)<0&&Pe('invalid regl constructor argument "'+Le+'". must be one of '+Yt)})}function fr(H,Le){for(H=H+"";H.length<Le;)H=" "+H;return H}function It(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function jt(H,Le){this.number=H,this.line=Le,this.errors=[]}function Rr(H,Le,ot){this.file=H,this.line=Le,this.message=ot}function ie(){var H=new Error,Le=(H.stack||H).toString(),ot=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Le);if(ot)return ot[1];var hr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Le);return hr?hr[1]:"unknown"}function _r(){var H=new Error,Le=(H.stack||H).toString(),ot=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Le);if(ot)return ot[1];var hr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Le);return hr?hr[1]:"unknown"}function Ot(H,Le){var ot=H.split(`
`),hr=1,Ur=0,cr={unknown:new It,0:new It};cr.unknown.name=cr[0].name=Le||ie(),cr.unknown.lines.push(new jt(0,""));for(var kr=0;kr<ot.length;++kr){var Gr=ot[kr],$r=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Gr);if($r)switch($r[1]){case"line":var tn=/(\d+)(\s+\d+)?/.exec($r[2]);tn&&(hr=tn[1]|0,tn[2]&&(Ur=tn[2]|0,Ur in cr||(cr[Ur]=new It)));break;case"define":var hn=/SHADER_NAME(_B64)?\s+(.*)$/.exec($r[2]);hn&&(cr[Ur].name=hn[1]?Q(hn[2]):hn[2]);break}cr[Ur].lines.push(new jt(hr++,Gr))}return Object.keys(cr).forEach(function(pn){var In=cr[pn];In.lines.forEach(function(rn){In.index[rn.number]=rn})}),cr}function yt(H){var Le=[];return H.split(`
`).forEach(function(ot){if(!(ot.length<5)){var hr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ot);hr?Le.push(new Rr(hr[1]|0,hr[2]|0,hr[3].trim())):ot.length>0&&Le.push(new Rr("unknown",0,ot))}}),Le}function Qt(H,Le){Le.forEach(function(ot){var hr=H[ot.file];if(hr){var Ur=hr.index[ot.line];if(Ur){Ur.errors.push(ot),hr.hasErrors=!0;return}}H.unknown.hasErrors=!0,H.unknown.lines[0].errors.push(ot)})}function Ue(H,Le,ot,hr,Ur){if(!H.getShaderParameter(Le,H.COMPILE_STATUS)){var cr=H.getShaderInfoLog(Le),kr=hr===H.FRAGMENT_SHADER?"fragment":"vertex";ze(ot,"string",kr+" shader source must be a string",Ur);var Gr=Ot(ot,Ur),$r=yt(cr);Qt(Gr,$r),Object.keys(Gr).forEach(function(tn){var hn=Gr[tn];if(!hn.hasErrors)return;var pn=[""],In=[""];function rn(cn,Nt){pn.push(cn),In.push(Nt||"")}rn("file number "+tn+": "+hn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),hn.lines.forEach(function(cn){if(cn.errors.length>0){rn(fr(cn.number,4)+"|  ","background-color:yellow; font-weight:bold"),rn(cn.line+Ne,"color:red; background-color:yellow; font-weight:bold");var Nt=0;cn.errors.forEach(function(yr){var en=yr.message,Pn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(en);if(Pn){var Zr=Pn[1];switch(en=Pn[2],Zr){case"assign":Zr="=";break}Nt=Math.max(cn.line.indexOf(Zr,Nt),0)}else Nt=0;rn(fr("| ",6)),rn(fr("^^^",Nt+3)+Ne,"font-weight:bold"),rn(fr("| ",6)),rn(en+Ne,"font-weight:bold")}),rn(fr("| ",6)+Ne)}else rn(fr(cn.number,4)+"|  "),rn(cn.line+Ne,"color:red")}),typeof document!="undefined"&&!window.chrome?(In[0]=pn.join("%c"),console.log.apply(console,In)):console.log(pn.join(""))}),ve.raise("Error compiling "+kr+" shader, "+Gr[0].name)}}function Ar(H,Le,ot,hr,Ur){if(!H.getProgramParameter(Le,H.LINK_STATUS)){var cr=H.getProgramInfoLog(Le),kr=Ot(ot,Ur),Gr=Ot(hr,Ur),$r='Error linking program with vertex shader, "'+Gr[0].name+'", and fragment shader "'+kr[0].name+'"';typeof document!="undefined"?console.log("%c"+$r+Ne+"%c"+cr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log($r+Ne+cr),ve.raise($r)}}function an(H){H._commandRef=ie()}function fe(H,Le,ot,hr){an(H);function Ur($r){return $r?hr.id($r):0}H._fragId=Ur(H.static.frag),H._vertId=Ur(H.static.vert);function cr($r,tn){Object.keys(tn).forEach(function(hn){$r[hr.id(hn)]=!0})}var kr=H._uniformSet={};cr(kr,Le.static),cr(kr,Le.dynamic);var Gr=H._attributeSet={};cr(Gr,ot.static),cr(Gr,ot.dynamic),H._hasCount="count"in H.static||"count"in H.dynamic||"elements"in H.static||"elements"in H.dynamic}function rt(H,Le){var ot=_r();Pe(H+" in command "+(Le||ie())+(ot==="unknown"?"":" called from "+ot))}function X(H,Le,ot){H||rt(Le,ot||ie())}function ae(H,Le,ot,hr){H in Le||rt("unknown parameter ("+H+")"+lt(ot)+". possible values: "+Object.keys(Le).join(),hr||ie())}function ze(H,Le,ot,hr){St(H,Le)||rt("invalid parameter type"+lt(ot)+". expected "+Le+", got "+typeof H,hr||ie())}function At(H){H()}function Ft(H,Le,ot){H.texture?qt(H.texture._texture.internalformat,Le,"unsupported texture format for attachment"):qt(H.renderbuffer._renderbuffer.format,ot,"unsupported renderbuffer format for attachment")}var ur=33071,Tt=9728,Br=9984,Bn=9985,Sn=9986,Li=9987,gi=5120,on=5121,Xa=5122,ra=5123,Vi=5124,ga=5125,fi=5126,$i=32819,hi=32820,yi=33635,os=34042,mo=36193,Ya={};Ya[gi]=Ya[on]=1,Ya[Xa]=Ya[ra]=Ya[mo]=Ya[yi]=Ya[$i]=Ya[hi]=2,Ya[Vi]=Ya[ga]=Ya[fi]=Ya[os]=4;function Pt(H,Le){return H===hi||H===$i||H===yi?2:H===os?4:Ya[H]*Le}function xe(H){return!(H&H-1)&&!!H}function ce(H,Le,ot){var hr,Ur=Le.width,cr=Le.height,kr=Le.channels;ve(Ur>0&&Ur<=ot.maxTextureSize&&cr>0&&cr<=ot.maxTextureSize,"invalid texture shape"),(H.wrapS!==ur||H.wrapT!==ur)&&ve(xe(Ur)&&xe(cr),"incompatible wrap mode for texture, both width and height must be power of 2"),Le.mipmask===1?Ur!==1&&cr!==1&&ve(H.minFilter!==Br&&H.minFilter!==Sn&&H.minFilter!==Bn&&H.minFilter!==Li,"min filter requires mipmap"):(ve(xe(Ur)&&xe(cr),"texture must be a square power of 2 to support mipmapping"),ve(Le.mipmask===(Ur<<1)-1,"missing or incomplete mipmap data")),Le.type===fi&&(ot.extensions.indexOf("oes_texture_float_linear")<0&&ve(H.minFilter===Tt&&H.magFilter===Tt,"filter not supported, must enable oes_texture_float_linear"),ve(!H.genMipmaps,"mipmap generation not supported with float textures"));var Gr=Le.images;for(hr=0;hr<16;++hr)if(Gr[hr]){var $r=Ur>>hr,tn=cr>>hr;ve(Le.mipmask&1<<hr,"missing mipmap data");var hn=Gr[hr];if(ve(hn.width===$r&&hn.height===tn,"invalid shape for mip images"),ve(hn.format===Le.format&&hn.internalformat===Le.internalformat&&hn.type===Le.type,"incompatible type for mip image"),!hn.compressed)if(hn.data){var pn=Math.ceil(Pt(hn.type,kr)*$r/hn.unpackAlignment)*hn.unpackAlignment;ve(hn.data.byteLength===pn*tn,"invalid data for image, buffer size is inconsistent with image format")}else hn.element||hn.copy}else H.genMipmaps||ve((Le.mipmask&1<<hr)==0,"extra mipmap data");Le.compressed&&ve(!H.genMipmaps,"mipmap generation for compressed images not supported")}function Te(H,Le,ot,hr){var Ur=H.width,cr=H.height,kr=H.channels;ve(Ur>0&&Ur<=hr.maxTextureSize&&cr>0&&cr<=hr.maxTextureSize,"invalid texture shape"),ve(Ur===cr,"cube map must be square"),ve(Le.wrapS===ur&&Le.wrapT===ur,"wrap mode not supported by cube map");for(var Gr=0;Gr<ot.length;++Gr){var $r=ot[Gr];ve($r.width===Ur&&$r.height===cr,"inconsistent cube map face shape"),Le.genMipmaps&&(ve(!$r.compressed,"can not generate mipmap for compressed textures"),ve($r.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var tn=$r.images,hn=0;hn<16;++hn){var pn=tn[hn];if(pn){var In=Ur>>hn,rn=cr>>hn;ve($r.mipmask&1<<hn,"missing mipmap data"),ve(pn.width===In&&pn.height===rn,"invalid shape for mip images"),ve(pn.format===H.format&&pn.internalformat===H.internalformat&&pn.type===H.type,"incompatible type for mip image"),pn.compressed||(pn.data?ve(pn.data.byteLength===In*rn*Math.max(Pt(pn.type,kr),pn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):pn.element||pn.copy)}}}}var j=y(ve,{optional:At,raise:Pe,commandRaise:rt,command:X,parameter:we,commandParameter:ae,constructor:Sr,type:Rt,commandType:ze,isTypedArray:We,nni:tr,oneOf:qt,shaderError:Ue,linkError:Ar,callSite:_r,saveCommandRef:an,saveDrawInfo:fe,framebufferFormat:Ft,guessCommand:ie,texture2D:ce,textureCube:Te}),st=0,ar=0,Jr=5,tt=6;function Ut(H,Le){this.id=st++,this.type=H,this.data=Le}function xr(H){return H.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Cr(H){if(H.length===0)return[];var Le=H.charAt(0),ot=H.charAt(H.length-1);if(H.length>1&&Le===ot&&(Le==='"'||Le==="'"))return['"'+xr(H.substr(1,H.length-2))+'"'];var hr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(H);if(hr)return Cr(H.substr(0,hr.index)).concat(Cr(hr[1])).concat(Cr(H.substr(hr.index+hr[0].length)));var Ur=H.split(".");if(Ur.length===1)return['"'+xr(H)+'"'];for(var cr=[],kr=0;kr<Ur.length;++kr)cr=cr.concat(Cr(Ur[kr]));return cr}function Lr(H){return"["+Cr(H).join("][")+"]"}function vn(H,Le){return new Ut(H,Lr(Le+""))}function vi(H){return typeof H=="function"&&!H._reglType||H instanceof Ut}function ni(H,Le){if(typeof H=="function")return new Ut(ar,H);if(typeof H=="number"||typeof H=="boolean")return new Ut(Jr,H);if(Array.isArray(H))return new Ut(tt,H.map(function(ot,hr){return ni(ot,Le+"["+hr+"]")}));if(H instanceof Ut)return H;j(!1,"invalid option type in uniform "+Le)}var An={DynamicVariable:Ut,define:vn,isDynamic:vi,unbox:ni,accessor:Lr},Oi={next:typeof requestAnimationFrame=="function"?function(H){return requestAnimationFrame(H)}:function(H){return setTimeout(H,16)},cancel:typeof cancelAnimationFrame=="function"?function(H){return cancelAnimationFrame(H)}:clearTimeout},zi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Pa=zi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ia(){var H={"":0},Le=[""];return{id:function(ot){var hr=H[ot];return hr||(hr=H[ot]=Le.length,Le.push(ot),hr)},str:function(ot){return Le[ot]}}}function ao(H,Le,ot){var hr=document.createElement("canvas");y(hr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),H.appendChild(hr),H===document.body&&(hr.style.position="absolute",y(H.style,{margin:0,padding:0}));function Ur(){var Gr=window.innerWidth,$r=window.innerHeight;if(H!==document.body){var tn=hr.getBoundingClientRect();Gr=tn.right-tn.left,$r=tn.bottom-tn.top}hr.width=ot*Gr,hr.height=ot*$r}var cr;H!==document.body&&typeof ResizeObserver=="function"?(cr=new ResizeObserver(function(){setTimeout(Ur)}),cr.observe(H)):window.addEventListener("resize",Ur,!1);function kr(){cr?cr.disconnect():window.removeEventListener("resize",Ur),H.removeChild(hr)}return Ur(),{canvas:hr,onDestroy:kr}}function Ci(H,Le){function ot(hr){try{return H.getContext(hr,Le)}catch(Ur){return null}}return ot("webgl")||ot("experimental-webgl")||ot("webgl-experimental")}function da(H){return typeof H.nodeName=="string"&&typeof H.appendChild=="function"&&typeof H.getBoundingClientRect=="function"}function J(H){return typeof H.drawArrays=="function"||typeof H.drawElements=="function"}function se(H){return typeof H=="string"?H.split():(j(Array.isArray(H),"invalid extension array"),H)}function _e(H){return typeof H=="string"?(j(typeof document!="undefined","not supported outside of DOM"),document.querySelector(H)):H}function ke(H){var Le=H||{},ot,hr,Ur,cr,kr={},Gr=[],$r=[],tn=typeof window=="undefined"?1:window.devicePixelRatio,hn=!1,pn=function(cn){cn&&j.raise(cn)},In=function(){};if(typeof Le=="string"?(j(typeof document!="undefined","selector queries only supported in DOM environments"),ot=document.querySelector(Le),j(ot,"invalid query string for element")):typeof Le=="object"?da(Le)?ot=Le:J(Le)?(cr=Le,Ur=cr.canvas):(j.constructor(Le),"gl"in Le?cr=Le.gl:"canvas"in Le?Ur=_e(Le.canvas):"container"in Le&&(hr=_e(Le.container)),"attributes"in Le&&(kr=Le.attributes,j.type(kr,"object","invalid context attributes")),"extensions"in Le&&(Gr=se(Le.extensions)),"optionalExtensions"in Le&&($r=se(Le.optionalExtensions)),"onDone"in Le&&(j.type(Le.onDone,"function","invalid or missing onDone callback"),pn=Le.onDone),"profile"in Le&&(hn=!!Le.profile),"pixelRatio"in Le&&(tn=+Le.pixelRatio,j(tn>0,"invalid pixel ratio"))):j.raise("invalid arguments to regl"),ot&&(ot.nodeName.toLowerCase()==="canvas"?Ur=ot:hr=ot),!cr){if(!Ur){j(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var rn=ao(hr||document.body,pn,tn);if(!rn)return null;Ur=rn.canvas,In=rn.onDestroy}kr.premultipliedAlpha===void 0&&(kr.premultipliedAlpha=!0),cr=Ci(Ur,kr)}return cr?{gl:cr,canvas:Ur,container:hr,extensions:Gr,optionalExtensions:$r,pixelRatio:tn,profile:hn,onDone:pn,onDestroy:In}:(In(),pn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ye(H,Le){var ot={};function hr(Gr){j.type(Gr,"string","extension name must be string");var $r=Gr.toLowerCase(),tn;try{tn=ot[$r]=Ur(Gr)}catch(hn){}return!!tn}function Ur(Gr){return H.getExtension(Gr)?H.getExtension(Gr):H.getExtension(Gr.toLowerCase())?H.getExtension(Gr.toLowerCase()):null}for(var cr=0;cr<Le.extensions.length;++cr){var kr=Le.extensions[cr];if(!hr(kr))return Le.onDestroy(),Le.onDone('"'+kr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Le.optionalExtensions.forEach(hr),{extensions:ot,restore:function(){Object.keys(ot).forEach(function(Gr){if(ot[Gr]&&!hr(Gr))throw new Error("(regl): error restoring extension "+Gr)})}}}function ut(H,Le){for(var ot=Array(H),hr=0;hr<H;++hr)ot[hr]=Le(hr);return ot}var xt=5120,Ie=5121,nt=5122,Ht=5123,jr=5124,ir=5125,pr=5126;function Hr(H){for(var Le=16;Le<=1<<28;Le*=16)if(H<=Le)return Le;return 0}function oi(H){var Le,ot;return Le=(H>65535)<<4,H>>>=Le,ot=(H>255)<<3,H>>>=ot,Le|=ot,ot=(H>15)<<2,H>>>=ot,Le|=ot,ot=(H>3)<<1,H>>>=ot,Le|=ot,Le|H>>1}function wn(){var H=ut(8,function(){return[]});function Le(cr){var kr=Hr(cr),Gr=H[oi(kr)>>2];return Gr.length>0?Gr.pop():new ArrayBuffer(kr)}function ot(cr){H[oi(cr.byteLength)>>2].push(cr)}function hr(cr,kr){var Gr=null;switch(cr){case xt:Gr=new Int8Array(Le(kr),0,kr);break;case Ie:Gr=new Uint8Array(Le(kr),0,kr);break;case nt:Gr=new Int16Array(Le(2*kr),0,kr);break;case Ht:Gr=new Uint16Array(Le(2*kr),0,kr);break;case jr:Gr=new Int32Array(Le(4*kr),0,kr);break;case ir:Gr=new Uint32Array(Le(4*kr),0,kr);break;case pr:Gr=new Float32Array(Le(4*kr),0,kr);break;default:return null}return Gr.length!==kr?Gr.subarray(0,kr):Gr}function Ur(cr){ot(cr.buffer)}return{alloc:Le,free:ot,allocType:hr,freeType:Ur}}var rr=wn();rr.zero=wn();var Wn=3408,Mr=3410,mn=3411,ea=3412,Zn=3413,na=3414,Zt=3415,kt=33901,va=33902,aa=3379,Fi=3386,Mi=34921,go=36347,Ba=36348,Pr=35661,Or=35660,Et=34930,ss=36349,bt=34076,oo=34024,yu=7936,Qo=7937,Bi=7938,ml=35724,Ra=34047,Lo=36063,Do=34852,ba=3553,Ps=34067,Ls=34069,Ql=33984,fo=6408,ds=5126,Va=5121,Bo=36160,vs=36053,No=36064,Qu=16384,Zu=function(H,Le){var ot=1;Le.ext_texture_filter_anisotropic&&(ot=H.getParameter(Ra));var hr=1,Ur=1;Le.webgl_draw_buffers&&(hr=H.getParameter(Do),Ur=H.getParameter(Lo));var cr=!!Le.oes_texture_float;if(cr){var kr=H.createTexture();H.bindTexture(ba,kr),H.texImage2D(ba,0,fo,1,1,0,fo,ds,null);var Gr=H.createFramebuffer();if(H.bindFramebuffer(Bo,Gr),H.framebufferTexture2D(Bo,No,ba,kr,0),H.bindTexture(ba,null),H.checkFramebufferStatus(Bo)!==vs)cr=!1;else{H.viewport(0,0,1,1),H.clearColor(1,0,0,1),H.clear(Qu);var $r=rr.allocType(ds,4);H.readPixels(0,0,1,1,fo,ds,$r),H.getError()?cr=!1:(H.deleteFramebuffer(Gr),H.deleteTexture(kr),cr=$r[0]===1),rr.freeType($r)}}var tn=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),hn=!0;if(!tn){var pn=H.createTexture(),In=rr.allocType(Va,36);H.activeTexture(Ql),H.bindTexture(Ps,pn),H.texImage2D(Ls,0,fo,3,3,0,fo,Va,In),rr.freeType(In),H.bindTexture(Ps,null),H.deleteTexture(pn),hn=!H.getError()}return{colorBits:[H.getParameter(Mr),H.getParameter(mn),H.getParameter(ea),H.getParameter(Zn)],depthBits:H.getParameter(na),stencilBits:H.getParameter(Zt),subpixelBits:H.getParameter(Wn),extensions:Object.keys(Le).filter(function(rn){return!!Le[rn]}),maxAnisotropic:ot,maxDrawbuffers:hr,maxColorAttachments:Ur,pointSizeDims:H.getParameter(kt),lineWidthDims:H.getParameter(va),maxViewportDims:H.getParameter(Fi),maxCombinedTextureUnits:H.getParameter(Pr),maxCubeMapSize:H.getParameter(bt),maxRenderbufferSize:H.getParameter(oo),maxTextureUnits:H.getParameter(Et),maxTextureSize:H.getParameter(aa),maxAttributes:H.getParameter(Mi),maxVertexUniforms:H.getParameter(go),maxVertexTextureUnits:H.getParameter(Or),maxVaryingVectors:H.getParameter(Ba),maxFragmentUniforms:H.getParameter(ss),glsl:H.getParameter(ml),renderer:H.getParameter(Qo),vendor:H.getParameter(yu),version:H.getParameter(Bi),readFloat:cr,npotTextureCube:hn}};function Vo(H){return!!H&&typeof H=="object"&&Array.isArray(H.shape)&&Array.isArray(H.stride)&&typeof H.offset=="number"&&H.shape.length===H.stride.length&&(Array.isArray(H.data)||ge(H.data))}var me=function(H){return Object.keys(H).map(function(Le){return H[Le]})},De={shape:jo,flatten:ya};function _t(H,Le,ot){for(var hr=0;hr<Le;++hr)ot[hr]=H[hr]}function lr(H,Le,ot,hr){for(var Ur=0,cr=0;cr<Le;++cr)for(var kr=H[cr],Gr=0;Gr<ot;++Gr)hr[Ur++]=kr[Gr]}function xn(H,Le,ot,hr,Ur,cr){for(var kr=cr,Gr=0;Gr<Le;++Gr)for(var $r=H[Gr],tn=0;tn<ot;++tn)for(var hn=$r[tn],pn=0;pn<hr;++pn)Ur[kr++]=hn[pn]}function ti(H,Le,ot,hr,Ur){for(var cr=1,kr=ot+1;kr<Le.length;++kr)cr*=Le[kr];var Gr=Le[ot];if(Le.length-ot==4){var $r=Le[ot+1],tn=Le[ot+2],hn=Le[ot+3];for(kr=0;kr<Gr;++kr)xn(H[kr],$r,tn,hn,hr,Ur),Ur+=cr}else for(kr=0;kr<Gr;++kr)ti(H[kr],Le,ot+1,hr,Ur),Ur+=cr}function ya(H,Le,ot,hr){var Ur=1;if(Le.length)for(var cr=0;cr<Le.length;++cr)Ur*=Le[cr];else Ur=0;var kr=hr||rr.allocType(ot,Ur);switch(Le.length){case 0:break;case 1:_t(H,Le[0],kr);break;case 2:lr(H,Le[0],Le[1],kr);break;case 3:xn(H,Le[0],Le[1],Le[2],kr,0);break;default:ti(H,Le,0,kr,0)}return kr}function jo(H){for(var Le=[],ot=H;ot.length;ot=ot[0])Le.push(ot.length);return Le}var Oa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},zo=5120,So=5122,so=5124,Rs=5121,eu=5123,su=5125,_u=5126,Vu=5126,xu={int8:zo,int16:So,int32:so,uint8:Rs,uint16:eu,uint32:su,float:_u,float32:Vu},Ro=35048,ha=35040,As={dynamic:Ro,stream:ha,static:35044},Sh=De.flatten,Ju=De.shape,pf=35044,Wf=35040,gl=5121,Ac=5126,yl=[];yl[5120]=1,yl[5122]=2,yl[5124]=4,yl[5121]=1,yl[5123]=2,yl[5125]=4,yl[5126]=4;function df(H){return Oa[Object.prototype.toString.call(H)]|0}function E(H,Le){for(var ot=0;ot<Le.length;++ot)H[ot]=Le[ot]}function P(H,Le,ot,hr,Ur,cr,kr){for(var Gr=0,$r=0;$r<ot;++$r)for(var tn=0;tn<hr;++tn)H[Gr++]=Le[Ur*$r+cr*tn+kr]}function G(H,Le,ot,hr){var Ur=0,cr={};function kr(Nt){this.id=Ur++,this.buffer=H.createBuffer(),this.type=Nt,this.usage=pf,this.byteLength=0,this.dimension=1,this.dtype=gl,this.persistentData=null,ot.profile&&(this.stats={size:0})}kr.prototype.bind=function(){H.bindBuffer(this.type,this.buffer)},kr.prototype.destroy=function(){In(this)};var Gr=[];function $r(Nt,yr){var en=Gr.pop();return en||(en=new kr(Nt)),en.bind(),pn(en,yr,Wf,0,1,!1),en}function tn(Nt){Gr.push(Nt)}function hn(Nt,yr,en){Nt.byteLength=yr.byteLength,H.bufferData(Nt.type,yr,en)}function pn(Nt,yr,en,Pn,Zr,yn){var Nn;if(Nt.usage=en,Array.isArray(yr)){if(Nt.dtype=Pn||Ac,yr.length>0){var Ti;if(Array.isArray(yr[0])){Nn=Ju(yr);for(var Ir=1,Fr=1;Fr<Nn.length;++Fr)Ir*=Nn[Fr];Nt.dimension=Ir,Ti=Sh(yr,Nn,Nt.dtype),hn(Nt,Ti,en),yn?Nt.persistentData=Ti:rr.freeType(Ti)}else if(typeof yr[0]=="number"){Nt.dimension=Zr;var ii=rr.allocType(Nt.dtype,yr.length);E(ii,yr),hn(Nt,ii,en),yn?Nt.persistentData=ii:rr.freeType(ii)}else ge(yr[0])?(Nt.dimension=yr[0].length,Nt.dtype=Pn||df(yr[0])||Ac,Ti=Sh(yr,[yr.length,yr[0].length],Nt.dtype),hn(Nt,Ti,en),yn?Nt.persistentData=Ti:rr.freeType(Ti)):j.raise("invalid buffer data")}}else if(ge(yr))Nt.dtype=Pn||df(yr),Nt.dimension=Zr,hn(Nt,yr,en),yn&&(Nt.persistentData=new Uint8Array(new Uint8Array(yr.buffer)));else if(Vo(yr)){Nn=yr.shape;var Ln=yr.stride,nn=yr.offset,zn=0,Mn=0,ca=0,Gi=0;Nn.length===1?(zn=Nn[0],Mn=1,ca=Ln[0],Gi=0):Nn.length===2?(zn=Nn[0],Mn=Nn[1],ca=Ln[0],Gi=Ln[1]):j.raise("invalid shape"),Nt.dtype=Pn||df(yr.data)||Ac,Nt.dimension=Mn;var Rn=rr.allocType(Nt.dtype,zn*Mn);P(Rn,yr.data,zn,Mn,ca,Gi,nn),hn(Nt,Rn,en),yn?Nt.persistentData=Rn:rr.freeType(Rn)}else yr instanceof ArrayBuffer?(Nt.dtype=gl,Nt.dimension=Zr,hn(Nt,yr,en),yn&&(Nt.persistentData=new Uint8Array(new Uint8Array(yr)))):j.raise("invalid buffer data")}function In(Nt){Le.bufferCount--,hr(Nt);var yr=Nt.buffer;j(yr,"buffer must not be deleted already"),H.deleteBuffer(yr),Nt.buffer=null,delete cr[Nt.id]}function rn(Nt,yr,en,Pn){Le.bufferCount++;var Zr=new kr(yr);cr[Zr.id]=Zr;function yn(Ir){var Fr=pf,ii=null,Ln=0,nn=0,zn=1;return Array.isArray(Ir)||ge(Ir)||Vo(Ir)||Ir instanceof ArrayBuffer?ii=Ir:typeof Ir=="number"?Ln=Ir|0:Ir&&(j.type(Ir,"object","buffer arguments must be an object, a number or an array"),"data"in Ir&&(j(ii===null||Array.isArray(ii)||ge(ii)||Vo(ii),"invalid data for buffer"),ii=Ir.data),"usage"in Ir&&(j.parameter(Ir.usage,As,"invalid buffer usage"),Fr=As[Ir.usage]),"type"in Ir&&(j.parameter(Ir.type,xu,"invalid buffer type"),nn=xu[Ir.type]),"dimension"in Ir&&(j.type(Ir.dimension,"number","invalid dimension"),zn=Ir.dimension|0),"length"in Ir&&(j.nni(Ln,"buffer length must be a nonnegative integer"),Ln=Ir.length|0)),Zr.bind(),ii?pn(Zr,ii,Fr,nn,zn,Pn):(Ln&&H.bufferData(Zr.type,Ln,Fr),Zr.dtype=nn||gl,Zr.usage=Fr,Zr.dimension=zn,Zr.byteLength=Ln),ot.profile&&(Zr.stats.size=Zr.byteLength*yl[Zr.dtype]),yn}function Nn(Ir,Fr){j(Fr+Ir.byteLength<=Zr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Ir.byteLength+" starting from offset "+Fr+" to a buffer of size "+Zr.byteLength),H.bufferSubData(Zr.type,Fr,Ir)}function Ti(Ir,Fr){var ii=(Fr||0)|0,Ln;if(Zr.bind(),ge(Ir)||Ir instanceof ArrayBuffer)Nn(Ir,ii);else if(Array.isArray(Ir)){if(Ir.length>0)if(typeof Ir[0]=="number"){var nn=rr.allocType(Zr.dtype,Ir.length);E(nn,Ir),Nn(nn,ii),rr.freeType(nn)}else if(Array.isArray(Ir[0])||ge(Ir[0])){Ln=Ju(Ir);var zn=Sh(Ir,Ln,Zr.dtype);Nn(zn,ii),rr.freeType(zn)}else j.raise("invalid buffer data")}else if(Vo(Ir)){Ln=Ir.shape;var Mn=Ir.stride,ca=0,Gi=0,Rn=0,Fn=0;Ln.length===1?(ca=Ln[0],Gi=1,Rn=Mn[0],Fn=0):Ln.length===2?(ca=Ln[0],Gi=Ln[1],Rn=Mn[0],Fn=Mn[1]):j.raise("invalid shape");var Pi=Array.isArray(Ir.data)?Zr.dtype:df(Ir.data),ta=rr.allocType(Pi,ca*Gi);P(ta,Ir.data,ca,Gi,Rn,Fn,Ir.offset),Nn(ta,ii),rr.freeType(ta)}else j.raise("invalid data for buffer subdata");return yn}return en||yn(Nt),yn._reglType="buffer",yn._buffer=Zr,yn.subdata=Ti,ot.profile&&(yn.stats=Zr.stats),yn.destroy=function(){In(Zr)},yn}function cn(){me(cr).forEach(function(Nt){Nt.buffer=H.createBuffer(),H.bindBuffer(Nt.type,Nt.buffer),H.bufferData(Nt.type,Nt.persistentData||Nt.byteLength,Nt.usage)})}return ot.profile&&(Le.getTotalBufferSize=function(){var Nt=0;return Object.keys(cr).forEach(function(yr){Nt+=cr[yr].stats.size}),Nt}),{create:rn,createStream:$r,destroyStream:tn,clear:function(){me(cr).forEach(In),Gr.forEach(In)},getBuffer:function(Nt){return Nt&&Nt._buffer instanceof kr?Nt._buffer:null},restore:cn,_initBuffer:pn}}var D=0,oe=0,Fe=1,vt=1,Mt=4,Dt=4,Nr={points:D,point:oe,lines:Fe,line:vt,triangles:Mt,triangle:Dt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Xr=0,Qn=1,Ki=4,ji=5120,pa=5121,Ka=5122,yo=5123,wa=5124,Xs=5125,Bl=34963,Yc=35040,qc=35044;function wc(H,Le,ot,hr){var Ur={},cr=0,kr={uint8:pa,uint16:yo};Le.oes_element_index_uint&&(kr.uint32=Xs);function Gr(cn){this.id=cr++,Ur[this.id]=this,this.buffer=cn,this.primType=Ki,this.vertCount=0,this.type=0}Gr.prototype.bind=function(){this.buffer.bind()};var $r=[];function tn(cn){var Nt=$r.pop();return Nt||(Nt=new Gr(ot.create(null,Bl,!0,!1)._buffer)),pn(Nt,cn,Yc,-1,-1,0,0),Nt}function hn(cn){$r.push(cn)}function pn(cn,Nt,yr,en,Pn,Zr,yn){cn.buffer.bind();var Nn;if(Nt){var Ti=yn;!yn&&(!ge(Nt)||Vo(Nt)&&!ge(Nt.data))&&(Ti=Le.oes_element_index_uint?Xs:yo),ot._initBuffer(cn.buffer,Nt,yr,Ti,3)}else H.bufferData(Bl,Zr,yr),cn.buffer.dtype=Nn||pa,cn.buffer.usage=yr,cn.buffer.dimension=3,cn.buffer.byteLength=Zr;if(Nn=yn,!yn){switch(cn.buffer.dtype){case pa:case ji:Nn=pa;break;case yo:case Ka:Nn=yo;break;case Xs:case wa:Nn=Xs;break;default:j.raise("unsupported type for element array")}cn.buffer.dtype=Nn}cn.type=Nn,j(Nn!==Xs||!!Le.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Ir=Pn;Ir<0&&(Ir=cn.buffer.byteLength,Nn===yo?Ir>>=1:Nn===Xs&&(Ir>>=2)),cn.vertCount=Ir;var Fr=en;if(en<0){Fr=Ki;var ii=cn.buffer.dimension;ii===1&&(Fr=Xr),ii===2&&(Fr=Qn),ii===3&&(Fr=Ki)}cn.primType=Fr}function In(cn){hr.elementsCount--,j(cn.buffer!==null,"must not double destroy elements"),delete Ur[cn.id],cn.buffer.destroy(),cn.buffer=null}function rn(cn,Nt){var yr=ot.create(null,Bl,!0),en=new Gr(yr._buffer);hr.elementsCount++;function Pn(Zr){if(!Zr)yr(),en.primType=Ki,en.vertCount=0,en.type=pa;else if(typeof Zr=="number")yr(Zr),en.primType=Ki,en.vertCount=Zr|0,en.type=pa;else{var yn=null,Nn=qc,Ti=-1,Ir=-1,Fr=0,ii=0;Array.isArray(Zr)||ge(Zr)||Vo(Zr)?yn=Zr:(j.type(Zr,"object","invalid arguments for elements"),"data"in Zr&&(yn=Zr.data,j(Array.isArray(yn)||ge(yn)||Vo(yn),"invalid data for element buffer")),"usage"in Zr&&(j.parameter(Zr.usage,As,"invalid element buffer usage"),Nn=As[Zr.usage]),"primitive"in Zr&&(j.parameter(Zr.primitive,Nr,"invalid element buffer primitive"),Ti=Nr[Zr.primitive]),"count"in Zr&&(j(typeof Zr.count=="number"&&Zr.count>=0,"invalid vertex count for elements"),Ir=Zr.count|0),"type"in Zr&&(j.parameter(Zr.type,kr,"invalid buffer type"),ii=kr[Zr.type]),"length"in Zr?Fr=Zr.length|0:(Fr=Ir,ii===yo||ii===Ka?Fr*=2:(ii===Xs||ii===wa)&&(Fr*=4))),pn(en,yn,Nn,Ti,Ir,Fr,ii)}return Pn}return Pn(cn),Pn._reglType="elements",Pn._elements=en,Pn.subdata=function(Zr,yn){return yr.subdata(Zr,yn),Pn},Pn.destroy=function(){In(en)},Pn}return{create:rn,createStream:tn,destroyStream:hn,getElements:function(cn){return typeof cn=="function"&&cn._elements instanceof Gr?cn._elements:null},clear:function(){me(Ur).forEach(In)}}}var Tc=new Float32Array(1),Mu=new Uint32Array(Tc.buffer),Nl=5123;function _l(H){for(var Le=rr.allocType(Nl,H.length),ot=0;ot<H.length;++ot)if(isNaN(H[ot]))Le[ot]=65535;else if(H[ot]===Infinity)Le[ot]=31744;else if(H[ot]===-Infinity)Le[ot]=64512;else{Tc[0]=H[ot];var hr=Mu[0],Ur=hr>>>31<<15,cr=(hr<<1>>>24)-127,kr=hr>>13&(1<<10)-1;if(cr<-24)Le[ot]=Ur;else if(cr<-14){var Gr=-14-cr;Le[ot]=Ur+(kr+(1<<10)>>Gr)}else cr>15?Le[ot]=Ur+31744:Le[ot]=Ur+(cr+15<<10)+kr}return Le}function Go(H){return Array.isArray(H)||ge(H)}var Ah=function(H){return!(H&H-1)&&!!H},wh=34467,bu=3553,Yh=34067,zl=34069,el=6408,Ul=6406,xl=6407,lo=6409,tl=6410,Xf=32854,ju=32855,xp=36194,e0=32819,$p=32820,Th=33635,vf=34042,mf=6402,Mc=34041,gf=35904,Jl=35906,yf=36193,ec=33776,uu=33777,Yf=33778,tc=33779,qh=35986,Ic=35987,rc=34798,rl=35840,_f=35841,kc=35842,bp=35843,xf=36196,nc=5121,$h=5123,bf=5125,Ef=5126,Kp=10242,Qp=10243,Mh=10497,$c=33071,Eu=33648,Kc=10240,Ui=10241,Cf=9728,Sf=9729,bl=9984,Sa=9985,_o=9986,lu=9987,Mo=33170,Iu=4352,Zl=4353,cu=4354,Jp=34046,qf=3317,Af=37440,Vl=37441,ms=37443,nl=37444,$f=33984,Ho=[bl,_o,Sa,lu],ri=[0,lo,tl,xl,el],ma={};ma[lo]=ma[Ul]=ma[mf]=1,ma[Mc]=ma[tl]=2,ma[xl]=ma[gf]=3,ma[el]=ma[Jl]=4;function Pc(H){return"[object "+H+"]"}var wf=Pc("HTMLCanvasElement"),ku=Pc("OffscreenCanvas"),Pu=Pc("CanvasRenderingContext2D"),Lc=Pc("ImageBitmap"),Tn=Pc("HTMLImageElement"),Rc=Pc("HTMLVideoElement"),Ih=Object.keys(Oa).concat([wf,ku,Pu,Lc,Tn,Rc]),_a=[];_a[nc]=1,_a[Ef]=4,_a[yf]=2,_a[$h]=2,_a[bf]=4;var ho=[];ho[Xf]=2,ho[ju]=2,ho[xp]=2,ho[Mc]=4,ho[ec]=.5,ho[uu]=.5,ho[Yf]=1,ho[tc]=1,ho[qh]=.5,ho[Ic]=1,ho[rc]=1,ho[rl]=.5,ho[_f]=.25,ho[kc]=.5,ho[bp]=.25,ho[xf]=.5;function fu(H){return Array.isArray(H)&&(H.length===0||typeof H[0]=="number")}function kh(H){if(!Array.isArray(H))return!1;var Le=H.length;return!(Le===0||!Go(H[0]))}function il(H){return Object.prototype.toString.call(H)}function tu(H){return il(H)===wf}function jl(H){return il(H)===ku}function di(H){return il(H)===Pu}function Kf(H){return il(H)===Lc}function Ep(H){return il(H)===Tn}function Cp(H){return il(H)===Rc}function al(H){var Le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Le&&H&&H.getContext)}function Ys(H){var Le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Le&&H&&"src"in H&&"crossOrigin"in H)}function la(H){if(!H)return!1;if(al(H)||Ys(H))return!0;var Le=il(H);return Ih.indexOf(Le)>=0?!0:fu(H)||kh(H)||Vo(H)}function El(H){return Oa[Object.prototype.toString.call(H)]|0}function hu(H,Le){var ot=Le.length;switch(H.type){case nc:case $h:case bf:case Ef:var hr=rr.allocType(H.type,ot);hr.set(Le),H.data=hr;break;case yf:H.data=_l(Le);break;default:j.raise("unsupported texture type, must specify a typed array")}}function ws(H,Le){return rr.allocType(H.type===yf?Ef:H.type,Le)}function Tf(H,Le){H.type===yf?(H.data=_l(Le),rr.freeType(Le)):H.data=Le}function Gl(H,Le,ot,hr,Ur,cr){for(var kr=H.width,Gr=H.height,$r=H.channels,tn=kr*Gr*$r,hn=ws(H,tn),pn=0,In=0;In<Gr;++In)for(var rn=0;rn<kr;++rn)for(var cn=0;cn<$r;++cn)hn[pn++]=Le[ot*rn+hr*In+Ur*cn+cr];Tf(H,hn)}function ol(H,Le,ot,hr,Ur,cr){var kr;if(typeof ho[H]!="undefined"?kr=ho[H]:kr=ma[H]*_a[Le],cr&&(kr*=6),Ur){for(var Gr=0,$r=ot;$r>=1;)Gr+=kr*$r*$r,$r/=2;return Gr}else return kr*ot*hr}function pu(H,Le,ot,hr,Ur,cr,kr){var Gr={"don't care":Iu,"dont care":Iu,nice:cu,fast:Zl},$r={repeat:Mh,clamp:$c,mirror:Eu},tn={nearest:Cf,linear:Sf},hn=y({mipmap:lu,"nearest mipmap nearest":bl,"linear mipmap nearest":Sa,"nearest mipmap linear":_o,"linear mipmap linear":lu},tn),pn={none:0,browser:nl},In={uint8:nc,rgba4:e0,rgb565:Th,"rgb5 a1":$p},rn={alpha:Ul,luminance:lo,"luminance alpha":tl,rgb:xl,rgba:el,rgba4:Xf,"rgb5 a1":ju,rgb565:xp},cn={};Le.ext_srgb&&(rn.srgb=gf,rn.srgba=Jl),Le.oes_texture_float&&(In.float32=In.float=Ef),Le.oes_texture_half_float&&(In.float16=In["half float"]=yf),Le.webgl_depth_texture&&(y(rn,{depth:mf,"depth stencil":Mc}),y(In,{uint16:$h,uint32:bf,"depth stencil":vf})),Le.webgl_compressed_texture_s3tc&&y(cn,{"rgb s3tc dxt1":ec,"rgba s3tc dxt1":uu,"rgba s3tc dxt3":Yf,"rgba s3tc dxt5":tc}),Le.webgl_compressed_texture_atc&&y(cn,{"rgb atc":qh,"rgba atc explicit alpha":Ic,"rgba atc interpolated alpha":rc}),Le.webgl_compressed_texture_pvrtc&&y(cn,{"rgb pvrtc 4bppv1":rl,"rgb pvrtc 2bppv1":_f,"rgba pvrtc 4bppv1":kc,"rgba pvrtc 2bppv1":bp}),Le.webgl_compressed_texture_etc1&&(cn["rgb etc1"]=xf);var Nt=Array.prototype.slice.call(H.getParameter(wh)||new Uint32Array(0));Object.keys(cn).forEach(function($e){var dr=cn[$e];Nt.indexOf(dr)>=0&&(rn[$e]=dr)});var yr=Object.keys(rn);ot.textureFormats=yr;var en=[];Object.keys(rn).forEach(function($e){var dr=rn[$e];en[dr]=$e});var Pn=[];Object.keys(In).forEach(function($e){var dr=In[$e];Pn[dr]=$e});var Zr=[];Object.keys(tn).forEach(function($e){var dr=tn[$e];Zr[dr]=$e});var yn=[];Object.keys(hn).forEach(function($e){var dr=hn[$e];yn[dr]=$e});var Nn=[];Object.keys($r).forEach(function($e){var dr=$r[$e];Nn[dr]=$e});var Ti=yr.reduce(function($e,dr){var Xt=rn[dr];return Xt===lo||Xt===Ul||Xt===lo||Xt===tl||Xt===mf||Xt===Mc||Le.ext_srgb&&(Xt===gf||Xt===Jl)?$e[Xt]=Xt:Xt===ju||dr.indexOf("rgba")>=0?$e[Xt]=el:$e[Xt]=xl,$e},{});function Ir(){this.internalformat=el,this.format=el,this.type=nc,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=nl,this.width=0,this.height=0,this.channels=0}function Fr($e,dr){$e.internalformat=dr.internalformat,$e.format=dr.format,$e.type=dr.type,$e.compressed=dr.compressed,$e.premultiplyAlpha=dr.premultiplyAlpha,$e.flipY=dr.flipY,$e.unpackAlignment=dr.unpackAlignment,$e.colorSpace=dr.colorSpace,$e.width=dr.width,$e.height=dr.height,$e.channels=dr.channels}function ii($e,dr){if(!(typeof dr!="object"||!dr)){if("premultiplyAlpha"in dr&&(j.type(dr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),$e.premultiplyAlpha=dr.premultiplyAlpha),"flipY"in dr&&(j.type(dr.flipY,"boolean","invalid texture flip"),$e.flipY=dr.flipY),"alignment"in dr&&(j.oneOf(dr.alignment,[1,2,4,8],"invalid texture unpack alignment"),$e.unpackAlignment=dr.alignment),"colorSpace"in dr&&(j.parameter(dr.colorSpace,pn,"invalid colorSpace"),$e.colorSpace=pn[dr.colorSpace]),"type"in dr){var Xt=dr.type;j(Le.oes_texture_float||!(Xt==="float"||Xt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),j(Le.oes_texture_half_float||!(Xt==="half float"||Xt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),j(Le.webgl_depth_texture||!(Xt==="uint16"||Xt==="uint32"||Xt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),j.parameter(Xt,In,"invalid texture type"),$e.type=In[Xt]}var Jn=$e.width,Ia=$e.height,Ze=$e.channels,Ce=!1;"shape"in dr?(j(Array.isArray(dr.shape)&&dr.shape.length>=2,"shape must be an array"),Jn=dr.shape[0],Ia=dr.shape[1],dr.shape.length===3&&(Ze=dr.shape[2],j(Ze>0&&Ze<=4,"invalid number of channels"),Ce=!0),j(Jn>=0&&Jn<=ot.maxTextureSize,"invalid width"),j(Ia>=0&&Ia<=ot.maxTextureSize,"invalid height")):("radius"in dr&&(Jn=Ia=dr.radius,j(Jn>=0&&Jn<=ot.maxTextureSize,"invalid radius")),"width"in dr&&(Jn=dr.width,j(Jn>=0&&Jn<=ot.maxTextureSize,"invalid width")),"height"in dr&&(Ia=dr.height,j(Ia>=0&&Ia<=ot.maxTextureSize,"invalid height")),"channels"in dr&&(Ze=dr.channels,j(Ze>0&&Ze<=4,"invalid number of channels"),Ce=!0)),$e.width=Jn|0,$e.height=Ia|0,$e.channels=Ze|0;var ht=!1;if("format"in dr){var Vt=dr.format;j(Le.webgl_depth_texture||!(Vt==="depth"||Vt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),j.parameter(Vt,rn,"invalid texture format");var or=$e.internalformat=rn[Vt];$e.format=Ti[or],Vt in In&&("type"in dr||($e.type=In[Vt])),Vt in cn&&($e.compressed=!0),ht=!0}!Ce&&ht?$e.channels=ma[$e.format]:Ce&&!ht?$e.channels!==ri[$e.format]&&($e.format=$e.internalformat=ri[$e.channels]):ht&&Ce&&j($e.channels===ma[$e.format],"number of channels inconsistent with specified format")}}function Ln($e){H.pixelStorei(Af,$e.flipY),H.pixelStorei(Vl,$e.premultiplyAlpha),H.pixelStorei(ms,$e.colorSpace),H.pixelStorei(qf,$e.unpackAlignment)}function nn(){Ir.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function zn($e,dr){var Xt=null;if(la(dr)?Xt=dr:dr&&(j.type(dr,"object","invalid pixel data type"),ii($e,dr),"x"in dr&&($e.xOffset=dr.x|0),"y"in dr&&($e.yOffset=dr.y|0),la(dr.data)&&(Xt=dr.data)),j(!$e.compressed||Xt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),dr.copy){j(!Xt,"can not specify copy and data field for the same texture");var Jn=Ur.viewportWidth,Ia=Ur.viewportHeight;$e.width=$e.width||Jn-$e.xOffset,$e.height=$e.height||Ia-$e.yOffset,$e.needsCopy=!0,j($e.xOffset>=0&&$e.xOffset<Jn&&$e.yOffset>=0&&$e.yOffset<Ia&&$e.width>0&&$e.width<=Jn&&$e.height>0&&$e.height<=Ia,"copy texture read out of bounds")}else if(!Xt)$e.width=$e.width||1,$e.height=$e.height||1,$e.channels=$e.channels||4;else if(ge(Xt))$e.channels=$e.channels||4,$e.data=Xt,!("type"in dr)&&$e.type===nc&&($e.type=El(Xt));else if(fu(Xt))$e.channels=$e.channels||4,hu($e,Xt),$e.alignment=1,$e.needsFree=!0;else if(Vo(Xt)){var Ze=Xt.data;!Array.isArray(Ze)&&$e.type===nc&&($e.type=El(Ze));var Ce=Xt.shape,ht=Xt.stride,Vt,or,gt,it,wt,Re;Ce.length===3?(gt=Ce[2],Re=ht[2]):(j(Ce.length===2,"invalid ndarray pixel data, must be 2 or 3D"),gt=1,Re=1),Vt=Ce[0],or=Ce[1],it=ht[0],wt=ht[1],$e.alignment=1,$e.width=Vt,$e.height=or,$e.channels=gt,$e.format=$e.internalformat=ri[gt],$e.needsFree=!0,Gl($e,Ze,it,wt,Re,Xt.offset)}else if(al(Xt)||tu(Xt)||jl(Xt)||di(Xt))al(Xt)||tu(Xt)||jl(Xt)?$e.element=Xt:$e.element=Xt.canvas,$e.width=$e.element.width,$e.height=$e.element.height,$e.channels=4;else if(Kf(Xt))$e.element=Xt,$e.width=Xt.width,$e.height=Xt.height,$e.channels=4;else if(Ep(Xt))$e.element=Xt,$e.width=Xt.naturalWidth,$e.height=Xt.naturalHeight,$e.channels=4;else if(Ys(Xt))$e.element=Xt,$e.width=Xt.width,$e.height=Xt.height,$e.channels=4;else if(Cp(Xt))$e.element=Xt,$e.width=Xt.videoWidth,$e.height=Xt.videoHeight,$e.channels=4;else if(kh(Xt)){var ft=$e.width||Xt[0].length,je=$e.height||Xt.length,zt=$e.channels;Go(Xt[0][0])?zt=zt||Xt[0][0].length:zt=zt||1;for(var $t=De.shape(Xt),Vr=1,En=0;En<$t.length;++En)Vr*=$t[En];var sn=ws($e,Vr);De.flatten(Xt,$t,"",sn),Tf($e,sn),$e.alignment=1,$e.width=ft,$e.height=je,$e.channels=zt,$e.format=$e.internalformat=ri[zt],$e.needsFree=!0}$e.type===Ef?j(ot.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):$e.type===yf&&j(ot.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Mn($e,dr,Xt){var Jn=$e.element,Ia=$e.data,Ze=$e.internalformat,Ce=$e.format,ht=$e.type,Vt=$e.width,or=$e.height;Ln($e),Jn?H.texImage2D(dr,Xt,Ce,Ce,ht,Jn):$e.compressed?H.compressedTexImage2D(dr,Xt,Ze,Vt,or,0,Ia):$e.needsCopy?(hr(),H.copyTexImage2D(dr,Xt,Ce,$e.xOffset,$e.yOffset,Vt,or,0)):H.texImage2D(dr,Xt,Ce,Vt,or,0,Ce,ht,Ia||null)}function ca($e,dr,Xt,Jn,Ia){var Ze=$e.element,Ce=$e.data,ht=$e.internalformat,Vt=$e.format,or=$e.type,gt=$e.width,it=$e.height;Ln($e),Ze?H.texSubImage2D(dr,Ia,Xt,Jn,Vt,or,Ze):$e.compressed?H.compressedTexSubImage2D(dr,Ia,Xt,Jn,ht,gt,it,Ce):$e.needsCopy?(hr(),H.copyTexSubImage2D(dr,Ia,Xt,Jn,$e.xOffset,$e.yOffset,gt,it)):H.texSubImage2D(dr,Ia,Xt,Jn,gt,it,Vt,or,Ce)}var Gi=[];function Rn(){return Gi.pop()||new nn}function Fn($e){$e.needsFree&&rr.freeType($e.data),nn.call($e),Gi.push($e)}function Pi(){Ir.call(this),this.genMipmaps=!1,this.mipmapHint=Iu,this.mipmask=0,this.images=Array(16)}function ta($e,dr,Xt){var Jn=$e.images[0]=Rn();$e.mipmask=1,Jn.width=$e.width=dr,Jn.height=$e.height=Xt,Jn.channels=$e.channels=4}function Ta($e,dr){var Xt=null;if(la(dr))Xt=$e.images[0]=Rn(),Fr(Xt,$e),zn(Xt,dr),$e.mipmask=1;else if(ii($e,dr),Array.isArray(dr.mipmap))for(var Jn=dr.mipmap,Ia=0;Ia<Jn.length;++Ia)Xt=$e.images[Ia]=Rn(),Fr(Xt,$e),Xt.width>>=Ia,Xt.height>>=Ia,zn(Xt,Jn[Ia]),$e.mipmask|=1<<Ia;else Xt=$e.images[0]=Rn(),Fr(Xt,$e),zn(Xt,dr),$e.mipmask=1;Fr($e,$e.images[0]),$e.compressed&&($e.internalformat===ec||$e.internalformat===uu||$e.internalformat===Yf||$e.internalformat===tc)&&j($e.width%4==0&&$e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function qo($e,dr){for(var Xt=$e.images,Jn=0;Jn<Xt.length;++Jn){if(!Xt[Jn])return;Mn(Xt[Jn],dr,Jn)}}var $o=[];function Ca(){var $e=$o.pop()||new Pi;Ir.call($e),$e.mipmask=0;for(var dr=0;dr<16;++dr)$e.images[dr]=null;return $e}function $s($e){for(var dr=$e.images,Xt=0;Xt<dr.length;++Xt)dr[Xt]&&Fn(dr[Xt]),dr[Xt]=null;$o.push($e)}function wo(){this.minFilter=Cf,this.magFilter=Cf,this.wrapS=$c,this.wrapT=$c,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Iu}function js($e,dr){if("min"in dr){var Xt=dr.min;j.parameter(Xt,hn),$e.minFilter=hn[Xt],Ho.indexOf($e.minFilter)>=0&&!("faces"in dr)&&($e.genMipmaps=!0)}if("mag"in dr){var Jn=dr.mag;j.parameter(Jn,tn),$e.magFilter=tn[Jn]}var Ia=$e.wrapS,Ze=$e.wrapT;if("wrap"in dr){var Ce=dr.wrap;typeof Ce=="string"?(j.parameter(Ce,$r),Ia=Ze=$r[Ce]):Array.isArray(Ce)&&(j.parameter(Ce[0],$r),j.parameter(Ce[1],$r),Ia=$r[Ce[0]],Ze=$r[Ce[1]])}else{if("wrapS"in dr){var ht=dr.wrapS;j.parameter(ht,$r),Ia=$r[ht]}if("wrapT"in dr){var Vt=dr.wrapT;j.parameter(Vt,$r),Ze=$r[Vt]}}if($e.wrapS=Ia,$e.wrapT=Ze,"anisotropic"in dr){var or=dr.anisotropic;j(typeof or=="number"&&or>=1&&or<=ot.maxAnisotropic,"aniso samples must be between 1 and "),$e.anisotropic=dr.anisotropic}if("mipmap"in dr){var gt=!1;switch(typeof dr.mipmap){case"string":j.parameter(dr.mipmap,Gr,"invalid mipmap hint"),$e.mipmapHint=Gr[dr.mipmap],$e.genMipmaps=!0,gt=!0;break;case"boolean":gt=$e.genMipmaps=dr.mipmap;break;case"object":j(Array.isArray(dr.mipmap),"invalid mipmap type"),$e.genMipmaps=!1,gt=!0;break;default:j.raise("invalid mipmap type")}gt&&!("min"in dr)&&($e.minFilter=bl)}}function gs($e,dr){H.texParameteri(dr,Ui,$e.minFilter),H.texParameteri(dr,Kc,$e.magFilter),H.texParameteri(dr,Kp,$e.wrapS),H.texParameteri(dr,Qp,$e.wrapT),Le.ext_texture_filter_anisotropic&&H.texParameteri(dr,Jp,$e.anisotropic),$e.genMipmaps&&(H.hint(Mo,$e.mipmapHint),H.generateMipmap(dr))}var Ts=0,Gs={},du=ot.maxTextureUnits,Uo=Array(du).map(function(){return null});function sa($e){Ir.call(this),this.mipmask=0,this.internalformat=el,this.id=Ts++,this.refCount=1,this.target=$e,this.texture=H.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new wo,kr.profile&&(this.stats={size:0})}function Ms($e){H.activeTexture($f),H.bindTexture($e.target,$e.texture)}function Ua(){var $e=Uo[0];$e?H.bindTexture($e.target,$e.texture):H.bindTexture(bu,null)}function iu($e){var dr=$e.texture;j(dr,"must not double destroy texture");var Xt=$e.unit,Jn=$e.target;Xt>=0&&(H.activeTexture($f+Xt),H.bindTexture(Jn,null),Uo[Xt]=null),H.deleteTexture(dr),$e.texture=null,$e.params=null,$e.pixels=null,$e.refCount=0,delete Gs[$e.id],cr.textureCount--}y(sa.prototype,{bind:function(){var $e=this;$e.bindCount+=1;var dr=$e.unit;if(dr<0){for(var Xt=0;Xt<du;++Xt){var Jn=Uo[Xt];if(Jn){if(Jn.bindCount>0)continue;Jn.unit=-1}Uo[Xt]=$e,dr=Xt;break}dr>=du&&j.raise("insufficient number of texture units"),kr.profile&&cr.maxTextureUnits<dr+1&&(cr.maxTextureUnits=dr+1),$e.unit=dr,H.activeTexture($f+dr),H.bindTexture($e.target,$e.texture)}return dr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&iu(this)}});function Yi($e,dr){var Xt=new sa(bu);Gs[Xt.id]=Xt,cr.textureCount++;function Jn(Ce,ht){var Vt=Xt.texInfo;wo.call(Vt);var or=Ca();return typeof Ce=="number"?typeof ht=="number"?ta(or,Ce|0,ht|0):ta(or,Ce|0,Ce|0):Ce?(j.type(Ce,"object","invalid arguments to regl.texture"),js(Vt,Ce),Ta(or,Ce)):ta(or,1,1),Vt.genMipmaps&&(or.mipmask=(or.width<<1)-1),Xt.mipmask=or.mipmask,Fr(Xt,or),j.texture2D(Vt,or,ot),Xt.internalformat=or.internalformat,Jn.width=or.width,Jn.height=or.height,Ms(Xt),qo(or,bu),gs(Vt,bu),Ua(),$s(or),kr.profile&&(Xt.stats.size=ol(Xt.internalformat,Xt.type,or.width,or.height,Vt.genMipmaps,!1)),Jn.format=en[Xt.internalformat],Jn.type=Pn[Xt.type],Jn.mag=Zr[Vt.magFilter],Jn.min=yn[Vt.minFilter],Jn.wrapS=Nn[Vt.wrapS],Jn.wrapT=Nn[Vt.wrapT],Jn}function Ia(Ce,ht,Vt,or){j(!!Ce,"must specify image data");var gt=ht|0,it=Vt|0,wt=or|0,Re=Rn();return Fr(Re,Xt),Re.width=0,Re.height=0,zn(Re,Ce),Re.width=Re.width||(Xt.width>>wt)-gt,Re.height=Re.height||(Xt.height>>wt)-it,j(Xt.type===Re.type&&Xt.format===Re.format&&Xt.internalformat===Re.internalformat,"incompatible format for texture.subimage"),j(gt>=0&&it>=0&&gt+Re.width<=Xt.width&&it+Re.height<=Xt.height,"texture.subimage write out of bounds"),j(Xt.mipmask&1<<wt,"missing mipmap data"),j(Re.data||Re.element||Re.needsCopy,"missing image data"),Ms(Xt),ca(Re,bu,gt,it,wt),Ua(),Fn(Re),Jn}function Ze(Ce,ht){var Vt=Ce|0,or=ht|0||Vt;if(Vt===Xt.width&&or===Xt.height)return Jn;Jn.width=Xt.width=Vt,Jn.height=Xt.height=or,Ms(Xt);for(var gt=0;Xt.mipmask>>gt;++gt){var it=Vt>>gt,wt=or>>gt;if(!it||!wt)break;H.texImage2D(bu,gt,Xt.format,it,wt,0,Xt.format,Xt.type,null)}return Ua(),kr.profile&&(Xt.stats.size=ol(Xt.internalformat,Xt.type,Vt,or,!1,!1)),Jn}return Jn($e,dr),Jn.subimage=Ia,Jn.resize=Ze,Jn._reglType="texture2d",Jn._texture=Xt,kr.profile&&(Jn.stats=Xt.stats),Jn.destroy=function(){Xt.decRef()},Jn}function Ma($e,dr,Xt,Jn,Ia,Ze){var Ce=new sa(Yh);Gs[Ce.id]=Ce,cr.cubeCount++;var ht=new Array(6);function Vt(it,wt,Re,ft,je,zt){var $t,Vr=Ce.texInfo;for(wo.call(Vr),$t=0;$t<6;++$t)ht[$t]=Ca();if(typeof it=="number"||!it){var En=it|0||1;for($t=0;$t<6;++$t)ta(ht[$t],En,En)}else if(typeof it=="object")if(wt)Ta(ht[0],it),Ta(ht[1],wt),Ta(ht[2],Re),Ta(ht[3],ft),Ta(ht[4],je),Ta(ht[5],zt);else if(js(Vr,it),ii(Ce,it),"faces"in it){var sn=it.faces;for(j(Array.isArray(sn)&&sn.length===6,"cube faces must be a length 6 array"),$t=0;$t<6;++$t)j(typeof sn[$t]=="object"&&!!sn[$t],"invalid input for cube map face"),Fr(ht[$t],Ce),Ta(ht[$t],sn[$t])}else for($t=0;$t<6;++$t)Ta(ht[$t],it);else j.raise("invalid arguments to cube map");for(Fr(Ce,ht[0]),j.optional(function(){ot.npotTextureCube||j(Ah(Ce.width)&&Ah(Ce.height),"your browser does not support non power or two texture dimensions")}),Vr.genMipmaps?Ce.mipmask=(ht[0].width<<1)-1:Ce.mipmask=ht[0].mipmask,j.textureCube(Ce,Vr,ht,ot),Ce.internalformat=ht[0].internalformat,Vt.width=ht[0].width,Vt.height=ht[0].height,Ms(Ce),$t=0;$t<6;++$t)qo(ht[$t],zl+$t);for(gs(Vr,Yh),Ua(),kr.profile&&(Ce.stats.size=ol(Ce.internalformat,Ce.type,Vt.width,Vt.height,Vr.genMipmaps,!0)),Vt.format=en[Ce.internalformat],Vt.type=Pn[Ce.type],Vt.mag=Zr[Vr.magFilter],Vt.min=yn[Vr.minFilter],Vt.wrapS=Nn[Vr.wrapS],Vt.wrapT=Nn[Vr.wrapT],$t=0;$t<6;++$t)$s(ht[$t]);return Vt}function or(it,wt,Re,ft,je){j(!!wt,"must specify image data"),j(typeof it=="number"&&it===(it|0)&&it>=0&&it<6,"invalid face");var zt=Re|0,$t=ft|0,Vr=je|0,En=Rn();return Fr(En,Ce),En.width=0,En.height=0,zn(En,wt),En.width=En.width||(Ce.width>>Vr)-zt,En.height=En.height||(Ce.height>>Vr)-$t,j(Ce.type===En.type&&Ce.format===En.format&&Ce.internalformat===En.internalformat,"incompatible format for texture.subimage"),j(zt>=0&&$t>=0&&zt+En.width<=Ce.width&&$t+En.height<=Ce.height,"texture.subimage write out of bounds"),j(Ce.mipmask&1<<Vr,"missing mipmap data"),j(En.data||En.element||En.needsCopy,"missing image data"),Ms(Ce),ca(En,zl+it,zt,$t,Vr),Ua(),Fn(En),Vt}function gt(it){var wt=it|0;if(wt!==Ce.width){Vt.width=Ce.width=wt,Vt.height=Ce.height=wt,Ms(Ce);for(var Re=0;Re<6;++Re)for(var ft=0;Ce.mipmask>>ft;++ft)H.texImage2D(zl+Re,ft,Ce.format,wt>>ft,wt>>ft,0,Ce.format,Ce.type,null);return Ua(),kr.profile&&(Ce.stats.size=ol(Ce.internalformat,Ce.type,Vt.width,Vt.height,!1,!0)),Vt}}return Vt($e,dr,Xt,Jn,Ia,Ze),Vt.subimage=or,Vt.resize=gt,Vt._reglType="textureCube",Vt._texture=Ce,kr.profile&&(Vt.stats=Ce.stats),Vt.destroy=function(){Ce.decRef()},Vt}function eo(){for(var $e=0;$e<du;++$e)H.activeTexture($f+$e),H.bindTexture(bu,null),Uo[$e]=null;me(Gs).forEach(iu),cr.cubeCount=0,cr.textureCount=0}kr.profile&&(cr.getTotalTextureSize=function(){var $e=0;return Object.keys(Gs).forEach(function(dr){$e+=Gs[dr].stats.size}),$e});function ys(){for(var $e=0;$e<du;++$e){var dr=Uo[$e];dr&&(dr.bindCount=0,dr.unit=-1,Uo[$e]=null)}me(Gs).forEach(function(Xt){Xt.texture=H.createTexture(),H.bindTexture(Xt.target,Xt.texture);for(var Jn=0;Jn<32;++Jn)if((Xt.mipmask&1<<Jn)!=0)if(Xt.target===bu)H.texImage2D(bu,Jn,Xt.internalformat,Xt.width>>Jn,Xt.height>>Jn,0,Xt.internalformat,Xt.type,null);else for(var Ia=0;Ia<6;++Ia)H.texImage2D(zl+Ia,Jn,Xt.internalformat,Xt.width>>Jn,Xt.height>>Jn,0,Xt.internalformat,Xt.type,null);gs(Xt.texInfo,Xt.target)})}function sf(){for(var $e=0;$e<du;++$e){var dr=Uo[$e];dr&&(dr.bindCount=0,dr.unit=-1,Uo[$e]=null),H.activeTexture($f+$e),H.bindTexture(bu,null),H.bindTexture(Yh,null)}}return{create2D:Yi,createCube:Ma,clear:eo,getTexture:function($e){return null},restore:ys,refresh:sf}}var sl=36161,_i=32854,pi=32855,Mf=36194,Os=33189,ul=36168,Yo=34041,Lu=35907,Ph=34836,Qf=34842,Qa=34843,po=[];po[_i]=2,po[pi]=2,po[Mf]=2,po[Os]=2,po[ul]=1,po[Yo]=4,po[Lu]=4,po[Ph]=16,po[Qf]=8,po[Qa]=6;function Jf(H,Le,ot){return po[H]*Le*ot}var eh=function(H,Le,ot,hr,Ur){var cr={rgba4:_i,rgb565:Mf,"rgb5 a1":pi,depth:Os,stencil:ul,"depth stencil":Yo};Le.ext_srgb&&(cr.srgba=Lu),Le.ext_color_buffer_half_float&&(cr.rgba16f=Qf,cr.rgb16f=Qa),Le.webgl_color_buffer_float&&(cr.rgba32f=Ph);var kr=[];Object.keys(cr).forEach(function(rn){var cn=cr[rn];kr[cn]=rn});var Gr=0,$r={};function tn(rn){this.id=Gr++,this.refCount=1,this.renderbuffer=rn,this.format=_i,this.width=0,this.height=0,Ur.profile&&(this.stats={size:0})}tn.prototype.decRef=function(){--this.refCount<=0&&hn(this)};function hn(rn){var cn=rn.renderbuffer;j(cn,"must not double destroy renderbuffer"),H.bindRenderbuffer(sl,null),H.deleteRenderbuffer(cn),rn.renderbuffer=null,rn.refCount=0,delete $r[rn.id],hr.renderbufferCount--}function pn(rn,cn){var Nt=new tn(H.createRenderbuffer());$r[Nt.id]=Nt,hr.renderbufferCount++;function yr(Pn,Zr){var yn=0,Nn=0,Ti=_i;if(typeof Pn=="object"&&Pn){var Ir=Pn;if("shape"in Ir){var Fr=Ir.shape;j(Array.isArray(Fr)&&Fr.length>=2,"invalid renderbuffer shape"),yn=Fr[0]|0,Nn=Fr[1]|0}else"radius"in Ir&&(yn=Nn=Ir.radius|0),"width"in Ir&&(yn=Ir.width|0),"height"in Ir&&(Nn=Ir.height|0);"format"in Ir&&(j.parameter(Ir.format,cr,"invalid renderbuffer format"),Ti=cr[Ir.format])}else typeof Pn=="number"?(yn=Pn|0,typeof Zr=="number"?Nn=Zr|0:Nn=yn):Pn?j.raise("invalid arguments to renderbuffer constructor"):yn=Nn=1;if(j(yn>0&&Nn>0&&yn<=ot.maxRenderbufferSize&&Nn<=ot.maxRenderbufferSize,"invalid renderbuffer size"),!(yn===Nt.width&&Nn===Nt.height&&Ti===Nt.format))return yr.width=Nt.width=yn,yr.height=Nt.height=Nn,Nt.format=Ti,H.bindRenderbuffer(sl,Nt.renderbuffer),H.renderbufferStorage(sl,Ti,yn,Nn),j(H.getError()===0,"invalid render buffer format"),Ur.profile&&(Nt.stats.size=Jf(Nt.format,Nt.width,Nt.height)),yr.format=kr[Nt.format],yr}function en(Pn,Zr){var yn=Pn|0,Nn=Zr|0||yn;return yn===Nt.width&&Nn===Nt.height||(j(yn>0&&Nn>0&&yn<=ot.maxRenderbufferSize&&Nn<=ot.maxRenderbufferSize,"invalid renderbuffer size"),yr.width=Nt.width=yn,yr.height=Nt.height=Nn,H.bindRenderbuffer(sl,Nt.renderbuffer),H.renderbufferStorage(sl,Nt.format,yn,Nn),j(H.getError()===0,"invalid render buffer format"),Ur.profile&&(Nt.stats.size=Jf(Nt.format,Nt.width,Nt.height))),yr}return yr(rn,cn),yr.resize=en,yr._reglType="renderbuffer",yr._renderbuffer=Nt,Ur.profile&&(yr.stats=Nt.stats),yr.destroy=function(){Nt.decRef()},yr}Ur.profile&&(hr.getTotalRenderbufferSize=function(){var rn=0;return Object.keys($r).forEach(function(cn){rn+=$r[cn].stats.size}),rn});function In(){me($r).forEach(function(rn){rn.renderbuffer=H.createRenderbuffer(),H.bindRenderbuffer(sl,rn.renderbuffer),H.renderbufferStorage(sl,rn.format,rn.width,rn.height)}),H.bindRenderbuffer(sl,null)}return{create:pn,clear:function(){me($r).forEach(hn)},restore:In}},Cl=36160,Sl=36161,Fs=3553,Ao=34069,ic=36064,Kh=36096,Qc=36128,th=33306,Qh=36053,ll=36054,ac=36055,Jc=36057,oc=36061,Hl=36193,Lh=5121,sc=5126,Al=6407,If=6408,Rh=6402,Gu=[Al,If],ef=[];ef[If]=4,ef[Al]=3;var c=[];c[Lh]=1,c[sc]=4,c[Hl]=2;var p=32854,f=32855,g=36194,S=33189,I=36168,R=34041,z=35907,q=34836,ne=34842,Se=34843,Me=[p,f,g,z,ne,Se,q],ye={};ye[Qh]="complete",ye[ll]="incomplete attachment",ye[Jc]="incomplete dimensions",ye[ac]="incomplete, missing attachment",ye[oc]="unsupported";function Qe(H,Le,ot,hr,Ur,cr){var kr={cur:null,next:null,dirty:!1,setFBO:null},Gr=["rgba"],$r=["rgba4","rgb565","rgb5 a1"];Le.ext_srgb&&$r.push("srgba"),Le.ext_color_buffer_half_float&&$r.push("rgba16f","rgb16f"),Le.webgl_color_buffer_float&&$r.push("rgba32f");var tn=["uint8"];Le.oes_texture_half_float&&tn.push("half float","float16"),Le.oes_texture_float&&tn.push("float","float32");function hn(nn,zn,Mn){this.target=nn,this.texture=zn,this.renderbuffer=Mn;var ca=0,Gi=0;zn?(ca=zn.width,Gi=zn.height):Mn&&(ca=Mn.width,Gi=Mn.height),this.width=ca,this.height=Gi}function pn(nn){nn&&(nn.texture&&nn.texture._texture.decRef(),nn.renderbuffer&&nn.renderbuffer._renderbuffer.decRef())}function In(nn,zn,Mn){if(!!nn)if(nn.texture){var ca=nn.texture._texture,Gi=Math.max(1,ca.width),Rn=Math.max(1,ca.height);j(Gi===zn&&Rn===Mn,"inconsistent width/height for supplied texture"),ca.refCount+=1}else{var Fn=nn.renderbuffer._renderbuffer;j(Fn.width===zn&&Fn.height===Mn,"inconsistent width/height for renderbuffer"),Fn.refCount+=1}}function rn(nn,zn){zn&&(zn.texture?H.framebufferTexture2D(Cl,nn,zn.target,zn.texture._texture.texture,0):H.framebufferRenderbuffer(Cl,nn,Sl,zn.renderbuffer._renderbuffer.renderbuffer))}function cn(nn){var zn=Fs,Mn=null,ca=null,Gi=nn;typeof nn=="object"&&(Gi=nn.data,"target"in nn&&(zn=nn.target|0)),j.type(Gi,"function","invalid attachment data");var Rn=Gi._reglType;return Rn==="texture2d"?(Mn=Gi,j(zn===Fs)):Rn==="textureCube"?(Mn=Gi,j(zn>=Ao&&zn<Ao+6,"invalid cube map target")):Rn==="renderbuffer"?(ca=Gi,zn=Sl):j.raise("invalid regl object for attachment"),new hn(zn,Mn,ca)}function Nt(nn,zn,Mn,ca,Gi){if(Mn){var Rn=hr.create2D({width:nn,height:zn,format:ca,type:Gi});return Rn._texture.refCount=0,new hn(Fs,Rn,null)}else{var Fn=Ur.create({width:nn,height:zn,format:ca});return Fn._renderbuffer.refCount=0,new hn(Sl,null,Fn)}}function yr(nn){return nn&&(nn.texture||nn.renderbuffer)}function en(nn,zn,Mn){nn&&(nn.texture?nn.texture.resize(zn,Mn):nn.renderbuffer&&nn.renderbuffer.resize(zn,Mn),nn.width=zn,nn.height=Mn)}var Pn=0,Zr={};function yn(){this.id=Pn++,Zr[this.id]=this,this.framebuffer=H.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Nn(nn){nn.colorAttachments.forEach(pn),pn(nn.depthAttachment),pn(nn.stencilAttachment),pn(nn.depthStencilAttachment)}function Ti(nn){var zn=nn.framebuffer;j(zn,"must not double destroy framebuffer"),H.deleteFramebuffer(zn),nn.framebuffer=null,cr.framebufferCount--,delete Zr[nn.id]}function Ir(nn){var zn;H.bindFramebuffer(Cl,nn.framebuffer);var Mn=nn.colorAttachments;for(zn=0;zn<Mn.length;++zn)rn(ic+zn,Mn[zn]);for(zn=Mn.length;zn<ot.maxColorAttachments;++zn)H.framebufferTexture2D(Cl,ic+zn,Fs,null,0);H.framebufferTexture2D(Cl,th,Fs,null,0),H.framebufferTexture2D(Cl,Kh,Fs,null,0),H.framebufferTexture2D(Cl,Qc,Fs,null,0),rn(Kh,nn.depthAttachment),rn(Qc,nn.stencilAttachment),rn(th,nn.depthStencilAttachment);var ca=H.checkFramebufferStatus(Cl);!H.isContextLost()&&ca!==Qh&&j.raise("framebuffer configuration not supported, status = "+ye[ca]),H.bindFramebuffer(Cl,kr.next?kr.next.framebuffer:null),kr.cur=kr.next,H.getError()}function Fr(nn,zn){var Mn=new yn;cr.framebufferCount++;function ca(Rn,Fn){var Pi;j(kr.next!==Mn,"can not update framebuffer which is currently in use");var ta=0,Ta=0,qo=!0,$o=!0,Ca=null,$s=!0,wo="rgba",js="uint8",gs=1,Ts=null,Gs=null,du=null,Uo=!1;if(typeof Rn=="number")ta=Rn|0,Ta=Fn|0||ta;else if(!Rn)ta=Ta=1;else{j.type(Rn,"object","invalid arguments for framebuffer");var sa=Rn;if("shape"in sa){var Ms=sa.shape;j(Array.isArray(Ms)&&Ms.length>=2,"invalid shape for framebuffer"),ta=Ms[0],Ta=Ms[1]}else"radius"in sa&&(ta=Ta=sa.radius),"width"in sa&&(ta=sa.width),"height"in sa&&(Ta=sa.height);("color"in sa||"colors"in sa)&&(Ca=sa.color||sa.colors,Array.isArray(Ca)&&j(Ca.length===1||Le.webgl_draw_buffers,"multiple render targets not supported")),Ca||("colorCount"in sa&&(gs=sa.colorCount|0,j(gs>0,"invalid color buffer count")),"colorTexture"in sa&&($s=!!sa.colorTexture,wo="rgba4"),"colorType"in sa&&(js=sa.colorType,$s?(j(Le.oes_texture_float||!(js==="float"||js==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),j(Le.oes_texture_half_float||!(js==="half float"||js==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):js==="half float"||js==="float16"?(j(Le.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),wo="rgba16f"):(js==="float"||js==="float32")&&(j(Le.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),wo="rgba32f"),j.oneOf(js,tn,"invalid color type")),"colorFormat"in sa&&(wo=sa.colorFormat,Gr.indexOf(wo)>=0?$s=!0:$r.indexOf(wo)>=0?$s=!1:j.optional(function(){$s?j.oneOf(sa.colorFormat,Gr,"invalid color format for texture"):j.oneOf(sa.colorFormat,$r,"invalid color format for renderbuffer")}))),("depthTexture"in sa||"depthStencilTexture"in sa)&&(Uo=!!(sa.depthTexture||sa.depthStencilTexture),j(!Uo||Le.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in sa&&(typeof sa.depth=="boolean"?qo=sa.depth:(Ts=sa.depth,$o=!1)),"stencil"in sa&&(typeof sa.stencil=="boolean"?$o=sa.stencil:(Gs=sa.stencil,qo=!1)),"depthStencil"in sa&&(typeof sa.depthStencil=="boolean"?qo=$o=sa.depthStencil:(du=sa.depthStencil,qo=!1,$o=!1))}var Ua=null,iu=null,Yi=null,Ma=null;if(Array.isArray(Ca))Ua=Ca.map(cn);else if(Ca)Ua=[cn(Ca)];else for(Ua=new Array(gs),Pi=0;Pi<gs;++Pi)Ua[Pi]=Nt(ta,Ta,$s,wo,js);j(Le.webgl_draw_buffers||Ua.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),j(Ua.length<=ot.maxColorAttachments,"too many color attachments, not supported"),ta=ta||Ua[0].width,Ta=Ta||Ua[0].height,Ts?iu=cn(Ts):qo&&!$o&&(iu=Nt(ta,Ta,Uo,"depth","uint32")),Gs?Yi=cn(Gs):$o&&!qo&&(Yi=Nt(ta,Ta,!1,"stencil","uint8")),du?Ma=cn(du):!Ts&&!Gs&&$o&&qo&&(Ma=Nt(ta,Ta,Uo,"depth stencil","depth stencil")),j(!!Ts+!!Gs+!!du<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var eo=null;for(Pi=0;Pi<Ua.length;++Pi)if(In(Ua[Pi],ta,Ta),j(!Ua[Pi]||Ua[Pi].texture&&Gu.indexOf(Ua[Pi].texture._texture.format)>=0||Ua[Pi].renderbuffer&&Me.indexOf(Ua[Pi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Pi+" is invalid"),Ua[Pi]&&Ua[Pi].texture){var ys=ef[Ua[Pi].texture._texture.format]*c[Ua[Pi].texture._texture.type];eo===null?eo=ys:j(eo===ys,"all color attachments much have the same number of bits per pixel.")}return In(iu,ta,Ta),j(!iu||iu.texture&&iu.texture._texture.format===Rh||iu.renderbuffer&&iu.renderbuffer._renderbuffer.format===S,"invalid depth attachment for framebuffer object"),In(Yi,ta,Ta),j(!Yi||Yi.renderbuffer&&Yi.renderbuffer._renderbuffer.format===I,"invalid stencil attachment for framebuffer object"),In(Ma,ta,Ta),j(!Ma||Ma.texture&&Ma.texture._texture.format===R||Ma.renderbuffer&&Ma.renderbuffer._renderbuffer.format===R,"invalid depth-stencil attachment for framebuffer object"),Nn(Mn),Mn.width=ta,Mn.height=Ta,Mn.colorAttachments=Ua,Mn.depthAttachment=iu,Mn.stencilAttachment=Yi,Mn.depthStencilAttachment=Ma,ca.color=Ua.map(yr),ca.depth=yr(iu),ca.stencil=yr(Yi),ca.depthStencil=yr(Ma),ca.width=Mn.width,ca.height=Mn.height,Ir(Mn),ca}function Gi(Rn,Fn){j(kr.next!==Mn,"can not resize a framebuffer which is currently in use");var Pi=Math.max(Rn|0,1),ta=Math.max(Fn|0||Pi,1);if(Pi===Mn.width&&ta===Mn.height)return ca;for(var Ta=Mn.colorAttachments,qo=0;qo<Ta.length;++qo)en(Ta[qo],Pi,ta);return en(Mn.depthAttachment,Pi,ta),en(Mn.stencilAttachment,Pi,ta),en(Mn.depthStencilAttachment,Pi,ta),Mn.width=ca.width=Pi,Mn.height=ca.height=ta,Ir(Mn),ca}return ca(nn,zn),y(ca,{resize:Gi,_reglType:"framebuffer",_framebuffer:Mn,destroy:function(){Ti(Mn),Nn(Mn)},use:function(Rn){kr.setFBO({framebuffer:ca},Rn)}})}function ii(nn){var zn=Array(6);function Mn(Gi){var Rn;j(zn.indexOf(kr.next)<0,"can not update framebuffer which is currently in use");var Fn={color:null},Pi=0,ta=null,Ta="rgba",qo="uint8",$o=1;if(typeof Gi=="number")Pi=Gi|0;else if(!Gi)Pi=1;else{j.type(Gi,"object","invalid arguments for framebuffer");var Ca=Gi;if("shape"in Ca){var $s=Ca.shape;j(Array.isArray($s)&&$s.length>=2,"invalid shape for framebuffer"),j($s[0]===$s[1],"cube framebuffer must be square"),Pi=$s[0]}else"radius"in Ca&&(Pi=Ca.radius|0),"width"in Ca?(Pi=Ca.width|0,"height"in Ca&&j(Ca.height===Pi,"must be square")):"height"in Ca&&(Pi=Ca.height|0);("color"in Ca||"colors"in Ca)&&(ta=Ca.color||Ca.colors,Array.isArray(ta)&&j(ta.length===1||Le.webgl_draw_buffers,"multiple render targets not supported")),ta||("colorCount"in Ca&&($o=Ca.colorCount|0,j($o>0,"invalid color buffer count")),"colorType"in Ca&&(j.oneOf(Ca.colorType,tn,"invalid color type"),qo=Ca.colorType),"colorFormat"in Ca&&(Ta=Ca.colorFormat,j.oneOf(Ca.colorFormat,Gr,"invalid color format for texture"))),"depth"in Ca&&(Fn.depth=Ca.depth),"stencil"in Ca&&(Fn.stencil=Ca.stencil),"depthStencil"in Ca&&(Fn.depthStencil=Ca.depthStencil)}var wo;if(ta)if(Array.isArray(ta))for(wo=[],Rn=0;Rn<ta.length;++Rn)wo[Rn]=ta[Rn];else wo=[ta];else{wo=Array($o);var js={radius:Pi,format:Ta,type:qo};for(Rn=0;Rn<$o;++Rn)wo[Rn]=hr.createCube(js)}for(Fn.color=Array(wo.length),Rn=0;Rn<wo.length;++Rn){var gs=wo[Rn];j(typeof gs=="function"&&gs._reglType==="textureCube","invalid cube map"),Pi=Pi||gs.width,j(gs.width===Pi&&gs.height===Pi,"invalid cube map shape"),Fn.color[Rn]={target:Ao,data:wo[Rn]}}for(Rn=0;Rn<6;++Rn){for(var Ts=0;Ts<wo.length;++Ts)Fn.color[Ts].target=Ao+Rn;Rn>0&&(Fn.depth=zn[0].depth,Fn.stencil=zn[0].stencil,Fn.depthStencil=zn[0].depthStencil),zn[Rn]?zn[Rn](Fn):zn[Rn]=Fr(Fn)}return y(Mn,{width:Pi,height:Pi,color:wo})}function ca(Gi){var Rn,Fn=Gi|0;if(j(Fn>0&&Fn<=ot.maxCubeMapSize,"invalid radius for cube fbo"),Fn===Mn.width)return Mn;var Pi=Mn.color;for(Rn=0;Rn<Pi.length;++Rn)Pi[Rn].resize(Fn);for(Rn=0;Rn<6;++Rn)zn[Rn].resize(Fn);return Mn.width=Mn.height=Fn,Mn}return Mn(nn),y(Mn,{faces:zn,resize:ca,_reglType:"framebufferCube",destroy:function(){zn.forEach(function(Gi){Gi.destroy()})}})}function Ln(){kr.cur=null,kr.next=null,kr.dirty=!0,me(Zr).forEach(function(nn){nn.framebuffer=H.createFramebuffer(),Ir(nn)})}return y(kr,{getFramebuffer:function(nn){if(typeof nn=="function"&&nn._reglType==="framebuffer"){var zn=nn._framebuffer;if(zn instanceof yn)return zn}return null},create:Fr,createCube:ii,clear:function(){me(Zr).forEach(Ti)},restore:Ln})}var qe=5126,pt=34962,Xe=34963,dt=["attributes","elements","offset","count","primitive","instances"];function Ct(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=qe,this.offset=0,this.stride=0,this.divisor=0}function Wt(H,Le,ot,hr,Ur,cr,kr){for(var Gr=ot.maxAttributes,$r=new Array(Gr),tn=0;tn<Gr;++tn)$r[tn]=new Ct;var hn=0,pn={},In={Record:Ct,scope:{},state:$r,currentVAO:null,targetVAO:null,restore:cn()?Nn:function(){},createVAO:Ti,getVAO:yr,destroyBuffer:rn,setVAO:cn()?en:Pn,clear:cn()?Zr:function(){}};function rn(Ir){for(var Fr=0;Fr<$r.length;++Fr){var ii=$r[Fr];ii.buffer===Ir&&(H.disableVertexAttribArray(Fr),ii.buffer=null)}}function cn(){return Le.oes_vertex_array_object}function Nt(){return Le.angle_instanced_arrays}function yr(Ir){return typeof Ir=="function"&&Ir._vao?Ir._vao:null}function en(Ir){if(Ir!==In.currentVAO){var Fr=cn();Ir?Fr.bindVertexArrayOES(Ir.vao):Fr.bindVertexArrayOES(null),In.currentVAO=Ir}}function Pn(Ir){if(Ir!==In.currentVAO){if(Ir)Ir.bindAttrs();else{for(var Fr=Nt(),ii=0;ii<$r.length;++ii){var Ln=$r[ii];Ln.buffer?(H.enableVertexAttribArray(ii),Ln.buffer.bind(),H.vertexAttribPointer(ii,Ln.size,Ln.type,Ln.normalized,Ln.stride,Ln.offfset),Fr&&Ln.divisor&&Fr.vertexAttribDivisorANGLE(ii,Ln.divisor)):(H.disableVertexAttribArray(ii),H.vertexAttrib4f(ii,Ln.x,Ln.y,Ln.z,Ln.w))}kr.elements?H.bindBuffer(Xe,kr.elements.buffer.buffer):H.bindBuffer(Xe,null)}In.currentVAO=Ir}}function Zr(){me(pn).forEach(function(Ir){Ir.destroy()})}function yn(){this.id=++hn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Ir=cn();Ir?this.vao=Ir.createVertexArrayOES():this.vao=null,pn[this.id]=this,this.buffers=[]}yn.prototype.bindAttrs=function(){for(var Ir=Nt(),Fr=this.attributes,ii=0;ii<Fr.length;++ii){var Ln=Fr[ii];Ln.buffer?(H.enableVertexAttribArray(ii),H.bindBuffer(pt,Ln.buffer.buffer),H.vertexAttribPointer(ii,Ln.size,Ln.type,Ln.normalized,Ln.stride,Ln.offset),Ir&&Ln.divisor&&Ir.vertexAttribDivisorANGLE(ii,Ln.divisor)):(H.disableVertexAttribArray(ii),H.vertexAttrib4f(ii,Ln.x,Ln.y,Ln.z,Ln.w))}for(var nn=Fr.length;nn<Gr;++nn)H.disableVertexAttribArray(nn);var zn=cr.getElements(this.elements);zn?H.bindBuffer(Xe,zn.buffer.buffer):H.bindBuffer(Xe,null)},yn.prototype.refresh=function(){var Ir=cn();Ir&&(Ir.bindVertexArrayOES(this.vao),this.bindAttrs(),In.currentVAO=null,Ir.bindVertexArrayOES(null))},yn.prototype.destroy=function(){if(this.vao){var Ir=cn();this===In.currentVAO&&(In.currentVAO=null,Ir.bindVertexArrayOES(null)),Ir.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),pn[this.id]&&(delete pn[this.id],hr.vaoCount-=1)};function Nn(){var Ir=cn();Ir&&me(pn).forEach(function(Fr){Fr.refresh()})}function Ti(Ir){var Fr=new yn;hr.vaoCount+=1;function ii(Ln){var nn;if(Array.isArray(Ln))nn=Ln,Fr.elements&&Fr.ownsElements&&Fr.elements.destroy(),Fr.elements=null,Fr.ownsElements=!1,Fr.offset=0,Fr.count=0,Fr.instances=-1,Fr.primitive=4;else{if(j(typeof Ln=="object","invalid arguments for create vao"),j("attributes"in Ln,"must specify attributes for vao"),Ln.elements){var zn=Ln.elements;Fr.ownsElements?typeof zn=="function"&&zn._reglType==="elements"?(Fr.elements.destroy(),Fr.ownsElements=!1):(Fr.elements(zn),Fr.ownsElements=!1):cr.getElements(Ln.elements)?(Fr.elements=Ln.elements,Fr.ownsElements=!1):(Fr.elements=cr.create(Ln.elements),Fr.ownsElements=!0)}else Fr.elements=null,Fr.ownsElements=!1;nn=Ln.attributes,Fr.offset=0,Fr.count=-1,Fr.instances=-1,Fr.primitive=4,Fr.elements&&(Fr.count=Fr.elements._elements.vertCount,Fr.primitive=Fr.elements._elements.primType),"offset"in Ln&&(Fr.offset=Ln.offset|0),"count"in Ln&&(Fr.count=Ln.count|0),"instances"in Ln&&(Fr.instances=Ln.instances|0),"primitive"in Ln&&(j(Ln.primitive in Nr,"bad primitive type: "+Ln.primitive),Fr.primitive=Nr[Ln.primitive]),j.optional(function(){for(var qo=Object.keys(Ln),$o=0;$o<qo.length;++$o)j(dt.indexOf(qo[$o])>=0,'invalid option for vao: "'+qo[$o]+'" valid options are '+dt)}),j(Array.isArray(nn),"attributes must be an array")}j(nn.length<Gr,"too many attributes"),j(nn.length>0,"must specify at least one attribute");var Mn={},ca=Fr.attributes;ca.length=nn.length;for(var Gi=0;Gi<nn.length;++Gi){var Rn=nn[Gi],Fn=ca[Gi]=new Ct,Pi=Rn.data||Rn;if(Array.isArray(Pi)||ge(Pi)||Vo(Pi)){var ta;Fr.buffers[Gi]&&(ta=Fr.buffers[Gi],ge(Pi)&&ta._buffer.byteLength>=Pi.byteLength?ta.subdata(Pi):(ta.destroy(),Fr.buffers[Gi]=null)),Fr.buffers[Gi]||(ta=Fr.buffers[Gi]=Ur.create(Rn,pt,!1,!0)),Fn.buffer=Ur.getBuffer(ta),Fn.size=Fn.buffer.dimension|0,Fn.normalized=!1,Fn.type=Fn.buffer.dtype,Fn.offset=0,Fn.stride=0,Fn.divisor=0,Fn.state=1,Mn[Gi]=1}else Ur.getBuffer(Rn)?(Fn.buffer=Ur.getBuffer(Rn),Fn.size=Fn.buffer.dimension|0,Fn.normalized=!1,Fn.type=Fn.buffer.dtype,Fn.offset=0,Fn.stride=0,Fn.divisor=0,Fn.state=1):Ur.getBuffer(Rn.buffer)?(Fn.buffer=Ur.getBuffer(Rn.buffer),Fn.size=(+Rn.size||Fn.buffer.dimension)|0,Fn.normalized=!!Rn.normalized||!1,"type"in Rn?(j.parameter(Rn.type,xu,"invalid buffer type"),Fn.type=xu[Rn.type]):Fn.type=Fn.buffer.dtype,Fn.offset=(Rn.offset||0)|0,Fn.stride=(Rn.stride||0)|0,Fn.divisor=(Rn.divisor||0)|0,Fn.state=1,j(Fn.size>=1&&Fn.size<=4,"size must be between 1 and 4"),j(Fn.offset>=0,"invalid offset"),j(Fn.stride>=0&&Fn.stride<=255,"stride must be between 0 and 255"),j(Fn.divisor>=0,"divisor must be positive"),j(!Fn.divisor||!!Le.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Rn?(j(Gi>0,"first attribute must not be a constant"),Fn.x=+Rn.x||0,Fn.y=+Rn.y||0,Fn.z=+Rn.z||0,Fn.w=+Rn.w||0,Fn.state=2):j(!1,"invalid attribute spec for location "+Gi)}for(var Ta=0;Ta<Fr.buffers.length;++Ta)!Mn[Ta]&&Fr.buffers[Ta]&&(Fr.buffers[Ta].destroy(),Fr.buffers[Ta]=null);return Fr.refresh(),ii}return ii.destroy=function(){for(var Ln=0;Ln<Fr.buffers.length;++Ln)Fr.buffers[Ln]&&Fr.buffers[Ln].destroy();Fr.buffers.length=0,Fr.ownsElements&&(Fr.elements.destroy(),Fr.elements=null,Fr.ownsElements=!1),Fr.destroy()},ii._vao=Fr,ii._reglType="vao",ii(Ir)}return In}var vr=35632,er=35633,wr=35718,Wr=35721;function bn(H,Le,ot,hr){var Ur={},cr={};function kr(Nt,yr,en,Pn){this.name=Nt,this.id=yr,this.location=en,this.info=Pn}function Gr(Nt,yr){for(var en=0;en<Nt.length;++en)if(Nt[en].id===yr.id){Nt[en].location=yr.location;return}Nt.push(yr)}function $r(Nt,yr,en){var Pn=Nt===vr?Ur:cr,Zr=Pn[yr];if(!Zr){var yn=Le.str(yr);Zr=H.createShader(Nt),H.shaderSource(Zr,yn),H.compileShader(Zr),j.shaderError(H,Zr,yn,Nt,en),Pn[yr]=Zr}return Zr}var tn={},hn=[],pn=0;function In(Nt,yr){this.id=pn++,this.fragId=Nt,this.vertId=yr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,hr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function rn(Nt,yr,en){var Pn,Zr,yn=$r(vr,Nt.fragId),Nn=$r(er,Nt.vertId),Ti=Nt.program=H.createProgram();if(H.attachShader(Ti,yn),H.attachShader(Ti,Nn),en)for(Pn=0;Pn<en.length;++Pn){var Ir=en[Pn];H.bindAttribLocation(Ti,Ir[0],Ir[1])}H.linkProgram(Ti),j.linkError(H,Ti,Le.str(Nt.fragId),Le.str(Nt.vertId),yr);var Fr=H.getProgramParameter(Ti,wr);hr.profile&&(Nt.stats.uniformsCount=Fr);var ii=Nt.uniforms;for(Pn=0;Pn<Fr;++Pn)if(Zr=H.getActiveUniform(Ti,Pn),Zr)if(Zr.size>1)for(var Ln=0;Ln<Zr.size;++Ln){var nn=Zr.name.replace("[0]","["+Ln+"]");Gr(ii,new kr(nn,Le.id(nn),H.getUniformLocation(Ti,nn),Zr))}else Gr(ii,new kr(Zr.name,Le.id(Zr.name),H.getUniformLocation(Ti,Zr.name),Zr));var zn=H.getProgramParameter(Ti,Wr);hr.profile&&(Nt.stats.attributesCount=zn);var Mn=Nt.attributes;for(Pn=0;Pn<zn;++Pn)Zr=H.getActiveAttrib(Ti,Pn),Zr&&Gr(Mn,new kr(Zr.name,Le.id(Zr.name),H.getAttribLocation(Ti,Zr.name),Zr))}hr.profile&&(ot.getMaxUniformsCount=function(){var Nt=0;return hn.forEach(function(yr){yr.stats.uniformsCount>Nt&&(Nt=yr.stats.uniformsCount)}),Nt},ot.getMaxAttributesCount=function(){var Nt=0;return hn.forEach(function(yr){yr.stats.attributesCount>Nt&&(Nt=yr.stats.attributesCount)}),Nt});function cn(){Ur={},cr={};for(var Nt=0;Nt<hn.length;++Nt)rn(hn[Nt],null,hn[Nt].attributes.map(function(yr){return[yr.location,yr.name]}))}return{clear:function(){var Nt=H.deleteShader.bind(H);me(Ur).forEach(Nt),Ur={},me(cr).forEach(Nt),cr={},hn.forEach(function(yr){H.deleteProgram(yr.program)}),hn.length=0,tn={},ot.shaderCount=0},program:function(Nt,yr,en,Pn){j.command(Nt>=0,"missing vertex shader",en),j.command(yr>=0,"missing fragment shader",en);var Zr=tn[yr];Zr||(Zr=tn[yr]={});var yn=Zr[Nt];if(yn&&(yn.refCount++,!Pn))return yn;var Nn=new In(yr,Nt);return ot.shaderCount++,rn(Nn,en,Pn),yn||(Zr[Nt]=Nn),hn.push(Nn),y(Nn,{destroy:function(){if(Nn.refCount--,Nn.refCount<=0){H.deleteProgram(Nn.program);var Ti=hn.indexOf(Nn);hn.splice(Ti,1),ot.shaderCount--}Zr[Nn.vertId].refCount<=0&&(H.deleteShader(cr[Nn.vertId]),delete cr[Nn.vertId],delete tn[Nn.fragId][Nn.vertId]),Object.keys(tn[Nn.fragId]).length||(H.deleteShader(Ur[Nn.fragId]),delete Ur[Nn.fragId],delete tn[Nn.fragId])}})},restore:cn,shader:$r,frag:-1,vert:-1}}var gn=6408,Gn=5121,xi=3333,Si=5126;function bi(H,Le,ot,hr,Ur,cr,kr){function Gr(hn){var pn;Le.next===null?(j(Ur.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),pn=Gn):(j(Le.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),pn=Le.next.colorAttachments[0].texture._texture.type,j.optional(function(){cr.oes_texture_float?(j(pn===Gn||pn===Si,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),pn===Si&&j(kr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):j(pn===Gn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var In=0,rn=0,cn=hr.framebufferWidth,Nt=hr.framebufferHeight,yr=null;ge(hn)?yr=hn:hn&&(j.type(hn,"object","invalid arguments to regl.read()"),In=hn.x|0,rn=hn.y|0,j(In>=0&&In<hr.framebufferWidth,"invalid x offset for regl.read"),j(rn>=0&&rn<hr.framebufferHeight,"invalid y offset for regl.read"),cn=(hn.width||hr.framebufferWidth-In)|0,Nt=(hn.height||hr.framebufferHeight-rn)|0,yr=hn.data||null),yr&&(pn===Gn?j(yr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):pn===Si&&j(yr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),j(cn>0&&cn+In<=hr.framebufferWidth,"invalid width for read pixels"),j(Nt>0&&Nt+rn<=hr.framebufferHeight,"invalid height for read pixels"),ot();var en=cn*Nt*4;return yr||(pn===Gn?yr=new Uint8Array(en):pn===Si&&(yr=yr||new Float32Array(en))),j.isTypedArray(yr,"data buffer for regl.read() must be a typedarray"),j(yr.byteLength>=en,"data buffer for regl.read() too small"),H.pixelStorei(xi,4),H.readPixels(In,rn,cn,Nt,gn,pn,yr),yr}function $r(hn){var pn;return Le.setFBO({framebuffer:hn.framebuffer},function(){pn=Gr(hn)}),pn}function tn(hn){return!hn||!("framebuffer"in hn)?Gr(hn):$r(hn)}return tn}function Ea(H){return Array.prototype.slice.call(H)}function Xn(H){return Ea(H).join("")}function Hi(){var H=0,Le=[],ot=[];function hr(pn){for(var In=0;In<ot.length;++In)if(ot[In]===pn)return Le[In];var rn="g"+H++;return Le.push(rn),ot.push(pn),rn}function Ur(){var pn=[];function In(){pn.push.apply(pn,Ea(arguments))}var rn=[];function cn(){var Nt="v"+H++;return rn.push(Nt),arguments.length>0&&(pn.push(Nt,"="),pn.push.apply(pn,Ea(arguments)),pn.push(";")),Nt}return y(In,{def:cn,toString:function(){return Xn([rn.length>0?"var "+rn.join(",")+";":"",Xn(pn)])}})}function cr(){var pn=Ur(),In=Ur(),rn=pn.toString,cn=In.toString;function Nt(yr,en){In(yr,en,"=",pn.def(yr,en),";")}return y(function(){pn.apply(pn,Ea(arguments))},{def:pn.def,entry:pn,exit:In,save:Nt,set:function(yr,en,Pn){Nt(yr,en),pn(yr,en,"=",Pn,";")},toString:function(){return rn()+cn()}})}function kr(){var pn=Xn(arguments),In=cr(),rn=cr(),cn=In.toString,Nt=rn.toString;return y(In,{then:function(){return In.apply(In,Ea(arguments)),this},else:function(){return rn.apply(rn,Ea(arguments)),this},toString:function(){var yr=Nt();return yr&&(yr="else{"+yr+"}"),Xn(["if(",pn,"){",cn(),"}",yr])}})}var Gr=Ur(),$r={};function tn(pn,In){var rn=[];function cn(){var Zr="a"+rn.length;return rn.push(Zr),Zr}In=In||0;for(var Nt=0;Nt<In;++Nt)cn();var yr=cr(),en=yr.toString,Pn=$r[pn]=y(yr,{arg:cn,toString:function(){return Xn(["function(",rn.join(),"){",en(),"}"])}});return Pn}function hn(){var pn=['"use strict";',Gr,"return {"];Object.keys($r).forEach(function(Nt){pn.push('"',Nt,'":',$r[Nt].toString(),",")}),pn.push("}");var In=Xn(pn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),rn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,cn=rn?He.Function.apply(null,Le.concat(In)):Function.apply(null,Le.concat(In));return cn.apply(null,ot)}return{global:Gr,link:hr,block:Ur,proc:tn,scope:cr,cond:kr,compile:hn}}var Qi="xyzw".split(""),Wi=5121,Ri=1,oa=2,Zi=0,wi=1,us=2,Wo=3,Ds=4,ls=5,co=6,Jo="dither",es="blend.enable",Bs="blend.color",uc="blend.equation",ru="blend.func",Hu="depth.enable",Cu="depth.func",kf="depth.range",lc="depth.mask",Wl="colorMask",wl="cull.enable",Pf="cull.face",cl="frontFace",cc="lineWidth",Xl="polygonOffset.enable",cs="polygonOffset.offset",Tl="sample.alpha",Oc="sample.enable",Ns="sample.coverage",Na="stencil.enable",Ru="stencil.mask",qs="stencil.func",fc="stencil.opFront",rh="stencil.opBack",Lf="scissor.enable",Sp="scissor.box",Wu="viewport",Fc="profile",Su="framebuffer",Rf="vert",nh="frag",Yl="elements",zs="primitive",Of="count",Ml="offset",Oh="instances",nu="vao",ih="Width",Ou="Height",re=Su+ih,un=Su+Ou,ah=Wu+ih,L0=Wu+Ou,Io="drawingBuffer",fl=Io+ih,oh=Io+Ou,ed=[ru,uc,qs,fc,rh,Ns,Wu,Sp,cs],Us=34962,Au=34963,Md=35632,t0=35633,Id=3553,Fh=34067,hc=2884,sh=3042,Ff=3024,fs=2960,Ap=2929,td=3089,Xi=32823,rd=32926,Dh=32928,Dc=5126,wp=35664,Il=35665,tf=35666,rf=5124,nd=35667,uh=35668,pc=35669,Tp=35670,Jh=35671,dc=35672,nf=35673,kl=35674,lh=35675,af=35676,Fu=35678,ch=35680,Mp=4,Bc=1028,of=1029,kd=2304,Df=2305,Pd=32775,vc=32776,ql=519,Zs=7680,Bf=0,Nc=1,Bh=32774,zc=513,Ip=36160,R0=36064,mc={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},fh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],hh={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Nf={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ld={frag:Md,vert:t0},id={cw:kd,ccw:Df};function Xu(H){return Array.isArray(H)||ge(H)||Vo(H)}function kp(H){return H.sort(function(Le,ot){return Le===Wu?-1:ot===Wu?1:Le<ot?-1:1})}function uo(H,Le,ot,hr){this.thisDep=H,this.contextDep=Le,this.propDep=ot,this.append=hr}function Uc(H){return H&&!(H.thisDep||H.contextDep||H.propDep)}function Ja(H){return new uo(!1,!1,!1,H)}function Vs(H,Le){var ot=H.type;if(ot===Zi){var hr=H.data.length;return new uo(!0,hr>=1,hr>=2,Le)}else if(ot===Ds){var Ur=H.data;return new uo(Ur.thisDep,Ur.contextDep,Ur.propDep,Le)}else{if(ot===ls)return new uo(!1,!1,!1,Le);if(ot===co){for(var cr=!1,kr=!1,Gr=!1,$r=0;$r<H.data.length;++$r){var tn=H.data[$r];if(tn.type===wi)Gr=!0;else if(tn.type===us)kr=!0;else if(tn.type===Wo)cr=!0;else if(tn.type===Zi){cr=!0;var hn=tn.data;hn>=1&&(kr=!0),hn>=2&&(Gr=!0)}else tn.type===Ds&&(cr=cr||tn.data.thisDep,kr=kr||tn.data.contextDep,Gr=Gr||tn.data.propDep)}return new uo(cr,kr,Gr,Le)}else return new uo(ot===Wo,ot===us,ot===wi,Le)}}var ad=new uo(!1,!1,!1,function(){});function od(H,Le,ot,hr,Ur,cr,kr,Gr,$r,tn,hn,pn,In,rn,cn){var Nt=tn.Record,yr={add:32774,subtract:32778,"reverse subtract":32779};ot.ext_blend_minmax&&(yr.min=Pd,yr.max=vc);var en=ot.angle_instanced_arrays,Pn=ot.webgl_draw_buffers,Zr=ot.oes_vertex_array_object,yn={dirty:!0,profile:cn.profile},Nn={},Ti=[],Ir={},Fr={};function ii(Ze){return Ze.replace(".","_")}function Ln(Ze,Ce,ht){var Vt=ii(Ze);Ti.push(Ze),Nn[Vt]=yn[Vt]=!!ht,Ir[Vt]=Ce}function nn(Ze,Ce,ht){var Vt=ii(Ze);Ti.push(Ze),Array.isArray(ht)?(yn[Vt]=ht.slice(),Nn[Vt]=ht.slice()):yn[Vt]=Nn[Vt]=ht,Fr[Vt]=Ce}Ln(Jo,Ff),Ln(es,sh),nn(Bs,"blendColor",[0,0,0,0]),nn(uc,"blendEquationSeparate",[Bh,Bh]),nn(ru,"blendFuncSeparate",[Nc,Bf,Nc,Bf]),Ln(Hu,Ap,!0),nn(Cu,"depthFunc",zc),nn(kf,"depthRange",[0,1]),nn(lc,"depthMask",!0),nn(Wl,Wl,[!0,!0,!0,!0]),Ln(wl,hc),nn(Pf,"cullFace",of),nn(cl,cl,Df),nn(cc,cc,1),Ln(Xl,Xi),nn(cs,"polygonOffset",[0,0]),Ln(Tl,rd),Ln(Oc,Dh),nn(Ns,"sampleCoverage",[1,!1]),Ln(Na,fs),nn(Ru,"stencilMask",-1),nn(qs,"stencilFunc",[ql,0,-1]),nn(fc,"stencilOpSeparate",[Bc,Zs,Zs,Zs]),nn(rh,"stencilOpSeparate",[of,Zs,Zs,Zs]),Ln(Lf,td),nn(Sp,"scissor",[0,0,H.drawingBufferWidth,H.drawingBufferHeight]),nn(Wu,Wu,[0,0,H.drawingBufferWidth,H.drawingBufferHeight]);var zn={gl:H,context:In,strings:Le,next:Nn,current:yn,draw:pn,elements:cr,buffer:Ur,shader:hn,attributes:tn.state,vao:tn,uniforms:$r,framebuffer:Gr,extensions:ot,timer:rn,isBufferArgs:Xu},Mn={primTypes:Nr,compareFuncs:hh,blendFuncs:mc,blendEquations:yr,stencilOps:Nf,glTypes:xu,orientationType:id};j.optional(function(){zn.isArrayLike=Go}),Pn&&(Mn.backBuffer=[of],Mn.drawBuffer=ut(hr.maxDrawbuffers,function(Ze){return Ze===0?[0]:ut(Ze,function(Ce){return R0+Ce})}));var ca=0;function Gi(){var Ze=Hi(),Ce=Ze.link,ht=Ze.global;Ze.id=ca++,Ze.batchId="0";var Vt=Ce(zn),or=Ze.shared={props:"a0"};Object.keys(zn).forEach(function(ft){or[ft]=ht.def(Vt,".",ft)}),j.optional(function(){Ze.CHECK=Ce(j),Ze.commandStr=j.guessCommand(),Ze.command=Ce(Ze.commandStr),Ze.assert=function(ft,je,zt){ft("if(!(",je,"))",this.CHECK,".commandRaise(",Ce(zt),",",this.command,");")},Mn.invalidBlendCombinations=fh});var gt=Ze.next={},it=Ze.current={};Object.keys(Fr).forEach(function(ft){Array.isArray(yn[ft])&&(gt[ft]=ht.def(or.next,".",ft),it[ft]=ht.def(or.current,".",ft))});var wt=Ze.constants={};Object.keys(Mn).forEach(function(ft){wt[ft]=ht.def(JSON.stringify(Mn[ft]))}),Ze.invoke=function(ft,je){switch(je.type){case Zi:var zt=["this",or.context,or.props,Ze.batchId];return ft.def(Ce(je.data),".call(",zt.slice(0,Math.max(je.data.length+1,4)),")");case wi:return ft.def(or.props,je.data);case us:return ft.def(or.context,je.data);case Wo:return ft.def("this",je.data);case Ds:return je.data.append(Ze,ft),je.data.ref;case ls:return je.data.toString();case co:return je.data.map(function($t){return Ze.invoke(ft,$t)})}},Ze.attribCache={};var Re={};return Ze.scopeAttrib=function(ft){var je=Le.id(ft);if(je in Re)return Re[je];var zt=tn.scope[je];zt||(zt=tn.scope[je]=new Nt);var $t=Re[je]=Ce(zt);return $t},Ze}function Rn(Ze){var Ce=Ze.static,ht=Ze.dynamic,Vt;if(Fc in Ce){var or=!!Ce[Fc];Vt=Ja(function(it,wt){return or}),Vt.enable=or}else if(Fc in ht){var gt=ht[Fc];Vt=Vs(gt,function(it,wt){return it.invoke(wt,gt)})}return Vt}function Fn(Ze,Ce){var ht=Ze.static,Vt=Ze.dynamic;if(Su in ht){var or=ht[Su];return or?(or=Gr.getFramebuffer(or),j.command(or,"invalid framebuffer object"),Ja(function(it,wt){var Re=it.link(or),ft=it.shared;wt.set(ft.framebuffer,".next",Re);var je=ft.context;return wt.set(je,"."+re,Re+".width"),wt.set(je,"."+un,Re+".height"),Re})):Ja(function(it,wt){var Re=it.shared;wt.set(Re.framebuffer,".next","null");var ft=Re.context;return wt.set(ft,"."+re,ft+"."+fl),wt.set(ft,"."+un,ft+"."+oh),"null"})}else if(Su in Vt){var gt=Vt[Su];return Vs(gt,function(it,wt){var Re=it.invoke(wt,gt),ft=it.shared,je=ft.framebuffer,zt=wt.def(je,".getFramebuffer(",Re,")");j.optional(function(){it.assert(wt,"!"+Re+"||"+zt,"invalid framebuffer object")}),wt.set(je,".next",zt);var $t=ft.context;return wt.set($t,"."+re,zt+"?"+zt+".width:"+$t+"."+fl),wt.set($t,"."+un,zt+"?"+zt+".height:"+$t+"."+oh),zt})}else return null}function Pi(Ze,Ce,ht){var Vt=Ze.static,or=Ze.dynamic;function gt(Re){if(Re in Vt){var ft=Vt[Re];j.commandType(ft,"object","invalid "+Re,ht.commandStr);var je=!0,zt=ft.x|0,$t=ft.y|0,Vr,En;return"width"in ft?(Vr=ft.width|0,j.command(Vr>=0,"invalid "+Re,ht.commandStr)):je=!1,"height"in ft?(En=ft.height|0,j.command(En>=0,"invalid "+Re,ht.commandStr)):je=!1,new uo(!je&&Ce&&Ce.thisDep,!je&&Ce&&Ce.contextDep,!je&&Ce&&Ce.propDep,function(_n,Yn){var Hn=_n.shared.context,qn=Vr;"width"in ft||(qn=Yn.def(Hn,".",re,"-",zt));var si=En;return"height"in ft||(si=Yn.def(Hn,".",un,"-",$t)),[zt,$t,qn,si]})}else if(Re in or){var sn=or[Re],jn=Vs(sn,function(_n,Yn){var Hn=_n.invoke(Yn,sn);j.optional(function(){_n.assert(Yn,Hn+"&&typeof "+Hn+'==="object"',"invalid "+Re)});var qn=_n.shared.context,si=Yn.def(Hn,".x|0"),$n=Yn.def(Hn,".y|0"),Ni=Yn.def('"width" in ',Hn,"?",Hn,".width|0:","(",qn,".",re,"-",si,")"),za=Yn.def('"height" in ',Hn,"?",Hn,".height|0:","(",qn,".",un,"-",$n,")");return j.optional(function(){_n.assert(Yn,Ni+">=0&&"+za+">=0","invalid "+Re)}),[si,$n,Ni,za]});return Ce&&(jn.thisDep=jn.thisDep||Ce.thisDep,jn.contextDep=jn.contextDep||Ce.contextDep,jn.propDep=jn.propDep||Ce.propDep),jn}else return Ce?new uo(Ce.thisDep,Ce.contextDep,Ce.propDep,function(_n,Yn){var Hn=_n.shared.context;return[0,0,Yn.def(Hn,".",re),Yn.def(Hn,".",un)]}):null}var it=gt(Wu);if(it){var wt=it;it=new uo(it.thisDep,it.contextDep,it.propDep,function(Re,ft){var je=wt.append(Re,ft),zt=Re.shared.context;return ft.set(zt,"."+ah,je[2]),ft.set(zt,"."+L0,je[3]),je})}return{viewport:it,scissor_box:gt(Sp)}}function ta(Ze,Ce){var ht=Ze.static,Vt=typeof ht[nh]=="string"&&typeof ht[Rf]=="string";if(Vt){if(Object.keys(Ce.dynamic).length>0)return null;var or=Ce.static,gt=Object.keys(or);if(gt.length>0&&typeof or[gt[0]]=="number"){for(var it=[],wt=0;wt<gt.length;++wt)j(typeof or[gt[wt]]=="number","must specify all vertex attribute locations when using vaos"),it.push([or[gt[wt]]|0,gt[wt]]);return it}}return null}function Ta(Ze,Ce,ht){var Vt=Ze.static,or=Ze.dynamic;function gt(je){if(je in Vt){var zt=Le.id(Vt[je]);j.optional(function(){hn.shader(Ld[je],zt,j.guessCommand())});var $t=Ja(function(){return zt});return $t.id=zt,$t}else if(je in or){var Vr=or[je];return Vs(Vr,function(En,sn){var jn=En.invoke(sn,Vr),_n=sn.def(En.shared.strings,".id(",jn,")");return j.optional(function(){sn(En.shared.shader,".shader(",Ld[je],",",_n,",",En.command,");")}),_n})}return null}var it=gt(nh),wt=gt(Rf),Re=null,ft;return Uc(it)&&Uc(wt)?(Re=hn.program(wt.id,it.id,null,ht),ft=Ja(function(je,zt){return je.link(Re)})):ft=new uo(it&&it.thisDep||wt&&wt.thisDep,it&&it.contextDep||wt&&wt.contextDep,it&&it.propDep||wt&&wt.propDep,function(je,zt){var $t=je.shared.shader,Vr;it?Vr=it.append(je,zt):Vr=zt.def($t,".",nh);var En;wt?En=wt.append(je,zt):En=zt.def($t,".",Rf);var sn=$t+".program("+En+","+Vr;return j.optional(function(){sn+=","+je.command}),zt.def(sn+")")}),{frag:it,vert:wt,progVar:ft,program:Re}}function qo(Ze,Ce){var ht=Ze.static,Vt=Ze.dynamic,or={},gt=!1;function it(){if(nu in ht){var Yn=ht[nu];return Yn!==null&&tn.getVAO(Yn)===null&&(Yn=tn.createVAO(Yn)),gt=!0,or.vao=Yn,Ja(function(qn){var si=tn.getVAO(Yn);return si?qn.link(si):"null"})}else if(nu in Vt){gt=!0;var Hn=Vt[nu];return Vs(Hn,function(qn,si){var $n=qn.invoke(si,Hn);return si.def(qn.shared.vao+".getVAO("+$n+")")})}return null}var wt=it(),Re=!1;function ft(){if(Yl in ht){var Yn=ht[Yl];if(or.elements=Yn,Xu(Yn)){var Hn=or.elements=cr.create(Yn,!0);Yn=cr.getElements(Hn),Re=!0}else Yn&&(Yn=cr.getElements(Yn),Re=!0,j.command(Yn,"invalid elements",Ce.commandStr));var qn=Ja(function($n,Ni){if(Yn){var za=$n.link(Yn);return $n.ELEMENTS=za,za}return $n.ELEMENTS=null,null});return qn.value=Yn,qn}else if(Yl in Vt){Re=!0;var si=Vt[Yl];return Vs(si,function($n,Ni){var za=$n.shared,Ks=za.isBufferArgs,ko=za.elements,qa=$n.invoke(Ni,si),Vc=Ni.def("null"),Du=Ni.def(Ks,"(",qa,")"),gc=$n.cond(Du).then(Vc,"=",ko,".createStream(",qa,");").else(Vc,"=",ko,".getElements(",qa,");");return j.optional(function(){$n.assert(gc.else,"!"+qa+"||"+Vc,"invalid elements")}),Ni.entry(gc),Ni.exit($n.cond(Du).then(ko,".destroyStream(",Vc,");")),$n.ELEMENTS=Vc,Vc})}else if(gt)return new uo(wt.thisDep,wt.contextDep,wt.propDep,function($n,Ni){return Ni.def($n.shared.vao+".currentVAO?"+$n.shared.elements+".getElements("+$n.shared.vao+".currentVAO.elements):null")});return null}var je=ft();function zt(){if(zs in ht){var Yn=ht[zs];return or.primitive=Yn,j.commandParameter(Yn,Nr,"invalid primitve",Ce.commandStr),Ja(function(qn,si){return Nr[Yn]})}else if(zs in Vt){var Hn=Vt[zs];return Vs(Hn,function(qn,si){var $n=qn.constants.primTypes,Ni=qn.invoke(si,Hn);return j.optional(function(){qn.assert(si,Ni+" in "+$n,"invalid primitive, must be one of "+Object.keys(Nr))}),si.def($n,"[",Ni,"]")})}else{if(Re)return Uc(je)?je.value?Ja(function(qn,si){return si.def(qn.ELEMENTS,".primType")}):Ja(function(){return Mp}):new uo(je.thisDep,je.contextDep,je.propDep,function(qn,si){var $n=qn.ELEMENTS;return si.def($n,"?",$n,".primType:",Mp)});if(gt)return new uo(wt.thisDep,wt.contextDep,wt.propDep,function(qn,si){return si.def(qn.shared.vao+".currentVAO?"+qn.shared.vao+".currentVAO.primitive:"+Mp)})}return null}function $t(Yn,Hn){if(Yn in ht){var qn=ht[Yn]|0;return Hn?or.offset=qn:or.instances=qn,j.command(!Hn||qn>=0,"invalid "+Yn,Ce.commandStr),Ja(function($n,Ni){return Hn&&($n.OFFSET=qn),qn})}else if(Yn in Vt){var si=Vt[Yn];return Vs(si,function($n,Ni){var za=$n.invoke(Ni,si);return Hn&&($n.OFFSET=za,j.optional(function(){$n.assert(Ni,za+">=0","invalid "+Yn)})),za})}else if(Hn){if(Re)return Ja(function($n,Ni){return $n.OFFSET=0,0});if(gt)return new uo(wt.thisDep,wt.contextDep,wt.propDep,function($n,Ni){return Ni.def($n.shared.vao+".currentVAO?"+$n.shared.vao+".currentVAO.offset:0")})}else if(gt)return new uo(wt.thisDep,wt.contextDep,wt.propDep,function($n,Ni){return Ni.def($n.shared.vao+".currentVAO?"+$n.shared.vao+".currentVAO.instances:-1")});return null}var Vr=$t(Ml,!0);function En(){if(Of in ht){var Yn=ht[Of]|0;return or.count=Yn,j.command(typeof Yn=="number"&&Yn>=0,"invalid vertex count",Ce.commandStr),Ja(function(){return Yn})}else if(Of in Vt){var Hn=Vt[Of];return Vs(Hn,function(Ni,za){var Ks=Ni.invoke(za,Hn);return j.optional(function(){Ni.assert(za,"typeof "+Ks+'==="number"&&'+Ks+">=0&&"+Ks+"===("+Ks+"|0)","invalid vertex count")}),Ks})}else if(Re)if(Uc(je)){if(je)return Vr?new uo(Vr.thisDep,Vr.contextDep,Vr.propDep,function(Ni,za){var Ks=za.def(Ni.ELEMENTS,".vertCount-",Ni.OFFSET);return j.optional(function(){Ni.assert(za,Ks+">=0","invalid vertex offset/element buffer too small")}),Ks}):Ja(function(Ni,za){return za.def(Ni.ELEMENTS,".vertCount")});var qn=Ja(function(){return-1});return j.optional(function(){qn.MISSING=!0}),qn}else{var si=new uo(je.thisDep||Vr.thisDep,je.contextDep||Vr.contextDep,je.propDep||Vr.propDep,function(Ni,za){var Ks=Ni.ELEMENTS;return Ni.OFFSET?za.def(Ks,"?",Ks,".vertCount-",Ni.OFFSET,":-1"):za.def(Ks,"?",Ks,".vertCount:-1")});return j.optional(function(){si.DYNAMIC=!0}),si}else if(gt){var $n=new uo(wt.thisDep,wt.contextDep,wt.propDep,function(Ni,za){return za.def(Ni.shared.vao,".currentVAO?",Ni.shared.vao,".currentVAO.count:-1")});return $n}return null}var sn=zt(),jn=En(),_n=$t(Oh,!1);return{elements:je,primitive:sn,count:jn,instances:_n,offset:Vr,vao:wt,vaoActive:gt,elementsActive:Re,static:or}}function $o(Ze,Ce){var ht=Ze.static,Vt=Ze.dynamic,or={};return Ti.forEach(function(gt){var it=ii(gt);function wt(Re,ft){if(gt in ht){var je=Re(ht[gt]);or[it]=Ja(function(){return je})}else if(gt in Vt){var zt=Vt[gt];or[it]=Vs(zt,function($t,Vr){return ft($t,Vr,$t.invoke(Vr,zt))})}}switch(gt){case wl:case es:case Jo:case Na:case Hu:case Lf:case Xl:case Tl:case Oc:case lc:return wt(function(Re){return j.commandType(Re,"boolean",gt,Ce.commandStr),Re},function(Re,ft,je){return j.optional(function(){Re.assert(ft,"typeof "+je+'==="boolean"',"invalid flag "+gt,Re.commandStr)}),je});case Cu:return wt(function(Re){return j.commandParameter(Re,hh,"invalid "+gt,Ce.commandStr),hh[Re]},function(Re,ft,je){var zt=Re.constants.compareFuncs;return j.optional(function(){Re.assert(ft,je+" in "+zt,"invalid "+gt+", must be one of "+Object.keys(hh))}),ft.def(zt,"[",je,"]")});case kf:return wt(function(Re){return j.command(Go(Re)&&Re.length===2&&typeof Re[0]=="number"&&typeof Re[1]=="number"&&Re[0]<=Re[1],"depth range is 2d array",Ce.commandStr),Re},function(Re,ft,je){j.optional(function(){Re.assert(ft,Re.shared.isArrayLike+"("+je+")&&"+je+".length===2&&typeof "+je+'[0]==="number"&&typeof '+je+'[1]==="number"&&'+je+"[0]<="+je+"[1]","depth range must be a 2d array")});var zt=ft.def("+",je,"[0]"),$t=ft.def("+",je,"[1]");return[zt,$t]});case ru:return wt(function(Re){j.commandType(Re,"object","blend.func",Ce.commandStr);var ft="srcRGB"in Re?Re.srcRGB:Re.src,je="srcAlpha"in Re?Re.srcAlpha:Re.src,zt="dstRGB"in Re?Re.dstRGB:Re.dst,$t="dstAlpha"in Re?Re.dstAlpha:Re.dst;return j.commandParameter(ft,mc,it+".srcRGB",Ce.commandStr),j.commandParameter(je,mc,it+".srcAlpha",Ce.commandStr),j.commandParameter(zt,mc,it+".dstRGB",Ce.commandStr),j.commandParameter($t,mc,it+".dstAlpha",Ce.commandStr),j.command(fh.indexOf(ft+", "+zt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+ft+", "+zt+")",Ce.commandStr),[mc[ft],mc[zt],mc[je],mc[$t]]},function(Re,ft,je){var zt=Re.constants.blendFuncs;j.optional(function(){Re.assert(ft,je+"&&typeof "+je+'==="object"',"invalid blend func, must be an object")});function $t(Hn,qn){var si=ft.def('"',Hn,qn,'" in ',je,"?",je,".",Hn,qn,":",je,".",Hn);return j.optional(function(){Re.assert(ft,si+" in "+zt,"invalid "+gt+"."+Hn+qn+", must be one of "+Object.keys(mc))}),si}var Vr=$t("src","RGB"),En=$t("dst","RGB");j.optional(function(){var Hn=Re.constants.invalidBlendCombinations;Re.assert(ft,Hn+".indexOf("+Vr+'+", "+'+En+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var sn=ft.def(zt,"[",Vr,"]"),jn=ft.def(zt,"[",$t("src","Alpha"),"]"),_n=ft.def(zt,"[",En,"]"),Yn=ft.def(zt,"[",$t("dst","Alpha"),"]");return[sn,_n,jn,Yn]});case uc:return wt(function(Re){if(typeof Re=="string")return j.commandParameter(Re,yr,"invalid "+gt,Ce.commandStr),[yr[Re],yr[Re]];if(typeof Re=="object")return j.commandParameter(Re.rgb,yr,gt+".rgb",Ce.commandStr),j.commandParameter(Re.alpha,yr,gt+".alpha",Ce.commandStr),[yr[Re.rgb],yr[Re.alpha]];j.commandRaise("invalid blend.equation",Ce.commandStr)},function(Re,ft,je){var zt=Re.constants.blendEquations,$t=ft.def(),Vr=ft.def(),En=Re.cond("typeof ",je,'==="string"');return j.optional(function(){function sn(jn,_n,Yn){Re.assert(jn,Yn+" in "+zt,"invalid "+_n+", must be one of "+Object.keys(yr))}sn(En.then,gt,je),Re.assert(En.else,je+"&&typeof "+je+'==="object"',"invalid "+gt),sn(En.else,gt+".rgb",je+".rgb"),sn(En.else,gt+".alpha",je+".alpha")}),En.then($t,"=",Vr,"=",zt,"[",je,"];"),En.else($t,"=",zt,"[",je,".rgb];",Vr,"=",zt,"[",je,".alpha];"),ft(En),[$t,Vr]});case Bs:return wt(function(Re){return j.command(Go(Re)&&Re.length===4,"blend.color must be a 4d array",Ce.commandStr),ut(4,function(ft){return+Re[ft]})},function(Re,ft,je){return j.optional(function(){Re.assert(ft,Re.shared.isArrayLike+"("+je+")&&"+je+".length===4","blend.color must be a 4d array")}),ut(4,function(zt){return ft.def("+",je,"[",zt,"]")})});case Ru:return wt(function(Re){return j.commandType(Re,"number",it,Ce.commandStr),Re|0},function(Re,ft,je){return j.optional(function(){Re.assert(ft,"typeof "+je+'==="number"',"invalid stencil.mask")}),ft.def(je,"|0")});case qs:return wt(function(Re){j.commandType(Re,"object",it,Ce.commandStr);var ft=Re.cmp||"keep",je=Re.ref||0,zt="mask"in Re?Re.mask:-1;return j.commandParameter(ft,hh,gt+".cmp",Ce.commandStr),j.commandType(je,"number",gt+".ref",Ce.commandStr),j.commandType(zt,"number",gt+".mask",Ce.commandStr),[hh[ft],je,zt]},function(Re,ft,je){var zt=Re.constants.compareFuncs;j.optional(function(){function sn(){Re.assert(ft,Array.prototype.join.call(arguments,""),"invalid stencil.func")}sn(je+"&&typeof ",je,'==="object"'),sn('!("cmp" in ',je,")||(",je,".cmp in ",zt,")")});var $t=ft.def('"cmp" in ',je,"?",zt,"[",je,".cmp]",":",Zs),Vr=ft.def(je,".ref|0"),En=ft.def('"mask" in ',je,"?",je,".mask|0:-1");return[$t,Vr,En]});case fc:case rh:return wt(function(Re){j.commandType(Re,"object",it,Ce.commandStr);var ft=Re.fail||"keep",je=Re.zfail||"keep",zt=Re.zpass||"keep";return j.commandParameter(ft,Nf,gt+".fail",Ce.commandStr),j.commandParameter(je,Nf,gt+".zfail",Ce.commandStr),j.commandParameter(zt,Nf,gt+".zpass",Ce.commandStr),[gt===rh?of:Bc,Nf[ft],Nf[je],Nf[zt]]},function(Re,ft,je){var zt=Re.constants.stencilOps;j.optional(function(){Re.assert(ft,je+"&&typeof "+je+'==="object"',"invalid "+gt)});function $t(Vr){return j.optional(function(){Re.assert(ft,'!("'+Vr+'" in '+je+")||("+je+"."+Vr+" in "+zt+")","invalid "+gt+"."+Vr+", must be one of "+Object.keys(Nf))}),ft.def('"',Vr,'" in ',je,"?",zt,"[",je,".",Vr,"]:",Zs)}return[gt===rh?of:Bc,$t("fail"),$t("zfail"),$t("zpass")]});case cs:return wt(function(Re){j.commandType(Re,"object",it,Ce.commandStr);var ft=Re.factor|0,je=Re.units|0;return j.commandType(ft,"number",it+".factor",Ce.commandStr),j.commandType(je,"number",it+".units",Ce.commandStr),[ft,je]},function(Re,ft,je){j.optional(function(){Re.assert(ft,je+"&&typeof "+je+'==="object"',"invalid "+gt)});var zt=ft.def(je,".factor|0"),$t=ft.def(je,".units|0");return[zt,$t]});case Pf:return wt(function(Re){var ft=0;return Re==="front"?ft=Bc:Re==="back"&&(ft=of),j.command(!!ft,it,Ce.commandStr),ft},function(Re,ft,je){return j.optional(function(){Re.assert(ft,je+'==="front"||'+je+'==="back"',"invalid cull.face")}),ft.def(je,'==="front"?',Bc,":",of)});case cc:return wt(function(Re){return j.command(typeof Re=="number"&&Re>=hr.lineWidthDims[0]&&Re<=hr.lineWidthDims[1],"invalid line width, must be a positive number between "+hr.lineWidthDims[0]+" and "+hr.lineWidthDims[1],Ce.commandStr),Re},function(Re,ft,je){return j.optional(function(){Re.assert(ft,"typeof "+je+'==="number"&&'+je+">="+hr.lineWidthDims[0]+"&&"+je+"<="+hr.lineWidthDims[1],"invalid line width")}),je});case cl:return wt(function(Re){return j.commandParameter(Re,id,it,Ce.commandStr),id[Re]},function(Re,ft,je){return j.optional(function(){Re.assert(ft,je+'==="cw"||'+je+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),ft.def(je+'==="cw"?'+kd+":"+Df)});case Wl:return wt(function(Re){return j.command(Go(Re)&&Re.length===4,"color.mask must be length 4 array",Ce.commandStr),Re.map(function(ft){return!!ft})},function(Re,ft,je){return j.optional(function(){Re.assert(ft,Re.shared.isArrayLike+"("+je+")&&"+je+".length===4","invalid color.mask")}),ut(4,function(zt){return"!!"+je+"["+zt+"]"})});case Ns:return wt(function(Re){j.command(typeof Re=="object"&&Re,it,Ce.commandStr);var ft="value"in Re?Re.value:1,je=!!Re.invert;return j.command(typeof ft=="number"&&ft>=0&&ft<=1,"sample.coverage.value must be a number between 0 and 1",Ce.commandStr),[ft,je]},function(Re,ft,je){j.optional(function(){Re.assert(ft,je+"&&typeof "+je+'==="object"',"invalid sample.coverage")});var zt=ft.def('"value" in ',je,"?+",je,".value:1"),$t=ft.def("!!",je,".invert");return[zt,$t]})}}),or}function Ca(Ze,Ce){var ht=Ze.static,Vt=Ze.dynamic,or={};return Object.keys(ht).forEach(function(gt){var it=ht[gt],wt;if(typeof it=="number"||typeof it=="boolean")wt=Ja(function(){return it});else if(typeof it=="function"){var Re=it._reglType;Re==="texture2d"||Re==="textureCube"?wt=Ja(function(ft){return ft.link(it)}):Re==="framebuffer"||Re==="framebufferCube"?(j.command(it.color.length>0,'missing color attachment for framebuffer sent to uniform "'+gt+'"',Ce.commandStr),wt=Ja(function(ft){return ft.link(it.color[0])})):j.commandRaise('invalid data for uniform "'+gt+'"',Ce.commandStr)}else Go(it)?wt=Ja(function(ft){var je=ft.global.def("[",ut(it.length,function(zt){return j.command(typeof it[zt]=="number"||typeof it[zt]=="boolean","invalid uniform "+gt,ft.commandStr),it[zt]}),"]");return je}):j.commandRaise('invalid or missing data for uniform "'+gt+'"',Ce.commandStr);wt.value=it,or[gt]=wt}),Object.keys(Vt).forEach(function(gt){var it=Vt[gt];or[gt]=Vs(it,function(wt,Re){return wt.invoke(Re,it)})}),or}function $s(Ze,Ce){var ht=Ze.static,Vt=Ze.dynamic,or={};return Object.keys(ht).forEach(function(gt){var it=ht[gt],wt=Le.id(gt),Re=new Nt;if(Xu(it))Re.state=Ri,Re.buffer=Ur.getBuffer(Ur.create(it,Us,!1,!0)),Re.type=0;else{var ft=Ur.getBuffer(it);if(ft)Re.state=Ri,Re.buffer=ft,Re.type=0;else if(j.command(typeof it=="object"&&it,"invalid data for attribute "+gt,Ce.commandStr),"constant"in it){var je=it.constant;Re.buffer="null",Re.state=oa,typeof je=="number"?Re.x=je:(j.command(Go(je)&&je.length>0&&je.length<=4,"invalid constant for attribute "+gt,Ce.commandStr),Qi.forEach(function(_n,Yn){Yn<je.length&&(Re[_n]=je[Yn])}))}else{Xu(it.buffer)?ft=Ur.getBuffer(Ur.create(it.buffer,Us,!1,!0)):ft=Ur.getBuffer(it.buffer),j.command(!!ft,'missing buffer for attribute "'+gt+'"',Ce.commandStr);var zt=it.offset|0;j.command(zt>=0,'invalid offset for attribute "'+gt+'"',Ce.commandStr);var $t=it.stride|0;j.command($t>=0&&$t<256,'invalid stride for attribute "'+gt+'", must be integer betweeen [0, 255]',Ce.commandStr);var Vr=it.size|0;j.command(!("size"in it)||Vr>0&&Vr<=4,'invalid size for attribute "'+gt+'", must be 1,2,3,4',Ce.commandStr);var En=!!it.normalized,sn=0;"type"in it&&(j.commandParameter(it.type,xu,"invalid type for attribute "+gt,Ce.commandStr),sn=xu[it.type]);var jn=it.divisor|0;j.optional(function(){"divisor"in it&&(j.command(jn===0||en,'cannot specify divisor for attribute "'+gt+'", instancing not supported',Ce.commandStr),j.command(jn>=0,'invalid divisor for attribute "'+gt+'"',Ce.commandStr));var _n=Ce.commandStr,Yn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(it).forEach(function(Hn){j.command(Yn.indexOf(Hn)>=0,'unknown parameter "'+Hn+'" for attribute pointer "'+gt+'" (valid parameters are '+Yn+")",_n)})}),Re.buffer=ft,Re.state=Ri,Re.size=Vr,Re.normalized=En,Re.type=sn||ft.dtype,Re.offset=zt,Re.stride=$t,Re.divisor=jn}}or[gt]=Ja(function(_n,Yn){var Hn=_n.attribCache;if(wt in Hn)return Hn[wt];var qn={isStream:!1};return Object.keys(Re).forEach(function(si){qn[si]=Re[si]}),Re.buffer&&(qn.buffer=_n.link(Re.buffer),qn.type=qn.type||qn.buffer+".dtype"),Hn[wt]=qn,qn})}),Object.keys(Vt).forEach(function(gt){var it=Vt[gt];function wt(Re,ft){var je=Re.invoke(ft,it),zt=Re.shared,$t=Re.constants,Vr=zt.isBufferArgs,En=zt.buffer;j.optional(function(){Re.assert(ft,je+"&&(typeof "+je+'==="object"||typeof '+je+'==="function")&&('+Vr+"("+je+")||"+En+".getBuffer("+je+")||"+En+".getBuffer("+je+".buffer)||"+Vr+"("+je+'.buffer)||("constant" in '+je+"&&(typeof "+je+'.constant==="number"||'+zt.isArrayLike+"("+je+".constant))))",'invalid dynamic attribute "'+gt+'"')});var sn={isStream:ft.def(!1)},jn=new Nt;jn.state=Ri,Object.keys(jn).forEach(function(qn){sn[qn]=ft.def(""+jn[qn])});var _n=sn.buffer,Yn=sn.type;ft("if(",Vr,"(",je,")){",sn.isStream,"=true;",_n,"=",En,".createStream(",Us,",",je,");",Yn,"=",_n,".dtype;","}else{",_n,"=",En,".getBuffer(",je,");","if(",_n,"){",Yn,"=",_n,".dtype;",'}else if("constant" in ',je,"){",sn.state,"=",oa,";","if(typeof "+je+'.constant === "number"){',sn[Qi[0]],"=",je,".constant;",Qi.slice(1).map(function(qn){return sn[qn]}).join("="),"=0;","}else{",Qi.map(function(qn,si){return sn[qn]+"="+je+".constant.length>"+si+"?"+je+".constant["+si+"]:0;"}).join(""),"}}else{","if(",Vr,"(",je,".buffer)){",_n,"=",En,".createStream(",Us,",",je,".buffer);","}else{",_n,"=",En,".getBuffer(",je,".buffer);","}",Yn,'="type" in ',je,"?",$t.glTypes,"[",je,".type]:",_n,".dtype;",sn.normalized,"=!!",je,".normalized;");function Hn(qn){ft(sn[qn],"=",je,".",qn,"|0;")}return Hn("size"),Hn("offset"),Hn("stride"),Hn("divisor"),ft("}}"),ft.exit("if(",sn.isStream,"){",En,".destroyStream(",_n,");","}"),sn}or[gt]=Vs(it,wt)}),or}function wo(Ze){var Ce=Ze.static,ht=Ze.dynamic,Vt={};return Object.keys(Ce).forEach(function(or){var gt=Ce[or];Vt[or]=Ja(function(it,wt){return typeof gt=="number"||typeof gt=="boolean"?""+gt:it.link(gt)})}),Object.keys(ht).forEach(function(or){var gt=ht[or];Vt[or]=Vs(gt,function(it,wt){return it.invoke(wt,gt)})}),Vt}function js(Ze,Ce,ht,Vt,or){var gt=Ze.static,it=Ze.dynamic;j.optional(function(){var Hn=[Su,Rf,nh,Yl,zs,Ml,Of,Oh,Fc,nu].concat(Ti);function qn(si){Object.keys(si).forEach(function($n){j.command(Hn.indexOf($n)>=0,'unknown parameter "'+$n+'"',or.commandStr)})}qn(gt),qn(it)});var wt=ta(Ze,Ce),Re=Fn(Ze,or),ft=Pi(Ze,Re,or),je=qo(Ze,or),zt=$o(Ze,or),$t=Ta(Ze,or,wt);function Vr(Hn){var qn=ft[Hn];qn&&(zt[Hn]=qn)}Vr(Wu),Vr(ii(Sp));var En=Object.keys(zt).length>0,sn={framebuffer:Re,draw:je,shader:$t,state:zt,dirty:En,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(sn.profile=Rn(Ze,or),sn.uniforms=Ca(ht,or),sn.drawVAO=sn.scopeVAO=je.vao,!sn.drawVAO&&$t.program&&!wt&&ot.angle_instanced_arrays&&je.static.elements){var jn=!0,_n=$t.program.attributes.map(function(Hn){var qn=Ce.static[Hn];return jn=jn&&!!qn,qn});if(jn&&_n.length>0){var Yn=tn.getVAO(tn.createVAO({attributes:_n,elements:je.static.elements}));sn.drawVAO=new uo(null,null,null,function(Hn,qn){return Hn.link(Yn)}),sn.useVAO=!0}}return wt?sn.useVAO=!0:sn.attributes=$s(Ce,or),sn.context=wo(Vt,or),sn}function gs(Ze,Ce,ht){var Vt=Ze.shared,or=Vt.context,gt=Ze.scope();Object.keys(ht).forEach(function(it){Ce.save(or,"."+it);var wt=ht[it],Re=wt.append(Ze,Ce);Array.isArray(Re)?gt(or,".",it,"=[",Re.join(),"];"):gt(or,".",it,"=",Re,";")}),Ce(gt)}function Ts(Ze,Ce,ht,Vt){var or=Ze.shared,gt=or.gl,it=or.framebuffer,wt;Pn&&(wt=Ce.def(or.extensions,".webgl_draw_buffers"));var Re=Ze.constants,ft=Re.drawBuffer,je=Re.backBuffer,zt;ht?zt=ht.append(Ze,Ce):zt=Ce.def(it,".next"),Vt||Ce("if(",zt,"!==",it,".cur){"),Ce("if(",zt,"){",gt,".bindFramebuffer(",Ip,",",zt,".framebuffer);"),Pn&&Ce(wt,".drawBuffersWEBGL(",ft,"[",zt,".colorAttachments.length]);"),Ce("}else{",gt,".bindFramebuffer(",Ip,",null);"),Pn&&Ce(wt,".drawBuffersWEBGL(",je,");"),Ce("}",it,".cur=",zt,";"),Vt||Ce("}")}function Gs(Ze,Ce,ht){var Vt=Ze.shared,or=Vt.gl,gt=Ze.current,it=Ze.next,wt=Vt.current,Re=Vt.next,ft=Ze.cond(wt,".dirty");Ti.forEach(function(je){var zt=ii(je);if(!(zt in ht.state)){var $t,Vr;if(zt in it){$t=it[zt],Vr=gt[zt];var En=ut(yn[zt].length,function(jn){return ft.def($t,"[",jn,"]")});ft(Ze.cond(En.map(function(jn,_n){return jn+"!=="+Vr+"["+_n+"]"}).join("||")).then(or,".",Fr[zt],"(",En,");",En.map(function(jn,_n){return Vr+"["+_n+"]="+jn}).join(";"),";"))}else{$t=ft.def(Re,".",zt);var sn=Ze.cond($t,"!==",wt,".",zt);ft(sn),zt in Ir?sn(Ze.cond($t).then(or,".enable(",Ir[zt],");").else(or,".disable(",Ir[zt],");"),wt,".",zt,"=",$t,";"):sn(or,".",Fr[zt],"(",$t,");",wt,".",zt,"=",$t,";")}}}),Object.keys(ht.state).length===0&&ft(wt,".dirty=false;"),Ce(ft)}function du(Ze,Ce,ht,Vt){var or=Ze.shared,gt=Ze.current,it=or.current,wt=or.gl;kp(Object.keys(ht)).forEach(function(Re){var ft=ht[Re];if(!(Vt&&!Vt(ft))){var je=ft.append(Ze,Ce);if(Ir[Re]){var zt=Ir[Re];Uc(ft)?je?Ce(wt,".enable(",zt,");"):Ce(wt,".disable(",zt,");"):Ce(Ze.cond(je).then(wt,".enable(",zt,");").else(wt,".disable(",zt,");")),Ce(it,".",Re,"=",je,";")}else if(Go(je)){var $t=gt[Re];Ce(wt,".",Fr[Re],"(",je,");",je.map(function(Vr,En){return $t+"["+En+"]="+Vr}).join(";"),";")}else Ce(wt,".",Fr[Re],"(",je,");",it,".",Re,"=",je,";")}})}function Uo(Ze,Ce){en&&(Ze.instancing=Ce.def(Ze.shared.extensions,".angle_instanced_arrays"))}function sa(Ze,Ce,ht,Vt,or){var gt=Ze.shared,it=Ze.stats,wt=gt.current,Re=gt.timer,ft=ht.profile;function je(){var Hn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Hn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var zt,$t;function Vr(Hn){zt=Ce.def(),Hn(zt,"=",je(),";"),typeof or=="string"?Hn(it,".count+=",or,";"):Hn(it,".count++;"),rn&&(Vt?($t=Ce.def(),Hn($t,"=",Re,".getNumPendingQueries();")):Hn(Re,".beginQuery(",it,");"))}function En(Hn){Hn(it,".cpuTime+=",je(),"-",zt,";"),rn&&(Vt?Hn(Re,".pushScopeStats(",$t,",",Re,".getNumPendingQueries(),",it,");"):Hn(Re,".endQuery();"))}function sn(Hn){var qn=Ce.def(wt,".profile");Ce(wt,".profile=",Hn,";"),Ce.exit(wt,".profile=",qn,";")}var jn;if(ft){if(Uc(ft)){ft.enable?(Vr(Ce),En(Ce.exit),sn("true")):sn("false");return}jn=ft.append(Ze,Ce),sn(jn)}else jn=Ce.def(wt,".profile");var _n=Ze.block();Vr(_n),Ce("if(",jn,"){",_n,"}");var Yn=Ze.block();En(Yn),Ce.exit("if(",jn,"){",Yn,"}")}function Ms(Ze,Ce,ht,Vt,or){var gt=Ze.shared;function it(Re){switch(Re){case wp:case nd:case Jh:return 2;case Il:case uh:case dc:return 3;case tf:case pc:case nf:return 4;default:return 1}}function wt(Re,ft,je){var zt=gt.gl,$t=Ce.def(Re,".location"),Vr=Ce.def(gt.attributes,"[",$t,"]"),En=je.state,sn=je.buffer,jn=[je.x,je.y,je.z,je.w],_n=["buffer","normalized","offset","stride"];function Yn(){Ce("if(!",Vr,".buffer){",zt,".enableVertexAttribArray(",$t,");}");var qn=je.type,si;if(je.size?si=Ce.def(je.size,"||",ft):si=ft,Ce("if(",Vr,".type!==",qn,"||",Vr,".size!==",si,"||",_n.map(function(Ni){return Vr+"."+Ni+"!=="+je[Ni]}).join("||"),"){",zt,".bindBuffer(",Us,",",sn,".buffer);",zt,".vertexAttribPointer(",[$t,si,qn,je.normalized,je.stride,je.offset],");",Vr,".type=",qn,";",Vr,".size=",si,";",_n.map(function(Ni){return Vr+"."+Ni+"="+je[Ni]+";"}).join(""),"}"),en){var $n=je.divisor;Ce("if(",Vr,".divisor!==",$n,"){",Ze.instancing,".vertexAttribDivisorANGLE(",[$t,$n],");",Vr,".divisor=",$n,";}")}}function Hn(){Ce("if(",Vr,".buffer){",zt,".disableVertexAttribArray(",$t,");",Vr,".buffer=null;","}if(",Qi.map(function(qn,si){return Vr+"."+qn+"!=="+jn[si]}).join("||"),"){",zt,".vertexAttrib4f(",$t,",",jn,");",Qi.map(function(qn,si){return Vr+"."+qn+"="+jn[si]+";"}).join(""),"}")}En===Ri?Yn():En===oa?Hn():(Ce("if(",En,"===",Ri,"){"),Yn(),Ce("}else{"),Hn(),Ce("}"))}Vt.forEach(function(Re){var ft=Re.name,je=ht.attributes[ft],zt;if(je){if(!or(je))return;zt=je.append(Ze,Ce)}else{if(!or(ad))return;var $t=Ze.scopeAttrib(ft);j.optional(function(){Ze.assert(Ce,$t+".state","missing attribute "+ft)}),zt={},Object.keys(new Nt).forEach(function(Vr){zt[Vr]=Ce.def($t,".",Vr)})}wt(Ze.link(Re),it(Re.info.type),zt)})}function Ua(Ze,Ce,ht,Vt,or,gt){for(var it=Ze.shared,wt=it.gl,Re,ft=0;ft<Vt.length;++ft){var je=Vt[ft],zt=je.name,$t=je.info.type,Vr=ht.uniforms[zt],En=Ze.link(je),sn=En+".location",jn;if(Vr){if(!or(Vr))continue;if(Uc(Vr)){var _n=Vr.value;if(j.command(_n!==null&&typeof _n!="undefined",'missing uniform "'+zt+'"',Ze.commandStr),$t===Fu||$t===ch){j.command(typeof _n=="function"&&($t===Fu&&(_n._reglType==="texture2d"||_n._reglType==="framebuffer")||$t===ch&&(_n._reglType==="textureCube"||_n._reglType==="framebufferCube")),"invalid texture for uniform "+zt,Ze.commandStr);var Yn=Ze.link(_n._texture||_n.color[0]._texture);Ce(wt,".uniform1i(",sn,",",Yn+".bind());"),Ce.exit(Yn,".unbind();")}else if($t===kl||$t===lh||$t===af){j.optional(function(){j.command(Go(_n),"invalid matrix for uniform "+zt,Ze.commandStr),j.command($t===kl&&_n.length===4||$t===lh&&_n.length===9||$t===af&&_n.length===16,"invalid length for matrix uniform "+zt,Ze.commandStr)});var Hn=Ze.global.def("new Float32Array(["+Array.prototype.slice.call(_n)+"])"),qn=2;$t===lh?qn=3:$t===af&&(qn=4),Ce(wt,".uniformMatrix",qn,"fv(",sn,",false,",Hn,");")}else{switch($t){case Dc:j.commandType(_n,"number","uniform "+zt,Ze.commandStr),Re="1f";break;case wp:j.command(Go(_n)&&_n.length===2,"uniform "+zt,Ze.commandStr),Re="2f";break;case Il:j.command(Go(_n)&&_n.length===3,"uniform "+zt,Ze.commandStr),Re="3f";break;case tf:j.command(Go(_n)&&_n.length===4,"uniform "+zt,Ze.commandStr),Re="4f";break;case Tp:j.commandType(_n,"boolean","uniform "+zt,Ze.commandStr),Re="1i";break;case rf:j.commandType(_n,"number","uniform "+zt,Ze.commandStr),Re="1i";break;case Jh:j.command(Go(_n)&&_n.length===2,"uniform "+zt,Ze.commandStr),Re="2i";break;case nd:j.command(Go(_n)&&_n.length===2,"uniform "+zt,Ze.commandStr),Re="2i";break;case dc:j.command(Go(_n)&&_n.length===3,"uniform "+zt,Ze.commandStr),Re="3i";break;case uh:j.command(Go(_n)&&_n.length===3,"uniform "+zt,Ze.commandStr),Re="3i";break;case nf:j.command(Go(_n)&&_n.length===4,"uniform "+zt,Ze.commandStr),Re="4i";break;case pc:j.command(Go(_n)&&_n.length===4,"uniform "+zt,Ze.commandStr),Re="4i";break}Ce(wt,".uniform",Re,"(",sn,",",Go(_n)?Array.prototype.slice.call(_n):_n,");")}continue}else jn=Vr.append(Ze,Ce)}else{if(!or(ad))continue;jn=Ce.def(it.uniforms,"[",Le.id(zt),"]")}$t===Fu?(j(!Array.isArray(jn),"must specify a scalar prop for textures"),Ce("if(",jn,"&&",jn,'._reglType==="framebuffer"){',jn,"=",jn,".color[0];","}")):$t===ch&&(j(!Array.isArray(jn),"must specify a scalar prop for cube maps"),Ce("if(",jn,"&&",jn,'._reglType==="framebufferCube"){',jn,"=",jn,".color[0];","}")),j.optional(function(){function Du(hl,jc){Ze.assert(Ce,hl,'bad data or missing for uniform "'+zt+'".  '+jc)}function gc(hl){j(!Array.isArray(jn),"must not specify an array type for uniform"),Du("typeof "+jn+'==="'+hl+'"',"invalid type, expected "+hl)}function $l(hl,jc){Array.isArray(jn)?j(jn.length===hl,"must have length "+hl):Du(it.isArrayLike+"("+jn+")&&"+jn+".length==="+hl,"invalid vector, should have length "+hl,Ze.commandStr)}function yc(hl){j(!Array.isArray(jn),"must not specify a value type"),Du("typeof "+jn+'==="function"&&'+jn+'._reglType==="texture'+(hl===Id?"2d":"Cube")+'"',"invalid texture type",Ze.commandStr)}switch($t){case rf:gc("number");break;case nd:$l(2,"number");break;case uh:$l(3,"number");break;case pc:$l(4,"number");break;case Dc:gc("number");break;case wp:$l(2,"number");break;case Il:$l(3,"number");break;case tf:$l(4,"number");break;case Tp:gc("boolean");break;case Jh:$l(2,"boolean");break;case dc:$l(3,"boolean");break;case nf:$l(4,"boolean");break;case kl:$l(4,"number");break;case lh:$l(9,"number");break;case af:$l(16,"number");break;case Fu:yc(Id);break;case ch:yc(Fh);break}});var si=1;switch($t){case Fu:case ch:var $n=Ce.def(jn,"._texture");Ce(wt,".uniform1i(",sn,",",$n,".bind());"),Ce.exit($n,".unbind();");continue;case rf:case Tp:Re="1i";break;case nd:case Jh:Re="2i",si=2;break;case uh:case dc:Re="3i",si=3;break;case pc:case nf:Re="4i",si=4;break;case Dc:Re="1f";break;case wp:Re="2f",si=2;break;case Il:Re="3f",si=3;break;case tf:Re="4f",si=4;break;case kl:Re="Matrix2fv";break;case lh:Re="Matrix3fv";break;case af:Re="Matrix4fv";break}if(Re.charAt(0)==="M"){Ce(wt,".uniform",Re,"(",sn,",");var Ni=Math.pow($t-kl+2,2),za=Ze.global.def("new Float32Array(",Ni,")");Array.isArray(jn)?Ce("false,(",ut(Ni,function(Du){return za+"["+Du+"]="+jn[Du]}),",",za,")"):Ce("false,(Array.isArray(",jn,")||",jn," instanceof Float32Array)?",jn,":(",ut(Ni,function(Du){return za+"["+Du+"]="+jn+"["+Du+"]"}),",",za,")"),Ce(");")}else if(si>1){for(var Ks=[],ko=[],qa=0;qa<si;++qa)Array.isArray(jn)?ko.push(jn[qa]):ko.push(Ce.def(jn+"["+qa+"]")),gt&&Ks.push(Ce.def());gt&&Ce("if(!",Ze.batchId,"||",Ks.map(function(Du,gc){return Du+"!=="+ko[gc]}).join("||"),"){",Ks.map(function(Du,gc){return Du+"="+ko[gc]+";"}).join("")),Ce(wt,".uniform",Re,"(",sn,",",ko.join(","),");"),gt&&Ce("}")}else{if(j(!Array.isArray(jn),"uniform value must not be an array"),gt){var Vc=Ce.def();Ce("if(!",Ze.batchId,"||",Vc,"!==",jn,"){",Vc,"=",jn,";")}Ce(wt,".uniform",Re,"(",sn,",",jn,");"),gt&&Ce("}")}}}function iu(Ze,Ce,ht,Vt){var or=Ze.shared,gt=or.gl,it=or.draw,wt=Vt.draw;function Re(){var si=wt.elements,$n,Ni=Ce;return si?((si.contextDep&&Vt.contextDynamic||si.propDep)&&(Ni=ht),$n=si.append(Ze,Ni),wt.elementsActive&&Ni("if("+$n+")"+gt+".bindBuffer("+Au+","+$n+".buffer.buffer);")):($n=Ni.def(),Ni($n,"=",it,".",Yl,";","if(",$n,"){",gt,".bindBuffer(",Au,",",$n,".buffer.buffer);}","else if(",or.vao,".currentVAO){",$n,"=",Ze.shared.elements+".getElements("+or.vao,".currentVAO.elements);",Zr?"":"if("+$n+")"+gt+".bindBuffer("+Au+","+$n+".buffer.buffer);","}")),$n}function ft(){var si=wt.count,$n,Ni=Ce;return si?((si.contextDep&&Vt.contextDynamic||si.propDep)&&(Ni=ht),$n=si.append(Ze,Ni),j.optional(function(){si.MISSING&&Ze.assert(Ce,"false","missing vertex count"),si.DYNAMIC&&Ze.assert(Ni,$n+">=0","missing vertex count")})):($n=Ni.def(it,".",Of),j.optional(function(){Ze.assert(Ni,$n+">=0","missing vertex count")})),$n}var je=Re();function zt(si){var $n=wt[si];return $n?$n.contextDep&&Vt.contextDynamic||$n.propDep?$n.append(Ze,ht):$n.append(Ze,Ce):Ce.def(it,".",si)}var $t=zt(zs),Vr=zt(Ml),En=ft();if(typeof En=="number"){if(En===0)return}else ht("if(",En,"){"),ht.exit("}");var sn,jn;en&&(sn=zt(Oh),jn=Ze.instancing);var _n=je+".type",Yn=wt.elements&&Uc(wt.elements)&&!wt.vaoActive;function Hn(){function si(){ht(jn,".drawElementsInstancedANGLE(",[$t,En,_n,Vr+"<<(("+_n+"-"+Wi+")>>1)",sn],");")}function $n(){ht(jn,".drawArraysInstancedANGLE(",[$t,Vr,En,sn],");")}je&&je!=="null"?Yn?si():(ht("if(",je,"){"),si(),ht("}else{"),$n(),ht("}")):$n()}function qn(){function si(){ht(gt+".drawElements("+[$t,En,_n,Vr+"<<(("+_n+"-"+Wi+")>>1)"]+");")}function $n(){ht(gt+".drawArrays("+[$t,Vr,En]+");")}je&&je!=="null"?Yn?si():(ht("if(",je,"){"),si(),ht("}else{"),$n(),ht("}")):$n()}en&&(typeof sn!="number"||sn>=0)?typeof sn=="string"?(ht("if(",sn,">0){"),Hn(),ht("}else if(",sn,"<0){"),qn(),ht("}")):Hn():qn()}function Yi(Ze,Ce,ht,Vt,or){var gt=Gi(),it=gt.proc("body",or);return j.optional(function(){gt.commandStr=Ce.commandStr,gt.command=gt.link(Ce.commandStr)}),en&&(gt.instancing=it.def(gt.shared.extensions,".angle_instanced_arrays")),Ze(gt,it,ht,Vt),gt.compile().body}function Ma(Ze,Ce,ht,Vt){Uo(Ze,Ce),ht.useVAO?ht.drawVAO?Ce(Ze.shared.vao,".setVAO(",ht.drawVAO.append(Ze,Ce),");"):Ce(Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"):(Ce(Ze.shared.vao,".setVAO(null);"),Ms(Ze,Ce,ht,Vt.attributes,function(){return!0})),Ua(Ze,Ce,ht,Vt.uniforms,function(){return!0},!1),iu(Ze,Ce,Ce,ht)}function eo(Ze,Ce){var ht=Ze.proc("draw",1);Uo(Ze,ht),gs(Ze,ht,Ce.context),Ts(Ze,ht,Ce.framebuffer),Gs(Ze,ht,Ce),du(Ze,ht,Ce.state),sa(Ze,ht,Ce,!1,!0);var Vt=Ce.shader.progVar.append(Ze,ht);if(ht(Ze.shared.gl,".useProgram(",Vt,".program);"),Ce.shader.program)Ma(Ze,ht,Ce,Ce.shader.program);else{ht(Ze.shared.vao,".setVAO(null);");var or=Ze.global.def("{}"),gt=ht.def(Vt,".id"),it=ht.def(or,"[",gt,"]");ht(Ze.cond(it).then(it,".call(this,a0);").else(it,"=",or,"[",gt,"]=",Ze.link(function(wt){return Yi(Ma,Ze,Ce,wt,1)}),"(",Vt,");",it,".call(this,a0);"))}Object.keys(Ce.state).length>0&&ht(Ze.shared.current,".dirty=true;"),Ze.shared.vao&&ht(Ze.shared.vao,".setVAO(null);")}function ys(Ze,Ce,ht,Vt){Ze.batchId="a1",Uo(Ze,Ce);function or(){return!0}Ms(Ze,Ce,ht,Vt.attributes,or),Ua(Ze,Ce,ht,Vt.uniforms,or,!1),iu(Ze,Ce,Ce,ht)}function sf(Ze,Ce,ht,Vt){Uo(Ze,Ce);var or=ht.contextDep,gt=Ce.def(),it="a0",wt="a1",Re=Ce.def();Ze.shared.props=Re,Ze.batchId=gt;var ft=Ze.scope(),je=Ze.scope();Ce(ft.entry,"for(",gt,"=0;",gt,"<",wt,";++",gt,"){",Re,"=",it,"[",gt,"];",je,"}",ft.exit);function zt(_n){return _n.contextDep&&or||_n.propDep}function $t(_n){return!zt(_n)}if(ht.needsContext&&gs(Ze,je,ht.context),ht.needsFramebuffer&&Ts(Ze,je,ht.framebuffer),du(Ze,je,ht.state,zt),ht.profile&&zt(ht.profile)&&sa(Ze,je,ht,!1,!0),Vt)ht.useVAO?ht.drawVAO?zt(ht.drawVAO)?je(Ze.shared.vao,".setVAO(",ht.drawVAO.append(Ze,je),");"):ft(Ze.shared.vao,".setVAO(",ht.drawVAO.append(Ze,ft),");"):ft(Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"):(ft(Ze.shared.vao,".setVAO(null);"),Ms(Ze,ft,ht,Vt.attributes,$t),Ms(Ze,je,ht,Vt.attributes,zt)),Ua(Ze,ft,ht,Vt.uniforms,$t,!1),Ua(Ze,je,ht,Vt.uniforms,zt,!0),iu(Ze,ft,je,ht);else{var Vr=Ze.global.def("{}"),En=ht.shader.progVar.append(Ze,je),sn=je.def(En,".id"),jn=je.def(Vr,"[",sn,"]");je(Ze.shared.gl,".useProgram(",En,".program);","if(!",jn,"){",jn,"=",Vr,"[",sn,"]=",Ze.link(function(_n){return Yi(ys,Ze,ht,_n,2)}),"(",En,");}",jn,".call(this,a0[",gt,"],",gt,");")}}function $e(Ze,Ce){var ht=Ze.proc("batch",2);Ze.batchId="0",Uo(Ze,ht);var Vt=!1,or=!0;Object.keys(Ce.context).forEach(function(Vr){Vt=Vt||Ce.context[Vr].propDep}),Vt||(gs(Ze,ht,Ce.context),or=!1);var gt=Ce.framebuffer,it=!1;gt?(gt.propDep?Vt=it=!0:gt.contextDep&&Vt&&(it=!0),it||Ts(Ze,ht,gt)):Ts(Ze,ht,null),Ce.state.viewport&&Ce.state.viewport.propDep&&(Vt=!0);function wt(Vr){return Vr.contextDep&&Vt||Vr.propDep}Gs(Ze,ht,Ce),du(Ze,ht,Ce.state,function(Vr){return!wt(Vr)}),(!Ce.profile||!wt(Ce.profile))&&sa(Ze,ht,Ce,!1,"a1"),Ce.contextDep=Vt,Ce.needsContext=or,Ce.needsFramebuffer=it;var Re=Ce.shader.progVar;if(Re.contextDep&&Vt||Re.propDep)sf(Ze,ht,Ce,null);else{var ft=Re.append(Ze,ht);if(ht(Ze.shared.gl,".useProgram(",ft,".program);"),Ce.shader.program)sf(Ze,ht,Ce,Ce.shader.program);else{ht(Ze.shared.vao,".setVAO(null);");var je=Ze.global.def("{}"),zt=ht.def(ft,".id"),$t=ht.def(je,"[",zt,"]");ht(Ze.cond($t).then($t,".call(this,a0,a1);").else($t,"=",je,"[",zt,"]=",Ze.link(function(Vr){return Yi(sf,Ze,Ce,Vr,2)}),"(",ft,");",$t,".call(this,a0,a1);"))}}Object.keys(Ce.state).length>0&&ht(Ze.shared.current,".dirty=true;"),Ze.shared.vao&&ht(Ze.shared.vao,".setVAO(null);")}function dr(Ze,Ce){var ht=Ze.proc("scope",3);Ze.batchId="a2";var Vt=Ze.shared,or=Vt.current;gs(Ze,ht,Ce.context),Ce.framebuffer&&Ce.framebuffer.append(Ze,ht),kp(Object.keys(Ce.state)).forEach(function(it){var wt=Ce.state[it],Re=wt.append(Ze,ht);Go(Re)?Re.forEach(function(ft,je){ht.set(Ze.next[it],"["+je+"]",ft)}):ht.set(Vt.next,"."+it,Re)}),sa(Ze,ht,Ce,!0,!0),[Yl,Ml,Of,Oh,zs].forEach(function(it){var wt=Ce.draw[it];!wt||ht.set(Vt.draw,"."+it,""+wt.append(Ze,ht))}),Object.keys(Ce.uniforms).forEach(function(it){var wt=Ce.uniforms[it].append(Ze,ht);Array.isArray(wt)&&(wt="["+wt.join()+"]"),ht.set(Vt.uniforms,"["+Le.id(it)+"]",wt)}),Object.keys(Ce.attributes).forEach(function(it){var wt=Ce.attributes[it].append(Ze,ht),Re=Ze.scopeAttrib(it);Object.keys(new Nt).forEach(function(ft){ht.set(Re,"."+ft,wt[ft])})}),Ce.scopeVAO&&ht.set(Vt.vao,".targetVAO",Ce.scopeVAO.append(Ze,ht));function gt(it){var wt=Ce.shader[it];wt&&ht.set(Vt.shader,"."+it,wt.append(Ze,ht))}gt(Rf),gt(nh),Object.keys(Ce.state).length>0&&(ht(or,".dirty=true;"),ht.exit(or,".dirty=true;")),ht("a1(",Ze.shared.context,",a0,",Ze.batchId,");")}function Xt(Ze){if(!(typeof Ze!="object"||Go(Ze))){for(var Ce=Object.keys(Ze),ht=0;ht<Ce.length;++ht)if(An.isDynamic(Ze[Ce[ht]]))return!0;return!1}}function Jn(Ze,Ce,ht){var Vt=Ce.static[ht];if(!Vt||!Xt(Vt))return;var or=Ze.global,gt=Object.keys(Vt),it=!1,wt=!1,Re=!1,ft=Ze.global.def("{}");gt.forEach(function(zt){var $t=Vt[zt];if(An.isDynamic($t)){typeof $t=="function"&&($t=Vt[zt]=An.unbox($t));var Vr=Vs($t,null);it=it||Vr.thisDep,Re=Re||Vr.propDep,wt=wt||Vr.contextDep}else{switch(or(ft,".",zt,"="),typeof $t){case"number":or($t);break;case"string":or('"',$t,'"');break;case"object":Array.isArray($t)&&or("[",$t.join(),"]");break;default:or(Ze.link($t));break}or(";")}});function je(zt,$t){gt.forEach(function(Vr){var En=Vt[Vr];if(!!An.isDynamic(En)){var sn=zt.invoke($t,En);$t(ft,".",Vr,"=",sn,";")}})}Ce.dynamic[ht]=new An.DynamicVariable(Ds,{thisDep:it,contextDep:wt,propDep:Re,ref:ft,append:je}),delete Ce.static[ht]}function Ia(Ze,Ce,ht,Vt,or){var gt=Gi();gt.stats=gt.link(or),Object.keys(Ce.static).forEach(function(wt){Jn(gt,Ce,wt)}),ed.forEach(function(wt){Jn(gt,Ze,wt)});var it=js(Ze,Ce,ht,Vt,gt);return eo(gt,it),dr(gt,it),$e(gt,it),y(gt.compile(),{destroy:function(){it.shader.program.destroy()}})}return{next:Nn,current:yn,procs:function(){var Ze=Gi(),Ce=Ze.proc("poll"),ht=Ze.proc("refresh"),Vt=Ze.block();Ce(Vt),ht(Vt);var or=Ze.shared,gt=or.gl,it=or.next,wt=or.current;Vt(wt,".dirty=false;"),Ts(Ze,Ce),Ts(Ze,ht,null,!0);var Re;en&&(Re=Ze.link(en)),ot.oes_vertex_array_object&&ht(Ze.link(ot.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var ft=0;ft<hr.maxAttributes;++ft){var je=ht.def(or.attributes,"[",ft,"]"),zt=Ze.cond(je,".buffer");zt.then(gt,".enableVertexAttribArray(",ft,");",gt,".bindBuffer(",Us,",",je,".buffer.buffer);",gt,".vertexAttribPointer(",ft,",",je,".size,",je,".type,",je,".normalized,",je,".stride,",je,".offset);").else(gt,".disableVertexAttribArray(",ft,");",gt,".vertexAttrib4f(",ft,",",je,".x,",je,".y,",je,".z,",je,".w);",je,".buffer=null;"),ht(zt),en&&ht(Re,".vertexAttribDivisorANGLE(",ft,",",je,".divisor);")}return ht(Ze.shared.vao,".currentVAO=null;",Ze.shared.vao,".setVAO(",Ze.shared.vao,".targetVAO);"),Object.keys(Ir).forEach(function($t){var Vr=Ir[$t],En=Vt.def(it,".",$t),sn=Ze.block();sn("if(",En,"){",gt,".enable(",Vr,")}else{",gt,".disable(",Vr,")}",wt,".",$t,"=",En,";"),ht(sn),Ce("if(",En,"!==",wt,".",$t,"){",sn,"}")}),Object.keys(Fr).forEach(function($t){var Vr=Fr[$t],En=yn[$t],sn,jn,_n=Ze.block();if(_n(gt,".",Vr,"("),Go(En)){var Yn=En.length;sn=Ze.global.def(it,".",$t),jn=Ze.global.def(wt,".",$t),_n(ut(Yn,function(Hn){return sn+"["+Hn+"]"}),");",ut(Yn,function(Hn){return jn+"["+Hn+"]="+sn+"["+Hn+"];"}).join("")),Ce("if(",ut(Yn,function(Hn){return sn+"["+Hn+"]!=="+jn+"["+Hn+"]"}).join("||"),"){",_n,"}")}else sn=Vt.def(it,".",$t),jn=Vt.def(wt,".",$t),_n(sn,");",wt,".",$t,"=",sn,";"),Ce("if(",sn,"!==",jn,"){",_n,"}");ht(_n)}),Ze.compile()}(),compile:Ia}}function r0(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var n0=34918,Pp=34919,Rd=35007,Lp=function(H,Le){if(!Le.ext_disjoint_timer_query)return null;var ot=[];function hr(){return ot.pop()||Le.ext_disjoint_timer_query.createQueryEXT()}function Ur(en){ot.push(en)}var cr=[];function kr(en){var Pn=hr();Le.ext_disjoint_timer_query.beginQueryEXT(Rd,Pn),cr.push(Pn),rn(cr.length-1,cr.length,en)}function Gr(){Le.ext_disjoint_timer_query.endQueryEXT(Rd)}function $r(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var tn=[];function hn(){return tn.pop()||new $r}function pn(en){tn.push(en)}var In=[];function rn(en,Pn,Zr){var yn=hn();yn.startQueryIndex=en,yn.endQueryIndex=Pn,yn.sum=0,yn.stats=Zr,In.push(yn)}var cn=[],Nt=[];function yr(){var en,Pn,Zr=cr.length;if(Zr!==0){Nt.length=Math.max(Nt.length,Zr+1),cn.length=Math.max(cn.length,Zr+1),cn[0]=0,Nt[0]=0;var yn=0;for(en=0,Pn=0;Pn<cr.length;++Pn){var Nn=cr[Pn];Le.ext_disjoint_timer_query.getQueryObjectEXT(Nn,Pp)?(yn+=Le.ext_disjoint_timer_query.getQueryObjectEXT(Nn,n0),Ur(Nn)):cr[en++]=Nn,cn[Pn+1]=yn,Nt[Pn+1]=en}for(cr.length=en,en=0,Pn=0;Pn<In.length;++Pn){var Ti=In[Pn],Ir=Ti.startQueryIndex,Fr=Ti.endQueryIndex;Ti.sum+=cn[Fr]-cn[Ir];var ii=Nt[Ir],Ln=Nt[Fr];Ln===ii?(Ti.stats.gpuTime+=Ti.sum/1e6,pn(Ti)):(Ti.startQueryIndex=ii,Ti.endQueryIndex=Ln,In[en++]=Ti)}In.length=en}}return{beginQuery:kr,endQuery:Gr,pushScopeStats:rn,update:yr,getNumPendingQueries:function(){return cr.length},clear:function(){ot.push.apply(ot,cr);for(var en=0;en<ot.length;en++)Le.ext_disjoint_timer_query.deleteQueryEXT(ot[en]);cr.length=0,ot.length=0},restore:function(){cr.length=0,ot.length=0}}},O0=16384,ep=256,Od=1024,F0=34962,ph="webglcontextlost",xo="webglcontextrestored",sd=1,Zc=2,tp=3;function Fd(H,Le){for(var ot=0;ot<H.length;++ot)if(H[ot]===Le)return ot;return-1}function ud(H){var Le=ke(H);if(!Le)return null;var ot=Le.gl,hr=ot.getContextAttributes(),Ur=ot.isContextLost(),cr=Ye(ot,Le);if(!cr)return null;var kr=ia(),Gr=r0(),$r=cr.extensions,tn=Lp(ot,$r),hn=Pa(),pn=ot.drawingBufferWidth,In=ot.drawingBufferHeight,rn={tick:0,time:0,viewportWidth:pn,viewportHeight:In,framebufferWidth:pn,framebufferHeight:In,drawingBufferWidth:pn,drawingBufferHeight:In,pixelRatio:Le.pixelRatio},cn={},Nt={elements:null,primitive:4,count:-1,offset:0,instances:-1},yr=Zu(ot,$r),en=G(ot,Gr,Le,yn),Pn=wc(ot,$r,en,Gr),Zr=Wt(ot,$r,yr,Gr,en,Pn,Nt);function yn(Yi){return Zr.destroyBuffer(Yi)}var Nn=bn(ot,kr,Gr,Le),Ti=pu(ot,$r,yr,function(){ii.procs.poll()},rn,Gr,Le),Ir=eh(ot,$r,yr,Gr,Le),Fr=Qe(ot,$r,yr,Ti,Ir,Gr),ii=od(ot,kr,$r,yr,en,Pn,Ti,Fr,cn,Zr,Nn,Nt,rn,tn,Le),Ln=bi(ot,Fr,ii.procs.poll,rn,hr,$r,yr),nn=ii.next,zn=ot.canvas,Mn=[],ca=[],Gi=[],Rn=[Le.onDestroy],Fn=null;function Pi(){if(Mn.length===0){tn&&tn.update(),Fn=null;return}Fn=Oi.next(Pi),Uo();for(var Yi=Mn.length-1;Yi>=0;--Yi){var Ma=Mn[Yi];Ma&&Ma(rn,null,0)}ot.flush(),tn&&tn.update()}function ta(){!Fn&&Mn.length>0&&(Fn=Oi.next(Pi))}function Ta(){Fn&&(Oi.cancel(Pi),Fn=null)}function qo(Yi){Yi.preventDefault(),Ur=!0,Ta(),ca.forEach(function(Ma){Ma()})}function $o(Yi){ot.getError(),Ur=!1,cr.restore(),Nn.restore(),en.restore(),Ti.restore(),Ir.restore(),Fr.restore(),Zr.restore(),tn&&tn.restore(),ii.procs.refresh(),ta(),Gi.forEach(function(Ma){Ma()})}var Ca=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Ca&&zn&&(zn.addEventListener(ph,qo,!1),zn.addEventListener(xo,$o,!1));function $s(){Mn.length=0,Ta(),!Ca&&zn&&(zn.removeEventListener(ph,qo),zn.removeEventListener(xo,$o)),Nn.clear(),Fr.clear(),Ir.clear(),Zr.clear(),Ti.clear(),Pn.clear(),en.clear(),tn&&tn.clear(),Rn.forEach(function(Yi){Yi()})}function wo(Yi){j(!!Yi,"invalid args to regl({...})"),j.type(Yi,"object","invalid args to regl({...})");function Ma(gt){var it=y({},gt);delete it.uniforms,delete it.attributes,delete it.context,delete it.vao,"stencil"in it&&it.stencil.op&&(it.stencil.opBack=it.stencil.opFront=it.stencil.op,delete it.stencil.op);function wt(Re){if(Re in it){var ft=it[Re];delete it[Re],Object.keys(ft).forEach(function(je){it[Re+"."+je]=ft[je]})}}return wt("blend"),wt("depth"),wt("cull"),wt("stencil"),wt("polygonOffset"),wt("scissor"),wt("sample"),"vao"in gt&&(it.vao=gt.vao),it}function eo(gt,it){var wt={},Re={};return Object.keys(gt).forEach(function(ft){var je=gt[ft];if(An.isDynamic(je)){Re[ft]=An.unbox(je,ft);return}else if(it&&Array.isArray(je)){for(var zt=0;zt<je.length;++zt)if(An.isDynamic(je[zt])){Re[ft]=An.unbox(je,ft);return}}wt[ft]=je}),{dynamic:Re,static:wt}}var ys=eo(Yi.context||{},!0),sf=eo(Yi.uniforms||{},!0),$e=eo(Yi.attributes||{},!1),dr=eo(Ma(Yi),!1),Xt={gpuTime:0,cpuTime:0,count:0},Jn=ii.compile(dr,$e,sf,ys,Xt),Ia=Jn.draw,Ze=Jn.batch,Ce=Jn.scope,ht=[];function Vt(gt){for(;ht.length<gt;)ht.push(null);return ht}function or(gt,it){var wt;if(Ur&&j.raise("context lost"),typeof gt=="function")return Ce.call(this,null,gt,0);if(typeof it=="function")if(typeof gt=="number")for(wt=0;wt<gt;++wt)Ce.call(this,null,it,wt);else if(Array.isArray(gt))for(wt=0;wt<gt.length;++wt)Ce.call(this,gt[wt],it,wt);else return Ce.call(this,gt,it,0);else if(typeof gt=="number"){if(gt>0)return Ze.call(this,Vt(gt|0),gt|0)}else if(Array.isArray(gt)){if(gt.length)return Ze.call(this,gt,gt.length)}else return Ia.call(this,gt)}return y(or,{stats:Xt,destroy:function(){Jn.destroy()}})}var js=Fr.setFBO=wo({framebuffer:An.define.call(null,sd,"framebuffer")});function gs(Yi,Ma){var eo=0;ii.procs.poll();var ys=Ma.color;ys&&(ot.clearColor(+ys[0]||0,+ys[1]||0,+ys[2]||0,+ys[3]||0),eo|=O0),"depth"in Ma&&(ot.clearDepth(+Ma.depth),eo|=ep),"stencil"in Ma&&(ot.clearStencil(Ma.stencil|0),eo|=Od),j(!!eo,"called regl.clear with no buffer specified"),ot.clear(eo)}function Ts(Yi){if(j(typeof Yi=="object"&&Yi,"regl.clear() takes an object as input"),"framebuffer"in Yi)if(Yi.framebuffer&&Yi.framebuffer_reglType==="framebufferCube")for(var Ma=0;Ma<6;++Ma)js(y({framebuffer:Yi.framebuffer.faces[Ma]},Yi),gs);else js(Yi,gs);else gs(null,Yi)}function Gs(Yi){j.type(Yi,"function","regl.frame() callback must be a function"),Mn.push(Yi);function Ma(){var eo=Fd(Mn,Yi);j(eo>=0,"cannot cancel a frame twice");function ys(){var sf=Fd(Mn,ys);Mn[sf]=Mn[Mn.length-1],Mn.length-=1,Mn.length<=0&&Ta()}Mn[eo]=ys}return ta(),{cancel:Ma}}function du(){var Yi=nn.viewport,Ma=nn.scissor_box;Yi[0]=Yi[1]=Ma[0]=Ma[1]=0,rn.viewportWidth=rn.framebufferWidth=rn.drawingBufferWidth=Yi[2]=Ma[2]=ot.drawingBufferWidth,rn.viewportHeight=rn.framebufferHeight=rn.drawingBufferHeight=Yi[3]=Ma[3]=ot.drawingBufferHeight}function Uo(){rn.tick+=1,rn.time=Ms(),du(),ii.procs.poll()}function sa(){Ti.refresh(),du(),ii.procs.refresh(),tn&&tn.update()}function Ms(){return(Pa()-hn)/1e3}sa();function Ua(Yi,Ma){j.type(Ma,"function","listener callback must be a function");var eo;switch(Yi){case"frame":return Gs(Ma);case"lost":eo=ca;break;case"restore":eo=Gi;break;case"destroy":eo=Rn;break;default:j.raise("invalid event, must be one of frame,lost,restore,destroy")}return eo.push(Ma),{cancel:function(){for(var ys=0;ys<eo.length;++ys)if(eo[ys]===Ma){eo[ys]=eo[eo.length-1],eo.pop();return}}}}var iu=y(wo,{clear:Ts,prop:An.define.bind(null,sd),context:An.define.bind(null,Zc),this:An.define.bind(null,tp),draw:wo({}),buffer:function(Yi){return en.create(Yi,F0,!1,!1)},elements:function(Yi){return Pn.create(Yi,!1)},texture:Ti.create2D,cube:Ti.createCube,renderbuffer:Ir.create,framebuffer:Fr.create,framebufferCube:Fr.createCube,vao:Zr.createVAO,attributes:hr,frame:Gs,on:Ua,limits:yr,hasExtension:function(Yi){return yr.extensions.indexOf(Yi.toLowerCase())>=0},read:Ln,destroy:$s,_gl:ot,_refresh:sa,poll:function(){Uo(),tn&&tn.update()},now:Ms,stats:Gr});return Le.onDone(null,iu),iu}return ud})},6158:function(ci){(function(Ae,de){ci.exports=de()})(this,function(){"use strict";var Ae,de,He;function ge(y,Ne){if(!Ae)Ae=Ne;else if(!de)de=Ne;else{var Q="var sharedChunk = {}; ("+Ae+")(sharedChunk); ("+de+")(sharedChunk);",Pe={};Ae(Pe),He=Ne(Pe),typeof window!="undefined"&&(He.workerUrl=window.URL.createObjectURL(new Blob([Q],{type:"text/javascript"})))}}return ge(["exports"],function(y){"use strict";function Ne(i,s){return i(s={exports:{}},s.exports),s.exports}var Q=Pe;function Pe(i,s,l,d){this.cx=3*i,this.bx=3*(l-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(d-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=d,this.p2x=l,this.p2y=d}Pe.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},Pe.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},Pe.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},Pe.prototype.solveCurveX=function(i,s){var l,d,x,C,T;for(s===void 0&&(s=1e-6),x=i,T=0;T<8;T++){if(C=this.sampleCurveX(x)-i,Math.abs(C)<s)return x;var O=this.sampleCurveDerivativeX(x);if(Math.abs(O)<1e-6)break;x-=C/O}if((x=i)<(l=0))return l;if(x>(d=1))return d;for(;l<d;){if(C=this.sampleCurveX(x),Math.abs(C-i)<s)return x;i>C?l=x:d=x,x=.5*(d-l)+l}return x},Pe.prototype.solve=function(i,s){return this.sampleCurveY(this.solveCurveX(i,s))};var ve=lt;function lt(i,s){this.x=i,this.y=s}lt.prototype={clone:function(){return new lt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,s){return this.clone()._rotateAround(i,s)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var s=i.x-this.x,l=i.y-this.y;return s*s+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,s){return Math.atan2(this.x*s-this.y*i,this.x*i+this.y*s)},_matMult:function(i){var s=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=s,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var s=Math.cos(i),l=Math.sin(i),d=l*this.x+s*this.y;return this.x=s*this.x-l*this.y,this.y=d,this},_rotateAround:function(i,s){var l=Math.cos(i),d=Math.sin(i),x=s.y+d*(this.x-s.x)+l*(this.y-s.y);return this.x=s.x+l*(this.x-s.x)-d*(this.y-s.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},lt.convert=function(i){return i instanceof lt?i:Array.isArray(i)?new lt(i[0],i[1]):i};var we=typeof self!="undefined"?self:{},We=Math.pow(2,53)-1;function St(i,s,l,d){var x=new Q(i,s,l,d);return function(C){return x.solve(C)}}var Rt=St(.25,.1,.25,1);function tr(i,s,l){return Math.min(l,Math.max(s,i))}function qt(i,s,l){var d=l-s,x=((i-s)%d+d)%d+s;return x===s?l:x}function Yt(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var d=0,x=s;d<x.length;d+=1){var C=x[d];for(var T in C)i[T]=C[T]}return i}var Sr=1;function fr(){return Sr++}function It(){return function i(s){return s?(s^16*Math.random()>>s/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function jt(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Rr(i,s){i.forEach(function(l){s[l]&&(s[l]=s[l].bind(s))})}function ie(i,s){return i.indexOf(s,i.length-s.length)!==-1}function _r(i,s,l){var d={};for(var x in i)d[x]=s.call(l||this,i[x],x,i);return d}function Ot(i,s,l){var d={};for(var x in i)s.call(l||this,i[x],x,i)&&(d[x]=i[x]);return d}function yt(i){return Array.isArray(i)?i.map(yt):typeof i=="object"&&i?_r(i,yt):i}var Qt={};function Ue(i){Qt[i]||(typeof console!="undefined"&&console.warn(i),Qt[i]=!0)}function Ar(i,s,l){return(l.y-i.y)*(s.x-i.x)>(s.y-i.y)*(l.x-i.x)}function an(i){for(var s=0,l=0,d=i.length,x=d-1,C=void 0,T=void 0;l<d;x=l++)s+=((T=i[x]).x-(C=i[l]).x)*(C.y+T.y);return s}function fe(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function rt(i){var s={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(d,x,C,T){var O=C||T;return s[x]=!O||O.toLowerCase(),""}),s["max-age"]){var l=parseInt(s["max-age"],10);isNaN(l)?delete s["max-age"]:s["max-age"]=l}return s}var X=null;function ae(i){if(X==null){var s=i.navigator?i.navigator.userAgent:null;X=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return X}function ze(i){try{var s=we[i];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch(l){return!1}}var At,Ft,ur,Tt,Br=we.performance&&we.performance.now?we.performance.now.bind(we.performance):Date.now.bind(Date),Bn=we.requestAnimationFrame||we.mozRequestAnimationFrame||we.webkitRequestAnimationFrame||we.msRequestAnimationFrame,Sn=we.cancelAnimationFrame||we.mozCancelAnimationFrame||we.webkitCancelAnimationFrame||we.msCancelAnimationFrame,Li={now:Br,frame:function(i){var s=Bn(i);return{cancel:function(){return Sn(s)}}},getImageData:function(i,s){s===void 0&&(s=0);var l=we.document.createElement("canvas"),d=l.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return l.width=i.width,l.height=i.height,d.drawImage(i,0,0,i.width,i.height),d.getImageData(-s,-s,i.width+2*s,i.height+2*s)},resolveURL:function(i){return At||(At=we.document.createElement("a")),At.href=i,At.href},hardwareConcurrency:we.navigator&&we.navigator.hardwareConcurrency||4,get devicePixelRatio(){return we.devicePixelRatio},get prefersReducedMotion(){return!!we.matchMedia&&(Ft==null&&(Ft=we.matchMedia("(prefers-reduced-motion: reduce)")),Ft.matches)}},gi={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},on={supported:!1,testSupport:function(i){!Xa&&Tt&&(ra?Vi(i):ur=i)}},Xa=!1,ra=!1;function Vi(i){var s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Tt),i.isContextLost())return;on.supported=!0}catch(l){}i.deleteTexture(s),Xa=!0}we.document&&((Tt=we.document.createElement("img")).onload=function(){ur&&Vi(ur),ur=null,ra=!0},Tt.onerror=function(){Xa=!0,ur=null},Tt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ga="01",fi=function(i,s){this._transformRequestFn=i,this._customAccessToken=s,this._createSkuToken()};function $i(i){return i.indexOf("mapbox:")===0}fi.prototype._createSkuToken=function(){var i=function(){for(var s="",l=0;l<10;l++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ga,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt},fi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},fi.prototype.transformRequest=function(i,s){return this._transformRequestFn&&this._transformRequestFn(i,s)||{url:i}},fi.prototype.normalizeStyleURL=function(i,s){if(!$i(i))return i;var l=mo(i);return l.path="/styles/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},fi.prototype.normalizeGlyphsURL=function(i,s){if(!$i(i))return i;var l=mo(i);return l.path="/fonts/v1"+l.path,this._makeAPIURL(l,this._customAccessToken||s)},fi.prototype.normalizeSourceURL=function(i,s){if(!$i(i))return i;var l=mo(i);return l.path="/v4/"+l.authority+".json",l.params.push("secure"),this._makeAPIURL(l,this._customAccessToken||s)},fi.prototype.normalizeSpriteURL=function(i,s,l,d){var x=mo(i);return $i(i)?(x.path="/styles/v1"+x.path+"/sprite"+s+l,this._makeAPIURL(x,this._customAccessToken||d)):(x.path+=""+s+l,Ya(x))},fi.prototype.normalizeTileURL=function(i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!$i(i))return i;var l=mo(i);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Li.devicePixelRatio>=2||s===512?"@2x":"")+(on.supported?".webp":"$1")),l.path=l.path.replace(/^.+\/v4\//,"/"),l.path="/v4"+l.path;var d=this._customAccessToken||function(x){for(var C=0,T=x;C<T.length;C+=1){var O=T[C].match(/^access_token=(.*)$/);if(O)return O[1]}return null}(l.params)||gi.ACCESS_TOKEN;return gi.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&l.params.push("sku="+this._skuToken),this._makeAPIURL(l,d)},fi.prototype.canonicalizeTileURL=function(i,s){var l=mo(i);if(!l.path.match(/(^\/v4\/)/)||!l.path.match(/\.[\w]+$/))return i;var d="mapbox://tiles/";d+=l.path.replace("/v4/","");var x=l.params;return s&&(x=x.filter(function(C){return!C.match(/^access_token=/)})),x.length&&(d+="?"+x.join("&")),d},fi.prototype.canonicalizeTileset=function(i,s){for(var l=!!s&&$i(s),d=[],x=0,C=i.tiles||[];x<C.length;x+=1){var T=C[x];yi(T)?d.push(this.canonicalizeTileURL(T,l)):d.push(T)}return d},fi.prototype._makeAPIURL=function(i,s){var l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=mo(gi.API_URL);if(i.protocol=d.protocol,i.authority=d.authority,i.protocol==="http"){var x=i.params.indexOf("secure");x>=0&&i.params.splice(x,1)}if(d.path!=="/"&&(i.path=""+d.path+i.path),!gi.REQUIRE_ACCESS_TOKEN)return Ya(i);if(!(s=s||gi.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+l);if(s[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+l);return i.params=i.params.filter(function(C){return C.indexOf("access_token")===-1}),i.params.push("access_token="+s),Ya(i)};var hi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function yi(i){return hi.test(i)}var os=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function mo(i){var s=i.match(os);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function Ya(i){var s=i.params.length?"?"+i.params.join("&"):"";return i.protocol+"://"+i.authority+i.path+s}function Pt(i){if(!i)return null;var s=i.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(decodeURIComponent(we.atob(s[1]).split("").map(function(l){return"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(l){return null}}var xe=function(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};xe.prototype.getStorageKey=function(i){var s,l=Pt(gi.ACCESS_TOKEN);return s=l&&l.u?we.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,function(d,x){return String.fromCharCode(Number("0x"+x))})):gi.ACCESS_TOKEN||"",i?"mapbox.eventData."+i+":"+s:"mapbox.eventData:"+s},xe.prototype.fetchEventData=function(){var i=ze("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(i)try{var d=we.localStorage.getItem(s);d&&(this.eventData=JSON.parse(d));var x=we.localStorage.getItem(l);x&&(this.anonId=x)}catch(C){Ue("Unable to read from LocalStorage")}},xe.prototype.saveEventData=function(){var i=ze("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(i)try{we.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&we.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(d){Ue("Unable to write to LocalStorage")}},xe.prototype.processRequests=function(i){},xe.prototype.postEvent=function(i,s,l,d){var x=this;if(gi.EVENTS_URL){var C=mo(gi.EVENTS_URL);C.params.push("access_token="+(d||gi.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(i).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ga,userId:this.anonId},O=s?Yt(T,s):T,U={url:Ya(C),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=da(U,function(W){x.pendingRequest=null,l(W),x.saveEventData(),x.processRequests(d)})}},xe.prototype.queueRequest=function(i,s){this.queue.push(i),this.processRequests(s)};var ce,Te,j=function(i){function s(){i.call(this,"map.load"),this.success={},this.skuToken=""}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.postMapLoadEvent=function(l,d,x,C){this.skuToken=x,(gi.EVENTS_URL&&C||gi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(T){return $i(T)||yi(T)}))&&this.queueRequest({id:d,timestamp:Date.now()},C)},s.prototype.processRequests=function(l){var d=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),C=x.id,T=x.timestamp;C&&this.success[C]||(this.anonId||this.fetchEventData(),jt(this.anonId)||(this.anonId=It()),this.postEvent(T,{skuToken:this.skuToken},function(O){O||C&&(d.success[C]=!0)},l))}},s}(xe),st=new(function(i){function s(l){i.call(this,"appUserTurnstile"),this._customAccessToken=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.postTurnstileEvent=function(l,d){gi.EVENTS_URL&&gi.ACCESS_TOKEN&&Array.isArray(l)&&l.some(function(x){return $i(x)||yi(x)})&&this.queueRequest(Date.now(),d)},s.prototype.processRequests=function(l){var d=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=Pt(gi.ACCESS_TOKEN),C=x?x.u:gi.ACCESS_TOKEN,T=C!==this.eventData.tokenU;jt(this.anonId)||(this.anonId=It(),T=!0);var O=this.queue.shift();if(this.eventData.lastSuccess){var U=new Date(this.eventData.lastSuccess),W=new Date(O),$=(O-this.eventData.lastSuccess)/864e5;T=T||$>=1||$<-1||U.getDate()!==W.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(O,{"enabled.telemetry":!1},function(te){te||(d.eventData.lastSuccess=O,d.eventData.tokenU=C)},l)}},s}(xe)),ar=st.postTurnstileEvent.bind(st),Jr=new j,tt=Jr.postMapLoadEvent.bind(Jr),Ut=500,xr=50;function Cr(){we.caches&&!ce&&(ce=we.caches.open("mapbox-tiles"))}function Lr(i){var s=i.indexOf("?");return s<0?i:i.slice(0,s)}var vn,vi=1/0;function ni(){return vn==null&&(vn=we.OffscreenCanvas&&new we.OffscreenCanvas(1,1).getContext("2d")&&typeof we.createImageBitmap=="function"),vn}var An={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(An);var Oi=function(i){function s(l,d,x){d===401&&yi(x)&&(l+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),i.call(this,l),this.status=d,this.url=x,this.name=this.constructor.name,this.message=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},s}(Error),zi=fe()?function(){return self.worker&&self.worker.referrer}:function(){return(we.location.protocol==="blob:"?we.parent:we).location.href},Pa,ia,ao=function(i,s){if(!(/^file:/.test(l=i.url)||/^file:/.test(zi())&&!/^\w+:/.test(l))){if(we.fetch&&we.Request&&we.AbortController&&we.Request.prototype.hasOwnProperty("signal"))return function(d,x){var C,T=new we.AbortController,O=new we.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:zi(),signal:T.signal}),U=!1,W=!1,$=(C=O.url).indexOf("sku=")>0&&yi(C);d.type==="json"&&O.headers.set("Accept","application/json");var te=function(Ee,Ke,Je){if(!W){if(Ee&&Ee.message!=="SecurityError"&&Ue(Ee),Ke&&Je)return he(Ke);var mt=Date.now();we.fetch(O).then(function(ct){if(ct.ok){var Bt=$?ct.clone():null;return he(ct,Bt,mt)}return x(new Oi(ct.statusText,ct.status,d.url))}).catch(function(ct){ct.code!==20&&x(new Error(ct.message))})}},he=function(Ee,Ke,Je){(d.type==="arrayBuffer"?Ee.arrayBuffer():d.type==="json"?Ee.json():Ee.text()).then(function(mt){W||(Ke&&Je&&function(ct,Bt,Kt){if(Cr(),ce){var mr={status:Bt.status,statusText:Bt.statusText,headers:new we.Headers};Bt.headers.forEach(function(zr,fn){return mr.headers.set(fn,zr)});var gr=rt(Bt.headers.get("Cache-Control")||"");gr["no-store"]||(gr["max-age"]&&mr.headers.set("Expires",new Date(Kt+1e3*gr["max-age"]).toUTCString()),new Date(mr.headers.get("Expires")).getTime()-Kt<42e4||function(zr,fn){if(Te===void 0)try{new Response(new ReadableStream),Te=!0}catch(Un){Te=!1}Te?fn(zr.body):zr.blob().then(fn)}(Bt,function(zr){var fn=new we.Response(zr,mr);Cr(),ce&&ce.then(function(Un){return Un.put(Lr(ct.url),fn)}).catch(function(Un){return Ue(Un.message)})}))}}(O,Ke,Je),U=!0,x(null,mt,Ee.headers.get("Cache-Control"),Ee.headers.get("Expires")))}).catch(function(mt){W||x(new Error(mt.message))})};return $?function(Ee,Ke){if(Cr(),!ce)return Ke(null);var Je=Lr(Ee.url);ce.then(function(mt){mt.match(Je).then(function(ct){var Bt=function(Kt){if(!Kt)return!1;var mr=new Date(Kt.headers.get("Expires")||0),gr=rt(Kt.headers.get("Cache-Control")||"");return mr>Date.now()&&!gr["no-cache"]}(ct);mt.delete(Je),Bt&&mt.put(Je,ct.clone()),Ke(null,ct,Bt)}).catch(Ke)}).catch(Ke)}(O,te):te(null,null),{cancel:function(){W=!0,U||T.abort()}}}(i,s);if(fe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,s,void 0,!0)}var l;return function(d,x){var C=new we.XMLHttpRequest;for(var T in C.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(C.responseType="arraybuffer"),d.headers)C.setRequestHeader(T,d.headers[T]);return d.type==="json"&&(C.responseType="text",C.setRequestHeader("Accept","application/json")),C.withCredentials=d.credentials==="include",C.onerror=function(){x(new Error(C.statusText))},C.onload=function(){if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){var O=C.response;if(d.type==="json")try{O=JSON.parse(C.response)}catch(U){return x(U)}x(null,O,C.getResponseHeader("Cache-Control"),C.getResponseHeader("Expires"))}else x(new Oi(C.statusText,C.status,d.url))},C.send(d.body),{cancel:function(){return C.abort()}}}(i,s)},Ci=function(i,s){return ao(Yt(i,{type:"arrayBuffer"}),s)},da=function(i,s){return ao(Yt(i,{method:"POST"}),s)},J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Pa=[],ia=0;var se=function(i,s){if(on.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),ia>=gi.MAX_PARALLEL_IMAGE_REQUESTS){var l={requestParameters:i,callback:s,cancelled:!1,cancel:function(){this.cancelled=!0}};return Pa.push(l),l}ia++;var d=!1,x=function(){if(!d)for(d=!0,ia--;Pa.length&&ia<gi.MAX_PARALLEL_IMAGE_REQUESTS;){var T=Pa.shift();T.cancelled||(T.cancel=se(T.requestParameters,T.callback).cancel)}},C=Ci(i,function(T,O,U,W){x(),T?s(T):O&&(ni()?function($,te){var he=new we.Blob([new Uint8Array($)],{type:"image/png"});we.createImageBitmap(he).then(function(Ee){te(null,Ee)}).catch(function(Ee){te(new Error("Could not load image because of "+Ee.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(O,s):function($,te,he,Ee){var Ke=new we.Image,Je=we.URL;Ke.onload=function(){te(null,Ke),Je.revokeObjectURL(Ke.src),Ke.onload=null,we.requestAnimationFrame(function(){Ke.src=J})},Ke.onerror=function(){return te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var mt=new we.Blob([new Uint8Array($)],{type:"image/png"});Ke.cacheControl=he,Ke.expires=Ee,Ke.src=$.byteLength?Je.createObjectURL(mt):J}(O,s,U,W))});return{cancel:function(){C.cancel(),x()}}};function _e(i,s,l){l[i]&&l[i].indexOf(s)!==-1||(l[i]=l[i]||[],l[i].push(s))}function ke(i,s,l){if(l&&l[i]){var d=l[i].indexOf(s);d!==-1&&l[i].splice(d,1)}}var Ye=function(i,s){s===void 0&&(s={}),Yt(this,s),this.type=i},ut=function(i){function s(l,d){d===void 0&&(d={}),i.call(this,"error",Yt({error:l},d))}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Ye),xt=function(){};xt.prototype.on=function(i,s){return this._listeners=this._listeners||{},_e(i,s,this._listeners),this},xt.prototype.off=function(i,s){return ke(i,s,this._listeners),ke(i,s,this._oneTimeListeners),this},xt.prototype.once=function(i,s){return this._oneTimeListeners=this._oneTimeListeners||{},_e(i,s,this._oneTimeListeners),this},xt.prototype.fire=function(i,s){typeof i=="string"&&(i=new Ye(i,s||{}));var l=i.type;if(this.listens(l)){i.target=this;for(var d=0,x=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];d<x.length;d+=1)x[d].call(this,i);for(var C=0,T=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];C<T.length;C+=1){var O=T[C];ke(l,O,this._oneTimeListeners),O.call(this,i)}var U=this._eventedParent;U&&(Yt(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),U.fire(i))}else i instanceof ut&&console.error(i.error);return this},xt.prototype.listens=function(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)},xt.prototype.setEventedParent=function(i,s){return this._eventedParent=i,this._eventedParentData=s,this};var Ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},nt=function(i,s,l,d){this.message=(i?i+": ":"")+l,d&&(this.identifier=d),s!=null&&s.__line__&&(this.line=s.__line__)};function Ht(i){var s=i.value;return s?[new nt(i.key,s,"constants have been deprecated as of v8")]:[]}function jr(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];for(var d=0,x=s;d<x.length;d+=1){var C=x[d];for(var T in C)i[T]=C[T]}return i}function ir(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function pr(i){if(Array.isArray(i))return i.map(pr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){var s={};for(var l in i)s[l]=pr(i[l]);return s}return ir(i)}var Hr=function(i){function s(l,d){i.call(this,d),this.message=d,this.key=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Error),oi=function(i,s){s===void 0&&(s=[]),this.parent=i,this.bindings={};for(var l=0,d=s;l<d.length;l+=1){var x=d[l];this.bindings[x[0]]=x[1]}};oi.prototype.concat=function(i){return new oi(this,i)},oi.prototype.get=function(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(i+" not found in scope.")},oi.prototype.has=function(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)};var wn={kind:"null"},rr={kind:"number"},Wn={kind:"string"},Mr={kind:"boolean"},mn={kind:"color"},ea={kind:"object"},Zn={kind:"value"},na={kind:"collator"},Zt={kind:"formatted"},kt={kind:"resolvedImage"};function va(i,s){return{kind:"array",itemType:i,N:s}}function aa(i){if(i.kind==="array"){var s=aa(i.itemType);return typeof i.N=="number"?"array<"+s+", "+i.N+">":i.itemType.kind==="value"?"array":"array<"+s+">"}return i.kind}var Fi=[wn,rr,Wn,Mr,mn,Zt,ea,va(Zn),kt];function Mi(i,s){if(s.kind==="error")return null;if(i.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Mi(i.itemType,s.itemType))&&(typeof i.N!="number"||i.N===s.N))return null}else{if(i.kind===s.kind)return null;if(i.kind==="value"){for(var l=0,d=Fi;l<d.length;l+=1)if(!Mi(d[l],s))return null}}return"Expected "+aa(i)+" but found "+aa(s)+" instead."}function go(i,s){return s.some(function(l){return l.kind===i.kind})}function Ba(i,s){return s.some(function(l){return l==="null"?i===null:l==="array"?Array.isArray(i):l==="object"?i&&!Array.isArray(i)&&typeof i=="object":l===typeof i})}var Pr=Ne(function(i,s){var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(O){return(O=Math.round(O))<0?0:O>255?255:O}function x(O){return d(O[O.length-1]==="%"?parseFloat(O)/100*255:parseInt(O))}function C(O){return(U=O[O.length-1]==="%"?parseFloat(O)/100:parseFloat(O))<0?0:U>1?1:U;var U}function T(O,U,W){return W<0?W+=1:W>1&&(W-=1),6*W<1?O+(U-O)*W*6:2*W<1?U:3*W<2?O+(U-O)*(2/3-W)*6:O}try{s.parseCSSColor=function(O){var U,W=O.replace(/ /g,"").toLowerCase();if(W in l)return l[W].slice();if(W[0]==="#")return W.length===4?(U=parseInt(W.substr(1),16))>=0&&U<=4095?[(3840&U)>>4|(3840&U)>>8,240&U|(240&U)>>4,15&U|(15&U)<<4,1]:null:W.length===7&&(U=parseInt(W.substr(1),16))>=0&&U<=16777215?[(16711680&U)>>16,(65280&U)>>8,255&U,1]:null;var $=W.indexOf("("),te=W.indexOf(")");if($!==-1&&te+1===W.length){var he=W.substr(0,$),Ee=W.substr($+1,te-($+1)).split(","),Ke=1;switch(he){case"rgba":if(Ee.length!==4)return null;Ke=C(Ee.pop());case"rgb":return Ee.length!==3?null:[x(Ee[0]),x(Ee[1]),x(Ee[2]),Ke];case"hsla":if(Ee.length!==4)return null;Ke=C(Ee.pop());case"hsl":if(Ee.length!==3)return null;var Je=(parseFloat(Ee[0])%360+360)%360/360,mt=C(Ee[1]),ct=C(Ee[2]),Bt=ct<=.5?ct*(mt+1):ct+mt-ct*mt,Kt=2*ct-Bt;return[d(255*T(Kt,Bt,Je+1/3)),d(255*T(Kt,Bt,Je)),d(255*T(Kt,Bt,Je-1/3)),Ke];default:return null}}return null}}catch(O){}}).parseCSSColor,Or=function(i,s,l,d){d===void 0&&(d=1),this.r=i,this.g=s,this.b=l,this.a=d};Or.parse=function(i){if(i){if(i instanceof Or)return i;if(typeof i=="string"){var s=Pr(i);if(s)return new Or(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}}},Or.prototype.toString=function(){var i=this.toArray(),s=i[1],l=i[2],d=i[3];return"rgba("+Math.round(i[0])+","+Math.round(s)+","+Math.round(l)+","+d+")"},Or.prototype.toArray=function(){var i=this.a;return i===0?[0,0,0,0]:[255*this.r/i,255*this.g/i,255*this.b/i,i]},Or.black=new Or(0,0,0,1),Or.white=new Or(1,1,1,1),Or.transparent=new Or(0,0,0,0),Or.red=new Or(1,0,0,1);var Et=function(i,s,l){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Et.prototype.compare=function(i,s){return this.collator.compare(i,s)},Et.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var ss=function(i,s,l,d,x){this.text=i,this.image=s,this.scale=l,this.fontStack=d,this.textColor=x},bt=function(i){this.sections=i};bt.fromString=function(i){return new bt([new ss(i,null,null,null,null)])},bt.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(i){return i.text.length!==0||i.image&&i.image.name.length!==0})},bt.factory=function(i){return i instanceof bt?i:bt.fromString(i)},bt.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(i){return i.text}).join("")},bt.prototype.serialize=function(){for(var i=["format"],s=0,l=this.sections;s<l.length;s+=1){var d=l[s];if(d.image)i.push(["image",d.image.name]);else{i.push(d.text);var x={};d.fontStack&&(x["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(x["font-scale"]=d.scale),d.textColor&&(x["text-color"]=["rgba"].concat(d.textColor.toArray())),i.push(x)}}return i};var oo=function(i){this.name=i.name,this.available=i.available};function yu(i,s,l,d){return typeof i=="number"&&i>=0&&i<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:"Invalid rgba value ["+[i,s,l,d].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof d=="number"?[i,s,l,d]:[i,s,l]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Qo(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Or||i instanceof Et||i instanceof bt||i instanceof oo)return!0;if(Array.isArray(i)){for(var s=0,l=i;s<l.length;s+=1)if(!Qo(l[s]))return!1;return!0}if(typeof i=="object"){for(var d in i)if(!Qo(i[d]))return!1;return!0}return!1}function Bi(i){if(i===null)return wn;if(typeof i=="string")return Wn;if(typeof i=="boolean")return Mr;if(typeof i=="number")return rr;if(i instanceof Or)return mn;if(i instanceof Et)return na;if(i instanceof bt)return Zt;if(i instanceof oo)return kt;if(Array.isArray(i)){for(var s,l=i.length,d=0,x=i;d<x.length;d+=1){var C=Bi(x[d]);if(s){if(s===C)continue;s=Zn;break}s=C}return va(s||Zn,l)}return ea}function ml(i){var s=typeof i;return i===null?"":s==="string"||s==="number"||s==="boolean"?String(i):i instanceof Or||i instanceof bt||i instanceof oo?i.toString():JSON.stringify(i)}oo.prototype.toString=function(){return this.name},oo.fromString=function(i){return i?new oo({name:i,available:!1}):null},oo.prototype.serialize=function(){return["image",this.name]};var Ra=function(i,s){this.type=i,this.value=s};Ra.parse=function(i,s){if(i.length!==2)return s.error("'literal' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(!Qo(i[1]))return s.error("invalid value");var l=i[1],d=Bi(l),x=s.expectedType;return d.kind!=="array"||d.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(d=x),new Ra(d,l)},Ra.prototype.evaluate=function(){return this.value},Ra.prototype.eachChild=function(){},Ra.prototype.outputDefined=function(){return!0},Ra.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Or?["rgba"].concat(this.value.toArray()):this.value instanceof bt?this.value.serialize():this.value};var Lo=function(i){this.name="ExpressionEvaluationError",this.message=i};Lo.prototype.toJSON=function(){return this.message};var Do={string:Wn,number:rr,boolean:Mr,object:ea},ba=function(i,s){this.type=i,this.args=s};ba.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l,d=1,x=i[0];if(x==="array"){var C,T;if(i.length>2){var O=i[1];if(typeof O!="string"||!(O in Do)||O==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);C=Do[O],d++}else C=Zn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);T=i[2],d++}l=va(C,T)}else l=Do[x];for(var U=[];d<i.length;d++){var W=s.parse(i[d],d,Zn);if(!W)return null;U.push(W)}return new ba(l,U)},ba.prototype.evaluate=function(i){for(var s=0;s<this.args.length;s++){var l=this.args[s].evaluate(i);if(!Mi(this.type,Bi(l)))return l;if(s===this.args.length-1)throw new Lo("Expected value to be of type "+aa(this.type)+", but found "+aa(Bi(l))+" instead.")}return null},ba.prototype.eachChild=function(i){this.args.forEach(i)},ba.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},ba.prototype.serialize=function(){var i=this.type,s=[i.kind];if(i.kind==="array"){var l=i.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){s.push(l.kind);var d=i.N;(typeof d=="number"||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(function(x){return x.serialize()}))};var Ps=function(i){this.type=Zt,this.sections=i};Ps.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l=i[1];if(!Array.isArray(l)&&typeof l=="object")return s.error("First argument must be an image or text section.");for(var d=[],x=!1,C=1;C<=i.length-1;++C){var T=i[C];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;var O=null;if(T["font-scale"]&&!(O=s.parse(T["font-scale"],1,rr)))return null;var U=null;if(T["text-font"]&&!(U=s.parse(T["text-font"],1,va(Wn))))return null;var W=null;if(T["text-color"]&&!(W=s.parse(T["text-color"],1,mn)))return null;var $=d[d.length-1];$.scale=O,$.font=U,$.textColor=W}else{var te=s.parse(i[C],1,Zn);if(!te)return null;var he=te.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,d.push({content:te,scale:null,font:null,textColor:null})}}return new Ps(d)},Ps.prototype.evaluate=function(i){return new bt(this.sections.map(function(s){var l=s.content.evaluate(i);return Bi(l)===kt?new ss("",l,null,null,null):new ss(ml(l),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))},Ps.prototype.eachChild=function(i){for(var s=0,l=this.sections;s<l.length;s+=1){var d=l[s];i(d.content),d.scale&&i(d.scale),d.font&&i(d.font),d.textColor&&i(d.textColor)}},Ps.prototype.outputDefined=function(){return!1},Ps.prototype.serialize=function(){for(var i=["format"],s=0,l=this.sections;s<l.length;s+=1){var d=l[s];i.push(d.content.serialize());var x={};d.scale&&(x["font-scale"]=d.scale.serialize()),d.font&&(x["text-font"]=d.font.serialize()),d.textColor&&(x["text-color"]=d.textColor.serialize()),i.push(x)}return i};var Ls=function(i){this.type=kt,this.input=i};Ls.parse=function(i,s){if(i.length!==2)return s.error("Expected two arguments.");var l=s.parse(i[1],1,Wn);return l?new Ls(l):s.error("No image name provided.")},Ls.prototype.evaluate=function(i){var s=this.input.evaluate(i),l=oo.fromString(s);return l&&i.availableImages&&(l.available=i.availableImages.indexOf(s)>-1),l},Ls.prototype.eachChild=function(i){i(this.input)},Ls.prototype.outputDefined=function(){return!1},Ls.prototype.serialize=function(){return["image",this.input.serialize()]};var Ql={"to-boolean":Mr,"to-color":mn,"to-number":rr,"to-string":Wn},fo=function(i,s){this.type=i,this.args=s};fo.parse=function(i,s){if(i.length<2)return s.error("Expected at least one argument.");var l=i[0];if((l==="to-boolean"||l==="to-string")&&i.length!==2)return s.error("Expected one argument.");for(var d=Ql[l],x=[],C=1;C<i.length;C++){var T=s.parse(i[C],C,Zn);if(!T)return null;x.push(T)}return new fo(d,x)},fo.prototype.evaluate=function(i){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(i));if(this.type.kind==="color"){for(var s,l,d=0,x=this.args;d<x.length;d+=1){if(l=null,(s=x[d].evaluate(i))instanceof Or)return s;if(typeof s=="string"){var C=i.parseColor(s);if(C)return C}else if(Array.isArray(s)&&!(l=s.length<3||s.length>4?"Invalid rbga value "+JSON.stringify(s)+": expected an array containing either three or four numeric values.":yu(s[0],s[1],s[2],s[3])))return new Or(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Lo(l||"Could not parse color from value '"+(typeof s=="string"?s:String(JSON.stringify(s)))+"'")}if(this.type.kind==="number"){for(var T=null,O=0,U=this.args;O<U.length;O+=1){if((T=U[O].evaluate(i))===null)return 0;var W=Number(T);if(!isNaN(W))return W}throw new Lo("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?bt.fromString(ml(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?oo.fromString(ml(this.args[0].evaluate(i))):ml(this.args[0].evaluate(i))},fo.prototype.eachChild=function(i){this.args.forEach(i)},fo.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},fo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ps([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ls(this.args[0]).serialize();var i=["to-"+this.type.kind];return this.eachChild(function(s){i.push(s.serialize())}),i};var ds=["Unknown","Point","LineString","Polygon"],Va=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Va.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Va.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ds[this.feature.type]:this.feature.type:null},Va.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Va.prototype.canonicalID=function(){return this.canonical},Va.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Va.prototype.parseColor=function(i){var s=this._parseColorCache[i];return s||(s=this._parseColorCache[i]=Or.parse(i)),s};var Bo=function(i,s,l,d){this.name=i,this.type=s,this._evaluate=l,this.args=d};Bo.prototype.evaluate=function(i){return this._evaluate(i,this.args)},Bo.prototype.eachChild=function(i){this.args.forEach(i)},Bo.prototype.outputDefined=function(){return!1},Bo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(i){return i.serialize()}))},Bo.parse=function(i,s){var l,d=i[0],x=Bo.definitions[d];if(!x)return s.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0);for(var C=Array.isArray(x)?x[0]:x.type,T=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,O=T.filter(function(Ii){var Kn=Ii[0];return!Array.isArray(Kn)||Kn.length===i.length-1}),U=null,W=0,$=O;W<$.length;W+=1){var te=$[W],he=te[0],Ee=te[1];U=new Vu(s.registry,s.path,null,s.scope);for(var Ke=[],Je=!1,mt=1;mt<i.length;mt++){var ct=i[mt],Bt=Array.isArray(he)?he[mt-1]:he.type,Kt=U.parse(ct,1+Ke.length,Bt);if(!Kt){Je=!0;break}Ke.push(Kt)}if(!Je)if(Array.isArray(he)&&he.length!==Ke.length)U.error("Expected "+he.length+" arguments, but found "+Ke.length+" instead.");else{for(var mr=0;mr<Ke.length;mr++){var gr=Array.isArray(he)?he[mr]:he.type,zr=Ke[mr];U.concat(mr+1).checkSubtype(gr,zr.type)}if(U.errors.length===0)return new Bo(d,C,Ee,Ke)}}if(O.length===1)(l=s.errors).push.apply(l,U.errors);else{for(var fn=(O.length?O:T).map(function(Ii){var Kn;return Kn=Ii[0],Array.isArray(Kn)?"("+Kn.map(aa).join(", ")+")":"("+aa(Kn.type)+"...)"}).join(" | "),Un=[],Ai=1;Ai<i.length;Ai++){var ei=s.parse(i[Ai],1+Un.length);if(!ei)return null;Un.push(aa(ei.type))}s.error("Expected arguments of type "+fn+", but found ("+Un.join(", ")+") instead.")}return null},Bo.register=function(i,s){for(var l in Bo.definitions=s,s)i[l]=Bo};var vs=function(i,s,l){this.type=na,this.locale=l,this.caseSensitive=i,this.diacriticSensitive=s};function No(i,s){i[0]=Math.min(i[0],s[0]),i[1]=Math.min(i[1],s[1]),i[2]=Math.max(i[2],s[0]),i[3]=Math.max(i[3],s[1])}function Qu(i,s){return!(i[0]<=s[0]||i[2]>=s[2]||i[1]<=s[1]||i[3]>=s[3])}function Zu(i,s){var l=(180+i[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,x=Math.pow(2,s.z);return[Math.round(l*x*8192),Math.round(d*x*8192)]}function Vo(i,s,l){return s[1]>i[1]!=l[1]>i[1]&&i[0]<(l[0]-s[0])*(i[1]-s[1])/(l[1]-s[1])+s[0]}function me(i,s){for(var l,d,x,C,T,O,U,W=!1,$=0,te=s.length;$<te;$++)for(var he=s[$],Ee=0,Ke=he.length;Ee<Ke-1;Ee++){if((C=(l=i)[0]-(d=he[Ee])[0])*(U=l[1]-(x=he[Ee+1])[1])-(O=l[0]-x[0])*(T=l[1]-d[1])==0&&C*O<=0&&T*U<=0)return!1;Vo(i,he[Ee],he[Ee+1])&&(W=!W)}return W}function De(i,s){for(var l=0;l<s.length;l++)if(me(i,s[l]))return!0;return!1}function _t(i,s,l,d){var x=d[0]-l[0],C=d[1]-l[1],T=(i[0]-l[0])*C-x*(i[1]-l[1]),O=(s[0]-l[0])*C-x*(s[1]-l[1]);return T>0&&O<0||T<0&&O>0}function lr(i,s,l){for(var d=0,x=l;d<x.length;d+=1)for(var C=x[d],T=0;T<C.length-1;++T)if((te=[($=C[T+1])[0]-(W=C[T])[0],$[1]-W[1]])[0]*(he=[(U=s)[0]-(O=i)[0],U[1]-O[1]])[1]-te[1]*he[0]!=0&&_t(O,U,W,$)&&_t(W,$,O,U))return!0;var O,U,W,$,te,he;return!1}function xn(i,s){for(var l=0;l<i.length;++l)if(!me(i[l],s))return!1;for(var d=0;d<i.length-1;++d)if(lr(i[d],i[d+1],s))return!1;return!0}function ti(i,s){for(var l=0;l<s.length;l++)if(xn(i,s[l]))return!0;return!1}function ya(i,s,l){for(var d=[],x=0;x<i.length;x++){for(var C=[],T=0;T<i[x].length;T++){var O=Zu(i[x][T],l);No(s,O),C.push(O)}d.push(C)}return d}function jo(i,s,l){for(var d=[],x=0;x<i.length;x++){var C=ya(i[x],s,l);d.push(C)}return d}function Oa(i,s,l,d){if(i[0]<l[0]||i[0]>l[2]){var x=.5*d,C=i[0]-l[0]>x?-d:l[0]-i[0]>x?d:0;C===0&&(C=i[0]-l[2]>x?-d:l[2]-i[0]>x?d:0),i[0]+=C}No(s,i)}function zo(i,s,l,d){for(var x=8192*Math.pow(2,d.z),C=[8192*d.x,8192*d.y],T=[],O=0,U=i;O<U.length;O+=1)for(var W=0,$=U[O];W<$.length;W+=1){var te=$[W],he=[te.x+C[0],te.y+C[1]];Oa(he,s,l,x),T.push(he)}return T}function So(i,s,l,d){for(var x,C=8192*Math.pow(2,d.z),T=[8192*d.x,8192*d.y],O=[],U=0,W=i;U<W.length;U+=1){for(var $=[],te=0,he=W[U];te<he.length;te+=1){var Ee=he[te],Ke=[Ee.x+T[0],Ee.y+T[1]];No(s,Ke),$.push(Ke)}O.push($)}if(s[2]-s[0]<=C/2){(x=s)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var Je=0,mt=O;Je<mt.length;Je+=1)for(var ct=0,Bt=mt[Je];ct<Bt.length;ct+=1)Oa(Bt[ct],s,l,C)}return O}vs.parse=function(i,s){if(i.length!==2)return s.error("Expected one argument.");var l=i[1];if(typeof l!="object"||Array.isArray(l))return s.error("Collator options argument must be an object.");var d=s.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Mr);if(!d)return null;var x=s.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Mr);if(!x)return null;var C=null;return l.locale&&!(C=s.parse(l.locale,1,Wn))?null:new vs(d,x,C)},vs.prototype.evaluate=function(i){return new Et(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)},vs.prototype.eachChild=function(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)},vs.prototype.outputDefined=function(){return!1},vs.prototype.serialize=function(){var i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]};var so=function(i,s){this.type=Mr,this.geojson=i,this.geometries=s};function Rs(i){if(i instanceof Bo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof so)return!1;var s=!0;return i.eachChild(function(l){s&&!Rs(l)&&(s=!1)}),s}function eu(i){if(i instanceof Bo&&i.name==="feature-state")return!1;var s=!0;return i.eachChild(function(l){s&&!eu(l)&&(s=!1)}),s}function su(i,s){if(i instanceof Bo&&s.indexOf(i.name)>=0)return!1;var l=!0;return i.eachChild(function(d){l&&!su(d,s)&&(l=!1)}),l}so.parse=function(i,s){if(i.length!==2)return s.error("'within' expression requires exactly one argument, but found "+(i.length-1)+" instead.");if(Qo(i[1])){var l=i[1];if(l.type==="FeatureCollection")for(var d=0;d<l.features.length;++d){var x=l.features[d].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new so(l,l.features[d].geometry)}else if(l.type==="Feature"){var C=l.geometry.type;if(C==="Polygon"||C==="MultiPolygon")return new so(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new so(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")},so.prototype.evaluate=function(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(s,l){var d=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var T=ya(l.coordinates,x,C),O=zo(s.geometry(),d,x,C);if(!Qu(d,x))return!1;for(var U=0,W=O;U<W.length;U+=1)if(!me(W[U],T))return!1}if(l.type==="MultiPolygon"){var $=jo(l.coordinates,x,C),te=zo(s.geometry(),d,x,C);if(!Qu(d,x))return!1;for(var he=0,Ee=te;he<Ee.length;he+=1)if(!De(Ee[he],$))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(s,l){var d=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],C=s.canonicalID();if(l.type==="Polygon"){var T=ya(l.coordinates,x,C),O=So(s.geometry(),d,x,C);if(!Qu(d,x))return!1;for(var U=0,W=O;U<W.length;U+=1)if(!xn(W[U],T))return!1}if(l.type==="MultiPolygon"){var $=jo(l.coordinates,x,C),te=So(s.geometry(),d,x,C);if(!Qu(d,x))return!1;for(var he=0,Ee=te;he<Ee.length;he+=1)if(!ti(Ee[he],$))return!1}return!0}(i,this.geometries)}return!1},so.prototype.eachChild=function(){},so.prototype.outputDefined=function(){return!0},so.prototype.serialize=function(){return["within",this.geojson]};var _u=function(i,s){this.type=s.type,this.name=i,this.boundExpression=s};_u.parse=function(i,s){if(i.length!==2||typeof i[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");var l=i[1];return s.scope.has(l)?new _u(l,s.scope.get(l)):s.error('Unknown variable "'+l+'". Make sure "'+l+'" has been bound in an enclosing "let" expression before using it.',1)},_u.prototype.evaluate=function(i){return this.boundExpression.evaluate(i)},_u.prototype.eachChild=function(){},_u.prototype.outputDefined=function(){return!1},_u.prototype.serialize=function(){return["var",this.name]};var Vu=function(i,s,l,d,x){s===void 0&&(s=[]),d===void 0&&(d=new oi),x===void 0&&(x=[]),this.registry=i,this.path=s,this.key=s.map(function(C){return"["+C+"]"}).join(""),this.scope=d,this.errors=x,this.expectedType=l};function xu(i,s){for(var l,d=i.length-1,x=0,C=d,T=0;x<=C;)if((l=i[T=Math.floor((x+C)/2)])<=s){if(T===d||s<i[T+1])return T;x=T+1}else{if(!(l>s))throw new Lo("Input is not a number.");C=T-1}return 0}Vu.prototype.parse=function(i,s,l,d,x){return x===void 0&&(x={}),s?this.concat(s,l,d)._parse(i,x):this._parse(i,x)},Vu.prototype._parse=function(i,s){function l(W,$,te){return te==="assert"?new ba($,[W]):te==="coerce"?new fo($,[W]):W}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var d=i[0];if(typeof d!="string")return this.error("Expression name must be a string, but found "+typeof d+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[d];if(x){var C=x.parse(i,this);if(!C)return null;if(this.expectedType){var T=this.expectedType,O=C.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||O.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string"){if(this.checkSubtype(T,O))return null}else C=l(C,T,s.typeAnnotation||"coerce");else C=l(C,T,s.typeAnnotation||"assert")}if(!(C instanceof Ra)&&C.type.kind!=="resolvedImage"&&function W($){if($ instanceof _u)return W($.boundExpression);if($ instanceof Bo&&$.name==="error"||$ instanceof vs||$ instanceof so)return!1;var te=$ instanceof fo||$ instanceof ba,he=!0;return $.eachChild(function(Ee){he=te?he&&W(Ee):he&&Ee instanceof Ra}),!!he&&Rs($)&&su($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(C)){var U=new Va;try{C=new Ra(C.type,C.evaluate(U))}catch(W){return this.error(W.message),null}}return C}return this.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof i+" instead.")},Vu.prototype.concat=function(i,s,l){var d=typeof i=="number"?this.path.concat(i):this.path,x=l?this.scope.concat(l):this.scope;return new Vu(this.registry,d,s||null,x,this.errors)},Vu.prototype.error=function(i){for(var s=[],l=arguments.length-1;l-- >0;)s[l]=arguments[l+1];var d=""+this.key+s.map(function(x){return"["+x+"]"}).join("");this.errors.push(new Hr(d,i))},Vu.prototype.checkSubtype=function(i,s){var l=Mi(i,s);return l&&this.error(l),l};var Ro=function(i,s,l){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(var d=0,x=l;d<x.length;d+=1){var C=x[d],T=C[1];this.labels.push(C[0]),this.outputs.push(T)}};function ha(i,s,l){return i*(1-l)+s*l}Ro.parse=function(i,s){if(i.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");var l=s.parse(i[1],1,rr);if(!l)return null;var d=[],x=null;s.expectedType&&s.expectedType.kind!=="value"&&(x=s.expectedType);for(var C=1;C<i.length;C+=2){var T=C===1?-1/0:i[C],O=i[C+1],U=C,W=C+1;if(typeof T!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(d.length&&d[d.length-1][0]>=T)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',U);var $=s.parse(O,W,x);if(!$)return null;x=x||$.type,d.push([T,$])}return new Ro(x,l,d)},Ro.prototype.evaluate=function(i){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(i);var d=this.input.evaluate(i);if(d<=s[0])return l[0].evaluate(i);var x=s.length;return d>=s[x-1]?l[x-1].evaluate(i):l[xu(s,d)].evaluate(i)},Ro.prototype.eachChild=function(i){i(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)i(l[s])},Ro.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Ro.prototype.serialize=function(){for(var i=["step",this.input.serialize()],s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i};var As=Object.freeze({__proto__:null,number:ha,color:function(i,s,l){return new Or(ha(i.r,s.r,l),ha(i.g,s.g,l),ha(i.b,s.b,l),ha(i.a,s.a,l))},array:function(i,s,l){return i.map(function(d,x){return ha(d,s[x],l)})}}),Sh=6/29*3*(6/29),Ju=Math.PI/180,pf=180/Math.PI;function Wf(i){return i>.008856451679035631?Math.pow(i,1/3):i/Sh+4/29}function gl(i){return i>6/29?i*i*i:Sh*(i-4/29)}function Ac(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function yl(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function df(i){var s=yl(i.r),l=yl(i.g),d=yl(i.b),x=Wf((.4124564*s+.3575761*l+.1804375*d)/.95047),C=Wf((.2126729*s+.7151522*l+.072175*d)/1);return{l:116*C-16,a:500*(x-C),b:200*(C-Wf((.0193339*s+.119192*l+.9503041*d)/1.08883)),alpha:i.a}}function E(i){var s=(i.l+16)/116,l=isNaN(i.a)?s:s+i.a/500,d=isNaN(i.b)?s:s-i.b/200;return s=1*gl(s),l=.95047*gl(l),d=1.08883*gl(d),new Or(Ac(3.2404542*l-1.5371385*s-.4985314*d),Ac(-.969266*l+1.8760108*s+.041556*d),Ac(.0556434*l-.2040259*s+1.0572252*d),i.alpha)}function P(i,s,l){var d=s-i;return i+l*(d>180||d<-180?d-360*Math.round(d/360):d)}var G={forward:df,reverse:E,interpolate:function(i,s,l){return{l:ha(i.l,s.l,l),a:ha(i.a,s.a,l),b:ha(i.b,s.b,l),alpha:ha(i.alpha,s.alpha,l)}}},D={forward:function(i){var s=df(i),l=s.l,d=s.a,x=s.b,C=Math.atan2(x,d)*pf;return{h:C<0?C+360:C,c:Math.sqrt(d*d+x*x),l,alpha:i.a}},reverse:function(i){var s=i.h*Ju,l=i.c;return E({l:i.l,a:Math.cos(s)*l,b:Math.sin(s)*l,alpha:i.alpha})},interpolate:function(i,s,l){return{h:P(i.h,s.h,l),c:ha(i.c,s.c,l),l:ha(i.l,s.l,l),alpha:ha(i.alpha,s.alpha,l)}}},oe=Object.freeze({__proto__:null,lab:G,hcl:D}),Fe=function(i,s,l,d,x){this.type=i,this.operator=s,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(var C=0,T=x;C<T.length;C+=1){var O=T[C],U=O[1];this.labels.push(O[0]),this.outputs.push(U)}};function vt(i,s,l,d){var x=d-l,C=i-l;return x===0?0:s===1?C/x:(Math.pow(s,C)-1)/(Math.pow(s,x)-1)}Fe.interpolationFactor=function(i,s,l,d){var x=0;if(i.name==="exponential")x=vt(s,i.base,l,d);else if(i.name==="linear")x=vt(s,1,l,d);else if(i.name==="cubic-bezier"){var C=i.controlPoints;x=new Q(C[0],C[1],C[2],C[3]).solve(vt(s,1,l,d))}return x},Fe.parse=function(i,s){var l=i[0],d=i[1],x=i[2],C=i.slice(3);if(!Array.isArray(d)||d.length===0)return s.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){var T=d[1];if(typeof T!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return s.error("Unknown interpolation type "+String(d[0]),1,0);var O=d.slice(1);if(O.length!==4||O.some(function(mt){return typeof mt!="number"||mt<0||mt>1}))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:O}}if(i.length-1<4)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(!(x=s.parse(x,2,rr)))return null;var U=[],W=null;l==="interpolate-hcl"||l==="interpolate-lab"?W=mn:s.expectedType&&s.expectedType.kind!=="value"&&(W=s.expectedType);for(var $=0;$<C.length;$+=2){var te=C[$],he=C[$+1],Ee=$+3,Ke=$+4;if(typeof te!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ee);if(U.length&&U[U.length-1][0]>=te)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ee);var Je=s.parse(he,Ke,W);if(!Je)return null;W=W||Je.type,U.push([te,Je])}return W.kind==="number"||W.kind==="color"||W.kind==="array"&&W.itemType.kind==="number"&&typeof W.N=="number"?new Fe(W,l,d,x,U):s.error("Type "+aa(W)+" is not interpolatable.")},Fe.prototype.evaluate=function(i){var s=this.labels,l=this.outputs;if(s.length===1)return l[0].evaluate(i);var d=this.input.evaluate(i);if(d<=s[0])return l[0].evaluate(i);var x=s.length;if(d>=s[x-1])return l[x-1].evaluate(i);var C=xu(s,d),T=Fe.interpolationFactor(this.interpolation,d,s[C],s[C+1]),O=l[C].evaluate(i),U=l[C+1].evaluate(i);return this.operator==="interpolate"?As[this.type.kind.toLowerCase()](O,U,T):this.operator==="interpolate-hcl"?D.reverse(D.interpolate(D.forward(O),D.forward(U),T)):G.reverse(G.interpolate(G.forward(O),G.forward(U),T))},Fe.prototype.eachChild=function(i){i(this.input);for(var s=0,l=this.outputs;s<l.length;s+=1)i(l[s])},Fe.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})},Fe.prototype.serialize=function(){var i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var s=[this.operator,i,this.input.serialize()],l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s};var Mt=function(i,s){this.type=i,this.args=s};Mt.parse=function(i,s){if(i.length<2)return s.error("Expectected at least one argument.");var l=null,d=s.expectedType;d&&d.kind!=="value"&&(l=d);for(var x=[],C=0,T=i.slice(1);C<T.length;C+=1){var O=s.parse(T[C],1+x.length,l,void 0,{typeAnnotation:"omit"});if(!O)return null;l=l||O.type,x.push(O)}var U=d&&x.some(function(W){return Mi(d,W.type)});return new Mt(U?Zn:l,x)},Mt.prototype.evaluate=function(i){for(var s,l=null,d=0,x=0,C=this.args;x<C.length&&(d++,(l=C[x].evaluate(i))&&l instanceof oo&&!l.available&&(s||(s=l.name),l=null,d===this.args.length&&(l=s)),l===null);x+=1);return l},Mt.prototype.eachChild=function(i){this.args.forEach(i)},Mt.prototype.outputDefined=function(){return this.args.every(function(i){return i.outputDefined()})},Mt.prototype.serialize=function(){var i=["coalesce"];return this.eachChild(function(s){i.push(s.serialize())}),i};var Dt=function(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s};Dt.prototype.evaluate=function(i){return this.result.evaluate(i)},Dt.prototype.eachChild=function(i){for(var s=0,l=this.bindings;s<l.length;s+=1)i(l[s][1]);i(this.result)},Dt.parse=function(i,s){if(i.length<4)return s.error("Expected at least 3 arguments, but found "+(i.length-1)+" instead.");for(var l=[],d=1;d<i.length-1;d+=2){var x=i[d];if(typeof x!="string")return s.error("Expected string, but found "+typeof x+" instead.",d);if(/[^a-zA-Z0-9_]/.test(x))return s.error("Variable names must contain only alphanumeric characters or '_'.",d);var C=s.parse(i[d+1],d+1);if(!C)return null;l.push([x,C])}var T=s.parse(i[i.length-1],i.length-1,s.expectedType,l);return T?new Dt(l,T):null},Dt.prototype.outputDefined=function(){return this.result.outputDefined()},Dt.prototype.serialize=function(){for(var i=["let"],s=0,l=this.bindings;s<l.length;s+=1){var d=l[s];i.push(d[0],d[1].serialize())}return i.push(this.result.serialize()),i};var Nr=function(i,s,l){this.type=i,this.index=s,this.input=l};Nr.parse=function(i,s){if(i.length!==3)return s.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,rr),d=s.parse(i[2],2,va(s.expectedType||Zn));return l&&d?new Nr(d.type.itemType,l,d):null},Nr.prototype.evaluate=function(i){var s=this.index.evaluate(i),l=this.input.evaluate(i);if(s<0)throw new Lo("Array index out of bounds: "+s+" < 0.");if(s>=l.length)throw new Lo("Array index out of bounds: "+s+" > "+(l.length-1)+".");if(s!==Math.floor(s))throw new Lo("Array index must be an integer, but found "+s+" instead.");return l[s]},Nr.prototype.eachChild=function(i){i(this.index),i(this.input)},Nr.prototype.outputDefined=function(){return!1},Nr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Xr=function(i,s){this.type=Mr,this.needle=i,this.haystack=s};Xr.parse=function(i,s){if(i.length!==3)return s.error("Expected 2 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,Zn),d=s.parse(i[2],2,Zn);return l&&d?go(l.type,[Mr,Wn,rr,wn,Zn])?new Xr(l,d):s.error("Expected first argument to be of type boolean, string, number or null, but found "+aa(l.type)+" instead"):null},Xr.prototype.evaluate=function(i){var s=this.needle.evaluate(i),l=this.haystack.evaluate(i);if(!l)return!1;if(!Ba(s,["boolean","string","number","null"]))throw new Lo("Expected first argument to be of type boolean, string, number or null, but found "+aa(Bi(s))+" instead.");if(!Ba(l,["string","array"]))throw new Lo("Expected second argument to be of type array or string, but found "+aa(Bi(l))+" instead.");return l.indexOf(s)>=0},Xr.prototype.eachChild=function(i){i(this.needle),i(this.haystack)},Xr.prototype.outputDefined=function(){return!0},Xr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Qn=function(i,s,l){this.type=rr,this.needle=i,this.haystack=s,this.fromIndex=l};Qn.parse=function(i,s){if(i.length<=2||i.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,Zn),d=s.parse(i[2],2,Zn);if(!l||!d)return null;if(!go(l.type,[Mr,Wn,rr,wn,Zn]))return s.error("Expected first argument to be of type boolean, string, number or null, but found "+aa(l.type)+" instead");if(i.length===4){var x=s.parse(i[3],3,rr);return x?new Qn(l,d,x):null}return new Qn(l,d)},Qn.prototype.evaluate=function(i){var s=this.needle.evaluate(i),l=this.haystack.evaluate(i);if(!Ba(s,["boolean","string","number","null"]))throw new Lo("Expected first argument to be of type boolean, string, number or null, but found "+aa(Bi(s))+" instead.");if(!Ba(l,["string","array"]))throw new Lo("Expected second argument to be of type array or string, but found "+aa(Bi(l))+" instead.");if(this.fromIndex){var d=this.fromIndex.evaluate(i);return l.indexOf(s,d)}return l.indexOf(s)},Qn.prototype.eachChild=function(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)},Qn.prototype.outputDefined=function(){return!1},Qn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ki=function(i,s,l,d,x,C){this.inputType=i,this.type=s,this.input=l,this.cases=d,this.outputs=x,this.otherwise=C};Ki.parse=function(i,s){if(i.length<5)return s.error("Expected at least 4 arguments, but found only "+(i.length-1)+".");if(i.length%2!=1)return s.error("Expected an even number of arguments.");var l,d;s.expectedType&&s.expectedType.kind!=="value"&&(d=s.expectedType);for(var x={},C=[],T=2;T<i.length-1;T+=2){var O=i[T],U=i[T+1];Array.isArray(O)||(O=[O]);var W=s.concat(T);if(O.length===0)return W.error("Expected at least one branch label.");for(var $=0,te=O;$<te.length;$+=1){var he=te[$];if(typeof he!="number"&&typeof he!="string")return W.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return W.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return W.error("Numeric branch labels must be integer values.");if(l){if(W.checkSubtype(l,Bi(he)))return null}else l=Bi(he);if(x[String(he)]!==void 0)return W.error("Branch labels must be unique.");x[String(he)]=C.length}var Ee=s.parse(U,T,d);if(!Ee)return null;d=d||Ee.type,C.push(Ee)}var Ke=s.parse(i[1],1,Zn);if(!Ke)return null;var Je=s.parse(i[i.length-1],i.length-1,d);return Je?Ke.type.kind!=="value"&&s.concat(1).checkSubtype(l,Ke.type)?null:new Ki(l,d,Ke,x,C,Je):null},Ki.prototype.evaluate=function(i){var s=this.input.evaluate(i);return(Bi(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)},Ki.prototype.eachChild=function(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)},Ki.prototype.outputDefined=function(){return this.outputs.every(function(i){return i.outputDefined()})&&this.otherwise.outputDefined()},Ki.prototype.serialize=function(){for(var i=this,s=["match",this.input.serialize()],l=[],d={},x=0,C=Object.keys(this.cases).sort();x<C.length;x+=1){var T=C[x];(te=d[this.cases[T]])===void 0?(d[this.cases[T]]=l.length,l.push([this.cases[T],[T]])):l[te][1].push(T)}for(var O=function(Ee){return i.inputType.kind==="number"?Number(Ee):Ee},U=0,W=l;U<W.length;U+=1){var $=W[U],te=$[0],he=$[1];s.push(he.length===1?O(he[0]):he.map(O)),s.push(this.outputs[outputIndex$1].serialize())}return s.push(this.otherwise.serialize()),s};var ji=function(i,s,l){this.type=i,this.branches=s,this.otherwise=l};ji.parse=function(i,s){if(i.length<4)return s.error("Expected at least 3 arguments, but found only "+(i.length-1)+".");if(i.length%2!=0)return s.error("Expected an odd number of arguments.");var l;s.expectedType&&s.expectedType.kind!=="value"&&(l=s.expectedType);for(var d=[],x=1;x<i.length-1;x+=2){var C=s.parse(i[x],x,Mr);if(!C)return null;var T=s.parse(i[x+1],x+1,l);if(!T)return null;d.push([C,T]),l=l||T.type}var O=s.parse(i[i.length-1],i.length-1,l);return O?new ji(l,d,O):null},ji.prototype.evaluate=function(i){for(var s=0,l=this.branches;s<l.length;s+=1){var d=l[s],x=d[1];if(d[0].evaluate(i))return x.evaluate(i)}return this.otherwise.evaluate(i)},ji.prototype.eachChild=function(i){for(var s=0,l=this.branches;s<l.length;s+=1){var d=l[s],x=d[1];i(d[0]),i(x)}i(this.otherwise)},ji.prototype.outputDefined=function(){return this.branches.every(function(i){return i[1].outputDefined()})&&this.otherwise.outputDefined()},ji.prototype.serialize=function(){var i=["case"];return this.eachChild(function(s){i.push(s.serialize())}),i};var pa=function(i,s,l,d){this.type=i,this.input=s,this.beginIndex=l,this.endIndex=d};function Ka(i,s){return i==="=="||i==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function yo(i,s,l,d){return d.compare(s,l)===0}function wa(i,s,l){var d=i!=="=="&&i!=="!=";return function(){function x(C,T,O){this.type=Mr,this.lhs=C,this.rhs=T,this.collator=O,this.hasUntypedArgument=C.type.kind==="value"||T.type.kind==="value"}return x.parse=function(C,T){if(C.length!==3&&C.length!==4)return T.error("Expected two or three arguments.");var O=C[0],U=T.parse(C[1],1,Zn);if(!U)return null;if(!Ka(O,U.type))return T.concat(1).error('"'+O+`" comparisons are not supported for type '`+aa(U.type)+"'.");var W=T.parse(C[2],2,Zn);if(!W)return null;if(!Ka(O,W.type))return T.concat(2).error('"'+O+`" comparisons are not supported for type '`+aa(W.type)+"'.");if(U.type.kind!==W.type.kind&&U.type.kind!=="value"&&W.type.kind!=="value")return T.error("Cannot compare types '"+aa(U.type)+"' and '"+aa(W.type)+"'.");d&&(U.type.kind==="value"&&W.type.kind!=="value"?U=new ba(W.type,[U]):U.type.kind!=="value"&&W.type.kind==="value"&&(W=new ba(U.type,[W])));var $=null;if(C.length===4){if(U.type.kind!=="string"&&W.type.kind!=="string"&&U.type.kind!=="value"&&W.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!($=T.parse(C[3],3,na)))return null}return new x(U,W,$)},x.prototype.evaluate=function(C){var T=this.lhs.evaluate(C),O=this.rhs.evaluate(C);if(d&&this.hasUntypedArgument){var U=Bi(T),W=Bi(O);if(U.kind!==W.kind||U.kind!=="string"&&U.kind!=="number")throw new Lo('Expected arguments for "'+i+'" to be (string, string) or (number, number), but found ('+U.kind+", "+W.kind+") instead.")}if(this.collator&&!d&&this.hasUntypedArgument){var $=Bi(T),te=Bi(O);if($.kind!=="string"||te.kind!=="string")return s(C,T,O)}return this.collator?l(C,T,O,this.collator.evaluate(C)):s(C,T,O)},x.prototype.eachChild=function(C){C(this.lhs),C(this.rhs),this.collator&&C(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var C=[i];return this.eachChild(function(T){C.push(T.serialize())}),C},x}()}pa.parse=function(i,s){if(i.length<=2||i.length>=5)return s.error("Expected 3 or 4 arguments, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1,Zn),d=s.parse(i[2],2,rr);if(!l||!d)return null;if(!go(l.type,[va(Zn),Wn,Zn]))return s.error("Expected first argument to be of type array or string, but found "+aa(l.type)+" instead");if(i.length===4){var x=s.parse(i[3],3,rr);return x?new pa(l.type,l,d,x):null}return new pa(l.type,l,d)},pa.prototype.evaluate=function(i){var s=this.input.evaluate(i),l=this.beginIndex.evaluate(i);if(!Ba(s,["string","array"]))throw new Lo("Expected first argument to be of type array or string, but found "+aa(Bi(s))+" instead.");if(this.endIndex){var d=this.endIndex.evaluate(i);return s.slice(l,d)}return s.slice(l)},pa.prototype.eachChild=function(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)},pa.prototype.outputDefined=function(){return!1},pa.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Xs=wa("==",function(i,s,l){return s===l},yo),Bl=wa("!=",function(i,s,l){return s!==l},function(i,s,l,d){return!yo(0,s,l,d)}),Yc=wa("<",function(i,s,l){return s<l},function(i,s,l,d){return d.compare(s,l)<0}),qc=wa(">",function(i,s,l){return s>l},function(i,s,l,d){return d.compare(s,l)>0}),wc=wa("<=",function(i,s,l){return s<=l},function(i,s,l,d){return d.compare(s,l)<=0}),Tc=wa(">=",function(i,s,l){return s>=l},function(i,s,l,d){return d.compare(s,l)>=0}),Mu=function(i,s,l,d,x){this.type=Wn,this.number=i,this.locale=s,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=x};Mu.parse=function(i,s){if(i.length!==3)return s.error("Expected two arguments.");var l=s.parse(i[1],1,rr);if(!l)return null;var d=i[2];if(typeof d!="object"||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");var x=null;if(d.locale&&!(x=s.parse(d.locale,1,Wn)))return null;var C=null;if(d.currency&&!(C=s.parse(d.currency,1,Wn)))return null;var T=null;if(d["min-fraction-digits"]&&!(T=s.parse(d["min-fraction-digits"],1,rr)))return null;var O=null;return d["max-fraction-digits"]&&!(O=s.parse(d["max-fraction-digits"],1,rr))?null:new Mu(l,x,C,T,O)},Mu.prototype.evaluate=function(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))},Mu.prototype.eachChild=function(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)},Mu.prototype.outputDefined=function(){return!1},Mu.prototype.serialize=function(){var i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]};var Nl=function(i){this.type=rr,this.input=i};Nl.parse=function(i,s){if(i.length!==2)return s.error("Expected 1 argument, but found "+(i.length-1)+" instead.");var l=s.parse(i[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?s.error("Expected argument of type string or array, but found "+aa(l.type)+" instead."):new Nl(l):null},Nl.prototype.evaluate=function(i){var s=this.input.evaluate(i);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Lo("Expected value to be of type string or array, but found "+aa(Bi(s))+" instead.")},Nl.prototype.eachChild=function(i){i(this.input)},Nl.prototype.outputDefined=function(){return!1},Nl.prototype.serialize=function(){var i=["length"];return this.eachChild(function(s){i.push(s.serialize())}),i};var _l={"==":Xs,"!=":Bl,">":qc,"<":Yc,">=":Tc,"<=":wc,array:ba,at:Nr,boolean:ba,case:ji,coalesce:Mt,collator:vs,format:Ps,image:Ls,in:Xr,"index-of":Qn,interpolate:Fe,"interpolate-hcl":Fe,"interpolate-lab":Fe,length:Nl,let:Dt,literal:Ra,match:Ki,number:ba,"number-format":Mu,object:ba,slice:pa,step:Ro,string:ba,"to-boolean":fo,"to-color":fo,"to-number":fo,"to-string":fo,var:_u,within:so};function Go(i,s){var l=s[0],d=s[1],x=s[2],C=s[3];l=l.evaluate(i),d=d.evaluate(i),x=x.evaluate(i);var T=C?C.evaluate(i):1,O=yu(l,d,x,T);if(O)throw new Lo(O);return new Or(l/255*T,d/255*T,x/255*T,T)}function Ah(i,s){return i in s}function wh(i,s){var l=s[i];return l===void 0?null:l}function bu(i){return{type:i}}function Yh(i){return{result:"success",value:i}}function zl(i){return{result:"error",value:i}}function el(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ul(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function xl(i){return!!i.expression&&i.expression.interpolated}function lo(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function tl(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Xf(i){return i}function ju(i,s,l){return i!==void 0?i:s!==void 0?s:l!==void 0?l:void 0}function xp(i,s,l,d,x){return ju(typeof l===x?d[l]:void 0,i.default,s.default)}function e0(i,s,l){if(lo(l)!=="number")return ju(i.default,s.default);var d=i.stops.length;if(d===1||l<=i.stops[0][0])return i.stops[0][1];if(l>=i.stops[d-1][0])return i.stops[d-1][1];var x=xu(i.stops.map(function(C){return C[0]}),l);return i.stops[x][1]}function $p(i,s,l){var d=i.base!==void 0?i.base:1;if(lo(l)!=="number")return ju(i.default,s.default);var x=i.stops.length;if(x===1||l<=i.stops[0][0])return i.stops[0][1];if(l>=i.stops[x-1][0])return i.stops[x-1][1];var C=xu(i.stops.map(function(te){return te[0]}),l),T=function(te,he,Ee,Ke){var Je=Ke-Ee,mt=te-Ee;return Je===0?0:he===1?mt/Je:(Math.pow(he,mt)-1)/(Math.pow(he,Je)-1)}(l,d,i.stops[C][0],i.stops[C+1][0]),O=i.stops[C][1],U=i.stops[C+1][1],W=As[s.type]||Xf;if(i.colorSpace&&i.colorSpace!=="rgb"){var $=oe[i.colorSpace];W=function(te,he){return $.reverse($.interpolate($.forward(te),$.forward(he),T))}}return typeof O.evaluate=="function"?{evaluate:function(){for(var te=[],he=arguments.length;he--;)te[he]=arguments[he];var Ee=O.evaluate.apply(void 0,te),Ke=U.evaluate.apply(void 0,te);if(Ee!==void 0&&Ke!==void 0)return W(Ee,Ke,T)}}:W(O,U,T)}function Th(i,s,l){return s.type==="color"?l=Or.parse(l):s.type==="formatted"?l=bt.fromString(l.toString()):s.type==="resolvedImage"?l=oo.fromString(l.toString()):lo(l)===s.type||s.type==="enum"&&s.values[l]||(l=void 0),ju(l,i.default,s.default)}Bo.register(_l,{error:[{kind:"error"},[Wn],function(i,s){throw new Lo(s[0].evaluate(i))}],typeof:[Wn,[Zn],function(i,s){return aa(Bi(s[0].evaluate(i)))}],"to-rgba":[va(rr,4),[mn],function(i,s){return s[0].evaluate(i).toArray()}],rgb:[mn,[rr,rr,rr],Go],rgba:[mn,[rr,rr,rr,rr],Go],has:{type:Mr,overloads:[[[Wn],function(i,s){return Ah(s[0].evaluate(i),i.properties())}],[[Wn,ea],function(i,s){var l=s[1];return Ah(s[0].evaluate(i),l.evaluate(i))}]]},get:{type:Zn,overloads:[[[Wn],function(i,s){return wh(s[0].evaluate(i),i.properties())}],[[Wn,ea],function(i,s){var l=s[1];return wh(s[0].evaluate(i),l.evaluate(i))}]]},"feature-state":[Zn,[Wn],function(i,s){return wh(s[0].evaluate(i),i.featureState||{})}],properties:[ea,[],function(i){return i.properties()}],"geometry-type":[Wn,[],function(i){return i.geometryType()}],id:[Zn,[],function(i){return i.id()}],zoom:[rr,[],function(i){return i.globals.zoom}],"heatmap-density":[rr,[],function(i){return i.globals.heatmapDensity||0}],"line-progress":[rr,[],function(i){return i.globals.lineProgress||0}],accumulated:[Zn,[],function(i){return i.globals.accumulated===void 0?null:i.globals.accumulated}],"+":[rr,bu(rr),function(i,s){for(var l=0,d=0,x=s;d<x.length;d+=1)l+=x[d].evaluate(i);return l}],"*":[rr,bu(rr),function(i,s){for(var l=1,d=0,x=s;d<x.length;d+=1)l*=x[d].evaluate(i);return l}],"-":{type:rr,overloads:[[[rr,rr],function(i,s){var l=s[1];return s[0].evaluate(i)-l.evaluate(i)}],[[rr],function(i,s){return-s[0].evaluate(i)}]]},"/":[rr,[rr,rr],function(i,s){var l=s[1];return s[0].evaluate(i)/l.evaluate(i)}],"%":[rr,[rr,rr],function(i,s){var l=s[1];return s[0].evaluate(i)%l.evaluate(i)}],ln2:[rr,[],function(){return Math.LN2}],pi:[rr,[],function(){return Math.PI}],e:[rr,[],function(){return Math.E}],"^":[rr,[rr,rr],function(i,s){var l=s[1];return Math.pow(s[0].evaluate(i),l.evaluate(i))}],sqrt:[rr,[rr],function(i,s){return Math.sqrt(s[0].evaluate(i))}],log10:[rr,[rr],function(i,s){return Math.log(s[0].evaluate(i))/Math.LN10}],ln:[rr,[rr],function(i,s){return Math.log(s[0].evaluate(i))}],log2:[rr,[rr],function(i,s){return Math.log(s[0].evaluate(i))/Math.LN2}],sin:[rr,[rr],function(i,s){return Math.sin(s[0].evaluate(i))}],cos:[rr,[rr],function(i,s){return Math.cos(s[0].evaluate(i))}],tan:[rr,[rr],function(i,s){return Math.tan(s[0].evaluate(i))}],asin:[rr,[rr],function(i,s){return Math.asin(s[0].evaluate(i))}],acos:[rr,[rr],function(i,s){return Math.acos(s[0].evaluate(i))}],atan:[rr,[rr],function(i,s){return Math.atan(s[0].evaluate(i))}],min:[rr,bu(rr),function(i,s){return Math.min.apply(Math,s.map(function(l){return l.evaluate(i)}))}],max:[rr,bu(rr),function(i,s){return Math.max.apply(Math,s.map(function(l){return l.evaluate(i)}))}],abs:[rr,[rr],function(i,s){return Math.abs(s[0].evaluate(i))}],round:[rr,[rr],function(i,s){var l=s[0].evaluate(i);return l<0?-Math.round(-l):Math.round(l)}],floor:[rr,[rr],function(i,s){return Math.floor(s[0].evaluate(i))}],ceil:[rr,[rr],function(i,s){return Math.ceil(s[0].evaluate(i))}],"filter-==":[Mr,[Wn,Zn],function(i,s){var l=s[0],d=s[1];return i.properties()[l.value]===d.value}],"filter-id-==":[Mr,[Zn],function(i,s){var l=s[0];return i.id()===l.value}],"filter-type-==":[Mr,[Wn],function(i,s){var l=s[0];return i.geometryType()===l.value}],"filter-<":[Mr,[Wn,Zn],function(i,s){var l=s[0],d=s[1],x=i.properties()[l.value],C=d.value;return typeof x==typeof C&&x<C}],"filter-id-<":[Mr,[Zn],function(i,s){var l=s[0],d=i.id(),x=l.value;return typeof d==typeof x&&d<x}],"filter->":[Mr,[Wn,Zn],function(i,s){var l=s[0],d=s[1],x=i.properties()[l.value],C=d.value;return typeof x==typeof C&&x>C}],"filter-id->":[Mr,[Zn],function(i,s){var l=s[0],d=i.id(),x=l.value;return typeof d==typeof x&&d>x}],"filter-<=":[Mr,[Wn,Zn],function(i,s){var l=s[0],d=s[1],x=i.properties()[l.value],C=d.value;return typeof x==typeof C&&x<=C}],"filter-id-<=":[Mr,[Zn],function(i,s){var l=s[0],d=i.id(),x=l.value;return typeof d==typeof x&&d<=x}],"filter->=":[Mr,[Wn,Zn],function(i,s){var l=s[0],d=s[1],x=i.properties()[l.value],C=d.value;return typeof x==typeof C&&x>=C}],"filter-id->=":[Mr,[Zn],function(i,s){var l=s[0],d=i.id(),x=l.value;return typeof d==typeof x&&d>=x}],"filter-has":[Mr,[Zn],function(i,s){return s[0].value in i.properties()}],"filter-has-id":[Mr,[],function(i){return i.id()!==null&&i.id()!==void 0}],"filter-type-in":[Mr,[va(Wn)],function(i,s){return s[0].value.indexOf(i.geometryType())>=0}],"filter-id-in":[Mr,[va(Zn)],function(i,s){return s[0].value.indexOf(i.id())>=0}],"filter-in-small":[Mr,[Wn,va(Zn)],function(i,s){var l=s[0];return s[1].value.indexOf(i.properties()[l.value])>=0}],"filter-in-large":[Mr,[Wn,va(Zn)],function(i,s){var l=s[0],d=s[1];return function(x,C,T,O){for(;T<=O;){var U=T+O>>1;if(C[U]===x)return!0;C[U]>x?O=U-1:T=U+1}return!1}(i.properties()[l.value],d.value,0,d.value.length-1)}],all:{type:Mr,overloads:[[[Mr,Mr],function(i,s){var l=s[1];return s[0].evaluate(i)&&l.evaluate(i)}],[bu(Mr),function(i,s){for(var l=0,d=s;l<d.length;l+=1)if(!d[l].evaluate(i))return!1;return!0}]]},any:{type:Mr,overloads:[[[Mr,Mr],function(i,s){var l=s[1];return s[0].evaluate(i)||l.evaluate(i)}],[bu(Mr),function(i,s){for(var l=0,d=s;l<d.length;l+=1)if(d[l].evaluate(i))return!0;return!1}]]},"!":[Mr,[Mr],function(i,s){return!s[0].evaluate(i)}],"is-supported-script":[Mr,[Wn],function(i,s){var l=i.globals&&i.globals.isSupportedScript;return!l||l(s[0].evaluate(i))}],upcase:[Wn,[Wn],function(i,s){return s[0].evaluate(i).toUpperCase()}],downcase:[Wn,[Wn],function(i,s){return s[0].evaluate(i).toLowerCase()}],concat:[Wn,bu(Zn),function(i,s){return s.map(function(l){return ml(l.evaluate(i))}).join("")}],"resolved-locale":[Wn,[na],function(i,s){return s[0].evaluate(i).resolvedLocale()}]});var vf=function(i,s){this.expression=i,this._warningHistory={},this._evaluator=new Va,this._defaultValue=s?function(l){return l.type==="color"&&tl(l.default)?new Or(0,0,0,0):l.type==="color"?Or.parse(l.default)||null:l.default===void 0?null:l.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null};function mf(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in _l}function Mc(i,s){var l=new Vu(_l,[],s?function(x){var C={color:mn,string:Wn,number:rr,enum:Wn,boolean:Mr,formatted:Zt,resolvedImage:kt};return x.type==="array"?va(C[x.value]||Zn,x.length):C[x.type]}(s):void 0),d=l.parse(i,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Yh(new vf(d,s)):zl(l.errors)}vf.prototype.evaluateWithoutErrorHandling=function(i,s,l,d,x,C){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)},vf.prototype.evaluate=function(i,s,l,d,x,C){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=C||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Lo("Expected value to be one of "+Object.keys(this._enumValues).map(function(O){return JSON.stringify(O)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console!="undefined"&&console.warn(O.message)),this._defaultValue}};var gf=function(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent=i!=="constant"&&!eu(s.expression)};gf.prototype.evaluateWithoutErrorHandling=function(i,s,l,d,x,C){return this._styleExpression.evaluateWithoutErrorHandling(i,s,l,d,x,C)},gf.prototype.evaluate=function(i,s,l,d,x,C){return this._styleExpression.evaluate(i,s,l,d,x,C)};var Jl=function(i,s,l,d){this.kind=i,this.zoomStops=l,this._styleExpression=s,this.isStateDependent=i!=="camera"&&!eu(s.expression),this.interpolationType=d};function yf(i,s){if((i=Mc(i,s)).result==="error")return i;var l=i.value.expression,d=Rs(l);if(!d&&!el(s))return zl([new Hr("","data expressions not supported")]);var x=su(l,["zoom"]);if(!x&&!Ul(s))return zl([new Hr("","zoom expressions not supported")]);var C=function T(O){var U=null;if(O instanceof Dt)U=T(O.result);else if(O instanceof Mt)for(var W=0,$=O.args;W<$.length&&!(U=T($[W]));W+=1);else(O instanceof Ro||O instanceof Fe)&&O.input instanceof Bo&&O.input.name==="zoom"&&(U=O);return U instanceof Hr||O.eachChild(function(te){var he=T(te);he instanceof Hr?U=he:!U&&he?U=new Hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):U&&he&&U!==he&&(U=new Hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),U}(l);return C||x?C instanceof Hr?zl([C]):C instanceof Fe&&!xl(s)?zl([new Hr("",'"interpolate" expressions cannot be used with this property')]):Yh(C?new Jl(d?"camera":"composite",i.value,C.labels,C instanceof Fe?C.interpolation:void 0):new gf(d?"constant":"source",i.value)):zl([new Hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Jl.prototype.evaluateWithoutErrorHandling=function(i,s,l,d,x,C){return this._styleExpression.evaluateWithoutErrorHandling(i,s,l,d,x,C)},Jl.prototype.evaluate=function(i,s,l,d,x,C){return this._styleExpression.evaluate(i,s,l,d,x,C)},Jl.prototype.interpolationFactor=function(i,s,l){return this.interpolationType?Fe.interpolationFactor(this.interpolationType,i,s,l):0};var ec=function(i,s){this._parameters=i,this._specification=s,jr(this,function l(d,x){var C,T,O,U=x.type==="color",W=d.stops&&typeof d.stops[0][0]=="object",$=W||!(W||d.property!==void 0),te=d.type||(xl(x)?"exponential":"interval");if(U&&((d=jr({},d)).stops&&(d.stops=d.stops.map(function(ei){return[ei[0],Or.parse(ei[1])]})),d.default=Or.parse(d.default?d.default:x.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!oe[d.colorSpace])throw new Error("Unknown color space: "+d.colorSpace);if(te==="exponential")C=$p;else if(te==="interval")C=e0;else if(te==="categorical"){C=xp,T=Object.create(null);for(var he=0,Ee=d.stops;he<Ee.length;he+=1){var Ke=Ee[he];T[Ke[0]]=Ke[1]}O=typeof d.stops[0][0]}else{if(te!=="identity")throw new Error('Unknown function type "'+te+'"');C=Th}if(W){for(var Je={},mt=[],ct=0;ct<d.stops.length;ct++){var Bt=d.stops[ct],Kt=Bt[0].zoom;Je[Kt]===void 0&&(Je[Kt]={zoom:Kt,type:d.type,property:d.property,default:d.default,stops:[]},mt.push(Kt)),Je[Kt].stops.push([Bt[0].value,Bt[1]])}for(var mr=[],gr=0,zr=mt;gr<zr.length;gr+=1){var fn=zr[gr];mr.push([Je[fn].zoom,l(Je[fn],x)])}var Un={name:"linear"};return{kind:"composite",interpolationType:Un,interpolationFactor:Fe.interpolationFactor.bind(void 0,Un),zoomStops:mr.map(function(ei){return ei[0]}),evaluate:function(ei,Ii){var Kn=ei.zoom;return $p({stops:mr,base:d.base},x,Kn).evaluate(Kn,Ii)}}}if($){var Ai=te==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:Ai,interpolationFactor:Fe.interpolationFactor.bind(void 0,Ai),zoomStops:d.stops.map(function(ei){return ei[0]}),evaluate:function(ei){return C(d,x,ei.zoom,T,O)}}}return{kind:"source",evaluate:function(ei,Ii){var Kn=Ii&&Ii.properties?Ii.properties[d.property]:void 0;return Kn===void 0?ju(d.default,x.default):C(d,x,Kn,T,O)}}}(this._parameters,this._specification))};function uu(i){var s=i.key,l=i.value,d=i.valueSpec||{},x=i.objectElementValidators||{},C=i.style,T=i.styleSpec,O=[],U=lo(l);if(U!=="object")return[new nt(s,l,"object expected, "+U+" found")];for(var W in l){var $=W.split(".")[0],te=d[$]||d["*"],he=void 0;if(x[$])he=x[$];else if(d[$])he=Sa;else if(x["*"])he=x["*"];else{if(!d["*"]){O.push(new nt(s,l[W],'unknown property "'+W+'"'));continue}he=Sa}O=O.concat(he({key:(s&&s+".")+W,value:l[W],valueSpec:te,style:C,styleSpec:T,object:l,objectKey:W},l))}for(var Ee in d)x[Ee]||d[Ee].required&&d[Ee].default===void 0&&l[Ee]===void 0&&O.push(new nt(s,l,'missing required property "'+Ee+'"'));return O}function Yf(i){var s=i.value,l=i.valueSpec,d=i.style,x=i.styleSpec,C=i.key,T=i.arrayElementValidator||Sa;if(lo(s)!=="array")return[new nt(C,s,"array expected, "+lo(s)+" found")];if(l.length&&s.length!==l.length)return[new nt(C,s,"array length "+l.length+" expected, length "+s.length+" found")];if(l["min-length"]&&s.length<l["min-length"])return[new nt(C,s,"array length at least "+l["min-length"]+" expected, length "+s.length+" found")];var O={type:l.value,values:l.values};x.$version<7&&(O.function=l.function),lo(l.value)==="object"&&(O=l.value);for(var U=[],W=0;W<s.length;W++)U=U.concat(T({array:s,arrayIndex:W,value:s[W],valueSpec:O,style:d,styleSpec:x,key:C+"["+W+"]"}));return U}function tc(i){var s=i.key,l=i.value,d=i.valueSpec,x=lo(l);return x==="number"&&l!=l&&(x="NaN"),x!=="number"?[new nt(s,l,"number expected, "+x+" found")]:"minimum"in d&&l<d.minimum?[new nt(s,l,l+" is less than the minimum value "+d.minimum)]:"maximum"in d&&l>d.maximum?[new nt(s,l,l+" is greater than the maximum value "+d.maximum)]:[]}function qh(i){var s,l,d,x=i.valueSpec,C=ir(i.value.type),T={},O=C!=="categorical"&&i.value.property===void 0,U=!O,W=lo(i.value.stops)==="array"&&lo(i.value.stops[0])==="array"&&lo(i.value.stops[0][0])==="object",$=uu({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Ee){if(C==="identity")return[new nt(Ee.key,Ee.value,'identity function may not have a "stops" property')];var Ke=[],Je=Ee.value;return Ke=Ke.concat(Yf({key:Ee.key,value:Je,valueSpec:Ee.valueSpec,style:Ee.style,styleSpec:Ee.styleSpec,arrayElementValidator:te})),lo(Je)==="array"&&Je.length===0&&Ke.push(new nt(Ee.key,Je,"array must have at least one stop")),Ke},default:function(Ee){return Sa({key:Ee.key,value:Ee.value,valueSpec:x,style:Ee.style,styleSpec:Ee.styleSpec})}}});return C==="identity"&&O&&$.push(new nt(i.key,i.value,'missing required property "property"')),C==="identity"||i.value.stops||$.push(new nt(i.key,i.value,'missing required property "stops"')),C==="exponential"&&i.valueSpec.expression&&!xl(i.valueSpec)&&$.push(new nt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(U&&!el(i.valueSpec)?$.push(new nt(i.key,i.value,"property functions not supported")):O&&!Ul(i.valueSpec)&&$.push(new nt(i.key,i.value,"zoom functions not supported"))),C!=="categorical"&&!W||i.value.property!==void 0||$.push(new nt(i.key,i.value,'"property" property is required')),$;function te(Ee){var Ke=[],Je=Ee.value,mt=Ee.key;if(lo(Je)!=="array")return[new nt(mt,Je,"array expected, "+lo(Je)+" found")];if(Je.length!==2)return[new nt(mt,Je,"array length 2 expected, length "+Je.length+" found")];if(W){if(lo(Je[0])!=="object")return[new nt(mt,Je,"object expected, "+lo(Je[0])+" found")];if(Je[0].zoom===void 0)return[new nt(mt,Je,"object stop key must have zoom")];if(Je[0].value===void 0)return[new nt(mt,Je,"object stop key must have value")];if(d&&d>ir(Je[0].zoom))return[new nt(mt,Je[0].zoom,"stop zoom values must appear in ascending order")];ir(Je[0].zoom)!==d&&(d=ir(Je[0].zoom),l=void 0,T={}),Ke=Ke.concat(uu({key:mt+"[0]",value:Je[0],valueSpec:{zoom:{}},style:Ee.style,styleSpec:Ee.styleSpec,objectElementValidators:{zoom:tc,value:he}}))}else Ke=Ke.concat(he({key:mt+"[0]",value:Je[0],valueSpec:{},style:Ee.style,styleSpec:Ee.styleSpec},Je));return mf(pr(Je[1]))?Ke.concat([new nt(mt+"[1]",Je[1],"expressions are not allowed in function stops.")]):Ke.concat(Sa({key:mt+"[1]",value:Je[1],valueSpec:x,style:Ee.style,styleSpec:Ee.styleSpec}))}function he(Ee,Ke){var Je=lo(Ee.value),mt=ir(Ee.value),ct=Ee.value!==null?Ee.value:Ke;if(s){if(Je!==s)return[new nt(Ee.key,ct,Je+" stop domain type must match previous stop domain type "+s)]}else s=Je;if(Je!=="number"&&Je!=="string"&&Je!=="boolean")return[new nt(Ee.key,ct,"stop domain value must be a number, string, or boolean")];if(Je!=="number"&&C!=="categorical"){var Bt="number expected, "+Je+" found";return el(x)&&C===void 0&&(Bt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new nt(Ee.key,ct,Bt)]}return C!=="categorical"||Je!=="number"||isFinite(mt)&&Math.floor(mt)===mt?C!=="categorical"&&Je==="number"&&l!==void 0&&mt<l?[new nt(Ee.key,ct,"stop domain values must appear in ascending order")]:(l=mt,C==="categorical"&&mt in T?[new nt(Ee.key,ct,"stop domain values must be unique")]:(T[mt]=!0,[])):[new nt(Ee.key,ct,"integer expected, found "+mt)]}}function Ic(i){var s=(i.expressionContext==="property"?yf:Mc)(pr(i.value),i.valueSpec);if(s.result==="error")return s.value.map(function(d){return new nt(""+i.key+d.key,i.value,d.message)});var l=s.value.expression||s.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!l.outputDefined())return[new nt(i.key,i.value,'Invalid data expression for "'+i.propertyKey+'". Output values must be contained as literals within the expression.')];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!eu(l))return[new nt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!eu(l))return[new nt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!su(l,["zoom","feature-state"]))return[new nt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Rs(l))return[new nt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rc(i){var s=i.key,l=i.value,d=i.valueSpec,x=[];return Array.isArray(d.values)?d.values.indexOf(ir(l))===-1&&x.push(new nt(s,l,"expected one of ["+d.values.join(", ")+"], "+JSON.stringify(l)+" found")):Object.keys(d.values).indexOf(ir(l))===-1&&x.push(new nt(s,l,"expected one of ["+Object.keys(d.values).join(", ")+"], "+JSON.stringify(l)+" found")),x}function rl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(var s=0,l=i.slice(1);s<l.length;s+=1){var d=l[s];if(!rl(d)&&typeof d!="boolean")return!1}return!0;default:return!0}}ec.deserialize=function(i){return new ec(i._parameters,i._specification)},ec.serialize=function(i){return{_parameters:i._parameters,_specification:i._specification}};var _f={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kc(i){if(i==null)return{filter:function(){return!0},needGeometry:!1};rl(i)||(i=xf(i));var s=Mc(i,_f);if(s.result==="error")throw new Error(s.value.map(function(l){return l.key+": "+l.message}).join(", "));return{filter:function(l,d,x){return s.value.evaluate(l,d,{},x)},needGeometry:function l(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(var x=1;x<d.length;x++)if(l(d[x]))return!0;return!1}(i)}}function bp(i,s){return i<s?-1:i>s?1:0}function xf(i){if(!i)return!0;var s,l=i[0];return i.length<=1?l!=="any":l==="=="?nc(i[1],i[2],"=="):l==="!="?Ef(nc(i[1],i[2],"==")):l==="<"||l===">"||l==="<="||l===">="?nc(i[1],i[2],l):l==="any"?(s=i.slice(1),["any"].concat(s.map(xf))):l==="all"?["all"].concat(i.slice(1).map(xf)):l==="none"?["all"].concat(i.slice(1).map(xf).map(Ef)):l==="in"?$h(i[1],i.slice(2)):l==="!in"?Ef($h(i[1],i.slice(2))):l==="has"?bf(i[1]):l==="!has"?Ef(bf(i[1])):l!=="within"||i}function nc(i,s,l){switch(i){case"$type":return["filter-type-"+l,s];case"$id":return["filter-id-"+l,s];default:return["filter-"+l,i,s]}}function $h(i,s){if(s.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(function(l){return typeof l!=typeof s[0]})?["filter-in-large",i,["literal",s.sort(bp)]]:["filter-in-small",i,["literal",s]]}}function bf(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ef(i){return["!",i]}function Kp(i){return rl(pr(i.value))?Ic(jr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function s(l){var d=l.value,x=l.key;if(lo(d)!=="array")return[new nt(x,d,"array expected, "+lo(d)+" found")];var C,T=l.styleSpec,O=[];if(d.length<1)return[new nt(x,d,"filter array must have at least 1 element")];switch(O=O.concat(rc({key:x+"[0]",value:d[0],valueSpec:T.filter_operator,style:l.style,styleSpec:l.styleSpec})),ir(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&ir(d[1])==="$type"&&O.push(new nt(x,d,'"$type" cannot be use with operator "'+d[0]+'"'));case"==":case"!=":d.length!==3&&O.push(new nt(x,d,'filter array for operator "'+d[0]+'" must have 3 elements'));case"in":case"!in":d.length>=2&&(C=lo(d[1]))!=="string"&&O.push(new nt(x+"[1]",d[1],"string expected, "+C+" found"));for(var U=2;U<d.length;U++)C=lo(d[U]),ir(d[1])==="$type"?O=O.concat(rc({key:x+"["+U+"]",value:d[U],valueSpec:T.geometry_type,style:l.style,styleSpec:l.styleSpec})):C!=="string"&&C!=="number"&&C!=="boolean"&&O.push(new nt(x+"["+U+"]",d[U],"string, number, or boolean expected, "+C+" found"));break;case"any":case"all":case"none":for(var W=1;W<d.length;W++)O=O.concat(s({key:x+"["+W+"]",value:d[W],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":C=lo(d[1]),d.length!==2?O.push(new nt(x,d,'filter array for "'+d[0]+'" operator must have 2 elements')):C!=="string"&&O.push(new nt(x+"[1]",d[1],"string expected, "+C+" found"));break;case"within":C=lo(d[1]),d.length!==2?O.push(new nt(x,d,'filter array for "'+d[0]+'" operator must have 2 elements')):C!=="object"&&O.push(new nt(x+"[1]",d[1],"object expected, "+C+" found"))}return O}(i)}function Qp(i,s){var l=i.key,d=i.style,x=i.styleSpec,C=i.value,T=i.objectKey,O=x[s+"_"+i.layerType];if(!O)return[];var U=T.match(/^(.*)-transition$/);if(s==="paint"&&U&&O[U[1]]&&O[U[1]].transition)return Sa({key:l,value:C,valueSpec:x.transition,style:d,styleSpec:x});var W,$=i.valueSpec||O[T];if(!$)return[new nt(l,C,'unknown property "'+T+'"')];if(lo(C)==="string"&&el($)&&!$.tokens&&(W=/^{([^}]+)}$/.exec(C)))return[new nt(l,C,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(W[1])+" }`.")];var te=[];return i.layerType==="symbol"&&(T==="text-field"&&d&&!d.glyphs&&te.push(new nt(l,C,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&tl(pr(C))&&ir(C.type)==="identity"&&te.push(new nt(l,C,'"text-font" does not support identity functions'))),te.concat(Sa({key:i.key,value:C,valueSpec:$,style:d,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:T}))}function Mh(i){return Qp(i,"paint")}function $c(i){return Qp(i,"layout")}function Eu(i){var s=[],l=i.value,d=i.key,x=i.style,C=i.styleSpec;l.type||l.ref||s.push(new nt(d,l,'either "type" or "ref" is required'));var T,O=ir(l.type),U=ir(l.ref);if(l.id)for(var W=ir(l.id),$=0;$<i.arrayIndex;$++){var te=x.layers[$];ir(te.id)===W&&s.push(new nt(d,l.id,'duplicate layer id "'+l.id+'", previously used at line '+te.id.__line__))}if("ref"in l)["type","source","source-layer","filter","layout"].forEach(function(Ke){Ke in l&&s.push(new nt(d,l[Ke],'"'+Ke+'" is prohibited for ref layers'))}),x.layers.forEach(function(Ke){ir(Ke.id)===U&&(T=Ke)}),T?T.ref?s.push(new nt(d,l.ref,"ref cannot reference another ref layer")):O=ir(T.type):s.push(new nt(d,l.ref,'ref layer "'+U+'" not found'));else if(O!=="background")if(l.source){var he=x.sources&&x.sources[l.source],Ee=he&&ir(he.type);he?Ee==="vector"&&O==="raster"?s.push(new nt(d,l.source,'layer "'+l.id+'" requires a raster source')):Ee==="raster"&&O!=="raster"?s.push(new nt(d,l.source,'layer "'+l.id+'" requires a vector source')):Ee!=="vector"||l["source-layer"]?Ee==="raster-dem"&&O!=="hillshade"?s.push(new nt(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="line"||!l.paint||!l.paint["line-gradient"]||Ee==="geojson"&&he.lineMetrics||s.push(new nt(d,l,'layer "'+l.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):s.push(new nt(d,l,'layer "'+l.id+'" must specify a "source-layer"')):s.push(new nt(d,l.source,'source "'+l.source+'" not found'))}else s.push(new nt(d,l,'missing required property "source"'));return s=s.concat(uu({key:d,value:l,valueSpec:C.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Sa({key:d+".type",value:l.type,valueSpec:C.layer.type,style:i.style,styleSpec:i.styleSpec,object:l,objectKey:"type"})},filter:Kp,layout:function(Ke){return uu({layer:l,key:Ke.key,value:Ke.value,style:Ke.style,styleSpec:Ke.styleSpec,objectElementValidators:{"*":function(Je){return $c(jr({layerType:O},Je))}}})},paint:function(Ke){return uu({layer:l,key:Ke.key,value:Ke.value,style:Ke.style,styleSpec:Ke.styleSpec,objectElementValidators:{"*":function(Je){return Mh(jr({layerType:O},Je))}}})}}}))}function Kc(i){var s=i.value,l=i.key,d=lo(s);return d!=="string"?[new nt(l,s,"string expected, "+d+" found")]:[]}var Ui={promoteId:function(i){var s=i.key,l=i.value;if(lo(l)==="string")return Kc({key:s,value:l});var d=[];for(var x in l)d.push.apply(d,Kc({key:s+"."+x,value:l[x]}));return d}};function Cf(i){var s=i.value,l=i.key,d=i.styleSpec,x=i.style;if(!s.type)return[new nt(l,s,'"type" is required')];var C,T=ir(s.type);switch(T){case"vector":case"raster":case"raster-dem":return uu({key:l,value:s,valueSpec:d["source_"+T.replace("-","_")],style:i.style,styleSpec:d,objectElementValidators:Ui});case"geojson":if(C=uu({key:l,value:s,valueSpec:d.source_geojson,style:x,styleSpec:d,objectElementValidators:Ui}),s.cluster)for(var O in s.clusterProperties){var U=s.clusterProperties[O],W=U[0],$=typeof W=="string"?[W,["accumulated"],["get",O]]:W;C.push.apply(C,Ic({key:l+"."+O+".map",value:U[1],expressionContext:"cluster-map"})),C.push.apply(C,Ic({key:l+"."+O+".reduce",value:$,expressionContext:"cluster-reduce"}))}return C;case"video":return uu({key:l,value:s,valueSpec:d.source_video,style:x,styleSpec:d});case"image":return uu({key:l,value:s,valueSpec:d.source_image,style:x,styleSpec:d});case"canvas":return[new nt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rc({key:l+".type",value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:d})}}function Sf(i){var s=i.value,l=i.styleSpec,d=l.light,x=i.style,C=[],T=lo(s);if(s===void 0)return C;if(T!=="object")return C.concat([new nt("light",s,"object expected, "+T+" found")]);for(var O in s){var U=O.match(/^(.*)-transition$/);C=C.concat(U&&d[U[1]]&&d[U[1]].transition?Sa({key:O,value:s[O],valueSpec:l.transition,style:x,styleSpec:l}):d[O]?Sa({key:O,value:s[O],valueSpec:d[O],style:x,styleSpec:l}):[new nt(O,s[O],'unknown property "'+O+'"')])}return C}var bl={"*":function(){return[]},array:Yf,boolean:function(i){var s=i.value,l=i.key,d=lo(s);return d!=="boolean"?[new nt(l,s,"boolean expected, "+d+" found")]:[]},number:tc,color:function(i){var s=i.key,l=i.value,d=lo(l);return d!=="string"?[new nt(s,l,"color expected, "+d+" found")]:Pr(l)===null?[new nt(s,l,'color expected, "'+l+'" found')]:[]},constants:Ht,enum:rc,filter:Kp,function:qh,layer:Eu,object:uu,source:Cf,light:Sf,string:Kc,formatted:function(i){return Kc(i).length===0?[]:Ic(i)},resolvedImage:function(i){return Kc(i).length===0?[]:Ic(i)}};function Sa(i){var s=i.value,l=i.valueSpec,d=i.styleSpec;return l.expression&&tl(ir(s))?qh(i):l.expression&&mf(pr(s))?Ic(i):l.type&&bl[l.type]?bl[l.type](i):uu(jr({},i,{valueSpec:l.type?d[l.type]:l}))}function _o(i){var s=i.value,l=i.key,d=Kc(i);return d.length||(s.indexOf("{fontstack}")===-1&&d.push(new nt(l,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&d.push(new nt(l,s,'"glyphs" url must include a "{range}" token'))),d}function lu(i,s){s===void 0&&(s=Ie);var l=[];return l=l.concat(Sa({key:"",value:i,valueSpec:s.$root,styleSpec:s,style:i,objectElementValidators:{glyphs:_o,"*":function(){return[]}}})),i.constants&&(l=l.concat(Ht({key:"constants",value:i.constants,style:i,styleSpec:s}))),Mo(l)}function Mo(i){return[].concat(i).sort(function(s,l){return s.line-l.line})}function Iu(i){return function(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];return Mo(i.apply(this,s))}}lu.source=Iu(Cf),lu.light=Iu(Sf),lu.layer=Iu(Eu),lu.filter=Iu(Kp),lu.paintProperty=Iu(Mh),lu.layoutProperty=Iu($c);var Zl=lu,cu=Zl.light,Jp=Zl.paintProperty,qf=Zl.layoutProperty;function Af(i,s){var l=!1;if(s&&s.length)for(var d=0,x=s;d<x.length;d+=1)i.fire(new ut(new Error(x[d].message))),l=!0;return l}var Vl=ms;function ms(i,s,l){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(s=x[1])+2*(l=x[2]);for(var C=0;C<this.d*this.d;C++){var T=x[3+C],O=x[3+C+1];d.push(T===O?null:x.subarray(T,O))}var U=x[3+d.length+1];this.keys=x.subarray(x[3+d.length],U),this.bboxes=x.subarray(U),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var W=0;W<this.d*this.d;W++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=l,this.scale=s/i,this.uid=0;var $=l/s*i;this.min=-$,this.max=i+$}ms.prototype.insert=function(i,s,l,d,x){this._forEachCell(s,l,d,x,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(x)},ms.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ms.prototype._insertCell=function(i,s,l,d,x,C){this.cells[x].push(C)},ms.prototype.query=function(i,s,l,d,x){var C=this.min,T=this.max;if(i<=C&&s<=C&&T<=l&&T<=d&&!x)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(i,s,l,d,this._queryCell,O,{},x),O},ms.prototype._queryCell=function(i,s,l,d,x,C,T,O){var U=this.cells[x];if(U!==null)for(var W=this.keys,$=this.bboxes,te=0;te<U.length;te++){var he=U[te];if(T[he]===void 0){var Ee=4*he;(O?O($[Ee+0],$[Ee+1],$[Ee+2],$[Ee+3]):i<=$[Ee+2]&&s<=$[Ee+3]&&l>=$[Ee+0]&&d>=$[Ee+1])?(T[he]=!0,C.push(W[he])):T[he]=!1}}},ms.prototype._forEachCell=function(i,s,l,d,x,C,T,O){for(var U=this._convertToCellCoord(i),W=this._convertToCellCoord(s),$=this._convertToCellCoord(l),te=this._convertToCellCoord(d),he=U;he<=$;he++)for(var Ee=W;Ee<=te;Ee++){var Ke=this.d*Ee+he;if((!O||O(this._convertFromCellCoord(he),this._convertFromCellCoord(Ee),this._convertFromCellCoord(he+1),this._convertFromCellCoord(Ee+1)))&&x.call(this,i,s,l,d,Ke,C,T,O))return}},ms.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},ms.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},ms.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=3+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var x=new Int32Array(s+l+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var C=s,T=0;T<i.length;T++){var O=i[T];x[3+T]=C,x.set(O,C),C+=O.length}return x[3+i.length]=C,x.set(this.keys,C),x[3+i.length+1]=C+=this.keys.length,x.set(this.bboxes,C),C+=this.bboxes.length,x.buffer};var nl=we.ImageData,$f=we.ImageBitmap,Ho={};function ri(i,s,l){l===void 0&&(l={}),Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),Ho[i]={klass:s,omit:l.omit||[],shallow:l.shallow||[]}}for(var ma in ri("Object",Object),Vl.serialize=function(i,s){var l=i.toArrayBuffer();return s&&s.push(l),{buffer:l}},Vl.deserialize=function(i){return new Vl(i.buffer)},ri("Grid",Vl),ri("Color",Or),ri("Error",Error),ri("ResolvedImage",oo),ri("StylePropertyFunction",ec),ri("StyleExpression",vf,{omit:["_evaluator"]}),ri("ZoomDependentExpression",Jl),ri("ZoomConstantExpression",gf),ri("CompoundExpression",Bo,{omit:["_evaluate"]}),_l)_l[ma]._classRegistryKey||ri("Expression_"+ma,_l[ma]);function Pc(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function wf(i){return $f&&i instanceof $f}function ku(i,s){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Pc(i)||wf(i))return s&&s.push(i),i;if(ArrayBuffer.isView(i)){var l=i;return s&&s.push(l.buffer),l}if(i instanceof nl)return s&&s.push(i.data.buffer),i;if(Array.isArray(i)){for(var d=[],x=0,C=i;x<C.length;x+=1)d.push(ku(C[x],s));return d}if(typeof i=="object"){var T=i.constructor,O=T._classRegistryKey;if(!O)throw new Error("can't serialize object of unregistered class");var U=T.serialize?T.serialize(i,s):{};if(!T.serialize){for(var W in i)if(i.hasOwnProperty(W)&&!(Ho[O].omit.indexOf(W)>=0)){var $=i[W];U[W]=Ho[O].shallow.indexOf(W)>=0?$:ku($,s)}i instanceof Error&&(U.message=i.message)}if(U.$name)throw new Error("$name property is reserved for worker serialization logic.");return O!=="Object"&&(U.$name=O),U}throw new Error("can't serialize object of type "+typeof i)}function Pu(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Pc(i)||wf(i)||ArrayBuffer.isView(i)||i instanceof nl)return i;if(Array.isArray(i))return i.map(Pu);if(typeof i=="object"){var s=i.$name||"Object",l=Ho[s].klass;if(!l)throw new Error("can't deserialize unregistered class "+s);if(l.deserialize)return l.deserialize(i);for(var d=Object.create(l.prototype),x=0,C=Object.keys(i);x<C.length;x+=1){var T=C[x];if(T!=="$name"){var O=i[T];d[T]=Ho[s].shallow.indexOf(T)>=0?O:Pu(O)}}return d}throw new Error("can't deserialize object of type "+typeof i)}var Lc=function(){this.first=!0};Lc.prototype.update=function(i,s){var l=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=l,!0))};var Tn={"Latin-1 Supplement":function(i){return i>=128&&i<=255},Arabic:function(i){return i>=1536&&i<=1791},"Arabic Supplement":function(i){return i>=1872&&i<=1919},"Arabic Extended-A":function(i){return i>=2208&&i<=2303},"Hangul Jamo":function(i){return i>=4352&&i<=4607},"Unified Canadian Aboriginal Syllabics":function(i){return i>=5120&&i<=5759},Khmer:function(i){return i>=6016&&i<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(i){return i>=6320&&i<=6399},"General Punctuation":function(i){return i>=8192&&i<=8303},"Letterlike Symbols":function(i){return i>=8448&&i<=8527},"Number Forms":function(i){return i>=8528&&i<=8591},"Miscellaneous Technical":function(i){return i>=8960&&i<=9215},"Control Pictures":function(i){return i>=9216&&i<=9279},"Optical Character Recognition":function(i){return i>=9280&&i<=9311},"Enclosed Alphanumerics":function(i){return i>=9312&&i<=9471},"Geometric Shapes":function(i){return i>=9632&&i<=9727},"Miscellaneous Symbols":function(i){return i>=9728&&i<=9983},"Miscellaneous Symbols and Arrows":function(i){return i>=11008&&i<=11263},"CJK Radicals Supplement":function(i){return i>=11904&&i<=12031},"Kangxi Radicals":function(i){return i>=12032&&i<=12255},"Ideographic Description Characters":function(i){return i>=12272&&i<=12287},"CJK Symbols and Punctuation":function(i){return i>=12288&&i<=12351},Hiragana:function(i){return i>=12352&&i<=12447},Katakana:function(i){return i>=12448&&i<=12543},Bopomofo:function(i){return i>=12544&&i<=12591},"Hangul Compatibility Jamo":function(i){return i>=12592&&i<=12687},Kanbun:function(i){return i>=12688&&i<=12703},"Bopomofo Extended":function(i){return i>=12704&&i<=12735},"CJK Strokes":function(i){return i>=12736&&i<=12783},"Katakana Phonetic Extensions":function(i){return i>=12784&&i<=12799},"Enclosed CJK Letters and Months":function(i){return i>=12800&&i<=13055},"CJK Compatibility":function(i){return i>=13056&&i<=13311},"CJK Unified Ideographs Extension A":function(i){return i>=13312&&i<=19903},"Yijing Hexagram Symbols":function(i){return i>=19904&&i<=19967},"CJK Unified Ideographs":function(i){return i>=19968&&i<=40959},"Yi Syllables":function(i){return i>=40960&&i<=42127},"Yi Radicals":function(i){return i>=42128&&i<=42191},"Hangul Jamo Extended-A":function(i){return i>=43360&&i<=43391},"Hangul Syllables":function(i){return i>=44032&&i<=55215},"Hangul Jamo Extended-B":function(i){return i>=55216&&i<=55295},"Private Use Area":function(i){return i>=57344&&i<=63743},"CJK Compatibility Ideographs":function(i){return i>=63744&&i<=64255},"Arabic Presentation Forms-A":function(i){return i>=64336&&i<=65023},"Vertical Forms":function(i){return i>=65040&&i<=65055},"CJK Compatibility Forms":function(i){return i>=65072&&i<=65103},"Small Form Variants":function(i){return i>=65104&&i<=65135},"Arabic Presentation Forms-B":function(i){return i>=65136&&i<=65279},"Halfwidth and Fullwidth Forms":function(i){return i>=65280&&i<=65519}};function Rc(i){for(var s=0,l=i;s<l.length;s+=1)if(Ih(l[s].charCodeAt(0)))return!0;return!1}function Ih(i){return!(i!==746&&i!==747&&(i<4352||!(Tn["Bopomofo Extended"](i)||Tn.Bopomofo(i)||Tn["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Tn["CJK Compatibility Ideographs"](i)||Tn["CJK Compatibility"](i)||Tn["CJK Radicals Supplement"](i)||Tn["CJK Strokes"](i)||!(!Tn["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Tn["CJK Unified Ideographs Extension A"](i)||Tn["CJK Unified Ideographs"](i)||Tn["Enclosed CJK Letters and Months"](i)||Tn["Hangul Compatibility Jamo"](i)||Tn["Hangul Jamo Extended-A"](i)||Tn["Hangul Jamo Extended-B"](i)||Tn["Hangul Jamo"](i)||Tn["Hangul Syllables"](i)||Tn.Hiragana(i)||Tn["Ideographic Description Characters"](i)||Tn.Kanbun(i)||Tn["Kangxi Radicals"](i)||Tn["Katakana Phonetic Extensions"](i)||Tn.Katakana(i)&&i!==12540||!(!Tn["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Tn["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Tn["Unified Canadian Aboriginal Syllabics"](i)||Tn["Unified Canadian Aboriginal Syllabics Extended"](i)||Tn["Vertical Forms"](i)||Tn["Yijing Hexagram Symbols"](i)||Tn["Yi Syllables"](i)||Tn["Yi Radicals"](i))))}function _a(i){return!(Ih(i)||function(s){return!!(Tn["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Tn["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Tn["Letterlike Symbols"](s)||Tn["Number Forms"](s)||Tn["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Tn["Control Pictures"](s)&&s!==9251||Tn["Optical Character Recognition"](s)||Tn["Enclosed Alphanumerics"](s)||Tn["Geometric Shapes"](s)||Tn["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Tn["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Tn["CJK Symbols and Punctuation"](s)||Tn.Katakana(s)||Tn["Private Use Area"](s)||Tn["CJK Compatibility Forms"](s)||Tn["Small Form Variants"](s)||Tn["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(i))}function ho(i){return i>=1424&&i<=2303||Tn["Arabic Presentation Forms-A"](i)||Tn["Arabic Presentation Forms-B"](i)}function fu(i,s){return!(!s&&ho(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Tn.Khmer(i))}function kh(i){for(var s=0,l=i;s<l.length;s+=1)if(ho(l[s].charCodeAt(0)))return!0;return!1}var il=null,tu="unavailable",jl=null,di=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(tu="error"),il&&il(i)};function Kf(){Ep.fire(new Ye("pluginStateChange",{pluginStatus:tu,pluginURL:jl}))}var Ep=new xt,Cp=function(){return tu},al=function(){if(tu!=="deferred"||!jl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");tu="loading",Kf(),jl&&Ci({url:jl},function(i){i?di(i):(tu="loaded",Kf())})},Ys={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return tu==="loaded"||Ys.applyArabicShaping!=null},isLoading:function(){return tu==="loading"},setState:function(i){tu=i.pluginStatus,jl=i.pluginURL},isParsed:function(){return Ys.applyArabicShaping!=null&&Ys.processBidirectionalText!=null&&Ys.processStyledBidirectionalText!=null},getPluginURL:function(){return jl}},la=function(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Lc,this.transition={})};la.prototype.isSupportedScript=function(i){return function(s,l){for(var d=0,x=s;d<x.length;d+=1)if(!fu(x[d].charCodeAt(0),l))return!1;return!0}(i,Ys.isLoaded())},la.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},la.prototype.getCrossfadeParameters=function(){var i=this.zoom,s=i-Math.floor(i),l=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}};var El=function(i,s){this.property=i,this.value=s,this.expression=function(l,d){if(tl(l))return new ec(l,d);if(mf(l)){var x=yf(l,d);if(x.result==="error")throw new Error(x.value.map(function(T){return T.key+": "+T.message}).join(", "));return x.value}var C=l;return typeof l=="string"&&d.type==="color"&&(C=Or.parse(l)),{kind:"constant",evaluate:function(){return C}}}(s===void 0?i.specification.default:s,i.specification)};El.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},El.prototype.possiblyEvaluate=function(i,s,l){return this.property.possiblyEvaluate(this,i,s,l)};var hu=function(i){this.property=i,this.value=new El(i,void 0)};hu.prototype.transitioned=function(i,s){return new Tf(this.property,this.value,s,Yt({},i.transition,this.transition),i.now)},hu.prototype.untransitioned=function(){return new Tf(this.property,this.value,null,{},0)};var ws=function(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)};ws.prototype.getValue=function(i){return yt(this._values[i].value.value)},ws.prototype.setValue=function(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new hu(this._values[i].property)),this._values[i].value=new El(this._values[i].property,s===null?void 0:yt(s))},ws.prototype.getTransition=function(i){return yt(this._values[i].transition)},ws.prototype.setTransition=function(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new hu(this._values[i].property)),this._values[i].transition=yt(s)||void 0},ws.prototype.serialize=function(){for(var i={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s],x=this.getValue(d);x!==void 0&&(i[d]=x);var C=this.getTransition(d);C!==void 0&&(i[d+"-transition"]=C)}return i},ws.prototype.transitioned=function(i,s){for(var l=new Gl(this._properties),d=0,x=Object.keys(this._values);d<x.length;d+=1){var C=x[d];l._values[C]=this._values[C].transitioned(i,s._values[C])}return l},ws.prototype.untransitioned=function(){for(var i=new Gl(this._properties),s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s];i._values[d]=this._values[d].untransitioned()}return i};var Tf=function(i,s,l,d,x){this.property=i,this.value=s,this.begin=x+d.delay||0,this.end=this.begin+d.duration||0,i.specification.transition&&(d.delay||d.duration)&&(this.prior=l)};Tf.prototype.possiblyEvaluate=function(i,s,l){var d=i.now||0,x=this.value.possiblyEvaluate(i,s,l),C=this.prior;if(C){if(d>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(d<this.begin)return C.possiblyEvaluate(i,s,l);var T=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(i,s,l),x,function(O){if(O<=0)return 0;if(O>=1)return 1;var U=O*O,W=U*O;return 4*(O<.5?W:3*(O-U)+W-.75)}(T))}return x};var Gl=function(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)};Gl.prototype.possiblyEvaluate=function(i,s,l){for(var d=new sl(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var T=C[x];d._values[T]=this._values[T].possiblyEvaluate(i,s,l)}return d},Gl.prototype.hasTransition=function(){for(var i=0,s=Object.keys(this._values);i<s.length;i+=1)if(this._values[s[i]].prior)return!0;return!1};var ol=function(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)};ol.prototype.getValue=function(i){return yt(this._values[i].value)},ol.prototype.setValue=function(i,s){this._values[i]=new El(this._values[i].property,s===null?void 0:yt(s))},ol.prototype.serialize=function(){for(var i={},s=0,l=Object.keys(this._values);s<l.length;s+=1){var d=l[s],x=this.getValue(d);x!==void 0&&(i[d]=x)}return i},ol.prototype.possiblyEvaluate=function(i,s,l){for(var d=new sl(this._properties),x=0,C=Object.keys(this._values);x<C.length;x+=1){var T=C[x];d._values[T]=this._values[T].possiblyEvaluate(i,s,l)}return d};var pu=function(i,s,l){this.property=i,this.value=s,this.parameters=l};pu.prototype.isConstant=function(){return this.value.kind==="constant"},pu.prototype.constantOr=function(i){return this.value.kind==="constant"?this.value.value:i},pu.prototype.evaluate=function(i,s,l,d){return this.property.evaluate(this.value,this.parameters,i,s,l,d)};var sl=function(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)};sl.prototype.get=function(i){return this._values[i]};var _i=function(i){this.specification=i};_i.prototype.possiblyEvaluate=function(i,s){return i.expression.evaluate(s)},_i.prototype.interpolate=function(i,s,l){var d=As[this.specification.type];return d?d(i,s,l):i};var pi=function(i,s){this.specification=i,this.overrides=s};pi.prototype.possiblyEvaluate=function(i,s,l,d){return new pu(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(s,null,{},l,d)}:i.expression,s)},pi.prototype.interpolate=function(i,s,l){if(i.value.kind!=="constant"||s.value.kind!=="constant")return i;if(i.value.value===void 0||s.value.value===void 0)return new pu(this,{kind:"constant",value:void 0},i.parameters);var d=As[this.specification.type];return d?new pu(this,{kind:"constant",value:d(i.value.value,s.value.value,l)},i.parameters):i},pi.prototype.evaluate=function(i,s,l,d,x,C){return i.kind==="constant"?i.value:i.evaluate(s,l,d,x,C)};var Mf=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,d,x,C){if(l.value===void 0)return new pu(this,{kind:"constant",value:void 0},d);if(l.expression.kind==="constant"){var T=l.expression.evaluate(d,null,{},x,C),O=l.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,U=this._calculate(O,O,O,d);return new pu(this,{kind:"constant",value:U},d)}if(l.expression.kind==="camera"){var W=this._calculate(l.expression.evaluate({zoom:d.zoom-1}),l.expression.evaluate({zoom:d.zoom}),l.expression.evaluate({zoom:d.zoom+1}),d);return new pu(this,{kind:"constant",value:W},d)}return new pu(this,l.expression,d)},s.prototype.evaluate=function(l,d,x,C,T,O){if(l.kind==="source"){var U=l.evaluate(d,x,C,T,O);return this._calculate(U,U,U,d)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(d.zoom)-1},x,C),l.evaluate({zoom:Math.floor(d.zoom)},x,C),l.evaluate({zoom:Math.floor(d.zoom)+1},x,C),d):l.value},s.prototype._calculate=function(l,d,x,C){return C.zoom>C.zoomHistory.lastIntegerZoom?{from:l,to:d}:{from:x,to:d}},s.prototype.interpolate=function(l){return l},s}(pi),Os=function(i){this.specification=i};Os.prototype.possiblyEvaluate=function(i,s,l,d){if(i.value!==void 0){if(i.expression.kind==="constant"){var x=i.expression.evaluate(s,null,{},l,d);return this._calculate(x,x,x,s)}return this._calculate(i.expression.evaluate(new la(Math.floor(s.zoom-1),s)),i.expression.evaluate(new la(Math.floor(s.zoom),s)),i.expression.evaluate(new la(Math.floor(s.zoom+1),s)),s)}},Os.prototype._calculate=function(i,s,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:i,to:s}:{from:l,to:s}},Os.prototype.interpolate=function(i){return i};var ul=function(i){this.specification=i};ul.prototype.possiblyEvaluate=function(i,s,l,d){return!!i.expression.evaluate(s,null,{},l,d)},ul.prototype.interpolate=function(){return!1};var Yo=function(i){for(var s in this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],i){var l=i[s];l.specification.overridable&&this.overridableProperties.push(s);var d=this.defaultPropertyValues[s]=new El(l,void 0),x=this.defaultTransitionablePropertyValues[s]=new hu(l);this.defaultTransitioningPropertyValues[s]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate({})}};ri("DataDrivenProperty",pi),ri("DataConstantProperty",_i),ri("CrossFadedDataDrivenProperty",Mf),ri("CrossFadedProperty",Os),ri("ColorRampProperty",ul);var Lu=function(i){function s(l,d){if(i.call(this),this.id=l.id,this.type=l.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},l.type!=="custom"&&(this.metadata=(l=l).metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),d.layout&&(this._unevaluatedLayout=new ol(d.layout)),d.paint)){for(var x in this._transitionablePaint=new ws(d.paint),l.paint)this.setPaintProperty(x,l.paint[x],{validate:!1});for(var C in l.layout)this.setLayoutProperty(C,l.layout[C],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new sl(d.paint)}}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},s.prototype.getLayoutProperty=function(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)},s.prototype.setLayoutProperty=function(l,d,x){x===void 0&&(x={}),d!=null&&this._validate(qf,"layers."+this.id+".layout."+l,l,d,x)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,d):this.visibility=d)},s.prototype.getPaintProperty=function(l){return ie(l,"-transition")?this._transitionablePaint.getTransition(l.slice(0,-"-transition".length)):this._transitionablePaint.getValue(l)},s.prototype.setPaintProperty=function(l,d,x){if(x===void 0&&(x={}),d!=null&&this._validate(Jp,"layers."+this.id+".paint."+l,l,d,x))return!1;if(ie(l,"-transition"))return this._transitionablePaint.setTransition(l.slice(0,-"-transition".length),d||void 0),!1;var C=this._transitionablePaint._values[l],T=C.property.specification["property-type"]==="cross-faded-data-driven",O=C.value.isDataDriven(),U=C.value;this._transitionablePaint.setValue(l,d),this._handleSpecialPaintPropertyUpdate(l);var W=this._transitionablePaint._values[l].value;return W.isDataDriven()||O||T||this._handleOverridablePaintPropertyUpdate(l,U,W)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){},s.prototype._handleOverridablePaintPropertyUpdate=function(l,d,x){return!1},s.prototype.isHidden=function(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"},s.prototype.updateTransitions=function(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)},s.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},s.prototype.recalculate=function(l,d){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,d)},s.prototype.serialize=function(){var l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Ot(l,function(d,x){return!(d===void 0||x==="layout"&&!Object.keys(d).length||x==="paint"&&!Object.keys(d).length)})},s.prototype._validate=function(l,d,x,C,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Af(this,l.call(Zl,{key:d,layerType:this.type,objectKey:x,value:C,styleSpec:Ie,style:{glyphs:!0,sprite:!0}}))},s.prototype.is3D=function(){return!1},s.prototype.isTileClipped=function(){return!1},s.prototype.hasOffscreenPass=function(){return!1},s.prototype.resize=function(){},s.prototype.isStateDependent=function(){for(var l in this.paint._values){var d=this.paint.get(l);if(d instanceof pu&&el(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1},s}(xt),Ph={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Qf=function(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Qa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function po(i,s){s===void 0&&(s=1);var l=0,d=0;return{members:i.map(function(x){var C=Ph[x.type].BYTES_PER_ELEMENT,T=l=Jf(l,Math.max(s,C)),O=x.components||1;return d=Math.max(d,C),l+=C*O,{name:x.name,type:x.type,components:O,offset:T}}),size:Jf(l,Math.max(d,s)),alignment:s}}function Jf(i,s){return Math.ceil(i/s)*s}Qa.serialize=function(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}},Qa.deserialize=function(i){var s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s},Qa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Qa.prototype.clear=function(){this.length=0},Qa.prototype.resize=function(i){this.reserve(i),this.length=i},Qa.prototype.reserve=function(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}},Qa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var eh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.int16[C+0]=d,this.int16[C+1]=x,l},s}(Qa);eh.prototype.bytesPerElement=4,ri("StructArrayLayout2i4",eh);var Cl=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var O=4*l;return this.int16[O+0]=d,this.int16[O+1]=x,this.int16[O+2]=C,this.int16[O+3]=T,l},s}(Qa);Cl.prototype.bytesPerElement=8,ri("StructArrayLayout4i8",Cl);var Sl=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,O){var U=this.length;return this.resize(U+1),this.emplace(U,l,d,x,C,T,O)},s.prototype.emplace=function(l,d,x,C,T,O,U){var W=6*l;return this.int16[W+0]=d,this.int16[W+1]=x,this.int16[W+2]=C,this.int16[W+3]=T,this.int16[W+4]=O,this.int16[W+5]=U,l},s}(Qa);Sl.prototype.bytesPerElement=12,ri("StructArrayLayout2i4i12",Sl);var Fs=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,O){var U=this.length;return this.resize(U+1),this.emplace(U,l,d,x,C,T,O)},s.prototype.emplace=function(l,d,x,C,T,O,U){var W=4*l,$=8*l;return this.int16[W+0]=d,this.int16[W+1]=x,this.uint8[$+4]=C,this.uint8[$+5]=T,this.uint8[$+6]=O,this.uint8[$+7]=U,l},s}(Qa);Fs.prototype.bytesPerElement=8,ri("StructArrayLayout2i4ub8",Fs);var Ao=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.float32[C+0]=d,this.float32[C+1]=x,l},s}(Qa);Ao.prototype.bytesPerElement=8,ri("StructArrayLayout2f8",Ao);var ic=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,O,U,W,$,te){var he=this.length;return this.resize(he+1),this.emplace(he,l,d,x,C,T,O,U,W,$,te)},s.prototype.emplace=function(l,d,x,C,T,O,U,W,$,te,he){var Ee=10*l;return this.uint16[Ee+0]=d,this.uint16[Ee+1]=x,this.uint16[Ee+2]=C,this.uint16[Ee+3]=T,this.uint16[Ee+4]=O,this.uint16[Ee+5]=U,this.uint16[Ee+6]=W,this.uint16[Ee+7]=$,this.uint16[Ee+8]=te,this.uint16[Ee+9]=he,l},s}(Qa);ic.prototype.bytesPerElement=20,ri("StructArrayLayout10ui20",ic);var Kh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,O,U,W,$,te,he,Ee){var Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,l,d,x,C,T,O,U,W,$,te,he,Ee)},s.prototype.emplace=function(l,d,x,C,T,O,U,W,$,te,he,Ee,Ke){var Je=12*l;return this.int16[Je+0]=d,this.int16[Je+1]=x,this.int16[Je+2]=C,this.int16[Je+3]=T,this.uint16[Je+4]=O,this.uint16[Je+5]=U,this.uint16[Je+6]=W,this.uint16[Je+7]=$,this.int16[Je+8]=te,this.int16[Je+9]=he,this.int16[Je+10]=Ee,this.int16[Je+11]=Ke,l},s}(Qa);Kh.prototype.bytesPerElement=24,ri("StructArrayLayout4i4ui4i24",Kh);var Qc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.float32[T+0]=d,this.float32[T+1]=x,this.float32[T+2]=C,l},s}(Qa);Qc.prototype.bytesPerElement=12,ri("StructArrayLayout3f12",Qc);var th=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.uint32[1*l+0]=d,l},s}(Qa);th.prototype.bytesPerElement=4,ri("StructArrayLayout1ul4",th);var Qh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,O,U,W,$){var te=this.length;return this.resize(te+1),this.emplace(te,l,d,x,C,T,O,U,W,$)},s.prototype.emplace=function(l,d,x,C,T,O,U,W,$,te){var he=10*l,Ee=5*l;return this.int16[he+0]=d,this.int16[he+1]=x,this.int16[he+2]=C,this.int16[he+3]=T,this.int16[he+4]=O,this.int16[he+5]=U,this.uint32[Ee+3]=W,this.uint16[he+8]=$,this.uint16[he+9]=te,l},s}(Qa);Qh.prototype.bytesPerElement=20,ri("StructArrayLayout6i1ul2ui20",Qh);var ll=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,O){var U=this.length;return this.resize(U+1),this.emplace(U,l,d,x,C,T,O)},s.prototype.emplace=function(l,d,x,C,T,O,U){var W=6*l;return this.int16[W+0]=d,this.int16[W+1]=x,this.int16[W+2]=C,this.int16[W+3]=T,this.int16[W+4]=O,this.int16[W+5]=U,l},s}(Qa);ll.prototype.bytesPerElement=12,ri("StructArrayLayout2i2i2i12",ll);var ac=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T){var O=this.length;return this.resize(O+1),this.emplace(O,l,d,x,C,T)},s.prototype.emplace=function(l,d,x,C,T,O){var U=4*l,W=8*l;return this.float32[U+0]=d,this.float32[U+1]=x,this.float32[U+2]=C,this.int16[W+6]=T,this.int16[W+7]=O,l},s}(Qa);ac.prototype.bytesPerElement=16,ri("StructArrayLayout2f1f2i16",ac);var Jc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var O=12*l,U=3*l;return this.uint8[O+0]=d,this.uint8[O+1]=x,this.float32[U+1]=C,this.float32[U+2]=T,l},s}(Qa);Jc.prototype.bytesPerElement=12,ri("StructArrayLayout2ub2f12",Jc);var oc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.uint16[T+0]=d,this.uint16[T+1]=x,this.uint16[T+2]=C,l},s}(Qa);oc.prototype.bytesPerElement=6,ri("StructArrayLayout3ui6",oc);var Hl=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,O,U,W,$,te,he,Ee,Ke,Je,mt,ct,Bt){var Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,l,d,x,C,T,O,U,W,$,te,he,Ee,Ke,Je,mt,ct,Bt)},s.prototype.emplace=function(l,d,x,C,T,O,U,W,$,te,he,Ee,Ke,Je,mt,ct,Bt,Kt){var mr=24*l,gr=12*l,zr=48*l;return this.int16[mr+0]=d,this.int16[mr+1]=x,this.uint16[mr+2]=C,this.uint16[mr+3]=T,this.uint32[gr+2]=O,this.uint32[gr+3]=U,this.uint32[gr+4]=W,this.uint16[mr+10]=$,this.uint16[mr+11]=te,this.uint16[mr+12]=he,this.float32[gr+7]=Ee,this.float32[gr+8]=Ke,this.uint8[zr+36]=Je,this.uint8[zr+37]=mt,this.uint8[zr+38]=ct,this.uint32[gr+10]=Bt,this.int16[mr+22]=Kt,l},s}(Qa);Hl.prototype.bytesPerElement=48,ri("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Hl);var Lh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C,T,O,U,W,$,te,he,Ee,Ke,Je,mt,ct,Bt,Kt,mr,gr,zr,fn,Un,Ai,ei,Ii,Kn,ua){var qi=this.length;return this.resize(qi+1),this.emplace(qi,l,d,x,C,T,O,U,W,$,te,he,Ee,Ke,Je,mt,ct,Bt,Kt,mr,gr,zr,fn,Un,Ai,ei,Ii,Kn,ua)},s.prototype.emplace=function(l,d,x,C,T,O,U,W,$,te,he,Ee,Ke,Je,mt,ct,Bt,Kt,mr,gr,zr,fn,Un,Ai,ei,Ii,Kn,ua,qi){var mi=34*l,La=17*l;return this.int16[mi+0]=d,this.int16[mi+1]=x,this.int16[mi+2]=C,this.int16[mi+3]=T,this.int16[mi+4]=O,this.int16[mi+5]=U,this.int16[mi+6]=W,this.int16[mi+7]=$,this.uint16[mi+8]=te,this.uint16[mi+9]=he,this.uint16[mi+10]=Ee,this.uint16[mi+11]=Ke,this.uint16[mi+12]=Je,this.uint16[mi+13]=mt,this.uint16[mi+14]=ct,this.uint16[mi+15]=Bt,this.uint16[mi+16]=Kt,this.uint16[mi+17]=mr,this.uint16[mi+18]=gr,this.uint16[mi+19]=zr,this.uint16[mi+20]=fn,this.uint16[mi+21]=Un,this.uint16[mi+22]=Ai,this.uint32[La+12]=ei,this.float32[La+13]=Ii,this.float32[La+14]=Kn,this.float32[La+15]=ua,this.float32[La+16]=qi,l},s}(Qa);Lh.prototype.bytesPerElement=68,ri("StructArrayLayout8i15ui1ul4f68",Lh);var sc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.float32[1*l+0]=d,l},s}(Qa);sc.prototype.bytesPerElement=4,ri("StructArrayLayout1f4",sc);var Al=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=3*l;return this.int16[T+0]=d,this.int16[T+1]=x,this.int16[T+2]=C,l},s}(Qa);Al.prototype.bytesPerElement=6,ri("StructArrayLayout3i6",Al);var If=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x){var C=this.length;return this.resize(C+1),this.emplace(C,l,d,x)},s.prototype.emplace=function(l,d,x,C){var T=4*l;return this.uint32[2*l+0]=d,this.uint16[T+2]=x,this.uint16[T+3]=C,l},s}(Qa);If.prototype.bytesPerElement=8,ri("StructArrayLayout1ul2ui8",If);var Rh=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d){var x=this.length;return this.resize(x+1),this.emplace(x,l,d)},s.prototype.emplace=function(l,d,x){var C=2*l;return this.uint16[C+0]=d,this.uint16[C+1]=x,l},s}(Qa);Rh.prototype.bytesPerElement=4,ri("StructArrayLayout2ui4",Rh);var Gu=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l){var d=this.length;return this.resize(d+1),this.emplace(d,l)},s.prototype.emplace=function(l,d){return this.uint16[1*l+0]=d,l},s}(Qa);Gu.prototype.bytesPerElement=2,ri("StructArrayLayout1ui2",Gu);var ef=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},s.prototype.emplaceBack=function(l,d,x,C){var T=this.length;return this.resize(T+1),this.emplace(T,l,d,x,C)},s.prototype.emplace=function(l,d,x,C,T){var O=4*l;return this.float32[O+0]=d,this.float32[O+1]=x,this.float32[O+2]=C,this.float32[O+3]=T,l},s}(Qa);ef.prototype.bytesPerElement=16,ri("StructArrayLayout4f16",ef);var c=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return l.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},l.x1.get=function(){return this._structArray.int16[this._pos2+2]},l.y1.get=function(){return this._structArray.int16[this._pos2+3]},l.x2.get=function(){return this._structArray.int16[this._pos2+4]},l.y2.get=function(){return this._structArray.int16[this._pos2+5]},l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.anchorPoint.get=function(){return new ve(this.anchorPointX,this.anchorPointY)},Object.defineProperties(s.prototype,l),s}(Qf);c.prototype.size=20;var p=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new c(this,l)},s}(Qh);ri("CollisionBoxArray",p);var f=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},l.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},l.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},l.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},l.segment.get=function(){return this._structArray.uint16[this._pos2+10]},l.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},l.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},l.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},l.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},l.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},l.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},l.placedOrientation.set=function(d){this._structArray.uint8[this._pos1+37]=d},l.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},l.hidden.set=function(d){this._structArray.uint8[this._pos1+38]=d},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},l.crossTileID.set=function(d){this._structArray.uint32[this._pos4+10]=d},l.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(s.prototype,l),s}(Qf);f.prototype.size=48;var g=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new f(this,l)},s}(Hl);ri("PlacedSymbolArray",g);var S=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return l.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},l.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},l.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},l.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},l.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},l.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},l.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},l.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},l.key.get=function(){return this._structArray.uint16[this._pos2+8]},l.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},l.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},l.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},l.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},l.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},l.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},l.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},l.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},l.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},l.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},l.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},l.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},l.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},l.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},l.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},l.crossTileID.set=function(d){this._structArray.uint32[this._pos4+12]=d},l.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},l.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},l.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},l.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(s.prototype,l),s}(Qf);S.prototype.size=68;var I=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new S(this,l)},s}(Lh);ri("SymbolInstanceArray",I);var R=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getoffsetX=function(l){return this.float32[1*l+0]},s}(sc);ri("GlyphOffsetArray",R);var z=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.getx=function(l){return this.int16[3*l+0]},s.prototype.gety=function(l){return this.int16[3*l+1]},s.prototype.gettileUnitDistanceFromAnchor=function(l){return this.int16[3*l+2]},s}(Al);ri("SymbolLineVertexArray",z);var q=function(i){function s(){i.apply(this,arguments)}i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s;var l={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return l.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},l.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},l.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(s.prototype,l),s}(Qf);q.prototype.size=8;var ne=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.get=function(l){return new q(this,l)},s}(If);ri("FeatureIndexArray",ne);var Se=po([{name:"a_pos",components:2,type:"Int16"}],4).members,Me=function(i){i===void 0&&(i=[]),this.segments=i};function ye(i,s){return 256*(i=tr(Math.floor(i),0,255))+tr(Math.floor(s),0,255)}Me.prototype.prepareSegment=function(i,s,l,d){var x=this.segments[this.segments.length-1];return i>Me.MAX_VERTEX_ARRAY_LENGTH&&Ue("Max vertices per segment is "+Me.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+i),(!x||x.vertexLength+i>Me.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==d)&&(x={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},d!==void 0&&(x.sortKey=d),this.segments.push(x)),x},Me.prototype.get=function(){return this.segments},Me.prototype.destroy=function(){for(var i=0,s=this.segments;i<s.length;i+=1){var l=s[i];for(var d in l.vaos)l.vaos[d].destroy()}},Me.simpleSegment=function(i,s,l,d){return new Me([{vertexOffset:i,primitiveOffset:s,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])},Me.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ri("SegmentVector",Me);var Qe=po([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),qe=Ne(function(i){i.exports=function(s,l){var d,x,C,T,O,U,W,$;for(x=s.length-(d=3&s.length),C=l,O=3432918353,U=461845907,$=0;$<x;)W=255&s.charCodeAt($)|(255&s.charCodeAt(++$))<<8|(255&s.charCodeAt(++$))<<16|(255&s.charCodeAt(++$))<<24,++$,C=27492+(65535&(T=5*(65535&(C=(C^=W=(65535&(W=(W=(65535&W)*O+(((W>>>16)*O&65535)<<16)&4294967295)<<15|W>>>17))*U+(((W>>>16)*U&65535)<<16)&4294967295)<<13|C>>>19))+((5*(C>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(W=0,d){case 3:W^=(255&s.charCodeAt($+2))<<16;case 2:W^=(255&s.charCodeAt($+1))<<8;case 1:C^=W=(65535&(W=(W=(65535&(W^=255&s.charCodeAt($)))*O+(((W>>>16)*O&65535)<<16)&4294967295)<<15|W>>>17))*U+(((W>>>16)*U&65535)<<16)&4294967295}return C^=s.length,C=2246822507*(65535&(C^=C>>>16))+((2246822507*(C>>>16)&65535)<<16)&4294967295,C=3266489909*(65535&(C^=C>>>13))+((3266489909*(C>>>16)&65535)<<16)&4294967295,(C^=C>>>16)>>>0}}),pt=Ne(function(i){i.exports=function(s,l){for(var d,x=s.length,C=l^x,T=0;x>=4;)d=1540483477*(65535&(d=255&s.charCodeAt(T)|(255&s.charCodeAt(++T))<<8|(255&s.charCodeAt(++T))<<16|(255&s.charCodeAt(++T))<<24))+((1540483477*(d>>>16)&65535)<<16),C=1540483477*(65535&C)+((1540483477*(C>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),x-=4,++T;switch(x){case 3:C^=(255&s.charCodeAt(T+2))<<16;case 2:C^=(255&s.charCodeAt(T+1))<<8;case 1:C=1540483477*(65535&(C^=255&s.charCodeAt(T)))+((1540483477*(C>>>16)&65535)<<16)}return C=1540483477*(65535&(C^=C>>>13))+((1540483477*(C>>>16)&65535)<<16),(C^=C>>>15)>>>0}}),Xe=qe,dt=pt;Xe.murmur3=qe,Xe.murmur2=dt;var Ct=function(){this.ids=[],this.positions=[],this.indexed=!1};Ct.prototype.add=function(i,s,l,d){this.ids.push(vr(i)),this.positions.push(s,l,d)},Ct.prototype.getPositions=function(i){for(var s=vr(i),l=0,d=this.ids.length-1;l<d;){var x=l+d>>1;this.ids[x]>=s?d=x:l=x+1}for(var C=[];this.ids[l]===s;)C.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return C},Ct.serialize=function(i,s){var l=new Float64Array(i.ids),d=new Uint32Array(i.positions);return function x(C,T,O,U){for(;O<U;){for(var W=C[O+U>>1],$=O-1,te=U+1;;){do $++;while(C[$]<W);do te--;while(C[te]>W);if($>=te)break;er(C,$,te),er(T,3*$,3*te),er(T,3*$+1,3*te+1),er(T,3*$+2,3*te+2)}te-O<U-te?(x(C,T,O,te),O=te+1):(x(C,T,te+1,U),U=te)}}(l,d,0,l.length-1),s&&s.push(l.buffer,d.buffer),{ids:l,positions:d}},Ct.deserialize=function(i){var s=new Ct;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s};var Wt=Math.pow(2,53)-1;function vr(i){var s=+i;return!isNaN(s)&&s<=Wt?s:Xe(String(i))}function er(i,s,l){var d=i[s];i[s]=i[l],i[l]=d}ri("FeaturePositionMap",Ct);var wr=function(i,s){this.gl=i.gl,this.location=s},Wr=function(i){function s(l,d){i.call(this,l,d),this.current=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))},s}(wr),bn=function(i){function s(l,d){i.call(this,l,d),this.current=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))},s}(wr),gn=function(i){function s(l,d){i.call(this,l,d),this.current=[0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))},s}(wr),Gn=function(i){function s(l,d){i.call(this,l,d),this.current=[0,0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))},s}(wr),xi=function(i){function s(l,d){i.call(this,l,d),this.current=[0,0,0,0]}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))},s}(wr),Si=function(i){function s(l,d){i.call(this,l,d),this.current=Or.transparent}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))},s}(wr),bi=new Float32Array(16),Ea=function(i){function s(l,d){i.call(this,l,d),this.current=bi}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.set=function(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(var d=1;d<16;d++)if(l[d]!==this.current[d]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}},s}(wr);function Xn(i){return[ye(255*i.r,255*i.g),ye(255*i.b,255*i.a)]}var Hi=function(i,s,l){this.value=i,this.uniformNames=s.map(function(d){return"u_"+d}),this.type=l};Hi.prototype.setUniform=function(i,s,l){i.set(l.constantOr(this.value))},Hi.prototype.getBinding=function(i,s,l){return this.type==="color"?new Si(i,s):new bn(i,s)};var Qi=function(i,s){this.uniformNames=s.map(function(l){return"u_"+l}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Qi.prototype.setConstantPatternPositions=function(i,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=s.tlbr,this.patternTo=i.tlbr},Qi.prototype.setUniform=function(i,s,l,d){var x=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&i.set(x)},Qi.prototype.getBinding=function(i,s,l){return l.substr(0,9)==="u_pattern"?new xi(i,s):new bn(i,s)};var Wi=function(i,s,l,d){this.expression=i,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(function(x){return{name:"a_"+x,type:"Float32",components:l==="color"?2:1,offset:0}}),this.paintVertexArray=new d};Wi.prototype.populatePaintArray=function(i,s,l,d,x){var C=this.paintVertexArray.length,T=this.expression.evaluate(new la(0),s,{},d,[],x);this.paintVertexArray.resize(i),this._setPaintValue(C,i,T)},Wi.prototype.updatePaintArray=function(i,s,l,d){var x=this.expression.evaluate({zoom:0},l,d);this._setPaintValue(i,s,x)},Wi.prototype._setPaintValue=function(i,s,l){if(this.type==="color")for(var d=Xn(l),x=i;x<s;x++)this.paintVertexArray.emplace(x,d[0],d[1]);else{for(var C=i;C<s;C++)this.paintVertexArray.emplace(C,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}},Wi.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Wi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ri=function(i,s,l,d,x,C){this.expression=i,this.uniformNames=s.map(function(T){return"u_"+T+"_t"}),this.type=l,this.useIntegerZoom=d,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=s.map(function(T){return{name:"a_"+T,type:"Float32",components:l==="color"?4:2,offset:0}}),this.paintVertexArray=new C};Ri.prototype.populatePaintArray=function(i,s,l,d,x){var C=this.expression.evaluate(new la(this.zoom),s,{},d,[],x),T=this.expression.evaluate(new la(this.zoom+1),s,{},d,[],x),O=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(O,i,C,T)},Ri.prototype.updatePaintArray=function(i,s,l,d){var x=this.expression.evaluate({zoom:this.zoom},l,d),C=this.expression.evaluate({zoom:this.zoom+1},l,d);this._setPaintValue(i,s,x,C)},Ri.prototype._setPaintValue=function(i,s,l,d){if(this.type==="color")for(var x=Xn(l),C=Xn(d),T=i;T<s;T++)this.paintVertexArray.emplace(T,x[0],x[1],C[0],C[1]);else{for(var O=i;O<s;O++)this.paintVertexArray.emplace(O,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}},Ri.prototype.upload=function(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ri.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ri.prototype.setUniform=function(i,s){var l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,d=tr(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);i.set(d)},Ri.prototype.getBinding=function(i,s,l){return new bn(i,s)};var oa=function(i,s,l,d,x,C){this.expression=i,this.type=s,this.useIntegerZoom=l,this.zoom=d,this.layerId=C,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};oa.prototype.populatePaintArray=function(i,s,l){var d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(d,i,s.patterns&&s.patterns[this.layerId],l)},oa.prototype.updatePaintArray=function(i,s,l,d,x){this._setPaintValues(i,s,l.patterns&&l.patterns[this.layerId],x)},oa.prototype._setPaintValues=function(i,s,l,d){if(d&&l){var x=d[l.min],C=d[l.mid],T=d[l.max];if(x&&C&&T)for(var O=i;O<s;O++)this.zoomInPaintVertexArray.emplace(O,C.tl[0],C.tl[1],C.br[0],C.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],C.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,C.tl[0],C.tl[1],C.br[0],C.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],C.pixelRatio,T.pixelRatio)}},oa.prototype.upload=function(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,Qe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,Qe.members,this.expression.isStateDependent))},oa.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Zi=function(i,s,l){this.binders={},this._buffers=[];var d=[];for(var x in i.paint._values)if(l(x)){var C=i.paint.get(x);if(C instanceof pu&&el(C.property.specification)){var T=us(x,i.type),O=C.value,U=C.property.specification.type,W=C.property.useIntegerZoom,$=C.property.specification["property-type"],te=$==="cross-faded"||$==="cross-faded-data-driven";if(O.kind==="constant")this.binders[x]=te?new Qi(O.value,T):new Hi(O.value,T,U),d.push("/u_"+x);else if(O.kind==="source"||te){var he=Wo(x,U,"source");this.binders[x]=te?new oa(O,U,W,s,he,i.id):new Wi(O,T,U,he),d.push("/a_"+x)}else{var Ee=Wo(x,U,"composite");this.binders[x]=new Ri(O,T,U,W,s,Ee),d.push("/z_"+x)}}}this.cacheKey=d.sort().join("")};Zi.prototype.getMaxValue=function(i){var s=this.binders[i];return s instanceof Wi||s instanceof Ri?s.maxValue:0},Zi.prototype.populatePaintArrays=function(i,s,l,d,x){for(var C in this.binders){var T=this.binders[C];(T instanceof Wi||T instanceof Ri||T instanceof oa)&&T.populatePaintArray(i,s,l,d,x)}},Zi.prototype.setConstantPatternPositions=function(i,s){for(var l in this.binders){var d=this.binders[l];d instanceof Qi&&d.setConstantPatternPositions(i,s)}},Zi.prototype.updatePaintArrays=function(i,s,l,d,x){var C=!1;for(var T in i)for(var O=0,U=s.getPositions(T);O<U.length;O+=1){var W=U[O],$=l.feature(W.index);for(var te in this.binders){var he=this.binders[te];if((he instanceof Wi||he instanceof Ri||he instanceof oa)&&he.expression.isStateDependent===!0){var Ee=d.paint.get(te);he.expression=Ee.value,he.updatePaintArray(W.start,W.end,$,i[T],x),C=!0}}}return C},Zi.prototype.defines=function(){var i=[];for(var s in this.binders){var l=this.binders[s];(l instanceof Hi||l instanceof Qi)&&i.push.apply(i,l.uniformNames.map(function(d){return"#define HAS_UNIFORM_"+d}))}return i},Zi.prototype.getBinderAttributes=function(){var i=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Wi||l instanceof Ri)for(var d=0;d<l.paintVertexAttributes.length;d++)i.push(l.paintVertexAttributes[d].name);else if(l instanceof oa)for(var x=0;x<Qe.members.length;x++)i.push(Qe.members[x].name)}return i},Zi.prototype.getBinderUniforms=function(){var i=[];for(var s in this.binders){var l=this.binders[s];if(l instanceof Hi||l instanceof Qi||l instanceof Ri)for(var d=0,x=l.uniformNames;d<x.length;d+=1)i.push(x[d])}return i},Zi.prototype.getPaintVertexBuffers=function(){return this._buffers},Zi.prototype.getUniforms=function(i,s){var l=[];for(var d in this.binders){var x=this.binders[d];if(x instanceof Hi||x instanceof Qi||x instanceof Ri)for(var C=0,T=x.uniformNames;C<T.length;C+=1){var O=T[C];if(s[O]){var U=x.getBinding(i,s[O],O);l.push({name:O,property:d,binding:U})}}}return l},Zi.prototype.setUniforms=function(i,s,l,d){for(var x=0,C=s;x<C.length;x+=1){var T=C[x],O=T.name,U=T.property;this.binders[U].setUniform(T.binding,d,l.get(U),O)}},Zi.prototype.updatePaintBuffers=function(i){for(var s in this._buffers=[],this.binders){var l=this.binders[s];if(i&&l instanceof oa){var d=i.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof Wi||l instanceof Ri)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}},Zi.prototype.upload=function(i){for(var s in this.binders){var l=this.binders[s];(l instanceof Wi||l instanceof Ri||l instanceof oa)&&l.upload(i)}this.updatePaintBuffers()},Zi.prototype.destroy=function(){for(var i in this.binders){var s=this.binders[i];(s instanceof Wi||s instanceof Ri||s instanceof oa)&&s.destroy()}};var wi=function(i,s,l){l===void 0&&(l=function(){return!0}),this.programConfigurations={};for(var d=0,x=i;d<x.length;d+=1){var C=x[d];this.programConfigurations[C.id]=new Zi(C,s,l)}this.needsUpload=!1,this._featureMap=new Ct,this._bufferOffset=0};function us(i,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(s+"-","").replace(/-/g,"_")]}function Wo(i,s,l){var d={color:{source:Ao,composite:ef},number:{source:sc,composite:Ao}},x=function(C){return{"line-pattern":{source:ic,composite:ic},"fill-pattern":{source:ic,composite:ic},"fill-extrusion-pattern":{source:ic,composite:ic}}[C]}(i);return x&&x[l]||d[s][l]}wi.prototype.populatePaintArrays=function(i,s,l,d,x,C){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,s,d,x,C);s.id!==void 0&&this._featureMap.add(s.id,l,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0},wi.prototype.updatePaintArrays=function(i,s,l,d){for(var x=0,C=l;x<C.length;x+=1){var T=C[x];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(i,this._featureMap,s,T,d)||this.needsUpload}},wi.prototype.get=function(i){return this.programConfigurations[i]},wi.prototype.upload=function(i){if(this.needsUpload){for(var s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}},wi.prototype.destroy=function(){for(var i in this.programConfigurations)this.programConfigurations[i].destroy()},ri("ConstantBinder",Hi),ri("CrossFadedConstantBinder",Qi),ri("SourceExpressionBinder",Wi),ri("CrossFadedCompositeBinder",oa),ri("CompositeExpressionBinder",Ri),ri("ProgramConfiguration",Zi,{omit:["_buffers"]}),ri("ProgramConfigurationSet",wi);var Ds=Math.pow(2,14)-1,ls=-Ds-1;function co(i){for(var s=8192/i.extent,l=i.loadGeometry(),d=0;d<l.length;d++)for(var x=l[d],C=0;C<x.length;C++){var T=x[C],O=Math.round(T.x*s),U=Math.round(T.y*s);T.x=tr(O,ls,Ds),T.y=tr(U,ls,Ds),(O<T.x||O>T.x+1||U<T.y||U>T.y+1)&&Ue("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return l}function Jo(i,s){return{type:i.type,id:i.id,properties:i.properties,geometry:s?co(i):[]}}function es(i,s,l,d,x){i.emplaceBack(2*s+(d+1)/2,2*l+(x+1)/2)}var Bs=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new eh,this.indexArray=new oc,this.segments=new Me,this.programConfigurations=new wi(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function uc(i,s){for(var l=0;l<i.length;l++)if(cl(s,i[l]))return!0;for(var d=0;d<s.length;d++)if(cl(i,s[d]))return!0;return!!kf(i,s)}function ru(i,s,l){return!!cl(i,s)||!!Wl(s,i,l)}function Hu(i,s){if(i.length===1)return Pf(s,i[0]);for(var l=0;l<s.length;l++)for(var d=s[l],x=0;x<d.length;x++)if(cl(i,d[x]))return!0;for(var C=0;C<i.length;C++)if(Pf(s,i[C]))return!0;for(var T=0;T<s.length;T++)if(kf(i,s[T]))return!0;return!1}function Cu(i,s,l){if(i.length>1){if(kf(i,s))return!0;for(var d=0;d<s.length;d++)if(Wl(s[d],i,l))return!0}for(var x=0;x<i.length;x++)if(Wl(i[x],s,l))return!0;return!1}function kf(i,s){if(i.length===0||s.length===0)return!1;for(var l=0;l<i.length-1;l++)for(var d=i[l],x=i[l+1],C=0;C<s.length-1;C++)if(lc(d,x,s[C],s[C+1]))return!0;return!1}function lc(i,s,l,d){return Ar(i,l,d)!==Ar(s,l,d)&&Ar(i,s,l)!==Ar(i,s,d)}function Wl(i,s,l){var d=l*l;if(s.length===1)return i.distSqr(s[0])<d;for(var x=1;x<s.length;x++)if(wl(i,s[x-1],s[x])<d)return!0;return!1}function wl(i,s,l){var d=s.distSqr(l);if(d===0)return i.distSqr(s);var x=((i.x-s.x)*(l.x-s.x)+(i.y-s.y)*(l.y-s.y))/d;return i.distSqr(x<0?s:x>1?l:l.sub(s)._mult(x)._add(s))}function Pf(i,s){for(var l,d,x,C=!1,T=0;T<i.length;T++)for(var O=0,U=(l=i[T]).length-1;O<l.length;U=O++)(d=l[O]).y>s.y!=(x=l[U]).y>s.y&&s.x<(x.x-d.x)*(s.y-d.y)/(x.y-d.y)+d.x&&(C=!C);return C}function cl(i,s){for(var l=!1,d=0,x=i.length-1;d<i.length;x=d++){var C=i[d],T=i[x];C.y>s.y!=T.y>s.y&&s.x<(T.x-C.x)*(s.y-C.y)/(T.y-C.y)+C.x&&(l=!l)}return l}function cc(i,s,l){var d=l[0],x=l[2];if(i.x<d.x&&s.x<d.x||i.x>x.x&&s.x>x.x||i.y<d.y&&s.y<d.y||i.y>x.y&&s.y>x.y)return!1;var C=Ar(i,s,l[0]);return C!==Ar(i,s,l[1])||C!==Ar(i,s,l[2])||C!==Ar(i,s,l[3])}function Xl(i,s,l){var d=s.paint.get(i).value;return d.kind==="constant"?d.value:l.programConfigurations.get(s.id).getMaxValue(i)}function cs(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Tl(i,s,l,d,x){if(!s[0]&&!s[1])return i;var C=ve.convert(s)._mult(x);l==="viewport"&&C._rotate(-d);for(var T=[],O=0;O<i.length;O++)T.push(i[O].sub(C));return T}Bs.prototype.populate=function(i,s,l){var d=this.layers[0],x=[],C=null;d.type==="circle"&&(C=d.layout.get("circle-sort-key"));for(var T=0,O=i;T<O.length;T+=1){var U=O[T],W=U.feature,$=U.id,te=U.index,he=U.sourceLayerIndex,Ee=this.layers[0]._featureFilter.needGeometry,Ke=Jo(W,Ee);if(this.layers[0]._featureFilter.filter(new la(this.zoom),Ke,l)){var Je=C?C.evaluate(Ke,{},l):void 0,mt={id:$,properties:W.properties,type:W.type,sourceLayerIndex:he,index:te,geometry:Ee?Ke.geometry:co(W),patterns:{},sortKey:Je};x.push(mt)}}C&&x.sort(function(Un,Ai){return Un.sortKey-Ai.sortKey});for(var ct=0,Bt=x;ct<Bt.length;ct+=1){var Kt=Bt[ct],mr=Kt.geometry,gr=Kt.index,zr=Kt.sourceLayerIndex,fn=i[gr].feature;this.addFeature(Kt,mr,gr,l),s.featureIndex.insert(fn,mr,gr,zr,this.index)}},Bs.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},Bs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Bs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Bs.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Se),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},Bs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Bs.prototype.addFeature=function(i,s,l,d){for(var x=0,C=s;x<C.length;x+=1)for(var T=0,O=C[x];T<O.length;T+=1){var U=O[T],W=U.x,$=U.y;if(!(W<0||W>=8192||$<0||$>=8192)){var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),he=te.vertexLength;es(this.layoutVertexArray,W,$,-1,-1),es(this.layoutVertexArray,W,$,1,-1),es(this.layoutVertexArray,W,$,1,1),es(this.layoutVertexArray,W,$,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),te.vertexLength+=4,te.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,{},d)},ri("CircleBucket",Bs,{omit:["layers"]});var Oc=new Yo({"circle-sort-key":new pi(Ie.layout_circle["circle-sort-key"])}),Ns={paint:new Yo({"circle-radius":new pi(Ie.paint_circle["circle-radius"]),"circle-color":new pi(Ie.paint_circle["circle-color"]),"circle-blur":new pi(Ie.paint_circle["circle-blur"]),"circle-opacity":new pi(Ie.paint_circle["circle-opacity"]),"circle-translate":new _i(Ie.paint_circle["circle-translate"]),"circle-translate-anchor":new _i(Ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _i(Ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _i(Ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pi(Ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pi(Ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pi(Ie.paint_circle["circle-stroke-opacity"])}),layout:Oc},Na=typeof Float32Array!="undefined"?Float32Array:Array;function Ru(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qs(i,s,l){var d=s[0],x=s[1],C=s[2],T=s[3],O=s[4],U=s[5],W=s[6],$=s[7],te=s[8],he=s[9],Ee=s[10],Ke=s[11],Je=s[12],mt=s[13],ct=s[14],Bt=s[15],Kt=l[0],mr=l[1],gr=l[2],zr=l[3];return i[0]=Kt*d+mr*O+gr*te+zr*Je,i[1]=Kt*x+mr*U+gr*he+zr*mt,i[2]=Kt*C+mr*W+gr*Ee+zr*ct,i[3]=Kt*T+mr*$+gr*Ke+zr*Bt,i[4]=(Kt=l[4])*d+(mr=l[5])*O+(gr=l[6])*te+(zr=l[7])*Je,i[5]=Kt*x+mr*U+gr*he+zr*mt,i[6]=Kt*C+mr*W+gr*Ee+zr*ct,i[7]=Kt*T+mr*$+gr*Ke+zr*Bt,i[8]=(Kt=l[8])*d+(mr=l[9])*O+(gr=l[10])*te+(zr=l[11])*Je,i[9]=Kt*x+mr*U+gr*he+zr*mt,i[10]=Kt*C+mr*W+gr*Ee+zr*ct,i[11]=Kt*T+mr*$+gr*Ke+zr*Bt,i[12]=(Kt=l[12])*d+(mr=l[13])*O+(gr=l[14])*te+(zr=l[15])*Je,i[13]=Kt*x+mr*U+gr*he+zr*mt,i[14]=Kt*C+mr*W+gr*Ee+zr*ct,i[15]=Kt*T+mr*$+gr*Ke+zr*Bt,i}Math.hypot||(Math.hypot=function(){for(var i=arguments,s=0,l=arguments.length;l--;)s+=i[l]*i[l];return Math.sqrt(s)});var fc,rh=qs;function Lf(i,s,l){var d=s[0],x=s[1],C=s[2],T=s[3];return i[0]=l[0]*d+l[4]*x+l[8]*C+l[12]*T,i[1]=l[1]*d+l[5]*x+l[9]*C+l[13]*T,i[2]=l[2]*d+l[6]*x+l[10]*C+l[14]*T,i[3]=l[3]*d+l[7]*x+l[11]*C+l[15]*T,i}fc=new Na(3),Na!=Float32Array&&(fc[0]=0,fc[1]=0,fc[2]=0),function(){var i=new Na(4);Na!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0)}();var Sp=(function(){var i=new Na(2);Na!=Float32Array&&(i[0]=0,i[1]=0)}(),function(i){function s(l){i.call(this,l,Ns)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Bs(l)},s.prototype.queryRadius=function(l){var d=l;return Xl("circle-radius",this,d)+Xl("circle-stroke-width",this,d)+cs(this.paint.get("circle-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,O,U,W){for(var $=Tl(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),O.angle,U),te=this.paint.get("circle-radius").evaluate(d,x)+this.paint.get("circle-stroke-width").evaluate(d,x),he=this.paint.get("circle-pitch-alignment")==="map",Ee=he?$:function(fn,Un){return fn.map(function(Ai){return Wu(Ai,Un)})}($,W),Ke=he?te*U:te,Je=0,mt=C;Je<mt.length;Je+=1)for(var ct=0,Bt=mt[Je];ct<Bt.length;ct+=1){var Kt=Bt[ct],mr=he?Kt:Wu(Kt,W),gr=Ke,zr=Lf([],[Kt.x,Kt.y,0,1],W);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?gr*=zr[3]/O.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(gr*=O.cameraToCenterDistance/zr[3]),ru(Ee,mr,gr))return!0}return!1},s}(Lu));function Wu(i,s){var l=Lf([],[i.x,i.y,0,1],s);return new ve(l[0]/l[3],l[1]/l[3])}var Fc=function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Bs);function Su(i,s,l,d){var x=s.width,C=s.height;if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==x*C*l)throw new RangeError("mismatched image size")}else d=new Uint8Array(x*C*l);return i.width=x,i.height=C,i.data=d,i}function Rf(i,s,l){var d=s.width,x=s.height;if(d!==i.width||x!==i.height){var C=Su({},{width:d,height:x},l);nh(i,C,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,d),height:Math.min(i.height,x)},l),i.width=d,i.height=x,i.data=C.data}}function nh(i,s,l,d,x,C){if(x.width===0||x.height===0)return s;if(x.width>i.width||x.height>i.height||l.x>i.width-x.width||l.y>i.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>s.width||x.height>s.height||d.x>s.width-x.width||d.y>s.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=i.data,O=s.data,U=0;U<x.height;U++)for(var W=((l.y+U)*i.width+l.x)*C,$=((d.y+U)*s.width+d.x)*C,te=0;te<x.width*C;te++)O[$+te]=T[W+te];return s}ri("HeatmapBucket",Fc,{omit:["layers"]});var Yl=function(i,s){Su(this,i,1,s)};Yl.prototype.resize=function(i){Rf(this,i,1)},Yl.prototype.clone=function(){return new Yl({width:this.width,height:this.height},new Uint8Array(this.data))},Yl.copy=function(i,s,l,d,x){nh(i,s,l,d,x,1)};var zs=function(i,s){Su(this,i,4,s)};zs.prototype.resize=function(i){Rf(this,i,4)},zs.prototype.replace=function(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i},zs.prototype.clone=function(){return new zs({width:this.width,height:this.height},new Uint8Array(this.data))},zs.copy=function(i,s,l,d,x){nh(i,s,l,d,x,4)},ri("AlphaImage",Yl),ri("RGBAImage",zs);var Of={paint:new Yo({"heatmap-radius":new pi(Ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pi(Ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _i(Ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ul(Ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _i(Ie.paint_heatmap["heatmap-opacity"])})};function Ml(i){var s={},l=i.resolution||256,d=i.clips?i.clips.length:1,x=i.image||new zs({width:l,height:d}),C=function(Ke,Je,mt){s[i.evaluationKey]=mt;var ct=i.expression.evaluate(s);x.data[Ke+Je+0]=Math.floor(255*ct.r/ct.a),x.data[Ke+Je+1]=Math.floor(255*ct.g/ct.a),x.data[Ke+Je+2]=Math.floor(255*ct.b/ct.a),x.data[Ke+Je+3]=Math.floor(255*ct.a)};if(i.clips)for(var T=0,O=0;T<d;++T,O+=4*l)for(var U=0,W=0;U<l;U++,W+=4){var $=U/(l-1),te=i.clips[T];C(O,W,te.start*(1-$)+te.end*$)}else for(var he=0,Ee=0;he<l;he++,Ee+=4)C(0,Ee,he/(l-1));return x}var Oh=function(i){function s(l){i.call(this,l,Of),this._updateColorRamp()}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new Fc(l)},s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="heatmap-color"&&this._updateColorRamp()},s.prototype._updateColorRamp=function(){this.colorRamp=Ml({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},s.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},s}(Lu),nu={paint:new Yo({"hillshade-illumination-direction":new _i(Ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _i(Ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _i(Ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _i(Ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _i(Ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _i(Ie.paint_hillshade["hillshade-accent-color"])})},ih=function(i){function s(l){i.call(this,l,nu)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},s}(Lu),Ou=po([{name:"a_pos",components:2,type:"Int16"}],4).members,re=ah,un=ah;function ah(i,s,l){l=l||2;var d,x,C,T,O,U,W,$=s&&s.length,te=$?s[0]*l:i.length,he=L0(i,0,te,l,!0),Ee=[];if(!he||he.next===he.prev)return Ee;if($&&(he=function(Je,mt,ct,Bt){var Kt,mr,gr,zr=[];for(Kt=0,mr=mt.length;Kt<mr;Kt++)(gr=L0(Je,mt[Kt]*Bt,Kt<mr-1?mt[Kt+1]*Bt:Je.length,Bt,!1))===gr.next&&(gr.steiner=!0),zr.push(hc(gr));for(zr.sort(Md),Kt=0;Kt<zr.length;Kt++)t0(zr[Kt],ct),ct=Io(ct,ct.next);return ct}(i,s,he,l)),i.length>80*l){d=C=i[0],x=T=i[1];for(var Ke=l;Ke<te;Ke+=l)(O=i[Ke])<d&&(d=O),(U=i[Ke+1])<x&&(x=U),O>C&&(C=O),U>T&&(T=U);W=(W=Math.max(C-d,T-x))!==0?1/W:0}return fl(he,Ee,l,d,x,W),Ee}function L0(i,s,l,d,x){var C,T;if(x===rf(i,s,l,d)>0)for(C=s;C<l;C+=d)T=wp(C,i[C],i[C+1],T);else for(C=l-d;C>=s;C-=d)T=wp(C,i[C],i[C+1],T);return T&&Ap(T,T.next)&&(Il(T),T=T.next),T}function Io(i,s){if(!i)return i;s||(s=i);var l,d=i;do if(l=!1,d.steiner||!Ap(d,d.next)&&fs(d.prev,d,d.next)!==0)d=d.next;else{if(Il(d),(d=s=d.prev)===d.next)break;l=!0}while(l||d!==s);return s}function fl(i,s,l,d,x,C,T){if(i){!T&&C&&function($,te,he,Ee){var Ke=$;do Ke.z===null&&(Ke.z=Fh(Ke.x,Ke.y,te,he,Ee)),Ke.prevZ=Ke.prev,Ke.nextZ=Ke.next,Ke=Ke.next;while(Ke!==$);Ke.prevZ.nextZ=null,Ke.prevZ=null,function(Je){var mt,ct,Bt,Kt,mr,gr,zr,fn,Un=1;do{for(ct=Je,Je=null,mr=null,gr=0;ct;){for(gr++,Bt=ct,zr=0,mt=0;mt<Un&&(zr++,Bt=Bt.nextZ);mt++);for(fn=Un;zr>0||fn>0&&Bt;)zr!==0&&(fn===0||!Bt||ct.z<=Bt.z)?(Kt=ct,ct=ct.nextZ,zr--):(Kt=Bt,Bt=Bt.nextZ,fn--),mr?mr.nextZ=Kt:Je=Kt,Kt.prevZ=mr,mr=Kt;ct=Bt}mr.nextZ=null,Un*=2}while(gr>1)}(Ke)}(i,d,x,C);for(var O,U,W=i;i.prev!==i.next;)if(O=i.prev,U=i.next,C?ed(i,d,x,C):oh(i))s.push(O.i/l),s.push(i.i/l),s.push(U.i/l),Il(i),i=U.next,W=U.next;else if((i=U)===W){T?T===1?fl(i=Us(Io(i),s,l),s,l,d,x,C,2):T===2&&Au(i,s,l,d,x,C):fl(Io(i),s,l,d,x,C,1);break}}}function oh(i){var s=i.prev,l=i,d=i.next;if(fs(s,l,d)>=0)return!1;for(var x=i.next.next;x!==i.prev;){if(sh(s.x,s.y,l.x,l.y,d.x,d.y,x.x,x.y)&&fs(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function ed(i,s,l,d){var x=i.prev,C=i,T=i.next;if(fs(x,C,T)>=0)return!1;for(var O=x.x>C.x?x.x>T.x?x.x:T.x:C.x>T.x?C.x:T.x,U=x.y>C.y?x.y>T.y?x.y:T.y:C.y>T.y?C.y:T.y,W=Fh(x.x<C.x?x.x<T.x?x.x:T.x:C.x<T.x?C.x:T.x,x.y<C.y?x.y<T.y?x.y:T.y:C.y<T.y?C.y:T.y,s,l,d),$=Fh(O,U,s,l,d),te=i.prevZ,he=i.nextZ;te&&te.z>=W&&he&&he.z<=$;){if(te!==i.prev&&te!==i.next&&sh(x.x,x.y,C.x,C.y,T.x,T.y,te.x,te.y)&&fs(te.prev,te,te.next)>=0||(te=te.prevZ,he!==i.prev&&he!==i.next&&sh(x.x,x.y,C.x,C.y,T.x,T.y,he.x,he.y)&&fs(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;te&&te.z>=W;){if(te!==i.prev&&te!==i.next&&sh(x.x,x.y,C.x,C.y,T.x,T.y,te.x,te.y)&&fs(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;he&&he.z<=$;){if(he!==i.prev&&he!==i.next&&sh(x.x,x.y,C.x,C.y,T.x,T.y,he.x,he.y)&&fs(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function Us(i,s,l){var d=i;do{var x=d.prev,C=d.next.next;!Ap(x,C)&&td(x,d,d.next,C)&&Dh(x,C)&&Dh(C,x)&&(s.push(x.i/l),s.push(d.i/l),s.push(C.i/l),Il(d),Il(d.next),d=i=C),d=d.next}while(d!==i);return Io(d)}function Au(i,s,l,d,x,C){var T=i;do{for(var O=T.next.next;O!==T.prev;){if(T.i!==O.i&&Ff(T,O)){var U=Dc(T,O);return T=Io(T,T.next),U=Io(U,U.next),fl(T,s,l,d,x,C),void fl(U,s,l,d,x,C)}O=O.next}T=T.next}while(T!==i)}function Md(i,s){return i.x-s.x}function t0(i,s){if(s=function(d,x){var C,T=x,O=d.x,U=d.y,W=-1/0;do{if(U<=T.y&&U>=T.next.y&&T.next.y!==T.y){var $=T.x+(U-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if($<=O&&$>W){if(W=$,$===O){if(U===T.y)return T;if(U===T.next.y)return T.next}C=T.x<T.next.x?T:T.next}}T=T.next}while(T!==x);if(!C)return null;if(O===W)return C;var te,he=C,Ee=C.x,Ke=C.y,Je=1/0;T=C;do O>=T.x&&T.x>=Ee&&O!==T.x&&sh(U<Ke?O:W,U,Ee,Ke,U<Ke?W:O,U,T.x,T.y)&&(te=Math.abs(U-T.y)/(O-T.x),Dh(T,d)&&(te<Je||te===Je&&(T.x>C.x||T.x===C.x&&Id(C,T)))&&(C=T,Je=te)),T=T.next;while(T!==he);return C}(i,s)){var l=Dc(s,i);Io(s,s.next),Io(l,l.next)}}function Id(i,s){return fs(i.prev,i,s.prev)<0&&fs(s.next,i,i.next)<0}function Fh(i,s,l,d,x){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-l)*x)|i<<8))|i<<4))|i<<2))|i<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-d)*x)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function hc(i){var s=i,l=i;do(s.x<l.x||s.x===l.x&&s.y<l.y)&&(l=s),s=s.next;while(s!==i);return l}function sh(i,s,l,d,x,C,T,O){return(x-T)*(s-O)-(i-T)*(C-O)>=0&&(i-T)*(d-O)-(l-T)*(s-O)>=0&&(l-T)*(C-O)-(x-T)*(d-O)>=0}function Ff(i,s){return i.next.i!==s.i&&i.prev.i!==s.i&&!function(l,d){var x=l;do{if(x.i!==l.i&&x.next.i!==l.i&&x.i!==d.i&&x.next.i!==d.i&&td(x,x.next,l,d))return!0;x=x.next}while(x!==l);return!1}(i,s)&&(Dh(i,s)&&Dh(s,i)&&function(l,d){var x=l,C=!1,T=(l.x+d.x)/2,O=(l.y+d.y)/2;do x.y>O!=x.next.y>O&&x.next.y!==x.y&&T<(x.next.x-x.x)*(O-x.y)/(x.next.y-x.y)+x.x&&(C=!C),x=x.next;while(x!==l);return C}(i,s)&&(fs(i.prev,i,s.prev)||fs(i,s.prev,s))||Ap(i,s)&&fs(i.prev,i,i.next)>0&&fs(s.prev,s,s.next)>0)}function fs(i,s,l){return(s.y-i.y)*(l.x-s.x)-(s.x-i.x)*(l.y-s.y)}function Ap(i,s){return i.x===s.x&&i.y===s.y}function td(i,s,l,d){var x=rd(fs(i,s,l)),C=rd(fs(i,s,d)),T=rd(fs(l,d,i)),O=rd(fs(l,d,s));return x!==C&&T!==O||!(x!==0||!Xi(i,l,s))||!(C!==0||!Xi(i,d,s))||!(T!==0||!Xi(l,i,d))||!(O!==0||!Xi(l,s,d))}function Xi(i,s,l){return s.x<=Math.max(i.x,l.x)&&s.x>=Math.min(i.x,l.x)&&s.y<=Math.max(i.y,l.y)&&s.y>=Math.min(i.y,l.y)}function rd(i){return i>0?1:i<0?-1:0}function Dh(i,s){return fs(i.prev,i,i.next)<0?fs(i,s,i.next)>=0&&fs(i,i.prev,s)>=0:fs(i,s,i.prev)<0||fs(i,i.next,s)<0}function Dc(i,s){var l=new tf(i.i,i.x,i.y),d=new tf(s.i,s.x,s.y),x=i.next,C=s.prev;return i.next=s,s.prev=i,l.next=x,x.prev=l,d.next=l,l.prev=d,C.next=d,d.prev=C,d}function wp(i,s,l,d){var x=new tf(i,s,l);return d?(x.next=d.next,x.prev=d,d.next.prev=x,d.next=x):(x.prev=x,x.next=x),x}function Il(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function tf(i,s,l){this.i=i,this.x=s,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function rf(i,s,l,d){for(var x=0,C=s,T=l-d;C<l;C+=d)x+=(i[T]-i[C])*(i[C+1]+i[T+1]),T=C;return x}function nd(i,s,l,d,x){(function C(T,O,U,W,$){for(;W>U;){if(W-U>600){var te=W-U+1,he=O-U+1,Ee=Math.log(te),Ke=.5*Math.exp(2*Ee/3),Je=.5*Math.sqrt(Ee*Ke*(te-Ke)/te)*(he-te/2<0?-1:1);C(T,O,Math.max(U,Math.floor(O-he*Ke/te+Je)),Math.min(W,Math.floor(O+(te-he)*Ke/te+Je)),$)}var mt=T[O],ct=U,Bt=W;for(uh(T,U,O),$(T[W],mt)>0&&uh(T,U,W);ct<Bt;){for(uh(T,ct,Bt),ct++,Bt--;$(T[ct],mt)<0;)ct++;for(;$(T[Bt],mt)>0;)Bt--}$(T[U],mt)===0?uh(T,U,Bt):uh(T,++Bt,W),Bt<=O&&(U=Bt+1),O<=Bt&&(W=Bt-1)}})(i,s,l||0,d||i.length-1,x||pc)}function uh(i,s,l){var d=i[s];i[s]=i[l],i[l]=d}function pc(i,s){return i<s?-1:i>s?1:0}function Tp(i,s){var l=i.length;if(l<=1)return[i];for(var d,x,C=[],T=0;T<l;T++){var O=an(i[T]);O!==0&&(i[T].area=Math.abs(O),x===void 0&&(x=O<0),x===O<0?(d&&C.push(d),d=[i[T]]):d.push(i[T]))}if(d&&C.push(d),s>1)for(var U=0;U<C.length;U++)C[U].length<=s||(nd(C[U],s,1,C[U].length-1,Jh),C[U]=C[U].slice(0,s));return C}function Jh(i,s){return s.area-i.area}function dc(i,s,l){for(var d=l.patternDependencies,x=!1,C=0,T=s;C<T.length;C+=1){var O=T[C].paint.get(i+"-pattern");O.isConstant()||(x=!0);var U=O.constantOr(null);U&&(x=!0,d[U.to]=!0,d[U.from]=!0)}return x}function nf(i,s,l,d,x){for(var C=x.patternDependencies,T=0,O=s;T<O.length;T+=1){var U=O[T],W=U.paint.get(i+"-pattern").value;if(W.kind!=="constant"){var $=W.evaluate({zoom:d-1},l,{},x.availableImages),te=W.evaluate({zoom:d},l,{},x.availableImages),he=W.evaluate({zoom:d+1},l,{},x.availableImages);te=te&&te.name?te.name:te,he=he&&he.name?he.name:he,C[$=$&&$.name?$.name:$]=!0,C[te]=!0,C[he]=!0,l.patterns[U.id]={min:$,mid:te,max:he}}}return l}ah.deviation=function(i,s,l,d){var x=s&&s.length,C=Math.abs(rf(i,0,x?s[0]*l:i.length,l));if(x)for(var T=0,O=s.length;T<O;T++)C-=Math.abs(rf(i,s[T]*l,T<O-1?s[T+1]*l:i.length,l));var U=0;for(T=0;T<d.length;T+=3){var W=d[T]*l,$=d[T+1]*l,te=d[T+2]*l;U+=Math.abs((i[W]-i[te])*(i[$+1]-i[W+1])-(i[W]-i[$])*(i[te+1]-i[W+1]))}return C===0&&U===0?0:Math.abs((U-C)/C)},ah.flatten=function(i){for(var s=i[0][0].length,l={vertices:[],holes:[],dimensions:s},d=0,x=0;x<i.length;x++){for(var C=0;C<i[x].length;C++)for(var T=0;T<s;T++)l.vertices.push(i[x][C][T]);x>0&&l.holes.push(d+=i[x-1].length)}return l},re.default=un;var kl=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new eh,this.indexArray=new oc,this.indexArray2=new Rh,this.programConfigurations=new wi(i.layers,i.zoom),this.segments=new Me,this.segments2=new Me,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};kl.prototype.populate=function(i,s,l){this.hasPattern=dc("fill",this.layers,s);for(var d=this.layers[0].layout.get("fill-sort-key"),x=[],C=0,T=i;C<T.length;C+=1){var O=T[C],U=O.feature,W=O.id,$=O.index,te=O.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,Ee=Jo(U,he);if(this.layers[0]._featureFilter.filter(new la(this.zoom),Ee,l)){var Ke=d?d.evaluate(Ee,{},l,s.availableImages):void 0,Je={id:W,properties:U.properties,type:U.type,sourceLayerIndex:te,index:$,geometry:he?Ee.geometry:co(U),patterns:{},sortKey:Ke};x.push(Je)}}d&&x.sort(function(fn,Un){return fn.sortKey-Un.sortKey});for(var mt=0,ct=x;mt<ct.length;mt+=1){var Bt=ct[mt],Kt=Bt.geometry,mr=Bt.index,gr=Bt.sourceLayerIndex;if(this.hasPattern){var zr=nf("fill",this.layers,Bt,this.zoom,s);this.patternFeatures.push(zr)}else this.addFeature(Bt,Kt,mr,l,{});s.featureIndex.insert(i[mr].feature,Kt,mr,gr,this.index)}},kl.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},kl.prototype.addFeatures=function(i,s,l){for(var d=0,x=this.patternFeatures;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},kl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},kl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},kl.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ou),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0},kl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},kl.prototype.addFeature=function(i,s,l,d,x){for(var C=0,T=Tp(s,500);C<T.length;C+=1){for(var O=T[C],U=0,W=0,$=O;W<$.length;W+=1)U+=$[W].length;for(var te=this.segments.prepareSegment(U,this.layoutVertexArray,this.indexArray),he=te.vertexLength,Ee=[],Ke=[],Je=0,mt=O;Je<mt.length;Je+=1){var ct=mt[Je];if(ct.length!==0){ct!==O[0]&&Ke.push(Ee.length/2);var Bt=this.segments2.prepareSegment(ct.length,this.layoutVertexArray,this.indexArray2),Kt=Bt.vertexLength;this.layoutVertexArray.emplaceBack(ct[0].x,ct[0].y),this.indexArray2.emplaceBack(Kt+ct.length-1,Kt),Ee.push(ct[0].x),Ee.push(ct[0].y);for(var mr=1;mr<ct.length;mr++)this.layoutVertexArray.emplaceBack(ct[mr].x,ct[mr].y),this.indexArray2.emplaceBack(Kt+mr-1,Kt+mr),Ee.push(ct[mr].x),Ee.push(ct[mr].y);Bt.vertexLength+=ct.length,Bt.primitiveLength+=ct.length}}for(var gr=re(Ee,Ke),zr=0;zr<gr.length;zr+=3)this.indexArray.emplaceBack(he+gr[zr],he+gr[zr+1],he+gr[zr+2]);te.vertexLength+=U,te.primitiveLength+=gr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,x,d)},ri("FillBucket",kl,{omit:["layers","patternFeatures"]});var lh=new Yo({"fill-sort-key":new pi(Ie.layout_fill["fill-sort-key"])}),af={paint:new Yo({"fill-antialias":new _i(Ie.paint_fill["fill-antialias"]),"fill-opacity":new pi(Ie.paint_fill["fill-opacity"]),"fill-color":new pi(Ie.paint_fill["fill-color"]),"fill-outline-color":new pi(Ie.paint_fill["fill-outline-color"]),"fill-translate":new _i(Ie.paint_fill["fill-translate"]),"fill-translate-anchor":new _i(Ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mf(Ie.paint_fill["fill-pattern"])}),layout:lh},Fu=function(i){function s(l){i.call(this,l,af)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.recalculate=function(l,d){i.prototype.recalculate.call(this,l,d);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},s.prototype.createBucket=function(l){return new kl(l)},s.prototype.queryRadius=function(){return cs(this.paint.get("fill-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,O,U){return Hu(Tl(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),O.angle,U),C)},s.prototype.isTileClipped=function(){return!0},s}(Lu),ch=po([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Mp=Bc;function Bc(i,s,l,d,x){this.properties={},this.extent=l,this.type=0,this._pbf=i,this._geometry=-1,this._keys=d,this._values=x,i.readFields(of,this,s)}function of(i,s,l){i==1?s.id=l.readVarint():i==2?function(d,x){for(var C=d.readVarint()+d.pos;d.pos<C;){var T=x._keys[d.readVarint()],O=x._values[d.readVarint()];x.properties[T]=O}}(l,s):i==3?s.type=l.readVarint():i==4&&(s._geometry=l.pos)}function kd(i){for(var s,l,d=0,x=0,C=i.length,T=C-1;x<C;T=x++)d+=((l=i[T]).x-(s=i[x]).x)*(s.y+l.y);return d}Bc.types=["Unknown","Point","LineString","Polygon"],Bc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var s,l=i.readVarint()+i.pos,d=1,x=0,C=0,T=0,O=[];i.pos<l;){if(x<=0){var U=i.readVarint();d=7&U,x=U>>3}if(x--,d===1||d===2)C+=i.readSVarint(),T+=i.readSVarint(),d===1&&(s&&O.push(s),s=[]),s.push(new ve(C,T));else{if(d!==7)throw new Error("unknown command "+d);s&&s.push(s[0].clone())}}return s&&O.push(s),O},Bc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var s=i.readVarint()+i.pos,l=1,d=0,x=0,C=0,T=1/0,O=-1/0,U=1/0,W=-1/0;i.pos<s;){if(d<=0){var $=i.readVarint();l=7&$,d=$>>3}if(d--,l===1||l===2)(x+=i.readSVarint())<T&&(T=x),x>O&&(O=x),(C+=i.readSVarint())<U&&(U=C),C>W&&(W=C);else if(l!==7)throw new Error("unknown command "+l)}return[T,U,O,W]},Bc.prototype.toGeoJSON=function(i,s,l){var d,x,C=this.extent*Math.pow(2,l),T=this.extent*i,O=this.extent*s,U=this.loadGeometry(),W=Bc.types[this.type];function $(Ee){for(var Ke=0;Ke<Ee.length;Ke++){var Je=Ee[Ke];Ee[Ke]=[360*(Je.x+T)/C-180,360/Math.PI*Math.atan(Math.exp((180-360*(Je.y+O)/C)*Math.PI/180))-90]}}switch(this.type){case 1:var te=[];for(d=0;d<U.length;d++)te[d]=U[d][0];$(U=te);break;case 2:for(d=0;d<U.length;d++)$(U[d]);break;case 3:for(U=function(Ee){var Ke=Ee.length;if(Ke<=1)return[Ee];for(var Je,mt,ct=[],Bt=0;Bt<Ke;Bt++){var Kt=kd(Ee[Bt]);Kt!==0&&(mt===void 0&&(mt=Kt<0),mt===Kt<0?(Je&&ct.push(Je),Je=[Ee[Bt]]):Je.push(Ee[Bt]))}return Je&&ct.push(Je),ct}(U),d=0;d<U.length;d++)for(x=0;x<U[d].length;x++)$(U[d][x])}U.length===1?U=U[0]:W="Multi"+W;var he={type:"Feature",geometry:{type:W,coordinates:U},properties:this.properties};return"id"in this&&(he.id=this.id),he};var Df=Pd;function Pd(i,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(vc,this,s),this.length=this._features.length}function vc(i,s,l){i===15?s.version=l.readVarint():i===1?s.name=l.readString():i===5?s.extent=l.readVarint():i===2?s._features.push(l.pos):i===3?s._keys.push(l.readString()):i===4&&s._values.push(function(d){for(var x=null,C=d.readVarint()+d.pos;d.pos<C;){var T=d.readVarint()>>3;x=T===1?d.readString():T===2?d.readFloat():T===3?d.readDouble():T===4?d.readVarint64():T===5?d.readVarint():T===6?d.readSVarint():T===7?d.readBoolean():null}return x}(l))}function ql(i,s,l){if(i===3){var d=new Df(l,l.readVarint()+l.pos);d.length&&(s[d.name]=d)}}Pd.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var s=this._pbf.readVarint()+this._pbf.pos;return new Mp(this._pbf,s,this.extent,this._keys,this._values)};var Zs={VectorTile:function(i,s){this.layers=i.readFields(ql,{},s)},VectorTileFeature:Mp,VectorTileLayer:Df},Bf=Zs.VectorTileFeature.types,Nc=Math.pow(2,13);function Bh(i,s,l,d,x,C,T,O){i.emplaceBack(s,l,2*Math.floor(d*Nc)+T,x*Nc*2,C*Nc*2,Math.round(O))}var zc=function(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Sl,this.indexArray=new oc,this.programConfigurations=new wi(i.layers,i.zoom),this.segments=new Me,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};function Ip(i,s){return i.x===s.x&&(i.x<0||i.x>8192)||i.y===s.y&&(i.y<0||i.y>8192)}zc.prototype.populate=function(i,s,l){this.features=[],this.hasPattern=dc("fill-extrusion",this.layers,s);for(var d=0,x=i;d<x.length;d+=1){var C=x[d],T=C.feature,O=C.id,U=C.index,W=C.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,te=Jo(T,$);if(this.layers[0]._featureFilter.filter(new la(this.zoom),te,l)){var he={id:O,sourceLayerIndex:W,index:U,geometry:$?te.geometry:co(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(nf("fill-extrusion",this.layers,he,this.zoom,s)):this.addFeature(he,he.geometry,U,l,{}),s.featureIndex.insert(T,he.geometry,U,W,this.index,!0)}}},zc.prototype.addFeatures=function(i,s,l){for(var d=0,x=this.features;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},zc.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},zc.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zc.prototype.upload=function(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ch),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},zc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zc.prototype.addFeature=function(i,s,l,d,x){for(var C=0,T=Tp(s,500);C<T.length;C+=1){for(var O=T[C],U=0,W=0,$=O;W<$.length;W+=1)U+=$[W].length;for(var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,Ee=O;he<Ee.length;he+=1){var Ke=Ee[he];if(Ke.length!==0&&!((La=Ke).every(function(fa){return fa.x<0})||La.every(function(fa){return fa.x>8192})||La.every(function(fa){return fa.y<0})||La.every(function(fa){return fa.y>8192})))for(var Je=0,mt=0;mt<Ke.length;mt++){var ct=Ke[mt];if(mt>=1){var Bt=Ke[mt-1];if(!Ip(ct,Bt)){te.vertexLength+4>Me.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Kt=ct.sub(Bt)._perp()._unit(),mr=Bt.dist(ct);Je+mr>32768&&(Je=0),Bh(this.layoutVertexArray,ct.x,ct.y,Kt.x,Kt.y,0,0,Je),Bh(this.layoutVertexArray,ct.x,ct.y,Kt.x,Kt.y,0,1,Je),Bh(this.layoutVertexArray,Bt.x,Bt.y,Kt.x,Kt.y,0,0,Je+=mr),Bh(this.layoutVertexArray,Bt.x,Bt.y,Kt.x,Kt.y,0,1,Je);var gr=te.vertexLength;this.indexArray.emplaceBack(gr,gr+2,gr+1),this.indexArray.emplaceBack(gr+1,gr+2,gr+3),te.vertexLength+=4,te.primitiveLength+=2}}}}if(te.vertexLength+U>Me.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(U,this.layoutVertexArray,this.indexArray)),Bf[i.type]==="Polygon"){for(var zr=[],fn=[],Un=te.vertexLength,Ai=0,ei=O;Ai<ei.length;Ai+=1){var Ii=ei[Ai];if(Ii.length!==0){Ii!==O[0]&&fn.push(zr.length/2);for(var Kn=0;Kn<Ii.length;Kn++){var ua=Ii[Kn];Bh(this.layoutVertexArray,ua.x,ua.y,0,0,1,1,0),zr.push(ua.x),zr.push(ua.y)}}}for(var qi=re(zr,fn),mi=0;mi<qi.length;mi+=3)this.indexArray.emplaceBack(Un+qi[mi],Un+qi[mi+2],Un+qi[mi+1]);te.primitiveLength+=qi.length/3,te.vertexLength+=U}}var La;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,x,d)},ri("FillExtrusionBucket",zc,{omit:["layers","features"]});var R0={paint:new Yo({"fill-extrusion-opacity":new _i(Ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pi(Ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _i(Ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _i(Ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mf(Ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pi(Ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pi(Ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _i(Ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},mc=function(i){function s(l){i.call(this,l,R0)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.createBucket=function(l){return new zc(l)},s.prototype.queryRadius=function(){return cs(this.paint.get("fill-extrusion-translate"))},s.prototype.is3D=function(){return!0},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,O,U,W){var $=Tl(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),O.angle,U),te=this.paint.get("fill-extrusion-height").evaluate(d,x),he=this.paint.get("fill-extrusion-base").evaluate(d,x),Ee=function(Je,mt,ct,Bt){for(var Kt=[],mr=0,gr=Je;mr<gr.length;mr+=1){var zr=gr[mr],fn=[zr.x,zr.y,0,1];Lf(fn,fn,mt),Kt.push(new ve(fn[0]/fn[3],fn[1]/fn[3]))}return Kt}($,W),Ke=function(Je,mt,ct,Bt){for(var Kt=[],mr=[],gr=Bt[8]*mt,zr=Bt[9]*mt,fn=Bt[10]*mt,Un=Bt[11]*mt,Ai=Bt[8]*ct,ei=Bt[9]*ct,Ii=Bt[10]*ct,Kn=Bt[11]*ct,ua=0,qi=Je;ua<qi.length;ua+=1){for(var mi=[],La=[],fa=0,Za=qi[ua];fa<Za.length;fa+=1){var ki=Za[fa],to=ki.x,Xo=ki.y,Zo=Bt[0]*to+Bt[4]*Xo+Bt[12],_s=Bt[1]*to+Bt[5]*Xo+Bt[13],Yr=Bt[2]*to+Bt[6]*Xo+Bt[14],xs=Bt[3]*to+Bt[7]*Xo+Bt[15],nr=Yr+fn,au=xs+Un,Yu=Zo+Ai,hs=_s+ei,Bu=Yr+Ii,bs=xs+Kn,Es=new ve((Zo+gr)/au,(_s+zr)/au);Es.z=nr/au,mi.push(Es);var Fa=new ve(Yu/bs,hs/bs);Fa.z=Bu/bs,La.push(Fa)}Kt.push(mi),mr.push(La)}return[Kt,mr]}(C,he,te,W);return function(Je,mt,ct){var Bt=1/0;Hu(ct,mt)&&(Bt=hh(ct,mt[0]));for(var Kt=0;Kt<mt.length;Kt++)for(var mr=mt[Kt],gr=Je[Kt],zr=0;zr<mr.length-1;zr++){var fn=mr[zr],Un=[fn,mr[zr+1],gr[zr+1],gr[zr],fn];uc(ct,Un)&&(Bt=Math.min(Bt,hh(ct,Un)))}return Bt!==1/0&&Bt}(Ke[0],Ke[1],Ee)},s}(Lu);function fh(i,s){return i.x*s.x+i.y*s.y}function hh(i,s){if(i.length===1){for(var l,d=0,x=s[d++];!l||x.equals(l);)if(!(l=s[d++]))return 1/0;for(;d<s.length;d++){var C=s[d],T=i[0],O=l.sub(x),U=C.sub(x),W=T.sub(x),$=fh(O,O),te=fh(O,U),he=fh(U,U),Ee=fh(W,O),Ke=fh(W,U),Je=$*he-te*te,mt=(he*Ee-te*Ke)/Je,ct=($*Ke-te*Ee)/Je,Bt=x.z*(1-mt-ct)+l.z*mt+C.z*ct;if(isFinite(Bt))return Bt}return 1/0}for(var Kt=1/0,mr=0,gr=s;mr<gr.length;mr+=1)Kt=Math.min(Kt,gr[mr].z);return Kt}var Nf=po([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ld=po([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,id=Zs.VectorTileFeature.types,Xu=Math.cos(Math.PI/180*37.5),kp=Math.pow(2,14)/.5,uo=function(i){var s=this;this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(l){return l.id}),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(l){s.gradients[l.id]={}}),this.layoutVertexArray=new Fs,this.layoutVertexArray2=new Ao,this.indexArray=new oc,this.programConfigurations=new wi(i.layers,i.zoom),this.segments=new Me,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(l){return l.isStateDependent()}).map(function(l){return l.id})};uo.prototype.populate=function(i,s,l){this.hasPattern=dc("line",this.layers,s);for(var d=this.layers[0].layout.get("line-sort-key"),x=[],C=0,T=i;C<T.length;C+=1){var O=T[C],U=O.feature,W=O.id,$=O.index,te=O.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,Ee=Jo(U,he);if(this.layers[0]._featureFilter.filter(new la(this.zoom),Ee,l)){var Ke=d?d.evaluate(Ee,{},l):void 0,Je={id:W,properties:U.properties,type:U.type,sourceLayerIndex:te,index:$,geometry:he?Ee.geometry:co(U),patterns:{},sortKey:Ke};x.push(Je)}}d&&x.sort(function(fn,Un){return fn.sortKey-Un.sortKey});for(var mt=0,ct=x;mt<ct.length;mt+=1){var Bt=ct[mt],Kt=Bt.geometry,mr=Bt.index,gr=Bt.sourceLayerIndex;if(this.hasPattern){var zr=nf("line",this.layers,Bt,this.zoom,s);this.patternFeatures.push(zr)}else this.addFeature(Bt,Kt,mr,l,{});s.featureIndex.insert(i[mr].feature,Kt,mr,gr,this.index)}},uo.prototype.update=function(i,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,l)},uo.prototype.addFeatures=function(i,s,l){for(var d=0,x=this.patternFeatures;d<x.length;d+=1){var C=x[d];this.addFeature(C,C.geometry,C.index,s,l)}},uo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},uo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},uo.prototype.upload=function(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Ld)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Nf),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0},uo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},uo.prototype.lineFeatureClips=function(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}},uo.prototype.addFeature=function(i,s,l,d,x){var C=this.layers[0].layout,T=C.get("line-join").evaluate(i,{}),O=C.get("line-cap"),U=C.get("line-miter-limit"),W=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(var $=0,te=s;$<te.length;$+=1)this.addLine(te[$],i,T,O,U,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,l,x,d)},uo.prototype.addLine=function(i,s,l,d,x,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<i.length-1;T++)this.totalDistance+=i[T].dist(i[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var O=id[s.type]==="Polygon",U=i.length;U>=2&&i[U-1].equals(i[U-2]);)U--;for(var W=0;W<U-1&&i[W].equals(i[W+1]);)W++;if(!(U<(O?3:2))){l==="bevel"&&(x=1.05);var $,te=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray),Ee=void 0,Ke=void 0,Je=void 0,mt=void 0;this.e1=this.e2=-1,O&&(mt=i[W].sub($=i[U-2])._unit()._perp());for(var ct=W;ct<U;ct++)if(!(Ke=ct===U-1?O?i[W+1]:void 0:i[ct+1])||!i[ct].equals(Ke)){mt&&(Je=mt),$&&(Ee=$),$=i[ct],mt=Ke?Ke.sub($)._unit()._perp():Je;var Bt=(Je=Je||mt).add(mt);Bt.x===0&&Bt.y===0||Bt._unit();var Kt=Je.x*mt.x+Je.y*mt.y,mr=Bt.x*mt.x+Bt.y*mt.y,gr=mr!==0?1/mr:1/0,zr=2*Math.sqrt(2-2*mr),fn=mr<Xu&&Ee&&Ke,Un=Je.x*mt.y-Je.y*mt.x>0;if(fn&&ct>W){var Ai=$.dist(Ee);if(Ai>2*te){var ei=$.sub($.sub(Ee)._mult(te/Ai)._round());this.updateDistance(Ee,ei),this.addCurrentVertex(ei,Je,0,0,he),Ee=ei}}var Ii=Ee&&Ke,Kn=Ii?l:O?"butt":d;if(Ii&&Kn==="round"&&(gr<C?Kn="miter":gr<=2&&(Kn="fakeround")),Kn==="miter"&&gr>x&&(Kn="bevel"),Kn==="bevel"&&(gr>2&&(Kn="flipbevel"),gr<x&&(Kn="miter")),Ee&&this.updateDistance(Ee,$),Kn==="miter")Bt._mult(gr),this.addCurrentVertex($,Bt,0,0,he);else if(Kn==="flipbevel"){if(gr>100)Bt=mt.mult(-1);else{var ua=gr*Je.add(mt).mag()/Je.sub(mt).mag();Bt._perp()._mult(ua*(Un?-1:1))}this.addCurrentVertex($,Bt,0,0,he),this.addCurrentVertex($,Bt.mult(-1),0,0,he)}else if(Kn==="bevel"||Kn==="fakeround"){var qi=-Math.sqrt(gr*gr-1),mi=Un?qi:0,La=Un?0:qi;if(Ee&&this.addCurrentVertex($,Je,mi,La,he),Kn==="fakeround")for(var fa=Math.round(180*zr/Math.PI/20),Za=1;Za<fa;Za++){var ki=Za/fa;if(ki!==.5){var to=ki-.5;ki+=ki*to*(ki-1)*((1.0904+Kt*(Kt*(3.55645-1.43519*Kt)-3.2452))*to*to+(.848013+Kt*(.215638*Kt-1.06021)))}var Xo=mt.sub(Je)._mult(ki)._add(Je)._unit()._mult(Un?-1:1);this.addHalfVertex($,Xo.x,Xo.y,!1,Un,0,he)}Ke&&this.addCurrentVertex($,mt,-mi,-La,he)}else if(Kn==="butt")this.addCurrentVertex($,Bt,0,0,he);else if(Kn==="square"){var Zo=Ee?1:-1;this.addCurrentVertex($,Bt,Zo,Zo,he)}else Kn==="round"&&(Ee&&(this.addCurrentVertex($,Je,0,0,he),this.addCurrentVertex($,Je,1,1,he,!0)),Ke&&(this.addCurrentVertex($,mt,-1,-1,he,!0),this.addCurrentVertex($,mt,0,0,he)));if(fn&&ct<U-1){var _s=$.dist(Ke);if(_s>2*te){var Yr=$.add(Ke.sub($)._mult(te/_s)._round());this.updateDistance($,Yr),this.addCurrentVertex(Yr,mt,0,0,he),$=Yr}}}}},uo.prototype.addCurrentVertex=function(i,s,l,d,x,C){C===void 0&&(C=!1);var T=s.y*d-s.x,O=-s.y-s.x*d;this.addHalfVertex(i,s.x+s.y*l,s.y-s.x*l,C,!1,l,x),this.addHalfVertex(i,T,O,C,!0,-d,x),this.distance>kp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(i,s,l,d,x,C))},uo.prototype.addHalfVertex=function(i,s,l,d,x,C,T){var O=.5*(this.lineClips?this.scaledDistance*(kp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i.x<<1)+(d?1:0),(i.y<<1)+(x?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(C===0?0:C<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var U=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,U),T.primitiveLength++),x?this.e2=U:this.e1=U},uo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},uo.prototype.updateDistance=function(i,s){this.distance+=i.dist(s),this.updateScaledDistance()},ri("LineBucket",uo,{omit:["layers","patternFeatures"]});var Uc=new Yo({"line-cap":new _i(Ie.layout_line["line-cap"]),"line-join":new pi(Ie.layout_line["line-join"]),"line-miter-limit":new _i(Ie.layout_line["line-miter-limit"]),"line-round-limit":new _i(Ie.layout_line["line-round-limit"]),"line-sort-key":new pi(Ie.layout_line["line-sort-key"])}),Ja={paint:new Yo({"line-opacity":new pi(Ie.paint_line["line-opacity"]),"line-color":new pi(Ie.paint_line["line-color"]),"line-translate":new _i(Ie.paint_line["line-translate"]),"line-translate-anchor":new _i(Ie.paint_line["line-translate-anchor"]),"line-width":new pi(Ie.paint_line["line-width"]),"line-gap-width":new pi(Ie.paint_line["line-gap-width"]),"line-offset":new pi(Ie.paint_line["line-offset"]),"line-blur":new pi(Ie.paint_line["line-blur"]),"line-dasharray":new Os(Ie.paint_line["line-dasharray"]),"line-pattern":new Mf(Ie.paint_line["line-pattern"]),"line-gradient":new ul(Ie.paint_line["line-gradient"])}),layout:Uc},Vs=new(function(i){function s(){i.apply(this,arguments)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.possiblyEvaluate=function(l,d){return d=new la(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),i.prototype.possiblyEvaluate.call(this,l,d)},s.prototype.evaluate=function(l,d,x,C){return d=Yt({},d,{zoom:Math.floor(d.zoom)}),i.prototype.evaluate.call(this,l,d,x,C)},s}(pi))(Ja.paint.properties["line-width"].specification);Vs.useIntegerZoom=!0;var ad=function(i){function s(l){i.call(this,l,Ja),this.gradientVersion=0}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype._handleSpecialPaintPropertyUpdate=function(l){l==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ro,this.gradientVersion=(this.gradientVersion+1)%We)},s.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},s.prototype.recalculate=function(l,d){i.prototype.recalculate.call(this,l,d),this.paint._values["line-floorwidth"]=Vs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)},s.prototype.createBucket=function(l){return new uo(l)},s.prototype.queryRadius=function(l){var d=l,x=od(Xl("line-width",this,d),Xl("line-gap-width",this,d)),C=Xl("line-offset",this,d);return x/2+Math.abs(C)+cs(this.paint.get("line-translate"))},s.prototype.queryIntersectsFeature=function(l,d,x,C,T,O,U){var W=Tl(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),O.angle,U),$=U/2*od(this.paint.get("line-width").evaluate(d,x),this.paint.get("line-gap-width").evaluate(d,x)),te=this.paint.get("line-offset").evaluate(d,x);return te&&(C=function(he,Ee){for(var Ke=[],Je=new ve(0,0),mt=0;mt<he.length;mt++){for(var ct=he[mt],Bt=[],Kt=0;Kt<ct.length;Kt++){var mr=ct[Kt],gr=ct[Kt+1],zr=Kt===0?Je:mr.sub(ct[Kt-1])._unit()._perp(),fn=Kt===ct.length-1?Je:gr.sub(mr)._unit()._perp(),Un=zr._add(fn)._unit();Un._mult(1/(Un.x*fn.x+Un.y*fn.y)),Bt.push(Un._mult(Ee)._add(mr))}Ke.push(Bt)}return Ke}(C,te*U)),function(he,Ee,Ke){for(var Je=0;Je<Ee.length;Je++){var mt=Ee[Je];if(he.length>=3){for(var ct=0;ct<mt.length;ct++)if(cl(he,mt[ct]))return!0}if(Cu(he,mt,Ke))return!0}return!1}(W,C,$)},s.prototype.isTileClipped=function(){return!0},s}(Lu);function od(i,s){return s>0?s+2*i:i}var r0=po([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),n0=po([{name:"a_projected_pos",components:3,type:"Float32"}],4),Pp=(po([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),po([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Rd=(po([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),po([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Lp=po([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function O0(i,s,l){return i.sections.forEach(function(d){d.text=function(x,C,T){var O=C.layout.get("text-transform").evaluate(T,{});return O==="uppercase"?x=x.toLocaleUpperCase():O==="lowercase"&&(x=x.toLocaleLowerCase()),Ys.applyArabicShaping&&(x=Ys.applyArabicShaping(x)),x}(d.text,s,l)}),i}po([{name:"triangle",components:3,type:"Uint16"}]),po([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),po([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),po([{type:"Float32",name:"offsetX"}]),po([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var ep={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Od=function(i,s,l,d,x){var C,T,O=8*x-d-1,U=(1<<O)-1,W=U>>1,$=-7,te=l?x-1:0,he=l?-1:1,Ee=i[s+te];for(te+=he,C=Ee&(1<<-$)-1,Ee>>=-$,$+=O;$>0;C=256*C+i[s+te],te+=he,$-=8);for(T=C&(1<<-$)-1,C>>=-$,$+=d;$>0;T=256*T+i[s+te],te+=he,$-=8);if(C===0)C=1-W;else{if(C===U)return T?NaN:1/0*(Ee?-1:1);T+=Math.pow(2,d),C-=W}return(Ee?-1:1)*T*Math.pow(2,C-d)},F0=function(i,s,l,d,x,C){var T,O,U,W=8*C-x-1,$=(1<<W)-1,te=$>>1,he=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ee=d?0:C-1,Ke=d?1:-1,Je=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(O=isNaN(s)?1:0,T=$):(T=Math.floor(Math.log(s)/Math.LN2),s*(U=Math.pow(2,-T))<1&&(T--,U*=2),(s+=T+te>=1?he/U:he*Math.pow(2,1-te))*U>=2&&(T++,U/=2),T+te>=$?(O=0,T=$):T+te>=1?(O=(s*U-1)*Math.pow(2,x),T+=te):(O=s*Math.pow(2,te-1)*Math.pow(2,x),T=0));x>=8;i[l+Ee]=255&O,Ee+=Ke,O/=256,x-=8);for(T=T<<x|O,W+=x;W>0;i[l+Ee]=255&T,Ee+=Ke,T/=256,W-=8);i[l+Ee-Ke]|=128*Je},ph=xo;function xo(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}xo.Varint=0,xo.Fixed64=1,xo.Bytes=2,xo.Fixed32=5;var sd=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Zc(i){return i.type===xo.Bytes?i.readVarint()+i.pos:i.pos+1}function tp(i,s,l){return l?4294967296*s+(i>>>0):4294967296*(s>>>0)+(i>>>0)}function Fd(i,s,l){var d=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));l.realloc(d);for(var x=l.pos-1;x>=i;x--)l.buf[x+d]=l.buf[x]}function ud(i,s){for(var l=0;l<i.length;l++)s.writeVarint(i[l])}function H(i,s){for(var l=0;l<i.length;l++)s.writeSVarint(i[l])}function Le(i,s){for(var l=0;l<i.length;l++)s.writeFloat(i[l])}function ot(i,s){for(var l=0;l<i.length;l++)s.writeDouble(i[l])}function hr(i,s){for(var l=0;l<i.length;l++)s.writeBoolean(i[l])}function Ur(i,s){for(var l=0;l<i.length;l++)s.writeFixed32(i[l])}function cr(i,s){for(var l=0;l<i.length;l++)s.writeSFixed32(i[l])}function kr(i,s){for(var l=0;l<i.length;l++)s.writeFixed64(i[l])}function Gr(i,s){for(var l=0;l<i.length;l++)s.writeSFixed64(i[l])}function $r(i,s){return(i[s]|i[s+1]<<8|i[s+2]<<16)+16777216*i[s+3]}function tn(i,s,l){i[l]=s,i[l+1]=s>>>8,i[l+2]=s>>>16,i[l+3]=s>>>24}function hn(i,s){return(i[s]|i[s+1]<<8|i[s+2]<<16)+(i[s+3]<<24)}function pn(i,s,l){i===1&&l.readMessage(In,s)}function In(i,s,l){if(i===3){var d=l.readMessage(rn,{}),x=d.width,C=d.height,T=d.left,O=d.top,U=d.advance;s.push({id:d.id,bitmap:new Yl({width:x+6,height:C+6},d.bitmap),metrics:{width:x,height:C,left:T,top:O,advance:U}})}}function rn(i,s,l){i===1?s.id=l.readVarint():i===2?s.bitmap=l.readBytes():i===3?s.width=l.readVarint():i===4?s.height=l.readVarint():i===5?s.left=l.readSVarint():i===6?s.top=l.readSVarint():i===7&&(s.advance=l.readVarint())}function cn(i){for(var s=0,l=0,d=0,x=i;d<x.length;d+=1){var C=x[d];s+=C.w*C.h,l=Math.max(l,C.w)}i.sort(function(Je,mt){return mt.h-Je.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),l),h:1/0}],O=0,U=0,W=0,$=i;W<$.length;W+=1)for(var te=$[W],he=T.length-1;he>=0;he--){var Ee=T[he];if(!(te.w>Ee.w||te.h>Ee.h)){if(te.x=Ee.x,te.y=Ee.y,U=Math.max(U,te.y+te.h),O=Math.max(O,te.x+te.w),te.w===Ee.w&&te.h===Ee.h){var Ke=T.pop();he<T.length&&(T[he]=Ke)}else te.h===Ee.h?(Ee.x+=te.w,Ee.w-=te.w):te.w===Ee.w?(Ee.y+=te.h,Ee.h-=te.h):(T.push({x:Ee.x+te.w,y:Ee.y,w:Ee.w-te.w,h:te.h}),Ee.y+=te.h,Ee.h-=te.h);break}}return{w:O,h:U,fill:s/(O*U)||0}}xo.prototype={destroy:function(){this.buf=null},readFields:function(i,s,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),x=d>>3,C=this.pos;this.type=7&d,i(x,s,this),this.pos===C&&this.skip(d)}return s},readMessage:function(i,s){return this.readFields(i,s,this.readVarint()+this.pos)},readFixed32:function(){var i=$r(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=hn(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=$r(this.buf,this.pos)+4294967296*$r(this.buf,this.pos+4);return this.pos+=8,i},readSFixed64:function(){var i=$r(this.buf,this.pos)+4294967296*hn(this.buf,this.pos+4);return this.pos+=8,i},readFloat:function(){var i=Od(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Od(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var s,l,d=this.buf;return s=127&(l=d[this.pos++]),l<128?s:(s|=(127&(l=d[this.pos++]))<<7,l<128?s:(s|=(127&(l=d[this.pos++]))<<14,l<128?s:(s|=(127&(l=d[this.pos++]))<<21,l<128?s:function(x,C,T){var O,U,W=T.buf;if(O=(112&(U=W[T.pos++]))>>4,U<128||(O|=(127&(U=W[T.pos++]))<<3,U<128)||(O|=(127&(U=W[T.pos++]))<<10,U<128)||(O|=(127&(U=W[T.pos++]))<<17,U<128)||(O|=(127&(U=W[T.pos++]))<<24,U<128)||(O|=(1&(U=W[T.pos++]))<<31,U<128))return tp(x,O,C);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(l=d[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,s=this.pos;return this.pos=i,i-s>=12&&sd?function(l,d,x){return sd.decode(l.subarray(d,x))}(this.buf,s,i):function(l,d,x){for(var C="",T=d;T<x;){var O,U,W,$=l[T],te=null,he=$>239?4:$>223?3:$>191?2:1;if(T+he>x)break;he===1?$<128&&(te=$):he===2?(192&(O=l[T+1]))==128&&(te=(31&$)<<6|63&O)<=127&&(te=null):he===3?(U=l[T+2],(192&(O=l[T+1]))==128&&(192&U)==128&&((te=(15&$)<<12|(63&O)<<6|63&U)<=2047||te>=55296&&te<=57343)&&(te=null)):he===4&&(U=l[T+2],W=l[T+3],(192&(O=l[T+1]))==128&&(192&U)==128&&(192&W)==128&&((te=(15&$)<<18|(63&O)<<12|(63&U)<<6|63&W)<=65535||te>=1114112)&&(te=null)),te===null?(te=65533,he=1):te>65535&&(te-=65536,C+=String.fromCharCode(te>>>10&1023|55296),te=56320|1023&te),C+=String.fromCharCode(te),T+=he}return C}(this.buf,s,i)},readBytes:function(){var i=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,i);return this.pos=i,s},readPackedVarint:function(i,s){if(this.type!==xo.Bytes)return i.push(this.readVarint(s));var l=Zc(this);for(i=i||[];this.pos<l;)i.push(this.readVarint(s));return i},readPackedSVarint:function(i){if(this.type!==xo.Bytes)return i.push(this.readSVarint());var s=Zc(this);for(i=i||[];this.pos<s;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==xo.Bytes)return i.push(this.readBoolean());var s=Zc(this);for(i=i||[];this.pos<s;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==xo.Bytes)return i.push(this.readFloat());var s=Zc(this);for(i=i||[];this.pos<s;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==xo.Bytes)return i.push(this.readDouble());var s=Zc(this);for(i=i||[];this.pos<s;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==xo.Bytes)return i.push(this.readFixed32());var s=Zc(this);for(i=i||[];this.pos<s;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==xo.Bytes)return i.push(this.readSFixed32());var s=Zc(this);for(i=i||[];this.pos<s;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==xo.Bytes)return i.push(this.readFixed64());var s=Zc(this);for(i=i||[];this.pos<s;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==xo.Bytes)return i.push(this.readSFixed64());var s=Zc(this);for(i=i||[];this.pos<s;)i.push(this.readSFixed64());return i},skip:function(i){var s=7&i;if(s===xo.Varint)for(;this.buf[this.pos++]>127;);else if(s===xo.Bytes)this.pos=this.readVarint()+this.pos;else if(s===xo.Fixed32)this.pos+=4;else{if(s!==xo.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(i,s){this.writeVarint(i<<3|s)},realloc:function(i){for(var s=this.length||16;s<this.pos+i;)s*=2;if(s!==this.length){var l=new Uint8Array(s);l.set(this.buf),this.buf=l,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),tn(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),tn(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),tn(this.buf,-1&i,this.pos),tn(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),tn(this.buf,-1&i,this.pos),tn(this.buf,Math.floor(i*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(s,l){var d,x;if(s>=0?(d=s%4294967296|0,x=s/4294967296|0):(x=~(-s/4294967296),4294967295^(d=~(-s%4294967296))?d=d+1|0:(d=0,x=x+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(C,T,O){O.buf[O.pos++]=127&C|128,C>>>=7,O.buf[O.pos++]=127&C|128,C>>>=7,O.buf[O.pos++]=127&C|128,C>>>=7,O.buf[O.pos++]=127&C|128,O.buf[O.pos]=127&(C>>>=7)}(d,0,l),function(C,T){var O=(7&C)<<4;T.buf[T.pos++]|=O|((C>>>=3)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C|((C>>>=7)?128:0),C&&(T.buf[T.pos++]=127&C)))))}(x,l)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var s=this.pos;this.pos=function(d,x,C){for(var T,O,U=0;U<x.length;U++){if((T=x.charCodeAt(U))>55295&&T<57344){if(!O){T>56319||U+1===x.length?(d[C++]=239,d[C++]=191,d[C++]=189):O=T;continue}if(T<56320){d[C++]=239,d[C++]=191,d[C++]=189,O=T;continue}T=O-55296<<10|T-56320|65536,O=null}else O&&(d[C++]=239,d[C++]=191,d[C++]=189,O=null);T<128?d[C++]=T:(T<2048?d[C++]=T>>6|192:(T<65536?d[C++]=T>>12|224:(d[C++]=T>>18|240,d[C++]=T>>12&63|128),d[C++]=T>>6&63|128),d[C++]=63&T|128)}return C}(this.buf,i,this.pos);var l=this.pos-s;l>=128&&Fd(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeFloat:function(i){this.realloc(4),F0(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),F0(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var s=i.length;this.writeVarint(s),this.realloc(s);for(var l=0;l<s;l++)this.buf[this.pos++]=i[l]},writeRawMessage:function(i,s){this.pos++;var l=this.pos;i(s,this);var d=this.pos-l;d>=128&&Fd(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(i,s,l){this.writeTag(i,xo.Bytes),this.writeRawMessage(s,l)},writePackedVarint:function(i,s){s.length&&this.writeMessage(i,ud,s)},writePackedSVarint:function(i,s){s.length&&this.writeMessage(i,H,s)},writePackedBoolean:function(i,s){s.length&&this.writeMessage(i,hr,s)},writePackedFloat:function(i,s){s.length&&this.writeMessage(i,Le,s)},writePackedDouble:function(i,s){s.length&&this.writeMessage(i,ot,s)},writePackedFixed32:function(i,s){s.length&&this.writeMessage(i,Ur,s)},writePackedSFixed32:function(i,s){s.length&&this.writeMessage(i,cr,s)},writePackedFixed64:function(i,s){s.length&&this.writeMessage(i,kr,s)},writePackedSFixed64:function(i,s){s.length&&this.writeMessage(i,Gr,s)},writeBytesField:function(i,s){this.writeTag(i,xo.Bytes),this.writeBytes(s)},writeFixed32Field:function(i,s){this.writeTag(i,xo.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(i,s){this.writeTag(i,xo.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(i,s){this.writeTag(i,xo.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(i,s){this.writeTag(i,xo.Fixed64),this.writeSFixed64(s)},writeVarintField:function(i,s){this.writeTag(i,xo.Varint),this.writeVarint(s)},writeSVarintField:function(i,s){this.writeTag(i,xo.Varint),this.writeSVarint(s)},writeStringField:function(i,s){this.writeTag(i,xo.Bytes),this.writeString(s)},writeFloatField:function(i,s){this.writeTag(i,xo.Fixed32),this.writeFloat(s)},writeDoubleField:function(i,s){this.writeTag(i,xo.Fixed64),this.writeDouble(s)},writeBooleanField:function(i,s){this.writeVarintField(i,Boolean(s))}};var Nt=function(i,s){var l=s.pixelRatio,d=s.version,x=s.stretchX,C=s.stretchY,T=s.content;this.paddedRect=i,this.pixelRatio=l,this.stretchX=x,this.stretchY=C,this.content=T,this.version=d},yr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};yr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},yr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},yr.tlbr.get=function(){return this.tl.concat(this.br)},yr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Nt.prototype,yr);var en=function(i,s){var l={},d={};this.haveRenderCallbacks=[];var x=[];this.addImages(i,l,x),this.addImages(s,d,x);var C=cn(x),T=new zs({width:C.w||1,height:C.h||1});for(var O in i){var U=i[O],W=l[O].paddedRect;zs.copy(U.data,T,{x:0,y:0},{x:W.x+1,y:W.y+1},U.data)}for(var $ in s){var te=s[$],he=d[$].paddedRect,Ee=he.x+1,Ke=he.y+1,Je=te.data.width,mt=te.data.height;zs.copy(te.data,T,{x:0,y:0},{x:Ee,y:Ke},te.data),zs.copy(te.data,T,{x:0,y:mt-1},{x:Ee,y:Ke-1},{width:Je,height:1}),zs.copy(te.data,T,{x:0,y:0},{x:Ee,y:Ke+mt},{width:Je,height:1}),zs.copy(te.data,T,{x:Je-1,y:0},{x:Ee-1,y:Ke},{width:1,height:mt}),zs.copy(te.data,T,{x:0,y:0},{x:Ee+Je,y:Ke},{width:1,height:mt})}this.image=T,this.iconPositions=l,this.patternPositions=d};en.prototype.addImages=function(i,s,l){for(var d in i){var x=i[d],C={x:0,y:0,w:x.data.width+2,h:x.data.height+2};l.push(C),s[d]=new Nt(C,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(d)}},en.prototype.patchUpdatedImages=function(i,s){for(var l in i.dispatchRenderCallbacks(this.haveRenderCallbacks),i.updatedImages)this.patchUpdatedImage(this.iconPositions[l],i.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],i.getImage(l),s)},en.prototype.patchUpdatedImage=function(i,s,l){if(i&&s&&i.version!==s.version){i.version=s.version;var d=i.tl;l.update(s.data,void 0,{x:d[0],y:d[1]})}},ri("ImagePosition",Nt),ri("ImageAtlas",en);var Pn={horizontal:1,vertical:2,horizontalOnly:3},Zr=function(){this.scale=1,this.fontStack="",this.imageName=null};Zr.forText=function(i,s){var l=new Zr;return l.scale=i||1,l.fontStack=s,l},Zr.forImage=function(i){var s=new Zr;return s.imageName=i,s};var yn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Nn(i,s,l,d,x,C,T,O,U,W,$,te,he,Ee,Ke,Je){var mt,ct=yn.fromFeature(i,x);te===Pn.vertical&&ct.verticalizePunctuation();var Bt=Ys.processBidirectionalText,Kt=Ys.processStyledBidirectionalText;if(Bt&&ct.sections.length===1){mt=[];for(var mr=0,gr=Bt(ct.toString(),zn(ct,W,C,s,d,Ee,Ke));mr<gr.length;mr+=1){var zr=gr[mr],fn=new yn;fn.text=zr,fn.sections=ct.sections;for(var Un=0;Un<zr.length;Un++)fn.sectionIndex.push(0);mt.push(fn)}}else if(Kt){mt=[];for(var Ai=0,ei=Kt(ct.text,ct.sectionIndex,zn(ct,W,C,s,d,Ee,Ke));Ai<ei.length;Ai+=1){var Ii=ei[Ai],Kn=new yn;Kn.text=Ii[0],Kn.sectionIndex=Ii[1],Kn.sections=ct.sections,mt.push(Kn)}}else mt=function(mi,La){for(var fa=[],Za=mi.text,ki=0,to=0,Xo=La;to<Xo.length;to+=1){var Zo=Xo[to];fa.push(mi.substring(ki,Zo)),ki=Zo}return ki<Za.length&&fa.push(mi.substring(ki,Za.length)),fa}(ct,zn(ct,W,C,s,d,Ee,Ke));var ua=[],qi={positionedLines:ua,text:ct.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:te,iconsInText:!1,verticalizable:!1};return function(mi,La,fa,Za,ki,to,Xo,Zo,_s,Yr,xs,nr){for(var au=0,Yu=-17,hs=0,Bu=0,bs=Zo==="right"?1:Zo==="left"?0:.5,Es=0,Fa=0,To=ki;Fa<To.length;Fa+=1){var vo=To[Fa];vo.trim();var ja=vo.getMaxScale(),qu=24*(ja-1),vu={positionedGlyphs:[],lineOffset:0};mi.positionedLines[Es]=vu;var Oo=vu.positionedGlyphs,Ws=0;if(vo.length()){for(var mu=0;mu<vo.length();mu++){var Ga=vo.getSection(mu),Pl=vo.getSectionIndex(mu),xc=vo.getCharCode(mu),pl=0,Cs=null,Gc=null,uf=null,Rp=24,Op=!(_s===Pn.horizontal||!xs&&!Ih(xc)||xs&&(Ti[xc]||(Hc=xc,Tn.Arabic(Hc)||Tn["Arabic Supplement"](Hc)||Tn["Arabic Extended-A"](Hc)||Tn["Arabic Presentation Forms-A"](Hc)||Tn["Arabic Presentation Forms-B"](Hc))));if(Ga.imageName){var Fp=Za[Ga.imageName];if(!Fp)continue;uf=Ga.imageName,mi.iconsInText=mi.iconsInText||!0,Gc=Fp.paddedRect;var Nh=Fp.displaySize;Ga.scale=24*Ga.scale/nr,pl=qu+(24-Nh[1]*Ga.scale),Rp=(Cs={width:Nh[0],height:Nh[1],left:1,top:-3,advance:Op?Nh[1]:Nh[0]}).advance;var Bd=Op?Nh[0]*Ga.scale-24*ja:Nh[1]*Ga.scale-24*ja;Bd>0&&Bd>Ws&&(Ws=Bd)}else{var Dp=fa[Ga.fontStack],ap=Dp&&Dp[xc];if(ap&&ap.rect)Gc=ap.rect,Cs=ap.metrics;else{var op=La[Ga.fontStack],sp=op&&op[xc];if(!sp)continue;Cs=sp.metrics}pl=24*(ja-Ga.scale)}Op?(mi.verticalizable=!0,Oo.push({glyph:xc,imageName:uf,x:au,y:Yu+pl,vertical:Op,scale:Ga.scale,fontStack:Ga.fontStack,sectionIndex:Pl,metrics:Cs,rect:Gc}),au+=Rp*Ga.scale+Yr):(Oo.push({glyph:xc,imageName:uf,x:au,y:Yu+pl,vertical:Op,scale:Ga.scale,fontStack:Ga.fontStack,sectionIndex:Pl,metrics:Cs,rect:Gc}),au+=Cs.advance*Ga.scale+Yr)}Oo.length!==0&&(hs=Math.max(au-Yr,hs),ca(Oo,0,Oo.length-1,bs,Ws)),au=0;var cd=to*ja+Ws;vu.lineOffset=Math.max(Ws,qu),Yu+=cd,Bu=Math.max(cd,Bu),++Es}else Yu+=to,++Es}var Hc,Nd=Yu- -17,Bp=Mn(Xo),up=Bp.horizontalAlign,Uf=Bp.verticalAlign;(function(zh,Np,bo,Wc,fd,hd,lp,pd,zp){var cp,Uh=(Np-bo)*fd;cp=hd!==lp?-pd*Wc- -17:(-Wc*zp+.5)*lp;for(var fp=0,Up=zh;fp<Up.length;fp+=1)for(var wu=0,mh=Up[fp].positionedGlyphs;wu<mh.length;wu+=1){var gh=mh[wu];gh.x+=Uh,gh.y+=cp}})(mi.positionedLines,bs,up,Uf,hs,Bu,to,Nd,ki.length),mi.top+=-Uf*Nd,mi.bottom=mi.top+Nd,mi.left+=-up*hs,mi.right=mi.left+hs}(qi,s,l,d,mt,T,O,U,te,W,he,Je),!function(mi){for(var La=0,fa=mi;La<fa.length;La+=1)if(fa[La].positionedGlyphs.length!==0)return!1;return!0}(ua)&&qi}yn.fromFeature=function(i,s){for(var l=new yn,d=0;d<i.sections.length;d++){var x=i.sections[d];x.image?l.addImageSection(x):l.addTextSection(x,s)}return l},yn.prototype.length=function(){return this.text.length},yn.prototype.getSection=function(i){return this.sections[this.sectionIndex[i]]},yn.prototype.getSectionIndex=function(i){return this.sectionIndex[i]},yn.prototype.getCharCode=function(i){return this.text.charCodeAt(i)},yn.prototype.verticalizePunctuation=function(){this.text=function(i){for(var s="",l=0;l<i.length;l++){var d=i.charCodeAt(l+1)||null,x=i.charCodeAt(l-1)||null;s+=d&&_a(d)&&!ep[i[l+1]]||x&&_a(x)&&!ep[i[l-1]]||!ep[i[l]]?i[l]:ep[i[l]]}return s}(this.text)},yn.prototype.trim=function(){for(var i=0,s=0;s<this.text.length&&Ti[this.text.charCodeAt(s)];s++)i++;for(var l=this.text.length,d=this.text.length-1;d>=0&&d>=i&&Ti[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)},yn.prototype.substring=function(i,s){var l=new yn;return l.text=this.text.substring(i,s),l.sectionIndex=this.sectionIndex.slice(i,s),l.sections=this.sections,l},yn.prototype.toString=function(){return this.text},yn.prototype.getMaxScale=function(){var i=this;return this.sectionIndex.reduce(function(s,l){return Math.max(s,i.sections[l].scale)},0)},yn.prototype.addTextSection=function(i,s){this.text+=i.text,this.sections.push(Zr.forText(i.scale,i.fontStack||s));for(var l=this.sections.length-1,d=0;d<i.text.length;++d)this.sectionIndex.push(l)},yn.prototype.addImageSection=function(i){var s=i.image?i.image.name:"";if(s.length!==0){var l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Zr.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Ue("Reached maximum number of images 6401")}else Ue("Can't add FormattedSection with an empty image.")},yn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Ti={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ir={};function Fr(i,s,l,d,x,C){if(s.imageName){var T=d[s.imageName];return T?T.displaySize[0]*s.scale*24/C+x:0}var O=l[s.fontStack],U=O&&O[i];return U?U.metrics.advance*s.scale+x:0}function ii(i,s,l,d){var x=Math.pow(i-s,2);return d?i<s?x/2:2*x:x+Math.abs(l)*l}function Ln(i,s,l){var d=0;return i===10&&(d-=1e4),l&&(d+=150),i!==40&&i!==65288||(d+=50),s!==41&&s!==65289||(d+=50),d}function nn(i,s,l,d,x,C){for(var T=null,O=ii(s,l,x,C),U=0,W=d;U<W.length;U+=1){var $=W[U],te=ii(s-$.x,l,x,C)+$.badness;te<=O&&(T=$,O=te)}return{index:i,x:s,priorBreak:T,badness:O}}function zn(i,s,l,d,x,C,T){if(C!=="point")return[];if(!i)return[];for(var O,U=[],W=function(mt,ct,Bt,Kt,mr,gr){for(var zr=0,fn=0;fn<mt.length();fn++){var Un=mt.getSection(fn);zr+=Fr(mt.getCharCode(fn),Un,Kt,mr,ct,gr)}return zr/Math.max(1,Math.ceil(zr/Bt))}(i,s,l,d,x,T),$=i.text.indexOf("\u200B")>=0,te=0,he=0;he<i.length();he++){var Ee=i.getSection(he),Ke=i.getCharCode(he);if(Ti[Ke]||(te+=Fr(Ke,Ee,d,x,s,T)),he<i.length()-1){var Je=!((O=Ke)<11904||!(Tn["Bopomofo Extended"](O)||Tn.Bopomofo(O)||Tn["CJK Compatibility Forms"](O)||Tn["CJK Compatibility Ideographs"](O)||Tn["CJK Compatibility"](O)||Tn["CJK Radicals Supplement"](O)||Tn["CJK Strokes"](O)||Tn["CJK Symbols and Punctuation"](O)||Tn["CJK Unified Ideographs Extension A"](O)||Tn["CJK Unified Ideographs"](O)||Tn["Enclosed CJK Letters and Months"](O)||Tn["Halfwidth and Fullwidth Forms"](O)||Tn.Hiragana(O)||Tn["Ideographic Description Characters"](O)||Tn["Kangxi Radicals"](O)||Tn["Katakana Phonetic Extensions"](O)||Tn.Katakana(O)||Tn["Vertical Forms"](O)||Tn["Yi Radicals"](O)||Tn["Yi Syllables"](O)));(Ir[Ke]||Je||Ee.imageName)&&U.push(nn(he+1,te,W,U,Ln(Ke,i.getCharCode(he+1),Je&&$),!1))}}return function mt(ct){return ct?mt(ct.priorBreak).concat(ct.index):[]}(nn(i.length(),te,W,U,0,!0))}function Mn(i){var s=.5,l=.5;switch(i){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:s,verticalAlign:l}}function ca(i,s,l,d,x){if(d||x)for(var C=i[l],T=(i[l].x+C.metrics.advance*C.scale)*d,O=s;O<=l;O++)i[O].x-=T,i[O].y+=x}function Gi(i,s,l,d,x,C){var T,O=i.image;if(O.content){var U=O.content,W=O.pixelRatio||1;T=[U[0]/W,U[1]/W,O.displaySize[0]-U[2]/W,O.displaySize[1]-U[3]/W]}var $,te,he,Ee,Ke=s.left*C,Je=s.right*C;l==="width"||l==="both"?(Ee=x[0]+Ke-d[3],te=x[0]+Je+d[1]):te=(Ee=x[0]+(Ke+Je-O.displaySize[0])/2)+O.displaySize[0];var mt=s.top*C,ct=s.bottom*C;return l==="height"||l==="both"?($=x[1]+mt-d[0],he=x[1]+ct+d[2]):he=($=x[1]+(mt+ct-O.displaySize[1])/2)+O.displaySize[1],{image:O,top:$,right:te,bottom:he,left:Ee,collisionPadding:T}}Ir[10]=!0,Ir[32]=!0,Ir[38]=!0,Ir[40]=!0,Ir[41]=!0,Ir[43]=!0,Ir[45]=!0,Ir[47]=!0,Ir[173]=!0,Ir[183]=!0,Ir[8203]=!0,Ir[8208]=!0,Ir[8211]=!0,Ir[8231]=!0;var Rn=function(i){function s(l,d,x,C){i.call(this,l,d),this.angle=x,C!==void 0&&(this.segment=C)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.clone=function(){return new s(this.x,this.y,this.angle,this.segment)},s}(ve);function Fn(i,s){var l=s.expression;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new la(i+1))};if(l.kind==="source")return{kind:"source"};for(var d=l.zoomStops,x=l.interpolationType,C=0;C<d.length&&d[C]<=i;)C++;for(var T=C=Math.max(0,C-1);T<d.length&&d[T]<i+1;)T++;T=Math.min(d.length-1,T);var O=d[C],U=d[T];return l.kind==="composite"?{kind:"composite",minZoom:O,maxZoom:U,interpolationType:x}:{kind:"camera",minZoom:O,maxZoom:U,minSize:l.evaluate(new la(O)),maxSize:l.evaluate(new la(U)),interpolationType:x}}function Pi(i,s,l){var d=s.uSize,x=l.lowerSize;return i.kind==="source"?x/128:i.kind==="composite"?ha(x/128,l.upperSize/128,s.uSizeT):d}function ta(i,s){var l=0,d=0;if(i.kind==="constant")d=i.layoutSize;else if(i.kind!=="source"){var x=i.interpolationType,C=x?tr(Fe.interpolationFactor(x,s,i.minZoom,i.maxZoom),0,1):0;i.kind==="camera"?d=ha(i.minSize,i.maxSize,C):l=C}return{uSizeT:l,uSize:d}}ri("Anchor",Rn);var Ta=Object.freeze({__proto__:null,getSizeData:Fn,evaluateSizeForFeature:Pi,evaluateSizeForZoom:ta,SIZE_PACK_FACTOR:128});function qo(i,s,l,d,x){if(s.segment===void 0)return!0;for(var C=s,T=s.segment+1,O=0;O>-l/2;){if(--T<0)return!1;O-=i[T].dist(C),C=i[T]}O+=i[T].dist(i[T+1]),T++;for(var U=[],W=0;O<l/2;){var $=i[T],te=i[T+1];if(!te)return!1;var he=i[T-1].angleTo($)-$.angleTo(te);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),U.push({distance:O,angleDelta:he}),W+=he;O-U[0].distance>d;)W-=U.shift().angleDelta;if(W>x)return!1;T++,O+=$.dist(te)}return!0}function $o(i){for(var s=0,l=0;l<i.length-1;l++)s+=i[l].dist(i[l+1]);return s}function Ca(i,s,l){return i?.6*s*l:0}function $s(i,s){return Math.max(i?i.right-i.left:0,s?s.right-s.left:0)}function wo(i,s,l,d,x,C){for(var T=Ca(l,x,C),O=$s(l,d)*C,U=0,W=$o(i)/2,$=0;$<i.length-1;$++){var te=i[$],he=i[$+1],Ee=te.dist(he);if(U+Ee>W){var Ke=(W-U)/Ee,Je=ha(te.x,he.x,Ke),mt=ha(te.y,he.y,Ke),ct=new Rn(Je,mt,he.angleTo(te),$);return ct._round(),!T||qo(i,ct,O,T,s)?ct:void 0}U+=Ee}}function js(i,s,l,d,x,C,T,O,U){var W=Ca(d,C,T),$=$s(d,x),te=$*T,he=i[0].x===0||i[0].x===U||i[0].y===0||i[0].y===U;return s-te<s/4&&(s=te+s/4),function Ee(Ke,Je,mt,ct,Bt,Kt,mr,gr,zr){for(var fn=Kt/2,Un=$o(Ke),Ai=0,ei=Je-mt,Ii=[],Kn=0;Kn<Ke.length-1;Kn++){for(var ua=Ke[Kn],qi=Ke[Kn+1],mi=ua.dist(qi),La=qi.angleTo(ua);ei+mt<Ai+mi;){var fa=((ei+=mt)-Ai)/mi,Za=ha(ua.x,qi.x,fa),ki=ha(ua.y,qi.y,fa);if(Za>=0&&Za<zr&&ki>=0&&ki<zr&&ei-fn>=0&&ei+fn<=Un){var to=new Rn(Za,ki,La,Kn);to._round(),ct&&!qo(Ke,to,Kt,ct,Bt)||Ii.push(to)}}Ai+=mi}return gr||Ii.length||mr||(Ii=Ee(Ke,Ai/2,mt,ct,Bt,Kt,mr,!0,zr)),Ii}(i,he?s/2*O%s:($/2+2*C)*T*O%s,s,W,l,te,he,!1,U)}function gs(i,s,l,d,x){for(var C=[],T=0;T<i.length;T++)for(var O=i[T],U=void 0,W=0;W<O.length-1;W++){var $=O[W],te=O[W+1];$.x<s&&te.x<s||($.x<s?$=new ve(s,$.y+(s-$.x)/(te.x-$.x)*(te.y-$.y))._round():te.x<s&&(te=new ve(s,$.y+(s-$.x)/(te.x-$.x)*(te.y-$.y))._round()),$.y<l&&te.y<l||($.y<l?$=new ve($.x+(l-$.y)/(te.y-$.y)*(te.x-$.x),l)._round():te.y<l&&(te=new ve($.x+(l-$.y)/(te.y-$.y)*(te.x-$.x),l)._round()),$.x>=d&&te.x>=d||($.x>=d?$=new ve(d,$.y+(d-$.x)/(te.x-$.x)*(te.y-$.y))._round():te.x>=d&&(te=new ve(d,$.y+(d-$.x)/(te.x-$.x)*(te.y-$.y))._round()),$.y>=x&&te.y>=x||($.y>=x?$=new ve($.x+(x-$.y)/(te.y-$.y)*(te.x-$.x),x)._round():te.y>=x&&(te=new ve($.x+(x-$.y)/(te.y-$.y)*(te.x-$.x),x)._round()),U&&$.equals(U[U.length-1])||C.push(U=[$]),U.push(te)))))}return C}function Ts(i,s,l,d){var x=[],C=i.image,T=C.pixelRatio,O=C.paddedRect.w-2,U=C.paddedRect.h-2,W=i.right-i.left,$=i.bottom-i.top,te=C.stretchX||[[0,O]],he=C.stretchY||[[0,U]],Ee=function(Za,ki){return Za+ki[1]-ki[0]},Ke=te.reduce(Ee,0),Je=he.reduce(Ee,0),mt=O-Ke,ct=U-Je,Bt=0,Kt=Ke,mr=0,gr=Je,zr=0,fn=mt,Un=0,Ai=ct;if(C.content&&d){var ei=C.content;Bt=Gs(te,0,ei[0]),mr=Gs(he,0,ei[1]),Kt=Gs(te,ei[0],ei[2]),gr=Gs(he,ei[1],ei[3]),zr=ei[0]-Bt,Un=ei[1]-mr,fn=ei[2]-ei[0]-Kt,Ai=ei[3]-ei[1]-gr}var Ii=function(Za,ki,to,Xo){var Zo=Uo(Za.stretch-Bt,Kt,W,i.left),_s=sa(Za.fixed-zr,fn,Za.stretch,Ke),Yr=Uo(ki.stretch-mr,gr,$,i.top),xs=sa(ki.fixed-Un,Ai,ki.stretch,Je),nr=Uo(to.stretch-Bt,Kt,W,i.left),au=sa(to.fixed-zr,fn,to.stretch,Ke),Yu=Uo(Xo.stretch-mr,gr,$,i.top),hs=sa(Xo.fixed-Un,Ai,Xo.stretch,Je),Bu=new ve(Zo,Yr),bs=new ve(nr,Yr),Es=new ve(nr,Yu),Fa=new ve(Zo,Yu),To=new ve(_s/T,xs/T),vo=new ve(au/T,hs/T),ja=s*Math.PI/180;if(ja){var qu=Math.sin(ja),vu=Math.cos(ja),Oo=[vu,-qu,qu,vu];Bu._matMult(Oo),bs._matMult(Oo),Fa._matMult(Oo),Es._matMult(Oo)}var Ws=Za.stretch+Za.fixed,mu=ki.stretch+ki.fixed;return{tl:Bu,tr:bs,bl:Fa,br:Es,tex:{x:C.paddedRect.x+1+Ws,y:C.paddedRect.y+1+mu,w:to.stretch+to.fixed-Ws,h:Xo.stretch+Xo.fixed-mu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:To,pixelOffsetBR:vo,minFontScaleX:fn/T/W,minFontScaleY:Ai/T/$,isSDF:l}};if(d&&(C.stretchX||C.stretchY))for(var Kn=du(te,mt,Ke),ua=du(he,ct,Je),qi=0;qi<Kn.length-1;qi++)for(var mi=Kn[qi],La=Kn[qi+1],fa=0;fa<ua.length-1;fa++)x.push(Ii(mi,ua[fa],La,ua[fa+1]));else x.push(Ii({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:O+1},{fixed:0,stretch:U+1}));return x}function Gs(i,s,l){for(var d=0,x=0,C=i;x<C.length;x+=1){var T=C[x];d+=Math.max(s,Math.min(l,T[1]))-Math.max(s,Math.min(l,T[0]))}return d}function du(i,s,l){for(var d=[{fixed:-1,stretch:0}],x=0,C=i;x<C.length;x+=1){var T=C[x],O=T[0],U=T[1],W=d[d.length-1];d.push({fixed:O-W.stretch,stretch:W.stretch}),d.push({fixed:O-W.stretch,stretch:W.stretch+(U-O)})}return d.push({fixed:s+1,stretch:l}),d}function Uo(i,s,l,d){return i/s*l+d}function sa(i,s,l,d){return i-s*l/d}var Ms=function(i,s,l,d,x,C,T,O,U,W){if(this.boxStartIndex=i.length,U){var $=C.top,te=C.bottom,he=C.collisionPadding;he&&($-=he[1],te+=he[3]);var Ee=te-$;Ee>0&&(Ee=Math.max(10,Ee),this.circleDiameter=Ee)}else{var Ke=C.top*T-O,Je=C.bottom*T+O,mt=C.left*T-O,ct=C.right*T+O,Bt=C.collisionPadding;if(Bt&&(mt-=Bt[0]*T,Ke-=Bt[1]*T,ct+=Bt[2]*T,Je+=Bt[3]*T),W){var Kt=new ve(mt,Ke),mr=new ve(ct,Ke),gr=new ve(mt,Je),zr=new ve(ct,Je),fn=W*Math.PI/180;Kt._rotate(fn),mr._rotate(fn),gr._rotate(fn),zr._rotate(fn),mt=Math.min(Kt.x,mr.x,gr.x,zr.x),ct=Math.max(Kt.x,mr.x,gr.x,zr.x),Ke=Math.min(Kt.y,mr.y,gr.y,zr.y),Je=Math.max(Kt.y,mr.y,gr.y,zr.y)}i.emplaceBack(s.x,s.y,mt,Ke,ct,Je,l,d,x)}this.boxEndIndex=i.length},Ua=function(i,s){if(i===void 0&&(i=[]),s===void 0&&(s=iu),this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function iu(i,s){return i<s?-1:i>s?1:0}function Yi(i,s,l){s===void 0&&(s=1),l===void 0&&(l=!1);for(var d=1/0,x=1/0,C=-1/0,T=-1/0,O=i[0],U=0;U<O.length;U++){var W=O[U];(!U||W.x<d)&&(d=W.x),(!U||W.y<x)&&(x=W.y),(!U||W.x>C)&&(C=W.x),(!U||W.y>T)&&(T=W.y)}var $=Math.min(C-d,T-x),te=$/2,he=new Ua([],Ma);if($===0)return new ve(d,x);for(var Ee=d;Ee<C;Ee+=$)for(var Ke=x;Ke<T;Ke+=$)he.push(new eo(Ee+te,Ke+te,te,i));for(var Je=function(Bt){for(var Kt=0,mr=0,gr=0,zr=Bt[0],fn=0,Un=zr.length,Ai=Un-1;fn<Un;Ai=fn++){var ei=zr[fn],Ii=zr[Ai],Kn=ei.x*Ii.y-Ii.x*ei.y;mr+=(ei.x+Ii.x)*Kn,gr+=(ei.y+Ii.y)*Kn,Kt+=3*Kn}return new eo(mr/Kt,gr/Kt,0,Bt)}(i),mt=he.length;he.length;){var ct=he.pop();(ct.d>Je.d||!Je.d)&&(Je=ct,l&&console.log("found best %d after %d probes",Math.round(1e4*ct.d)/1e4,mt)),ct.max-Je.d<=s||(he.push(new eo(ct.p.x-(te=ct.h/2),ct.p.y-te,te,i)),he.push(new eo(ct.p.x+te,ct.p.y-te,te,i)),he.push(new eo(ct.p.x-te,ct.p.y+te,te,i)),he.push(new eo(ct.p.x+te,ct.p.y+te,te,i)),mt+=4)}return l&&(console.log("num probes: "+mt),console.log("best distance: "+Je.d)),Je.p}function Ma(i,s){return s.max-i.max}function eo(i,s,l,d){this.p=new ve(i,s),this.h=l,this.d=function(x,C){for(var T=!1,O=1/0,U=0;U<C.length;U++)for(var W=C[U],$=0,te=W.length,he=te-1;$<te;he=$++){var Ee=W[$],Ke=W[he];Ee.y>x.y!=Ke.y>x.y&&x.x<(Ke.x-Ee.x)*(x.y-Ee.y)/(Ke.y-Ee.y)+Ee.x&&(T=!T),O=Math.min(O,wl(x,Ee,Ke))}return(T?1:-1)*Math.sqrt(O)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}Ua.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},Ua.prototype.pop=function(){if(this.length!==0){var i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}},Ua.prototype.peek=function(){return this.data[0]},Ua.prototype._up=function(i){for(var s=this.data,l=this.compare,d=s[i];i>0;){var x=i-1>>1,C=s[x];if(l(d,C)>=0)break;s[i]=C,i=x}s[i]=d},Ua.prototype._down=function(i){for(var s=this.data,l=this.compare,d=this.length>>1,x=s[i];i<d;){var C=1+(i<<1),T=s[C],O=C+1;if(O<this.length&&l(s[O],T)<0&&(C=O,T=s[O]),l(T,x)>=0)break;s[i]=T,i=C}s[i]=x};var ys=Number.POSITIVE_INFINITY;function sf(i,s){return s[1]!==ys?function(l,d,x){var C=0,T=0;switch(d=Math.abs(d),x=Math.abs(x),l){case"top-right":case"top-left":case"top":T=x-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-x}switch(l){case"top-right":case"bottom-right":case"right":C=-d;break;case"top-left":case"bottom-left":case"left":C=d}return[C,T]}(i,s[0],s[1]):function(l,d){var x=0,C=0;d<0&&(d=0);var T=d/Math.sqrt(2);switch(l){case"top-right":case"top-left":C=T-7;break;case"bottom-right":case"bottom-left":C=7-T;break;case"bottom":C=7-d;break;case"top":C=d-7}switch(l){case"top-right":case"bottom-right":x=-T;break;case"top-left":case"bottom-left":x=T;break;case"left":x=d;break;case"right":x=-d}return[x,C]}(i,s[0])}function $e(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dr(i,s,l,d,x,C,T,O,U,W,$,te,he,Ee,Ke){var Je=function(mr,gr,zr,fn,Un,Ai,ei,Ii){for(var Kn=fn.layout.get("text-rotate").evaluate(Ai,{})*Math.PI/180,ua=[],qi=0,mi=gr.positionedLines;qi<mi.length;qi+=1)for(var La=mi[qi],fa=0,Za=La.positionedGlyphs;fa<Za.length;fa+=1){var ki=Za[fa];if(ki.rect){var to=ki.rect||{},Xo=4,Zo=!0,_s=1,Yr=0,xs=(Un||Ii)&&ki.vertical,nr=ki.metrics.advance*ki.scale/2;if(Ii&&gr.verticalizable&&(Yr=La.lineOffset/2-(ki.imageName?-(24-ki.metrics.width*ki.scale)/2:24*(ki.scale-1))),ki.imageName){var au=ei[ki.imageName];Zo=au.sdf,Xo=1/(_s=au.pixelRatio)}var Yu=Un?[ki.x+nr,ki.y]:[0,0],hs=Un?[0,0]:[ki.x+nr+zr[0],ki.y+zr[1]-Yr],Bu=[0,0];xs&&(Bu=hs,hs=[0,0]);var bs=(ki.metrics.left-Xo)*ki.scale-nr+hs[0],Es=(-ki.metrics.top-Xo)*ki.scale+hs[1],Fa=bs+to.w*ki.scale/_s,To=Es+to.h*ki.scale/_s,vo=new ve(bs,Es),ja=new ve(Fa,Es),qu=new ve(bs,To),vu=new ve(Fa,To);if(xs){var Oo=new ve(-nr,nr- -17),Ws=-Math.PI/2,mu=12-nr,Ga=new ve(22-mu,-(ki.imageName?mu:0)),Pl=new(Function.prototype.bind.apply(ve,[null].concat(Bu)));vo._rotateAround(Ws,Oo)._add(Ga)._add(Pl),ja._rotateAround(Ws,Oo)._add(Ga)._add(Pl),qu._rotateAround(Ws,Oo)._add(Ga)._add(Pl),vu._rotateAround(Ws,Oo)._add(Ga)._add(Pl)}if(Kn){var xc=Math.sin(Kn),pl=Math.cos(Kn),Cs=[pl,-xc,xc,pl];vo._matMult(Cs),ja._matMult(Cs),qu._matMult(Cs),vu._matMult(Cs)}var Gc=new ve(0,0),uf=new ve(0,0);ua.push({tl:vo,tr:ja,bl:qu,br:vu,tex:to,writingMode:gr.writingMode,glyphOffset:Yu,sectionIndex:ki.sectionIndex,isSDF:Zo,pixelOffsetTL:Gc,pixelOffsetBR:uf,minFontScaleX:0,minFontScaleY:0})}}return ua}(0,l,O,x,C,T,d,i.allowVerticalPlacement),mt=i.textSizeData,ct=null;mt.kind==="source"?(ct=[128*x.layout.get("text-size").evaluate(T,{})])[0]>32640&&Ue(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):mt.kind==="composite"&&((ct=[128*Ee.compositeTextSizes[0].evaluate(T,{},Ke),128*Ee.compositeTextSizes[1].evaluate(T,{},Ke)])[0]>32640||ct[1]>32640)&&Ue(i.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),i.addSymbols(i.text,Je,ct,O,C,T,W,s,U.lineStartIndex,U.lineLength,he,Ke);for(var Bt=0,Kt=$;Bt<Kt.length;Bt+=1)te[Kt[Bt]]=i.text.placedSymbolArray.length-1;return 4*Je.length}function Xt(i){for(var s in i)return i[s];return null}function Jn(i,s,l,d){var x=i.compareText;if(s in x){for(var C=x[s],T=C.length-1;T>=0;T--)if(d.dist(C[T])<l)return!0}else x[s]=[];return x[s].push(d),!1}var Ia=Zs.VectorTileFeature.types,Ze=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ce(i,s,l,d,x,C,T,O,U,W,$,te,he){var Ee=O?Math.min(32640,Math.round(O[0])):0,Ke=O?Math.min(32640,Math.round(O[1])):0;i.emplaceBack(s,l,Math.round(32*d),Math.round(32*x),C,T,(Ee<<1)+(U?1:0),Ke,16*W,16*$,256*te,256*he)}function ht(i,s,l){i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l),i.emplaceBack(s.x,s.y,l)}function Vt(i){for(var s=0,l=i.sections;s<l.length;s+=1)if(kh(l[s].text))return!0;return!1}var or=function(i){this.layoutVertexArray=new Kh,this.indexArray=new oc,this.programConfigurations=i,this.segments=new Me,this.dynamicLayoutVertexArray=new Qc,this.opacityVertexArray=new th,this.placedSymbolArray=new g};or.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},or.prototype.upload=function(i,s,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,r0.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,n0.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Ze,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(i))},or.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},ri("SymbolBuffers",or);var gt=function(i,s,l){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new l,this.segments=new Me,this.collisionVertexArray=new Jc};gt.prototype.upload=function(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Pp.members,!0)},gt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},ri("CollisionBuffers",gt);var it=function(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(function(C){return C.id}),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ru([]),this.placementViewportMatrix=Ru([]);var s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fn(this.zoom,s["text-size"]),this.iconSizeData=Fn(this.zoom,s["icon-size"]);var l=this.layers[0].layout,d=l.get("symbol-sort-key"),x=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(function(C){return Pn[C]})),this.stateDependentLayerIds=this.layers.filter(function(C){return C.isStateDependent()}).map(function(C){return C.id}),this.sourceID=i.sourceID};it.prototype.createArrays=function(){this.text=new or(new wi(this.layers,this.zoom,function(i){return/^text/.test(i)})),this.icon=new or(new wi(this.layers,this.zoom,function(i){return/^icon/.test(i)})),this.glyphOffsetArray=new R,this.lineVertexArray=new z,this.symbolInstances=new I},it.prototype.calculateGlyphDependencies=function(i,s,l,d,x){for(var C=0;C<i.length;C++)if(s[i.charCodeAt(C)]=!0,(l||d)&&x){var T=ep[i.charAt(C)];T&&(s[T.charCodeAt(0)]=!0)}},it.prototype.populate=function(i,s,l){var d=this.layers[0],x=d.layout,C=x.get("text-font"),T=x.get("text-field"),O=x.get("icon-image"),U=(T.value.kind!=="constant"||T.value.value instanceof bt&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),W=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,$=x.get("symbol-sort-key");if(this.features=[],U||W){for(var te=s.iconDependencies,he=s.glyphDependencies,Ee=s.availableImages,Ke=new la(this.zoom),Je=0,mt=i;Je<mt.length;Je+=1){var ct=mt[Je],Bt=ct.feature,Kt=ct.id,mr=ct.index,gr=ct.sourceLayerIndex,zr=d._featureFilter.needGeometry,fn=Jo(Bt,zr);if(d._featureFilter.filter(Ke,fn,l)){zr||(fn.geometry=co(Bt));var Un=void 0;if(U){var Ai=d.getValueAndResolveTokens("text-field",fn,l,Ee),ei=bt.factory(Ai);Vt(ei)&&(this.hasRTLText=!0),(!this.hasRTLText||Cp()==="unavailable"||this.hasRTLText&&Ys.isParsed())&&(Un=O0(ei,d,fn))}var Ii=void 0;if(W){var Kn=d.getValueAndResolveTokens("icon-image",fn,l,Ee);Ii=Kn instanceof oo?Kn:oo.fromString(Kn)}if(Un||Ii){var ua=this.sortFeaturesByKey?$.evaluate(fn,{},l):void 0;if(this.features.push({id:Kt,text:Un,icon:Ii,index:mr,sourceLayerIndex:gr,geometry:fn.geometry,properties:Bt.properties,type:Ia[Bt.type],sortKey:ua}),Ii&&(te[Ii.name]=!0),Un){var qi=C.evaluate(fn,{},l).join(","),mi=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pn.vertical)>=0;for(var La=0,fa=Un.sections;La<fa.length;La+=1){var Za=fa[La];if(Za.image)te[Za.image.name]=!0;else{var ki=Rc(Un.toString()),to=Za.fontStack||qi,Xo=he[to]=he[to]||{};this.calculateGlyphDependencies(Za.text,Xo,mi,this.allowVerticalPlacement,ki)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(Zo){var _s={},Yr={},xs=[],nr=0;function au(Oo){xs.push(Zo[Oo]),nr++}function Yu(Oo,Ws,mu){var Ga=Yr[Oo];return delete Yr[Oo],Yr[Ws]=Ga,xs[Ga].geometry[0].pop(),xs[Ga].geometry[0]=xs[Ga].geometry[0].concat(mu[0]),Ga}function hs(Oo,Ws,mu){var Ga=_s[Ws];return delete _s[Ws],_s[Oo]=Ga,xs[Ga].geometry[0].shift(),xs[Ga].geometry[0]=mu[0].concat(xs[Ga].geometry[0]),Ga}function Bu(Oo,Ws,mu){var Ga=mu?Ws[0][Ws[0].length-1]:Ws[0][0];return Oo+":"+Ga.x+":"+Ga.y}for(var bs=0;bs<Zo.length;bs++){var Es=Zo[bs],Fa=Es.geometry,To=Es.text?Es.text.toString():null;if(To){var vo=Bu(To,Fa),ja=Bu(To,Fa,!0);if(vo in Yr&&ja in _s&&Yr[vo]!==_s[ja]){var qu=hs(vo,ja,Fa),vu=Yu(vo,ja,xs[qu].geometry);delete _s[vo],delete Yr[ja],Yr[Bu(To,xs[vu].geometry,!0)]=vu,xs[qu].geometry=null}else vo in Yr?Yu(vo,ja,Fa):ja in _s?hs(vo,ja,Fa):(au(bs),_s[vo]=nr-1,Yr[ja]=nr-1)}else au(bs)}return xs.filter(function(Oo){return Oo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Zo,_s){return Zo.sortKey-_s.sortKey})}},it.prototype.update=function(i,s,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,l),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,l))},it.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},it.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},it.prototype.upload=function(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},it.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},it.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},it.prototype.addToLineVertexArray=function(i,s){var l=this.lineVertexArray.length;if(i.segment!==void 0){for(var d=i.dist(s[i.segment+1]),x=i.dist(s[i.segment]),C={},T=i.segment+1;T<s.length;T++)C[T]={x:s[T].x,y:s[T].y,tileUnitDistanceFromAnchor:d},T<s.length-1&&(d+=s[T+1].dist(s[T]));for(var O=i.segment||0;O>=0;O--)C[O]={x:s[O].x,y:s[O].y,tileUnitDistanceFromAnchor:x},O>0&&(x+=s[O-1].dist(s[O]));for(var U=0;U<s.length;U++){var W=C[U];this.lineVertexArray.emplaceBack(W.x,W.y,W.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}},it.prototype.addSymbols=function(i,s,l,d,x,C,T,O,U,W,$,te){for(var he=i.indexArray,Ee=i.layoutVertexArray,Ke=i.segments.prepareSegment(4*s.length,Ee,he,this.canOverlap?C.sortKey:void 0),Je=this.glyphOffsetArray.length,mt=Ke.vertexLength,ct=this.allowVerticalPlacement&&T===Pn.vertical?Math.PI/2:0,Bt=C.text&&C.text.sections,Kt=0;Kt<s.length;Kt++){var mr=s[Kt],gr=mr.tl,zr=mr.tr,fn=mr.bl,Un=mr.br,Ai=mr.tex,ei=mr.pixelOffsetTL,Ii=mr.pixelOffsetBR,Kn=mr.minFontScaleX,ua=mr.minFontScaleY,qi=mr.glyphOffset,mi=mr.isSDF,La=mr.sectionIndex,fa=Ke.vertexLength,Za=qi[1];Ce(Ee,O.x,O.y,gr.x,Za+gr.y,Ai.x,Ai.y,l,mi,ei.x,ei.y,Kn,ua),Ce(Ee,O.x,O.y,zr.x,Za+zr.y,Ai.x+Ai.w,Ai.y,l,mi,Ii.x,ei.y,Kn,ua),Ce(Ee,O.x,O.y,fn.x,Za+fn.y,Ai.x,Ai.y+Ai.h,l,mi,ei.x,Ii.y,Kn,ua),Ce(Ee,O.x,O.y,Un.x,Za+Un.y,Ai.x+Ai.w,Ai.y+Ai.h,l,mi,Ii.x,Ii.y,Kn,ua),ht(i.dynamicLayoutVertexArray,O,ct),he.emplaceBack(fa,fa+1,fa+2),he.emplaceBack(fa+1,fa+2,fa+3),Ke.vertexLength+=4,Ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qi[0]),Kt!==s.length-1&&La===s[Kt+1].sectionIndex||i.programConfigurations.populatePaintArrays(Ee.length,C,C.index,{},te,Bt&&Bt[La])}i.placedSymbolArray.emplaceBack(O.x,O.y,Je,this.glyphOffsetArray.length-Je,mt,U,W,O.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],T,0,!1,0,$)},it.prototype._addCollisionDebugVertex=function(i,s,l,d,x,C){return s.emplaceBack(0,0),i.emplaceBack(l.x,l.y,d,x,Math.round(C.x),Math.round(C.y))},it.prototype.addCollisionDebugVertices=function(i,s,l,d,x,C,T){var O=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),U=O.vertexLength,W=x.layoutVertexArray,$=x.collisionVertexArray,te=T.anchorX,he=T.anchorY;this._addCollisionDebugVertex(W,$,C,te,he,new ve(i,s)),this._addCollisionDebugVertex(W,$,C,te,he,new ve(l,s)),this._addCollisionDebugVertex(W,$,C,te,he,new ve(l,d)),this._addCollisionDebugVertex(W,$,C,te,he,new ve(i,d)),O.vertexLength+=4;var Ee=x.indexArray;Ee.emplaceBack(U,U+1),Ee.emplaceBack(U+1,U+2),Ee.emplaceBack(U+2,U+3),Ee.emplaceBack(U+3,U),O.primitiveLength+=4},it.prototype.addDebugCollisionBoxes=function(i,s,l,d){for(var x=i;x<s;x++){var C=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,d?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,l)}},it.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gt(ll,Rd.members,Rh),this.iconCollisionBox=new gt(ll,Rd.members,Rh);for(var i=0;i<this.symbolInstances.length;i++){var s=this.symbolInstances.get(i);this.addDebugCollisionBoxes(s.textBoxStartIndex,s.textBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,!0),this.addDebugCollisionBoxes(s.iconBoxStartIndex,s.iconBoxEndIndex,s,!1),this.addDebugCollisionBoxes(s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,!1)}},it.prototype._deserializeCollisionBoxesForSymbol=function(i,s,l,d,x,C,T,O,U){for(var W={},$=s;$<l;$++){var te=i.get($);W.textBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},W.textFeatureIndex=te.featureIndex;break}for(var he=d;he<x;he++){var Ee=i.get(he);W.verticalTextBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},W.verticalTextFeatureIndex=Ee.featureIndex;break}for(var Ke=C;Ke<T;Ke++){var Je=i.get(Ke);W.iconBox={x1:Je.x1,y1:Je.y1,x2:Je.x2,y2:Je.y2,anchorPointX:Je.anchorPointX,anchorPointY:Je.anchorPointY},W.iconFeatureIndex=Je.featureIndex;break}for(var mt=O;mt<U;mt++){var ct=i.get(mt);W.verticalIconBox={x1:ct.x1,y1:ct.y1,x2:ct.x2,y2:ct.y2,anchorPointX:ct.anchorPointX,anchorPointY:ct.anchorPointY},W.verticalIconFeatureIndex=ct.featureIndex;break}return W},it.prototype.deserializeCollisionBoxes=function(i){this.collisionArrays=[];for(var s=0;s<this.symbolInstances.length;s++){var l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}},it.prototype.hasTextData=function(){return this.text.segments.get().length>0},it.prototype.hasIconData=function(){return this.icon.segments.get().length>0},it.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},it.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},it.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},it.prototype.addIndicesForPlacedSymbol=function(i,s){for(var l=i.placedSymbolArray.get(s),d=l.vertexStartIndex+4*l.numGlyphs,x=l.vertexStartIndex;x<d;x+=4)i.indexArray.emplaceBack(x,x+1,x+2),i.indexArray.emplaceBack(x+1,x+2,x+3)},it.prototype.getSortedSymbolIndexes=function(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var s=Math.sin(i),l=Math.cos(i),d=[],x=[],C=[],T=0;T<this.symbolInstances.length;++T){C.push(T);var O=this.symbolInstances.get(T);d.push(0|Math.round(s*O.anchorX+l*O.anchorY)),x.push(O.featureIndex)}return C.sort(function(U,W){return d[U]-d[W]||x[W]-x[U]}),C},it.prototype.addToSortKeyRanges=function(i,s){var l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})},it.prototype.sortFeatures=function(i){var s=this;if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var l=0,d=this.symbolInstanceIndexes;l<d.length;l+=1){var x=this.symbolInstances.get(d[l]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(C,T,O){C>=0&&O.indexOf(C)===T&&s.addIndicesForPlacedSymbol(s.text,C)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},ri("SymbolBucket",it,{omit:["layers","collisionBoxArray","features","compareText"]}),it.MAX_GLYPHS=65535,it.addDynamicAttributes=ht;var wt=new Yo({"symbol-placement":new _i(Ie.layout_symbol["symbol-placement"]),"symbol-spacing":new _i(Ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _i(Ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pi(Ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _i(Ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _i(Ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _i(Ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new _i(Ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _i(Ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new pi(Ie.layout_symbol["icon-size"]),"icon-text-fit":new _i(Ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _i(Ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new pi(Ie.layout_symbol["icon-image"]),"icon-rotate":new pi(Ie.layout_symbol["icon-rotate"]),"icon-padding":new _i(Ie.layout_symbol["icon-padding"]),"icon-keep-upright":new _i(Ie.layout_symbol["icon-keep-upright"]),"icon-offset":new pi(Ie.layout_symbol["icon-offset"]),"icon-anchor":new pi(Ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _i(Ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _i(Ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _i(Ie.layout_symbol["text-rotation-alignment"]),"text-field":new pi(Ie.layout_symbol["text-field"]),"text-font":new pi(Ie.layout_symbol["text-font"]),"text-size":new pi(Ie.layout_symbol["text-size"]),"text-max-width":new pi(Ie.layout_symbol["text-max-width"]),"text-line-height":new _i(Ie.layout_symbol["text-line-height"]),"text-letter-spacing":new pi(Ie.layout_symbol["text-letter-spacing"]),"text-justify":new pi(Ie.layout_symbol["text-justify"]),"text-radial-offset":new pi(Ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _i(Ie.layout_symbol["text-variable-anchor"]),"text-anchor":new pi(Ie.layout_symbol["text-anchor"]),"text-max-angle":new _i(Ie.layout_symbol["text-max-angle"]),"text-writing-mode":new _i(Ie.layout_symbol["text-writing-mode"]),"text-rotate":new pi(Ie.layout_symbol["text-rotate"]),"text-padding":new _i(Ie.layout_symbol["text-padding"]),"text-keep-upright":new _i(Ie.layout_symbol["text-keep-upright"]),"text-transform":new pi(Ie.layout_symbol["text-transform"]),"text-offset":new pi(Ie.layout_symbol["text-offset"]),"text-allow-overlap":new _i(Ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _i(Ie.layout_symbol["text-ignore-placement"]),"text-optional":new _i(Ie.layout_symbol["text-optional"])}),Re={paint:new Yo({"icon-opacity":new pi(Ie.paint_symbol["icon-opacity"]),"icon-color":new pi(Ie.paint_symbol["icon-color"]),"icon-halo-color":new pi(Ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new pi(Ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pi(Ie.paint_symbol["icon-halo-blur"]),"icon-translate":new _i(Ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new _i(Ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new pi(Ie.paint_symbol["text-opacity"]),"text-color":new pi(Ie.paint_symbol["text-color"],{runtimeType:mn,getOverride:function(i){return i.textColor},hasOverride:function(i){return!!i.textColor}}),"text-halo-color":new pi(Ie.paint_symbol["text-halo-color"]),"text-halo-width":new pi(Ie.paint_symbol["text-halo-width"]),"text-halo-blur":new pi(Ie.paint_symbol["text-halo-blur"]),"text-translate":new _i(Ie.paint_symbol["text-translate"]),"text-translate-anchor":new _i(Ie.paint_symbol["text-translate-anchor"])}),layout:wt},ft=function(i){this.type=i.property.overrides?i.property.overrides.runtimeType:wn,this.defaultValue=i};ft.prototype.evaluate=function(i){if(i.formattedSection){var s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default},ft.prototype.eachChild=function(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)},ft.prototype.outputDefined=function(){return!1},ft.prototype.serialize=function(){return null},ri("FormatSectionOverride",ft,{omit:["defaultValue"]});var je=function(i){function s(l){i.call(this,l,Re)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.recalculate=function(l,d){if(i.prototype.recalculate.call(this,l,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var C=[],T=0,O=x;T<O.length;T+=1){var U=O[T];C.indexOf(U)<0&&C.push(U)}this.layout._values["text-writing-mode"]=C}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},s.prototype.getValueAndResolveTokens=function(l,d,x,C){var T=this.layout.get(l).evaluate(d,{},x,C),O=this._unevaluatedLayout._values[l];return O.isDataDriven()||mf(O.value)||!T?T:function(U,W){return W.replace(/{([^{}]+)}/g,function($,te){return te in U?String(U[te]):""})}(d.properties,T)},s.prototype.createBucket=function(l){return new it(l)},s.prototype.queryRadius=function(){return 0},s.prototype.queryIntersectsFeature=function(){return!1},s.prototype._setPaintOverrides=function(){for(var l=0,d=Re.paint.overridableProperties;l<d.length;l+=1){var x=d[l];if(s.hasPaintOverride(this.layout,x)){var C,T=this.paint.get(x),O=new ft(T),U=new vf(O,T.property.specification);C=T.value.kind==="constant"||T.value.kind==="source"?new gf("source",U):new Jl("composite",U,T.value.zoomStops,T.value._interpolationType),this.paint._values[x]=new pu(T.property,C,T.parameters)}}},s.prototype._handleOverridablePaintPropertyUpdate=function(l,d,x){return!(!this.layout||d.isDataDriven()||x.isDataDriven())&&s.hasPaintOverride(this.layout,l)},s.hasPaintOverride=function(l,d){var x=l.get("text-field"),C=Re.paint.properties[d],T=!1,O=function($){for(var te=0,he=$;te<he.length;te+=1)if(C.overrides&&C.overrides.hasOverride(he[te]))return void(T=!0)};if(x.value.kind==="constant"&&x.value.value instanceof bt)O(x.value.value.sections);else if(x.value.kind==="source"){var U=function($){T||($ instanceof Ra&&Bi($.value)===Zt?O($.value.sections):$ instanceof Ps?O($.sections):$.eachChild(U))},W=x.value;W._styleExpression&&U(W._styleExpression.expression)}return T},s}(Lu),zt={paint:new Yo({"background-color":new _i(Ie.paint_background["background-color"]),"background-pattern":new Os(Ie.paint_background["background-pattern"]),"background-opacity":new _i(Ie.paint_background["background-opacity"])})},$t=function(i){function s(l){i.call(this,l,zt)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Lu),Vr={paint:new Yo({"raster-opacity":new _i(Ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new _i(Ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _i(Ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _i(Ie.paint_raster["raster-brightness-max"]),"raster-saturation":new _i(Ie.paint_raster["raster-saturation"]),"raster-contrast":new _i(Ie.paint_raster["raster-contrast"]),"raster-resampling":new _i(Ie.paint_raster["raster-resampling"]),"raster-fade-duration":new _i(Ie.paint_raster["raster-fade-duration"])})},En=function(i){function s(l){i.call(this,l,Vr)}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s}(Lu),sn=function(i){function s(l){i.call(this,l,{}),this.implementation=l}return i&&(s.__proto__=i),(s.prototype=Object.create(i&&i.prototype)).constructor=s,s.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},s.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},s.prototype.recalculate=function(){},s.prototype.updateTransitions=function(){},s.prototype.hasTransition=function(){},s.prototype.serialize=function(){},s.prototype.onAdd=function(l){this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},s.prototype.onRemove=function(l){this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},s}(Lu),jn={circle:Sp,heatmap:Oh,hillshade:ih,fill:Fu,"fill-extrusion":mc,line:ad,symbol:je,background:$t,raster:En},_n=we.HTMLImageElement,Yn=we.HTMLCanvasElement,Hn=we.HTMLVideoElement,qn=we.ImageData,si=we.ImageBitmap,$n=function(i,s,l,d){this.context=i,this.format=l,this.texture=i.gl.createTexture(),this.update(s,d)};$n.prototype.update=function(i,s,l){var d=i.width,x=i.height,C=!(this.size&&this.size[0]===d&&this.size[1]===x||l),T=this.context,O=T.gl;if(this.useMipmap=Boolean(s&&s.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!s||s.premultiply!==!1)),C)this.size=[d,x],i instanceof _n||i instanceof Yn||i instanceof Hn||i instanceof qn||si&&i instanceof si?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,i):O.texImage2D(O.TEXTURE_2D,0,this.format,d,x,0,this.format,O.UNSIGNED_BYTE,i.data);else{var U=l||{x:0,y:0},W=U.x,$=U.y;i instanceof _n||i instanceof Yn||i instanceof Hn||i instanceof qn||si&&i instanceof si?O.texSubImage2D(O.TEXTURE_2D,0,W,$,O.RGBA,O.UNSIGNED_BYTE,i):O.texSubImage2D(O.TEXTURE_2D,0,W,$,d,x,O.RGBA,O.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)},$n.prototype.bind=function(i,s,l){var d=this.context.gl;d.bindTexture(d.TEXTURE_2D,this.texture),l!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=d.LINEAR),i!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,l||i),this.filter=i),s!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrap=s)},$n.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},$n.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ni=function(i){var s=this;this._callback=i,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){s._triggered=!1,s._callback()})};Ni.prototype.trigger=function(){var i=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){i._triggered=!1,i._callback()},0))},Ni.prototype.remove=function(){delete this._channel,this._callback=function(){}};var za=function(i,s,l){this.target=i,this.parent=s,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Rr(["receive","process"],this),this.invoker=new Ni(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=fe()?i:we};function Ks(i,s,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[i*d-2*Math.PI*6378137/2,s*d-2*Math.PI*6378137/2]}za.prototype.send=function(i,s,l,d,x){var C=this;x===void 0&&(x=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[T]=l);var O=ae(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:i,hasCallback:!!l,targetMapId:d,mustQueue:x,sourceMapId:this.mapId,data:ku(s,O)},O),{cancel:function(){l&&delete C.callbacks[T],C.target.postMessage({id:T,type:"<cancel>",targetMapId:d,sourceMapId:C.mapId})}}},za.prototype.receive=function(i){var s=i.data,l=s.id;if(l&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){delete this.tasks[l];var d=this.cancelCallbacks[l];delete this.cancelCallbacks[l],d&&d()}else fe()||s.mustQueue?(this.tasks[l]=s,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,s)},za.prototype.process=function(){if(this.taskQueue.length){var i=this.taskQueue.shift(),s=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),s&&this.processTask(i,s)}},za.prototype.processTask=function(i,s){var l=this;if(s.type==="<response>"){var d=this.callbacks[i];delete this.callbacks[i],d&&(s.error?d(Pu(s.error)):d(null,Pu(s.data)))}else{var x=!1,C=ae(this.globalScope)?void 0:[],T=s.hasCallback?function($,te){x=!0,delete l.cancelCallbacks[i],l.target.postMessage({id:i,type:"<response>",sourceMapId:l.mapId,error:$?ku($):null,data:ku(te,C)},C)}:function($){x=!0},O=null,U=Pu(s.data);if(this.parent[s.type])O=this.parent[s.type](s.sourceMapId,U,T);else if(this.parent.getWorkerSource){var W=s.type.split(".");O=this.parent.getWorkerSource(s.sourceMapId,W[0],U.source)[W[1]](U,T)}else T(new Error("Could not find function "+s.type));!x&&O&&O.cancel&&(this.cancelCallbacks[i]=O.cancel)}},za.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ko=function(i,s){i&&(s?this.setSouthWest(i).setNorthEast(s):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))};ko.prototype.setNorthEast=function(i){return this._ne=i instanceof qa?new qa(i.lng,i.lat):qa.convert(i),this},ko.prototype.setSouthWest=function(i){return this._sw=i instanceof qa?new qa(i.lng,i.lat):qa.convert(i),this},ko.prototype.extend=function(i){var s,l,d=this._sw,x=this._ne;if(i instanceof qa)s=i,l=i;else{if(!(i instanceof ko))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ko.convert(i)):this.extend(qa.convert(i)):this;if(l=i._ne,!(s=i._sw)||!l)return this}return d||x?(d.lng=Math.min(s.lng,d.lng),d.lat=Math.min(s.lat,d.lat),x.lng=Math.max(l.lng,x.lng),x.lat=Math.max(l.lat,x.lat)):(this._sw=new qa(s.lng,s.lat),this._ne=new qa(l.lng,l.lat)),this},ko.prototype.getCenter=function(){return new qa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ko.prototype.getSouthWest=function(){return this._sw},ko.prototype.getNorthEast=function(){return this._ne},ko.prototype.getNorthWest=function(){return new qa(this.getWest(),this.getNorth())},ko.prototype.getSouthEast=function(){return new qa(this.getEast(),this.getSouth())},ko.prototype.getWest=function(){return this._sw.lng},ko.prototype.getSouth=function(){return this._sw.lat},ko.prototype.getEast=function(){return this._ne.lng},ko.prototype.getNorth=function(){return this._ne.lat},ko.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ko.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ko.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ko.prototype.contains=function(i){var s=qa.convert(i),l=s.lng,d=s.lat,x=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&x},ko.convert=function(i){return!i||i instanceof ko?i:new ko(i)};var qa=function(i,s){if(isNaN(i)||isNaN(s))throw new Error("Invalid LngLat object: ("+i+", "+s+")");if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};qa.prototype.wrap=function(){return new qa(qt(this.lng,-180,180),this.lat)},qa.prototype.toArray=function(){return[this.lng,this.lat]},qa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},qa.prototype.distanceTo=function(i){var s=Math.PI/180,l=this.lat*s,d=i.lat*s,x=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((i.lng-this.lng)*s);return 63710088e-1*Math.acos(Math.min(x,1))},qa.prototype.toBounds=function(i){i===void 0&&(i=0);var s=360*i/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new ko(new qa(this.lng-l,this.lat-s),new qa(this.lng+l,this.lat+s))},qa.convert=function(i){if(i instanceof qa)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new qa(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new qa(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Vc=2*Math.PI*63710088e-1;function Du(i){return Vc*Math.cos(i*Math.PI/180)}function gc(i){return(180+i)/360}function $l(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function yc(i,s){return i/Du(s)}function hl(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}var jc=function(i,s,l){l===void 0&&(l=0),this.x=+i,this.y=+s,this.z=+l};jc.fromLngLat=function(i,s){s===void 0&&(s=0);var l=qa.convert(i);return new jc(gc(l.lng),$l(l.lat),yc(s,l.lat))},jc.prototype.toLngLat=function(){return new qa(360*this.x-180,hl(this.y))},jc.prototype.toAltitude=function(){return this.z*Du(hl(this.y))},jc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Vc*(i=hl(this.y),1/Math.cos(i*Math.PI/180));var i};var dh=function(i,s,l){this.z=i,this.x=s,this.y=l,this.key=Hs(0,i,i,s,l)};dh.prototype.equals=function(i){return this.z===i.z&&this.x===i.x&&this.y===i.y},dh.prototype.url=function(i,s){var l,d,x,C,T,O=(d=this.y,x=this.z,C=Ks(256*(l=this.x),256*(d=Math.pow(2,x)-d-1),x),T=Ks(256*(l+1),256*(d+1),x),C[0]+","+C[1]+","+T[0]+","+T[1]),U=function(W,$,te){for(var he,Ee="",Ke=W;Ke>0;Ke--)Ee+=($&(he=1<<Ke-1)?1:0)+(te&he?2:0);return Ee}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",U).replace("{bbox-epsg-3857}",O)},dh.prototype.getTilePoint=function(i){var s=Math.pow(2,this.z);return new ve(8192*(i.x*s-this.x),8192*(i.y*s-this.y))},dh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var rp=function(i,s){this.wrap=i,this.canonical=s,this.key=Hs(i,s.z,s.z,s.x,s.y)},Is=function(i,s,l,d,x){this.overscaledZ=i,this.wrap=s,this.canonical=new dh(l,+d,+x),this.key=Hs(s,i,l,d,x)};function Hs(i,s,l,d,x){(i*=2)<0&&(i=-1*i-1);var C=1<<l;return(C*C*i+C*x+d).toString(36)+l.toString(36)+s.toString(36)}Is.prototype.equals=function(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)},Is.prototype.scaledTo=function(i){var s=this.canonical.z-i;return i>this.canonical.z?new Is(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Is(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)},Is.prototype.calculateScaledKey=function(i,s){var l=this.canonical.z-i;return i>this.canonical.z?Hs(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y):Hs(this.wrap*+s,i,i,this.canonical.x>>l,this.canonical.y>>l)},Is.prototype.isChildOf=function(i){if(i.wrap!==this.wrap)return!1;var s=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s},Is.prototype.children=function(i){if(this.overscaledZ>=i)return[new Is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var s=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new Is(s,this.wrap,s,l,d),new Is(s,this.wrap,s,l+1,d),new Is(s,this.wrap,s,l,d+1),new Is(s,this.wrap,s,l+1,d+1)]},Is.prototype.isLessThan=function(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))},Is.prototype.wrapped=function(){return new Is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Is.prototype.unwrapTo=function(i){return new Is(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)},Is.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Is.prototype.toUnwrapped=function(){return new rp(this.wrap,this.canonical)},Is.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Is.prototype.getTilePoint=function(i){return this.canonical.getTilePoint(new jc(i.x-this.wrap,i.y))},ri("CanonicalTileID",dh),ri("OverscaledTileID",Is,{omit:["posMatrix"]});var _c=function(i,s,l){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Ue('"'+l+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=s.height;var d=this.dim=s.height-2;this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox";for(var x=0;x<d;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(d,x)]=this.data[this._idx(d-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,d)]=this.data[this._idx(x,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]};_c.prototype.get=function(i,s){var l=new Uint8Array(this.data.buffer),d=4*this._idx(i,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[d],l[d+1],l[d+2])},_c.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},_c.prototype._idx=function(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)},_c.prototype._unpackMapbox=function(i,s,l){return(256*i*256+256*s+l)/10-1e4},_c.prototype._unpackTerrarium=function(i,s,l){return 256*i+s+l/256-32768},_c.prototype.getPixels=function(){return new zs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},_c.prototype.backfillBorder=function(i,s,l){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");var d=s*this.dim,x=s*this.dim+this.dim,C=l*this.dim,T=l*this.dim+this.dim;switch(s){case-1:d=x-1;break;case 1:x=d+1}switch(l){case-1:C=T-1;break;case 1:T=C+1}for(var O=-s*this.dim,U=-l*this.dim,W=C;W<T;W++)for(var $=d;$<x;$++)this.data[this._idx($,W)]=i.data[this._idx($+O,W+U)]},ri("DEMData",_c);var np=function(i){this._stringToNumber={},this._numberToString=[];for(var s=0;s<i.length;s++){var l=i[s];this._stringToNumber[l]=s,this._numberToString[s]=l}};np.prototype.encode=function(i){return this._stringToNumber[i]},np.prototype.decode=function(i){return this._numberToString[i]};var vh=function(i,s,l,d,x){this.type="Feature",this._vectorTileFeature=i,i._z=s,i._x=l,i._y=d,this.properties=i.properties,this.id=x},ld={geometry:{configurable:!0}};ld.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},ld.geometry.set=function(i){this._geometry=i},vh.prototype.toJSON=function(){var i={geometry:this.geometry};for(var s in this)s!=="_geometry"&&s!=="_vectorTileFeature"&&(i[s]=this[s]);return i},Object.defineProperties(vh.prototype,ld);var Kl=function(){this.state={},this.stateChanges={},this.deletedStates={}};Kl.prototype.updateState=function(i,s,l){var d=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][d]=this.stateChanges[i][d]||{},Yt(this.stateChanges[i][d],l),this.deletedStates[i]===null)for(var x in this.deletedStates[i]={},this.state[i])x!==d&&(this.deletedStates[i][x]=null);else if(this.deletedStates[i]&&this.deletedStates[i][d]===null)for(var C in this.deletedStates[i][d]={},this.state[i][d])l[C]||(this.deletedStates[i][d][C]=null);else for(var T in l)this.deletedStates[i]&&this.deletedStates[i][d]&&this.deletedStates[i][d][T]===null&&delete this.deletedStates[i][d][T]},Kl.prototype.removeFeatureState=function(i,s,l){if(this.deletedStates[i]!==null){var d=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},l&&s!==void 0)this.deletedStates[i][d]!==null&&(this.deletedStates[i][d]=this.deletedStates[i][d]||{},this.deletedStates[i][d][l]=null);else if(s!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][d])for(l in this.deletedStates[i][d]={},this.stateChanges[i][d])this.deletedStates[i][d][l]=null;else this.deletedStates[i][d]=null;else this.deletedStates[i]=null}},Kl.prototype.getState=function(i,s){var l=String(s),d=Yt({},(this.state[i]||{})[l],(this.stateChanges[i]||{})[l]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){var x=this.deletedStates[i][s];if(x===null)return{};for(var C in x)delete d[C]}return d},Kl.prototype.initializeTileState=function(i,s){i.setFeatureState(this.state,s)},Kl.prototype.coalesceChanges=function(i,s){var l={};for(var d in this.stateChanges){this.state[d]=this.state[d]||{};var x={};for(var C in this.stateChanges[d])this.state[d][C]||(this.state[d][C]={}),Yt(this.state[d][C],this.stateChanges[d][C]),x[C]=this.state[d][C];l[d]=x}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var O={};if(this.deletedStates[T]===null)for(var U in this.state[T])O[U]={},this.state[T][U]={};else for(var W in this.deletedStates[T]){if(this.deletedStates[T][W]===null)this.state[T][W]={};else for(var $=0,te=Object.keys(this.deletedStates[T][W]);$<te.length;$+=1)delete this.state[T][W][te[$]];O[W]=this.state[T][W]}l[T]=l[T]||{},Yt(l[T],O)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(var he in i)i[he].setFeatureState(l,s)};var zf=function(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Vl(8192,16,0),this.grid3D=new Vl(8192,16,0),this.featureIndexArray=new ne,this.promoteId=s};function i0(i,s,l,d,x){return _r(i,function(C,T){var O=s instanceof sl?s.get(T):null;return O&&O.evaluate?O.evaluate(l,d,x):O})}function pv(i){for(var s=1/0,l=1/0,d=-1/0,x=-1/0,C=0,T=i;C<T.length;C+=1){var O=T[C];s=Math.min(s,O.x),l=Math.min(l,O.y),d=Math.max(d,O.x),x=Math.max(x,O.y)}return{minX:s,minY:l,maxX:d,maxY:x}}function Zv(i,s){return s-i}zf.prototype.insert=function(i,s,l,d,x,C){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,x);for(var O=C?this.grid3D:this.grid,U=0;U<s.length;U++){for(var W=s[U],$=[1/0,1/0,-1/0,-1/0],te=0;te<W.length;te++){var he=W[te];$[0]=Math.min($[0],he.x),$[1]=Math.min($[1],he.y),$[2]=Math.max($[2],he.x),$[3]=Math.max($[3],he.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&O.insert(T,$[0],$[1],$[2],$[3])}},zf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Zs.VectorTile(new ph(this.rawTileData)).layers,this.sourceLayerCoder=new np(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},zf.prototype.query=function(i,s,l,d){var x=this;this.loadVTLayers();for(var C=i.params||{},T=8192/i.tileSize/i.scale,O=kc(C.filter),U=i.queryGeometry,W=i.queryPadding*T,$=pv(U),te=this.grid.query($.minX-W,$.minY-W,$.maxX+W,$.maxY+W),he=pv(i.cameraQueryGeometry),Ee=this.grid3D.query(he.minX-W,he.minY-W,he.maxX+W,he.maxY+W,function(mr,gr,zr,fn){return function(Un,Ai,ei,Ii,Kn){for(var ua=0,qi=Un;ua<qi.length;ua+=1){var mi=qi[ua];if(Ai<=mi.x&&ei<=mi.y&&Ii>=mi.x&&Kn>=mi.y)return!0}var La=[new ve(Ai,ei),new ve(Ai,Kn),new ve(Ii,Kn),new ve(Ii,ei)];if(Un.length>2){for(var fa=0,Za=La;fa<Za.length;fa+=1)if(cl(Un,Za[fa]))return!0}for(var ki=0;ki<Un.length-1;ki++)if(cc(Un[ki],Un[ki+1],La))return!0;return!1}(i.cameraQueryGeometry,mr-W,gr-W,zr+W,fn+W)}),Ke=0,Je=Ee;Ke<Je.length;Ke+=1)te.push(Je[Ke]);te.sort(Zv);for(var mt,ct={},Bt=function(mr){var gr=te[mr];if(gr!==mt){mt=gr;var zr=x.featureIndexArray.get(gr),fn=null;x.loadMatchingFeature(ct,zr.bucketIndex,zr.sourceLayerIndex,zr.featureIndex,O,C.layers,C.availableImages,s,l,d,function(Un,Ai,ei){return fn||(fn=co(Un)),Ai.queryIntersectsFeature(U,Un,ei,fn,x.z,i.transform,T,i.pixelPosMatrix)})}},Kt=0;Kt<te.length;Kt++)Bt(Kt);return ct},zf.prototype.loadMatchingFeature=function(i,s,l,d,x,C,T,O,U,W,$){var te=this.bucketLayerIDs[s];if(!C||function(Un,Ai){for(var ei=0;ei<Un.length;ei++)if(Ai.indexOf(Un[ei])>=0)return!0;return!1}(C,te)){var he=this.sourceLayerCoder.decode(l),Ee=this.vtLayers[he].feature(d);if(x.needGeometry){var Ke=Jo(Ee,!0);if(!x.filter(new la(this.tileID.overscaledZ),Ke,this.tileID.canonical))return}else if(!x.filter(new la(this.tileID.overscaledZ),Ee))return;for(var Je=this.getId(Ee,he),mt=0;mt<te.length;mt++){var ct=te[mt];if(!(C&&C.indexOf(ct)<0)){var Bt=O[ct];if(Bt){var Kt={};Je!==void 0&&W&&(Kt=W.getState(Bt.sourceLayer||"_geojsonTileLayer",Je));var mr=Yt({},U[ct]);mr.paint=i0(mr.paint,Bt.paint,Ee,Kt,T),mr.layout=i0(mr.layout,Bt.layout,Ee,Kt,T);var gr=!$||$(Ee,Bt,Kt);if(gr){var zr=new vh(Ee,this.z,this.x,this.y,Je);zr.layer=mr;var fn=i[ct];fn===void 0&&(fn=i[ct]=[]),fn.push({featureIndex:d,feature:zr,intersectionZ:gr})}}}}}},zf.prototype.lookupSymbolFeatures=function(i,s,l,d,x,C,T,O){var U={};this.loadVTLayers();for(var W=kc(x),$=0,te=i;$<te.length;$+=1)this.loadMatchingFeature(U,l,d,te[$],W,C,T,O,s);return U},zf.prototype.hasLayer=function(i){for(var s=0,l=this.bucketLayerIDs;s<l.length;s+=1)for(var d=0,x=l[s];d<x.length;d+=1)if(i===x[d])return!0;return!1},zf.prototype.getId=function(i,s){var l=i.id;return this.promoteId&&typeof(l=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]])=="boolean"&&(l=Number(l)),l},ri("FeatureIndex",zf,{omit:["rawTileData","sourceLayerCoder"]});var Qs=function(i,s){this.tileID=i,this.uid=fr(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Qs.prototype.registerFadeDuration=function(i){var s=i+this.timeAdded;s<Li.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)},Qs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Qs.prototype.loadVectorData=function(i,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){for(var d in i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(W,$){var te={};if(!$)return te;for(var he=function(){var Je=Ke[Ee],mt=Je.layerIds.map(function(Kt){return $.getLayer(Kt)}).filter(Boolean);if(mt.length!==0){Je.layers=mt,Je.stateDependentLayerIds&&(Je.stateDependentLayers=Je.stateDependentLayerIds.map(function(Kt){return mt.filter(function(mr){return mr.id===Kt})[0]}));for(var ct=0,Bt=mt;ct<Bt.length;ct+=1)te[Bt[ct].id]=Je}},Ee=0,Ke=W;Ee<Ke.length;Ee+=1)he();return te}(i.buckets,s.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[d];if(x instanceof it){if(this.hasSymbolBuckets=!0,!l)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var C in this.buckets){var T=this.buckets[C];if(T instanceof it&&T.hasRTLText){this.hasRTLText=!0,Ys.isLoading()||Ys.isLoaded()||Cp()!=="deferred"||al();break}}for(var O in this.queryPadding=0,this.buckets){var U=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(O).queryRadius(U))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new p},Qs.prototype.unloadVectorData=function(){for(var i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Qs.prototype.getBucket=function(i){return this.buckets[i.id]},Qs.prototype.upload=function(i){for(var s in this.buckets){var l=this.buckets[s];l.uploadPending()&&l.upload(i)}var d=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $n(i,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $n(i,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)},Qs.prototype.prepare=function(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)},Qs.prototype.queryRenderedFeatures=function(i,s,l,d,x,C,T,O,U,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:x,scale:C,tileSize:this.tileSize,pixelPosMatrix:W,transform:O,params:T,queryPadding:this.queryPadding*U},i,s,l):{}},Qs.prototype.querySourceFeatures=function(i,s){var l=this.latestFeatureIndex;if(l&&l.rawTileData){var d=l.loadVTLayers(),x=s?s.sourceLayer:"",C=d._geojsonTileLayer||d[x];if(C)for(var T=kc(s&&s.filter),O=this.tileID.canonical,U=O.z,W=O.x,$=O.y,te={z:U,x:W,y:$},he=0;he<C.length;he++){var Ee=C.feature(he);if(T.needGeometry){var Ke=Jo(Ee,!0);if(!T.filter(new la(this.tileID.overscaledZ),Ke,this.tileID.canonical))continue}else if(!T.filter(new la(this.tileID.overscaledZ),Ee))continue;var Je=l.getId(Ee,x),mt=new vh(Ee,U,W,$,Je);mt.tile=te,i.push(mt)}}},Qs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Qs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Qs.prototype.setExpiryData=function(i){var s=this.expirationTime;if(i.cacheControl){var l=rt(i.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){var d=Date.now(),x=!1;if(this.expirationTime>d)x=!1;else if(s)if(this.expirationTime<s)x=!0;else{var C=this.expirationTime-s;C?this.expirationTime=d+Math.max(C,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Qs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Qs.prototype.setFeatureState=function(i,s){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0){var l=this.latestFeatureIndex.loadVTLayers();for(var d in this.buckets)if(s.style.hasLayer(d)){var x=this.buckets[d],C=x.layers[0].sourceLayer||"_geojsonTileLayer",T=l[C],O=i[C];if(T&&O&&Object.keys(O).length!==0){x.update(O,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var U=s&&s.style&&s.style.getLayer(d);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(x)))}}}},Qs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Qs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Li.now()},Qs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Qs.prototype.setHoldDuration=function(i){this.symbolFadeHoldUntil=Li.now()+i},Qs.prototype.setDependencies=function(i,s){for(var l={},d=0,x=s;d<x.length;d+=1)l[x[d]]=!0;this.dependencies[i]=l},Qs.prototype.hasDependency=function(i,s){for(var l=0,d=i;l<d.length;l+=1){var x=this.dependencies[d[l]];if(x){for(var C=0,T=s;C<T.length;C+=1)if(x[T[C]])return!0}}return!1};var ip=we.performance,Dd=function(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},ip.mark(this._marks.start)};Dd.prototype.finish=function(){ip.mark(this._marks.end);var i=ip.getEntriesByName(this._marks.measure);return i.length===0&&(ip.measure(this._marks.measure,this._marks.start,this._marks.end),i=ip.getEntriesByName(this._marks.measure),ip.clearMarks(this._marks.start),ip.clearMarks(this._marks.end),ip.clearMeasures(this._marks.measure)),i},y.Actor=za,y.AlphaImage=Yl,y.CanonicalTileID=dh,y.CollisionBoxArray=p,y.Color=Or,y.DEMData=_c,y.DataConstantProperty=_i,y.DictionaryCoder=np,y.EXTENT=8192,y.ErrorEvent=ut,y.EvaluationParameters=la,y.Event=Ye,y.Evented=xt,y.FeatureIndex=zf,y.FillBucket=kl,y.FillExtrusionBucket=zc,y.ImageAtlas=en,y.ImagePosition=Nt,y.LineBucket=uo,y.LngLat=qa,y.LngLatBounds=ko,y.MercatorCoordinate=jc,y.ONE_EM=24,y.OverscaledTileID=Is,y.Point=ve,y.Point$1=ve,y.Properties=Yo,y.Protobuf=ph,y.RGBAImage=zs,y.RequestManager=fi,y.RequestPerformance=Dd,y.ResourceType=An,y.SegmentVector=Me,y.SourceFeatureState=Kl,y.StructArrayLayout1ui2=Gu,y.StructArrayLayout2f1f2i16=ac,y.StructArrayLayout2i4=eh,y.StructArrayLayout3ui6=oc,y.StructArrayLayout4i8=Cl,y.SymbolBucket=it,y.Texture=$n,y.Tile=Qs,y.Transitionable=ws,y.Uniform1f=bn,y.Uniform1i=Wr,y.Uniform2f=gn,y.Uniform3f=Gn,y.Uniform4f=xi,y.UniformColor=Si,y.UniformMatrix4f=Ea,y.UnwrappedTileID=rp,y.ValidationError=nt,y.WritingMode=Pn,y.ZoomHistory=Lc,y.add=function(i,s,l){return i[0]=s[0]+l[0],i[1]=s[1]+l[1],i[2]=s[2]+l[2],i},y.addDynamicAttributes=ht,y.asyncAll=function(i,s,l){if(!i.length)return l(null,[]);var d=i.length,x=new Array(i.length),C=null;i.forEach(function(T,O){s(T,function(U,W){U&&(C=U),x[O]=W,--d==0&&l(C,x)})})},y.bezier=St,y.bindAll=Rr,y.browser=Li,y.cacheEntryPossiblyAdded=function(i){++vi>xr&&(i.getActor().send("enforceCacheSizeLimit",Ut),vi=0)},y.clamp=tr,y.clearTileCache=function(i){var s=we.caches.delete("mapbox-tiles");i&&s.catch(i).then(function(){return i()})},y.clipLine=gs,y.clone=function(i){var s=new Na(16);return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},y.clone$1=yt,y.clone$2=function(i){var s=new Na(3);return s[0]=i[0],s[1]=i[1],s[2]=i[2],s},y.collisionCircleLayout=Lp,y.config=gi,y.create=function(){var i=new Na(16);return Na!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},y.create$1=function(){var i=new Na(9);return Na!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i},y.create$2=function(){var i=new Na(4);return Na!=Float32Array&&(i[1]=0,i[2]=0),i[0]=1,i[3]=1,i},y.createCommonjsModule=Ne,y.createExpression=Mc,y.createLayout=po,y.createStyleLayer=function(i){return i.type==="custom"?new sn(i):new jn[i.type](i)},y.cross=function(i,s,l){var d=s[0],x=s[1],C=s[2],T=l[0],O=l[1],U=l[2];return i[0]=x*U-C*O,i[1]=C*T-d*U,i[2]=d*O-x*T,i},y.deepEqual=function i(s,l){if(Array.isArray(s)){if(!Array.isArray(l)||s.length!==l.length)return!1;for(var d=0;d<s.length;d++)if(!i(s[d],l[d]))return!1;return!0}if(typeof s=="object"&&s!==null&&l!==null){if(typeof l!="object"||Object.keys(s).length!==Object.keys(l).length)return!1;for(var x in s)if(!i(s[x],l[x]))return!1;return!0}return s===l},y.dot=function(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]},y.dot$1=function(i,s){return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]+i[3]*s[3]},y.ease=Rt,y.emitValidationErrors=Af,y.endsWith=ie,y.enforceCacheSizeLimit=function(i){Cr(),ce&&ce.then(function(s){s.keys().then(function(l){for(var d=0;d<l.length-i;d++)s.delete(l[d])})})},y.evaluateSizeForFeature=Pi,y.evaluateSizeForZoom=ta,y.evaluateVariableOffset=sf,y.evented=Ep,y.extend=Yt,y.featureFilter=kc,y.filterObject=Ot,y.fromRotation=function(i,s){var l=Math.sin(s),d=Math.cos(s);return i[0]=d,i[1]=l,i[2]=0,i[3]=-l,i[4]=d,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},y.getAnchorAlignment=Mn,y.getAnchorJustification=$e,y.getArrayBuffer=Ci,y.getImage=se,y.getJSON=function(i,s){return ao(Yt(i,{type:"json"}),s)},y.getRTLTextPluginStatus=Cp,y.getReferrer=zi,y.getVideo=function(i,s){var l,d,x=we.document.createElement("video");x.muted=!0,x.onloadstart=function(){s(null,x)};for(var C=0;C<i.length;C++){var T=we.document.createElement("source");l=i[C],d=void 0,(d=we.document.createElement("a")).href=l,(d.protocol!==we.document.location.protocol||d.host!==we.document.location.host)&&(x.crossOrigin="Anonymous"),T.src=i[C],x.appendChild(T)}return{cancel:function(){}}},y.identity=Ru,y.invert=function(i,s){var l=s[0],d=s[1],x=s[2],C=s[3],T=s[4],O=s[5],U=s[6],W=s[7],$=s[8],te=s[9],he=s[10],Ee=s[11],Ke=s[12],Je=s[13],mt=s[14],ct=s[15],Bt=l*O-d*T,Kt=l*U-x*T,mr=l*W-C*T,gr=d*U-x*O,zr=d*W-C*O,fn=x*W-C*U,Un=$*Je-te*Ke,Ai=$*mt-he*Ke,ei=$*ct-Ee*Ke,Ii=te*mt-he*Je,Kn=te*ct-Ee*Je,ua=he*ct-Ee*mt,qi=Bt*ua-Kt*Kn+mr*Ii+gr*ei-zr*Ai+fn*Un;return qi?(i[0]=(O*ua-U*Kn+W*Ii)*(qi=1/qi),i[1]=(x*Kn-d*ua-C*Ii)*qi,i[2]=(Je*fn-mt*zr+ct*gr)*qi,i[3]=(he*zr-te*fn-Ee*gr)*qi,i[4]=(U*ei-T*ua-W*Ai)*qi,i[5]=(l*ua-x*ei+C*Ai)*qi,i[6]=(mt*mr-Ke*fn-ct*Kt)*qi,i[7]=($*fn-he*mr+Ee*Kt)*qi,i[8]=(T*Kn-O*ei+W*Un)*qi,i[9]=(d*ei-l*Kn-C*Un)*qi,i[10]=(Ke*zr-Je*mr+ct*Bt)*qi,i[11]=(te*mr-$*zr-Ee*Bt)*qi,i[12]=(O*Ai-T*Ii-U*Un)*qi,i[13]=(l*Ii-d*Ai+x*Un)*qi,i[14]=(Je*Kt-Ke*gr-mt*Bt)*qi,i[15]=($*gr-te*Kt+he*Bt)*qi,i):null},y.isChar=Tn,y.isMapboxURL=$i,y.keysDifference=function(i,s){var l=[];for(var d in i)d in s||l.push(d);return l},y.makeRequest=ao,y.mapObject=_r,y.mercatorXfromLng=gc,y.mercatorYfromLat=$l,y.mercatorZfromAltitude=yc,y.mul=rh,y.multiply=qs,y.mvt=Zs,y.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},y.normalize=function(i,s){var l=s[0],d=s[1],x=s[2],C=l*l+d*d+x*x;return C>0&&(C=1/Math.sqrt(C)),i[0]=s[0]*C,i[1]=s[1]*C,i[2]=s[2]*C,i},y.number=ha,y.offscreenCanvasSupported=ni,y.ortho=function(i,s,l,d,x,C,T){var O=1/(s-l),U=1/(d-x),W=1/(C-T);return i[0]=-2*O,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*U,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*W,i[11]=0,i[12]=(s+l)*O,i[13]=(x+d)*U,i[14]=(T+C)*W,i[15]=1,i},y.parseGlyphPBF=function(i){return new ph(i).readFields(pn,[])},y.pbf=ph,y.performSymbolLayout=function(i,s,l,d,x,C,T){i.createArrays(),i.tilePixelRatio=8192/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;var O=i.layers[0].layout,U=i.layers[0]._unevaluatedLayout._values,W={};if(i.textSizeData.kind==="composite"){var $=i.textSizeData,te=$.maxZoom;W.compositeTextSizes=[U["text-size"].possiblyEvaluate(new la($.minZoom),T),U["text-size"].possiblyEvaluate(new la(te),T)]}if(i.iconSizeData.kind==="composite"){var he=i.iconSizeData,Ee=he.maxZoom;W.compositeIconSizes=[U["icon-size"].possiblyEvaluate(new la(he.minZoom),T),U["icon-size"].possiblyEvaluate(new la(Ee),T)]}W.layoutTextSize=U["text-size"].possiblyEvaluate(new la(i.zoom+1),T),W.layoutIconSize=U["icon-size"].possiblyEvaluate(new la(i.zoom+1),T),W.textMaxSize=U["text-size"].possiblyEvaluate(new la(18));for(var Ke=24*O.get("text-line-height"),Je=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",mt=O.get("text-keep-upright"),ct=O.get("text-size"),Bt=function(){var gr=mr[Kt],zr=O.get("text-font").evaluate(gr,{},T).join(","),fn=ct.evaluate(gr,{},T),Un=W.layoutTextSize.evaluate(gr,{},T),Ai=W.layoutIconSize.evaluate(gr,{},T),ei={horizontal:{},vertical:void 0},Ii=gr.text,Kn=[0,0];if(Ii){var ua=Ii.toString(),qi=24*O.get("text-letter-spacing").evaluate(gr,{},T),mi=function(Fa){for(var To=0,vo=Fa;To<vo.length;To+=1)if(ja=vo[To].charCodeAt(0),Tn.Arabic(ja)||Tn["Arabic Supplement"](ja)||Tn["Arabic Extended-A"](ja)||Tn["Arabic Presentation Forms-A"](ja)||Tn["Arabic Presentation Forms-B"](ja))return!1;var ja;return!0}(ua)?qi:0,La=O.get("text-anchor").evaluate(gr,{},T),fa=O.get("text-variable-anchor");if(!fa){var Za=O.get("text-radial-offset").evaluate(gr,{},T);Kn=Za?sf(La,[24*Za,ys]):O.get("text-offset").evaluate(gr,{},T).map(function(Fa){return 24*Fa})}var ki=Je?"center":O.get("text-justify").evaluate(gr,{},T),to=O.get("symbol-placement"),Xo=to==="point"?24*O.get("text-max-width").evaluate(gr,{},T):0,Zo=function(){i.allowVerticalPlacement&&Rc(ua)&&(ei.vertical=Nn(Ii,s,l,x,zr,Xo,Ke,La,"left",mi,Kn,Pn.vertical,!0,to,Un,fn))};if(!Je&&fa){for(var _s=ki==="auto"?fa.map(function(Fa){return $e(Fa)}):[ki],Yr=!1,xs=0;xs<_s.length;xs++){var nr=_s[xs];if(!ei.horizontal[nr])if(Yr)ei.horizontal[nr]=ei.horizontal[0];else{var au=Nn(Ii,s,l,x,zr,Xo,Ke,"center",nr,mi,Kn,Pn.horizontal,!1,to,Un,fn);au&&(ei.horizontal[nr]=au,Yr=au.positionedLines.length===1)}}Zo()}else{ki==="auto"&&(ki=$e(La));var Yu=Nn(Ii,s,l,x,zr,Xo,Ke,La,ki,mi,Kn,Pn.horizontal,!1,to,Un,fn);Yu&&(ei.horizontal[ki]=Yu),Zo(),Rc(ua)&&Je&&mt&&(ei.vertical=Nn(Ii,s,l,x,zr,Xo,Ke,La,ki,mi,Kn,Pn.vertical,!1,to,Un,fn))}}var hs=void 0,Bu=!1;if(gr.icon&&gr.icon.name){var bs=d[gr.icon.name];bs&&(hs=function(Fa,To,vo){var ja=Mn(vo),qu=To[0]-Fa.displaySize[0]*ja.horizontalAlign,vu=To[1]-Fa.displaySize[1]*ja.verticalAlign;return{image:Fa,top:vu,bottom:vu+Fa.displaySize[1],left:qu,right:qu+Fa.displaySize[0]}}(x[gr.icon.name],O.get("icon-offset").evaluate(gr,{},T),O.get("icon-anchor").evaluate(gr,{},T)),Bu=bs.sdf,i.sdfIcons===void 0?i.sdfIcons=bs.sdf:i.sdfIcons!==bs.sdf&&Ue("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(bs.pixelRatio!==i.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}var Es=Xt(ei.horizontal)||ei.vertical;i.iconsInText=!!Es&&Es.iconsInText,(Es||hs)&&function(Fa,To,vo,ja,qu,vu,Oo,Ws,mu,Ga,Pl){var xc=vu.textMaxSize.evaluate(To,{});xc===void 0&&(xc=Oo);var pl,Cs=Fa.layers[0].layout,Gc=Cs.get("icon-offset").evaluate(To,{},Pl),uf=Xt(vo.horizontal),Rp=Oo/24,Op=Fa.tilePixelRatio*Rp,Fp=Fa.tilePixelRatio*xc/24,Nh=Fa.tilePixelRatio*Ws,Bd=Fa.tilePixelRatio*Cs.get("symbol-spacing"),Dp=Cs.get("text-padding")*Fa.tilePixelRatio,ap=Cs.get("icon-padding")*Fa.tilePixelRatio,op=Cs.get("text-max-angle")/180*Math.PI,sp=Cs.get("text-rotation-alignment")==="map"&&Cs.get("symbol-placement")!=="point",cd=Cs.get("icon-rotation-alignment")==="map"&&Cs.get("symbol-placement")!=="point",Hc=Cs.get("symbol-placement"),Nd=Bd/2,Bp=Cs.get("icon-text-fit");ja&&Bp!=="none"&&(Fa.allowVerticalPlacement&&vo.vertical&&(pl=Gi(ja,vo.vertical,Bp,Cs.get("icon-text-fit-padding"),Gc,Rp)),uf&&(ja=Gi(ja,uf,Bp,Cs.get("icon-text-fit-padding"),Gc,Rp)));var up=function(a0,gd){gd.x<0||gd.x>=8192||gd.y<0||gd.y>=8192||function(Ss,Zf,Vv,Zh,D0,B0,yh,bc,o0,Ud,s0,u0,l0,N0,Zd,yd,Vd,c0,Ll,z0,Ec,f0,dv,lf,Cc){var vv,hp,Vp,_h,_d,xd=Ss.addToLineVertexArray(Zf,Vv),U0=0,Z0=0,h0=0,p0=0,d0=-1,cf=-1,Vh={},V0=Xe(""),v0=0,bd=0;if(bc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(v0=(vv=bc.layout.get("text-offset").evaluate(Ec,{},lf).map(function(g0){return 24*g0}))[0],bd=vv[1]):(v0=24*bc.layout.get("text-radial-offset").evaluate(Ec,{},lf),bd=ys),Ss.allowVerticalPlacement&&Zh.vertical){var j0=bc.layout.get("text-rotate").evaluate(Ec,{},lf)+90;_h=new Ms(o0,Zf,Ud,s0,u0,Zh.vertical,l0,N0,Zd,j0),yh&&(_d=new Ms(o0,Zf,Ud,s0,u0,yh,Vd,c0,Zd,j0))}if(D0){var G0=bc.layout.get("icon-rotate").evaluate(Ec,{}),jd=bc.layout.get("icon-text-fit")!=="none",Gd=Ts(D0,G0,dv,jd),Hd=yh?Ts(yh,G0,dv,jd):void 0;Vp=new Ms(o0,Zf,Ud,s0,u0,D0,Vd,c0,!1,G0),U0=4*Gd.length;var m0=Ss.iconSizeData,jp=null;m0.kind==="source"?(jp=[128*bc.layout.get("icon-size").evaluate(Ec,{})])[0]>32640&&Ue(Ss.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):m0.kind==="composite"&&((jp=[128*f0.compositeIconSizes[0].evaluate(Ec,{},lf),128*f0.compositeIconSizes[1].evaluate(Ec,{},lf)])[0]>32640||jp[1]>32640)&&Ue(Ss.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ss.addSymbols(Ss.icon,Gd,jp,z0,Ll,Ec,!1,Zf,xd.lineStartIndex,xd.lineLength,-1,lf),d0=Ss.icon.placedSymbolArray.length-1,Hd&&(Z0=4*Hd.length,Ss.addSymbols(Ss.icon,Hd,jp,z0,Ll,Ec,Pn.vertical,Zf,xd.lineStartIndex,xd.lineLength,-1,lf),cf=Ss.icon.placedSymbolArray.length-1)}for(var H0 in Zh.horizontal){var pp=Zh.horizontal[H0];if(!hp){V0=Xe(pp.text);var mv=bc.layout.get("text-rotate").evaluate(Ec,{},lf);hp=new Ms(o0,Zf,Ud,s0,u0,pp,l0,N0,Zd,mv)}var dp=pp.positionedLines.length===1;if(h0+=dr(Ss,Zf,pp,B0,bc,Zd,Ec,yd,xd,Zh.vertical?Pn.horizontal:Pn.horizontalOnly,dp?Object.keys(Zh.horizontal):[H0],Vh,d0,f0,lf),dp)break}Zh.vertical&&(p0+=dr(Ss,Zf,Zh.vertical,B0,bc,Zd,Ec,yd,xd,Pn.vertical,["vertical"],Vh,cf,f0,lf));var Wd=hp?hp.boxStartIndex:Ss.collisionBoxArray.length,ka=hp?hp.boxEndIndex:Ss.collisionBoxArray.length,Aa=_h?_h.boxStartIndex:Ss.collisionBoxArray.length,gv=_h?_h.boxEndIndex:Ss.collisionBoxArray.length,Im=Vp?Vp.boxStartIndex:Ss.collisionBoxArray.length,jv=Vp?Vp.boxEndIndex:Ss.collisionBoxArray.length,km=_d?_d.boxStartIndex:Ss.collisionBoxArray.length,Pm=_d?_d.boxEndIndex:Ss.collisionBoxArray.length,Vf=-1,W0=function(g0,Js){return g0&&g0.circleDiameter?Math.max(g0.circleDiameter,Js):Js};Vf=W0(hp,Vf),Vf=W0(_h,Vf),Vf=W0(Vp,Vf);var Ed=(Vf=W0(_d,Vf))>-1?1:0;Ed&&(Vf*=Cc/24),Ss.glyphOffsetArray.length>=it.MAX_GLYPHS&&Ue("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ec.sortKey!==void 0&&Ss.addToSortKeyRanges(Ss.symbolInstances.length,Ec.sortKey),Ss.symbolInstances.emplaceBack(Zf.x,Zf.y,Vh.right>=0?Vh.right:-1,Vh.center>=0?Vh.center:-1,Vh.left>=0?Vh.left:-1,Vh.vertical||-1,d0,cf,V0,Wd,ka,Aa,gv,Im,jv,km,Pm,Ud,h0,p0,U0,Z0,Ed,0,l0,v0,bd,Vf)}(Fa,gd,a0,vo,ja,qu,pl,Fa.layers[0],Fa.collisionBoxArray,To.index,To.sourceLayerIndex,Fa.index,Op,Dp,sp,mu,Nh,ap,cd,Gc,To,vu,Ga,Pl,Oo)};if(Hc==="line")for(var Uf=0,zh=gs(To.geometry,0,0,8192,8192);Uf<zh.length;Uf+=1)for(var Np=zh[Uf],bo=0,Wc=js(Np,Bd,op,vo.vertical||uf,ja,24,Fp,Fa.overscaling,8192);bo<Wc.length;bo+=1){var fd=Wc[bo];uf&&Jn(Fa,uf.text,Nd,fd)||up(Np,fd)}else if(Hc==="line-center")for(var hd=0,lp=To.geometry;hd<lp.length;hd+=1){var pd=lp[hd];if(pd.length>1){var zp=wo(pd,op,vo.vertical||uf,ja,24,Fp);zp&&up(pd,zp)}}else if(To.type==="Polygon")for(var cp=0,Uh=Tp(To.geometry,0);cp<Uh.length;cp+=1){var fp=Uh[cp],Up=Yi(fp,16);up(fp[0],new Rn(Up.x,Up.y,0))}else if(To.type==="LineString")for(var wu=0,mh=To.geometry;wu<mh.length;wu+=1){var gh=mh[wu];up(gh,new Rn(gh[0].x,gh[0].y,0))}else if(To.type==="Point")for(var dd=0,vd=To.geometry;dd<vd.length;dd+=1)for(var md=0,zd=vd[dd];md<zd.length;md+=1){var Zp=zd[md];up([Zp],new Rn(Zp.x,Zp.y,0))}}(i,gr,ei,hs,d,W,Un,Ai,Kn,Bu,T)},Kt=0,mr=i.features;Kt<mr.length;Kt+=1)Bt();C&&i.generateCollisionDebugBuffers()},y.perspective=function(i,s,l,d,x){var C,T=1/Math.tan(s/2);return i[0]=T/l,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=T,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,x!=null&&x!==1/0?(i[10]=(x+d)*(C=1/(d-x)),i[14]=2*x*d*C):(i[10]=-1,i[14]=-2*d),i},y.pick=function(i,s){for(var l={},d=0;d<s.length;d++){var x=s[d];x in i&&(l[x]=i[x])}return l},y.plugin=Ys,y.polygonIntersectsPolygon=uc,y.postMapLoadEvent=tt,y.postTurnstileEvent=ar,y.potpack=cn,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=ri,y.registerForPluginStateChange=function(i){return i({pluginStatus:tu,pluginURL:jl}),Ep.on("pluginStateChange",i),i},y.renderColorRamp=Ml,y.rotate=function(i,s,l){var d=s[0],x=s[1],C=s[2],T=s[3],O=Math.sin(l),U=Math.cos(l);return i[0]=d*U+C*O,i[1]=x*U+T*O,i[2]=d*-O+C*U,i[3]=x*-O+T*U,i},y.rotateX=function(i,s,l){var d=Math.sin(l),x=Math.cos(l),C=s[4],T=s[5],O=s[6],U=s[7],W=s[8],$=s[9],te=s[10],he=s[11];return s!==i&&(i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[4]=C*x+W*d,i[5]=T*x+$*d,i[6]=O*x+te*d,i[7]=U*x+he*d,i[8]=W*x-C*d,i[9]=$*x-T*d,i[10]=te*x-O*d,i[11]=he*x-U*d,i},y.rotateZ=function(i,s,l){var d=Math.sin(l),x=Math.cos(l),C=s[0],T=s[1],O=s[2],U=s[3],W=s[4],$=s[5],te=s[6],he=s[7];return s!==i&&(i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15]),i[0]=C*x+W*d,i[1]=T*x+$*d,i[2]=O*x+te*d,i[3]=U*x+he*d,i[4]=W*x-C*d,i[5]=$*x-T*d,i[6]=te*x-O*d,i[7]=he*x-U*d,i},y.scale=function(i,s,l){var d=l[0],x=l[1],C=l[2];return i[0]=s[0]*d,i[1]=s[1]*d,i[2]=s[2]*d,i[3]=s[3]*d,i[4]=s[4]*x,i[5]=s[5]*x,i[6]=s[6]*x,i[7]=s[7]*x,i[8]=s[8]*C,i[9]=s[9]*C,i[10]=s[10]*C,i[11]=s[11]*C,i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},y.scale$1=function(i,s,l){return i[0]=s[0]*l,i[1]=s[1]*l,i[2]=s[2]*l,i[3]=s[3]*l,i},y.scale$2=function(i,s,l){return i[0]=s[0]*l,i[1]=s[1]*l,i[2]=s[2]*l,i},y.setCacheLimits=function(i,s){Ut=i,xr=s},y.setRTLTextPlugin=function(i,s,l){if(l===void 0&&(l=!1),tu==="deferred"||tu==="loading"||tu==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");jl=Li.resolveURL(i),tu="deferred",il=s,Kf(),l||al()},y.sphericalToCartesian=function(i){var s=i[0],l=i[1],d=i[2];return l+=90,l*=Math.PI/180,d*=Math.PI/180,{x:s*Math.cos(l)*Math.sin(d),y:s*Math.sin(l)*Math.sin(d),z:s*Math.cos(d)}},y.sqrLen=function(i){var s=i[0],l=i[1];return s*s+l*l},y.styleSpec=Ie,y.sub=function(i,s,l){return i[0]=s[0]-l[0],i[1]=s[1]-l[1],i[2]=s[2]-l[2],i},y.symbolSize=Ta,y.transformMat3=function(i,s,l){var d=s[0],x=s[1],C=s[2];return i[0]=d*l[0]+x*l[3]+C*l[6],i[1]=d*l[1]+x*l[4]+C*l[7],i[2]=d*l[2]+x*l[5]+C*l[8],i},y.transformMat4=Lf,y.translate=function(i,s,l){var d,x,C,T,O,U,W,$,te,he,Ee,Ke,Je=l[0],mt=l[1],ct=l[2];return s===i?(i[12]=s[0]*Je+s[4]*mt+s[8]*ct+s[12],i[13]=s[1]*Je+s[5]*mt+s[9]*ct+s[13],i[14]=s[2]*Je+s[6]*mt+s[10]*ct+s[14],i[15]=s[3]*Je+s[7]*mt+s[11]*ct+s[15]):(x=s[1],C=s[2],T=s[3],O=s[4],U=s[5],W=s[6],$=s[7],te=s[8],he=s[9],Ee=s[10],Ke=s[11],i[0]=d=s[0],i[1]=x,i[2]=C,i[3]=T,i[4]=O,i[5]=U,i[6]=W,i[7]=$,i[8]=te,i[9]=he,i[10]=Ee,i[11]=Ke,i[12]=d*Je+O*mt+te*ct+s[12],i[13]=x*Je+U*mt+he*ct+s[13],i[14]=C*Je+W*mt+Ee*ct+s[14],i[15]=T*Je+$*mt+Ke*ct+s[15]),i},y.triggerPluginCompletionEvent=di,y.uniqueId=fr,y.validateCustomStyleLayer=function(i){var s=[],l=i.id;return l===void 0&&s.push({message:"layers."+l+': missing required property "id"'}),i.render===void 0&&s.push({message:"layers."+l+': missing required method "render"'}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&s.push({message:"layers."+l+': property "renderingMode" must be either "2d" or "3d"'}),s},y.validateLight=cu,y.validateStyle=Zl,y.values=function(i){var s=[];for(var l in i)s.push(i[l]);return s},y.vectorTile=Zs,y.version="1.13.2",y.warnOnce=Ue,y.webpSupported=on,y.window=we,y.wrap=qt}),ge(["./shared"],function(y){"use strict";function Ne(J){var se=typeof J;if(se==="number"||se==="boolean"||se==="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){for(var _e="[",ke=0,Ye=J;ke<Ye.length;ke+=1)_e+=Ne(Ye[ke])+",";return _e+"]"}for(var ut=Object.keys(J).sort(),xt="{",Ie=0;Ie<ut.length;Ie++)xt+=JSON.stringify(ut[Ie])+":"+Ne(J[ut[Ie]])+",";return xt+"}"}function Q(J){for(var se="",_e=0,ke=y.refProperties;_e<ke.length;_e+=1)se+="/"+Ne(J[ke[_e]]);return se}var Pe=function(J){this.keyCache={},J&&this.replace(J)};Pe.prototype.replace=function(J){this._layerConfigs={},this._layers={},this.update(J,[])},Pe.prototype.update=function(J,se){for(var _e=this,ke=0,Ye=J;ke<Ye.length;ke+=1){var ut=Ye[ke];this._layerConfigs[ut.id]=ut;var xt=this._layers[ut.id]=y.createStyleLayer(ut);xt._featureFilter=y.featureFilter(xt.filter),this.keyCache[ut.id]&&delete this.keyCache[ut.id]}for(var Ie=0,nt=se;Ie<nt.length;Ie+=1){var Ht=nt[Ie];delete this.keyCache[Ht],delete this._layerConfigs[Ht],delete this._layers[Ht]}this.familiesBySource={};for(var jr=0,ir=function(Mr,mn){for(var ea={},Zn=0;Zn<Mr.length;Zn++){var na=mn&&mn[Mr[Zn].id]||Q(Mr[Zn]);mn&&(mn[Mr[Zn].id]=na);var Zt=ea[na];Zt||(Zt=ea[na]=[]),Zt.push(Mr[Zn])}var kt=[];for(var va in ea)kt.push(ea[va]);return kt}(y.values(this._layerConfigs),this.keyCache);jr<ir.length;jr+=1){var pr=ir[jr].map(function(Mr){return _e._layers[Mr.id]}),Hr=pr[0];if(Hr.visibility!=="none"){var oi=Hr.source||"",wn=this.familiesBySource[oi];wn||(wn=this.familiesBySource[oi]={});var rr=Hr.sourceLayer||"_geojsonTileLayer",Wn=wn[rr];Wn||(Wn=wn[rr]=[]),Wn.push(pr)}}};var ve=function(J){var se={},_e=[];for(var ke in J){var Ye=J[ke],ut=se[ke]={};for(var xt in Ye){var Ie=Ye[+xt];if(Ie&&Ie.bitmap.width!==0&&Ie.bitmap.height!==0){var nt={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};_e.push(nt),ut[xt]={rect:nt,metrics:Ie.metrics}}}}var Ht=y.potpack(_e),jr=new y.AlphaImage({width:Ht.w||1,height:Ht.h||1});for(var ir in J){var pr=J[ir];for(var Hr in pr){var oi=pr[+Hr];if(oi&&oi.bitmap.width!==0&&oi.bitmap.height!==0){var wn=se[ir][Hr].rect;y.AlphaImage.copy(oi.bitmap,jr,{x:0,y:0},{x:wn.x+1,y:wn.y+1},oi.bitmap)}}}this.image=jr,this.positions=se};y.register("GlyphAtlas",ve);var lt=function(J){this.tileID=new y.OverscaledTileID(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId};function we(J,se,_e){for(var ke=new y.EvaluationParameters(se),Ye=0,ut=J;Ye<ut.length;Ye+=1)ut[Ye].recalculate(ke,_e)}function We(J,se){var _e=y.getArrayBuffer(J.request,function(ke,Ye,ut,xt){ke?se(ke):Ye&&se(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(Ye)),rawData:Ye,cacheControl:ut,expires:xt})});return function(){_e.cancel(),se()}}lt.prototype.parse=function(J,se,_e,ke,Ye){var ut=this;this.status="parsing",this.data=J,this.collisionBoxArray=new y.CollisionBoxArray;var xt=new y.DictionaryCoder(Object.keys(J.layers).sort()),Ie=new y.FeatureIndex(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];var nt,Ht,jr,ir,pr={},Hr={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:_e},oi=se.familiesBySource[this.source];for(var wn in oi){var rr=J.layers[wn];if(rr){rr.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+wn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Wn=xt.encode(wn),Mr=[],mn=0;mn<rr.length;mn++){var ea=rr.feature(mn),Zn=Ie.getId(ea,wn);Mr.push({feature:ea,id:Zn,index:mn,sourceLayerIndex:Wn})}for(var na=0,Zt=oi[wn];na<Zt.length;na+=1){var kt=Zt[na],va=kt[0];va.minzoom&&this.zoom<Math.floor(va.minzoom)||va.maxzoom&&this.zoom>=va.maxzoom||va.visibility!=="none"&&(we(kt,this.zoom,_e),(pr[va.id]=va.createBucket({index:Ie.bucketLayerIDs.length,layers:kt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wn,sourceID:this.source})).populate(Mr,Hr,this.tileID.canonical),Ie.bucketLayerIDs.push(kt.map(function(Ba){return Ba.id})))}}}var aa=y.mapObject(Hr.glyphDependencies,function(Ba){return Object.keys(Ba).map(Number)});Object.keys(aa).length?ke.send("getGlyphs",{uid:this.uid,stacks:aa},function(Ba,Pr){nt||(nt=Ba,Ht=Pr,go.call(ut))}):Ht={};var Fi=Object.keys(Hr.iconDependencies);Fi.length?ke.send("getImages",{icons:Fi,source:this.source,tileID:this.tileID,type:"icons"},function(Ba,Pr){nt||(nt=Ba,jr=Pr,go.call(ut))}):jr={};var Mi=Object.keys(Hr.patternDependencies);function go(){if(nt)return Ye(nt);if(Ht&&jr&&ir){var Ba=new ve(Ht),Pr=new y.ImageAtlas(jr,ir);for(var Or in pr){var Et=pr[Or];Et instanceof y.SymbolBucket?(we(Et.layers,this.zoom,_e),y.performSymbolLayout(Et,Ht,Ba.positions,jr,Pr.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Et.hasPattern&&(Et instanceof y.LineBucket||Et instanceof y.FillBucket||Et instanceof y.FillExtrusionBucket)&&(we(Et.layers,this.zoom,_e),Et.addFeatures(Hr,this.tileID.canonical,Pr.patternPositions))}this.status="done",Ye(null,{buckets:y.values(pr).filter(function(ss){return!ss.isEmpty()}),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ba.image,imageAtlas:Pr,glyphMap:this.returnDependencies?Ht:null,iconMap:this.returnDependencies?jr:null,glyphPositions:this.returnDependencies?Ba.positions:null})}}Mi.length?ke.send("getImages",{icons:Mi,source:this.source,tileID:this.tileID,type:"patterns"},function(Ba,Pr){nt||(nt=Ba,ir=Pr,go.call(ut))}):ir={},go.call(this)};var St=function(J,se,_e,ke){this.actor=J,this.layerIndex=se,this.availableImages=_e,this.loadVectorData=ke||We,this.loading={},this.loaded={}};St.prototype.loadTile=function(J,se){var _e=this,ke=J.uid;this.loading||(this.loading={});var Ye=!!(J&&J.request&&J.request.collectResourceTiming)&&new y.RequestPerformance(J.request),ut=this.loading[ke]=new lt(J);ut.abort=this.loadVectorData(J,function(xt,Ie){if(delete _e.loading[ke],xt||!Ie)return ut.status="done",_e.loaded[ke]=ut,se(xt);var nt=Ie.rawData,Ht={};Ie.expires&&(Ht.expires=Ie.expires),Ie.cacheControl&&(Ht.cacheControl=Ie.cacheControl);var jr={};if(Ye){var ir=Ye.finish();ir&&(jr.resourceTiming=JSON.parse(JSON.stringify(ir)))}ut.vectorTile=Ie.vectorTile,ut.parse(Ie.vectorTile,_e.layerIndex,_e.availableImages,_e.actor,function(pr,Hr){if(pr||!Hr)return se(pr);se(null,y.extend({rawTileData:nt.slice(0)},Hr,Ht,jr))}),_e.loaded=_e.loaded||{},_e.loaded[ke]=ut})},St.prototype.reloadTile=function(J,se){var _e=this,ke=this.loaded,Ye=J.uid,ut=this;if(ke&&ke[Ye]){var xt=ke[Ye];xt.showCollisionBoxes=J.showCollisionBoxes;var Ie=function(nt,Ht){var jr=xt.reloadCallback;jr&&(delete xt.reloadCallback,xt.parse(xt.vectorTile,ut.layerIndex,_e.availableImages,ut.actor,jr)),se(nt,Ht)};xt.status==="parsing"?xt.reloadCallback=Ie:xt.status==="done"&&(xt.vectorTile?xt.parse(xt.vectorTile,this.layerIndex,this.availableImages,this.actor,Ie):Ie())}},St.prototype.abortTile=function(J,se){var _e=this.loading,ke=J.uid;_e&&_e[ke]&&_e[ke].abort&&(_e[ke].abort(),delete _e[ke]),se()},St.prototype.removeTile=function(J,se){var _e=this.loaded,ke=J.uid;_e&&_e[ke]&&delete _e[ke],se()};var Rt=y.window.ImageBitmap,tr=function(){this.loaded={}};function qt(J,se){if(J.length!==0){Yt(J[0],se);for(var _e=1;_e<J.length;_e++)Yt(J[_e],!se)}}function Yt(J,se){for(var _e=0,ke=0,Ye=J.length,ut=Ye-1;ke<Ye;ut=ke++)_e+=(J[ke][0]-J[ut][0])*(J[ut][1]+J[ke][1]);_e>=0!=!!se&&J.reverse()}tr.prototype.loadTile=function(J,se){var _e=J.uid,ke=J.encoding,Ye=J.rawImageData,ut=Rt&&Ye instanceof Rt?this.getImageData(Ye):Ye,xt=new y.DEMData(_e,ut,ke);this.loaded=this.loaded||{},this.loaded[_e]=xt,se(null,xt)},tr.prototype.getImageData=function(J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);var se=this.offscreenCanvasContext.getImageData(-1,-1,J.width+2,J.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:se.width,height:se.height},se.data)},tr.prototype.removeTile=function(J){var se=this.loaded,_e=J.uid;se&&se[_e]&&delete se[_e]};var Sr=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,fr=function(J){this._feature=J,this.extent=y.EXTENT,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))};fr.prototype.loadGeometry=function(){if(this._feature.type===1){for(var J=[],se=0,_e=this._feature.geometry;se<_e.length;se+=1){var ke=_e[se];J.push([new y.Point$1(ke[0],ke[1])])}return J}for(var Ye=[],ut=0,xt=this._feature.geometry;ut<xt.length;ut+=1){for(var Ie=[],nt=0,Ht=xt[ut];nt<Ht.length;nt+=1){var jr=Ht[nt];Ie.push(new y.Point$1(jr[0],jr[1]))}Ye.push(Ie)}return Ye},fr.prototype.toGeoJSON=function(J,se,_e){return Sr.call(this,J,se,_e)};var It=function(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=J.length,this._features=J};It.prototype.feature=function(J){return new fr(this._features[J])};var jt=y.vectorTile.VectorTileFeature,Rr=ie;function ie(J,se){this.options=se||{},this.features=J,this.length=J.length}function _r(J,se){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=se||4096}ie.prototype.feature=function(J){return new _r(this.features[J],this.options.extent)},_r.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var se=0;se<J.length;se++){for(var _e=J[se],ke=[],Ye=0;Ye<_e.length;Ye++)ke.push(new y.Point$1(_e[Ye][0],_e[Ye][1]));this.geometry.push(ke)}return this.geometry},_r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,se=1/0,_e=-1/0,ke=1/0,Ye=-1/0,ut=0;ut<J.length;ut++)for(var xt=J[ut],Ie=0;Ie<xt.length;Ie++){var nt=xt[Ie];se=Math.min(se,nt.x),_e=Math.max(_e,nt.x),ke=Math.min(ke,nt.y),Ye=Math.max(Ye,nt.y)}return[se,ke,_e,Ye]},_r.prototype.toGeoJSON=jt.prototype.toGeoJSON;var Ot=Qt,yt=Rr;function Qt(J){var se=new y.pbf;return function(_e,ke){for(var Ye in _e.layers)ke.writeMessage(3,Ue,_e.layers[Ye])}(J,se),se.finish()}function Ue(J,se){var _e;se.writeVarintField(15,J.version||1),se.writeStringField(1,J.name||""),se.writeVarintField(5,J.extent||4096);var ke={keys:[],values:[],keycache:{},valuecache:{}};for(_e=0;_e<J.length;_e++)ke.feature=J.feature(_e),se.writeMessage(2,Ar,ke);var Ye=ke.keys;for(_e=0;_e<Ye.length;_e++)se.writeStringField(3,Ye[_e]);var ut=ke.values;for(_e=0;_e<ut.length;_e++)se.writeMessage(4,ae,ut[_e])}function Ar(J,se){var _e=J.feature;_e.id!==void 0&&se.writeVarintField(1,_e.id),se.writeMessage(2,an,J),se.writeVarintField(3,_e.type),se.writeMessage(4,X,_e)}function an(J,se){var _e=J.feature,ke=J.keys,Ye=J.values,ut=J.keycache,xt=J.valuecache;for(var Ie in _e.properties){var nt=ut[Ie];nt===void 0&&(ke.push(Ie),ut[Ie]=nt=ke.length-1),se.writeVarint(nt);var Ht=_e.properties[Ie],jr=typeof Ht;jr!=="string"&&jr!=="boolean"&&jr!=="number"&&(Ht=JSON.stringify(Ht));var ir=jr+":"+Ht,pr=xt[ir];pr===void 0&&(Ye.push(Ht),xt[ir]=pr=Ye.length-1),se.writeVarint(pr)}}function fe(J,se){return(se<<3)+(7&J)}function rt(J){return J<<1^J>>31}function X(J,se){for(var _e=J.loadGeometry(),ke=J.type,Ye=0,ut=0,xt=_e.length,Ie=0;Ie<xt;Ie++){var nt=_e[Ie],Ht=1;ke===1&&(Ht=nt.length),se.writeVarint(fe(1,Ht));for(var jr=ke===3?nt.length-1:nt.length,ir=0;ir<jr;ir++){ir===1&&ke!==1&&se.writeVarint(fe(2,jr-1));var pr=nt[ir].x-Ye,Hr=nt[ir].y-ut;se.writeVarint(rt(pr)),se.writeVarint(rt(Hr)),Ye+=pr,ut+=Hr}ke===3&&se.writeVarint(fe(7,1))}}function ae(J,se){var _e=typeof J;_e==="string"?se.writeStringField(1,J):_e==="boolean"?se.writeBooleanField(7,J):_e==="number"&&(J%1!=0?se.writeDoubleField(3,J):J<0?se.writeSVarintField(6,J):se.writeVarintField(5,J))}function ze(J,se,_e,ke){At(J,_e,ke),At(se,2*_e,2*ke),At(se,2*_e+1,2*ke+1)}function At(J,se,_e){var ke=J[se];J[se]=J[_e],J[_e]=ke}function Ft(J,se,_e,ke){var Ye=J-_e,ut=se-ke;return Ye*Ye+ut*ut}Ot.fromVectorTileJs=Qt,Ot.fromGeojsonVt=function(J,se){se=se||{};var _e={};for(var ke in J)_e[ke]=new Rr(J[ke].features,se),_e[ke].name=ke,_e[ke].version=se.version,_e[ke].extent=se.extent;return Qt({layers:_e})},Ot.GeoJSONWrapper=yt;var ur=function(J){return J[0]},Tt=function(J){return J[1]},Br=function(J,se,_e,ke,Ye){se===void 0&&(se=ur),_e===void 0&&(_e=Tt),ke===void 0&&(ke=64),Ye===void 0&&(Ye=Float64Array),this.nodeSize=ke,this.points=J;for(var ut=J.length<65536?Uint16Array:Uint32Array,xt=this.ids=new ut(J.length),Ie=this.coords=new Ye(2*J.length),nt=0;nt<J.length;nt++)xt[nt]=nt,Ie[2*nt]=se(J[nt]),Ie[2*nt+1]=_e(J[nt]);(function Ht(jr,ir,pr,Hr,oi,wn){if(!(oi-Hr<=pr)){var rr=Hr+oi>>1;(function Wn(Mr,mn,ea,Zn,na,Zt){for(;na>Zn;){if(na-Zn>600){var kt=na-Zn+1,va=ea-Zn+1,aa=Math.log(kt),Fi=.5*Math.exp(2*aa/3),Mi=.5*Math.sqrt(aa*Fi*(kt-Fi)/kt)*(va-kt/2<0?-1:1);Wn(Mr,mn,ea,Math.max(Zn,Math.floor(ea-va*Fi/kt+Mi)),Math.min(na,Math.floor(ea+(kt-va)*Fi/kt+Mi)),Zt)}var go=mn[2*ea+Zt],Ba=Zn,Pr=na;for(ze(Mr,mn,Zn,ea),mn[2*na+Zt]>go&&ze(Mr,mn,Zn,na);Ba<Pr;){for(ze(Mr,mn,Ba,Pr),Ba++,Pr--;mn[2*Ba+Zt]<go;)Ba++;for(;mn[2*Pr+Zt]>go;)Pr--}mn[2*Zn+Zt]===go?ze(Mr,mn,Zn,Pr):ze(Mr,mn,++Pr,na),Pr<=ea&&(Zn=Pr+1),ea<=Pr&&(na=Pr-1)}})(jr,ir,rr,Hr,oi,wn%2),Ht(jr,ir,pr,Hr,rr-1,wn+1),Ht(jr,ir,pr,rr+1,oi,wn+1)}})(xt,Ie,ke,0,xt.length-1,0)};Br.prototype.range=function(J,se,_e,ke){return function(Ye,ut,xt,Ie,nt,Ht,jr){for(var ir,pr,Hr=[0,Ye.length-1,0],oi=[];Hr.length;){var wn=Hr.pop(),rr=Hr.pop(),Wn=Hr.pop();if(rr-Wn<=jr)for(var Mr=Wn;Mr<=rr;Mr++)pr=ut[2*Mr+1],(ir=ut[2*Mr])>=xt&&ir<=nt&&pr>=Ie&&pr<=Ht&&oi.push(Ye[Mr]);else{var mn=Math.floor((Wn+rr)/2);pr=ut[2*mn+1],(ir=ut[2*mn])>=xt&&ir<=nt&&pr>=Ie&&pr<=Ht&&oi.push(Ye[mn]);var ea=(wn+1)%2;(wn===0?xt<=ir:Ie<=pr)&&(Hr.push(Wn),Hr.push(mn-1),Hr.push(ea)),(wn===0?nt>=ir:Ht>=pr)&&(Hr.push(mn+1),Hr.push(rr),Hr.push(ea))}}return oi}(this.ids,this.coords,J,se,_e,ke,this.nodeSize)},Br.prototype.within=function(J,se,_e){return function(ke,Ye,ut,xt,Ie,nt){for(var Ht=[0,ke.length-1,0],jr=[],ir=Ie*Ie;Ht.length;){var pr=Ht.pop(),Hr=Ht.pop(),oi=Ht.pop();if(Hr-oi<=nt)for(var wn=oi;wn<=Hr;wn++)Ft(Ye[2*wn],Ye[2*wn+1],ut,xt)<=ir&&jr.push(ke[wn]);else{var rr=Math.floor((oi+Hr)/2),Wn=Ye[2*rr],Mr=Ye[2*rr+1];Ft(Wn,Mr,ut,xt)<=ir&&jr.push(ke[rr]);var mn=(pr+1)%2;(pr===0?ut-Ie<=Wn:xt-Ie<=Mr)&&(Ht.push(oi),Ht.push(rr-1),Ht.push(mn)),(pr===0?ut+Ie>=Wn:xt+Ie>=Mr)&&(Ht.push(rr+1),Ht.push(Hr),Ht.push(mn))}}return jr}(this.ids,this.coords,J,se,_e,this.nodeSize)};var Bn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(J){return J}},Sn=function(J){this.options=ga(Object.create(Bn),J),this.trees=new Array(this.options.maxZoom+1)};function Li(J,se,_e,ke,Ye){return{x:J,y:se,zoom:1/0,id:_e,parentId:-1,numPoints:ke,properties:Ye}}function gi(J,se){var _e=J.geometry.coordinates,ke=_e[1];return{x:ra(_e[0]),y:Vi(ke),zoom:1/0,index:se,parentId:-1}}function on(J){return{type:"Feature",id:J.id,properties:Xa(J),geometry:{type:"Point",coordinates:[(ke=J.x,360*(ke-.5)),(se=J.y,_e=(180-360*se)*Math.PI/180,360*Math.atan(Math.exp(_e))/Math.PI-90)]}};var se,_e,ke}function Xa(J){var se=J.numPoints,_e=se>=1e4?Math.round(se/1e3)+"k":se>=1e3?Math.round(se/100)/10+"k":se;return ga(ga({},J.properties),{cluster:!0,cluster_id:J.id,point_count:se,point_count_abbreviated:_e})}function ra(J){return J/360+.5}function Vi(J){var se=Math.sin(J*Math.PI/180),_e=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return _e<0?0:_e>1?1:_e}function ga(J,se){for(var _e in se)J[_e]=se[_e];return J}function fi(J){return J.x}function $i(J){return J.y}function hi(J,se,_e,ke,Ye,ut){var xt=Ye-_e,Ie=ut-ke;if(xt!==0||Ie!==0){var nt=((J-_e)*xt+(se-ke)*Ie)/(xt*xt+Ie*Ie);nt>1?(_e=Ye,ke=ut):nt>0&&(_e+=xt*nt,ke+=Ie*nt)}return(xt=J-_e)*xt+(Ie=se-ke)*Ie}function yi(J,se,_e,ke){var Ye={id:J===void 0?null:J,type:se,geometry:_e,tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ut){var xt=ut.geometry,Ie=ut.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")os(ut,xt);else if(Ie==="Polygon"||Ie==="MultiLineString")for(var nt=0;nt<xt.length;nt++)os(ut,xt[nt]);else if(Ie==="MultiPolygon")for(nt=0;nt<xt.length;nt++)for(var Ht=0;Ht<xt[nt].length;Ht++)os(ut,xt[nt][Ht])}(Ye),Ye}function os(J,se){for(var _e=0;_e<se.length;_e+=3)J.minX=Math.min(J.minX,se[_e]),J.minY=Math.min(J.minY,se[_e+1]),J.maxX=Math.max(J.maxX,se[_e]),J.maxY=Math.max(J.maxY,se[_e+1])}function mo(J,se,_e,ke){if(se.geometry){var Ye=se.geometry.coordinates,ut=se.geometry.type,xt=Math.pow(_e.tolerance/((1<<_e.maxZoom)*_e.extent),2),Ie=[],nt=se.id;if(_e.promoteId?nt=se.properties[_e.promoteId]:_e.generateId&&(nt=ke||0),ut==="Point")Ya(Ye,Ie);else if(ut==="MultiPoint")for(var Ht=0;Ht<Ye.length;Ht++)Ya(Ye[Ht],Ie);else if(ut==="LineString")Pt(Ye,Ie,xt,!1);else if(ut==="MultiLineString"){if(_e.lineMetrics){for(Ht=0;Ht<Ye.length;Ht++)Pt(Ye[Ht],Ie=[],xt,!1),J.push(yi(nt,"LineString",Ie,se.properties));return}xe(Ye,Ie,xt,!1)}else if(ut==="Polygon")xe(Ye,Ie,xt,!0);else{if(ut!=="MultiPolygon"){if(ut==="GeometryCollection"){for(Ht=0;Ht<se.geometry.geometries.length;Ht++)mo(J,{id:nt,geometry:se.geometry.geometries[Ht],properties:se.properties},_e,ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ht=0;Ht<Ye.length;Ht++){var jr=[];xe(Ye[Ht],jr,xt,!0),Ie.push(jr)}}J.push(yi(nt,ut,Ie,se.properties))}}function Ya(J,se){se.push(ce(J[0])),se.push(Te(J[1])),se.push(0)}function Pt(J,se,_e,ke){for(var Ye,ut,xt=0,Ie=0;Ie<J.length;Ie++){var nt=ce(J[Ie][0]),Ht=Te(J[Ie][1]);se.push(nt),se.push(Ht),se.push(0),Ie>0&&(xt+=ke?(Ye*Ht-nt*ut)/2:Math.sqrt(Math.pow(nt-Ye,2)+Math.pow(Ht-ut,2))),Ye=nt,ut=Ht}var jr=se.length-3;se[2]=1,function ir(pr,Hr,oi,wn){for(var rr,Wn=wn,Mr=oi-Hr>>1,mn=oi-Hr,ea=pr[Hr],Zn=pr[Hr+1],na=pr[oi],Zt=pr[oi+1],kt=Hr+3;kt<oi;kt+=3){var va=hi(pr[kt],pr[kt+1],ea,Zn,na,Zt);if(va>Wn)rr=kt,Wn=va;else if(va===Wn){var aa=Math.abs(kt-Mr);aa<mn&&(rr=kt,mn=aa)}}Wn>wn&&(rr-Hr>3&&ir(pr,Hr,rr,wn),pr[rr+2]=Wn,oi-rr>3&&ir(pr,rr,oi,wn))}(se,0,jr,_e),se[jr+2]=1,se.size=Math.abs(xt),se.start=0,se.end=se.size}function xe(J,se,_e,ke){for(var Ye=0;Ye<J.length;Ye++){var ut=[];Pt(J[Ye],ut,_e,ke),se.push(ut)}}function ce(J){return J/360+.5}function Te(J){var se=Math.sin(J*Math.PI/180),_e=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return _e<0?0:_e>1?1:_e}function j(J,se,_e,ke,Ye,ut,xt,Ie){if(ke/=se,ut>=(_e/=se)&&xt<ke)return J;if(xt<_e||ut>=ke)return null;for(var nt=[],Ht=0;Ht<J.length;Ht++){var jr=J[Ht],ir=jr.geometry,pr=jr.type,Hr=Ye===0?jr.minX:jr.minY,oi=Ye===0?jr.maxX:jr.maxY;if(Hr>=_e&&oi<ke)nt.push(jr);else if(!(oi<_e||Hr>=ke)){var wn=[];if(pr==="Point"||pr==="MultiPoint")st(ir,wn,_e,ke,Ye);else if(pr==="LineString")ar(ir,wn,_e,ke,Ye,!1,Ie.lineMetrics);else if(pr==="MultiLineString")tt(ir,wn,_e,ke,Ye,!1);else if(pr==="Polygon")tt(ir,wn,_e,ke,Ye,!0);else if(pr==="MultiPolygon")for(var rr=0;rr<ir.length;rr++){var Wn=[];tt(ir[rr],Wn,_e,ke,Ye,!0),Wn.length&&wn.push(Wn)}if(wn.length){if(Ie.lineMetrics&&pr==="LineString"){for(rr=0;rr<wn.length;rr++)nt.push(yi(jr.id,pr,wn[rr],jr.tags));continue}pr!=="LineString"&&pr!=="MultiLineString"||(wn.length===1?(pr="LineString",wn=wn[0]):pr="MultiLineString"),pr!=="Point"&&pr!=="MultiPoint"||(pr=wn.length===3?"Point":"MultiPoint"),nt.push(yi(jr.id,pr,wn,jr.tags))}}}return nt.length?nt:null}function st(J,se,_e,ke,Ye){for(var ut=0;ut<J.length;ut+=3){var xt=J[ut+Ye];xt>=_e&&xt<=ke&&(se.push(J[ut]),se.push(J[ut+1]),se.push(J[ut+2]))}}function ar(J,se,_e,ke,Ye,ut,xt){for(var Ie,nt,Ht=Jr(J),jr=Ye===0?xr:Cr,ir=J.start,pr=0;pr<J.length-3;pr+=3){var Hr=J[pr],oi=J[pr+1],wn=J[pr+2],rr=J[pr+3],Wn=J[pr+4],Mr=Ye===0?Hr:oi,mn=Ye===0?rr:Wn,ea=!1;xt&&(Ie=Math.sqrt(Math.pow(Hr-rr,2)+Math.pow(oi-Wn,2))),Mr<_e?mn>_e&&(nt=jr(Ht,Hr,oi,rr,Wn,_e),xt&&(Ht.start=ir+Ie*nt)):Mr>ke?mn<ke&&(nt=jr(Ht,Hr,oi,rr,Wn,ke),xt&&(Ht.start=ir+Ie*nt)):Ut(Ht,Hr,oi,wn),mn<_e&&Mr>=_e&&(nt=jr(Ht,Hr,oi,rr,Wn,_e),ea=!0),mn>ke&&Mr<=ke&&(nt=jr(Ht,Hr,oi,rr,Wn,ke),ea=!0),!ut&&ea&&(xt&&(Ht.end=ir+Ie*nt),se.push(Ht),Ht=Jr(J)),xt&&(ir+=Ie)}var Zn=J.length-3;Hr=J[Zn],oi=J[Zn+1],wn=J[Zn+2],(Mr=Ye===0?Hr:oi)>=_e&&Mr<=ke&&Ut(Ht,Hr,oi,wn),Zn=Ht.length-3,ut&&Zn>=3&&(Ht[Zn]!==Ht[0]||Ht[Zn+1]!==Ht[1])&&Ut(Ht,Ht[0],Ht[1],Ht[2]),Ht.length&&se.push(Ht)}function Jr(J){var se=[];return se.size=J.size,se.start=J.start,se.end=J.end,se}function tt(J,se,_e,ke,Ye,ut){for(var xt=0;xt<J.length;xt++)ar(J[xt],se,_e,ke,Ye,ut,!1)}function Ut(J,se,_e,ke){J.push(se),J.push(_e),J.push(ke)}function xr(J,se,_e,ke,Ye,ut){var xt=(ut-se)/(ke-se);return J.push(ut),J.push(_e+(Ye-_e)*xt),J.push(1),xt}function Cr(J,se,_e,ke,Ye,ut){var xt=(ut-_e)/(Ye-_e);return J.push(se+(ke-se)*xt),J.push(ut),J.push(1),xt}function Lr(J,se){for(var _e=[],ke=0;ke<J.length;ke++){var Ye,ut=J[ke],xt=ut.type;if(xt==="Point"||xt==="MultiPoint"||xt==="LineString")Ye=vn(ut.geometry,se);else if(xt==="MultiLineString"||xt==="Polygon"){Ye=[];for(var Ie=0;Ie<ut.geometry.length;Ie++)Ye.push(vn(ut.geometry[Ie],se))}else if(xt==="MultiPolygon")for(Ye=[],Ie=0;Ie<ut.geometry.length;Ie++){for(var nt=[],Ht=0;Ht<ut.geometry[Ie].length;Ht++)nt.push(vn(ut.geometry[Ie][Ht],se));Ye.push(nt)}_e.push(yi(ut.id,xt,Ye,ut.tags))}return _e}function vn(J,se){var _e=[];_e.size=J.size,J.start!==void 0&&(_e.start=J.start,_e.end=J.end);for(var ke=0;ke<J.length;ke+=3)_e.push(J[ke]+se,J[ke+1],J[ke+2]);return _e}function vi(J,se){if(J.transformed)return J;var _e,ke,Ye,ut=1<<J.z,xt=J.x,Ie=J.y;for(_e=0;_e<J.features.length;_e++){var nt=J.features[_e],Ht=nt.geometry,jr=nt.type;if(nt.geometry=[],jr===1)for(ke=0;ke<Ht.length;ke+=2)nt.geometry.push(ni(Ht[ke],Ht[ke+1],se,ut,xt,Ie));else for(ke=0;ke<Ht.length;ke++){var ir=[];for(Ye=0;Ye<Ht[ke].length;Ye+=2)ir.push(ni(Ht[ke][Ye],Ht[ke][Ye+1],se,ut,xt,Ie));nt.geometry.push(ir)}}return J.transformed=!0,J}function ni(J,se,_e,ke,Ye,ut){return[Math.round(_e*(J*ke-Ye)),Math.round(_e*(se*ke-ut))]}function An(J,se,_e,ke,Ye){for(var ut=se===Ye.maxZoom?0:Ye.tolerance/((1<<se)*Ye.extent),xt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:_e,y:ke,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ie=0;Ie<J.length;Ie++){xt.numFeatures++,Oi(xt,J[Ie],ut,Ye);var nt=J[Ie].minX,Ht=J[Ie].minY,jr=J[Ie].maxX,ir=J[Ie].maxY;nt<xt.minX&&(xt.minX=nt),Ht<xt.minY&&(xt.minY=Ht),jr>xt.maxX&&(xt.maxX=jr),ir>xt.maxY&&(xt.maxY=ir)}return xt}function Oi(J,se,_e,ke){var Ye=se.geometry,ut=se.type,xt=[];if(ut==="Point"||ut==="MultiPoint")for(var Ie=0;Ie<Ye.length;Ie+=3)xt.push(Ye[Ie]),xt.push(Ye[Ie+1]),J.numPoints++,J.numSimplified++;else if(ut==="LineString")zi(xt,Ye,J,_e,!1,!1);else if(ut==="MultiLineString"||ut==="Polygon")for(Ie=0;Ie<Ye.length;Ie++)zi(xt,Ye[Ie],J,_e,ut==="Polygon",Ie===0);else if(ut==="MultiPolygon")for(var nt=0;nt<Ye.length;nt++){var Ht=Ye[nt];for(Ie=0;Ie<Ht.length;Ie++)zi(xt,Ht[Ie],J,_e,!0,Ie===0)}if(xt.length){var jr=se.tags||null;if(ut==="LineString"&&ke.lineMetrics){for(var ir in jr={},se.tags)jr[ir]=se.tags[ir];jr.mapbox_clip_start=Ye.start/Ye.size,jr.mapbox_clip_end=Ye.end/Ye.size}var pr={geometry:xt,type:ut==="Polygon"||ut==="MultiPolygon"?3:ut==="LineString"||ut==="MultiLineString"?2:1,tags:jr};se.id!==null&&(pr.id=se.id),J.features.push(pr)}}function zi(J,se,_e,ke,Ye,ut){var xt=ke*ke;if(ke>0&&se.size<(Ye?xt:ke))_e.numPoints+=se.length/3;else{for(var Ie=[],nt=0;nt<se.length;nt+=3)(ke===0||se[nt+2]>xt)&&(_e.numSimplified++,Ie.push(se[nt]),Ie.push(se[nt+1])),_e.numPoints++;Ye&&function(Ht,jr){for(var ir=0,pr=0,Hr=Ht.length,oi=Hr-2;pr<Hr;oi=pr,pr+=2)ir+=(Ht[pr]-Ht[oi])*(Ht[pr+1]+Ht[oi+1]);if(ir>0===jr)for(pr=0,Hr=Ht.length;pr<Hr/2;pr+=2){var wn=Ht[pr],rr=Ht[pr+1];Ht[pr]=Ht[Hr-2-pr],Ht[pr+1]=Ht[Hr-1-pr],Ht[Hr-2-pr]=wn,Ht[Hr-1-pr]=rr}}(Ie,ut),J.push(Ie)}}function Pa(J,se){var _e=(se=this.options=function(Ye,ut){for(var xt in ut)Ye[xt]=ut[xt];return Ye}(Object.create(this.options),se)).debug;if(_e&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");var ke=function(Ye,ut){var xt=[];if(Ye.type==="FeatureCollection")for(var Ie=0;Ie<Ye.features.length;Ie++)mo(xt,Ye.features[Ie],ut,Ie);else mo(xt,Ye.type==="Feature"?Ye:{geometry:Ye},ut);return xt}(J,se);this.tiles={},this.tileCoords=[],_e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ke=function(Ye,ut){var xt=ut.buffer/ut.extent,Ie=Ye,nt=j(Ye,1,-1-xt,xt,0,-1,2,ut),Ht=j(Ye,1,1-xt,2+xt,0,-1,2,ut);return(nt||Ht)&&(Ie=j(Ye,1,-xt,1+xt,0,-1,2,ut)||[],nt&&(Ie=Lr(nt,1).concat(Ie)),Ht&&(Ie=Ie.concat(Lr(Ht,-1)))),Ie}(ke,se)).length&&this.splitTile(ke,0,0,0),_e&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ia(J,se,_e){return 32*((1<<J)*_e+se)+J}function ao(J,se){var _e=J.tileID.canonical;if(!this._geoJSONIndex)return se(null,null);var ke=this._geoJSONIndex.getTile(_e.z,_e.x,_e.y);if(!ke)return se(null,null);var Ye=new It(ke.features),ut=Ot(Ye);ut.byteOffset===0&&ut.byteLength===ut.buffer.byteLength||(ut=new Uint8Array(ut)),se(null,{vectorTile:Ye,rawData:ut.buffer})}Sn.prototype.load=function(J){var se=this.options,_e=se.log,ke=se.minZoom,Ye=se.maxZoom,ut=se.nodeSize;_e&&console.time("total time");var xt="prepare "+J.length+" points";_e&&console.time(xt),this.points=J;for(var Ie=[],nt=0;nt<J.length;nt++)J[nt].geometry&&Ie.push(gi(J[nt],nt));this.trees[Ye+1]=new Br(Ie,fi,$i,ut,Float32Array),_e&&console.timeEnd(xt);for(var Ht=Ye;Ht>=ke;Ht--){var jr=+Date.now();Ie=this._cluster(Ie,Ht),this.trees[Ht]=new Br(Ie,fi,$i,ut,Float32Array),_e&&console.log("z%d: %d clusters in %dms",Ht,Ie.length,+Date.now()-jr)}return _e&&console.timeEnd("total time"),this},Sn.prototype.getClusters=function(J,se){var _e=((J[0]+180)%360+360)%360-180,ke=Math.max(-90,Math.min(90,J[1])),Ye=J[2]===180?180:((J[2]+180)%360+360)%360-180,ut=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)_e=-180,Ye=180;else if(_e>Ye){var xt=this.getClusters([_e,ke,180,ut],se),Ie=this.getClusters([-180,ke,Ye,ut],se);return xt.concat(Ie)}for(var nt=this.trees[this._limitZoom(se)],Ht=[],jr=0,ir=nt.range(ra(_e),Vi(ut),ra(Ye),Vi(ke));jr<ir.length;jr+=1){var pr=nt.points[ir[jr]];Ht.push(pr.numPoints?on(pr):this.points[pr.index])}return Ht},Sn.prototype.getChildren=function(J){var se=this._getOriginId(J),_e=this._getOriginZoom(J),ke="No cluster with the specified id.",Ye=this.trees[_e];if(!Ye)throw new Error(ke);var ut=Ye.points[se];if(!ut)throw new Error(ke);for(var xt=this.options.radius/(this.options.extent*Math.pow(2,_e-1)),Ie=[],nt=0,Ht=Ye.within(ut.x,ut.y,xt);nt<Ht.length;nt+=1){var jr=Ye.points[Ht[nt]];jr.parentId===J&&Ie.push(jr.numPoints?on(jr):this.points[jr.index])}if(Ie.length===0)throw new Error(ke);return Ie},Sn.prototype.getLeaves=function(J,se,_e){var ke=[];return this._appendLeaves(ke,J,se=se||10,_e=_e||0,0),ke},Sn.prototype.getTile=function(J,se,_e){var ke=this.trees[this._limitZoom(J)],Ye=Math.pow(2,J),ut=this.options,xt=ut.radius/ut.extent,Ie=(_e-xt)/Ye,nt=(_e+1+xt)/Ye,Ht={features:[]};return this._addTileFeatures(ke.range((se-xt)/Ye,Ie,(se+1+xt)/Ye,nt),ke.points,se,_e,Ye,Ht),se===0&&this._addTileFeatures(ke.range(1-xt/Ye,Ie,1,nt),ke.points,Ye,_e,Ye,Ht),se===Ye-1&&this._addTileFeatures(ke.range(0,Ie,xt/Ye,nt),ke.points,-1,_e,Ye,Ht),Ht.features.length?Ht:null},Sn.prototype.getClusterExpansionZoom=function(J){for(var se=this._getOriginZoom(J)-1;se<=this.options.maxZoom;){var _e=this.getChildren(J);if(se++,_e.length!==1)break;J=_e[0].properties.cluster_id}return se},Sn.prototype._appendLeaves=function(J,se,_e,ke,Ye){for(var ut=0,xt=this.getChildren(se);ut<xt.length;ut+=1){var Ie=xt[ut],nt=Ie.properties;if(nt&&nt.cluster?Ye+nt.point_count<=ke?Ye+=nt.point_count:Ye=this._appendLeaves(J,nt.cluster_id,_e,ke,Ye):Ye<ke?Ye++:J.push(Ie),J.length===_e)break}return Ye},Sn.prototype._addTileFeatures=function(J,se,_e,ke,Ye,ut){for(var xt=0,Ie=J;xt<Ie.length;xt+=1){var nt=se[Ie[xt]],Ht=nt.numPoints,jr={type:1,geometry:[[Math.round(this.options.extent*(nt.x*Ye-_e)),Math.round(this.options.extent*(nt.y*Ye-ke))]],tags:Ht?Xa(nt):this.points[nt.index].properties},ir=void 0;Ht?ir=nt.id:this.options.generateId?ir=nt.index:this.points[nt.index].id&&(ir=this.points[nt.index].id),ir!==void 0&&(jr.id=ir),ut.features.push(jr)}},Sn.prototype._limitZoom=function(J){return Math.max(this.options.minZoom,Math.min(+J,this.options.maxZoom+1))},Sn.prototype._cluster=function(J,se){for(var _e=[],ke=this.options,Ye=ke.reduce,ut=ke.minPoints,xt=ke.radius/(ke.extent*Math.pow(2,se)),Ie=0;Ie<J.length;Ie++){var nt=J[Ie];if(!(nt.zoom<=se)){nt.zoom=se;for(var Ht=this.trees[se+1],jr=Ht.within(nt.x,nt.y,xt),ir=nt.numPoints||1,pr=ir,Hr=0,oi=jr;Hr<oi.length;Hr+=1){var wn=Ht.points[oi[Hr]];wn.zoom>se&&(pr+=wn.numPoints||1)}if(pr>=ut){for(var rr=nt.x*ir,Wn=nt.y*ir,Mr=Ye&&ir>1?this._map(nt,!0):null,mn=(Ie<<5)+(se+1)+this.points.length,ea=0,Zn=jr;ea<Zn.length;ea+=1){var na=Ht.points[Zn[ea]];if(!(na.zoom<=se)){na.zoom=se;var Zt=na.numPoints||1;rr+=na.x*Zt,Wn+=na.y*Zt,na.parentId=mn,Ye&&(Mr||(Mr=this._map(nt,!0)),Ye(Mr,this._map(na)))}}nt.parentId=mn,_e.push(Li(rr/pr,Wn/pr,mn,pr,Mr))}else if(_e.push(nt),pr>1)for(var kt=0,va=jr;kt<va.length;kt+=1){var aa=Ht.points[va[kt]];aa.zoom<=se||(aa.zoom=se,_e.push(aa))}}}return _e},Sn.prototype._getOriginId=function(J){return J-this.points.length>>5},Sn.prototype._getOriginZoom=function(J){return(J-this.points.length)%32},Sn.prototype._map=function(J,se){if(J.numPoints)return se?ga({},J.properties):J.properties;var _e=this.points[J.index].properties,ke=this.options.map(_e);return se&&ke===_e?ga({},ke):ke},Pa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Pa.prototype.splitTile=function(J,se,_e,ke,Ye,ut,xt){for(var Ie=[J,se,_e,ke],nt=this.options,Ht=nt.debug;Ie.length;){ke=Ie.pop(),_e=Ie.pop(),se=Ie.pop(),J=Ie.pop();var jr=1<<se,ir=ia(se,_e,ke),pr=this.tiles[ir];if(!pr&&(Ht>1&&console.time("creation"),pr=this.tiles[ir]=An(J,se,_e,ke,nt),this.tileCoords.push({z:se,x:_e,y:ke}),Ht)){Ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,_e,ke,pr.numFeatures,pr.numPoints,pr.numSimplified),console.timeEnd("creation"));var Hr="z"+se;this.stats[Hr]=(this.stats[Hr]||0)+1,this.total++}if(pr.source=J,Ye){if(se===nt.maxZoom||se===Ye)continue;var oi=1<<Ye-se;if(_e!==Math.floor(ut/oi)||ke!==Math.floor(xt/oi))continue}else if(se===nt.indexMaxZoom||pr.numPoints<=nt.indexMaxPoints)continue;if(pr.source=null,J.length!==0){Ht>1&&console.time("clipping");var wn,rr,Wn,Mr,mn,ea,Zn=.5*nt.buffer/nt.extent,na=.5-Zn,Zt=.5+Zn,kt=1+Zn;wn=rr=Wn=Mr=null,mn=j(J,jr,_e-Zn,_e+Zt,0,pr.minX,pr.maxX,nt),ea=j(J,jr,_e+na,_e+kt,0,pr.minX,pr.maxX,nt),J=null,mn&&(wn=j(mn,jr,ke-Zn,ke+Zt,1,pr.minY,pr.maxY,nt),rr=j(mn,jr,ke+na,ke+kt,1,pr.minY,pr.maxY,nt),mn=null),ea&&(Wn=j(ea,jr,ke-Zn,ke+Zt,1,pr.minY,pr.maxY,nt),Mr=j(ea,jr,ke+na,ke+kt,1,pr.minY,pr.maxY,nt),ea=null),Ht>1&&console.timeEnd("clipping"),Ie.push(wn||[],se+1,2*_e,2*ke),Ie.push(rr||[],se+1,2*_e,2*ke+1),Ie.push(Wn||[],se+1,2*_e+1,2*ke),Ie.push(Mr||[],se+1,2*_e+1,2*ke+1)}}},Pa.prototype.getTile=function(J,se,_e){var ke=this.options,Ye=ke.extent,ut=ke.debug;if(J<0||J>24)return null;var xt=1<<J,Ie=ia(J,se=(se%xt+xt)%xt,_e);if(this.tiles[Ie])return vi(this.tiles[Ie],Ye);ut>1&&console.log("drilling down to z%d-%d-%d",J,se,_e);for(var nt,Ht=J,jr=se,ir=_e;!nt&&Ht>0;)Ht--,jr=Math.floor(jr/2),ir=Math.floor(ir/2),nt=this.tiles[ia(Ht,jr,ir)];return nt&&nt.source?(ut>1&&console.log("found parent tile z%d-%d-%d",Ht,jr,ir),ut>1&&console.time("drilling down"),this.splitTile(nt.source,Ht,jr,ir,J,se,_e),ut>1&&console.timeEnd("drilling down"),this.tiles[Ie]?vi(this.tiles[Ie],Ye):null):null};var Ci=function(J){function se(_e,ke,Ye,ut){J.call(this,_e,ke,Ye,ao),ut&&(this.loadGeoJSON=ut)}return J&&(se.__proto__=J),(se.prototype=Object.create(J&&J.prototype)).constructor=se,se.prototype.loadData=function(_e,ke){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ke,this._pendingLoadDataParams=_e,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},se.prototype._loadData=function(){var _e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ke=this._pendingCallback,Ye=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var ut=!!(Ye&&Ye.request&&Ye.request.collectResourceTiming)&&new y.RequestPerformance(Ye.request);this.loadGeoJSON(Ye,function(xt,Ie){if(xt||!Ie)return ke(xt);if(typeof Ie!="object")return ke(new Error("Input data given to '"+Ye.source+"' is not a valid GeoJSON object."));(function pr(Hr,oi){var wn,rr=Hr&&Hr.type;if(rr==="FeatureCollection")for(wn=0;wn<Hr.features.length;wn++)pr(Hr.features[wn],oi);else if(rr==="GeometryCollection")for(wn=0;wn<Hr.geometries.length;wn++)pr(Hr.geometries[wn],oi);else if(rr==="Feature")pr(Hr.geometry,oi);else if(rr==="Polygon")qt(Hr.coordinates,oi);else if(rr==="MultiPolygon")for(wn=0;wn<Hr.coordinates.length;wn++)qt(Hr.coordinates[wn],oi);return Hr})(Ie,!0);try{if(Ye.filter){var nt=y.createExpression(Ye.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(nt.result==="error")throw new Error(nt.value.map(function(pr){return pr.key+": "+pr.message}).join(", "));var Ht=Ie.features.filter(function(pr){return nt.value.evaluate({zoom:0},pr)});Ie={type:"FeatureCollection",features:Ht}}_e._geoJSONIndex=Ye.cluster?new Sn(function(pr){var Hr=pr.superclusterOptions,oi=pr.clusterProperties;if(!oi||!Hr)return Hr;for(var wn={},rr={},Wn={accumulated:null,zoom:0},Mr={properties:null},mn=Object.keys(oi),ea=0,Zn=mn;ea<Zn.length;ea+=1){var na=Zn[ea],Zt=oi[na],kt=Zt[0],va=y.createExpression(Zt[1]),aa=y.createExpression(typeof kt=="string"?[kt,["accumulated"],["get",na]]:kt);wn[na]=va.value,rr[na]=aa.value}return Hr.map=function(Fi){Mr.properties=Fi;for(var Mi={},go=0,Ba=mn;go<Ba.length;go+=1){var Pr=Ba[go];Mi[Pr]=wn[Pr].evaluate(Wn,Mr)}return Mi},Hr.reduce=function(Fi,Mi){Mr.properties=Mi;for(var go=0,Ba=mn;go<Ba.length;go+=1){var Pr=Ba[go];Wn.accumulated=Fi[Pr],Fi[Pr]=rr[Pr].evaluate(Wn,Mr)}},Hr}(Ye)).load(Ie.features):function(pr,Hr){return new Pa(pr,Hr)}(Ie,Ye.geojsonVtOptions)}catch(pr){return ke(pr)}_e.loaded={};var jr={};if(ut){var ir=ut.finish();ir&&(jr.resourceTiming={},jr.resourceTiming[Ye.source]=JSON.parse(JSON.stringify(ir)))}ke(null,jr)})}},se.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},se.prototype.reloadTile=function(_e,ke){var Ye=this.loaded;return Ye&&Ye[_e.uid]?J.prototype.reloadTile.call(this,_e,ke):this.loadTile(_e,ke)},se.prototype.loadGeoJSON=function(_e,ke){if(_e.request)y.getJSON(_e.request,ke);else{if(typeof _e.data!="string")return ke(new Error("Input data given to '"+_e.source+"' is not a valid GeoJSON object."));try{return ke(null,JSON.parse(_e.data))}catch(Ye){return ke(new Error("Input data given to '"+_e.source+"' is not a valid GeoJSON object."))}}},se.prototype.removeSource=function(_e,ke){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ke()},se.prototype.getClusterExpansionZoom=function(_e,ke){try{ke(null,this._geoJSONIndex.getClusterExpansionZoom(_e.clusterId))}catch(Ye){ke(Ye)}},se.prototype.getClusterChildren=function(_e,ke){try{ke(null,this._geoJSONIndex.getChildren(_e.clusterId))}catch(Ye){ke(Ye)}},se.prototype.getClusterLeaves=function(_e,ke){try{ke(null,this._geoJSONIndex.getLeaves(_e.clusterId,_e.limit,_e.offset))}catch(Ye){ke(Ye)}},se}(St),da=function(J){var se=this;this.self=J,this.actor=new y.Actor(J,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:St,geojson:Ci},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(_e,ke){if(se.workerSourceTypes[_e])throw new Error('Worker source with name "'+_e+'" already registered.');se.workerSourceTypes[_e]=ke},this.self.registerRTLTextPlugin=function(_e){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=_e.applyArabicShaping,y.plugin.processBidirectionalText=_e.processBidirectionalText,y.plugin.processStyledBidirectionalText=_e.processStyledBidirectionalText}};return da.prototype.setReferrer=function(J,se){this.referrer=se},da.prototype.setImages=function(J,se,_e){for(var ke in this.availableImages[J]=se,this.workerSources[J]){var Ye=this.workerSources[J][ke];for(var ut in Ye)Ye[ut].availableImages=se}_e()},da.prototype.setLayers=function(J,se,_e){this.getLayerIndex(J).replace(se),_e()},da.prototype.updateLayers=function(J,se,_e){this.getLayerIndex(J).update(se.layers,se.removedIds),_e()},da.prototype.loadTile=function(J,se,_e){this.getWorkerSource(J,se.type,se.source).loadTile(se,_e)},da.prototype.loadDEMTile=function(J,se,_e){this.getDEMWorkerSource(J,se.source).loadTile(se,_e)},da.prototype.reloadTile=function(J,se,_e){this.getWorkerSource(J,se.type,se.source).reloadTile(se,_e)},da.prototype.abortTile=function(J,se,_e){this.getWorkerSource(J,se.type,se.source).abortTile(se,_e)},da.prototype.removeTile=function(J,se,_e){this.getWorkerSource(J,se.type,se.source).removeTile(se,_e)},da.prototype.removeDEMTile=function(J,se){this.getDEMWorkerSource(J,se.source).removeTile(se)},da.prototype.removeSource=function(J,se,_e){if(this.workerSources[J]&&this.workerSources[J][se.type]&&this.workerSources[J][se.type][se.source]){var ke=this.workerSources[J][se.type][se.source];delete this.workerSources[J][se.type][se.source],ke.removeSource!==void 0?ke.removeSource(se,_e):_e()}},da.prototype.loadWorkerSource=function(J,se,_e){try{this.self.importScripts(se.url),_e()}catch(ke){_e(ke.toString())}},da.prototype.syncRTLPluginState=function(J,se,_e){try{y.plugin.setState(se);var ke=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&ke!=null){this.self.importScripts(ke);var Ye=y.plugin.isParsed();_e(Ye?void 0:new Error("RTL Text Plugin failed to import scripts from "+ke),Ye)}}catch(ut){_e(ut.toString())}},da.prototype.getAvailableImages=function(J){var se=this.availableImages[J];return se||(se=[]),se},da.prototype.getLayerIndex=function(J){var se=this.layerIndexes[J];return se||(se=this.layerIndexes[J]=new Pe),se},da.prototype.getWorkerSource=function(J,se,_e){var ke=this;return this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][se]||(this.workerSources[J][se]={}),this.workerSources[J][se][_e]||(this.workerSources[J][se][_e]=new this.workerSourceTypes[se]({send:function(Ye,ut,xt){ke.actor.send(Ye,ut,xt,J)}},this.getLayerIndex(J),this.getAvailableImages(J))),this.workerSources[J][se][_e]},da.prototype.getDEMWorkerSource=function(J,se){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][se]||(this.demWorkerSources[J][se]=new tr),this.demWorkerSources[J][se]},da.prototype.enforceCacheSizeLimit=function(J,se){y.enforceCacheSizeLimit(se)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new da(self)),da}),ge(["./shared"],function(y){"use strict";var Ne=y.createCommonjsModule(function(c){function p(S){return!f(S)}function f(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var R,z,q=new Blob([""],{type:"text/javascript"}),ne=URL.createObjectURL(q);try{z=new Worker(ne),R=!0}catch(Se){R=!1}return z&&z.terminate(),URL.revokeObjectURL(ne),R}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var R=document.createElement("canvas");R.width=R.height=1;var z=R.getContext("2d");if(!z)return!1;var q=z.getImageData(0,0,1,1);return q&&q.width===R.width}()?(g[I=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[I]=function(R){var z=function(ne){var Se=document.createElement("canvas"),Me=Object.create(p.webGLContextAttributes);return Me.failIfMajorPerformanceCaveat=ne,Se.probablySupportsContext?Se.probablySupportsContext("webgl",Me)||Se.probablySupportsContext("experimental-webgl",Me):Se.supportsContext?Se.supportsContext("webgl",Me)||Se.supportsContext("experimental-webgl",Me):Se.getContext("webgl",Me)||Se.getContext("experimental-webgl",Me)}(R);if(!z)return!1;var q=z.createShader(z.VERTEX_SHADER);return!(!q||z.isContextLost())&&(z.shaderSource(q,"void main() {}"),z.compileShader(q),z.getShaderParameter(q,z.COMPILE_STATUS)===!0)}(I)),g[I]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var I}c.exports?c.exports=p:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=p,window.mapboxgl.notSupportedReason=f);var g={};p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Q={create:function(c,p,f){var g=y.window.document.createElement(c);return p!==void 0&&(g.className=p),f&&f.appendChild(g),g},createNS:function(c,p){return y.window.document.createElementNS(c,p)}},Pe=y.window.document&&y.window.document.documentElement.style;function ve(c){if(!Pe)return c[0];for(var p=0;p<c.length;p++)if(c[p]in Pe)return c[p];return c[0]}var lt,we=ve(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Q.disableDrag=function(){Pe&&we&&(lt=Pe[we],Pe[we]="none")},Q.enableDrag=function(){Pe&&we&&(Pe[we]=lt)};var We=ve(["transform","WebkitTransform"]);Q.setTransform=function(c,p){c.style[We]=p};var St=!1;try{var Rt=Object.defineProperty({},"passive",{get:function(){St=!0}});y.window.addEventListener("test",Rt,Rt),y.window.removeEventListener("test",Rt,Rt)}catch(c){St=!1}Q.addEventListener=function(c,p,f,g){g===void 0&&(g={}),c.addEventListener(p,f,"passive"in g&&St?g:g.capture)},Q.removeEventListener=function(c,p,f,g){g===void 0&&(g={}),c.removeEventListener(p,f,"passive"in g&&St?g:g.capture)};var tr=function(c){c.preventDefault(),c.stopPropagation(),y.window.removeEventListener("click",tr,!0)};function qt(c){var p=c.userImage;return!!(p&&p.render&&p.render())&&(c.data.replace(new Uint8Array(p.data.buffer)),!0)}Q.suppressClick=function(){y.window.addEventListener("click",tr,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",tr,!0)},0)},Q.mousePos=function(c,p){var f=c.getBoundingClientRect();return new y.Point(p.clientX-f.left-c.clientLeft,p.clientY-f.top-c.clientTop)},Q.touchPos=function(c,p){for(var f=c.getBoundingClientRect(),g=[],S=0;S<p.length;S++)g.push(new y.Point(p[S].clientX-f.left-c.clientLeft,p[S].clientY-f.top-c.clientTop));return g},Q.mouseButton=function(c){return y.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},Q.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var Yt=function(c){function p(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.isLoaded=function(){return this.loaded},p.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var g=0,S=this.requestors;g<S.length;g+=1){var I=S[g];this._notify(I.ids,I.callback)}this.requestors=[]}},p.prototype.getImage=function(f){return this.images[f]},p.prototype.addImage=function(f,g){this._validate(f,g)&&(this.images[f]=g)},p.prototype._validate=function(f,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new y.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),S=!1),S},p.prototype._validateStretch=function(f,g){if(!f)return!0;for(var S=0,I=0,R=f;I<R.length;I+=1){var z=R[I];if(z[0]<S||z[1]<z[0]||g<z[1])return!1;S=z[1]}return!0},p.prototype._validateContent=function(f,g){return!(f&&(f.length!==4||f[0]<0||g.data.width<f[0]||f[1]<0||g.data.height<f[1]||f[2]<0||g.data.width<f[2]||f[3]<0||g.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},p.prototype.updateImage=function(f,g){g.version=this.images[f].version+1,this.images[f]=g,this.updatedImages[f]=!0},p.prototype.removeImage=function(f){var g=this.images[f];delete this.images[f],delete this.patterns[f],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},p.prototype.listImages=function(){return Object.keys(this.images)},p.prototype.getImages=function(f,g){var S=!0;if(!this.isLoaded())for(var I=0,R=f;I<R.length;I+=1)this.images[R[I]]||(S=!1);this.isLoaded()||S?this._notify(f,g):this.requestors.push({ids:f,callback:g})},p.prototype._notify=function(f,g){for(var S={},I=0,R=f;I<R.length;I+=1){var z=R[I];this.images[z]||this.fire(new y.Event("styleimagemissing",{id:z}));var q=this.images[z];q?S[z]={data:q.data.clone(),pixelRatio:q.pixelRatio,sdf:q.sdf,version:q.version,stretchX:q.stretchX,stretchY:q.stretchY,content:q.content,hasRenderCallback:Boolean(q.userImage&&q.userImage.render)}:y.warnOnce('Image "'+z+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},p.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},p.prototype.getPattern=function(f){var g=this.patterns[f],S=this.getImage(f);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var I={w:S.data.width+2,h:S.data.height+2,x:0,y:0},R=new y.ImagePosition(I,S);this.patterns[f]={bin:I,position:R}}return this._updatePatternAtlas(),this.patterns[f].position},p.prototype.bind=function(f){var g=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(f,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},p.prototype._updatePatternAtlas=function(){var f=[];for(var g in this.patterns)f.push(this.patterns[g].bin);var S=y.potpack(f),I=S.w,R=S.h,z=this.atlasImage;for(var q in z.resize({width:I||1,height:R||1}),this.patterns){var ne=this.patterns[q].bin,Se=ne.x+1,Me=ne.y+1,ye=this.images[q].data,Qe=ye.width,qe=ye.height;y.RGBAImage.copy(ye,z,{x:0,y:0},{x:Se,y:Me},{width:Qe,height:qe}),y.RGBAImage.copy(ye,z,{x:0,y:qe-1},{x:Se,y:Me-1},{width:Qe,height:1}),y.RGBAImage.copy(ye,z,{x:0,y:0},{x:Se,y:Me+qe},{width:Qe,height:1}),y.RGBAImage.copy(ye,z,{x:Qe-1,y:0},{x:Se-1,y:Me},{width:1,height:qe}),y.RGBAImage.copy(ye,z,{x:0,y:0},{x:Se+Qe,y:Me},{width:1,height:qe})}this.dirty=!0},p.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},p.prototype.dispatchRenderCallbacks=function(f){for(var g=0,S=f;g<S.length;g+=1){var I=S[g];if(!this.callbackDispatchedThisFrame[I]){this.callbackDispatchedThisFrame[I]=!0;var R=this.images[I];qt(R)&&this.updateImage(I,R)}}},p}(y.Evented),Sr=jt,fr=jt,It=1e20;function jt(c,p,f,g,S,I){this.fontSize=c||24,this.buffer=p===void 0?3:p,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=I||"normal",this.radius=f||8;var R=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=R,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.d=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Int16Array(R),this.middle=Math.round(R/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Rr(c,p,f,g,S,I,R){for(var z=0;z<p;z++){for(var q=0;q<f;q++)g[q]=c[q*p+z];for(ie(g,S,I,R,f),q=0;q<f;q++)c[q*p+z]=S[q]}for(q=0;q<f;q++){for(z=0;z<p;z++)g[z]=c[q*p+z];for(ie(g,S,I,R,p),z=0;z<p;z++)c[q*p+z]=Math.sqrt(S[z])}}function ie(c,p,f,g,S){f[0]=0,g[0]=-It,g[1]=+It;for(var I=1,R=0;I<S;I++){for(var z=(c[I]+I*I-(c[f[R]]+f[R]*f[R]))/(2*I-2*f[R]);z<=g[R];)R--,z=(c[I]+I*I-(c[f[R]]+f[R]*f[R]))/(2*I-2*f[R]);f[++R]=I,g[R]=z,g[R+1]=+It}for(I=0,R=0;I<S;I++){for(;g[R+1]<I;)R++;p[I]=(I-f[R])*(I-f[R])+c[f[R]]}}jt.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var p=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=p.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?It:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?It:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Rr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Rr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)f[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return f},Sr.default=fr;var _r=function(c,p){this.requestManager=c,this.localIdeographFontFamily=p,this.entries={}};_r.prototype.setURL=function(c){this.url=c},_r.prototype.getGlyphs=function(c,p){var f=this,g=[];for(var S in c)for(var I=0,R=c[S];I<R.length;I+=1)g.push({stack:S,id:R[I]});y.asyncAll(g,function(z,q){var ne=z.stack,Se=z.id,Me=f.entries[ne];Me||(Me=f.entries[ne]={glyphs:{},requests:{},ranges:{}});var ye=Me.glyphs[Se];if(ye===void 0){if(ye=f._tinySDF(Me,ne,Se))return Me.glyphs[Se]=ye,void q(null,{stack:ne,id:Se,glyph:ye});var Qe=Math.floor(Se/256);if(256*Qe>65535)q(new Error("glyphs > 65535 not supported"));else if(Me.ranges[Qe])q(null,{stack:ne,id:Se,glyph:ye});else{var qe=Me.requests[Qe];qe||(qe=Me.requests[Qe]=[],_r.loadGlyphRange(ne,Qe,f.url,f.requestManager,function(pt,Xe){if(Xe){for(var dt in Xe)f._doesCharSupportLocalGlyph(+dt)||(Me.glyphs[+dt]=Xe[+dt]);Me.ranges[Qe]=!0}for(var Ct=0,Wt=qe;Ct<Wt.length;Ct+=1)(0,Wt[Ct])(pt,Xe);delete Me.requests[Qe]})),qe.push(function(pt,Xe){pt?q(pt):Xe&&q(null,{stack:ne,id:Se,glyph:Xe[Se]||null})})}}else q(null,{stack:ne,id:Se,glyph:ye})},function(z,q){if(z)p(z);else if(q){for(var ne={},Se=0,Me=q;Se<Me.length;Se+=1){var ye=Me[Se],Qe=ye.stack,qe=ye.id,pt=ye.glyph;(ne[Qe]||(ne[Qe]={}))[qe]=pt&&{id:pt.id,bitmap:pt.bitmap.clone(),metrics:pt.metrics}}p(null,ne)}})},_r.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](c)||y.isChar["Hangul Syllables"](c)||y.isChar.Hiragana(c)||y.isChar.Katakana(c))},_r.prototype._tinySDF=function(c,p,f){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(f)){var S=c.tinySDF;if(!S){var I="400";/bold/i.test(p)?I="900":/medium/i.test(p)?I="500":/light/i.test(p)&&(I="200"),S=c.tinySDF=new _r.TinySDF(24,3,8,.25,g,I)}return{id:f,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},_r.loadGlyphRange=function(c,p,f,g,S){var I=256*p,R=I+255,z=g.transformRequest(g.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",I+"-"+R),y.ResourceType.Glyphs);y.getArrayBuffer(z,function(q,ne){if(q)S(q);else if(ne){for(var Se={},Me=0,ye=y.parseGlyphPBF(ne);Me<ye.length;Me+=1){var Qe=ye[Me];Se[Qe.id]=Qe}S(null,Se)}})},_r.TinySDF=Sr;var Ot=function(){this.specification=y.styleSpec.light.position};Ot.prototype.possiblyEvaluate=function(c,p){return y.sphericalToCartesian(c.expression.evaluate(p))},Ot.prototype.interpolate=function(c,p,f){return{x:y.number(c.x,p.x,f),y:y.number(c.y,p.y,f),z:y.number(c.z,p.z,f)}};var yt=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Ot,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),Qt=function(c){function p(f){c.call(this),this._transitionable=new y.Transitionable(yt),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getLight=function(){return this._transitionable.serialize()},p.prototype.setLight=function(f,g){if(g===void 0&&(g={}),!this._validate(y.validateLight,f,g))for(var S in f){var I=f[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),I):this._transitionable.setValue(S,I)}},p.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},p.prototype.hasTransition=function(){return this._transitioning.hasTransition()},p.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},p.prototype._validate=function(f,g,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,f.call(y.validateStyle,y.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},p}(y.Evented),Ue=function(c,p){this.width=c,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ue.prototype.getDash=function(c,p){var f=c.join(",")+String(p);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,p)),this.dashEntry[f]},Ue.prototype.getDashRanges=function(c,p,f){var g=[],S=c.length%2==1?-c[c.length-1]*f:0,I=c[0]*f,R=!0;g.push({left:S,right:I,isDash:R,zeroLength:c[0]===0});for(var z=c[0],q=1;q<c.length;q++){var ne=c[q];g.push({left:S=z*f,right:I=(z+=ne)*f,isDash:R=!R,zeroLength:ne===0})}return g},Ue.prototype.addRoundDash=function(c,p,f){for(var g=p/2,S=-f;S<=f;S++)for(var I=this.width*(this.nextRow+f+S),R=0,z=c[R],q=0;q<this.width;q++){q/z.right>1&&(z=c[++R]);var ne=Math.abs(q-z.left),Se=Math.abs(q-z.right),Me=Math.min(ne,Se),ye=void 0,Qe=S/f*(g+1);if(z.isDash){var qe=g-Math.abs(Qe);ye=Math.sqrt(Me*Me+qe*qe)}else ye=g-Math.sqrt(Me*Me+Qe*Qe);this.data[I+q]=Math.max(0,Math.min(255,ye+128))}},Ue.prototype.addRegularDash=function(c){for(var p=c.length-1;p>=0;--p){var f=c[p],g=c[p+1];f.zeroLength?c.splice(p,1):g&&g.isDash===f.isDash&&(g.left=f.left,c.splice(p,1))}var S=c[0],I=c[c.length-1];S.isDash===I.isDash&&(S.left=I.left-this.width,I.right=S.right+this.width);for(var R=this.width*this.nextRow,z=0,q=c[z],ne=0;ne<this.width;ne++){ne/q.right>1&&(q=c[++z]);var Se=Math.abs(ne-q.left),Me=Math.abs(ne-q.right),ye=Math.min(Se,Me);this.data[R+ne]=Math.max(0,Math.min(255,(q.isDash?ye:-ye)+128))}},Ue.prototype.addDash=function(c,p){var f=p?7:0,g=2*f+1;if(this.nextRow+g>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,I=0;I<c.length;I++)S+=c[I];if(S!==0){var R=this.width/S,z=this.getDashRanges(c,this.width,R);p?this.addRoundDash(z,R,f):this.addRegularDash(z)}var q={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:S};return this.nextRow+=g,this.dirty=!0,q},Ue.prototype.bind=function(c){var p=c.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))};var Ar=function c(p,f){this.workerPool=p,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var I=new c.Actor(g[S],f,this.id);I.name="Worker "+S,this.actors.push(I)}};function an(c,p,f){var g=function(S,I){if(S)return f(S);if(I){var R=y.pick(y.extend(I,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(R.vectorLayers=I.vector_layers,R.vectorLayerIds=R.vectorLayers.map(function(z){return z.id})),R.tiles=p.canonicalizeTileset(R,c.url),f(null,R)}};return c.url?y.getJSON(p.transformRequest(p.normalizeSourceURL(c.url),y.ResourceType.Source),g):y.browser.frame(function(){return g(null,c)})}Ar.prototype.broadcast=function(c,p,f){y.asyncAll(this.actors,function(g,S){g.send(c,p,S)},f=f||function(){})},Ar.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ar.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},Ar.Actor=y.Actor;var fe=function(c,p,f){this.bounds=y.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=p||0,this.maxzoom=f||24};fe.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},fe.prototype.contains=function(c){var p=Math.pow(2,c.z),f=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*p),g=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*p),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*p),I=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*p);return c.x>=f&&c.x<S&&c.y>=g&&c.y<I};var rt=function(c){function p(f,g,S,I){if(c.call(this),this.id=f,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(g,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=an(this._options,this.map._requestManager,function(g,S){f._tileJSONRequest=null,f._loaded=!0,g?f.fire(new y.ErrorEvent(g)):S&&(y.extend(f,S),S.bounds&&(f.tileBounds=new fe(S.bounds,f.minzoom,f.maxzoom)),y.postTurnstileEvent(S.tiles,f.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},p.prototype.loaded=function(){return this._loaded},p.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},p.prototype.onAdd=function(f){this.map=f,this.load()},p.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},p.prototype.setTiles=function(f){var g=this;return this.setSourceProperty(function(){g._options.tiles=f}),this},p.prototype.setUrl=function(f){var g=this;return this.setSourceProperty(function(){g.url=f,g._options.url=f}),this},p.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},p.prototype.serialize=function(){return y.extend({},this._options)},p.prototype.loadTile=function(f,g){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),I={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function R(z,q){return delete f.request,f.aborted?g(null):z&&z.status!==404?g(z):(q&&q.resourceTiming&&(f.resourceTiming=q.resourceTiming),this.map._refreshExpiredTiles&&q&&f.setExpiryData(q),f.loadVectorData(q,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}I.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=g:f.request=f.actor.send("reloadTile",I,R.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",I,R.bind(this)))},p.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},p.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},p.prototype.hasTransition=function(){return!1},p}(y.Evented),X=function(c){function p(f,g,S,I){c.call(this),this.id=f,this.dispatcher=S,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},g),y.extend(this,y.pick(g,["url","scheme","tileSize"]))}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=an(this._options,this.map._requestManager,function(g,S){f._tileJSONRequest=null,f._loaded=!0,g?f.fire(new y.ErrorEvent(g)):S&&(y.extend(f,S),S.bounds&&(f.tileBounds=new fe(S.bounds,f.minzoom,f.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},p.prototype.loaded=function(){return this._loaded},p.prototype.onAdd=function(f){this.map=f,this.load()},p.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},p.prototype.serialize=function(){return y.extend({},this._options)},p.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},p.prototype.loadTile=function(f,g){var S=this,I=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=y.getImage(this.map._requestManager.transformRequest(I,y.ResourceType.Tile),function(R,z){if(delete f.request,f.aborted)f.state="unloaded",g(null);else if(R)f.state="errored",g(R);else if(z){S.map._refreshExpiredTiles&&f.setExpiryData(z),delete z.cacheControl,delete z.expires;var q=S.map.painter.context,ne=q.gl;f.texture=S.map.painter.getTileTexture(z.width),f.texture?f.texture.update(z,{useMipmap:!0}):(f.texture=new y.Texture(q,z,ne.RGBA,{useMipmap:!0}),f.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE,ne.LINEAR_MIPMAP_NEAREST),q.extTextureFilterAnisotropic&&ne.texParameterf(ne.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax)),f.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},p.prototype.abortTile=function(f,g){f.request&&(f.request.cancel(),delete f.request),g()},p.prototype.unloadTile=function(f,g){f.texture&&this.map.painter.saveTileTexture(f.texture),g()},p.prototype.hasTransition=function(){return!1},p}(y.Evented),ae=function(c){function p(f,g,S,I){c.call(this,f,g,S,I),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},p.prototype.loadTile=function(f,g){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function I(R,z){R&&(f.state="errored",g(R)),z&&(f.dem=z,f.needsHillshadePrepare=!0,f.state="loaded",g(null))}f.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(R,z){if(delete f.request,f.aborted)f.state="unloaded",g(null);else if(R)f.state="errored",g(R);else if(z){this.map._refreshExpiredTiles&&f.setExpiryData(z),delete z.cacheControl,delete z.expires;var q=y.window.ImageBitmap&&z instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?z:y.browser.getImageData(z,1),ne={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:q,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",ne,I.bind(this)))}}.bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},p.prototype._getNeighboringTiles=function(f){var g=f.canonical,S=Math.pow(2,g.z),I=(g.x-1+S)%S,R=g.x===0?f.wrap-1:f.wrap,z=(g.x+1+S)%S,q=g.x+1===S?f.wrap+1:f.wrap,ne={};return ne[new y.OverscaledTileID(f.overscaledZ,R,g.z,I,g.y).key]={backfilled:!1},ne[new y.OverscaledTileID(f.overscaledZ,q,g.z,z,g.y).key]={backfilled:!1},g.y>0&&(ne[new y.OverscaledTileID(f.overscaledZ,R,g.z,I,g.y-1).key]={backfilled:!1},ne[new y.OverscaledTileID(f.overscaledZ,f.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},ne[new y.OverscaledTileID(f.overscaledZ,q,g.z,z,g.y-1).key]={backfilled:!1}),g.y+1<S&&(ne[new y.OverscaledTileID(f.overscaledZ,R,g.z,I,g.y+1).key]={backfilled:!1},ne[new y.OverscaledTileID(f.overscaledZ,f.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},ne[new y.OverscaledTileID(f.overscaledZ,q,g.z,z,g.y+1).key]={backfilled:!1}),ne},p.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},p}(X),ze=function(c){function p(f,g,S,I){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(I),this._data=g.data,this._options=y.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var R=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*R,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*R,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:y.EXTENT,radius:(g.clusterRadius||50)*R,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){var f=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)f.fire(new y.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(S.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new y.Event("data",S))}})},p.prototype.onAdd=function(f){this.map=f,this.load()},p.prototype.setData=function(f){var g=this;return this._data=f,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new y.ErrorEvent(S));else{var I={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(I.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new y.Event("data",I))}}),this},p.prototype.getClusterExpansionZoom=function(f,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},g),this},p.prototype.getClusterChildren=function(f,g){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},g),this},p.prototype.getClusterLeaves=function(f,g,S,I){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:g,offset:S},I),this},p.prototype._updateWorkerData=function(f){var g=this;this._loaded=!1;var S=y.extend({},this.workerOptions),I=this._data;typeof I=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(I),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(I),this.actor.send(this.type+".loadData",S,function(R,z){g._removed||z&&z.abandoned||(g._loaded=!0,z&&z.resourceTiming&&z.resourceTiming[g.id]&&(g._resourceTiming=z.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),f(R))})},p.prototype.loaded=function(){return this._loaded},p.prototype.loadTile=function(f,g){var S=this,I=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(I,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(R,z){return delete f.request,f.unloadVectorData(),f.aborted?g(null):R?g(R):(f.loadVectorData(z,S.map.painter,I==="reloadTile"),g(null))})},p.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},p.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},p.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},p.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},p.prototype.hasTransition=function(){return!1},p}(y.Evented),At=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Ft=function(c){function p(f,g,S,I){c.call(this),this.id=f,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=g}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(f,g){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(I,R){S._loaded=!0,I?S.fire(new y.ErrorEvent(I)):R&&(S.image=R,f&&(S.coordinates=f),g&&g(),S._finishLoading())})},p.prototype.loaded=function(){return this._loaded},p.prototype.updateImage=function(f){var g=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){g.texture=null}),this):this},p.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},p.prototype.onAdd=function(f){this.map=f,this.load()},p.prototype.setCoordinates=function(f){var g=this;this.coordinates=f;var S=f.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(R){for(var z=1/0,q=1/0,ne=-1/0,Se=-1/0,Me=0,ye=R;Me<ye.length;Me+=1){var Qe=ye[Me];z=Math.min(z,Qe.x),q=Math.min(q,Qe.y),ne=Math.max(ne,Qe.x),Se=Math.max(Se,Qe.y)}var qe=Math.max(ne-z,Se-q),pt=Math.max(0,Math.floor(-Math.log(qe)/Math.LN2)),Xe=Math.pow(2,pt);return new y.CanonicalTileID(pt,Math.floor((z+ne)/2*Xe),Math.floor((q+Se)/2*Xe))}(S),this.minzoom=this.maxzoom=this.tileID.z;var I=S.map(function(R){return g.tileID.getTilePoint(R)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(I[0].x,I[0].y,0,0),this._boundsArray.emplaceBack(I[1].x,I[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(I[3].x,I[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(I[2].x,I[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},p.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,g=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(f,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},p.prototype.loadTile=function(f,g){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},g(null)):(f.state="errored",g(null))},p.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},p.prototype.hasTransition=function(){return!1},p}(y.Evented),ur=function(c){function p(f,g,S,I){c.call(this,f,g,S,I),this.roundZoom=!0,this.type="video",this.options=g}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){var f=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,I=g.urls;S<I.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(I[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(R,z){f._loaded=!0,R?f.fire(new y.ErrorEvent(R)):z&&(f.video=z,f.video.loop=!0,f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},p.prototype.pause=function(){this.video&&this.video.pause()},p.prototype.play=function(){this.video&&this.video.play()},p.prototype.seek=function(f){if(this.video){var g=this.video.seekable;f<g.start(0)||f>g.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=f}},p.prototype.getVideo=function(){return this.video},p.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},p.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,g=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(f,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var I=this.tiles[S];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},p.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},p.prototype.hasTransition=function(){return this.video&&!this.video.paused},p}(Ft),Tt=function(c){function p(f,g,S,I){c.call(this,f,g,S,I),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(R){return!Array.isArray(R)||R.length!==2||R.some(function(z){return typeof z!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},p.prototype.getCanvas=function(){return this.canvas},p.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},p.prototype.onRemove=function(){this.pause()},p.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var I in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var R=this.tiles[I];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture)}}},p.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},p.prototype.hasTransition=function(){return this._playing},p.prototype._hasInvalidDimensions=function(){for(var f=0,g=[this.canvas.width,this.canvas.height];f<g.length;f+=1){var S=g[f];if(isNaN(S)||S<=0)return!0}return!1},p}(Ft),Br={vector:rt,raster:X,"raster-dem":ae,geojson:ze,video:ur,image:Ft,canvas:Tt};function Bn(c,p){var f=y.identity([]);return y.translate(f,f,[1,1,0]),y.scale(f,f,[.5*c.width,.5*c.height,1]),y.multiply(f,f,c.calculatePosMatrix(p.toUnwrapped()))}function Sn(c,p,f,g,S,I){var R=function(pt,Xe,dt){if(pt)for(var Ct=0,Wt=pt;Ct<Wt.length;Ct+=1){var vr=Xe[Wt[Ct]];if(vr&&vr.source===dt&&vr.type==="fill-extrusion")return!0}else for(var er in Xe){var wr=Xe[er];if(wr.source===dt&&wr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,p,c.id),z=I.maxPitchScaleFactor(),q=c.tilesIn(g,z,R);q.sort(Li);for(var ne=[],Se=0,Me=q;Se<Me.length;Se+=1){var ye=Me[Se];ne.push({wrappedTileID:ye.tileID.wrapped().key,queryResults:ye.tile.queryRenderedFeatures(p,f,c._state,ye.queryGeometry,ye.cameraQueryGeometry,ye.scale,S,I,z,Bn(c.transform,ye.tileID))})}var Qe=function(pt){for(var Xe={},dt={},Ct=0,Wt=pt;Ct<Wt.length;Ct+=1){var vr=Wt[Ct],er=vr.queryResults,wr=vr.wrappedTileID,Wr=dt[wr]=dt[wr]||{};for(var bn in er)for(var gn=er[bn],Gn=Wr[bn]=Wr[bn]||{},xi=Xe[bn]=Xe[bn]||[],Si=0,bi=gn;Si<bi.length;Si+=1){var Ea=bi[Si];Gn[Ea.featureIndex]||(Gn[Ea.featureIndex]=!0,xi.push(Ea))}}return Xe}(ne);for(var qe in Qe)Qe[qe].forEach(function(pt){var Xe=pt.feature,dt=c.getFeatureState(Xe.layer["source-layer"],Xe.id);Xe.source=Xe.layer.source,Xe.layer["source-layer"]&&(Xe.sourceLayer=Xe.layer["source-layer"]),Xe.state=dt});return Qe}function Li(c,p){var f=c.tileID,g=p.tileID;return f.overscaledZ-g.overscaledZ||f.canonical.y-g.canonical.y||f.wrap-g.wrap||f.canonical.x-g.canonical.x}var gi=function(c,p){this.max=c,this.onRemove=p,this.reset()};gi.prototype.reset=function(){for(var c in this.data)for(var p=0,f=this.data[c];p<f.length;p+=1){var g=f[p];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},gi.prototype.add=function(c,p,f){var g=this,S=c.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var I={value:p,timeout:void 0};if(f!==void 0&&(I.timeout=setTimeout(function(){g.remove(c,I)},f)),this.data[S].push(I),this.order.push(S),this.order.length>this.max){var R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this},gi.prototype.has=function(c){return c.wrapped().key in this.data},gi.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},gi.prototype._getAndRemoveByKey=function(c){var p=this.data[c].shift();return p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),p.value},gi.prototype.getByKey=function(c){var p=this.data[c];return p?p[0].value:null},gi.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},gi.prototype.remove=function(c,p){if(!this.has(c))return this;var f=c.wrapped().key,g=p===void 0?0:this.data[f].indexOf(p),S=this.data[f][g];return this.data[f].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(S.value),this.order.splice(this.order.indexOf(f),1),this},gi.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this},gi.prototype.filter=function(c){var p=[];for(var f in this.data)for(var g=0,S=this.data[f];g<S.length;g+=1){var I=S[g];c(I.value)||p.push(I)}for(var R=0,z=p;R<z.length;R+=1){var q=z[R];this.remove(q.value.tileID,q)}};var on=function(c,p,f){this.context=c;var g=c.gl;this.buffer=g.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer};on.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},on.prototype.updateData=function(c){var p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},on.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Xa={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},ra=function(c,p,f,g){this.length=p.length,this.attributes=f,this.itemSize=p.bytesPerElement,this.dynamicDraw=g,this.context=c;var S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer};ra.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},ra.prototype.updateData=function(c){var p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,c.arrayBuffer)},ra.prototype.enableAttributes=function(c,p){for(var f=0;f<this.attributes.length;f++){var g=p.attributes[this.attributes[f].name];g!==void 0&&c.enableVertexAttribArray(g)}},ra.prototype.setVertexAttribPointers=function(c,p,f){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],I=p.attributes[S.name];I!==void 0&&c.vertexAttribPointer(I,S.components,c[Xa[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}},ra.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Vi=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Vi.prototype.get=function(){return this.current},Vi.prototype.set=function(c){},Vi.prototype.getDefault=function(){return this.default},Vi.prototype.setDefault=function(){this.set(this.default)};var ga=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return y.Color.transparent},p.prototype.set=function(f){var g=this.current;(f.r!==g.r||f.g!==g.g||f.b!==g.b||f.a!==g.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},p}(Vi),fi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return 1},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},p}(Vi),$i=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return 0},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},p}(Vi),hi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return[!0,!0,!0,!0]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||f[3]!==g[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},p}(Vi),yi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!0},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},p}(Vi),os=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return 255},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},p}(Vi),mo=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},p.prototype.set=function(f){var g=this.current;(f.func!==g.func||f.ref!==g.ref||f.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},p}(Vi),Ya=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},p}(Vi),Pt=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=f,this.dirty=!1}},p}(Vi),xe=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return[0,1]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},p}(Vi),ce=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=f,this.dirty=!1}},p}(Vi),Te=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.LESS},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},p}(Vi),j=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.BLEND):g.disable(g.BLEND),this.current=f,this.dirty=!1}},p}(Vi),st=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},p}(Vi),ar=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return y.Color.transparent},p.prototype.set=function(f){var g=this.current;(f.r!==g.r||f.g!==g.g||f.b!==g.b||f.a!==g.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},p}(Vi),Jr=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.FUNC_ADD},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},p}(Vi),tt=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;f?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=f,this.dirty=!1}},p}(Vi),Ut=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.BACK},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},p}(Vi),xr=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.CCW},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},p}(Vi),Cr=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},p}(Vi),Lr=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return this.gl.TEXTURE0},p.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},p}(Vi),vn=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},p.prototype.set=function(f){var g=this.current;(f[0]!==g[0]||f[1]!==g[1]||f[2]!==g[2]||f[3]!==g[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},p}(Vi),vi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},p}(Vi),ni=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,f),this.current=f,this.dirty=!1}},p}(Vi),An=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,f),this.current=f,this.dirty=!1}},p}(Vi),Oi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},p}(Vi),zi=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},p}(Vi),Pa=function(c){function p(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},p}(Vi),ia=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return 4},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},p}(Vi),ao=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},p}(Vi),Ci=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return!1},p.prototype.set=function(f){if(f!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},p}(Vi),da=function(c){function p(f,g){c.call(this,f),this.context=f,this.parent=g}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getDefault=function(){return null},p}(Vi),J=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.setDirty=function(){this.dirty=!0},p.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},p}(da),se=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,f),this.current=f,this.dirty=!1}},p}(da),_e=function(c,p,f,g){this.context=c,this.width=p,this.height=f;var S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new J(c,S),g&&(this.depthAttachment=new se(c,S))};_e.prototype.destroy=function(){var c=this.context.gl,p=this.colorAttachment.get();if(p&&c.deleteTexture(p),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var ke=function(c,p,f){this.func=c,this.mask=p,this.range=f};ke.ReadOnly=!1,ke.ReadWrite=!0,ke.disabled=new ke(519,ke.ReadOnly,[0,1]);var Ye=function(c,p,f,g,S,I){this.test=c,this.ref=p,this.mask=f,this.fail=g,this.depthFail=S,this.pass=I};Ye.disabled=new Ye({func:519,mask:0},0,0,7680,7680,7680);var ut=function(c,p,f){this.blendFunction=c,this.blendColor=p,this.mask=f};ut.disabled=new ut(ut.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),ut.unblended=new ut(ut.Replace,y.Color.transparent,[!0,!0,!0,!0]),ut.alphaBlended=new ut([1,771],y.Color.transparent,[!0,!0,!0,!0]);var xt=function(c,p,f){this.enable=c,this.mode=p,this.frontFace=f};xt.disabled=new xt(!1,1029,2305),xt.backCCW=new xt(!0,1029,2305);var Ie=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ga(this),this.clearDepth=new fi(this),this.clearStencil=new $i(this),this.colorMask=new hi(this),this.depthMask=new yi(this),this.stencilMask=new os(this),this.stencilFunc=new mo(this),this.stencilOp=new Ya(this),this.stencilTest=new Pt(this),this.depthRange=new xe(this),this.depthTest=new ce(this),this.depthFunc=new Te(this),this.blend=new j(this),this.blendFunc=new st(this),this.blendColor=new ar(this),this.blendEquation=new Jr(this),this.cullFace=new tt(this),this.cullFaceSide=new Ut(this),this.frontFace=new xr(this),this.program=new Cr(this),this.activeTexture=new Lr(this),this.viewport=new vn(this),this.bindFramebuffer=new vi(this),this.bindRenderbuffer=new ni(this),this.bindTexture=new An(this),this.bindVertexBuffer=new Oi(this),this.bindElementBuffer=new zi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Pa(this),this.pixelStoreUnpack=new ia(this),this.pixelStoreUnpackPremultiplyAlpha=new ao(this),this.pixelStoreUnpackFlipY=new Ci(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};Ie.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Ie.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Ie.prototype.createIndexBuffer=function(c,p){return new on(this,c,p)},Ie.prototype.createVertexBuffer=function(c,p,f){return new ra(this,c,p,f)},Ie.prototype.createRenderbuffer=function(c,p,f){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,c,p,f),this.bindRenderbuffer.set(null),S},Ie.prototype.createFramebuffer=function(c,p,f){return new _e(this,c,p,f)},Ie.prototype.clear=function(c){var p=c.color,f=c.depth,g=this.gl,S=0;p&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(p),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),g.clear(S)},Ie.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},Ie.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},Ie.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},Ie.prototype.setColorMode=function(c){y.deepEqual(c.blendFunction,ut.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},Ie.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var nt=function(c){function p(f,g,S){var I=this;c.call(this),this.id=f,this.dispatcher=S,this.on("data",function(R){R.dataType==="source"&&R.sourceDataType==="metadata"&&(I._sourceLoaded=!0),I._sourceLoaded&&!I._paused&&R.dataType==="source"&&R.sourceDataType==="content"&&(I.reload(),I.transform&&I.update(I.transform))}),this.on("error",function(){I._sourceErrored=!0}),this._source=function(R,z,q,ne){var Se=new Br[z.type](R,z,q,ne);if(Se.id!==R)throw new Error("Expected Source id to be "+R+" instead of "+Se.id);return y.bindAll(["load","abort","unload","serialize","prepare"],Se),Se}(f,g,S,this),this._tiles={},this._cache=new gi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},p.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},p.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var g=this._tiles[f];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},p.prototype.getSource=function(){return this._source},p.prototype.pause=function(){this._paused=!0},p.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},p.prototype._loadTile=function(f,g){return this._source.loadTile(f,g)},p.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},p.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},p.prototype.serialize=function(){return this._source.serialize()},p.prototype.prepare=function(f){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(f),S.prepare(this.map.style.imageManager)}},p.prototype.getIds=function(){return y.values(this._tiles).map(function(f){return f.tileID}).sort(Ht).map(function(f){return f.key})},p.prototype.getRenderableIds=function(f){var g=this,S=[];for(var I in this._tiles)this._isIdRenderable(I,f)&&S.push(this._tiles[I]);return f?S.sort(function(R,z){var q=R.tileID,ne=z.tileID,Se=new y.Point(q.canonical.x,q.canonical.y)._rotate(g.transform.angle),Me=new y.Point(ne.canonical.x,ne.canonical.y)._rotate(g.transform.angle);return q.overscaledZ-ne.overscaledZ||Me.y-Se.y||Me.x-Se.x}).map(function(R){return R.tileID.key}):S.map(function(R){return R.tileID}).sort(Ht).map(function(R){return R.key})},p.prototype.hasRenderableParent=function(f){var g=this.findLoadedParent(f,0);return!!g&&this._isIdRenderable(g.tileID.key)},p.prototype._isIdRenderable=function(f,g){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(g||!this._tiles[f].holdingForFade())},p.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},p.prototype._reloadTile=function(f,g){var S=this._tiles[f];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,f,g)))},p.prototype._tileLoaded=function(f,g,S,I){if(I)return f.state="errored",void(I.status!==404?this._source.fire(new y.ErrorEvent(I,{tile:f})):this.update(this.transform));f.timeAdded=y.browser.now(),S==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(g,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},p.prototype._backfillDEM=function(f){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var I=g[S];if(f.neighboringTiles&&f.neighboringTiles[I]){var R=this.getTileByID(I);z(f,R),z(R,f)}}function z(q,ne){q.needsHillshadePrepare=!0;var Se=ne.tileID.canonical.x-q.tileID.canonical.x,Me=ne.tileID.canonical.y-q.tileID.canonical.y,ye=Math.pow(2,q.tileID.canonical.z),Qe=ne.tileID.key;Se===0&&Me===0||Math.abs(Me)>1||(Math.abs(Se)>1&&(Math.abs(Se+ye)===1?Se+=ye:Math.abs(Se-ye)===1&&(Se-=ye)),ne.dem&&q.dem&&(q.dem.backfillBorder(ne.dem,Se,Me),q.neighboringTiles&&q.neighboringTiles[Qe]&&(q.neighboringTiles[Qe].backfilled=!0)))}},p.prototype.getTile=function(f){return this.getTileByID(f.key)},p.prototype.getTileByID=function(f){return this._tiles[f]},p.prototype._retainLoadedChildren=function(f,g,S,I){for(var R in this._tiles){var z=this._tiles[R];if(!(I[R]||!z.hasData()||z.tileID.overscaledZ<=g||z.tileID.overscaledZ>S)){for(var q=z.tileID;z&&z.tileID.overscaledZ>g+1;){var ne=z.tileID.scaledTo(z.tileID.overscaledZ-1);(z=this._tiles[ne.key])&&z.hasData()&&(q=ne)}for(var Se=q;Se.overscaledZ>g;)if(f[(Se=Se.scaledTo(Se.overscaledZ-1)).key]){I[q.key]=q;break}}}},p.prototype.findLoadedParent=function(f,g){if(f.key in this._loadedParentTiles){var S=this._loadedParentTiles[f.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var I=f.overscaledZ-1;I>=g;I--){var R=f.scaledTo(I),z=this._getLoadedTile(R);if(z)return z}},p.prototype._getLoadedTile=function(f){var g=this._tiles[f.key];return g&&g.hasData()?g:this._cache.getByKey(f.wrapped().key)},p.prototype.updateCacheSize=function(f){var g=Math.ceil(f.width/this._source.tileSize)+1,S=Math.ceil(f.height/this._source.tileSize)+1,I=Math.floor(g*S*5),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(R)},p.prototype.handleWrapJump=function(f){var g=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,g){var S={};for(var I in this._tiles){var R=this._tiles[I];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+g),S[R.tileID.key]=R}for(var z in this._tiles=S,this._timers)clearTimeout(this._timers[z]),delete this._timers[z];for(var q in this._tiles)this._setTileReloadTimer(q,this._tiles[q])}},p.prototype.update=function(f){var g=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Wr){return new y.OverscaledTileID(Wr.canonical.z,Wr.wrap,Wr.canonical.z,Wr.canonical.x,Wr.canonical.y)}):(S=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Wr){return g._source.hasTile(Wr)}))):S=[];var I=f.coveringZoomLevel(this._source),R=Math.max(I-p.maxOverzooming,this._source.minzoom),z=Math.max(I+p.maxUnderzooming,this._source.minzoom),q=this._updateRetainedTiles(S,I);if(jr(this._source.type)){for(var ne={},Se={},Me=0,ye=Object.keys(q);Me<ye.length;Me+=1){var Qe=ye[Me],qe=q[Qe],pt=this._tiles[Qe];if(pt&&!(pt.fadeEndTime&&pt.fadeEndTime<=y.browser.now())){var Xe=this.findLoadedParent(qe,R);Xe&&(this._addTile(Xe.tileID),ne[Xe.tileID.key]=Xe.tileID),Se[Qe]=qe}}for(var dt in this._retainLoadedChildren(Se,I,z,q),ne)q[dt]||(this._coveredTiles[dt]=!0,q[dt]=ne[dt])}for(var Ct in q)this._tiles[Ct].clearFadeHold();for(var Wt=0,vr=y.keysDifference(this._tiles,q);Wt<vr.length;Wt+=1){var er=vr[Wt],wr=this._tiles[er];wr.hasSymbolBuckets&&!wr.holdingForFade()?wr.setHoldDuration(this.map._fadeDuration):wr.hasSymbolBuckets&&!wr.symbolFadeFinished()||this._removeTile(er)}this._updateLoadedParentTileCache()}},p.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},p.prototype._updateRetainedTiles=function(f,g){for(var S={},I={},R=Math.max(g-p.maxOverzooming,this._source.minzoom),z=Math.max(g+p.maxUnderzooming,this._source.minzoom),q={},ne=0,Se=f;ne<Se.length;ne+=1){var Me=Se[ne],ye=this._addTile(Me);S[Me.key]=Me,ye.hasData()||g<this._source.maxzoom&&(q[Me.key]=Me)}this._retainLoadedChildren(q,g,z,S);for(var Qe=0,qe=f;Qe<qe.length;Qe+=1){var pt=qe[Qe],Xe=this._tiles[pt.key];if(!Xe.hasData()){if(g+1>this._source.maxzoom){var dt=pt.children(this._source.maxzoom)[0],Ct=this.getTile(dt);if(Ct&&Ct.hasData()){S[dt.key]=dt;continue}}else{var Wt=pt.children(this._source.maxzoom);if(S[Wt[0].key]&&S[Wt[1].key]&&S[Wt[2].key]&&S[Wt[3].key])continue}for(var vr=Xe.wasRequested(),er=pt.overscaledZ-1;er>=R;--er){var wr=pt.scaledTo(er);if(I[wr.key]||(I[wr.key]=!0,!(Xe=this.getTile(wr))&&vr&&(Xe=this._addTile(wr)),Xe&&(S[wr.key]=wr,vr=Xe.wasRequested(),Xe.hasData())))break}}}return S},p.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,I=this._tiles[f].tileID;I.overscaledZ>0;){if(I.key in this._loadedParentTiles){S=this._loadedParentTiles[I.key];break}g.push(I.key);var R=I.scaledTo(I.overscaledZ-1);if(S=this._getLoadedTile(R))break;I=R}for(var z=0,q=g;z<q.length;z+=1)this._loadedParentTiles[q[z]]=S}},p.prototype._addTile=function(f){var g=this._tiles[f.key];if(g)return g;(g=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,g),g.tileID=f,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,g)));var S=Boolean(g);return S||(g=new y.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,f.key,g.state))),g?(g.uses++,this._tiles[f.key]=g,S||this._source.fire(new y.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},p.prototype._setTileReloadTimer=function(f,g){var S=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var I=g.getExpiryTimeout();I&&(this._timers[f]=setTimeout(function(){S._reloadTile(f,"expired"),delete S._timers[f]},I))},p.prototype._removeTile=function(f){var g=this._tiles[f];g&&(g.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},p.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},p.prototype.tilesIn=function(f,g,S){var I=this,R=[],z=this.transform;if(!z)return R;for(var q=S?z.getCameraQueryGeometry(f):f,ne=f.map(function(er){return z.pointCoordinate(er)}),Se=q.map(function(er){return z.pointCoordinate(er)}),Me=this.getIds(),ye=1/0,Qe=1/0,qe=-1/0,pt=-1/0,Xe=0,dt=Se;Xe<dt.length;Xe+=1){var Ct=dt[Xe];ye=Math.min(ye,Ct.x),Qe=Math.min(Qe,Ct.y),qe=Math.max(qe,Ct.x),pt=Math.max(pt,Ct.y)}for(var Wt=function(er){var wr=I._tiles[Me[er]];if(!wr.holdingForFade()){var Wr=wr.tileID,bn=Math.pow(2,z.zoom-wr.tileID.overscaledZ),gn=g*wr.queryPadding*y.EXTENT/wr.tileSize/bn,Gn=[Wr.getTilePoint(new y.MercatorCoordinate(ye,Qe)),Wr.getTilePoint(new y.MercatorCoordinate(qe,pt))];if(Gn[0].x-gn<y.EXTENT&&Gn[0].y-gn<y.EXTENT&&Gn[1].x+gn>=0&&Gn[1].y+gn>=0){var xi=ne.map(function(bi){return Wr.getTilePoint(bi)}),Si=Se.map(function(bi){return Wr.getTilePoint(bi)});R.push({tile:wr,tileID:Wr,queryGeometry:xi,cameraQueryGeometry:Si,scale:bn})}}},vr=0;vr<Me.length;vr++)Wt(vr);return R},p.prototype.getVisibleCoordinates=function(f){for(var g=this,S=this.getRenderableIds(f).map(function(q){return g._tiles[q].tileID}),I=0,R=S;I<R.length;I+=1){var z=R[I];z.posMatrix=this.transform.calculatePosMatrix(z.toUnwrapped())}return S},p.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(jr(this._source.type))for(var f in this._tiles){var g=this._tiles[f];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=y.browser.now())return!0}return!1},p.prototype.setFeatureState=function(f,g,S){this._state.updateState(f=f||"_geojsonTileLayer",g,S)},p.prototype.removeFeatureState=function(f,g,S){this._state.removeFeatureState(f=f||"_geojsonTileLayer",g,S)},p.prototype.getFeatureState=function(f,g){return this._state.getState(f=f||"_geojsonTileLayer",g)},p.prototype.setDependencies=function(f,g,S){var I=this._tiles[f];I&&I.setDependencies(g,S)},p.prototype.reloadTilesForDependencies=function(f,g){for(var S in this._tiles)this._tiles[S].hasDependency(f,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(I){return!I.hasDependency(f,g)})},p}(y.Evented);function Ht(c,p){var f=Math.abs(2*c.wrap)-+(c.wrap<0),g=Math.abs(2*p.wrap)-+(p.wrap<0);return c.overscaledZ-p.overscaledZ||g-f||p.canonical.y-c.canonical.y||p.canonical.x-c.canonical.x}function jr(c){return c==="raster"||c==="image"||c==="video"}function ir(){return new y.window.Worker(ef.workerUrl)}nt.maxOverzooming=10,nt.maxUnderzooming=3;var pr="mapboxgl_preloaded_worker_pool",Hr=function(){this.active={}};Hr.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<Hr.workerCount;)this.workers.push(new ir);return this.active[c]=!0,this.workers.slice()},Hr.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(p){p.terminate()}),this.workers=null)},Hr.prototype.isPreloaded=function(){return!!this.active[pr]},Hr.prototype.numActive=function(){return Object.keys(this.active).length};var oi,wn=Math.floor(y.browser.hardwareConcurrency/2);function rr(){return oi||(oi=new Hr),oi}function Wn(c,p){var f={};for(var g in c)g!=="ref"&&(f[g]=c[g]);return y.refProperties.forEach(function(S){S in p&&(f[S]=p[S])}),f}function Mr(c){c=c.slice();for(var p=Object.create(null),f=0;f<c.length;f++)p[c[f].id]=c[f];for(var g=0;g<c.length;g++)"ref"in c[g]&&(c[g]=Wn(c[g],p[c[g].ref]));return c}Hr.workerCount=Math.max(Math.min(wn,6),1);var mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ea(c,p,f){f.push({command:mn.addSource,args:[c,p[c]]})}function Zn(c,p,f){p.push({command:mn.removeSource,args:[c]}),f[c]=!0}function na(c,p,f,g){Zn(c,f,g),ea(c,p,f)}function Zt(c,p,f){var g;for(g in c[f])if(c[f].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(c[f][g],p[f][g]))return!1;for(g in p[f])if(p[f].hasOwnProperty(g)&&g!=="data"&&!y.deepEqual(c[f][g],p[f][g]))return!1;return!0}function kt(c,p,f,g,S,I){var R;for(R in p=p||{},c=c||{})c.hasOwnProperty(R)&&(y.deepEqual(c[R],p[R])||f.push({command:I,args:[g,R,p[R],S]}));for(R in p)p.hasOwnProperty(R)&&!c.hasOwnProperty(R)&&(y.deepEqual(c[R],p[R])||f.push({command:I,args:[g,R,p[R],S]}))}function va(c){return c.id}function aa(c,p){return c[p.id]=p,c}var Fi=function(c,p){this.reset(c,p)};Fi.prototype.reset=function(c,p){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Fi.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=y.clamp(c,0,1);for(var p=1,f=this._distances[p],g=c*this.paddedLength+this.padding;f<g&&p<this._distances.length;)f=this._distances[++p];var S=p-1,I=this._distances[S],R=f-I,z=R>0?(g-I)/R:0;return this.points[S].mult(1-z).add(this.points[p].mult(z))};var Mi=function(c,p,f){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(p/f);for(var I=0;I<this.xCellCount*this.yCellCount;I++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=p,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0};function go(c,p,f,g,S){var I=y.create();return p?(y.scale(I,I,[1/S,1/S,1]),f||y.rotateZ(I,I,g.angle)):y.multiply(I,g.labelPlaneMatrix,c),I}function Ba(c,p,f,g,S){if(p){var I=y.clone(c);return y.scale(I,I,[S,S,1]),f||y.rotateZ(I,I,-g.angle),I}return g.glCoordMatrix}function Pr(c,p){var f=[c.x,c.y,0,1];Lo(f,f,p);var g=f[3];return{point:new y.Point(f[0]/g,f[1]/g),signedDistanceFromCamera:g}}function Or(c,p){return .5+c/p*.5}function Et(c,p){var f=c[0]/c[3],g=c[1]/c[3];return f>=-p[0]&&f<=p[0]&&g>=-p[1]&&g<=p[1]}function ss(c,p,f,g,S,I,R,z){var q=g?c.textSizeData:c.iconSizeData,ne=y.evaluateSizeForZoom(q,f.transform.zoom),Se=[256/f.width*2+1,256/f.height*2+1],Me=g?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Me.clear();for(var ye=c.lineVertexArray,Qe=g?c.text.placedSymbolArray:c.icon.placedSymbolArray,qe=f.transform.width/f.transform.height,pt=!1,Xe=0;Xe<Qe.length;Xe++){var dt=Qe.get(Xe);if(dt.hidden||dt.writingMode===y.WritingMode.vertical&&!pt)Ra(dt.numGlyphs,Me);else{pt=!1;var Ct=[dt.anchorX,dt.anchorY,0,1];if(y.transformMat4(Ct,Ct,p),Et(Ct,Se)){var Wt=Or(f.transform.cameraToCenterDistance,Ct[3]),vr=y.evaluateSizeForFeature(q,ne,dt),er=R?vr/Wt:vr*Wt,wr=new y.Point(dt.anchorX,dt.anchorY),Wr=Pr(wr,S).point,bn={},gn=yu(dt,er,!1,z,p,S,I,c.glyphOffsetArray,ye,Me,Wr,wr,bn,qe);pt=gn.useVertical,(gn.notEnoughRoom||pt||gn.needsFlipping&&yu(dt,er,!0,z,p,S,I,c.glyphOffsetArray,ye,Me,Wr,wr,bn,qe).notEnoughRoom)&&Ra(dt.numGlyphs,Me)}else Ra(dt.numGlyphs,Me)}}g?c.text.dynamicLayoutVertexBuffer.updateData(Me):c.icon.dynamicLayoutVertexBuffer.updateData(Me)}function bt(c,p,f,g,S,I,R,z,q,ne,Se){var Me=z.glyphStartIndex+z.numGlyphs,ye=z.lineStartIndex,Qe=z.lineStartIndex+z.lineLength,qe=p.getoffsetX(z.glyphStartIndex),pt=p.getoffsetX(Me-1),Xe=Bi(c*qe,f,g,S,I,R,z.segment,ye,Qe,q,ne,Se);if(!Xe)return null;var dt=Bi(c*pt,f,g,S,I,R,z.segment,ye,Qe,q,ne,Se);return dt?{first:Xe,last:dt}:null}function oo(c,p,f,g){return c===y.WritingMode.horizontal&&Math.abs(f.y-p.y)>Math.abs(f.x-p.x)*g?{useVertical:!0}:(c===y.WritingMode.vertical?p.y<f.y:p.x>f.x)?{needsFlipping:!0}:null}function yu(c,p,f,g,S,I,R,z,q,ne,Se,Me,ye,Qe){var qe,pt=p/24,Xe=c.lineOffsetX*pt,dt=c.lineOffsetY*pt;if(c.numGlyphs>1){var Ct=c.glyphStartIndex+c.numGlyphs,Wt=c.lineStartIndex,vr=c.lineStartIndex+c.lineLength,er=bt(pt,z,Xe,dt,f,Se,Me,c,q,I,ye);if(!er)return{notEnoughRoom:!0};var wr=Pr(er.first.point,R).point,Wr=Pr(er.last.point,R).point;if(g&&!f){var bn=oo(c.writingMode,wr,Wr,Qe);if(bn)return bn}qe=[er.first];for(var gn=c.glyphStartIndex+1;gn<Ct-1;gn++)qe.push(Bi(pt*z.getoffsetX(gn),Xe,dt,f,Se,Me,c.segment,Wt,vr,q,I,ye));qe.push(er.last)}else{if(g&&!f){var Gn=Pr(Me,S).point,xi=c.lineStartIndex+c.segment+1,Si=new y.Point(q.getx(xi),q.gety(xi)),bi=Pr(Si,S),Ea=bi.signedDistanceFromCamera>0?bi.point:Qo(Me,Si,Gn,1,S),Xn=oo(c.writingMode,Gn,Ea,Qe);if(Xn)return Xn}var Hi=Bi(pt*z.getoffsetX(c.glyphStartIndex),Xe,dt,f,Se,Me,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,q,I,ye);if(!Hi)return{notEnoughRoom:!0};qe=[Hi]}for(var Qi=0,Wi=qe;Qi<Wi.length;Qi+=1){var Ri=Wi[Qi];y.addDynamicAttributes(ne,Ri.point,Ri.angle)}return{}}function Qo(c,p,f,g,S){var I=Pr(c.add(c.sub(p)._unit()),S).point,R=f.sub(I);return f.add(R._mult(g/R.mag()))}function Bi(c,p,f,g,S,I,R,z,q,ne,Se,Me){var ye=g?c-p:c+p,Qe=ye>0?1:-1,qe=0;g&&(Qe*=-1,qe=Math.PI),Qe<0&&(qe+=Math.PI);for(var pt=Qe>0?z+R:z+R+1,Xe=S,dt=S,Ct=0,Wt=0,vr=Math.abs(ye),er=[];Ct+Wt<=vr;){if((pt+=Qe)<z||pt>=q)return null;if(dt=Xe,er.push(Xe),(Xe=Me[pt])===void 0){var wr=new y.Point(ne.getx(pt),ne.gety(pt)),Wr=Pr(wr,Se);if(Wr.signedDistanceFromCamera>0)Xe=Me[pt]=Wr.point;else{var bn=pt-Qe;Xe=Qo(Ct===0?I:new y.Point(ne.getx(bn),ne.gety(bn)),wr,dt,vr-Ct+1,Se)}}Ct+=Wt,Wt=dt.dist(Xe)}var gn=(vr-Ct)/Wt,Gn=Xe.sub(dt),xi=Gn.mult(gn)._add(dt);xi._add(Gn._unit()._perp()._mult(f*Qe));var Si=qe+Math.atan2(Xe.y-dt.y,Xe.x-dt.x);return er.push(xi),{point:xi,angle:Si,path:er}}Mi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Mi.prototype.insert=function(c,p,f,g,S){this._forEachCell(p,f,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(p),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(S)},Mi.prototype.insertCircle=function(c,p,f,g){this._forEachCell(p-g,f-g,p+g,f+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(p),this.circles.push(f),this.circles.push(g)},Mi.prototype._insertBoxCell=function(c,p,f,g,S,I){this.boxCells[S].push(I)},Mi.prototype._insertCircleCell=function(c,p,f,g,S,I){this.circleCells[S].push(I)},Mi.prototype._query=function(c,p,f,g,S,I){if(f<0||c>this.width||g<0||p>this.height)return!S&&[];var R=[];if(c<=0&&p<=0&&this.width<=f&&this.height<=g){if(S)return!0;for(var z=0;z<this.boxKeys.length;z++)R.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(var q=0;q<this.circleKeys.length;q++){var ne=this.circles[3*q],Se=this.circles[3*q+1],Me=this.circles[3*q+2];R.push({key:this.circleKeys[q],x1:ne-Me,y1:Se-Me,x2:ne+Me,y2:Se+Me})}return I?R.filter(I):R}return this._forEachCell(c,p,f,g,this._queryCell,R,{hitTest:S,seenUids:{box:{},circle:{}}},I),S?R.length>0:R},Mi.prototype._queryCircle=function(c,p,f,g,S){var I=c-f,R=c+f,z=p-f,q=p+f;if(R<0||I>this.width||q<0||z>this.height)return!g&&[];var ne=[];return this._forEachCell(I,z,R,q,this._queryCellCircle,ne,{hitTest:g,circle:{x:c,y:p,radius:f},seenUids:{box:{},circle:{}}},S),g?ne.length>0:ne},Mi.prototype.query=function(c,p,f,g,S){return this._query(c,p,f,g,!1,S)},Mi.prototype.hitTest=function(c,p,f,g,S){return this._query(c,p,f,g,!0,S)},Mi.prototype.hitTestCircle=function(c,p,f,g){return this._queryCircle(c,p,f,!0,g)},Mi.prototype._queryCell=function(c,p,f,g,S,I,R,z){var q=R.seenUids,ne=this.boxCells[S];if(ne!==null)for(var Se=this.bboxes,Me=0,ye=ne;Me<ye.length;Me+=1){var Qe=ye[Me];if(!q.box[Qe]){q.box[Qe]=!0;var qe=4*Qe;if(c<=Se[qe+2]&&p<=Se[qe+3]&&f>=Se[qe+0]&&g>=Se[qe+1]&&(!z||z(this.boxKeys[Qe]))){if(R.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Qe],x1:Se[qe],y1:Se[qe+1],x2:Se[qe+2],y2:Se[qe+3]})}}}var pt=this.circleCells[S];if(pt!==null)for(var Xe=this.circles,dt=0,Ct=pt;dt<Ct.length;dt+=1){var Wt=Ct[dt];if(!q.circle[Wt]){q.circle[Wt]=!0;var vr=3*Wt;if(this._circleAndRectCollide(Xe[vr],Xe[vr+1],Xe[vr+2],c,p,f,g)&&(!z||z(this.circleKeys[Wt]))){if(R.hitTest)return I.push(!0),!0;var er=Xe[vr],wr=Xe[vr+1],Wr=Xe[vr+2];I.push({key:this.circleKeys[Wt],x1:er-Wr,y1:wr-Wr,x2:er+Wr,y2:wr+Wr})}}}},Mi.prototype._queryCellCircle=function(c,p,f,g,S,I,R,z){var q=R.circle,ne=R.seenUids,Se=this.boxCells[S];if(Se!==null)for(var Me=this.bboxes,ye=0,Qe=Se;ye<Qe.length;ye+=1){var qe=Qe[ye];if(!ne.box[qe]){ne.box[qe]=!0;var pt=4*qe;if(this._circleAndRectCollide(q.x,q.y,q.radius,Me[pt+0],Me[pt+1],Me[pt+2],Me[pt+3])&&(!z||z(this.boxKeys[qe])))return I.push(!0),!0}}var Xe=this.circleCells[S];if(Xe!==null)for(var dt=this.circles,Ct=0,Wt=Xe;Ct<Wt.length;Ct+=1){var vr=Wt[Ct];if(!ne.circle[vr]){ne.circle[vr]=!0;var er=3*vr;if(this._circlesCollide(dt[er],dt[er+1],dt[er+2],q.x,q.y,q.radius)&&(!z||z(this.circleKeys[vr])))return I.push(!0),!0}}},Mi.prototype._forEachCell=function(c,p,f,g,S,I,R,z){for(var q=this._convertToXCellCoord(c),ne=this._convertToYCellCoord(p),Se=this._convertToXCellCoord(f),Me=this._convertToYCellCoord(g),ye=q;ye<=Se;ye++)for(var Qe=ne;Qe<=Me;Qe++)if(S.call(this,c,p,f,g,this.xCellCount*Qe+ye,I,R,z))return},Mi.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Mi.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Mi.prototype._circlesCollide=function(c,p,f,g,S,I){var R=g-c,z=S-p,q=f+I;return q*q>R*R+z*z},Mi.prototype._circleAndRectCollide=function(c,p,f,g,S,I,R){var z=(I-g)/2,q=Math.abs(c-(g+z));if(q>z+f)return!1;var ne=(R-S)/2,Se=Math.abs(p-(S+ne));if(Se>ne+f)return!1;if(q<=z||Se<=ne)return!0;var Me=q-z,ye=Se-ne;return Me*Me+ye*ye<=f*f};var ml=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ra(c,p){for(var f=0;f<c;f++){var g=p.length;p.resize(g+4),p.float32.set(ml,3*g)}}function Lo(c,p,f){var g=p[0],S=p[1];return c[0]=f[0]*g+f[4]*S+f[12],c[1]=f[1]*g+f[5]*S+f[13],c[3]=f[3]*g+f[7]*S+f[15],c}var Do=function(c,p,f){p===void 0&&(p=new Mi(c.width+200,c.height+200,25)),f===void 0&&(f=new Mi(c.width+200,c.height+200,25)),this.transform=c,this.grid=p,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function ba(c,p,f){return p*(y.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}Do.prototype.placeCollisionBox=function(c,p,f,g,S){var I=this.projectAndGetPerspectiveRatio(g,c.anchorPointX,c.anchorPointY),R=f*I.perspectiveRatio,z=c.x1*R+I.point.x,q=c.y1*R+I.point.y,ne=c.x2*R+I.point.x,Se=c.y2*R+I.point.y;return!this.isInsideGrid(z,q,ne,Se)||!p&&this.grid.hitTest(z,q,ne,Se,S)?{box:[],offscreen:!1}:{box:[z,q,ne,Se],offscreen:this.isOffscreen(z,q,ne,Se)}},Do.prototype.placeCollisionCircles=function(c,p,f,g,S,I,R,z,q,ne,Se,Me,ye){var Qe=[],qe=new y.Point(p.anchorX,p.anchorY),pt=Pr(qe,I),Xe=Or(this.transform.cameraToCenterDistance,pt.signedDistanceFromCamera),dt=(ne?S/Xe:S*Xe)/y.ONE_EM,Ct=Pr(qe,R).point,Wt=bt(dt,g,p.lineOffsetX*dt,p.lineOffsetY*dt,!1,Ct,qe,p,f,R,{}),vr=!1,er=!1,wr=!0;if(Wt){for(var Wr=.5*Me*Xe+ye,bn=new y.Point(-100,-100),gn=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Gn=new Fi,xi=Wt.first,Si=Wt.last,bi=[],Ea=xi.path.length-1;Ea>=1;Ea--)bi.push(xi.path[Ea]);for(var Xn=1;Xn<Si.path.length;Xn++)bi.push(Si.path[Xn]);var Hi=2.5*Wr;if(z){var Qi=bi.map(function(Cu){return Pr(Cu,z)});bi=Qi.some(function(Cu){return Cu.signedDistanceFromCamera<=0})?[]:Qi.map(function(Cu){return Cu.point})}var Wi=[];if(bi.length>0){for(var Ri=bi[0].clone(),oa=bi[0].clone(),Zi=1;Zi<bi.length;Zi++)Ri.x=Math.min(Ri.x,bi[Zi].x),Ri.y=Math.min(Ri.y,bi[Zi].y),oa.x=Math.max(oa.x,bi[Zi].x),oa.y=Math.max(oa.y,bi[Zi].y);Wi=Ri.x>=bn.x&&oa.x<=gn.x&&Ri.y>=bn.y&&oa.y<=gn.y?[bi]:oa.x<bn.x||Ri.x>gn.x||oa.y<bn.y||Ri.y>gn.y?[]:y.clipLine([bi],bn.x,bn.y,gn.x,gn.y)}for(var wi=0,us=Wi;wi<us.length;wi+=1){var Wo;Gn.reset(us[wi],.25*Wr),Wo=Gn.length<=.5*Wr?1:Math.ceil(Gn.paddedLength/Hi)+1;for(var Ds=0;Ds<Wo;Ds++){var ls=Ds/Math.max(Wo-1,1),co=Gn.lerp(ls),Jo=co.x+100,es=co.y+100;Qe.push(Jo,es,Wr,0);var Bs=Jo-Wr,uc=es-Wr,ru=Jo+Wr,Hu=es+Wr;if(wr=wr&&this.isOffscreen(Bs,uc,ru,Hu),er=er||this.isInsideGrid(Bs,uc,ru,Hu),!c&&this.grid.hitTestCircle(Jo,es,Wr,Se)&&(vr=!0,!q))return{circles:[],offscreen:!1,collisionDetected:vr}}}}return{circles:!q&&vr||!er?[]:Qe,offscreen:wr,collisionDetected:vr}},Do.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var p=[],f=1/0,g=1/0,S=-1/0,I=-1/0,R=0,z=c;R<z.length;R+=1){var q=z[R],ne=new y.Point(q.x+100,q.y+100);f=Math.min(f,ne.x),g=Math.min(g,ne.y),S=Math.max(S,ne.x),I=Math.max(I,ne.y),p.push(ne)}for(var Se={},Me={},ye=0,Qe=this.grid.query(f,g,S,I).concat(this.ignoredGrid.query(f,g,S,I));ye<Qe.length;ye+=1){var qe=Qe[ye],pt=qe.key;if(Se[pt.bucketInstanceId]===void 0&&(Se[pt.bucketInstanceId]={}),!Se[pt.bucketInstanceId][pt.featureIndex]){var Xe=[new y.Point(qe.x1,qe.y1),new y.Point(qe.x2,qe.y1),new y.Point(qe.x2,qe.y2),new y.Point(qe.x1,qe.y2)];y.polygonIntersectsPolygon(p,Xe)&&(Se[pt.bucketInstanceId][pt.featureIndex]=!0,Me[pt.bucketInstanceId]===void 0&&(Me[pt.bucketInstanceId]=[]),Me[pt.bucketInstanceId].push(pt.featureIndex))}}return Me},Do.prototype.insertCollisionBox=function(c,p,f,g,S){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:S},c[0],c[1],c[2],c[3])},Do.prototype.insertCollisionCircles=function(c,p,f,g,S){for(var I=p?this.ignoredGrid:this.grid,R={bucketInstanceId:f,featureIndex:g,collisionGroupID:S},z=0;z<c.length;z+=4)I.insertCircle(R,c[z],c[z+1],c[z+2])},Do.prototype.projectAndGetPerspectiveRatio=function(c,p,f){var g=[p,f,0,1];return Lo(g,g,c),{point:new y.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},Do.prototype.isOffscreen=function(c,p,f,g){return f<100||c>=this.screenRightBoundary||g<100||p>this.screenBottomBoundary},Do.prototype.isInsideGrid=function(c,p,f,g){return f>=0&&c<this.gridRightBoundary&&g>=0&&p<this.gridBottomBoundary},Do.prototype.getViewportMatrix=function(){var c=y.identity([]);return y.translate(c,c,[-100,-100,0]),c};var Ps=function(c,p,f,g){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?p:-p))):g&&f?1:0,this.placed=f};Ps.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ls=function(c,p,f,g,S){this.text=new Ps(c?c.text:null,p,f,S),this.icon=new Ps(c?c.icon:null,p,g,S)};Ls.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ql=function(c,p,f){this.text=c,this.icon=p,this.skipFade=f},fo=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},ds=function(c,p,f,g,S){this.bucketInstanceId=c,this.featureIndex=p,this.sourceLayerIndex=f,this.bucketIndex=g,this.tileID=S},Va=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function Bo(c,p,f,g,S){var I=y.getAnchorAlignment(c),R=-(I.horizontalAlign-.5)*p,z=-(I.verticalAlign-.5)*f,q=y.evaluateVariableOffset(c,g);return new y.Point(R+q[0]*S,z+q[1]*S)}function vs(c,p,f,g,S,I){var R=c.x1,z=c.x2,q=c.y1,ne=c.y2,Se=c.anchorPointX,Me=c.anchorPointY,ye=new y.Point(p,f);return g&&ye._rotate(S?I:-I),{x1:R+ye.x,y1:q+ye.y,x2:z+ye.x,y2:ne+ye.y,anchorPointX:Se,anchorPointY:Me}}Va.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var p=++this.maxGroupID;this.collisionGroups[c]={ID:p,predicate:function(f){return f.collisionGroupID===p}}}return this.collisionGroups[c]};var No=function(c,p,f,g){this.transform=c.clone(),this.collisionIndex=new Do(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Va(f),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function Qu(c,p,f,g,S){c.emplaceBack(p?1:0,f?1:0,g||0,S||0),c.emplaceBack(p?1:0,f?1:0,g||0,S||0),c.emplaceBack(p?1:0,f?1:0,g||0,S||0),c.emplaceBack(p?1:0,f?1:0,g||0,S||0)}No.prototype.getBucketParts=function(c,p,f,g){var S=f.getBucket(p),I=f.latestFeatureIndex;if(S&&I&&p.id===S.layerIds[0]){var R=f.collisionBoxArray,z=S.layers[0].layout,q=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),ne=f.tileSize/y.EXTENT,Se=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),Me=z.get("text-pitch-alignment")==="map",ye=z.get("text-rotation-alignment")==="map",Qe=ba(f,1,this.transform.zoom),qe=go(Se,Me,ye,this.transform,Qe),pt=null;if(Me){var Xe=Ba(Se,Me,ye,this.transform,Qe);pt=y.multiply([],this.transform.labelPlaneMatrix,Xe)}this.retainedQueryData[S.bucketInstanceId]=new ds(S.bucketInstanceId,I,S.sourceLayerIndex,S.index,f.tileID);var dt={bucket:S,layout:z,posMatrix:Se,textLabelPlaneMatrix:qe,labelToScreenMatrix:pt,scale:q,textPixelRatio:ne,holdingForFade:f.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var Ct=0,Wt=S.sortKeyRanges;Ct<Wt.length;Ct+=1){var vr=Wt[Ct];c.push({sortKey:vr.sortKey,symbolInstanceStart:vr.symbolInstanceStart,symbolInstanceEnd:vr.symbolInstanceEnd,parameters:dt})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:dt})}},No.prototype.attemptAnchorPlacement=function(c,p,f,g,S,I,R,z,q,ne,Se,Me,ye,Qe,qe){var pt,Xe=[Me.textOffset0,Me.textOffset1],dt=Bo(c,f,g,Xe,S),Ct=this.collisionIndex.placeCollisionBox(vs(p,dt.x,dt.y,I,R,this.transform.angle),Se,z,q,ne.predicate);if(!qe||this.collisionIndex.placeCollisionBox(vs(qe,dt.x,dt.y,I,R,this.transform.angle),Se,z,q,ne.predicate).box.length!==0)return Ct.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Me.crossTileID]&&this.prevPlacement.placements[Me.crossTileID]&&this.prevPlacement.placements[Me.crossTileID].text&&(pt=this.prevPlacement.variableOffsets[Me.crossTileID].anchor),this.variableOffsets[Me.crossTileID]={textOffset:Xe,width:f,height:g,anchor:c,textBoxScale:S,prevAnchor:pt},this.markUsedJustification(ye,c,Me,Qe),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,Qe,Me),this.placedOrientations[Me.crossTileID]=Qe),{shift:dt,placedGlyphBoxes:Ct}):void 0},No.prototype.placeLayerBucketPart=function(c,p,f){var g=this,S=c.parameters,I=S.bucket,R=S.layout,z=S.posMatrix,q=S.textLabelPlaneMatrix,ne=S.labelToScreenMatrix,Se=S.textPixelRatio,Me=S.holdingForFade,ye=S.collisionBoxArray,Qe=S.partiallyEvaluatedTextSize,qe=S.collisionGroup,pt=R.get("text-optional"),Xe=R.get("icon-optional"),dt=R.get("text-allow-overlap"),Ct=R.get("icon-allow-overlap"),Wt=R.get("text-rotation-alignment")==="map",vr=R.get("text-pitch-alignment")==="map",er=R.get("icon-text-fit")!=="none",wr=R.get("symbol-z-order")==="viewport-y",Wr=dt&&(Ct||!I.hasIconData()||Xe),bn=Ct&&(dt||!I.hasTextData()||pt);!I.collisionArrays&&ye&&I.deserializeCollisionBoxes(ye);var gn=function(Xn,Hi){if(!p[Xn.crossTileID])if(Me)g.placements[Xn.crossTileID]=new Ql(!1,!1,!1);else{var Qi,Wi=!1,Ri=!1,oa=!0,Zi=null,wi={box:null,offscreen:null},us={box:null,offscreen:null},Wo=null,Ds=null,ls=0,co=0,Jo=0;Hi.textFeatureIndex?ls=Hi.textFeatureIndex:Xn.useRuntimeCollisionCircles&&(ls=Xn.featureIndex),Hi.verticalTextFeatureIndex&&(co=Hi.verticalTextFeatureIndex);var es=Hi.textBox;if(es){var Bs=function(Na){var Ru=y.WritingMode.horizontal;if(I.allowVerticalPlacement&&!Na&&g.prevPlacement){var qs=g.prevPlacement.placedOrientations[Xn.crossTileID];qs&&(g.placedOrientations[Xn.crossTileID]=qs,g.markUsedOrientation(I,Ru=qs,Xn))}return Ru},uc=function(Na,Ru){if(I.allowVerticalPlacement&&Xn.numVerticalGlyphVertices>0&&Hi.verticalTextBox)for(var qs=0,fc=I.writingModes;qs<fc.length&&(fc[qs]===y.WritingMode.vertical?(wi=Ru(),us=wi):wi=Na(),!(wi&&wi.box&&wi.box.length));qs+=1);else wi=Na()};if(R.get("text-variable-anchor")){var ru=R.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[Xn.crossTileID]){var Hu=g.prevPlacement.variableOffsets[Xn.crossTileID];ru.indexOf(Hu.anchor)>0&&(ru=ru.filter(function(Na){return Na!==Hu.anchor})).unshift(Hu.anchor)}var Cu=function(Na,Ru,qs){for(var fc=Na.x2-Na.x1,rh=Na.y2-Na.y1,Lf=Xn.textBoxScale,Sp=er&&!Ct?Ru:null,Wu={box:[],offscreen:!1},Fc=dt?2*ru.length:ru.length,Su=0;Su<Fc;++Su){var Rf=g.attemptAnchorPlacement(ru[Su%ru.length],Na,fc,rh,Lf,Wt,vr,Se,z,qe,Su>=ru.length,Xn,I,qs,Sp);if(Rf&&(Wu=Rf.placedGlyphBoxes)&&Wu.box&&Wu.box.length){Wi=!0,Zi=Rf.shift;break}}return Wu};uc(function(){return Cu(es,Hi.iconBox,y.WritingMode.horizontal)},function(){var Na=Hi.verticalTextBox;return I.allowVerticalPlacement&&!(wi&&wi.box&&wi.box.length)&&Xn.numVerticalGlyphVertices>0&&Na?Cu(Na,Hi.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),wi&&(Wi=wi.box,oa=wi.offscreen);var kf=Bs(wi&&wi.box);if(!Wi&&g.prevPlacement){var lc=g.prevPlacement.variableOffsets[Xn.crossTileID];lc&&(g.variableOffsets[Xn.crossTileID]=lc,g.markUsedJustification(I,lc.anchor,Xn,kf))}}else{var Wl=function(Na,Ru){var qs=g.collisionIndex.placeCollisionBox(Na,dt,Se,z,qe.predicate);return qs&&qs.box&&qs.box.length&&(g.markUsedOrientation(I,Ru,Xn),g.placedOrientations[Xn.crossTileID]=Ru),qs};uc(function(){return Wl(es,y.WritingMode.horizontal)},function(){var Na=Hi.verticalTextBox;return I.allowVerticalPlacement&&Xn.numVerticalGlyphVertices>0&&Na?Wl(Na,y.WritingMode.vertical):{box:null,offscreen:null}}),Bs(wi&&wi.box&&wi.box.length)}}if(Wi=(Qi=wi)&&Qi.box&&Qi.box.length>0,oa=Qi&&Qi.offscreen,Xn.useRuntimeCollisionCircles){var wl=I.text.placedSymbolArray.get(Xn.centerJustifiedTextSymbolIndex),Pf=y.evaluateSizeForFeature(I.textSizeData,Qe,wl),cl=R.get("text-padding");Wo=g.collisionIndex.placeCollisionCircles(dt,wl,I.lineVertexArray,I.glyphOffsetArray,Pf,z,q,ne,f,vr,qe.predicate,Xn.collisionCircleDiameter,cl),Wi=dt||Wo.circles.length>0&&!Wo.collisionDetected,oa=oa&&Wo.offscreen}if(Hi.iconFeatureIndex&&(Jo=Hi.iconFeatureIndex),Hi.iconBox){var cc=function(Na){var Ru=er&&Zi?vs(Na,Zi.x,Zi.y,Wt,vr,g.transform.angle):Na;return g.collisionIndex.placeCollisionBox(Ru,Ct,Se,z,qe.predicate)};Ri=us&&us.box&&us.box.length&&Hi.verticalIconBox?(Ds=cc(Hi.verticalIconBox)).box.length>0:(Ds=cc(Hi.iconBox)).box.length>0,oa=oa&&Ds.offscreen}var Xl=pt||Xn.numHorizontalGlyphVertices===0&&Xn.numVerticalGlyphVertices===0,cs=Xe||Xn.numIconVertices===0;if(Xl||cs?cs?Xl||(Ri=Ri&&Wi):Wi=Ri&&Wi:Ri=Wi=Ri&&Wi,Wi&&Qi&&Qi.box&&g.collisionIndex.insertCollisionBox(Qi.box,R.get("text-ignore-placement"),I.bucketInstanceId,us&&us.box&&co?co:ls,qe.ID),Ri&&Ds&&g.collisionIndex.insertCollisionBox(Ds.box,R.get("icon-ignore-placement"),I.bucketInstanceId,Jo,qe.ID),Wo&&(Wi&&g.collisionIndex.insertCollisionCircles(Wo.circles,R.get("text-ignore-placement"),I.bucketInstanceId,ls,qe.ID),f)){var Tl=I.bucketInstanceId,Oc=g.collisionCircleArrays[Tl];Oc===void 0&&(Oc=g.collisionCircleArrays[Tl]=new fo);for(var Ns=0;Ns<Wo.circles.length;Ns+=4)Oc.circles.push(Wo.circles[Ns+0]),Oc.circles.push(Wo.circles[Ns+1]),Oc.circles.push(Wo.circles[Ns+2]),Oc.circles.push(Wo.collisionDetected?1:0)}g.placements[Xn.crossTileID]=new Ql(Wi||Wr,Ri||bn,oa||I.justReloaded),p[Xn.crossTileID]=!0}};if(wr)for(var Gn=I.getSortedSymbolIndexes(this.transform.angle),xi=Gn.length-1;xi>=0;--xi){var Si=Gn[xi];gn(I.symbolInstances.get(Si),I.collisionArrays[Si])}else for(var bi=c.symbolInstanceStart;bi<c.symbolInstanceEnd;bi++)gn(I.symbolInstances.get(bi),I.collisionArrays[bi]);if(f&&I.bucketInstanceId in this.collisionCircleArrays){var Ea=this.collisionCircleArrays[I.bucketInstanceId];y.invert(Ea.invProjMatrix,z),Ea.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1},No.prototype.markUsedJustification=function(c,p,f,g){var S;S=g===y.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(p)];for(var I=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];I<R.length;I+=1){var z=R[I];z>=0&&(c.text.placedSymbolArray.get(z).crossTileID=S>=0&&z!==S?0:f.crossTileID)}},No.prototype.markUsedOrientation=function(c,p,f){for(var g=p===y.WritingMode.horizontal||p===y.WritingMode.horizontalOnly?p:0,S=p===y.WritingMode.vertical?p:0,I=0,R=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];I<R.length;I+=1)c.text.placedSymbolArray.get(R[I]).placedOrientation=g;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)},No.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var p=this.prevPlacement,f=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;var g=p?p.symbolFadeChange(c):1,S=p?p.opacities:{},I=p?p.variableOffsets:{},R=p?p.placedOrientations:{};for(var z in this.placements){var q=this.placements[z],ne=S[z];ne?(this.opacities[z]=new Ls(ne,g,q.text,q.icon),f=f||q.text!==ne.text.placed||q.icon!==ne.icon.placed):(this.opacities[z]=new Ls(null,g,q.text,q.icon,q.skipFade),f=f||q.text||q.icon)}for(var Se in S){var Me=S[Se];if(!this.opacities[Se]){var ye=new Ls(Me,g,!1,!1);ye.isHidden()||(this.opacities[Se]=ye,f=f||Me.text.placed||Me.icon.placed)}}for(var Qe in I)this.variableOffsets[Qe]||!this.opacities[Qe]||this.opacities[Qe].isHidden()||(this.variableOffsets[Qe]=I[Qe]);for(var qe in R)this.placedOrientations[qe]||!this.opacities[qe]||this.opacities[qe].isHidden()||(this.placedOrientations[qe]=R[qe]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:c)},No.prototype.updateLayerOpacities=function(c,p){for(var f={},g=0,S=p;g<S.length;g+=1){var I=S[g],R=I.getBucket(c);R&&I.latestFeatureIndex&&c.id===R.layerIds[0]&&this.updateBucketOpacities(R,f,I.collisionBoxArray)}},No.prototype.updateBucketOpacities=function(c,p,f){var g=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var S=c.layers[0].layout,I=new Ls(null,0,!1,!1,!0),R=S.get("text-allow-overlap"),z=S.get("icon-allow-overlap"),q=S.get("text-variable-anchor"),ne=S.get("text-rotation-alignment")==="map",Se=S.get("text-pitch-alignment")==="map",Me=S.get("icon-text-fit")!=="none",ye=new Ls(null,0,R&&(z||!c.hasIconData()||S.get("icon-optional")),z&&(R||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var Qe=function(dt,Ct,Wt){for(var vr=0;vr<Ct/4;vr++)dt.opacityVertexArray.emplaceBack(Wt)},qe=function(dt){var Ct=c.symbolInstances.get(dt),Wt=Ct.numHorizontalGlyphVertices,vr=Ct.numVerticalGlyphVertices,er=Ct.crossTileID,wr=g.opacities[er];p[er]?wr=I:wr||(g.opacities[er]=wr=ye),p[er]=!0;var Wr=Ct.numIconVertices>0,bn=g.placedOrientations[Ct.crossTileID],gn=bn===y.WritingMode.vertical,Gn=bn===y.WritingMode.horizontal||bn===y.WritingMode.horizontalOnly;if(Wt>0||vr>0){var xi=ti(wr.text);Qe(c.text,Wt,gn?ya:xi),Qe(c.text,vr,Gn?ya:xi);var Si=wr.text.isHidden();[Ct.rightJustifiedTextSymbolIndex,Ct.centerJustifiedTextSymbolIndex,Ct.leftJustifiedTextSymbolIndex].forEach(function(wi){wi>=0&&(c.text.placedSymbolArray.get(wi).hidden=Si||gn?1:0)}),Ct.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Ct.verticalPlacedTextSymbolIndex).hidden=Si||Gn?1:0);var bi=g.variableOffsets[Ct.crossTileID];bi&&g.markUsedJustification(c,bi.anchor,Ct,bn);var Ea=g.placedOrientations[Ct.crossTileID];Ea&&(g.markUsedJustification(c,"left",Ct,Ea),g.markUsedOrientation(c,Ea,Ct))}if(Wr){var Xn=ti(wr.icon),Hi=!(Me&&Ct.verticalPlacedIconSymbolIndex&&gn);Ct.placedIconSymbolIndex>=0&&(Qe(c.icon,Ct.numIconVertices,Hi?Xn:ya),c.icon.placedSymbolArray.get(Ct.placedIconSymbolIndex).hidden=wr.icon.isHidden()),Ct.verticalPlacedIconSymbolIndex>=0&&(Qe(c.icon,Ct.numVerticalIconVertices,Hi?ya:Xn),c.icon.placedSymbolArray.get(Ct.verticalPlacedIconSymbolIndex).hidden=wr.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var Qi=c.collisionArrays[dt];if(Qi){var Wi=new y.Point(0,0);if(Qi.textBox||Qi.verticalTextBox){var Ri=!0;if(q){var oa=g.variableOffsets[er];oa?(Wi=Bo(oa.anchor,oa.width,oa.height,oa.textOffset,oa.textBoxScale),ne&&Wi._rotate(Se?g.transform.angle:-g.transform.angle)):Ri=!1}Qi.textBox&&Qu(c.textCollisionBox.collisionVertexArray,wr.text.placed,!Ri||gn,Wi.x,Wi.y),Qi.verticalTextBox&&Qu(c.textCollisionBox.collisionVertexArray,wr.text.placed,!Ri||Gn,Wi.x,Wi.y)}var Zi=Boolean(!Gn&&Qi.verticalIconBox);Qi.iconBox&&Qu(c.iconCollisionBox.collisionVertexArray,wr.icon.placed,Zi,Me?Wi.x:0,Me?Wi.y:0),Qi.verticalIconBox&&Qu(c.iconCollisionBox.collisionVertexArray,wr.icon.placed,!Zi,Me?Wi.x:0,Me?Wi.y:0)}}},pt=0;pt<c.symbolInstances.length;pt++)qe(pt);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var Xe=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Xe.invProjMatrix,c.placementViewportMatrix=Xe.viewportMatrix,c.collisionCircleArray=Xe.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},No.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},No.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},No.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},No.prototype.stillRecent=function(c,p){var f=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*f>c},No.prototype.setStale=function(){this.stale=!0};var Zu=Math.pow(2,25),Vo=Math.pow(2,24),me=Math.pow(2,17),De=Math.pow(2,16),_t=Math.pow(2,9),lr=Math.pow(2,8),xn=Math.pow(2,1);function ti(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var p=c.placed?1:0,f=Math.floor(127*c.opacity);return f*Zu+p*Vo+f*me+p*De+f*_t+p*lr+f*xn+p}var ya=0,jo=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};jo.prototype.continuePlacement=function(c,p,f,g,S){for(var I=this._bucketParts;this._currentTileIndex<c.length;)if(p.getBucketParts(I,g,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(function(R,z){return R.sortKey-z.sortKey}));this._currentPartIndex<I.length;)if(p.placeLayerBucketPart(I[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1};var Oa=function(c,p,f,g,S,I,R){this.placement=new No(c,S,I,R),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1};Oa.prototype.isDone=function(){return this._done},Oa.prototype.continuePlacement=function(c,p,f){for(var g=this,S=y.browser.now(),I=function(){var q=y.browser.now()-S;return!g._forceFullPlacement&&q>2};this._currentPlacementIndex>=0;){var R=p[c[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=z)&&(!R.maxzoom||R.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new jo(R)),this._inProgressLayer.continuePlacement(f[R.source],this.placement,this._showCollisionBoxes,R,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Oa.prototype.commit=function(c){return this.placement.commit(c),this.placement};var zo=512/y.EXTENT/2,So=function(c,p,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var g=0;g<p.length;g++){var S=p.get(g),I=S.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,c)})}};So.prototype.getScaledCoordinates=function(c,p){var f=zo/Math.pow(2,p.canonical.z-this.tileID.canonical.z);return{x:Math.floor((p.canonical.x*y.EXTENT+c.anchorX)*f),y:Math.floor((p.canonical.y*y.EXTENT+c.anchorY)*f)}},So.prototype.findMatches=function(c,p,f){for(var g=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z),S=0;S<c.length;S++){var I=c.get(S);if(!I.crossTileID){var R=this.indexedSymbolInstances[I.key];if(R)for(var z=this.getScaledCoordinates(I,p),q=0,ne=R;q<ne.length;q+=1){var Se=ne[q];if(Math.abs(Se.coord.x-z.x)<=g&&Math.abs(Se.coord.y-z.y)<=g&&!f[Se.crossTileID]){f[Se.crossTileID]=!0,I.crossTileID=Se.crossTileID;break}}}}};var so=function(){this.maxCrossTileID=0};so.prototype.generate=function(){return++this.maxCrossTileID};var Rs=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Rs.prototype.handleWrapJump=function(c){var p=Math.round((c-this.lng)/360);if(p!==0)for(var f in this.indexes){var g=this.indexes[f],S={};for(var I in g){var R=g[I];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+p),S[R.tileID.key]=R}this.indexes[f]=S}this.lng=c},Rs.prototype.addBucket=function(c,p,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var g=0;g<p.symbolInstances.length;g++)p.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var S=this.usedCrossTileIDs[c.overscaledZ];for(var I in this.indexes){var R=this.indexes[I];if(Number(I)>c.overscaledZ)for(var z in R){var q=R[z];q.tileID.isChildOf(c)&&q.findMatches(p.symbolInstances,c,S)}else{var ne=R[c.scaledTo(Number(I)).key];ne&&ne.findMatches(p.symbolInstances,c,S)}}for(var Se=0;Se<p.symbolInstances.length;Se++){var Me=p.symbolInstances.get(Se);Me.crossTileID||(Me.crossTileID=f.generate(),S[Me.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new So(c,p.symbolInstances,p.bucketInstanceId),!0},Rs.prototype.removeBucketCrossTileIDs=function(c,p){for(var f in p.indexedSymbolInstances)for(var g=0,S=p.indexedSymbolInstances[f];g<S.length;g+=1)delete this.usedCrossTileIDs[c][S[g].crossTileID]},Rs.prototype.removeStaleBuckets=function(c){var p=!1;for(var f in this.indexes){var g=this.indexes[f];for(var S in g)c[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,g[S]),delete g[S],p=!0)}return p};var eu=function(){this.layerIndexes={},this.crossTileIDs=new so,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};eu.prototype.addLayer=function(c,p,f){var g=this.layerIndexes[c.id];g===void 0&&(g=this.layerIndexes[c.id]=new Rs);var S=!1,I={};g.handleWrapJump(f);for(var R=0,z=p;R<z.length;R+=1){var q=z[R],ne=q.getBucket(c);ne&&c.id===ne.layerIds[0]&&(ne.bucketInstanceId||(ne.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(q.tileID,ne,this.crossTileIDs)&&(S=!0),I[ne.bucketInstanceId]=!0)}return g.removeStaleBuckets(I)&&(S=!0),S},eu.prototype.pruneUnusedLayers=function(c){var p={};for(var f in c.forEach(function(g){p[g]=!0}),this.layerIndexes)p[f]||delete this.layerIndexes[f]};var su=function(c,p){return y.emitValidationErrors(c,p&&p.filter(function(f){return f.identifier!=="source.canvas"}))},_u=y.pick(mn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Vu=y.pick(mn,["setCenter","setZoom","setBearing","setPitch"]),xu=function(){var c={},p=y.styleSpec.$version;for(var f in y.styleSpec.$root){var g,S=y.styleSpec.$root[f];S.required&&(g=f==="version"?p:S.type==="array"?[]:{})!=null&&(c[f]=g)}return c}(),Ro=function(c){function p(f,g){var S=this;g===void 0&&(g={}),c.call(this),this.map=f,this.dispatcher=new Ar(rr(),this),this.imageManager=new Yt,this.imageManager.setEventedParent(this),this.glyphManager=new _r(f._requestManager,g.localIdeographFontFamily),this.lineAtlas=new Ue(256,512),this.crossTileSymbolIndex=new eu,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var I=this;this._rtlTextPluginCallback=p.registerForPluginStateChange(function(R){I.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:R.pluginStatus,pluginURL:R.pluginURL},function(z,q){if(y.triggerPluginCompletionEvent(z),q&&q.every(function(Se){return Se}))for(var ne in I.sourceCaches)I.sourceCaches[ne].reload()})}),this.on("data",function(R){if(R.dataType==="source"&&R.sourceDataType==="metadata"){var z=S.sourceCaches[R.sourceId];if(z){var q=z.getSource();if(q&&q.vectorLayerIds)for(var ne in S._layers){var Se=S._layers[ne];Se.source===q.id&&S._validateLayer(Se)}}}})}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.loadURL=function(f,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var I=typeof g.validate=="boolean"?g.validate:!y.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,g.accessToken);var R=this.map._requestManager.transformRequest(f,y.ResourceType.Style);this._request=y.getJSON(R,function(z,q){S._request=null,z?S.fire(new y.ErrorEvent(z)):q&&S._load(q,I)})},p.prototype.loadJSON=function(f,g){var S=this;g===void 0&&(g={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(f,g.validate!==!1)})},p.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(xu,!1)},p.prototype._load=function(f,g){if(!g||!su(this,y.validateStyle(f))){for(var S in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(S,f.sources[S],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var I=Mr(this.stylesheet.layers);this._order=I.map(function(ne){return ne.id}),this._layers={},this._serializedLayers={};for(var R=0,z=I;R<z.length;R+=1){var q=z[R];(q=y.createStyleLayer(q)).setEventedParent(this,{layer:{id:q.id}}),this._layers[q.id]=q,this._serializedLayers[q.id]=q.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Qt(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},p.prototype._loadSprite=function(f){var g=this;this._spriteRequest=function(S,I,R){var z,q,ne,Se=y.browser.devicePixelRatio>1?"@2x":"",Me=y.getJSON(I.transformRequest(I.normalizeSpriteURL(S,Se,".json"),y.ResourceType.SpriteJSON),function(qe,pt){Me=null,ne||(ne=qe,z=pt,Qe())}),ye=y.getImage(I.transformRequest(I.normalizeSpriteURL(S,Se,".png"),y.ResourceType.SpriteImage),function(qe,pt){ye=null,ne||(ne=qe,q=pt,Qe())});function Qe(){if(ne)R(ne);else if(z&&q){var qe=y.browser.getImageData(q),pt={};for(var Xe in z){var dt=z[Xe],Ct=dt.width,Wt=dt.height,vr=dt.x,er=dt.y,wr=dt.sdf,Wr=dt.pixelRatio,bn=dt.stretchX,gn=dt.stretchY,Gn=dt.content,xi=new y.RGBAImage({width:Ct,height:Wt});y.RGBAImage.copy(qe,xi,{x:vr,y:er},{x:0,y:0},{width:Ct,height:Wt}),pt[Xe]={data:xi,pixelRatio:Wr,sdf:wr,stretchX:bn,stretchY:gn,content:Gn}}R(null,pt)}}return{cancel:function(){Me&&(Me.cancel(),Me=null),ye&&(ye.cancel(),ye=null)}}}(f,this.map._requestManager,function(S,I){if(g._spriteRequest=null,S)g.fire(new y.ErrorEvent(S));else if(I)for(var R in I)g.imageManager.addImage(R,I[R]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new y.Event("data",{dataType:"style"}))})},p.prototype._validateLayer=function(f){var g=this.sourceCaches[f.source];if(g){var S=f.sourceLayer;if(S){var I=g.getSource();(I.type==="geojson"||I.vectorLayerIds&&I.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+I.id+'" as specified by style layer "'+f.id+'"')))}}},p.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},p.prototype._serializeLayers=function(f){for(var g=[],S=0,I=f;S<I.length;S+=1){var R=this._layers[I[S]];R.type!=="custom"&&g.push(R.serialize())}return g},p.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},p.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},p.prototype.update=function(f){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);for(var R in(S.length||I.length)&&this._updateWorkerLayers(S,I),this._updatedSources){var z=this._updatedSources[R];z==="reload"?this._reloadSource(R):z==="clear"&&this._clearSource(R)}for(var q in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[q].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var ne={};for(var Se in this.sourceCaches){var Me=this.sourceCaches[Se];ne[Se]=Me.used,Me.used=!1}for(var ye=0,Qe=this._order;ye<Qe.length;ye+=1){var qe=this._layers[Qe[ye]];qe.recalculate(f,this._availableImages),!qe.isHidden(f.zoom)&&qe.source&&(this.sourceCaches[qe.source].used=!0)}for(var pt in ne){var Xe=this.sourceCaches[pt];ne[pt]!==Xe.used&&Xe.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:pt}))}this.light.recalculate(f),this.z=f.zoom,g&&this.fire(new y.Event("data",{dataType:"style"}))}},p.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},p.prototype._updateWorkerLayers=function(f,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:g})},p.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},p.prototype.setState=function(f){var g=this;if(this._checkLoaded(),su(this,y.validateStyle(f)))return!1;(f=y.clone$1(f)).layers=Mr(f.layers);var S=function(R,z){if(!R)return[{command:mn.setStyle,args:[z]}];var q=[];try{if(!y.deepEqual(R.version,z.version))return[{command:mn.setStyle,args:[z]}];y.deepEqual(R.center,z.center)||q.push({command:mn.setCenter,args:[z.center]}),y.deepEqual(R.zoom,z.zoom)||q.push({command:mn.setZoom,args:[z.zoom]}),y.deepEqual(R.bearing,z.bearing)||q.push({command:mn.setBearing,args:[z.bearing]}),y.deepEqual(R.pitch,z.pitch)||q.push({command:mn.setPitch,args:[z.pitch]}),y.deepEqual(R.sprite,z.sprite)||q.push({command:mn.setSprite,args:[z.sprite]}),y.deepEqual(R.glyphs,z.glyphs)||q.push({command:mn.setGlyphs,args:[z.glyphs]}),y.deepEqual(R.transition,z.transition)||q.push({command:mn.setTransition,args:[z.transition]}),y.deepEqual(R.light,z.light)||q.push({command:mn.setLight,args:[z.light]});var ne={},Se=[];(function(ye,Qe,qe,pt){var Xe;for(Xe in Qe=Qe||{},ye=ye||{})ye.hasOwnProperty(Xe)&&(Qe.hasOwnProperty(Xe)||Zn(Xe,qe,pt));for(Xe in Qe)Qe.hasOwnProperty(Xe)&&(ye.hasOwnProperty(Xe)?y.deepEqual(ye[Xe],Qe[Xe])||(ye[Xe].type==="geojson"&&Qe[Xe].type==="geojson"&&Zt(ye,Qe,Xe)?qe.push({command:mn.setGeoJSONSourceData,args:[Xe,Qe[Xe].data]}):na(Xe,Qe,qe,pt)):ea(Xe,Qe,qe))})(R.sources,z.sources,Se,ne);var Me=[];R.layers&&R.layers.forEach(function(ye){ne[ye.source]?q.push({command:mn.removeLayer,args:[ye.id]}):Me.push(ye)}),q=q.concat(Se),function(ye,Qe,qe){Qe=Qe||[];var pt,Xe,dt,Ct,Wt,vr,er,wr=(ye=ye||[]).map(va),Wr=Qe.map(va),bn=ye.reduce(aa,{}),gn=Qe.reduce(aa,{}),Gn=wr.slice(),xi=Object.create(null);for(pt=0,Xe=0;pt<wr.length;pt++)gn.hasOwnProperty(dt=wr[pt])?Xe++:(qe.push({command:mn.removeLayer,args:[dt]}),Gn.splice(Gn.indexOf(dt,Xe),1));for(pt=0,Xe=0;pt<Wr.length;pt++)Gn[Gn.length-1-pt]!==(dt=Wr[Wr.length-1-pt])&&(bn.hasOwnProperty(dt)?(qe.push({command:mn.removeLayer,args:[dt]}),Gn.splice(Gn.lastIndexOf(dt,Gn.length-Xe),1)):Xe++,qe.push({command:mn.addLayer,args:[gn[dt],vr=Gn[Gn.length-pt]]}),Gn.splice(Gn.length-pt,0,dt),xi[dt]=!0);for(pt=0;pt<Wr.length;pt++)if(Ct=bn[dt=Wr[pt]],Wt=gn[dt],!xi[dt]&&!y.deepEqual(Ct,Wt))if(y.deepEqual(Ct.source,Wt.source)&&y.deepEqual(Ct["source-layer"],Wt["source-layer"])&&y.deepEqual(Ct.type,Wt.type)){for(er in kt(Ct.layout,Wt.layout,qe,dt,null,mn.setLayoutProperty),kt(Ct.paint,Wt.paint,qe,dt,null,mn.setPaintProperty),y.deepEqual(Ct.filter,Wt.filter)||qe.push({command:mn.setFilter,args:[dt,Wt.filter]}),y.deepEqual(Ct.minzoom,Wt.minzoom)&&y.deepEqual(Ct.maxzoom,Wt.maxzoom)||qe.push({command:mn.setLayerZoomRange,args:[dt,Wt.minzoom,Wt.maxzoom]}),Ct)Ct.hasOwnProperty(er)&&er!=="layout"&&er!=="paint"&&er!=="filter"&&er!=="metadata"&&er!=="minzoom"&&er!=="maxzoom"&&(er.indexOf("paint.")===0?kt(Ct[er],Wt[er],qe,dt,er.slice(6),mn.setPaintProperty):y.deepEqual(Ct[er],Wt[er])||qe.push({command:mn.setLayerProperty,args:[dt,er,Wt[er]]}));for(er in Wt)Wt.hasOwnProperty(er)&&!Ct.hasOwnProperty(er)&&er!=="layout"&&er!=="paint"&&er!=="filter"&&er!=="metadata"&&er!=="minzoom"&&er!=="maxzoom"&&(er.indexOf("paint.")===0?kt(Ct[er],Wt[er],qe,dt,er.slice(6),mn.setPaintProperty):y.deepEqual(Ct[er],Wt[er])||qe.push({command:mn.setLayerProperty,args:[dt,er,Wt[er]]}))}else qe.push({command:mn.removeLayer,args:[dt]}),vr=Gn[Gn.lastIndexOf(dt)+1],qe.push({command:mn.addLayer,args:[Wt,vr]})}(Me,z.layers,q)}catch(ye){console.warn("Unable to compute style diff:",ye),q=[{command:mn.setStyle,args:[z]}]}return q}(this.serialize(),f).filter(function(R){return!(R.command in Vu)});if(S.length===0)return!1;var I=S.filter(function(R){return!(R.command in _u)});if(I.length>0)throw new Error("Unimplemented: "+I.map(function(R){return R.command}).join(", ")+".");return S.forEach(function(R){R.command!=="setTransition"&&g[R.command].apply(g,R.args)}),this.stylesheet=f,!0},p.prototype.addImage=function(f,g){if(this.getImage(f))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,g),this._afterImageUpdated(f)},p.prototype.updateImage=function(f,g){this.imageManager.updateImage(f,g)},p.prototype.getImage=function(f){return this.imageManager.getImage(f)},p.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},p.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},p.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},p.prototype.addSource=function(f,g,S){var I=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(y.validateStyle.source,"sources."+f,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var R=this.sourceCaches[f]=new nt(f,g,this.dispatcher);R.style=this,R.setEventedParent(this,function(){return{isSourceLoaded:I.loaded(),source:R.serialize(),sourceId:f}}),R.onAdd(this.map),this._changed=!0}},p.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===f)return this.fire(new y.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},p.prototype.setGeoJSONSourceData=function(f,g){this._checkLoaded(),this.sourceCaches[f].getSource().setData(g),this._changed=!0},p.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},p.prototype.addLayer=function(f,g,S){S===void 0&&(S={}),this._checkLoaded();var I=f.id;if(this.getLayer(I))this.fire(new y.ErrorEvent(new Error('Layer with id "'+I+'" already exists on this map')));else{var R;if(f.type==="custom"){if(su(this,y.validateCustomStyleLayer(f)))return;R=y.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(I,f.source),f=y.clone$1(f),f=y.extend(f,{source:I})),this._validate(y.validateStyle.layer,"layers."+I,f,{arrayIndex:-1},S))return;R=y.createStyleLayer(f),this._validateLayer(R),R.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[R.id]=R.serialize()}var z=g?this._order.indexOf(g):this._order.length;if(g&&z===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(z,0,I),this._layerOrderChanged=!0,this._layers[I]=R,this._removedLayers[I]&&R.source&&R.type!=="custom"){var q=this._removedLayers[I];delete this._removedLayers[I],q.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}},p.prototype.moveLayer=function(f,g){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==g){var S=this._order.indexOf(f);this._order.splice(S,1);var I=g?this._order.indexOf(g):this._order.length;g&&I===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(I,0,f),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},p.prototype.removeLayer=function(f){this._checkLoaded();var g=this._layers[f];if(g){g.setEventedParent(null);var S=this._order.indexOf(f);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=g,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],g.onRemove&&g.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},p.prototype.getLayer=function(f){return this._layers[f]},p.prototype.hasLayer=function(f){return f in this._layers},p.prototype.setLayerZoomRange=function(f,g,S){this._checkLoaded();var I=this.getLayer(f);I?I.minzoom===g&&I.maxzoom===S||(g!=null&&(I.minzoom=g),S!=null&&(I.maxzoom=S),this._updateLayer(I)):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},p.prototype.setFilter=function(f,g,S){S===void 0&&(S={}),this._checkLoaded();var I=this.getLayer(f);if(I){if(!y.deepEqual(I.filter,g))return g==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(y.validateStyle.filter,"layers."+I.id+".filter",g,null,S)||(I.filter=y.clone$1(g),this._updateLayer(I)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},p.prototype.getFilter=function(f){return y.clone$1(this.getLayer(f).filter)},p.prototype.setLayoutProperty=function(f,g,S,I){I===void 0&&(I={}),this._checkLoaded();var R=this.getLayer(f);R?y.deepEqual(R.getLayoutProperty(g),S)||(R.setLayoutProperty(g,S,I),this._updateLayer(R)):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},p.prototype.getLayoutProperty=function(f,g){var S=this.getLayer(f);if(S)return S.getLayoutProperty(g);this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},p.prototype.setPaintProperty=function(f,g,S,I){I===void 0&&(I={}),this._checkLoaded();var R=this.getLayer(f);R?y.deepEqual(R.getPaintProperty(g),S)||(R.setPaintProperty(g,S,I)&&this._updateLayer(R),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},p.prototype.getPaintProperty=function(f,g){return this.getLayer(f).getPaintProperty(g)},p.prototype.setFeatureState=function(f,g){this._checkLoaded();var S=f.source,I=f.sourceLayer,R=this.sourceCaches[S];if(R!==void 0){var z=R.getSource().type;z==="geojson"&&I?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):z!=="vector"||I?(f.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),R.setFeatureState(I,f.id,g)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},p.prototype.removeFeatureState=function(f,g){this._checkLoaded();var S=f.source,I=this.sourceCaches[S];if(I!==void 0){var R=I.getSource().type,z=R==="vector"?f.sourceLayer:void 0;R!=="vector"||z?g&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):I.removeFeatureState(z,f.id,g):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},p.prototype.getFeatureState=function(f){this._checkLoaded();var g=f.source,S=f.sourceLayer,I=this.sourceCaches[g];if(I!==void 0){if(I.getSource().type!=="vector"||S)return f.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),I.getFeatureState(S,f.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},p.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},p.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},p.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},p.prototype._flattenAndSortRenderedFeatures=function(f){for(var g=this,S=function(bn){return g._layers[bn].type==="fill-extrusion"},I={},R=[],z=this._order.length-1;z>=0;z--){var q=this._order[z];if(S(q)){I[q]=z;for(var ne=0,Se=f;ne<Se.length;ne+=1){var Me=Se[ne][q];if(Me)for(var ye=0,Qe=Me;ye<Qe.length;ye+=1)R.push(Qe[ye])}}}R.sort(function(bn,gn){return gn.intersectionZ-bn.intersectionZ});for(var qe=[],pt=this._order.length-1;pt>=0;pt--){var Xe=this._order[pt];if(S(Xe))for(var dt=R.length-1;dt>=0;dt--){var Ct=R[dt].feature;if(I[Ct.layer.id]<pt)break;qe.push(Ct),R.pop()}else for(var Wt=0,vr=f;Wt<vr.length;Wt+=1){var er=vr[Wt][Xe];if(er)for(var wr=0,Wr=er;wr<Wr.length;wr+=1)qe.push(Wr[wr].feature)}}return qe},p.prototype.queryRenderedFeatures=function(f,g,S){g&&g.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var I={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var R=0,z=g.layers;R<z.length;R+=1){var q=z[R],ne=this._layers[q];if(!ne)return this.fire(new y.ErrorEvent(new Error("The layer '"+q+"' does not exist in the map's style and cannot be queried for features."))),[];I[ne.source]=!0}}var Se=[];for(var Me in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!I[Me]||Se.push(Sn(this.sourceCaches[Me],this._layers,this._serializedLayers,f,g,S));return this.placement&&Se.push(function(ye,Qe,qe,pt,Xe,dt,Ct){for(var Wt={},vr=dt.queryRenderedSymbols(pt),er=[],wr=0,Wr=Object.keys(vr).map(Number);wr<Wr.length;wr+=1)er.push(Ct[Wr[wr]]);er.sort(Li);for(var bn=function(){var bi=Gn[gn],Ea=bi.featureIndex.lookupSymbolFeatures(vr[bi.bucketInstanceId],Qe,bi.bucketIndex,bi.sourceLayerIndex,Xe.filter,Xe.layers,Xe.availableImages,ye);for(var Xn in Ea){var Hi=Wt[Xn]=Wt[Xn]||[],Qi=Ea[Xn];Qi.sort(function(oa,Zi){var wi=bi.featureSortOrder;if(wi){var us=wi.indexOf(oa.featureIndex);return wi.indexOf(Zi.featureIndex)-us}return Zi.featureIndex-oa.featureIndex});for(var Wi=0,Ri=Qi;Wi<Ri.length;Wi+=1)Hi.push(Ri[Wi])}},gn=0,Gn=er;gn<Gn.length;gn+=1)bn();var xi=function(bi){Wt[bi].forEach(function(Ea){var Xn=Ea.feature,Hi=qe[ye[bi].source].getFeatureState(Xn.layer["source-layer"],Xn.id);Xn.source=Xn.layer.source,Xn.layer["source-layer"]&&(Xn.sourceLayer=Xn.layer["source-layer"]),Xn.state=Hi})};for(var Si in Wt)xi(Si);return Wt}(this._layers,this._serializedLayers,this.sourceCaches,f,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Se)},p.prototype.querySourceFeatures=function(f,g){g&&g.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[f];return S?function(I,R){for(var z=I.getRenderableIds().map(function(Qe){return I.getTileByID(Qe)}),q=[],ne={},Se=0;Se<z.length;Se++){var Me=z[Se],ye=Me.tileID.canonical.key;ne[ye]||(ne[ye]=!0,Me.querySourceFeatures(q,R))}return q}(S,g):[]},p.prototype.addSourceType=function(f,g,S){return p.getSourceType(f)?S(new Error('A source type called "'+f+'" already exists.')):(p.setSourceType(f,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:g.workerSourceURL},S):S(null,null))},p.prototype.getLight=function(){return this.light.getLight()},p.prototype.setLight=function(f,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),I=!1;for(var R in f)if(!y.deepEqual(f[R],S[R])){I=!0;break}if(I){var z={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,g),this.light.updateTransitions(z)}},p.prototype._validate=function(f,g,S,I,R){return R===void 0&&(R={}),(!R||R.validate!==!1)&&su(this,f.call(y.validateStyle,y.extend({key:g,style:this.serialize(),value:S,styleSpec:y.styleSpec},I)))},p.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},p.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},p.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},p.prototype._updateSources=function(f){for(var g in this.sourceCaches)this.sourceCaches[g].update(f)},p.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},p.prototype._updatePlacement=function(f,g,S,I,R){R===void 0&&(R=!1);for(var z=!1,q=!1,ne={},Se=0,Me=this._order;Se<Me.length;Se+=1){var ye=this._layers[Me[Se]];if(ye.type==="symbol"){if(!ne[ye.source]){var Qe=this.sourceCaches[ye.source];ne[ye.source]=Qe.getRenderableIds(!0).map(function(Ct){return Qe.getTileByID(Ct)}).sort(function(Ct,Wt){return Wt.tileID.overscaledZ-Ct.tileID.overscaledZ||(Ct.tileID.isLessThan(Wt.tileID)?-1:1)})}var qe=this.crossTileSymbolIndex.addLayer(ye,ne[ye.source],f.center.lng);z=z||qe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),f.zoom))&&(this.pauseablePlacement=new Oa(f,this._order,R,g,S,I,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ne),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),q=!0),z&&this.pauseablePlacement.placement.setStale()),q||z)for(var pt=0,Xe=this._order;pt<Xe.length;pt+=1){var dt=this._layers[Xe[pt]];dt.type==="symbol"&&this.placement.updateLayerOpacities(dt,ne[dt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},p.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},p.prototype.getImages=function(f,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var I=this.sourceCaches[g.source];I&&I.setDependencies(g.tileID.key,g.type,g.icons)},p.prototype.getGlyphs=function(f,g,S){this.glyphManager.getGlyphs(g.stacks,S)},p.prototype.getResource=function(f,g,S){return y.makeRequest(g,S)},p}(y.Evented);Ro.getSourceType=function(c){return Br[c]},Ro.setSourceType=function(c,p){Br[c]=p},Ro.registerForPluginStateChange=y.registerForPluginStateChange;var ha=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),As=wa(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Sh=wa(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ju=wa(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),pf=wa(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Wf=wa("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),gl=wa(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ac=wa(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),yl=wa("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),df=wa("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),E=wa("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),P=wa(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),G=wa(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),D=wa(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),oe=wa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Fe=wa(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),vt=wa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Mt=wa(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Dt=wa(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Nr=wa(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Xr=wa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Qn=wa(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ki=wa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),ji=wa(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),pa=wa(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ka=wa(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),yo=wa(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function wa(c,p){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=p.match(/attribute ([\w]+) ([\w]+)/g),S=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=I?I.concat(S):S,z={};return{fragmentSource:c=c.replace(f,function(q,ne,Se,Me,ye){return z[ye]=!0,ne==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
varying `+Se+" "+Me+" "+ye+`;
#else
uniform `+Se+" "+Me+" u_"+ye+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ye+`
    `+Se+" "+Me+" "+ye+" = u_"+ye+`;
#endif
`}),vertexSource:p=p.replace(f,function(q,ne,Se,Me,ye){var Qe=Me==="float"?"vec2":"vec4",qe=ye.match(/color/)?"color":Qe;return z[ye]?ne==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
uniform lowp float u_`+ye+`_t;
attribute `+Se+" "+Qe+" a_"+ye+`;
varying `+Se+" "+Me+" "+ye+`;
#else
uniform `+Se+" "+Me+" u_"+ye+`;
#endif
`:qe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ye+" = a_"+ye+`;
#else
    `+Se+" "+Me+" "+ye+" = u_"+ye+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ye+" = unpack_mix_"+qe+"(a_"+ye+", u_"+ye+`_t);
#else
    `+Se+" "+Me+" "+ye+" = u_"+ye+`;
#endif
`:ne==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
uniform lowp float u_`+ye+`_t;
attribute `+Se+" "+Qe+" a_"+ye+`;
#else
uniform `+Se+" "+Me+" u_"+ye+`;
#endif
`:qe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+Se+" "+Me+" "+ye+" = a_"+ye+`;
#else
    `+Se+" "+Me+" "+ye+" = u_"+ye+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+Se+" "+Me+" "+ye+" = unpack_mix_"+qe+"(a_"+ye+", u_"+ye+`_t);
#else
    `+Se+" "+Me+" "+ye+" = u_"+ye+`;
#endif
`}),staticAttributes:g,staticUniforms:R}}var Xs=Object.freeze({__proto__:null,prelude:As,background:Sh,backgroundPattern:Ju,circle:pf,clippingMask:Wf,heatmap:gl,heatmapTexture:Ac,collisionBox:yl,collisionCircle:df,debug:E,fill:P,fillOutline:G,fillOutlinePattern:D,fillPattern:oe,fillExtrusion:Fe,fillExtrusionPattern:vt,hillshadePrepare:Mt,hillshade:Dt,line:Nr,lineGradient:Xr,linePattern:Qn,lineSDF:Ki,raster:ji,symbolIcon:pa,symbolSDF:Ka,symbolTextAndIcon:yo}),Bl=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Yc(c){for(var p=[],f=0;f<c.length;f++)if(c[f]!==null){var g=c[f].split(" ");p.push(g.pop())}return p}Bl.prototype.bind=function(c,p,f,g,S,I,R,z){this.context=c;for(var q=this.boundPaintVertexBuffers.length!==g.length,ne=0;!q&&ne<g.length;ne++)this.boundPaintVertexBuffers[ne]!==g[ne]&&(q=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===p&&this.boundLayoutVertexBuffer===f&&!q&&this.boundIndexBuffer===S&&this.boundVertexOffset===I&&this.boundDynamicVertexBuffer===R&&this.boundDynamicVertexBuffer2===z?(c.bindVertexArrayOES.set(this.vao),R&&R.bind(),S&&S.dynamicDraw&&S.bind(),z&&z.bind()):this.freshBind(p,f,g,S,I,R,z)},Bl.prototype.freshBind=function(c,p,f,g,S,I,R){var z,q=c.numAttributes,ne=this.context,Se=ne.gl;if(ne.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ne.extVertexArrayObject.createVertexArrayOES(),ne.bindVertexArrayOES.set(this.vao),z=0,this.boundProgram=c,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=I,this.boundDynamicVertexBuffer2=R;else{z=ne.currentNumAttributes||0;for(var Me=q;Me<z;Me++)Se.disableVertexAttribArray(Me)}p.enableAttributes(Se,c);for(var ye=0,Qe=f;ye<Qe.length;ye+=1)Qe[ye].enableAttributes(Se,c);I&&I.enableAttributes(Se,c),R&&R.enableAttributes(Se,c),p.bind(),p.setVertexAttribPointers(Se,c,S);for(var qe=0,pt=f;qe<pt.length;qe+=1){var Xe=pt[qe];Xe.bind(),Xe.setVertexAttribPointers(Se,c,S)}I&&(I.bind(),I.setVertexAttribPointers(Se,c,S)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(Se,c,S)),ne.currentNumAttributes=q},Bl.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var qc=function(c,p,f,g,S,I){var R=c.gl;this.program=R.createProgram();for(var z=Yc(f.staticAttributes),q=g?g.getBinderAttributes():[],ne=z.concat(q),Se=f.staticUniforms?Yc(f.staticUniforms):[],Me=g?g.getBinderUniforms():[],ye=[],Qe=0,qe=Se.concat(Me);Qe<qe.length;Qe+=1){var pt=qe[Qe];ye.indexOf(pt)<0&&ye.push(pt)}var Xe=g?g.defines():[];I&&Xe.push("#define OVERDRAW_INSPECTOR;");var dt=Xe.concat(As.fragmentSource,f.fragmentSource).join(`
`),Ct=Xe.concat(As.vertexSource,f.vertexSource).join(`
`),Wt=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(Wt,dt),R.compileShader(Wt),R.attachShader(this.program,Wt);var vr=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(vr,Ct),R.compileShader(vr),R.attachShader(this.program,vr),this.attributes={};var er={};this.numAttributes=ne.length;for(var wr=0;wr<this.numAttributes;wr++)ne[wr]&&(R.bindAttribLocation(this.program,wr,ne[wr]),this.attributes[ne[wr]]=wr);R.linkProgram(this.program),R.deleteShader(vr),R.deleteShader(Wt);for(var Wr=0;Wr<ye.length;Wr++){var bn=ye[Wr];if(bn&&!er[bn]){var gn=R.getUniformLocation(this.program,bn);gn&&(er[bn]=gn)}}this.fixedUniforms=S(c,er),this.binderUniforms=g?g.getUniforms(c,er):[]}}};function wc(c,p,f){var g=1/ba(f,1,p.transform.tileZoom),S=Math.pow(2,f.tileID.overscaledZ),I=f.tileSize*Math.pow(2,p.transform.tileZoom)/S,R=I*(f.tileID.canonical.x+f.tileID.wrap*S),z=I*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[g,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[R>>16,z>>16],u_pixel_coord_lower:[65535&R,65535&z]}}qc.prototype.draw=function(c,p,f,g,S,I,R,z,q,ne,Se,Me,ye,Qe,qe,pt){var Xe,dt=c.gl;if(!this.failedToCreate){for(var Ct in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(g),c.setColorMode(S),c.setCullFace(I),this.fixedUniforms)this.fixedUniforms[Ct].set(R[Ct]);Qe&&Qe.setUniforms(c,this.binderUniforms,Me,{zoom:ye});for(var Wt=(Xe={},Xe[dt.LINES]=2,Xe[dt.TRIANGLES]=3,Xe[dt.LINE_STRIP]=1,Xe)[p],vr=0,er=Se.get();vr<er.length;vr+=1){var wr=er[vr],Wr=wr.vaos||(wr.vaos={});(Wr[z]||(Wr[z]=new Bl)).bind(c,this,q,Qe?Qe.getPaintVertexBuffers():[],ne,wr.vertexOffset,qe,pt),dt.drawElements(p,wr.primitiveLength*Wt,dt.UNSIGNED_SHORT,wr.primitiveOffset*Wt*2)}}};var Tc=function(c,p,f,g){var S=p.style.light,I=S.properties.get("position"),R=[I.x,I.y,I.z],z=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(z,-p.transform.angle),y.transformMat3(R,R,z);var q=S.properties.get("color");return{u_matrix:c,u_lightpos:R,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+f,u_opacity:g}},Mu=function(c,p,f,g,S,I,R){return y.extend(Tc(c,p,f,g),wc(I,p,R),{u_height_factor:-Math.pow(2,S.overscaledZ)/R.tileSize/8})},Nl=function(c){return{u_matrix:c}},_l=function(c,p,f,g){return y.extend(Nl(c),wc(f,p,g))},Go=function(c,p){return{u_matrix:c,u_world:p}},Ah=function(c,p,f,g,S){return y.extend(_l(c,p,f,g),{u_world:S})},wh=function(c,p,f,g){var S,I,R=c.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var z=ba(f,1,R.zoom);S=!0,I=[z,z]}else S=!1,I=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(p.posMatrix,f,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:I}},bu=function(c,p,f){var g=ba(f,1,p.zoom),S=Math.pow(2,p.zoom-f.tileID.overscaledZ),I=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:p.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[p.pixelsToGLUnits[0]/(g*S),p.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:I}},Yh=function(c,p,f){return{u_matrix:c,u_inv_matrix:p,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},zl=function(c,p,f){return f===void 0&&(f=1),{u_matrix:c,u_color:p,u_overlay:0,u_overlay_scale:f}},el=function(c){return{u_matrix:c}},Ul=function(c,p,f,g){return{u_matrix:c,u_extrude_scale:ba(p,1,f),u_intensity:g}},xl=function(c,p,f){var g=c.transform;return{u_matrix:xp(c,p,f),u_ratio:1/ba(p,1,g.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},lo=function(c,p,f,g){return y.extend(xl(c,p,f),{u_image:0,u_image_height:g})},tl=function(c,p,f,g){var S=c.transform,I=ju(p,S);return{u_matrix:xp(c,p,f),u_texsize:p.imageAtlasTexture.size,u_ratio:1/ba(p,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[I,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Xf=function(c,p,f,g,S){var I=c.lineAtlas,R=ju(p,c.transform),z=f.layout.get("line-cap")==="round",q=I.getDash(g.from,z),ne=I.getDash(g.to,z),Se=q.width*S.fromScale,Me=ne.width*S.toScale;return y.extend(xl(c,p,f),{u_patternscale_a:[R/Se,-q.height/2],u_patternscale_b:[R/Me,-ne.height/2],u_sdfgamma:I.width/(256*Math.min(Se,Me)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:ne.y,u_mix:S.t})};function ju(c,p){return 1/ba(c,1,p.tileZoom)}function xp(c,p,f){return c.translatePosMatrix(p.tileID.posMatrix,p,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var e0=function(c,p,f,g,S){return{u_matrix:c,u_tl_parent:p,u_scale_parent:f,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(R=S.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(I=S.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:$p(S.paint.get("raster-hue-rotate"))};var I,R};function $p(c){c*=Math.PI/180;var p=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*p-f+1)/3,(Math.sqrt(3)*p-f+1)/3]}var Th,vf=function(c,p,f,g,S,I,R,z,q,ne){var Se=S.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:p?p.uSizeT:0,u_size:p?p.uSize:0,u_camera_to_center_distance:Se.cameraToCenterDistance,u_pitch:Se.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:Se.width/Se.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:R,u_coord_matrix:z,u_is_text:+q,u_pitch_with_map:+g,u_texsize:ne,u_texture:0}},mf=function(c,p,f,g,S,I,R,z,q,ne,Se){var Me=S.transform;return y.extend(vf(c,p,f,g,S,I,R,z,q,ne),{u_gamma_scale:g?Math.cos(Me._pitch)*Me.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+Se})},Mc=function(c,p,f,g,S,I,R,z,q,ne){return y.extend(mf(c,p,f,g,S,I,R,z,!0,q,!0),{u_texsize_icon:ne,u_texture_icon:1})},gf=function(c,p,f){return{u_matrix:c,u_opacity:p,u_color:f}},Jl=function(c,p,f,g,S,I){return y.extend(function(R,z,q,ne){var Se=q.imageManager.getPattern(R.from.toString()),Me=q.imageManager.getPattern(R.to.toString()),ye=q.imageManager.getPixelSize(),Qe=ye.width,qe=ye.height,pt=Math.pow(2,ne.tileID.overscaledZ),Xe=ne.tileSize*Math.pow(2,q.transform.tileZoom)/pt,dt=Xe*(ne.tileID.canonical.x+ne.tileID.wrap*pt),Ct=Xe*ne.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Se.tl,u_pattern_br_a:Se.br,u_pattern_tl_b:Me.tl,u_pattern_br_b:Me.br,u_texsize:[Qe,qe],u_mix:z.t,u_pattern_size_a:Se.displaySize,u_pattern_size_b:Me.displaySize,u_scale_a:z.fromScale,u_scale_b:z.toScale,u_tile_units_to_pixels:1/ba(ne,1,q.transform.tileZoom),u_pixel_coord_upper:[dt>>16,Ct>>16],u_pixel_coord_lower:[65535&dt,65535&Ct]}}(g,I,f,S),{u_matrix:c,u_opacity:p})},yf={fillExtrusion:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_lightpos:new y.Uniform3f(c,p.u_lightpos),u_lightintensity:new y.Uniform1f(c,p.u_lightintensity),u_lightcolor:new y.Uniform3f(c,p.u_lightcolor),u_vertical_gradient:new y.Uniform1f(c,p.u_vertical_gradient),u_opacity:new y.Uniform1f(c,p.u_opacity)}},fillExtrusionPattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_lightpos:new y.Uniform3f(c,p.u_lightpos),u_lightintensity:new y.Uniform1f(c,p.u_lightintensity),u_lightcolor:new y.Uniform3f(c,p.u_lightcolor),u_vertical_gradient:new y.Uniform1f(c,p.u_vertical_gradient),u_height_factor:new y.Uniform1f(c,p.u_height_factor),u_image:new y.Uniform1i(c,p.u_image),u_texsize:new y.Uniform2f(c,p.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,p.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,p.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,p.u_scale),u_fade:new y.Uniform1f(c,p.u_fade),u_opacity:new y.Uniform1f(c,p.u_opacity)}},fill:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix)}},fillPattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_image:new y.Uniform1i(c,p.u_image),u_texsize:new y.Uniform2f(c,p.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,p.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,p.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,p.u_scale),u_fade:new y.Uniform1f(c,p.u_fade)}},fillOutline:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_world:new y.Uniform2f(c,p.u_world)}},fillOutlinePattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_world:new y.Uniform2f(c,p.u_world),u_image:new y.Uniform1i(c,p.u_image),u_texsize:new y.Uniform2f(c,p.u_texsize),u_pixel_coord_upper:new y.Uniform2f(c,p.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,p.u_pixel_coord_lower),u_scale:new y.Uniform3f(c,p.u_scale),u_fade:new y.Uniform1f(c,p.u_fade)}},circle:function(c,p){return{u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(c,p.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(c,p.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(c,p.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(c,p.u_matrix)}},collisionBox:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(c,p.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(c,p.u_extrude_scale),u_overscale_factor:new y.Uniform1f(c,p.u_overscale_factor)}},collisionCircle:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_inv_matrix:new y.UniformMatrix4f(c,p.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(c,p.u_viewport_size)}},debug:function(c,p){return{u_color:new y.UniformColor(c,p.u_color),u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_overlay:new y.Uniform1i(c,p.u_overlay),u_overlay_scale:new y.Uniform1f(c,p.u_overlay_scale)}},clippingMask:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix)}},heatmap:function(c,p){return{u_extrude_scale:new y.Uniform1f(c,p.u_extrude_scale),u_intensity:new y.Uniform1f(c,p.u_intensity),u_matrix:new y.UniformMatrix4f(c,p.u_matrix)}},heatmapTexture:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_world:new y.Uniform2f(c,p.u_world),u_image:new y.Uniform1i(c,p.u_image),u_color_ramp:new y.Uniform1i(c,p.u_color_ramp),u_opacity:new y.Uniform1f(c,p.u_opacity)}},hillshade:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_image:new y.Uniform1i(c,p.u_image),u_latrange:new y.Uniform2f(c,p.u_latrange),u_light:new y.Uniform2f(c,p.u_light),u_shadow:new y.UniformColor(c,p.u_shadow),u_highlight:new y.UniformColor(c,p.u_highlight),u_accent:new y.UniformColor(c,p.u_accent)}},hillshadePrepare:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_image:new y.Uniform1i(c,p.u_image),u_dimension:new y.Uniform2f(c,p.u_dimension),u_zoom:new y.Uniform1f(c,p.u_zoom),u_unpack:new y.Uniform4f(c,p.u_unpack)}},line:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_ratio:new y.Uniform1f(c,p.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,p.u_units_to_pixels)}},lineGradient:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_ratio:new y.Uniform1f(c,p.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,p.u_units_to_pixels),u_image:new y.Uniform1i(c,p.u_image),u_image_height:new y.Uniform1f(c,p.u_image_height)}},linePattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_texsize:new y.Uniform2f(c,p.u_texsize),u_ratio:new y.Uniform1f(c,p.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_image:new y.Uniform1i(c,p.u_image),u_units_to_pixels:new y.Uniform2f(c,p.u_units_to_pixels),u_scale:new y.Uniform3f(c,p.u_scale),u_fade:new y.Uniform1f(c,p.u_fade)}},lineSDF:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_ratio:new y.Uniform1f(c,p.u_ratio),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(c,p.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(c,p.u_patternscale_a),u_patternscale_b:new y.Uniform2f(c,p.u_patternscale_b),u_sdfgamma:new y.Uniform1f(c,p.u_sdfgamma),u_image:new y.Uniform1i(c,p.u_image),u_tex_y_a:new y.Uniform1f(c,p.u_tex_y_a),u_tex_y_b:new y.Uniform1f(c,p.u_tex_y_b),u_mix:new y.Uniform1f(c,p.u_mix)}},raster:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_tl_parent:new y.Uniform2f(c,p.u_tl_parent),u_scale_parent:new y.Uniform1f(c,p.u_scale_parent),u_buffer_scale:new y.Uniform1f(c,p.u_buffer_scale),u_fade_t:new y.Uniform1f(c,p.u_fade_t),u_opacity:new y.Uniform1f(c,p.u_opacity),u_image0:new y.Uniform1i(c,p.u_image0),u_image1:new y.Uniform1i(c,p.u_image1),u_brightness_low:new y.Uniform1f(c,p.u_brightness_low),u_brightness_high:new y.Uniform1f(c,p.u_brightness_high),u_saturation_factor:new y.Uniform1f(c,p.u_saturation_factor),u_contrast_factor:new y.Uniform1f(c,p.u_contrast_factor),u_spin_weights:new y.Uniform3f(c,p.u_spin_weights)}},symbolIcon:function(c,p){return{u_is_size_zoom_constant:new y.Uniform1i(c,p.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,p.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,p.u_size_t),u_size:new y.Uniform1f(c,p.u_size),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,p.u_pitch),u_rotate_symbol:new y.Uniform1i(c,p.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,p.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,p.u_fade_change),u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,p.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,p.u_coord_matrix),u_is_text:new y.Uniform1i(c,p.u_is_text),u_pitch_with_map:new y.Uniform1i(c,p.u_pitch_with_map),u_texsize:new y.Uniform2f(c,p.u_texsize),u_texture:new y.Uniform1i(c,p.u_texture)}},symbolSDF:function(c,p){return{u_is_size_zoom_constant:new y.Uniform1i(c,p.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,p.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,p.u_size_t),u_size:new y.Uniform1f(c,p.u_size),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,p.u_pitch),u_rotate_symbol:new y.Uniform1i(c,p.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,p.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,p.u_fade_change),u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,p.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,p.u_coord_matrix),u_is_text:new y.Uniform1i(c,p.u_is_text),u_pitch_with_map:new y.Uniform1i(c,p.u_pitch_with_map),u_texsize:new y.Uniform2f(c,p.u_texsize),u_texture:new y.Uniform1i(c,p.u_texture),u_gamma_scale:new y.Uniform1f(c,p.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(c,p.u_is_halo)}},symbolTextAndIcon:function(c,p){return{u_is_size_zoom_constant:new y.Uniform1i(c,p.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(c,p.u_is_size_feature_constant),u_size_t:new y.Uniform1f(c,p.u_size_t),u_size:new y.Uniform1f(c,p.u_size),u_camera_to_center_distance:new y.Uniform1f(c,p.u_camera_to_center_distance),u_pitch:new y.Uniform1f(c,p.u_pitch),u_rotate_symbol:new y.Uniform1i(c,p.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(c,p.u_aspect_ratio),u_fade_change:new y.Uniform1f(c,p.u_fade_change),u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(c,p.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(c,p.u_coord_matrix),u_is_text:new y.Uniform1i(c,p.u_is_text),u_pitch_with_map:new y.Uniform1i(c,p.u_pitch_with_map),u_texsize:new y.Uniform2f(c,p.u_texsize),u_texsize_icon:new y.Uniform2f(c,p.u_texsize_icon),u_texture:new y.Uniform1i(c,p.u_texture),u_texture_icon:new y.Uniform1i(c,p.u_texture_icon),u_gamma_scale:new y.Uniform1f(c,p.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(c,p.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(c,p.u_is_halo)}},background:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_opacity:new y.Uniform1f(c,p.u_opacity),u_color:new y.UniformColor(c,p.u_color)}},backgroundPattern:function(c,p){return{u_matrix:new y.UniformMatrix4f(c,p.u_matrix),u_opacity:new y.Uniform1f(c,p.u_opacity),u_image:new y.Uniform1i(c,p.u_image),u_pattern_tl_a:new y.Uniform2f(c,p.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(c,p.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(c,p.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(c,p.u_pattern_br_b),u_texsize:new y.Uniform2f(c,p.u_texsize),u_mix:new y.Uniform1f(c,p.u_mix),u_pattern_size_a:new y.Uniform2f(c,p.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(c,p.u_pattern_size_b),u_scale_a:new y.Uniform1f(c,p.u_scale_a),u_scale_b:new y.Uniform1f(c,p.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(c,p.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(c,p.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(c,p.u_tile_units_to_pixels)}}};function ec(c,p,f,g,S,I,R){for(var z=c.context,q=z.gl,ne=c.useProgram("collisionBox"),Se=[],Me=0,ye=0,Qe=0;Qe<g.length;Qe++){var qe=g[Qe],pt=p.getTile(qe),Xe=pt.getBucket(f);if(Xe){var dt=qe.posMatrix;S[0]===0&&S[1]===0||(dt=c.translatePosMatrix(qe.posMatrix,pt,S,I));var Ct=R?Xe.textCollisionBox:Xe.iconCollisionBox,Wt=Xe.collisionCircleArray;if(Wt.length>0){var vr=y.create(),er=dt;y.mul(vr,Xe.placementInvProjMatrix,c.transform.glCoordMatrix),y.mul(vr,vr,Xe.placementViewportMatrix),Se.push({circleArray:Wt,circleOffset:ye,transform:er,invTransform:vr}),ye=Me+=Wt.length/4}Ct&&ne.draw(z,q.LINES,ke.disabled,Ye.disabled,c.colorModeForRenderPass(),xt.disabled,bu(dt,c.transform,pt),f.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,c.transform.zoom,null,null,Ct.collisionVertexBuffer)}}if(R&&Se.length){var wr=c.useProgram("collisionCircle"),Wr=new y.StructArrayLayout2f1f2i16;Wr.resize(4*Me),Wr._trim();for(var bn=0,gn=0,Gn=Se;gn<Gn.length;gn+=1)for(var xi=Gn[gn],Si=0;Si<xi.circleArray.length/4;Si++){var bi=4*Si,Ea=xi.circleArray[bi+0],Xn=xi.circleArray[bi+1],Hi=xi.circleArray[bi+2],Qi=xi.circleArray[bi+3];Wr.emplace(bn++,Ea,Xn,Hi,Qi,0),Wr.emplace(bn++,Ea,Xn,Hi,Qi,1),Wr.emplace(bn++,Ea,Xn,Hi,Qi,2),Wr.emplace(bn++,Ea,Xn,Hi,Qi,3)}(!Th||Th.length<2*Me)&&(Th=function(Wo){var Ds=2*Wo,ls=new y.StructArrayLayout3ui6;ls.resize(Ds),ls._trim();for(var co=0;co<Ds;co++){var Jo=6*co;ls.uint16[Jo+0]=4*co+0,ls.uint16[Jo+1]=4*co+1,ls.uint16[Jo+2]=4*co+2,ls.uint16[Jo+3]=4*co+2,ls.uint16[Jo+4]=4*co+3,ls.uint16[Jo+5]=4*co+0}return ls}(Me));for(var Wi=z.createIndexBuffer(Th,!0),Ri=z.createVertexBuffer(Wr,y.collisionCircleLayout.members,!0),oa=0,Zi=Se;oa<Zi.length;oa+=1){var wi=Zi[oa],us=Yh(wi.transform,wi.invTransform,c.transform);wr.draw(z,q.TRIANGLES,ke.disabled,Ye.disabled,c.colorModeForRenderPass(),xt.disabled,us,f.id,Ri,Wi,y.SegmentVector.simpleSegment(0,2*wi.circleOffset,wi.circleArray.length,wi.circleArray.length/2),null,c.transform.zoom,null,null,null)}Ri.destroy(),Wi.destroy()}}var uu=y.identity(new Float32Array(16));function Yf(c,p,f,g,S,I){var R=y.getAnchorAlignment(c),z=-(R.horizontalAlign-.5)*p,q=-(R.verticalAlign-.5)*f,ne=y.evaluateVariableOffset(c,g);return new y.Point((z/S+ne[0])*I,(q/S+ne[1])*I)}function tc(c,p,f,g,S,I,R,z,q,ne,Se){var Me=c.text.placedSymbolArray,ye=c.text.dynamicLayoutVertexArray,Qe=c.icon.dynamicLayoutVertexArray,qe={};ye.clear();for(var pt=0;pt<Me.length;pt++){var Xe=Me.get(pt),dt=Xe.hidden||!Xe.crossTileID||c.allowVerticalPlacement&&!Xe.placedOrientation?null:g[Xe.crossTileID];if(dt){var Ct=new y.Point(Xe.anchorX,Xe.anchorY),Wt=Pr(Ct,f?z:R),vr=Or(I.cameraToCenterDistance,Wt.signedDistanceFromCamera),er=S.evaluateSizeForFeature(c.textSizeData,ne,Xe)*vr/y.ONE_EM;f&&(er*=c.tilePixelRatio/q);for(var wr=Yf(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textBoxScale,er),Wr=f?Pr(Ct.add(wr),R).point:Wt.point.add(p?wr.rotate(-I.angle):wr),bn=c.allowVerticalPlacement&&Xe.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,gn=0;gn<Xe.numGlyphs;gn++)y.addDynamicAttributes(ye,Wr,bn);Se&&Xe.associatedIconIndex>=0&&(qe[Xe.associatedIconIndex]={shiftedAnchor:Wr,angle:bn})}else Ra(Xe.numGlyphs,ye)}if(Se){Qe.clear();for(var Gn=c.icon.placedSymbolArray,xi=0;xi<Gn.length;xi++){var Si=Gn.get(xi);if(Si.hidden)Ra(Si.numGlyphs,Qe);else{var bi=qe[xi];if(bi)for(var Ea=0;Ea<Si.numGlyphs;Ea++)y.addDynamicAttributes(Qe,bi.shiftedAnchor,bi.angle);else Ra(Si.numGlyphs,Qe)}}c.icon.dynamicLayoutVertexBuffer.updateData(Qe)}c.text.dynamicLayoutVertexBuffer.updateData(ye)}function qh(c,p,f){return f.iconsInText&&p?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function Ic(c,p,f,g,S,I,R,z,q,ne,Se,Me){for(var ye=c.context,Qe=ye.gl,qe=c.transform,pt=z==="map",Xe=q==="map",dt=pt&&f.layout.get("symbol-placement")!=="point",Ct=pt&&!Xe&&!dt,Wt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,vr=!1,er=c.depthModeForSublayer(0,ke.ReadOnly),wr=f.layout.get("text-variable-anchor"),Wr=[],bn=0,gn=g;bn<gn.length;bn+=1){var Gn=gn[bn],xi=p.getTile(Gn),Si=xi.getBucket(f);if(Si){var bi=S?Si.text:Si.icon;if(bi&&bi.segments.get().length){var Ea=bi.programConfigurations.get(f.id),Xn=S||Si.sdfIcons,Hi=S?Si.textSizeData:Si.iconSizeData,Qi=Xe||qe.pitch!==0,Wi=c.useProgram(qh(Xn,S,Si),Ea),Ri=y.evaluateSizeForZoom(Hi,qe.zoom),oa=void 0,Zi=[0,0],wi=void 0,us=void 0,Wo=null,Ds=void 0;if(S)wi=xi.glyphAtlasTexture,us=Qe.LINEAR,oa=xi.glyphAtlasTexture.size,Si.iconsInText&&(Zi=xi.imageAtlasTexture.size,Wo=xi.imageAtlasTexture,Ds=Qi||c.options.rotating||c.options.zooming||Hi.kind==="composite"||Hi.kind==="camera"?Qe.LINEAR:Qe.NEAREST);else{var ls=f.layout.get("icon-size").constantOr(0)!==1||Si.iconsNeedLinear;wi=xi.imageAtlasTexture,us=Xn||c.options.rotating||c.options.zooming||ls||Qi?Qe.LINEAR:Qe.NEAREST,oa=xi.imageAtlasTexture.size}var co=ba(xi,1,c.transform.zoom),Jo=go(Gn.posMatrix,Xe,pt,c.transform,co),es=Ba(Gn.posMatrix,Xe,pt,c.transform,co),Bs=wr&&Si.hasTextData(),uc=f.layout.get("icon-text-fit")!=="none"&&Bs&&Si.hasIconData();dt&&ss(Si,Gn.posMatrix,c,S,Jo,es,Xe,ne);var ru=c.translatePosMatrix(Gn.posMatrix,xi,I,R),Hu=dt||S&&wr||uc?uu:Jo,Cu=c.translatePosMatrix(es,xi,I,R,!0),kf=Xn&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,lc={program:Wi,buffers:bi,uniformValues:Xn?Si.iconsInText?Mc(Hi.kind,Ri,Ct,Xe,c,ru,Hu,Cu,oa,Zi):mf(Hi.kind,Ri,Ct,Xe,c,ru,Hu,Cu,S,oa,!0):vf(Hi.kind,Ri,Ct,Xe,c,ru,Hu,Cu,S,oa),atlasTexture:wi,atlasTextureIcon:Wo,atlasInterpolation:us,atlasInterpolationIcon:Ds,isSDF:Xn,hasHalo:kf};if(Wt&&Si.canOverlap){vr=!0;for(var Wl=0,wl=bi.segments.get();Wl<wl.length;Wl+=1){var Pf=wl[Wl];Wr.push({segments:new y.SegmentVector([Pf]),sortKey:Pf.sortKey,state:lc})}}else Wr.push({segments:bi.segments,sortKey:0,state:lc})}}}vr&&Wr.sort(function(Oc,Ns){return Oc.sortKey-Ns.sortKey});for(var cl=0,cc=Wr;cl<cc.length;cl+=1){var Xl=cc[cl],cs=Xl.state;if(ye.activeTexture.set(Qe.TEXTURE0),cs.atlasTexture.bind(cs.atlasInterpolation,Qe.CLAMP_TO_EDGE),cs.atlasTextureIcon&&(ye.activeTexture.set(Qe.TEXTURE1),cs.atlasTextureIcon&&cs.atlasTextureIcon.bind(cs.atlasInterpolationIcon,Qe.CLAMP_TO_EDGE)),cs.isSDF){var Tl=cs.uniformValues;cs.hasHalo&&(Tl.u_is_halo=1,rc(cs.buffers,Xl.segments,f,c,cs.program,er,Se,Me,Tl)),Tl.u_is_halo=0}rc(cs.buffers,Xl.segments,f,c,cs.program,er,Se,Me,cs.uniformValues)}}function rc(c,p,f,g,S,I,R,z,q){var ne=g.context;S.draw(ne,ne.gl.TRIANGLES,I,R,z,xt.disabled,q,f.id,c.layoutVertexBuffer,c.indexBuffer,p,f.paint,g.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function rl(c,p,f,g,S,I,R){var z,q,ne,Se,Me,ye=c.context.gl,Qe=f.paint.get("fill-pattern"),qe=Qe&&Qe.constantOr(1),pt=f.getCrossfadeParameters();R?(q=qe&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=ye.LINES):(q=qe?"fillPattern":"fill",z=ye.TRIANGLES);for(var Xe=0,dt=g;Xe<dt.length;Xe+=1){var Ct=dt[Xe],Wt=p.getTile(Ct);if(!qe||Wt.patternsLoaded()){var vr=Wt.getBucket(f);if(vr){var er=vr.programConfigurations.get(f.id),wr=c.useProgram(q,er);qe&&(c.context.activeTexture.set(ye.TEXTURE0),Wt.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),er.updatePaintBuffers(pt));var Wr=Qe.constantOr(null);if(Wr&&Wt.imageAtlas){var bn=Wt.imageAtlas,gn=bn.patternPositions[Wr.to.toString()],Gn=bn.patternPositions[Wr.from.toString()];gn&&Gn&&er.setConstantPatternPositions(gn,Gn)}var xi=c.translatePosMatrix(Ct.posMatrix,Wt,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(R){Se=vr.indexBuffer2,Me=vr.segments2;var Si=[ye.drawingBufferWidth,ye.drawingBufferHeight];ne=q==="fillOutlinePattern"&&qe?Ah(xi,c,pt,Wt,Si):Go(xi,Si)}else Se=vr.indexBuffer,Me=vr.segments,ne=qe?_l(xi,c,pt,Wt):Nl(xi);wr.draw(c.context,z,S,c.stencilModeForClipping(Ct),I,xt.disabled,ne,f.id,vr.layoutVertexBuffer,Se,Me,f.paint,c.transform.zoom,er)}}}}function _f(c,p,f,g,S,I,R){for(var z=c.context,q=z.gl,ne=f.paint.get("fill-extrusion-pattern"),Se=ne.constantOr(1),Me=f.getCrossfadeParameters(),ye=f.paint.get("fill-extrusion-opacity"),Qe=0,qe=g;Qe<qe.length;Qe+=1){var pt=qe[Qe],Xe=p.getTile(pt),dt=Xe.getBucket(f);if(dt){var Ct=dt.programConfigurations.get(f.id),Wt=c.useProgram(Se?"fillExtrusionPattern":"fillExtrusion",Ct);Se&&(c.context.activeTexture.set(q.TEXTURE0),Xe.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Ct.updatePaintBuffers(Me));var vr=ne.constantOr(null);if(vr&&Xe.imageAtlas){var er=Xe.imageAtlas,wr=er.patternPositions[vr.to.toString()],Wr=er.patternPositions[vr.from.toString()];wr&&Wr&&Ct.setConstantPatternPositions(wr,Wr)}var bn=c.translatePosMatrix(pt.posMatrix,Xe,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),gn=f.paint.get("fill-extrusion-vertical-gradient"),Gn=Se?Mu(bn,c,gn,ye,pt,Me,Xe):Tc(bn,c,gn,ye);Wt.draw(z,z.gl.TRIANGLES,S,I,R,xt.backCCW,Gn,f.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,f.paint,c.transform.zoom,Ct)}}}function kc(c,p,f,g,S,I){var R=c.context,z=R.gl,q=p.fbo;if(q){var ne=c.useProgram("hillshade");R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,q.colorAttachment.get());var Se=function(Me,ye,Qe){var qe=Qe.paint.get("hillshade-shadow-color"),pt=Qe.paint.get("hillshade-highlight-color"),Xe=Qe.paint.get("hillshade-accent-color"),dt=Qe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Qe.paint.get("hillshade-illumination-anchor")==="viewport"&&(dt-=Me.transform.angle);var Ct,Wt,vr,er=!Me.options.moving;return{u_matrix:Me.transform.calculatePosMatrix(ye.tileID.toUnwrapped(),er),u_image:0,u_latrange:(Ct=ye.tileID,Wt=Math.pow(2,Ct.canonical.z),vr=Ct.canonical.y,[new y.MercatorCoordinate(0,vr/Wt).toLngLat().lat,new y.MercatorCoordinate(0,(vr+1)/Wt).toLngLat().lat]),u_light:[Qe.paint.get("hillshade-exaggeration"),dt],u_shadow:qe,u_highlight:pt,u_accent:Xe}}(c,p,f);ne.draw(R,z.TRIANGLES,g,S,I,xt.disabled,Se,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function bp(c,p,f,g,S,I){var R=c.context,z=R.gl,q=p.dem;if(q&&q.data){var ne=q.dim,Se=q.stride,Me=q.getPixels();if(R.activeTexture.set(z.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),p.demTexture=p.demTexture||c.getTileTexture(Se),p.demTexture){var ye=p.demTexture;ye.update(Me,{premultiply:!1}),ye.bind(z.NEAREST,z.CLAMP_TO_EDGE)}else p.demTexture=new y.Texture(R,Me,z.RGBA,{premultiply:!1}),p.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);R.activeTexture.set(z.TEXTURE0);var Qe=p.fbo;if(!Qe){var qe=new y.Texture(R,{width:ne,height:ne,data:null},z.RGBA);qe.bind(z.LINEAR,z.CLAMP_TO_EDGE),(Qe=p.fbo=R.createFramebuffer(ne,ne,!0)).colorAttachment.set(qe.texture)}R.bindFramebuffer.set(Qe.framebuffer),R.viewport.set([0,0,ne,ne]),c.useProgram("hillshadePrepare").draw(R,z.TRIANGLES,g,S,I,xt.disabled,function(pt,Xe){var dt=Xe.stride,Ct=y.create();return y.ortho(Ct,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(Ct,Ct,[0,-y.EXTENT,0]),{u_matrix:Ct,u_image:1,u_dimension:[dt,dt],u_zoom:pt.overscaledZ,u_unpack:Xe.getUnpackVector()}}(p.tileID,q),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),p.needsHillshadePrepare=!1}}function xf(c,p,f,g,S){var I=g.paint.get("raster-fade-duration");if(I>0){var R=y.browser.now(),z=(R-c.timeAdded)/I,q=p?(R-p.timeAdded)/I:-1,ne=f.getSource(),Se=S.coveringZoomLevel({tileSize:ne.tileSize,roundZoom:ne.roundZoom}),Me=!p||Math.abs(p.tileID.overscaledZ-Se)>Math.abs(c.tileID.overscaledZ-Se),ye=Me&&c.refreshedUponExpiration?1:y.clamp(Me?z:1-q,0,1);return c.refreshedUponExpiration&&z>=1&&(c.refreshedUponExpiration=!1),p?{opacity:1,mix:1-ye}:{opacity:ye,mix:0}}return{opacity:1,mix:0}}var nc=new y.Color(1,0,0,1),$h=new y.Color(0,1,0,1),bf=new y.Color(0,0,1,1),Ef=new y.Color(1,0,1,1),Kp=new y.Color(0,1,1,1);function Qp(c,p,f,g){$c(c,0,p+f/2,c.transform.width,f,g)}function Mh(c,p,f,g){$c(c,p-f/2,0,f,c.transform.height,g)}function $c(c,p,f,g,S,I){var R=c.context,z=R.gl;z.enable(z.SCISSOR_TEST),z.scissor(p*y.browser.devicePixelRatio,f*y.browser.devicePixelRatio,g*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),R.clear({color:I}),z.disable(z.SCISSOR_TEST)}function Eu(c,p,f){var g=c.context,S=g.gl,I=f.posMatrix,R=c.useProgram("debug"),z=ke.disabled,q=Ye.disabled,ne=c.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),c.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),R.draw(g,S.LINE_STRIP,z,q,ne,xt.disabled,zl(I,y.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var Se=p.getTileByID(f.key).latestRawTileData,Me=Math.floor((Se&&Se.byteLength||0)/1024),ye=p.getTile(f).tileSize,Qe=512/Math.min(ye,512)*(f.overscaledZ/c.transform.zoom)*.5,qe=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(qe+=" => "+f.overscaledZ),function(pt,Xe){pt.initDebugOverlayCanvas();var dt=pt.debugOverlayCanvas,Ct=pt.context.gl,Wt=pt.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,dt.width,dt.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(Xe,5,5),Wt.strokeText(Xe,5,5),pt.debugOverlayTexture.update(dt),pt.debugOverlayTexture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE)}(c,qe+" "+Me+"kb"),R.draw(g,S.TRIANGLES,z,q,ut.alphaBlended,xt.disabled,zl(I,y.Color.transparent,Qe),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var Kc={symbol:function(c,p,f,g,S){if(c.renderPass==="translucent"){var I=Ye.disabled,R=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(z,q,ne,Se,Me,ye,Qe){for(var qe=q.transform,pt=Me==="map",Xe=ye==="map",dt=0,Ct=z;dt<Ct.length;dt+=1){var Wt=Ct[dt],vr=Se.getTile(Wt),er=vr.getBucket(ne);if(er&&er.text&&er.text.segments.get().length){var wr=y.evaluateSizeForZoom(er.textSizeData,qe.zoom),Wr=ba(vr,1,q.transform.zoom),bn=go(Wt.posMatrix,Xe,pt,q.transform,Wr),gn=ne.layout.get("icon-text-fit")!=="none"&&er.hasIconData();if(wr){var Gn=Math.pow(2,qe.zoom-vr.tileID.overscaledZ);tc(er,pt,Xe,Qe,y.symbolSize,qe,bn,Wt.posMatrix,Gn,wr,gn)}}}}(g,c,f,p,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&Ic(c,p,f,g,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),I,R),f.paint.get("text-opacity").constantOr(1)!==0&&Ic(c,p,f,g,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),I,R),p.map.showCollisionBoxes&&(ec(c,p,f,g,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),ec(c,p,f,g,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,p,f,g){if(c.renderPass==="translucent"){var S=f.paint.get("circle-opacity"),I=f.paint.get("circle-stroke-width"),R=f.paint.get("circle-stroke-opacity"),z=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||I.constantOr(1)!==0&&R.constantOr(1)!==0){for(var q=c.context,ne=q.gl,Se=c.depthModeForSublayer(0,ke.ReadOnly),Me=Ye.disabled,ye=c.colorModeForRenderPass(),Qe=[],qe=0;qe<g.length;qe++){var pt=g[qe],Xe=p.getTile(pt),dt=Xe.getBucket(f);if(dt){var Ct=dt.programConfigurations.get(f.id),Wt={programConfiguration:Ct,program:c.useProgram("circle",Ct),layoutVertexBuffer:dt.layoutVertexBuffer,indexBuffer:dt.indexBuffer,uniformValues:wh(c,pt,Xe,f)};if(z)for(var vr=0,er=dt.segments.get();vr<er.length;vr+=1){var wr=er[vr];Qe.push({segments:new y.SegmentVector([wr]),sortKey:wr.sortKey,state:Wt})}else Qe.push({segments:dt.segments,sortKey:0,state:Wt})}}z&&Qe.sort(function(xi,Si){return xi.sortKey-Si.sortKey});for(var Wr=0,bn=Qe;Wr<bn.length;Wr+=1){var gn=bn[Wr],Gn=gn.state;Gn.program.draw(q,ne.TRIANGLES,Se,Me,ye,xt.disabled,Gn.uniformValues,f.id,Gn.layoutVertexBuffer,Gn.indexBuffer,gn.segments,f.paint,c.transform.zoom,Gn.programConfiguration)}}}},heatmap:function(c,p,f,g){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var S=c.context,I=S.gl,R=Ye.disabled,z=new ut([I.ONE,I.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Qe,qe,pt){var Xe=Qe.gl;Qe.activeTexture.set(Xe.TEXTURE1),Qe.viewport.set([0,0,qe.width/4,qe.height/4]);var dt=pt.heatmapFbo;if(dt)Xe.bindTexture(Xe.TEXTURE_2D,dt.colorAttachment.get()),Qe.bindFramebuffer.set(dt.framebuffer);else{var Ct=Xe.createTexture();Xe.bindTexture(Xe.TEXTURE_2D,Ct),Xe.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_WRAP_S,Xe.CLAMP_TO_EDGE),Xe.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_WRAP_T,Xe.CLAMP_TO_EDGE),Xe.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_MIN_FILTER,Xe.LINEAR),Xe.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_MAG_FILTER,Xe.LINEAR),dt=pt.heatmapFbo=Qe.createFramebuffer(qe.width/4,qe.height/4,!1),function(Wt,vr,er,wr){var Wr=Wt.gl;Wr.texImage2D(Wr.TEXTURE_2D,0,Wr.RGBA,vr.width/4,vr.height/4,0,Wr.RGBA,Wt.extRenderToTextureHalfFloat?Wt.extTextureHalfFloat.HALF_FLOAT_OES:Wr.UNSIGNED_BYTE,null),wr.colorAttachment.set(er)}(Qe,qe,Ct,dt)}})(S,c,f),S.clear({color:y.Color.transparent});for(var q=0;q<g.length;q++){var ne=g[q];if(!p.hasRenderableParent(ne)){var Se=p.getTile(ne),Me=Se.getBucket(f);if(Me){var ye=Me.programConfigurations.get(f.id);c.useProgram("heatmap",ye).draw(S,I.TRIANGLES,ke.disabled,R,z,xt.disabled,Ul(ne.posMatrix,Se,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,f.paint,c.transform.zoom,ye)}}}S.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(Qe,qe){var pt=Qe.context,Xe=pt.gl,dt=qe.heatmapFbo;if(dt){pt.activeTexture.set(Xe.TEXTURE0),Xe.bindTexture(Xe.TEXTURE_2D,dt.colorAttachment.get()),pt.activeTexture.set(Xe.TEXTURE1);var Ct=qe.colorRampTexture;Ct||(Ct=qe.colorRampTexture=new y.Texture(pt,qe.colorRamp,Xe.RGBA)),Ct.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),Qe.useProgram("heatmapTexture").draw(pt,Xe.TRIANGLES,ke.disabled,Ye.disabled,Qe.colorModeForRenderPass(),xt.disabled,function(Wt,vr,er,wr){var Wr=y.create();y.ortho(Wr,0,Wt.width,Wt.height,0,0,1);var bn=Wt.context.gl;return{u_matrix:Wr,u_world:[bn.drawingBufferWidth,bn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:vr.paint.get("heatmap-opacity")}}(Qe,qe),qe.id,Qe.viewportBuffer,Qe.quadTriangleIndexBuffer,Qe.viewportSegments,qe.paint,Qe.transform.zoom)}}(c,f))},line:function(c,p,f,g){if(c.renderPass==="translucent"){var S=f.paint.get("line-opacity"),I=f.paint.get("line-width");if(S.constantOr(1)!==0&&I.constantOr(1)!==0)for(var R=c.depthModeForSublayer(0,ke.ReadOnly),z=c.colorModeForRenderPass(),q=f.paint.get("line-dasharray"),ne=f.paint.get("line-pattern"),Se=ne.constantOr(1),Me=f.paint.get("line-gradient"),ye=f.getCrossfadeParameters(),Qe=Se?"linePattern":q?"lineSDF":Me?"lineGradient":"line",qe=c.context,pt=qe.gl,Xe=!0,dt=0,Ct=g;dt<Ct.length;dt+=1){var Wt=Ct[dt],vr=p.getTile(Wt);if(!Se||vr.patternsLoaded()){var er=vr.getBucket(f);if(er){var wr=er.programConfigurations.get(f.id),Wr=c.context.program.get(),bn=c.useProgram(Qe,wr),gn=Xe||bn.program!==Wr,Gn=ne.constantOr(null);if(Gn&&vr.imageAtlas){var xi=vr.imageAtlas,Si=xi.patternPositions[Gn.to.toString()],bi=xi.patternPositions[Gn.from.toString()];Si&&bi&&wr.setConstantPatternPositions(Si,bi)}var Ea=Se?tl(c,vr,f,ye):q?Xf(c,vr,f,q,ye):Me?lo(c,vr,f,er.lineClipsArray.length):xl(c,vr,f);if(Se)qe.activeTexture.set(pt.TEXTURE0),vr.imageAtlasTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),wr.updatePaintBuffers(ye);else if(q&&(gn||c.lineAtlas.dirty))qe.activeTexture.set(pt.TEXTURE0),c.lineAtlas.bind(qe);else if(Me){var Xn=er.gradients[f.id],Hi=Xn.texture;if(f.gradientVersion!==Xn.version){var Qi=256;if(f.stepInterpolant){var Wi=p.getSource().maxzoom,Ri=Wt.canonical.z===Wi?Math.ceil(1<<c.transform.maxZoom-Wt.canonical.z):1;Qi=y.clamp(y.nextPowerOfTwo(er.maxLineLength/y.EXTENT*1024*Ri),256,qe.maxTextureSize)}Xn.gradient=y.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Qi,image:Xn.gradient||void 0,clips:er.lineClipsArray}),Xn.texture?Xn.texture.update(Xn.gradient):Xn.texture=new y.Texture(qe,Xn.gradient,pt.RGBA),Xn.version=f.gradientVersion,Hi=Xn.texture}qe.activeTexture.set(pt.TEXTURE0),Hi.bind(f.stepInterpolant?pt.NEAREST:pt.LINEAR,pt.CLAMP_TO_EDGE)}bn.draw(qe,pt.TRIANGLES,R,c.stencilModeForClipping(Wt),z,xt.disabled,Ea,f.id,er.layoutVertexBuffer,er.indexBuffer,er.segments,f.paint,c.transform.zoom,wr,er.layoutVertexBuffer2),Xe=!1}}}}},fill:function(c,p,f,g){var S=f.paint.get("fill-color"),I=f.paint.get("fill-opacity");if(I.constantOr(1)!==0){var R=c.colorModeForRenderPass(),z=f.paint.get("fill-pattern"),q=c.opaquePassEnabledForLayer()&&!z.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===q){var ne=c.depthModeForSublayer(1,c.renderPass==="opaque"?ke.ReadWrite:ke.ReadOnly);rl(c,p,f,g,ne,R,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var Se=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,ke.ReadOnly);rl(c,p,f,g,Se,R,!0)}}},"fill-extrusion":function(c,p,f,g){var S=f.paint.get("fill-extrusion-opacity");if(S!==0&&c.renderPass==="translucent"){var I=new ke(c.context.gl.LEQUAL,ke.ReadWrite,c.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))_f(c,p,f,g,I,Ye.disabled,ut.disabled),_f(c,p,f,g,I,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var R=c.colorModeForRenderPass();_f(c,p,f,g,I,Ye.disabled,R)}}},hillshade:function(c,p,f,g){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var S=c.context,I=c.depthModeForSublayer(0,ke.ReadOnly),R=c.colorModeForRenderPass(),z=c.renderPass==="translucent"?c.stencilConfigForOverlap(g):[{},g],q=z[0],ne=0,Se=z[1];ne<Se.length;ne+=1){var Me=Se[ne],ye=p.getTile(Me);ye.needsHillshadePrepare&&c.renderPass==="offscreen"?bp(c,ye,f,I,Ye.disabled,R):c.renderPass==="translucent"&&kc(c,ye,f,I,q[Me.overscaledZ],R)}S.viewport.set([0,0,c.width,c.height])}},raster:function(c,p,f,g){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&g.length)for(var S=c.context,I=S.gl,R=p.getSource(),z=c.useProgram("raster"),q=c.colorModeForRenderPass(),ne=R instanceof Ft?[{},g]:c.stencilConfigForOverlap(g),Se=ne[0],Me=ne[1],ye=Me[Me.length-1].overscaledZ,Qe=!c.options.moving,qe=0,pt=Me;qe<pt.length;qe+=1){var Xe=pt[qe],dt=c.depthModeForSublayer(Xe.overscaledZ-ye,f.paint.get("raster-opacity")===1?ke.ReadWrite:ke.ReadOnly,I.LESS),Ct=p.getTile(Xe),Wt=c.transform.calculatePosMatrix(Xe.toUnwrapped(),Qe);Ct.registerFadeDuration(f.paint.get("raster-fade-duration"));var vr=p.findLoadedParent(Xe,0),er=xf(Ct,vr,p,f,c.transform),wr=void 0,Wr=void 0,bn=f.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;S.activeTexture.set(I.TEXTURE0),Ct.texture.bind(bn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(I.TEXTURE1),vr?(vr.texture.bind(bn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),wr=Math.pow(2,vr.tileID.overscaledZ-Ct.tileID.overscaledZ),Wr=[Ct.tileID.canonical.x*wr%1,Ct.tileID.canonical.y*wr%1]):Ct.texture.bind(bn,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);var gn=e0(Wt,Wr||[0,0],wr||1,er,f);R instanceof Ft?z.draw(S,I.TRIANGLES,dt,Ye.disabled,q,xt.disabled,gn,f.id,R.boundsBuffer,c.quadTriangleIndexBuffer,R.boundsSegments):z.draw(S,I.TRIANGLES,dt,Se[Xe.overscaledZ],q,xt.disabled,gn,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,p,f){var g=f.paint.get("background-color"),S=f.paint.get("background-opacity");if(S!==0){var I=c.context,R=I.gl,z=c.transform,q=z.tileSize,ne=f.paint.get("background-pattern");if(!c.isPatternMissing(ne)){var Se=!ne&&g.a===1&&S===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===Se){var Me=Ye.disabled,ye=c.depthModeForSublayer(0,Se==="opaque"?ke.ReadWrite:ke.ReadOnly),Qe=c.colorModeForRenderPass(),qe=c.useProgram(ne?"backgroundPattern":"background"),pt=z.coveringTiles({tileSize:q});ne&&(I.activeTexture.set(R.TEXTURE0),c.imageManager.bind(c.context));for(var Xe=f.getCrossfadeParameters(),dt=0,Ct=pt;dt<Ct.length;dt+=1){var Wt=Ct[dt],vr=c.transform.calculatePosMatrix(Wt.toUnwrapped()),er=ne?Jl(vr,S,c,ne,{tileID:Wt,tileSize:q},Xe):gf(vr,S,g);qe.draw(I,R.TRIANGLES,ye,Me,Qe,xt.disabled,er,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,p,f){for(var g=0;g<f.length;g++)Eu(c,p,f[g])},custom:function(c,p,f){var g=c.context,S=f.implementation;if(c.renderPass==="offscreen"){var I=S.prerender;I&&(c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),I.call(S,g.gl,c.transform.customLayerMatrix()),g.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),g.setColorMode(c.colorModeForRenderPass()),g.setStencilMode(Ye.disabled);var R=S.renderingMode==="3d"?new ke(c.context.gl.LEQUAL,ke.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,ke.ReadOnly);g.setDepthMode(R),S.render(g.gl,c.transform.customLayerMatrix()),g.setDirty(),c.setBaseState(),g.bindFramebuffer.set(null)}}},Ui=function(c,p){this.context=new Ie(c),this.transform=p,this._tileTextures={},this.setup(),this.numSublayers=nt.maxUnderzooming+nt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new eu,this.gpuTimers={}};Ui.prototype.resize=function(c,p){if(this.width=c*y.browser.devicePixelRatio,this.height=p*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,g=this.style._order;f<g.length;f+=1)this.style._layers[g[f]].resize()},Ui.prototype.setup=function(){var c=this.context,p=new y.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(y.EXTENT,0),p.emplaceBack(0,y.EXTENT),p.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(p,ha.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var f=new y.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(y.EXTENT,0),f.emplaceBack(0,y.EXTENT),f.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=c.createVertexBuffer(f,ha.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var g=new y.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(y.EXTENT,0,y.EXTENT,0),g.emplaceBack(0,y.EXTENT,0,y.EXTENT),g.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(g,At.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,ha.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var I=new y.StructArrayLayout1ui2;I.emplaceBack(0),I.emplaceBack(1),I.emplaceBack(3),I.emplaceBack(2),I.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(I);var R=new y.StructArrayLayout3ui6;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(R),this.emptyTexture=new y.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var z=this.context.gl;this.stencilClearMode=new Ye({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO)},Ui.prototype.clearStencil=function(){var c=this.context,p=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=y.create();y.ortho(f,0,this.width,this.height,0,0,1),y.scale(f,f,[p.drawingBufferWidth,p.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,p.TRIANGLES,ke.disabled,this.stencilClearMode,ut.disabled,xt.disabled,el(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ui.prototype._renderTileClippingMasks=function(c,p){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&p&&p.length){this.currentStencilSource=c.source;var f=this.context,g=f.gl;this.nextStencilID+p.length>256&&this.clearStencil(),f.setColorMode(ut.disabled),f.setDepthMode(ke.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var I=0,R=p;I<R.length;I+=1){var z=R[I],q=this._tileClippingMaskIDs[z.key]=this.nextStencilID++;S.draw(f,g.TRIANGLES,ke.disabled,new Ye({func:g.ALWAYS,mask:0},q,255,g.KEEP,g.KEEP,g.REPLACE),ut.disabled,xt.disabled,el(z.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ui.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,p=this.context.gl;return new Ye({func:p.NOTEQUAL,mask:255},c,255,p.KEEP,p.KEEP,p.REPLACE)},Ui.prototype.stencilModeForClipping=function(c){var p=this.context.gl;return new Ye({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,p.KEEP,p.KEEP,p.REPLACE)},Ui.prototype.stencilConfigForOverlap=function(c){var p,f=this.context.gl,g=c.sort(function(q,ne){return ne.overscaledZ-q.overscaledZ}),S=g[g.length-1].overscaledZ,I=g[0].overscaledZ-S+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();for(var R={},z=0;z<I;z++)R[z+S]=new Ye({func:f.GEQUAL,mask:255},z+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=I,[R,g]}return[(p={},p[S]=Ye.disabled,p),g]},Ui.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new ut([c.CONSTANT_COLOR,c.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ut.unblended:ut.alphaBlended},Ui.prototype.depthModeForSublayer=function(c,p,f){if(!this.opaquePassEnabledForLayer())return ke.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new ke(f||this.context.gl.LEQUAL,p,[g,g])},Ui.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ui.prototype.render=function(c,p){var f=this;this.style=c,this.options=p,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var I in S){var R=S[I];R.used&&R.prepare(this.context)}var z,q,ne={},Se={},Me={};for(var ye in S){var Qe=S[ye];ne[ye]=Qe.getVisibleCoordinates(),Se[ye]=ne[ye].slice().reverse(),Me[ye]=Qe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var qe=0;qe<g.length;qe++)if(this.style._layers[g[qe]].is3D()){this.opaquePassCutoff=qe;break}this.renderPass="offscreen";for(var pt=0,Xe=g;pt<Xe.length;pt+=1){var dt=this.style._layers[Xe[pt]];if(dt.hasOffscreenPass()&&!dt.isHidden(this.transform.zoom)){var Ct=Se[dt.source];(dt.type==="custom"||Ct.length)&&this.renderLayer(this,S[dt.source],dt,Ct)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Wt=this.style._layers[g[this.currentLayer]],vr=S[Wt.source],er=ne[Wt.source];this._renderTileClippingMasks(Wt,er),this.renderLayer(this,vr,Wt,er)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var wr=this.style._layers[g[this.currentLayer]],Wr=S[wr.source],bn=(wr.type==="symbol"?Me:Se)[wr.source];this._renderTileClippingMasks(wr,ne[wr.source]),this.renderLayer(this,Wr,wr,bn)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(gn){gn.source&&!gn.isHidden(f.transform.zoom)&&(gn.source!==(q&&q.id)&&(q=f.style.sourceCaches[gn.source]),(!z||z.getSource().maxzoom<q.getSource().maxzoom)&&(z=q))}),z&&Kc.debug(this,z,z.getVisibleCoordinates())),this.options.showPadding&&function(gn){var Gn=gn.transform.padding;Qp(gn,gn.transform.height-(Gn.top||0),3,nc),Qp(gn,Gn.bottom||0,3,$h),Mh(gn,Gn.left||0,3,bf),Mh(gn,gn.transform.width-(Gn.right||0),3,Ef);var xi=gn.transform.centerPoint;(function(Si,bi,Ea,Xn){$c(Si,bi-1,Ea-10,2,20,Xn),$c(Si,bi-10,Ea-1,20,2,Xn)})(gn,xi.x,gn.transform.height-xi.y,Kp)}(this),this.context.setDefault()},Ui.prototype.renderLayer=function(c,p,f,g){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||g.length)&&(this.id=f.id,this.gpuTimingStart(f),Kc[f.type](c,p,f,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ui.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var p=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),f.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,f.query)}},Ui.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Ui.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Ui.prototype.queryGpuTimers=function(c){var p={};for(var f in c){var g=c[f],S=this.context.extTimerQuery,I=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),p[f]=I}return p},Ui.prototype.translatePosMatrix=function(c,p,f,g,S){if(!f[0]&&!f[1])return c;var I=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(I){var R=Math.sin(I),z=Math.cos(I);f=[f[0]*z-f[1]*R,f[0]*R+f[1]*z]}var q=[S?f[0]:ba(p,f[0],this.transform.zoom),S?f[1]:ba(p,f[1],this.transform.zoom),0],ne=new Float32Array(16);return y.translate(ne,c,q),ne},Ui.prototype.saveTileTexture=function(c){var p=this._tileTextures[c.size[0]];p?p.push(c):this._tileTextures[c.size[0]]=[c]},Ui.prototype.getTileTexture=function(c){var p=this._tileTextures[c];return p&&p.length>0?p.pop():null},Ui.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var p=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!p||!f},Ui.prototype.useProgram=function(c,p){this.cache=this.cache||{};var f=""+c+(p?p.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new qc(this.context,c,Xs[c],p,yf[c],this._showOverdrawInspector)),this.cache[f]},Ui.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ui.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Ui.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ui.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Cf=function(c,p){this.points=c,this.planes=p};Cf.fromInvProjectionMatrix=function(c,p,f){var g=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(R){return y.transformMat4([],R,c)}).map(function(R){return y.scale$1([],R,1/R[3]/p*g)}),I=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(R){var z=y.sub([],S[R[0]],S[R[1]]),q=y.sub([],S[R[2]],S[R[1]]),ne=y.normalize([],y.cross([],z,q)),Se=-y.dot(ne,S[R[1]]);return ne.concat(Se)});return new Cf(S,I)};var Sf=function(c,p){this.min=c,this.max=p,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Sf.prototype.quadrant=function(c){for(var p=[c%2==0,c<2],f=y.clone$2(this.min),g=y.clone$2(this.max),S=0;S<p.length;S++)f[S]=p[S]?this.min[S]:this.center[S],g[S]=p[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new Sf(f,g)},Sf.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},Sf.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},Sf.prototype.intersects=function(c){for(var p=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,g=0;g<c.planes.length;g++){for(var S=c.planes[g],I=0,R=0;R<p.length;R++)I+=y.dot$1(S,p[R])>=0;if(I===0)return 0;I!==p.length&&(f=!1)}if(f)return 2;for(var z=0;z<3;z++){for(var q=Number.MAX_VALUE,ne=-Number.MAX_VALUE,Se=0;Se<c.points.length;Se++){var Me=c.points[Se][z]-this.min[z];q=Math.min(q,Me),ne=Math.max(ne,Me)}if(ne<0||q>this.max[z]-this.min[z])return 0}return 1};var bl=function(c,p,f,g){if(c===void 0&&(c=0),p===void 0&&(p=0),f===void 0&&(f=0),g===void 0&&(g=0),isNaN(c)||c<0||isNaN(p)||p<0||isNaN(f)||f<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=p,this.left=f,this.right=g};bl.prototype.interpolate=function(c,p,f){return p.top!=null&&c.top!=null&&(this.top=y.number(c.top,p.top,f)),p.bottom!=null&&c.bottom!=null&&(this.bottom=y.number(c.bottom,p.bottom,f)),p.left!=null&&c.left!=null&&(this.left=y.number(c.left,p.left,f)),p.right!=null&&c.right!=null&&(this.right=y.number(c.right,p.right,f)),this},bl.prototype.getCenter=function(c,p){var f=y.clamp((this.left+c-this.right)/2,0,c),g=y.clamp((this.top+p-this.bottom)/2,0,p);return new y.Point(f,g)},bl.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},bl.prototype.clone=function(){return new bl(this.top,this.bottom,this.left,this.right)},bl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Sa=function(c,p,f,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=p||22,this._minPitch=f==null?0:f,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new bl,this._posMatrixCache={},this._alignedPosMatrixCache={}},_o={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Sa.prototype.clone=function(){var c=new Sa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},_o.minZoom.get=function(){return this._minZoom},_o.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},_o.maxZoom.get=function(){return this._maxZoom},_o.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},_o.minPitch.get=function(){return this._minPitch},_o.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},_o.maxPitch.get=function(){return this._maxPitch},_o.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},_o.renderWorldCopies.get=function(){return this._renderWorldCopies},_o.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},_o.worldSize.get=function(){return this.tileSize*this.scale},_o.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},_o.size.get=function(){return new y.Point(this.width,this.height)},_o.bearing.get=function(){return-this.angle/Math.PI*180},_o.bearing.set=function(c){var p=-y.wrap(c,-180,180)*Math.PI/180;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},_o.pitch.get=function(){return this._pitch/Math.PI*180},_o.pitch.set=function(c){var p=y.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())},_o.fov.get=function(){return this._fov/Math.PI*180},_o.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},_o.zoom.get=function(){return this._zoom},_o.zoom.set=function(c){var p=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this.scale=this.zoomScale(p),this.tileZoom=Math.floor(p),this.zoomFraction=p-this.tileZoom,this._constrain(),this._calcMatrices())},_o.center.get=function(){return this._center},_o.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},_o.padding.get=function(){return this._edgeInsets.toJSON()},_o.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},_o.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Sa.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},Sa.prototype.interpolatePadding=function(c,p,f){this._unmodified=!1,this._edgeInsets.interpolate(c,p,f),this._constrain(),this._calcMatrices()},Sa.prototype.coveringZoomLevel=function(c){var p=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,p)},Sa.prototype.getVisibleUnwrappedCoordinates=function(c){var p=[new y.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new y.Point(0,0)),g=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),I=this.pointCoordinate(new y.Point(0,this.height)),R=Math.floor(Math.min(f.x,g.x,S.x,I.x)),z=Math.floor(Math.max(f.x,g.x,S.x,I.x)),q=R-1;q<=z+1;q++)q!==0&&p.push(new y.UnwrappedTileID(q,c));return p},Sa.prototype.coveringTiles=function(c){var p=this.coveringZoomLevel(c),f=p;if(c.minzoom!==void 0&&p<c.minzoom)return[];c.maxzoom!==void 0&&p>c.maxzoom&&(p=c.maxzoom);var g=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,p),I=[S*g.x,S*g.y,0],R=Cf.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p),z=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(z=p);var q=function(gn){return{aabb:new Sf([gn*S,0,0],[(gn+1)*S,S,0]),zoom:0,x:0,y:0,wrap:gn,fullyVisible:!1}},ne=[],Se=[],Me=p,ye=c.reparseOverscaled?f:p;if(this._renderWorldCopies)for(var Qe=1;Qe<=3;Qe++)ne.push(q(-Qe)),ne.push(q(Qe));for(ne.push(q(0));ne.length>0;){var qe=ne.pop(),pt=qe.x,Xe=qe.y,dt=qe.fullyVisible;if(!dt){var Ct=qe.aabb.intersects(R);if(Ct===0)continue;dt=Ct===2}var Wt=qe.aabb.distanceX(I),vr=qe.aabb.distanceY(I),er=Math.max(Math.abs(Wt),Math.abs(vr));if(qe.zoom===Me||er>3+(1<<Me-qe.zoom)-2&&qe.zoom>=z)Se.push({tileID:new y.OverscaledTileID(qe.zoom===Me?ye:qe.zoom,qe.wrap,qe.zoom,pt,Xe),distanceSq:y.sqrLen([I[0]-.5-pt,I[1]-.5-Xe])});else for(var wr=0;wr<4;wr++){var Wr=(pt<<1)+wr%2,bn=(Xe<<1)+(wr>>1);ne.push({aabb:qe.aabb.quadrant(wr),zoom:qe.zoom+1,x:Wr,y:bn,wrap:qe.wrap,fullyVisible:dt})}}return Se.sort(function(gn,Gn){return gn.distanceSq-Gn.distanceSq}).map(function(gn){return gn.tileID})},Sa.prototype.resize=function(c,p){this.width=c,this.height=p,this.pixelsToGLUnits=[2/c,-2/p],this._constrain(),this._calcMatrices()},_o.unmodified.get=function(){return this._unmodified},Sa.prototype.zoomScale=function(c){return Math.pow(2,c)},Sa.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},Sa.prototype.project=function(c){var p=y.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(c.lng)*this.worldSize,y.mercatorYfromLat(p)*this.worldSize)},Sa.prototype.unproject=function(c){return new y.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},_o.point.get=function(){return this.project(this.center)},Sa.prototype.setLocationAtPoint=function(c,p){var f=this.pointCoordinate(p),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(c),I=new y.MercatorCoordinate(S.x-(f.x-g.x),S.y-(f.y-g.y));this.center=this.coordinateLocation(I),this._renderWorldCopies&&(this.center=this.center.wrap())},Sa.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},Sa.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},Sa.prototype.locationCoordinate=function(c){return y.MercatorCoordinate.fromLngLat(c)},Sa.prototype.coordinateLocation=function(c){return c.toLngLat()},Sa.prototype.pointCoordinate=function(c){var p=[c.x,c.y,0,1],f=[c.x,c.y,1,1];y.transformMat4(p,p,this.pixelMatrixInverse),y.transformMat4(f,f,this.pixelMatrixInverse);var g=p[3],S=f[3],I=p[1]/g,R=f[1]/S,z=p[2]/g,q=f[2]/S,ne=z===q?0:(0-z)/(q-z);return new y.MercatorCoordinate(y.number(p[0]/g,f[0]/S,ne)/this.worldSize,y.number(I,R,ne)/this.worldSize)},Sa.prototype.coordinatePoint=function(c){var p=[c.x*this.worldSize,c.y*this.worldSize,0,1];return y.transformMat4(p,p,this.pixelMatrix),new y.Point(p[0]/p[3],p[1]/p[3])},Sa.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},Sa.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Sa.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Sa.prototype.calculatePosMatrix=function(c,p){p===void 0&&(p=!1);var f=c.key,g=p?this._alignedPosMatrixCache:this._posMatrixCache;if(g[f])return g[f];var S=c.canonical,I=this.worldSize/this.zoomScale(S.z),R=S.x+Math.pow(2,S.z)*c.wrap,z=y.identity(new Float64Array(16));return y.translate(z,z,[R*I,S.y*I,0]),y.scale(z,z,[I/y.EXTENT,I/y.EXTENT,1]),y.multiply(z,p?this.alignedProjMatrix:this.projMatrix,z),g[f]=new Float32Array(z),g[f]},Sa.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Sa.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,p,f,g,S=-90,I=90,R=-180,z=180,q=this.size,ne=this._unmodified;if(this.latRange){var Se=this.latRange;S=y.mercatorYfromLat(Se[1])*this.worldSize,c=(I=y.mercatorYfromLat(Se[0])*this.worldSize)-S<q.y?q.y/(I-S):0}if(this.lngRange){var Me=this.lngRange;R=y.mercatorXfromLng(Me[0])*this.worldSize,p=(z=y.mercatorXfromLng(Me[1])*this.worldSize)-R<q.x?q.x/(z-R):0}var ye=this.point,Qe=Math.max(p||0,c||0);if(Qe)return this.center=this.unproject(new y.Point(p?(z+R)/2:ye.x,c?(I+S)/2:ye.y)),this.zoom+=this.scaleZoom(Qe),this._unmodified=ne,void(this._constraining=!1);if(this.latRange){var qe=ye.y,pt=q.y/2;qe-pt<S&&(g=S+pt),qe+pt>I&&(g=I-pt)}if(this.lngRange){var Xe=ye.x,dt=q.x/2;Xe-dt<R&&(f=R+dt),Xe+dt>z&&(f=z-dt)}f===void 0&&g===void 0||(this.center=this.unproject(new y.Point(f!==void 0?f:ye.x,g!==void 0?g:ye.y))),this._unmodified=ne,this._constraining=!1}},Sa.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var p=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),g=Math.sin(f)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-p-f,.01,Math.PI-.01)),S=this.point,I=S.x,R=S.y,z=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),q=this.height/50,ne=new Float64Array(16);y.perspective(ne,this._fov,this.width/this.height,q,z),ne[8]=2*-c.x/this.width,ne[9]=2*c.y/this.height,y.scale(ne,ne,[1,-1,1]),y.translate(ne,ne,[0,0,-this.cameraToCenterDistance]),y.rotateX(ne,ne,this._pitch),y.rotateZ(ne,ne,this.angle),y.translate(ne,ne,[-I,-R,0]),this.mercatorMatrix=y.scale([],ne,[this.worldSize,this.worldSize,this.worldSize]),y.scale(ne,ne,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ne,this.invProjMatrix=y.invert([],this.projMatrix);var Se=this.width%2/2,Me=this.height%2/2,ye=Math.cos(this.angle),Qe=Math.sin(this.angle),qe=I-Math.round(I)+ye*Se+Qe*Me,pt=R-Math.round(R)+ye*Me+Qe*Se,Xe=new Float64Array(ne);if(y.translate(Xe,Xe,[qe>.5?qe-1:qe,pt>.5?pt-1:pt,0]),this.alignedProjMatrix=Xe,ne=y.create(),y.scale(ne,ne,[this.width/2,-this.height/2,1]),y.translate(ne,ne,[1,-1,0]),this.labelPlaneMatrix=ne,ne=y.create(),y.scale(ne,ne,[1,-1,1]),y.translate(ne,ne,[-1,-1,0]),y.scale(ne,ne,[2/this.width,2/this.height,1]),this.glCoordMatrix=ne,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ne=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ne,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Sa.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new y.Point(0,0)),p=[c.x*this.worldSize,c.y*this.worldSize,0,1];return y.transformMat4(p,p,this.pixelMatrix)[3]/this.cameraToCenterDistance},Sa.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,c))},Sa.prototype.getCameraQueryGeometry=function(c){var p=this.getCameraPoint();if(c.length===1)return[c[0],p];for(var f=p.x,g=p.y,S=p.x,I=p.y,R=0,z=c;R<z.length;R+=1){var q=z[R];f=Math.min(f,q.x),g=Math.min(g,q.y),S=Math.max(S,q.x),I=Math.max(I,q.y)}return[new y.Point(f,g),new y.Point(S,g),new y.Point(S,I),new y.Point(f,I),new y.Point(f,g)]},Object.defineProperties(Sa.prototype,_o);var lu=function(c){var p,f,g,S;this._hashName=c&&encodeURIComponent(c),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(p=this._updateHashUnthrottled.bind(this),f=!1,g=null,S=function(){g=null,f&&(p(),g=setTimeout(S,300),f=!1)},function(){return f=!0,g||S(),g})};lu.prototype.addTo=function(c){return this._map=c,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},lu.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},lu.prototype.getHashString=function(c){var p=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,g=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),I=Math.round(p.lng*S)/S,R=Math.round(p.lat*S)/S,z=this._map.getBearing(),q=this._map.getPitch(),ne="";if(ne+=c?"/"+I+"/"+R+"/"+f:f+"/"+R+"/"+I,(z||q)&&(ne+="/"+Math.round(10*z)/10),q&&(ne+="/"+Math.round(q)),this._hashName){var Se=this._hashName,Me=!1,ye=y.window.location.hash.slice(1).split("&").map(function(Qe){var qe=Qe.split("=")[0];return qe===Se?(Me=!0,qe+"="+ne):Qe}).filter(function(Qe){return Qe});return Me||ye.push(Se+"="+ne),"#"+ye.join("&")}return"#"+ne},lu.prototype._getCurrentHash=function(){var c,p=this,f=y.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===p._hashName&&(c=g)}),(c&&c[1]||"").split("/")):f.split("/")},lu.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1},lu.prototype._updateHashUnthrottled=function(){var c=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,c)}catch(p){}};var Mo={linearity:.3,easing:y.bezier(0,0,.3,1)},Iu=y.extend({deceleration:2500,maxSpeed:1400},Mo),Zl=y.extend({deceleration:20,maxSpeed:1400},Mo),cu=y.extend({deceleration:1e3,maxSpeed:360},Mo),Jp=y.extend({deceleration:1e3,maxSpeed:90},Mo),qf=function(c){this._map=c,this.clear()};function Af(c,p){(!c.duration||c.duration<p.duration)&&(c.duration=p.duration,c.easing=p.easing)}function Vl(c,p,f){var g=f.maxSpeed,S=f.linearity,I=f.deceleration,R=y.clamp(c*S/(p/1e3),-g,g),z=Math.abs(R)/(I*S);return{easing:f.easing,duration:1e3*z,amount:R*(z/2)}}qf.prototype.clear=function(){this._inertiaBuffer=[]},qf.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:c})},qf.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,p=y.browser.now();c.length>0&&p-c[0].time>160;)c.shift()},qf.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var p={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},f=0,g=this._inertiaBuffer;f<g.length;f+=1){var S=g[f].settings;p.zoom+=S.zoomDelta||0,p.bearing+=S.bearingDelta||0,p.pitch+=S.pitchDelta||0,S.panDelta&&p.pan._add(S.panDelta),S.around&&(p.around=S.around),S.pinchAround&&(p.pinchAround=S.pinchAround)}var I=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,R={};if(p.pan.mag()){var z=Vl(p.pan.mag(),I,y.extend({},Iu,c||{}));R.offset=p.pan.mult(z.amount/p.pan.mag()),R.center=this._map.transform.center,Af(R,z)}if(p.zoom){var q=Vl(p.zoom,I,Zl);R.zoom=this._map.transform.zoom+q.amount,Af(R,q)}if(p.bearing){var ne=Vl(p.bearing,I,cu);R.bearing=this._map.transform.bearing+y.clamp(ne.amount,-179,179),Af(R,ne)}if(p.pitch){var Se=Vl(p.pitch,I,Jp);R.pitch=this._map.transform.pitch+Se.amount,Af(R,Se)}if(R.zoom||R.bearing){var Me=p.pinchAround===void 0?p.around:p.pinchAround;R.around=Me?this._map.unproject(Me):this._map.getCenter()}return this.clear(),y.extend(R,{noMoveStart:!0})}};var ms=function(c){function p(g,S,I,R){R===void 0&&(R={});var z=Q.mousePos(S.getCanvasContainer(),I),q=S.unproject(z);c.call(this,g,y.extend({point:z,lngLat:q,originalEvent:I},R)),this._defaultPrevented=!1,this.target=S}c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p;var f={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,f),p}(y.Event),nl=function(c){function p(g,S,I){var R=g==="touchend"?I.changedTouches:I.touches,z=Q.touchPos(S.getCanvasContainer(),R),q=z.map(function(Me){return S.unproject(Me)}),ne=z.reduce(function(Me,ye,Qe,qe){return Me.add(ye.div(qe.length))},new y.Point(0,0)),Se=S.unproject(ne);c.call(this,g,{points:z,point:ne,lngLats:q,lngLat:Se,originalEvent:I}),this._defaultPrevented=!1}c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p;var f={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,f),p}(y.Event),$f=function(c){function p(g,S,I){c.call(this,g,{originalEvent:I}),this._defaultPrevented=!1}c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p;var f={defaultPrevented:{configurable:!0}};return p.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(p.prototype,f),p}(y.Event),Ho=function(c,p){this._map=c,this._clickTolerance=p.clickTolerance};Ho.prototype.reset=function(){delete this._mousedownPos},Ho.prototype.wheel=function(c){return this._firePreventable(new $f(c.type,this._map,c))},Ho.prototype.mousedown=function(c,p){return this._mousedownPos=p,this._firePreventable(new ms(c.type,this._map,c))},Ho.prototype.mouseup=function(c){this._map.fire(new ms(c.type,this._map,c))},Ho.prototype.click=function(c,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new ms(c.type,this._map,c))},Ho.prototype.dblclick=function(c){return this._firePreventable(new ms(c.type,this._map,c))},Ho.prototype.mouseover=function(c){this._map.fire(new ms(c.type,this._map,c))},Ho.prototype.mouseout=function(c){this._map.fire(new ms(c.type,this._map,c))},Ho.prototype.touchstart=function(c){return this._firePreventable(new nl(c.type,this._map,c))},Ho.prototype.touchmove=function(c){this._map.fire(new nl(c.type,this._map,c))},Ho.prototype.touchend=function(c){this._map.fire(new nl(c.type,this._map,c))},Ho.prototype.touchcancel=function(c){this._map.fire(new nl(c.type,this._map,c))},Ho.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},Ho.prototype.isEnabled=function(){return!0},Ho.prototype.isActive=function(){return!1},Ho.prototype.enable=function(){},Ho.prototype.disable=function(){};var ri=function(c){this._map=c};ri.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},ri.prototype.mousemove=function(c){this._map.fire(new ms(c.type,this._map,c))},ri.prototype.mousedown=function(){this._delayContextMenu=!0},ri.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},ri.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new ms(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},ri.prototype.isEnabled=function(){return!0},ri.prototype.isActive=function(){return!1},ri.prototype.enable=function(){},ri.prototype.disable=function(){};var ma=function(c,p){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=p.clickTolerance||1};function Pc(c,p){for(var f={},g=0;g<c.length;g++)f[c[g].identifier]=p[g];return f}ma.prototype.isEnabled=function(){return!!this._enabled},ma.prototype.isActive=function(){return!!this._active},ma.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ma.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ma.prototype.mousedown=function(c,p){this.isEnabled()&&c.shiftKey&&c.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)},ma.prototype.mousemoveWindow=function(c,p){if(this._active){var f=p;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=f,this._box||(this._box=Q.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var S=Math.min(g.x,f.x),I=Math.max(g.x,f.x),R=Math.min(g.y,f.y),z=Math.max(g.y,f.y);Q.setTransform(this._box,"translate("+S+"px,"+R+"px)"),this._box.style.width=I-S+"px",this._box.style.height=z-R+"px"}}},ma.prototype.mouseupWindow=function(c,p){var f=this;if(this._active&&c.button===0){var g=this._startPos,S=p;if(this.reset(),Q.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(I){return I.fitScreenCoordinates(g,S,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},ma.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},ma.prototype.blur=function(){this.reset()},ma.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos},ma.prototype._fireEvent=function(c,p){return this._map.fire(new y.Event(c,{originalEvent:p}))};var wf=function(c){this.reset(),this.numTouches=c.numTouches};wf.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},wf.prototype.touchstart=function(c,p,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=function(g){for(var S=new y.Point(0,0),I=0,R=g;I<R.length;I+=1)S._add(R[I]);return S.div(g.length)}(p),this.touches=Pc(f,p)))},wf.prototype.touchmove=function(c,p,f){if(!this.aborted&&this.centroid){var g=Pc(f,p);for(var S in this.touches){var I=g[S];(!I||I.dist(this.touches[S])>30)&&(this.aborted=!0)}}},wf.prototype.touchend=function(c,p,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var ku=function(c){this.singleTap=new wf(c),this.numTaps=c.numTaps,this.reset()};ku.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ku.prototype.touchstart=function(c,p,f){this.singleTap.touchstart(c,p,f)},ku.prototype.touchmove=function(c,p,f){this.singleTap.touchmove(c,p,f)},ku.prototype.touchend=function(c,p,f){var g=this.singleTap.touchend(c,p,f);if(g){var S=c.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(g)<30;if(S&&I||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var Pu=function(){this._zoomIn=new ku({numTouches:1,numTaps:2}),this._zoomOut=new ku({numTouches:2,numTaps:1}),this.reset()};Pu.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Pu.prototype.touchstart=function(c,p,f){this._zoomIn.touchstart(c,p,f),this._zoomOut.touchstart(c,p,f)},Pu.prototype.touchmove=function(c,p,f){this._zoomIn.touchmove(c,p,f),this._zoomOut.touchmove(c,p,f)},Pu.prototype.touchend=function(c,p,f){var g=this,S=this._zoomIn.touchend(c,p,f),I=this._zoomOut.touchend(c,p,f);return S?(this._active=!0,c.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(S)},{originalEvent:c})}}):I?(this._active=!0,c.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(R){return R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(I)},{originalEvent:c})}}):void 0},Pu.prototype.touchcancel=function(){this.reset()},Pu.prototype.enable=function(){this._enabled=!0},Pu.prototype.disable=function(){this._enabled=!1,this.reset()},Pu.prototype.isEnabled=function(){return this._enabled},Pu.prototype.isActive=function(){return this._active};var Lc={0:1,2:2},Tn=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};Tn.prototype.blur=function(){this.reset()},Tn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Tn.prototype._correctButton=function(c,p){return!1},Tn.prototype._move=function(c,p){return{}},Tn.prototype.mousedown=function(c,p){if(!this._lastPoint){var f=Q.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=p,this._eventButton=f)}},Tn.prototype.mousemoveWindow=function(c,p){var f=this._lastPoint;if(f){if(c.preventDefault(),function(g,S){var I=Lc[S];return g.buttons===void 0||(g.buttons&I)!==I}(c,this._eventButton))this.reset();else if(this._moved||!(p.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(f,p)}},Tn.prototype.mouseupWindow=function(c){this._lastPoint&&Q.mouseButton(c)===this._eventButton&&(this._moved&&Q.suppressClick(),this.reset())},Tn.prototype.enable=function(){this._enabled=!0},Tn.prototype.disable=function(){this._enabled=!1,this.reset()},Tn.prototype.isEnabled=function(){return this._enabled},Tn.prototype.isActive=function(){return this._active};var Rc=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.mousedown=function(f,g){c.prototype.mousedown.call(this,f,g),this._lastPoint&&(this._active=!0)},p.prototype._correctButton=function(f,g){return g===0&&!f.ctrlKey},p.prototype._move=function(f,g){return{around:g,panDelta:g.sub(f)}},p}(Tn),Ih=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype._correctButton=function(f,g){return g===0&&f.ctrlKey||g===2},p.prototype._move=function(f,g){var S=.8*(g.x-f.x);if(S)return this._active=!0,{bearingDelta:S}},p.prototype.contextmenu=function(f){f.preventDefault()},p}(Tn),_a=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype._correctButton=function(f,g){return g===0&&f.ctrlKey||g===2},p.prototype._move=function(f,g){var S=-.5*(g.y-f.y);if(S)return this._active=!0,{pitchDelta:S}},p.prototype.contextmenu=function(f){f.preventDefault()},p}(Tn),ho=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};ho.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},ho.prototype.touchstart=function(c,p,f){return this._calculateTransform(c,p,f)},ho.prototype.touchmove=function(c,p,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,p,f)},ho.prototype.touchend=function(c,p,f){this._calculateTransform(c,p,f),this._active&&f.length<this._minTouches&&this.reset()},ho.prototype.touchcancel=function(){this.reset()},ho.prototype._calculateTransform=function(c,p,f){f.length>0&&(this._active=!0);var g=Pc(f,p),S=new y.Point(0,0),I=new y.Point(0,0),R=0;for(var z in g){var q=g[z],ne=this._touches[z];ne&&(S._add(q),I._add(q.sub(ne)),R++,g[z]=q)}if(this._touches=g,!(R<this._minTouches)&&I.mag()){var Se=I.div(R);if(this._sum._add(Se),!(this._sum.mag()<this._clickTolerance))return{around:S.div(R),panDelta:Se}}},ho.prototype.enable=function(){this._enabled=!0},ho.prototype.disable=function(){this._enabled=!1,this.reset()},ho.prototype.isEnabled=function(){return this._enabled},ho.prototype.isActive=function(){return this._active};var fu=function(){this.reset()};function kh(c,p,f){for(var g=0;g<c.length;g++)if(c[g].identifier===f)return p[g]}function il(c,p){return Math.log(c/p)/Math.LN2}fu.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},fu.prototype._start=function(c){},fu.prototype._move=function(c,p,f){return{}},fu.prototype.touchstart=function(c,p,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([p[0],p[1]]))},fu.prototype.touchmove=function(c,p,f){if(this._firstTwoTouches){c.preventDefault();var g=this._firstTwoTouches,S=g[1],I=kh(f,p,g[0]),R=kh(f,p,S);if(I&&R){var z=this._aroundCenter?null:I.add(R).div(2);return this._move([I,R],z,c)}}},fu.prototype.touchend=function(c,p,f){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],I=kh(f,p,g[0]),R=kh(f,p,S);I&&R||(this._active&&Q.suppressClick(),this.reset())}},fu.prototype.touchcancel=function(){this.reset()},fu.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},fu.prototype.disable=function(){this._enabled=!1,this.reset()},fu.prototype.isEnabled=function(){return this._enabled},fu.prototype.isActive=function(){return this._active};var tu=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},p.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},p.prototype._move=function(f,g){var S=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(il(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:il(this._distance,S),pinchAround:g}},p}(fu);function jl(c,p){return 180*c.angleWith(p)/Math.PI}var di=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},p.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},p.prototype._move=function(f,g){var S=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:jl(this._vector,S),pinchAround:g}},p.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var g=25/(Math.PI*this._minDiameter)*360,S=jl(f,this._startVector);return Math.abs(S)<g},p}(fu);function Kf(c){return Math.abs(c.y)>Math.abs(c.x)}var Ep=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},p.prototype._start=function(f){this._lastPoints=f,Kf(f[0].sub(f[1]))&&(this._valid=!1)},p.prototype._move=function(f,g,S){var I=f[0].sub(this._lastPoints[0]),R=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(I,R,S.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(I.y+R.y)/2*-.5}},p.prototype.gestureBeginsVertically=function(f,g,S){if(this._valid!==void 0)return this._valid;var I=f.mag()>=2,R=g.mag()>=2;if(I||R){if(!I||!R)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var z=f.y>0==g.y>0;return Kf(f)&&Kf(g)&&z}},p}(fu),Cp={panStep:100,bearingStep:15,pitchStep:10},al=function(){var c=Cp;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function Ys(c){return c*(2-c)}al.prototype.blur=function(){this.reset()},al.prototype.reset=function(){this._active=!1},al.prototype.keydown=function(c){var p=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,g=0,S=0,I=0,R=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?g=-1:(c.preventDefault(),I=-1);break;case 39:c.shiftKey?g=1:(c.preventDefault(),I=1);break;case 38:c.shiftKey?S=1:(c.preventDefault(),R=-1);break;case 40:c.shiftKey?S=-1:(c.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(z){var q=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:Ys,zoom:f?Math.round(q)+f*(c.shiftKey?2:1):q,bearing:z.getBearing()+g*p._bearingStep,pitch:z.getPitch()+S*p._pitchStep,offset:[-I*p._panStep,-R*p._panStep],center:z.getCenter()},{originalEvent:c})}}}},al.prototype.enable=function(){this._enabled=!0},al.prototype.disable=function(){this._enabled=!1,this.reset()},al.prototype.isEnabled=function(){return this._enabled},al.prototype.isActive=function(){return this._active},al.prototype.disableRotation=function(){this._rotationDisabled=!0},al.prototype.enableRotation=function(){this._rotationDisabled=!1};var la=function(c,p){this._map=c,this._el=c.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};la.prototype.setZoomRate=function(c){this._defaultZoomRate=c},la.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},la.prototype.isEnabled=function(){return!!this._enabled},la.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},la.prototype.isZooming=function(){return!!this._zooming},la.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},la.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},la.prototype.wheel=function(c){if(this.isEnabled()){var p=c.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=y.browser.now(),g=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,p!==0&&p%4.000244140625==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(g*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),c.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=c,this._delta-=p,this._active||this._start(c)),c.preventDefault()}},la.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},la.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var p=Q.mousePos(this._el,c);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(p)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},la.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var p=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?p.zoomScale(this._targetZoom):p.scale;this._targetZoom=Math.min(p.maxZoom,Math.max(p.minZoom,p.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=p.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var I,R=typeof this._targetZoom=="number"?this._targetZoom:p.zoom,z=this._startZoom,q=this._easing,ne=!1;if(this._type==="wheel"&&z&&q){var Se=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),Me=q(Se);I=y.number(z,R,Me),Se<1?this._frameId||(this._frameId=!0):ne=!0}else I=R,ne=!0;return this._active=!0,ne&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ne,zoomDelta:I-p.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},la.prototype._smoothOutEasing=function(c){var p=y.ease;if(this._prevEase){var f=this._prevEase,g=(y.browser.now()-f.start)/f.duration,S=f.easing(g+.01)-f.easing(g),I=.27/Math.sqrt(S*S+1e-4)*.01,R=Math.sqrt(.0729-I*I);p=y.bezier(I,R,.25,1)}return this._prevEase={start:y.browser.now(),duration:c,easing:p},p},la.prototype.blur=function(){this.reset()},la.prototype.reset=function(){this._active=!1};var El=function(c,p){this._clickZoom=c,this._tapZoom=p};El.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},El.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},El.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},El.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var hu=function(){this.reset()};hu.prototype.reset=function(){this._active=!1},hu.prototype.blur=function(){this.reset()},hu.prototype.dblclick=function(c,p){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(p)},{originalEvent:c})}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var ws=function(){this._tap=new ku({numTouches:1,numTaps:1}),this.reset()};ws.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ws.prototype.touchstart=function(c,p,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=p[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,p,f))},ws.prototype.touchmove=function(c,p,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var g=p[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,p,f)},ws.prototype.touchend=function(c,p,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,p,f)&&(this._tapTime=c.timeStamp)},ws.prototype.touchcancel=function(){this.reset()},ws.prototype.enable=function(){this._enabled=!0},ws.prototype.disable=function(){this._enabled=!1,this.reset()},ws.prototype.isEnabled=function(){return this._enabled},ws.prototype.isActive=function(){return this._active};var Tf=function(c,p,f){this._el=c,this._mousePan=p,this._touchPan=f};Tf.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Tf.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Tf.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Tf.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Gl=function(c,p,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=p,this._mousePitch=f};Gl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Gl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Gl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Gl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ol=function(c,p,f,g){this._el=c,this._touchZoom=p,this._touchRotate=f,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};ol.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ol.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ol.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ol.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ol.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ol.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var pu=function(c){return c.zoom||c.drag||c.pitch||c.rotate},sl=function(c){function p(){c.apply(this,arguments)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p}(y.Event);function _i(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var pi=function(c,p){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qf(c),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p),y.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[y.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var I=S[g],R=I[0];Q.addEventListener(R,I[1],R===y.window.document?this.handleWindowEvent:this.handleEvent,I[2])}};pi.prototype.destroy=function(){for(var c=0,p=this._listeners;c<p.length;c+=1){var f=p[c],g=f[0];Q.removeEventListener(g,f[1],g===y.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},pi.prototype._addDefaultHandlers=function(c){var p=this._map,f=p.getCanvasContainer();this._add("mapEvent",new Ho(p,c));var g=p.boxZoom=new ma(p,c);this._add("boxZoom",g);var S=new Pu,I=new hu;p.doubleClickZoom=new El(I,S),this._add("tapZoom",S),this._add("clickZoom",I);var R=new ws;this._add("tapDragZoom",R);var z=p.touchPitch=new Ep;this._add("touchPitch",z);var q=new Ih(c),ne=new _a(c);p.dragRotate=new Gl(c,q,ne),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",ne,["mouseRotate"]);var Se=new Rc(c),Me=new ho(c);p.dragPan=new Tf(f,Se,Me),this._add("mousePan",Se),this._add("touchPan",Me,["touchZoom","touchRotate"]);var ye=new di,Qe=new tu;p.touchZoomRotate=new ol(f,Qe,ye,R),this._add("touchRotate",ye,["touchPan","touchZoom"]),this._add("touchZoom",Qe,["touchPan","touchRotate"]);var qe=p.scrollZoom=new la(p,this);this._add("scrollZoom",qe,["mousePan"]);var pt=p.keyboard=new al;this._add("keyboard",pt),this._add("blockableMapEvent",new ri(p));for(var Xe=0,dt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Xe<dt.length;Xe+=1){var Ct=dt[Xe];c.interactive&&c[Ct]&&p[Ct].enable(c[Ct])}},pi.prototype._add=function(c,p,f){this._handlers.push({handlerName:c,handler:p,allowed:f}),this._handlersById[c]=p},pi.prototype.stop=function(c){if(!this._updatingCamera){for(var p=0,f=this._handlers;p<f.length;p+=1)f[p].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},pi.prototype.isActive=function(){for(var c=0,p=this._handlers;c<p.length;c+=1)if(p[c].handler.isActive())return!0;return!1},pi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},pi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},pi.prototype.isMoving=function(){return Boolean(pu(this._eventsInProgress))||this.isZooming()},pi.prototype._blockedByActive=function(c,p,f){for(var g in c)if(g!==f&&(!p||p.indexOf(g)<0))return!0;return!1},pi.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},pi.prototype._getMapTouches=function(c){for(var p=[],f=0,g=c;f<g.length;f+=1){var S=g[f];this._el.contains(S.target)&&p.push(S)}return p},pi.prototype.handleEvent=function(c,p){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,g={needsRenderFrame:!1},S={},I={},R=c.touches?this._getMapTouches(c.touches):void 0,z=R?Q.touchPos(this._el,R):Q.mousePos(this._el,c),q=0,ne=this._handlers;q<ne.length;q+=1){var Se=ne[q],Me=Se.handlerName,ye=Se.handler,Qe=Se.allowed;if(ye.isEnabled()){var qe=void 0;this._blockedByActive(I,Qe,Me)?ye.reset():ye[p||c.type]&&(qe=ye[p||c.type](c,z,R),this.mergeHandlerResult(g,S,qe,Me,f),qe&&qe.needsRenderFrame&&this._triggerRenderFrame()),(qe||ye.isActive())&&(I[Me]=ye)}}var pt={};for(var Xe in this._previousActiveHandlers)I[Xe]||(pt[Xe]=f);this._previousActiveHandlers=I,(Object.keys(pt).length||_i(g))&&(this._changes.push([g,S,pt]),this._triggerRenderFrame()),(Object.keys(I).length||_i(g))&&this._map._stop(!0),this._updatingCamera=!1;var dt=g.cameraAnimation;dt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],dt(this._map))},pi.prototype.mergeHandlerResult=function(c,p,f,g,S){if(f){y.extend(c,f);var I={handlerName:g,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(p.zoom=I),f.panDelta!==void 0&&(p.drag=I),f.pitchDelta!==void 0&&(p.pitch=I),f.bearingDelta!==void 0&&(p.rotate=I)}},pi.prototype._applyChanges=function(){for(var c={},p={},f={},g=0,S=this._changes;g<S.length;g+=1){var I=S[g],R=I[0],z=I[1],q=I[2];R.panDelta&&(c.panDelta=(c.panDelta||new y.Point(0,0))._add(R.panDelta)),R.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+R.zoomDelta),R.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+R.bearingDelta),R.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+R.pitchDelta),R.around!==void 0&&(c.around=R.around),R.pinchAround!==void 0&&(c.pinchAround=R.pinchAround),R.noInertia&&(c.noInertia=R.noInertia),y.extend(p,z),y.extend(f,q)}this._updateMapTransform(c,p,f),this._changes=[]},pi.prototype._updateMapTransform=function(c,p,f){var g=this._map,S=g.transform;if(!_i(c))return this._fireEvents(p,f,!0);var I=c.panDelta,R=c.zoomDelta,z=c.bearingDelta,q=c.pitchDelta,ne=c.around,Se=c.pinchAround;Se!==void 0&&(ne=Se),g._stop(!0),ne=ne||g.transform.centerPoint;var Me=S.pointLocation(I?ne.sub(I):ne);z&&(S.bearing+=z),q&&(S.pitch+=q),R&&(S.zoom+=R),S.setLocationAtPoint(Me,ne),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(p,f,!0)},pi.prototype._fireEvents=function(c,p,f){var g=this,S=pu(this._eventsInProgress),I=pu(c),R={};for(var z in c)this._eventsInProgress[z]||(R[z+"start"]=c[z].originalEvent),this._eventsInProgress[z]=c[z];for(var q in!S&&I&&this._fireEvent("movestart",I.originalEvent),R)this._fireEvent(q,R[q]);for(var ne in I&&this._fireEvent("move",I.originalEvent),c)this._fireEvent(ne,c[ne].originalEvent);var Se,Me={};for(var ye in this._eventsInProgress){var Qe=this._eventsInProgress[ye],qe=Qe.handlerName,pt=Qe.originalEvent;this._handlersById[qe].isActive()||(delete this._eventsInProgress[ye],Me[ye+"end"]=Se=p[qe]||pt)}for(var Xe in Me)this._fireEvent(Xe,Me[Xe]);var dt=pu(this._eventsInProgress);if(f&&(S||I)&&!dt){this._updatingCamera=!0;var Ct=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Wt=function(vr){return vr!==0&&-g._bearingSnap<vr&&vr<g._bearingSnap};Ct?(Wt(Ct.bearing||this._map.getBearing())&&(Ct.bearing=0),this._map.easeTo(Ct,{originalEvent:Se})):(this._map.fire(new y.Event("moveend",{originalEvent:Se})),Wt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},pi.prototype._fireEvent=function(c,p){this._map.fire(new y.Event(c,p?{originalEvent:p}:{}))},pi.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(p){delete c._frameId,c.handleEvent(new sl("renderFrame",{timeStamp:p})),c._applyChanges()})},pi.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Mf=function(c){function p(f,g){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=g.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},p.prototype.setCenter=function(f,g){return this.jumpTo({center:f},g)},p.prototype.panBy=function(f,g,S){return f=y.Point.convert(f).mult(-1),this.panTo(this.transform.center,y.extend({offset:f},g),S)},p.prototype.panTo=function(f,g,S){return this.easeTo(y.extend({center:f},g),S)},p.prototype.getZoom=function(){return this.transform.zoom},p.prototype.setZoom=function(f,g){return this.jumpTo({zoom:f},g),this},p.prototype.zoomTo=function(f,g,S){return this.easeTo(y.extend({zoom:f},g),S)},p.prototype.zoomIn=function(f,g){return this.zoomTo(this.getZoom()+1,f,g),this},p.prototype.zoomOut=function(f,g){return this.zoomTo(this.getZoom()-1,f,g),this},p.prototype.getBearing=function(){return this.transform.bearing},p.prototype.setBearing=function(f,g){return this.jumpTo({bearing:f},g),this},p.prototype.getPadding=function(){return this.transform.padding},p.prototype.setPadding=function(f,g){return this.jumpTo({padding:f},g),this},p.prototype.rotateTo=function(f,g,S){return this.easeTo(y.extend({bearing:f},g),S)},p.prototype.resetNorth=function(f,g){return this.rotateTo(0,y.extend({duration:1e3},f),g),this},p.prototype.resetNorthPitch=function(f,g){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},f),g),this},p.prototype.snapToNorth=function(f,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,g):this},p.prototype.getPitch=function(){return this.transform.pitch},p.prototype.setPitch=function(f,g){return this.jumpTo({pitch:f},g),this},p.prototype.cameraForBounds=function(f,g){f=y.LngLatBounds.convert(f);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),S,g)},p.prototype._cameraForBoxAndBearing=function(f,g,S,I){var R={top:0,bottom:0,right:0,left:0};if(typeof(I=y.extend({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},I)).padding=="number"){var z=I.padding;I.padding={top:z,bottom:z,right:z,left:z}}I.padding=y.extend(R,I.padding);var q=this.transform,ne=q.padding,Se=q.project(y.LngLat.convert(f)),Me=q.project(y.LngLat.convert(g)),ye=Se.rotate(-S*Math.PI/180),Qe=Me.rotate(-S*Math.PI/180),qe=new y.Point(Math.max(ye.x,Qe.x),Math.max(ye.y,Qe.y)),pt=new y.Point(Math.min(ye.x,Qe.x),Math.min(ye.y,Qe.y)),Xe=qe.sub(pt),dt=(q.width-(ne.left+ne.right+I.padding.left+I.padding.right))/Xe.x,Ct=(q.height-(ne.top+ne.bottom+I.padding.top+I.padding.bottom))/Xe.y;if(!(Ct<0||dt<0)){var Wt=Math.min(q.scaleZoom(q.scale*Math.min(dt,Ct)),I.maxZoom),vr=typeof I.offset.x=="number"?new y.Point(I.offset.x,I.offset.y):y.Point.convert(I.offset),er=new y.Point((I.padding.left-I.padding.right)/2,(I.padding.top-I.padding.bottom)/2).rotate(S*Math.PI/180),wr=vr.add(er).mult(q.scale/q.zoomScale(Wt));return{center:q.unproject(Se.add(Me).div(2).sub(wr)),zoom:Wt,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},p.prototype.fitBounds=function(f,g,S){return this._fitInternal(this.cameraForBounds(f,g),g,S)},p.prototype.fitScreenCoordinates=function(f,g,S,I,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(f)),this.transform.pointLocation(y.Point.convert(g)),S,I),I,R)},p.prototype._fitInternal=function(f,g,S){return f?(delete(g=y.extend(f,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},p.prototype.jumpTo=function(f,g){this.stop();var S=this.transform,I=!1,R=!1,z=!1;return"zoom"in f&&S.zoom!==+f.zoom&&(I=!0,S.zoom=+f.zoom),f.center!==void 0&&(S.center=y.LngLat.convert(f.center)),"bearing"in f&&S.bearing!==+f.bearing&&(R=!0,S.bearing=+f.bearing),"pitch"in f&&S.pitch!==+f.pitch&&(z=!0,S.pitch=+f.pitch),f.padding==null||S.isPaddingEqual(f.padding)||(S.padding=f.padding),this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),I&&this.fire(new y.Event("zoomstart",g)).fire(new y.Event("zoom",g)).fire(new y.Event("zoomend",g)),R&&this.fire(new y.Event("rotatestart",g)).fire(new y.Event("rotate",g)).fire(new y.Event("rotateend",g)),z&&this.fire(new y.Event("pitchstart",g)).fire(new y.Event("pitch",g)).fire(new y.Event("pitchend",g)),this.fire(new y.Event("moveend",g))},p.prototype.easeTo=function(f,g){var S=this;this._stop(!1,f.easeId),((f=y.extend({offset:[0,0],duration:500,easing:y.ease},f)).animate===!1||!f.essential&&y.browser.prefersReducedMotion)&&(f.duration=0);var I=this.transform,R=this.getZoom(),z=this.getBearing(),q=this.getPitch(),ne=this.getPadding(),Se="zoom"in f?+f.zoom:R,Me="bearing"in f?this._normalizeBearing(f.bearing,z):z,ye="pitch"in f?+f.pitch:q,Qe="padding"in f?f.padding:I.padding,qe=y.Point.convert(f.offset),pt=I.centerPoint.add(qe),Xe=I.pointLocation(pt),dt=y.LngLat.convert(f.center||Xe);this._normalizeCenter(dt);var Ct,Wt,vr=I.project(Xe),er=I.project(dt).sub(vr),wr=I.zoomScale(Se-R);f.around&&(Ct=y.LngLat.convert(f.around),Wt=I.locationPoint(Ct));var Wr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Se!==R,this._rotating=this._rotating||z!==Me,this._pitching=this._pitching||ye!==q,this._padding=!I.isPaddingEqual(Qe),this._easeId=f.easeId,this._prepareEase(g,f.noMoveStart,Wr),this._ease(function(bn){if(S._zooming&&(I.zoom=y.number(R,Se,bn)),S._rotating&&(I.bearing=y.number(z,Me,bn)),S._pitching&&(I.pitch=y.number(q,ye,bn)),S._padding&&(I.interpolatePadding(ne,Qe,bn),pt=I.centerPoint.add(qe)),Ct)I.setLocationAtPoint(Ct,Wt);else{var gn=I.zoomScale(I.zoom-R),Gn=Se>R?Math.min(2,wr):Math.max(.5,wr),xi=Math.pow(Gn,1-bn),Si=I.unproject(vr.add(er.mult(bn*xi)).mult(gn));I.setLocationAtPoint(I.renderWorldCopies?Si.wrap():Si,pt)}S._fireMoveEvents(g)},function(bn){S._afterEase(g,bn)},f),this},p.prototype._prepareEase=function(f,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new y.Event("movestart",f)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",f)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",f)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",f))},p.prototype._fireMoveEvents=function(f){this.fire(new y.Event("move",f)),this._zooming&&this.fire(new y.Event("zoom",f)),this._rotating&&this.fire(new y.Event("rotate",f)),this._pitching&&this.fire(new y.Event("pitch",f))},p.prototype._afterEase=function(f,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,I=this._rotating,R=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",f)),I&&this.fire(new y.Event("rotateend",f)),R&&this.fire(new y.Event("pitchend",f)),this.fire(new y.Event("moveend",f))}},p.prototype.flyTo=function(f,g){var S=this;if(!f.essential&&y.browser.prefersReducedMotion){var I=y.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(I,g)}this.stop(),f=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},f);var R=this.transform,z=this.getZoom(),q=this.getBearing(),ne=this.getPitch(),Se=this.getPadding(),Me="zoom"in f?y.clamp(+f.zoom,R.minZoom,R.maxZoom):z,ye="bearing"in f?this._normalizeBearing(f.bearing,q):q,Qe="pitch"in f?+f.pitch:ne,qe="padding"in f?f.padding:R.padding,pt=R.zoomScale(Me-z),Xe=y.Point.convert(f.offset),dt=R.centerPoint.add(Xe),Ct=R.pointLocation(dt),Wt=y.LngLat.convert(f.center||Ct);this._normalizeCenter(Wt);var vr=R.project(Ct),er=R.project(Wt).sub(vr),wr=f.curve,Wr=Math.max(R.width,R.height),bn=Wr/pt,gn=er.mag();if("minZoom"in f){var Gn=y.clamp(Math.min(f.minZoom,z,Me),R.minZoom,R.maxZoom),xi=Wr/R.zoomScale(Gn-z);wr=Math.sqrt(xi/gn*2)}var Si=wr*wr;function bi(Zi){var wi=(bn*bn-Wr*Wr+(Zi?-1:1)*Si*Si*gn*gn)/(2*(Zi?bn:Wr)*Si*gn);return Math.log(Math.sqrt(wi*wi+1)-wi)}function Ea(Zi){return(Math.exp(Zi)-Math.exp(-Zi))/2}function Xn(Zi){return(Math.exp(Zi)+Math.exp(-Zi))/2}var Hi=bi(0),Qi=function(Zi){return Xn(Hi)/Xn(Hi+wr*Zi)},Wi=function(Zi){return Wr*((Xn(Hi)*(Ea(wi=Hi+wr*Zi)/Xn(wi))-Ea(Hi))/Si)/gn;var wi},Ri=(bi(1)-Hi)/wr;if(Math.abs(gn)<1e-6||!isFinite(Ri)){if(Math.abs(Wr-bn)<1e-6)return this.easeTo(f,g);var oa=bn<Wr?-1:1;Ri=Math.abs(Math.log(bn/Wr))/wr,Wi=function(){return 0},Qi=function(Zi){return Math.exp(oa*wr*Zi)}}return f.duration="duration"in f?+f.duration:1e3*Ri/("screenSpeed"in f?+f.screenSpeed/wr:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=q!==ye,this._pitching=Qe!==ne,this._padding=!R.isPaddingEqual(qe),this._prepareEase(g,!1),this._ease(function(Zi){var wi=Zi*Ri,us=1/Qi(wi);R.zoom=Zi===1?Me:z+R.scaleZoom(us),S._rotating&&(R.bearing=y.number(q,ye,Zi)),S._pitching&&(R.pitch=y.number(ne,Qe,Zi)),S._padding&&(R.interpolatePadding(Se,qe,Zi),dt=R.centerPoint.add(Xe));var Wo=Zi===1?Wt:R.unproject(vr.add(er.mult(Wi(wi))).mult(us));R.setLocationAtPoint(R.renderWorldCopies?Wo.wrap():Wo,dt),S._fireMoveEvents(g)},function(){return S._afterEase(g)},f),this},p.prototype.isEasing=function(){return!!this._easeFrameId},p.prototype.stop=function(){return this._stop()},p.prototype._stop=function(f,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!f){var I=this.handlers;I&&I.stop(!1)}return this},p.prototype._ease=function(f,g,S){S.animate===!1||S.duration===0?(f(1),g()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=f,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},p.prototype._renderFrameCallback=function(){var f=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},p.prototype._normalizeBearing=function(f,g){f=y.wrap(f,-180,180);var S=Math.abs(f-g);return Math.abs(f-360-g)<S&&(f-=360),Math.abs(f+360-g)<S&&(f+=360),f},p.prototype._normalizeCenter=function(f){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=f.lng-g.center.lng;f.lng+=S>180?-360:S<-180?360:0}},p}(y.Evented),Os=function(c){c===void 0&&(c={}),this.options=c,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Os.prototype.getDefaultPosition=function(){return"bottom-right"},Os.prototype.onAdd=function(c){var p=this.options&&this.options.compact;return this._map=c,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),p===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Os.prototype.onRemove=function(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Os.prototype._setElementTitle=function(c,p){var f=this._map._getUIString("AttributionControl."+p);c.title=f,c.setAttribute("aria-label",f)},Os.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Os.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(c){var f=p.reduce(function(g,S,I){return S.value&&(g+=S.key+"="+S.value+(I<p.length-1?"&":"")),g},"?");c.href=y.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},Os.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Os.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(z){return typeof z!="string"?"":z})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}var f=this._map.style.sourceCaches;for(var g in f){var S=f[g];if(S.used){var I=S.getSource();I.attribution&&c.indexOf(I.attribution)<0&&c.push(I.attribution)}}c.sort(function(z,q){return z.length-q.length});var R=(c=c.filter(function(z,q){for(var ne=q+1;ne<c.length;ne++)if(c[ne].indexOf(z)>=0)return!1;return!0})).join(" | ");R!==this._attribHTML&&(this._attribHTML=R,c.length?(this._innerContainer.innerHTML=R,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Os.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var ul=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};ul.prototype.onAdd=function(c){this._map=c,this._container=Q.create("div","mapboxgl-ctrl");var p=Q.create("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},ul.prototype.onRemove=function(){Q.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},ul.prototype.getDefaultPosition=function(){return"bottom-left"},ul.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},ul.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var p in c)if(c[p].getSource().mapbox_logo)return!0;return!1}},ul.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var p=c[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}};var Yo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Yo.prototype.add=function(c){var p=++this._id;return this._queue.push({callback:c,id:p,cancelled:!1}),p},Yo.prototype.remove=function(c){for(var p=this._currentlyRunning,f=0,g=p?this._queue.concat(p):this._queue;f<g.length;f+=1){var S=g[f];if(S.id===c)return void(S.cancelled=!0)}},Yo.prototype.run=function(c){c===void 0&&(c=0);var p=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,g=p;f<g.length;f+=1){var S=g[f];if(!S.cancelled&&(S.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Yo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Lu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Ph=y.window.HTMLImageElement,Qf=y.window.HTMLElement,Qa=y.window.ImageBitmap,po={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Jf=function(c){function p(g){var S=this;if((g=y.extend({},po,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var I=new Sa(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(c.call(this,I,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Yo,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},Lu,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new y.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=y.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Qf))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new pi(this,g),this._hash=g.hash&&new lu(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,y.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new Os({customAttribution:g.customAttribution})),this.addControl(new ul,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(R){S._update(R.dataType==="style"),S.fire(new y.Event(R.dataType+"data",R))}),this.on("dataloading",function(R){S.fire(new y.Event(R.dataType+"dataloading",R))})}c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return p.prototype._getMapId=function(){return this._mapId},p.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var I=g.onAdd(this);this._controls.push(g);var R=this._controlPositions[S];return S.indexOf("bottom")!==-1?R.insertBefore(I,R.firstChild):R.appendChild(I),this},p.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},p.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},p.prototype.resize=function(g){var S=this._containerDimensions(),I=S[0],R=S[1];if(I===this.transform.width&&R===this.transform.height)return this;this._resizeCanvas(I,R),this.transform.resize(I,R),this.painter.resize(I,R);var z=!this._moving;return z&&this.fire(new y.Event("movestart",g)).fire(new y.Event("move",g)),this.fire(new y.Event("resize",g)),z&&this.fire(new y.Event("moveend",g)),this},p.prototype.getBounds=function(){return this.transform.getBounds()},p.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},p.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(y.LngLatBounds.convert(g)),this._update()},p.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},p.prototype.getMinZoom=function(){return this.transform.minZoom},p.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},p.prototype.getMaxZoom=function(){return this.transform.maxZoom},p.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},p.prototype.getMinPitch=function(){return this.transform.minPitch},p.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},p.prototype.getMaxPitch=function(){return this.transform.maxPitch},p.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},p.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},p.prototype.project=function(g){return this.transform.locationPoint(y.LngLat.convert(g))},p.prototype.unproject=function(g){return this.transform.pointLocation(y.Point.convert(g))},p.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},p.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},p.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},p.prototype._createDelegatedListener=function(g,S,I){var R,z=this;if(g==="mouseenter"||g==="mouseover"){var q=!1;return{layer:S,listener:I,delegates:{mousemove:function(Se){var Me=z.getLayer(S)?z.queryRenderedFeatures(Se.point,{layers:[S]}):[];Me.length?q||(q=!0,I.call(z,new ms(g,z,Se.originalEvent,{features:Me}))):q=!1},mouseout:function(){q=!1}}}}if(g==="mouseleave"||g==="mouseout"){var ne=!1;return{layer:S,listener:I,delegates:{mousemove:function(Se){(z.getLayer(S)?z.queryRenderedFeatures(Se.point,{layers:[S]}):[]).length?ne=!0:ne&&(ne=!1,I.call(z,new ms(g,z,Se.originalEvent)))},mouseout:function(Se){ne&&(ne=!1,I.call(z,new ms(g,z,Se.originalEvent)))}}}}return{layer:S,listener:I,delegates:(R={},R[g]=function(Se){var Me=z.getLayer(S)?z.queryRenderedFeatures(Se.point,{layers:[S]}):[];Me.length&&(Se.features=Me,I.call(z,Se),delete Se.features)},R)}},p.prototype.on=function(g,S,I){if(I===void 0)return c.prototype.on.call(this,g,S);var R=this._createDelegatedListener(g,S,I);for(var z in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(R),R.delegates)this.on(z,R.delegates[z]);return this},p.prototype.once=function(g,S,I){if(I===void 0)return c.prototype.once.call(this,g,S);var R=this._createDelegatedListener(g,S,I);for(var z in R.delegates)this.once(z,R.delegates[z]);return this},p.prototype.off=function(g,S,I){var R=this;return I===void 0?c.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(z){for(var q=z[g],ne=0;ne<q.length;ne++){var Se=q[ne];if(Se.layer===S&&Se.listener===I){for(var Me in Se.delegates)R.off(Me,Se.delegates[Me]);return q.splice(ne,1),R}}}(this._delegatedListeners),this)},p.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var I;if(S!==void 0||g===void 0||g instanceof y.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof g[0]=="number")I=[y.Point.convert(g)];else{var R=y.Point.convert(g[0]),z=y.Point.convert(g[1]);I=[R,new y.Point(z.x,R.y),z,new y.Point(R.x,z.y),R]}return this.style.queryRenderedFeatures(I,S,this.transform)},p.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},p.prototype.setStyle=function(g,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},p.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},p.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Ro(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},p.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},p.prototype._diffStyle=function(g,S){var I=this;if(typeof g=="string"){var R=this._requestManager.normalizeStyleURL(g),z=this._requestManager.transformRequest(R,y.ResourceType.Style);y.getJSON(z,function(q,ne){q?I.fire(new y.ErrorEvent(q)):ne&&I._updateDiff(ne,S)})}else typeof g=="object"&&this._updateDiff(g,S)},p.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(I){y.warnOnce("Unable to perform style diff: "+(I.message||I.error||I)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},p.prototype.getStyle=function(){if(this.style)return this.style.serialize()},p.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},p.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},p.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},p.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var I=g[S]._tiles;for(var R in I){var z=I[R];if(z.state!=="loaded"&&z.state!=="errored")return!1}}return!0},p.prototype.addSourceType=function(g,S,I){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,I)},p.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},p.prototype.getSource=function(g){return this.style.getSource(g)},p.prototype.addImage=function(g,S,I){I===void 0&&(I={});var R=I.pixelRatio;R===void 0&&(R=1);var z=I.sdf;z===void 0&&(z=!1);var q=I.stretchX,ne=I.stretchY,Se=I.content;if(this._lazyInitEmptyStyle(),S instanceof Ph||Qa&&S instanceof Qa){var Me=y.browser.getImageData(S);this.style.addImage(g,{data:new y.RGBAImage({width:Me.width,height:Me.height},Me.data),pixelRatio:R,stretchX:q,stretchY:ne,content:Se,sdf:z,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ye=S;this.style.addImage(g,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:R,stretchX:q,stretchY:ne,content:Se,sdf:z,version:0,userImage:ye}),ye.onAdd&&ye.onAdd(this,g)}},p.prototype.updateImage=function(g,S){var I=this.style.getImage(g);if(!I)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var R=S instanceof Ph||Qa&&S instanceof Qa?y.browser.getImageData(S):S,z=R.width,q=R.height,ne=R.data;return z===void 0||q===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):z!==I.data.width||q!==I.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(I.data.replace(ne,!(S instanceof Ph||Qa&&S instanceof Qa)),void this.style.updateImage(g,I))},p.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},p.prototype.removeImage=function(g){this.style.removeImage(g)},p.prototype.loadImage=function(g,S){y.getImage(this._requestManager.transformRequest(g,y.ResourceType.Image),S)},p.prototype.listImages=function(){return this.style.listImages()},p.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},p.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},p.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},p.prototype.getLayer=function(g){return this.style.getLayer(g)},p.prototype.setLayerZoomRange=function(g,S,I){return this.style.setLayerZoomRange(g,S,I),this._update(!0)},p.prototype.setFilter=function(g,S,I){return I===void 0&&(I={}),this.style.setFilter(g,S,I),this._update(!0)},p.prototype.getFilter=function(g){return this.style.getFilter(g)},p.prototype.setPaintProperty=function(g,S,I,R){return R===void 0&&(R={}),this.style.setPaintProperty(g,S,I,R),this._update(!0)},p.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},p.prototype.setLayoutProperty=function(g,S,I,R){return R===void 0&&(R={}),this.style.setLayoutProperty(g,S,I,R),this._update(!0)},p.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},p.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},p.prototype.getLight=function(){return this.style.getLight()},p.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},p.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},p.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},p.prototype.getContainer=function(){return this._container},p.prototype.getCanvasContainer=function(){return this._canvasContainer},p.prototype.getCanvas=function(){return this._canvas},p.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},p.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},p.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=Q.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=Q.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var I=this._containerDimensions();this._resizeCanvas(I[0],I[1]);var R=this._controlContainer=Q.create("div","mapboxgl-control-container",g),z=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(q){z[q]=Q.create("div","mapboxgl-ctrl-"+q,R)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},p.prototype._resizeCanvas=function(g,S){var I=y.browser.devicePixelRatio||1;this._canvas.width=I*g,this._canvas.height=I*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},p.prototype._setupPainter=function(){var g=y.extend({},Ne.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new Ui(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},p.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:g}))},p.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:g}))},p.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},p.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},p.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},p.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},p.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},p.prototype._render=function(g){var S,I=this,R=0,z=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=z.createQueryEXT(),z.beginQueryEXT(z.TIME_ELAPSED_EXT,S),R=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var q=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ne=this.transform.zoom,Se=y.browser.now();this.style.zoomHistory.update(ne,Se);var Me=new y.EvaluationParameters(ne,{now:Se,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ye=Me.crossFadingFactor();ye===1&&ye===this._crossFadingFactor||(q=!0,this._crossFadingFactor=ye),this.style.update(Me)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||q)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Qe=y.browser.now()-R;z.endQueryEXT(z.TIME_ELAPSED_EXT,S),setTimeout(function(){var Xe=z.getQueryObjectEXT(S,z.QUERY_RESULT_EXT)/1e6;z.deleteQueryEXT(S),I.fire(new y.Event("gpu-timing-frame",{cpuTime:Qe,gpuTime:Xe}))},50)}if(this.listens("gpu-timing-layer")){var qe=this.painter.collectGpuTimers();setTimeout(function(){var Xe=I.painter.queryGpuTimers(qe);I.fire(new y.Event("gpu-timing-layer",{layerTimes:Xe}))},50)}var pt=this._sourcesDirty||this._styleDirty||this._placementDirty;return pt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||pt||(this._fullyLoaded=!0),this}},p.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var I=this.painter.context.gl.getExtension("WEBGL_lose_context");I&&I.loseContext(),eh(this._canvasContainer),eh(this._controlContainer),eh(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},p.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){g._frame=null,g._render(S)}))},p.prototype._onWindowOnline=function(){this._update()},p.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(g){this._vertices=g,this._update()},p.prototype._setCacheLimits=function(g,S){y.setCacheLimits(g,S)},f.version.get=function(){return y.version},Object.defineProperties(p.prototype,f),p}(Mf);function eh(c){c.parentNode&&c.parentNode.removeChild(c)}var Cl={showCompass:!0,showZoom:!0,visualizePitch:!1},Sl=function(c){var p=this;this.options=y.extend({},Cl,c),this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return p._map.zoomIn({},{originalEvent:f})}),Q.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return p._map.zoomOut({},{originalEvent:f})}),Q.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){p.options.visualizePitch?p._map.resetNorthPitch({},{originalEvent:f}):p._map.resetNorth({},{originalEvent:f})}),this._compassIcon=Q.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Sl.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),p=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},Sl.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},Sl.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Fs(this._map,this._compass,this.options.visualizePitch)),this._container},Sl.prototype.onRemove=function(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Sl.prototype._createButton=function(c,p){var f=Q.create("button",c,this._container);return f.type="button",f.addEventListener("click",p),f},Sl.prototype._setButtonTitle=function(c,p){var f=this._map._getUIString("NavigationControl."+p);c.title=f,c.setAttribute("aria-label",f)};var Fs=function(c,p,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=p,this.mouseRotate=new Ih({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new _a({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Q.addEventListener(p,"mousedown",this.mousedown),Q.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(p,"touchmove",this.touchmove),Q.addEventListener(p,"touchend",this.touchend),Q.addEventListener(p,"touchcancel",this.reset)};function Ao(c,p,f){if(c=new y.LngLat(c.lng,c.lat),p){var g=new y.LngLat(c.lng-360,c.lat),S=new y.LngLat(c.lng+360,c.lat),I=f.locationPoint(c).distSqr(p);f.locationPoint(g).distSqr(p)<I?c=g:f.locationPoint(S).distSqr(p)<I&&(c=S)}for(;Math.abs(c.lng-f.center.lng)>180;){var R=f.locationPoint(c);if(R.x>=0&&R.y>=0&&R.x<=f.width&&R.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}Fs.prototype.down=function(c,p){this.mouseRotate.mousedown(c,p),this.mousePitch&&this.mousePitch.mousedown(c,p),Q.disableDrag()},Fs.prototype.move=function(c,p){var f=this.map,g=this.mouseRotate.mousemoveWindow(c,p);if(g&&g.bearingDelta&&f.setBearing(f.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(c,p);S&&S.pitchDelta&&f.setPitch(f.getPitch()+S.pitchDelta)}},Fs.prototype.off=function(){var c=this.element;Q.removeEventListener(c,"mousedown",this.mousedown),Q.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(c,"touchmove",this.touchmove),Q.removeEventListener(c,"touchend",this.touchend),Q.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},Fs.prototype.offTemp=function(){Q.enableDrag(),Q.removeEventListener(y.window,"mousemove",this.mousemove),Q.removeEventListener(y.window,"mouseup",this.mouseup)},Fs.prototype.mousedown=function(c){this.down(y.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),Q.mousePos(this.element,c)),Q.addEventListener(y.window,"mousemove",this.mousemove),Q.addEventListener(y.window,"mouseup",this.mouseup)},Fs.prototype.mousemove=function(c){this.move(c,Q.mousePos(this.element,c))},Fs.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},Fs.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},Fs.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},Fs.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Fs.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var ic={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Kh(c,p,f){var g=c.classList;for(var S in ic)g.remove("mapboxgl-"+f+"-anchor-"+S);g.add("mapboxgl-"+f+"-anchor-"+p)}var Qc,th=function(c){function p(f,g){if(c.call(this),(f instanceof y.window.HTMLElement||g)&&(f=y.extend({element:f},g)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=y.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div"),this._element.setAttribute("aria-label","Map marker");var S=Q.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var I=Q.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"stroke","none"),I.setAttributeNS(null,"stroke-width","1"),I.setAttributeNS(null,"fill","none"),I.setAttributeNS(null,"fill-rule","evenodd");var R=Q.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill-rule","nonzero");var z=Q.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(3.0, 29.0)"),z.setAttributeNS(null,"fill","#000000");for(var q=0,ne=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];q<ne.length;q+=1){var Se=ne[q],Me=Q.createNS("http://www.w3.org/2000/svg","ellipse");Me.setAttributeNS(null,"opacity","0.04"),Me.setAttributeNS(null,"cx","10.5"),Me.setAttributeNS(null,"cy","5.80029008"),Me.setAttributeNS(null,"rx",Se.rx),Me.setAttributeNS(null,"ry",Se.ry),z.appendChild(Me)}var ye=Q.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"fill",this._color);var Qe=Q.createNS("http://www.w3.org/2000/svg","path");Qe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ye.appendChild(Qe);var qe=Q.createNS("http://www.w3.org/2000/svg","g");qe.setAttributeNS(null,"opacity","0.25"),qe.setAttributeNS(null,"fill","#000000");var pt=Q.createNS("http://www.w3.org/2000/svg","path");pt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),qe.appendChild(pt);var Xe=Q.createNS("http://www.w3.org/2000/svg","g");Xe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Xe.setAttributeNS(null,"fill","#FFFFFF");var dt=Q.createNS("http://www.w3.org/2000/svg","g");dt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ct=Q.createNS("http://www.w3.org/2000/svg","circle");Ct.setAttributeNS(null,"fill","#000000"),Ct.setAttributeNS(null,"opacity","0.25"),Ct.setAttributeNS(null,"cx","5.5"),Ct.setAttributeNS(null,"cy","5.5"),Ct.setAttributeNS(null,"r","5.4999962");var Wt=Q.createNS("http://www.w3.org/2000/svg","circle");Wt.setAttributeNS(null,"fill","#FFFFFF"),Wt.setAttributeNS(null,"cx","5.5"),Wt.setAttributeNS(null,"cy","5.5"),Wt.setAttributeNS(null,"r","5.4999962"),dt.appendChild(Ct),dt.appendChild(Wt),R.appendChild(z),R.appendChild(ye),R.appendChild(qe),R.appendChild(Xe),R.appendChild(dt),S.appendChild(R),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(vr){vr.preventDefault()}),this._element.addEventListener("mousedown",function(vr){vr.preventDefault()}),Kh(this._element,this._anchor,"marker"),this._popup=null}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},p.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this},p.prototype.getLngLat=function(){return this._lngLat},p.prototype.setLngLat=function(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},p.prototype.getElement=function(){return this._element},p.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},p.prototype._onKeyPress=function(f){var g=f.code,S=f.charCode||f.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},p.prototype._onMapClick=function(f){var g=f.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},p.prototype.getPopup=function(){return this._popup},p.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},p.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ao(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,ic[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},p.prototype.getOffset=function(){return this._offset},p.prototype.setOffset=function(f){return this._offset=y.Point.convert(f),this._update(),this},p.prototype._onMove=function(f){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},p.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},p.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},p.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},p.prototype.isDraggable=function(){return this._draggable},p.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},p.prototype.getRotation=function(){return this._rotation},p.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},p.prototype.getRotationAlignment=function(){return this._rotationAlignment},p.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},p.prototype.getPitchAlignment=function(){return this._pitchAlignment},p}(y.Evented),Qh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ll=0,ac=!1,Jc=function(c){function p(f){c.call(this),this.options=y.extend({},Qh,f),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.onAdd=function(f){var g;return this._map=f,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Qc!==void 0?g(Qc):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(Qc=S.state!=="denied")}):g(Qc=!!y.window.navigator.geolocation),this._container},p.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ll=0,ac=!1},p.prototype._isOutOfMapMaxBounds=function(f){var g=this._map.getMaxBounds(),S=f.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},p.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},p.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",f)),this._finish()}},p.prototype._updateCamera=function(f){var g=new y.LngLat(f.coords.longitude,f.coords.latitude),S=f.coords.accuracy,I=this._map.getBearing(),R=y.extend({bearing:I},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),R,{geolocateSource:!0})},p.prototype._updateMarker=function(f){if(f){var g=new y.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},p.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,g=this._map.unproject([0,f]),S=this._map.unproject([1,f]),I=g.distanceTo(S),R=Math.ceil(2*this._accuracy/I);this._circleElement.style.width=R+"px",this._circleElement.style.height=R+"px"},p.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},p.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&ac)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",f)),this._finish()}},p.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},p.prototype._setupUI=function(f){var g=this;if(this._container.addEventListener("contextmenu",function(R){return R.preventDefault()}),this._geolocateButton=Q.create("button","mapboxgl-ctrl-geolocate",this._container),Q.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var I=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=I,this._geolocateButton.setAttribute("aria-label",I)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new th(this._dotElement),this._circleElement=Q.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new th({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(R){R.geolocateSource||g._watchState!=="ACTIVE_LOCK"||R.originalEvent&&R.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new y.Event("trackuserlocationend")))})},p.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ll--,ac=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ll>1?(f={maximumAge:6e5,timeout:0},ac=!0):(f=this.options.positionOptions,ac=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},p.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},p}(y.Evented),oc={maxWidth:100,unit:"metric"},Hl=function(c){this.options=y.extend({},oc,c),y.bindAll(["_onMove","setUnit"],this)};function Lh(c,p,f){var g=f&&f.maxWidth||100,S=c._container.clientHeight/2,I=c.unproject([0,S]),R=c.unproject([g,S]),z=I.distanceTo(R);if(f&&f.unit==="imperial"){var q=3.2808*z;q>5280?sc(p,g,q/5280,c._getUIString("ScaleControl.Miles")):sc(p,g,q,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?sc(p,g,z/1852,c._getUIString("ScaleControl.NauticalMiles")):z>=1e3?sc(p,g,z/1e3,c._getUIString("ScaleControl.Kilometers")):sc(p,g,z,c._getUIString("ScaleControl.Meters"))}function sc(c,p,f,g){var S,I,R,z=(S=f,(I=Math.pow(10,(""+Math.floor(S)).length-1))*(R=(R=S/I)>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(q){var ne=Math.pow(10,Math.ceil(-Math.log(q)/Math.LN10));return Math.round(q*ne)/ne}(R)));c.style.width=p*(z/f)+"px",c.innerHTML=z+"&nbsp;"+g}Hl.prototype.getDefaultPosition=function(){return"bottom-left"},Hl.prototype._onMove=function(){Lh(this._map,this._container,this.options)},Hl.prototype.onAdd=function(c){return this._map=c,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Hl.prototype.onRemove=function(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Hl.prototype.setUnit=function(c){this.options.unit=c,Lh(this._map,this._container,this.options)};var Al=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof y.window.HTMLElement?this._container=c.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};Al.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Al.prototype.onRemove=function(){Q.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Al.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},Al.prototype._setupUI=function(){var c=this._fullscreenButton=Q.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Al.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},Al.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Al.prototype._isFullscreen=function(){return this._fullscreen},Al.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Al.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var If={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Rh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Gu=function(c){function p(f){c.call(this),this.options=y.extend(Object.create(If),f),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(p.__proto__=c),(p.prototype=Object.create(c&&c.prototype)).constructor=p,p.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},p.prototype.isOpen=function(){return!!this._map},p.prototype.remove=function(){return this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},p.prototype.getLngLat=function(){return this._lngLat},p.prototype.setLngLat=function(f){return this._lngLat=y.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},p.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},p.prototype.getElement=function(){return this._container},p.prototype.setText=function(f){return this.setDOMContent(y.window.document.createTextNode(f))},p.prototype.setHTML=function(f){var g,S=y.window.document.createDocumentFragment(),I=y.window.document.createElement("body");for(I.innerHTML=f;g=I.firstChild;)S.appendChild(g);return this.setDOMContent(S)},p.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},p.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},p.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},p.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},p.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},p.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},p.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},p.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Q.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},p.prototype._onMouseUp=function(f){this._update(f.point)},p.prototype._onMouseMove=function(f){this._update(f.point)},p.prototype._onDrag=function(f){this._update(f.point)},p.prototype._update=function(f){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Q.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Q.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Me){return g._container.classList.add(Me)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ao(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var S=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),I=this.options.anchor,R=function Me(ye){if(ye){if(typeof ye=="number"){var Qe=Math.round(Math.sqrt(.5*Math.pow(ye,2)));return{center:new y.Point(0,0),top:new y.Point(0,ye),"top-left":new y.Point(Qe,Qe),"top-right":new y.Point(-Qe,Qe),bottom:new y.Point(0,-ye),"bottom-left":new y.Point(Qe,-Qe),"bottom-right":new y.Point(-Qe,-Qe),left:new y.Point(ye,0),right:new y.Point(-ye,0)}}if(ye instanceof y.Point||Array.isArray(ye)){var qe=y.Point.convert(ye);return{center:qe,top:qe,"top-left":qe,"top-right":qe,bottom:qe,"bottom-left":qe,"bottom-right":qe,left:qe,right:qe}}return{center:y.Point.convert(ye.center||[0,0]),top:y.Point.convert(ye.top||[0,0]),"top-left":y.Point.convert(ye["top-left"]||[0,0]),"top-right":y.Point.convert(ye["top-right"]||[0,0]),bottom:y.Point.convert(ye.bottom||[0,0]),"bottom-left":y.Point.convert(ye["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(ye["bottom-right"]||[0,0]),left:y.Point.convert(ye.left||[0,0]),right:y.Point.convert(ye.right||[0,0])}}return Me(new y.Point(0,0))}(this.options.offset);if(!I){var z,q=this._container.offsetWidth,ne=this._container.offsetHeight;z=S.y+R.bottom.y<ne?["top"]:S.y>this._map.transform.height-ne?["bottom"]:[],S.x<q/2?z.push("left"):S.x>this._map.transform.width-q/2&&z.push("right"),I=z.length===0?"bottom":z.join("-")}var Se=S.add(R[I]).round();Q.setTransform(this._container,ic[I]+" translate("+Se.x+"px,"+Se.y+"px)"),Kh(this._container,I,"popup")}},p.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(Rh);f&&f.focus()}},p.prototype._onClose=function(){this.remove()},p}(y.Evented),ef={version:y.version,supported:Ne,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:Jf,NavigationControl:Sl,GeolocateControl:Jc,AttributionControl:Os,ScaleControl:Hl,FullscreenControl:Al,Popup:Gu,Marker:th,Style:Ro,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){rr().acquire(pr)},clearPrewarmedResources:function(){var c=oi;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(pr),oi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(c){y.config.ACCESS_TOKEN=c},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(c){y.config.API_URL=c},get workerCount(){return Hr.workerCount},set workerCount(c){Hr.workerCount=c},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){y.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){y.clearTileCache(c)},workerUrl:""};return ef}),He})},3614:function(ci,Ae,de){"use strict";ci.exports=ge;var He=de(80645);function ge(fe){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(fe)?fe:new Uint8Array(fe||0),this.pos=0,this.type=0,this.length=this.buf.length}ge.Varint=0,ge.Fixed64=1,ge.Bytes=2,ge.Fixed32=5;var y=(1<<16)*(1<<16),Ne=1/y,Q=12,Pe=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");ge.prototype={destroy:function(){this.buf=null},readFields:function(fe,rt,X){for(X=X||this.length;this.pos<X;){var ae=this.readVarint(),ze=ae>>3,At=this.pos;this.type=ae&7,fe(ze,rt,this),this.pos===At&&this.skip(ae)}return rt},readMessage:function(fe,rt){return this.readFields(fe,rt,this.readVarint()+this.pos)},readFixed32:function(){var fe=Ot(this.buf,this.pos);return this.pos+=4,fe},readSFixed32:function(){var fe=Qt(this.buf,this.pos);return this.pos+=4,fe},readFixed64:function(){var fe=Ot(this.buf,this.pos)+Ot(this.buf,this.pos+4)*y;return this.pos+=8,fe},readSFixed64:function(){var fe=Ot(this.buf,this.pos)+Qt(this.buf,this.pos+4)*y;return this.pos+=8,fe},readFloat:function(){var fe=He.read(this.buf,this.pos,!0,23,4);return this.pos+=4,fe},readDouble:function(){var fe=He.read(this.buf,this.pos,!0,52,8);return this.pos+=8,fe},readVarint:function(fe){var rt=this.buf,X,ae;return ae=rt[this.pos++],X=ae&127,ae<128||(ae=rt[this.pos++],X|=(ae&127)<<7,ae<128)||(ae=rt[this.pos++],X|=(ae&127)<<14,ae<128)||(ae=rt[this.pos++],X|=(ae&127)<<21,ae<128)?X:(ae=rt[this.pos],X|=(ae&15)<<28,ve(X,fe,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var fe=this.readVarint();return fe%2==1?(fe+1)/-2:fe/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var fe=this.readVarint()+this.pos,rt=this.pos;return this.pos=fe,fe-rt>=Q&&Pe?Ar(this.buf,rt,fe):Ue(this.buf,rt,fe)},readBytes:function(){var fe=this.readVarint()+this.pos,rt=this.buf.subarray(this.pos,fe);return this.pos=fe,rt},readPackedVarint:function(fe,rt){if(this.type!==ge.Bytes)return fe.push(this.readVarint(rt));var X=lt(this);for(fe=fe||[];this.pos<X;)fe.push(this.readVarint(rt));return fe},readPackedSVarint:function(fe){if(this.type!==ge.Bytes)return fe.push(this.readSVarint());var rt=lt(this);for(fe=fe||[];this.pos<rt;)fe.push(this.readSVarint());return fe},readPackedBoolean:function(fe){if(this.type!==ge.Bytes)return fe.push(this.readBoolean());var rt=lt(this);for(fe=fe||[];this.pos<rt;)fe.push(this.readBoolean());return fe},readPackedFloat:function(fe){if(this.type!==ge.Bytes)return fe.push(this.readFloat());var rt=lt(this);for(fe=fe||[];this.pos<rt;)fe.push(this.readFloat());return fe},readPackedDouble:function(fe){if(this.type!==ge.Bytes)return fe.push(this.readDouble());var rt=lt(this);for(fe=fe||[];this.pos<rt;)fe.push(this.readDouble());return fe},readPackedFixed32:function(fe){if(this.type!==ge.Bytes)return fe.push(this.readFixed32());var rt=lt(this);for(fe=fe||[];this.pos<rt;)fe.push(this.readFixed32());return fe},readPackedSFixed32:function(fe){if(this.type!==ge.Bytes)return fe.push(this.readSFixed32());var rt=lt(this);for(fe=fe||[];this.pos<rt;)fe.push(this.readSFixed32());return fe},readPackedFixed64:function(fe){if(this.type!==ge.Bytes)return fe.push(this.readFixed64());var rt=lt(this);for(fe=fe||[];this.pos<rt;)fe.push(this.readFixed64());return fe},readPackedSFixed64:function(fe){if(this.type!==ge.Bytes)return fe.push(this.readSFixed64());var rt=lt(this);for(fe=fe||[];this.pos<rt;)fe.push(this.readSFixed64());return fe},skip:function(fe){var rt=fe&7;if(rt===ge.Varint)for(;this.buf[this.pos++]>127;);else if(rt===ge.Bytes)this.pos=this.readVarint()+this.pos;else if(rt===ge.Fixed32)this.pos+=4;else if(rt===ge.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+rt)},writeTag:function(fe,rt){this.writeVarint(fe<<3|rt)},realloc:function(fe){for(var rt=this.length||16;rt<this.pos+fe;)rt*=2;if(rt!==this.length){var X=new Uint8Array(rt);X.set(this.buf),this.buf=X,this.length=rt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(fe){this.realloc(4),yt(this.buf,fe,this.pos),this.pos+=4},writeSFixed32:function(fe){this.realloc(4),yt(this.buf,fe,this.pos),this.pos+=4},writeFixed64:function(fe){this.realloc(8),yt(this.buf,fe&-1,this.pos),yt(this.buf,Math.floor(fe*Ne),this.pos+4),this.pos+=8},writeSFixed64:function(fe){this.realloc(8),yt(this.buf,fe&-1,this.pos),yt(this.buf,Math.floor(fe*Ne),this.pos+4),this.pos+=8},writeVarint:function(fe){if(fe=+fe||0,fe>268435455||fe<0){We(fe,this);return}this.realloc(4),this.buf[this.pos++]=fe&127|(fe>127?128:0),!(fe<=127)&&(this.buf[this.pos++]=(fe>>>=7)&127|(fe>127?128:0),!(fe<=127)&&(this.buf[this.pos++]=(fe>>>=7)&127|(fe>127?128:0),!(fe<=127)&&(this.buf[this.pos++]=fe>>>7&127)))},writeSVarint:function(fe){this.writeVarint(fe<0?-fe*2-1:fe*2)},writeBoolean:function(fe){this.writeVarint(Boolean(fe))},writeString:function(fe){fe=String(fe),this.realloc(fe.length*4),this.pos++;var rt=this.pos;this.pos=an(this.buf,fe,this.pos);var X=this.pos-rt;X>=128&&tr(rt,X,this),this.pos=rt-1,this.writeVarint(X),this.pos+=X},writeFloat:function(fe){this.realloc(4),He.write(this.buf,fe,this.pos,!0,23,4),this.pos+=4},writeDouble:function(fe){this.realloc(8),He.write(this.buf,fe,this.pos,!0,52,8),this.pos+=8},writeBytes:function(fe){var rt=fe.length;this.writeVarint(rt),this.realloc(rt);for(var X=0;X<rt;X++)this.buf[this.pos++]=fe[X]},writeRawMessage:function(fe,rt){this.pos++;var X=this.pos;fe(rt,this);var ae=this.pos-X;ae>=128&&tr(X,ae,this),this.pos=X-1,this.writeVarint(ae),this.pos+=ae},writeMessage:function(fe,rt,X){this.writeTag(fe,ge.Bytes),this.writeRawMessage(rt,X)},writePackedVarint:function(fe,rt){rt.length&&this.writeMessage(fe,qt,rt)},writePackedSVarint:function(fe,rt){rt.length&&this.writeMessage(fe,Yt,rt)},writePackedBoolean:function(fe,rt){rt.length&&this.writeMessage(fe,It,rt)},writePackedFloat:function(fe,rt){rt.length&&this.writeMessage(fe,Sr,rt)},writePackedDouble:function(fe,rt){rt.length&&this.writeMessage(fe,fr,rt)},writePackedFixed32:function(fe,rt){rt.length&&this.writeMessage(fe,jt,rt)},writePackedSFixed32:function(fe,rt){rt.length&&this.writeMessage(fe,Rr,rt)},writePackedFixed64:function(fe,rt){rt.length&&this.writeMessage(fe,ie,rt)},writePackedSFixed64:function(fe,rt){rt.length&&this.writeMessage(fe,_r,rt)},writeBytesField:function(fe,rt){this.writeTag(fe,ge.Bytes),this.writeBytes(rt)},writeFixed32Field:function(fe,rt){this.writeTag(fe,ge.Fixed32),this.writeFixed32(rt)},writeSFixed32Field:function(fe,rt){this.writeTag(fe,ge.Fixed32),this.writeSFixed32(rt)},writeFixed64Field:function(fe,rt){this.writeTag(fe,ge.Fixed64),this.writeFixed64(rt)},writeSFixed64Field:function(fe,rt){this.writeTag(fe,ge.Fixed64),this.writeSFixed64(rt)},writeVarintField:function(fe,rt){this.writeTag(fe,ge.Varint),this.writeVarint(rt)},writeSVarintField:function(fe,rt){this.writeTag(fe,ge.Varint),this.writeSVarint(rt)},writeStringField:function(fe,rt){this.writeTag(fe,ge.Bytes),this.writeString(rt)},writeFloatField:function(fe,rt){this.writeTag(fe,ge.Fixed32),this.writeFloat(rt)},writeDoubleField:function(fe,rt){this.writeTag(fe,ge.Fixed64),this.writeDouble(rt)},writeBooleanField:function(fe,rt){this.writeVarintField(fe,Boolean(rt))}};function ve(fe,rt,X){var ae=X.buf,ze,At;if(At=ae[X.pos++],ze=(At&112)>>4,At<128||(At=ae[X.pos++],ze|=(At&127)<<3,At<128)||(At=ae[X.pos++],ze|=(At&127)<<10,At<128)||(At=ae[X.pos++],ze|=(At&127)<<17,At<128)||(At=ae[X.pos++],ze|=(At&127)<<24,At<128)||(At=ae[X.pos++],ze|=(At&1)<<31,At<128))return we(fe,ze,rt);throw new Error("Expected varint not more than 10 bytes")}function lt(fe){return fe.type===ge.Bytes?fe.readVarint()+fe.pos:fe.pos+1}function we(fe,rt,X){return X?rt*4294967296+(fe>>>0):(rt>>>0)*4294967296+(fe>>>0)}function We(fe,rt){var X,ae;if(fe>=0?(X=fe%4294967296|0,ae=fe/4294967296|0):(X=~(-fe%4294967296),ae=~(-fe/4294967296),X^4294967295?X=X+1|0:(X=0,ae=ae+1|0)),fe>=18446744073709552e3||fe<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");rt.realloc(10),St(X,ae,rt),Rt(ae,rt)}function St(fe,rt,X){X.buf[X.pos++]=fe&127|128,fe>>>=7,X.buf[X.pos++]=fe&127|128,fe>>>=7,X.buf[X.pos++]=fe&127|128,fe>>>=7,X.buf[X.pos++]=fe&127|128,fe>>>=7,X.buf[X.pos]=fe&127}function Rt(fe,rt){var X=(fe&7)<<4;rt.buf[rt.pos++]|=X|((fe>>>=3)?128:0),!!fe&&(rt.buf[rt.pos++]=fe&127|((fe>>>=7)?128:0),!!fe&&(rt.buf[rt.pos++]=fe&127|((fe>>>=7)?128:0),!!fe&&(rt.buf[rt.pos++]=fe&127|((fe>>>=7)?128:0),!!fe&&(rt.buf[rt.pos++]=fe&127|((fe>>>=7)?128:0),!!fe&&(rt.buf[rt.pos++]=fe&127)))))}function tr(fe,rt,X){var ae=rt<=16383?1:rt<=2097151?2:rt<=268435455?3:Math.floor(Math.log(rt)/(Math.LN2*7));X.realloc(ae);for(var ze=X.pos-1;ze>=fe;ze--)X.buf[ze+ae]=X.buf[ze]}function qt(fe,rt){for(var X=0;X<fe.length;X++)rt.writeVarint(fe[X])}function Yt(fe,rt){for(var X=0;X<fe.length;X++)rt.writeSVarint(fe[X])}function Sr(fe,rt){for(var X=0;X<fe.length;X++)rt.writeFloat(fe[X])}function fr(fe,rt){for(var X=0;X<fe.length;X++)rt.writeDouble(fe[X])}function It(fe,rt){for(var X=0;X<fe.length;X++)rt.writeBoolean(fe[X])}function jt(fe,rt){for(var X=0;X<fe.length;X++)rt.writeFixed32(fe[X])}function Rr(fe,rt){for(var X=0;X<fe.length;X++)rt.writeSFixed32(fe[X])}function ie(fe,rt){for(var X=0;X<fe.length;X++)rt.writeFixed64(fe[X])}function _r(fe,rt){for(var X=0;X<fe.length;X++)rt.writeSFixed64(fe[X])}function Ot(fe,rt){return(fe[rt]|fe[rt+1]<<8|fe[rt+2]<<16)+fe[rt+3]*16777216}function yt(fe,rt,X){fe[X]=rt,fe[X+1]=rt>>>8,fe[X+2]=rt>>>16,fe[X+3]=rt>>>24}function Qt(fe,rt){return(fe[rt]|fe[rt+1]<<8|fe[rt+2]<<16)+(fe[rt+3]<<24)}function Ue(fe,rt,X){for(var ae="",ze=rt;ze<X;){var At=fe[ze],Ft=null,ur=At>239?4:At>223?3:At>191?2:1;if(ze+ur>X)break;var Tt,Br,Bn;ur===1?At<128&&(Ft=At):ur===2?(Tt=fe[ze+1],(Tt&192)==128&&(Ft=(At&31)<<6|Tt&63,Ft<=127&&(Ft=null))):ur===3?(Tt=fe[ze+1],Br=fe[ze+2],(Tt&192)==128&&(Br&192)==128&&(Ft=(At&15)<<12|(Tt&63)<<6|Br&63,(Ft<=2047||Ft>=55296&&Ft<=57343)&&(Ft=null))):ur===4&&(Tt=fe[ze+1],Br=fe[ze+2],Bn=fe[ze+3],(Tt&192)==128&&(Br&192)==128&&(Bn&192)==128&&(Ft=(At&15)<<18|(Tt&63)<<12|(Br&63)<<6|Bn&63,(Ft<=65535||Ft>=1114112)&&(Ft=null))),Ft===null?(Ft=65533,ur=1):Ft>65535&&(Ft-=65536,ae+=String.fromCharCode(Ft>>>10&1023|55296),Ft=56320|Ft&1023),ae+=String.fromCharCode(Ft),ze+=ur}return ae}function Ar(fe,rt,X){return Pe.decode(fe.subarray(rt,X))}function an(fe,rt,X){for(var ae=0,ze,At;ae<rt.length;ae++){if(ze=rt.charCodeAt(ae),ze>55295&&ze<57344)if(At)if(ze<56320){fe[X++]=239,fe[X++]=191,fe[X++]=189,At=ze;continue}else ze=At-55296<<10|ze-56320|65536,At=null;else{ze>56319||ae+1===rt.length?(fe[X++]=239,fe[X++]=191,fe[X++]=189):At=ze;continue}else At&&(fe[X++]=239,fe[X++]=191,fe[X++]=189,At=null);ze<128?fe[X++]=ze:(ze<2048?fe[X++]=ze>>6|192:(ze<65536?fe[X++]=ze>>12|224:(fe[X++]=ze>>18|240,fe[X++]=ze>>12&63|128),fe[X++]=ze>>6&63|128),fe[X++]=ze&63|128)}return X}},32676:function(ci,Ae,de){var He=de(34155);(function(ge,y){ci.exports=y()})(this,function(){"use strict";function ge(Pt,xe){if(!(Pt instanceof xe))throw new TypeError("Cannot call a class as a function")}function y(Pt,xe){for(var ce=0;ce<xe.length;ce++){var Te=xe[ce];Te.enumerable=Te.enumerable||!1,Te.configurable=!0,"value"in Te&&(Te.writable=!0),Object.defineProperty(Pt,Te.key,Te)}}function Ne(Pt,xe,ce){return xe&&y(Pt.prototype,xe),ce&&y(Pt,ce),Pt}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var Q=function(){function Pt(xe,ce){this.next=null,this.key=xe,this.data=ce,this.left=null,this.right=null}return Pt}();function Pe(Pt,xe){return Pt>xe?1:Pt<xe?-1:0}function ve(Pt,xe,ce){for(var Te=new Q(null,null),j=Te,st=Te;;){var ar=ce(Pt,xe.key);if(ar<0){if(xe.left===null)break;if(ce(Pt,xe.left.key)<0){var Jr=xe.left;if(xe.left=Jr.right,Jr.right=xe,xe=Jr,xe.left===null)break}st.left=xe,st=xe,xe=xe.left}else if(ar>0){if(xe.right===null)break;if(ce(Pt,xe.right.key)>0){var Jr=xe.right;if(xe.right=Jr.left,Jr.left=xe,xe=Jr,xe.right===null)break}j.right=xe,j=xe,xe=xe.right}else break}return j.right=xe.left,st.left=xe.right,xe.left=Te.right,xe.right=Te.left,xe}function lt(Pt,xe,ce,Te){var j=new Q(Pt,xe);if(ce===null)return j.left=j.right=null,j;ce=ve(Pt,ce,Te);var st=Te(Pt,ce.key);return st<0?(j.left=ce.left,j.right=ce,ce.left=null):st>=0&&(j.right=ce.right,j.left=ce,ce.right=null),j}function we(Pt,xe,ce){var Te=null,j=null;if(xe){xe=ve(Pt,xe,ce);var st=ce(xe.key,Pt);st===0?(Te=xe.left,j=xe.right):st<0?(j=xe.right,xe.right=null,Te=xe):(Te=xe.left,xe.left=null,j=xe)}return{left:Te,right:j}}function We(Pt,xe,ce){return xe===null?Pt:(Pt===null||(xe=ve(Pt.key,xe,ce),xe.left=Pt),xe)}function St(Pt,xe,ce,Te,j){if(Pt){Te(""+xe+(ce?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+j(Pt)+`
`);var st=xe+(ce?"    ":"\u2502   ");Pt.left&&St(Pt.left,st,!1,Te,j),Pt.right&&St(Pt.right,st,!0,Te,j)}}var Rt=function(){function Pt(xe){xe===void 0&&(xe=Pe),this._root=null,this._size=0,this._comparator=xe}return Pt.prototype.insert=function(xe,ce){return this._size++,this._root=lt(xe,ce,this._root,this._comparator)},Pt.prototype.add=function(xe,ce){var Te=new Q(xe,ce);this._root===null&&(Te.left=Te.right=null,this._size++,this._root=Te);var j=this._comparator,st=ve(xe,this._root,j),ar=j(xe,st.key);return ar===0?this._root=st:(ar<0?(Te.left=st.left,Te.right=st,st.left=null):ar>0&&(Te.right=st.right,Te.left=st,st.right=null),this._size++,this._root=Te),this._root},Pt.prototype.remove=function(xe){this._root=this._remove(xe,this._root,this._comparator)},Pt.prototype._remove=function(xe,ce,Te){var j;if(ce===null)return null;ce=ve(xe,ce,Te);var st=Te(xe,ce.key);return st===0?(ce.left===null?j=ce.right:(j=ve(xe,ce.left,Te),j.right=ce.right),this._size--,j):ce},Pt.prototype.pop=function(){var xe=this._root;if(xe){for(;xe.left;)xe=xe.left;return this._root=ve(xe.key,this._root,this._comparator),this._root=this._remove(xe.key,this._root,this._comparator),{key:xe.key,data:xe.data}}return null},Pt.prototype.findStatic=function(xe){for(var ce=this._root,Te=this._comparator;ce;){var j=Te(xe,ce.key);if(j===0)return ce;j<0?ce=ce.left:ce=ce.right}return null},Pt.prototype.find=function(xe){return this._root&&(this._root=ve(xe,this._root,this._comparator),this._comparator(xe,this._root.key)!==0)?null:this._root},Pt.prototype.contains=function(xe){for(var ce=this._root,Te=this._comparator;ce;){var j=Te(xe,ce.key);if(j===0)return!0;j<0?ce=ce.left:ce=ce.right}return!1},Pt.prototype.forEach=function(xe,ce){for(var Te=this._root,j=[],st=!1;!st;)Te!==null?(j.push(Te),Te=Te.left):j.length!==0?(Te=j.pop(),xe.call(ce,Te),Te=Te.right):st=!0;return this},Pt.prototype.range=function(xe,ce,Te,j){for(var st=[],ar=this._comparator,Jr=this._root,tt;st.length!==0||Jr;)if(Jr)st.push(Jr),Jr=Jr.left;else{if(Jr=st.pop(),tt=ar(Jr.key,ce),tt>0)break;if(ar(Jr.key,xe)>=0&&Te.call(j,Jr))return this;Jr=Jr.right}return this},Pt.prototype.keys=function(){var xe=[];return this.forEach(function(ce){var Te=ce.key;return xe.push(Te)}),xe},Pt.prototype.values=function(){var xe=[];return this.forEach(function(ce){var Te=ce.data;return xe.push(Te)}),xe},Pt.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Pt.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Pt.prototype.minNode=function(xe){if(xe===void 0&&(xe=this._root),xe)for(;xe.left;)xe=xe.left;return xe},Pt.prototype.maxNode=function(xe){if(xe===void 0&&(xe=this._root),xe)for(;xe.right;)xe=xe.right;return xe},Pt.prototype.at=function(xe){for(var ce=this._root,Te=!1,j=0,st=[];!Te;)if(ce)st.push(ce),ce=ce.left;else if(st.length>0){if(ce=st.pop(),j===xe)return ce;j++,ce=ce.right}else Te=!0;return null},Pt.prototype.next=function(xe){var ce=this._root,Te=null;if(xe.right){for(Te=xe.right;Te.left;)Te=Te.left;return Te}for(var j=this._comparator;ce;){var st=j(xe.key,ce.key);if(st===0)break;st<0?(Te=ce,ce=ce.left):ce=ce.right}return Te},Pt.prototype.prev=function(xe){var ce=this._root,Te=null;if(xe.left!==null){for(Te=xe.left;Te.right;)Te=Te.right;return Te}for(var j=this._comparator;ce;){var st=j(xe.key,ce.key);if(st===0)break;st<0?ce=ce.left:(Te=ce,ce=ce.right)}return Te},Pt.prototype.clear=function(){return this._root=null,this._size=0,this},Pt.prototype.toList=function(){return Yt(this._root)},Pt.prototype.load=function(xe,ce,Te){ce===void 0&&(ce=[]),Te===void 0&&(Te=!1);var j=xe.length,st=this._comparator;if(Te&&It(xe,ce,0,j-1,st),this._root===null)this._root=tr(xe,ce,0,j),this._size=j;else{var ar=fr(this.toList(),qt(xe,ce),st);j=this._size+j,this._root=Sr({head:ar},0,j)}return this},Pt.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Pt.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Pt.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Pt.prototype.toString=function(xe){xe===void 0&&(xe=function(j){return String(j.key)});var ce=[];return St(this._root,"",!0,function(Te){return ce.push(Te)},xe),ce.join("")},Pt.prototype.update=function(xe,ce,Te){var j=this._comparator,st=we(xe,this._root,j),ar=st.left,Jr=st.right;j(xe,ce)<0?Jr=lt(ce,Te,Jr,j):ar=lt(ce,Te,ar,j),this._root=We(ar,Jr,j)},Pt.prototype.split=function(xe){return we(xe,this._root,this._comparator)},Pt}();function tr(Pt,xe,ce,Te){var j=Te-ce;if(j>0){var st=ce+Math.floor(j/2),ar=Pt[st],Jr=xe[st],tt=new Q(ar,Jr);return tt.left=tr(Pt,xe,ce,st),tt.right=tr(Pt,xe,st+1,Te),tt}return null}function qt(Pt,xe){for(var ce=new Q(null,null),Te=ce,j=0;j<Pt.length;j++)Te=Te.next=new Q(Pt[j],xe[j]);return Te.next=null,ce.next}function Yt(Pt){for(var xe=Pt,ce=[],Te=!1,j=new Q(null,null),st=j;!Te;)xe?(ce.push(xe),xe=xe.left):ce.length>0?(xe=st=st.next=ce.pop(),xe=xe.right):Te=!0;return st.next=null,j.next}function Sr(Pt,xe,ce){var Te=ce-xe;if(Te>0){var j=xe+Math.floor(Te/2),st=Sr(Pt,xe,j),ar=Pt.head;return ar.left=st,Pt.head=Pt.head.next,ar.right=Sr(Pt,j+1,ce),ar}return null}function fr(Pt,xe,ce){for(var Te=new Q(null,null),j=Te,st=Pt,ar=xe;st!==null&&ar!==null;)ce(st.key,ar.key)<0?(j.next=st,st=st.next):(j.next=ar,ar=ar.next),j=j.next;return st!==null?j.next=st:ar!==null&&(j.next=ar),Te.next}function It(Pt,xe,ce,Te,j){if(!(ce>=Te)){for(var st=Pt[ce+Te>>1],ar=ce-1,Jr=Te+1;;){do ar++;while(j(Pt[ar],st)<0);do Jr--;while(j(Pt[Jr],st)>0);if(ar>=Jr)break;var tt=Pt[ar];Pt[ar]=Pt[Jr],Pt[Jr]=tt,tt=xe[ar],xe[ar]=xe[Jr],xe[Jr]=tt}It(Pt,xe,ce,Jr,j),It(Pt,xe,Jr+1,Te,j)}}var jt=function(xe,ce){return xe.ll.x<=ce.x&&ce.x<=xe.ur.x&&xe.ll.y<=ce.y&&ce.y<=xe.ur.y},Rr=function(xe,ce){if(ce.ur.x<xe.ll.x||xe.ur.x<ce.ll.x||ce.ur.y<xe.ll.y||xe.ur.y<ce.ll.y)return null;var Te=xe.ll.x<ce.ll.x?ce.ll.x:xe.ll.x,j=xe.ur.x<ce.ur.x?xe.ur.x:ce.ur.x,st=xe.ll.y<ce.ll.y?ce.ll.y:xe.ll.y,ar=xe.ur.y<ce.ur.y?xe.ur.y:ce.ur.y;return{ll:{x:Te,y:st},ur:{x:j,y:ar}}},ie=Number.EPSILON;ie===void 0&&(ie=Math.pow(2,-52));var _r=ie*ie,Ot=function(xe,ce){if(-ie<xe&&xe<ie&&-ie<ce&&ce<ie)return 0;var Te=xe-ce;return Te*Te<_r*xe*ce?0:xe<ce?-1:1},yt=function(){function Pt(){ge(this,Pt),this.reset()}return Ne(Pt,[{key:"reset",value:function(){this.xRounder=new Qt,this.yRounder=new Qt}},{key:"round",value:function(ce,Te){return{x:this.xRounder.round(ce),y:this.yRounder.round(Te)}}}]),Pt}(),Qt=function(){function Pt(){ge(this,Pt),this.tree=new Rt,this.round(0)}return Ne(Pt,[{key:"round",value:function(ce){var Te=this.tree.add(ce),j=this.tree.prev(Te);if(j!==null&&Ot(Te.key,j.key)===0)return this.tree.remove(ce),j.key;var st=this.tree.next(Te);return st!==null&&Ot(Te.key,st.key)===0?(this.tree.remove(ce),st.key):ce}}]),Pt}(),Ue=new yt,Ar=function(xe,ce){return xe.x*ce.y-xe.y*ce.x},an=function(xe,ce){return xe.x*ce.x+xe.y*ce.y},fe=function(xe,ce,Te){var j={x:ce.x-xe.x,y:ce.y-xe.y},st={x:Te.x-xe.x,y:Te.y-xe.y},ar=Ar(j,st);return Ot(ar,0)},rt=function(xe){return Math.sqrt(an(xe,xe))},X=function(xe,ce,Te){var j={x:ce.x-xe.x,y:ce.y-xe.y},st={x:Te.x-xe.x,y:Te.y-xe.y};return Ar(st,j)/rt(st)/rt(j)},ae=function(xe,ce,Te){var j={x:ce.x-xe.x,y:ce.y-xe.y},st={x:Te.x-xe.x,y:Te.y-xe.y};return an(st,j)/rt(st)/rt(j)},ze=function(xe,ce,Te){return ce.y===0?null:{x:xe.x+ce.x/ce.y*(Te-xe.y),y:Te}},At=function(xe,ce,Te){return ce.x===0?null:{x:Te,y:xe.y+ce.y/ce.x*(Te-xe.x)}},Ft=function(xe,ce,Te,j){if(ce.x===0)return At(Te,j,xe.x);if(j.x===0)return At(xe,ce,Te.x);if(ce.y===0)return ze(Te,j,xe.y);if(j.y===0)return ze(xe,ce,Te.y);var st=Ar(ce,j);if(st==0)return null;var ar={x:Te.x-xe.x,y:Te.y-xe.y},Jr=Ar(ar,ce)/st,tt=Ar(ar,j)/st,Ut=xe.x+tt*ce.x,xr=Te.x+Jr*j.x,Cr=xe.y+tt*ce.y,Lr=Te.y+Jr*j.y,vn=(Ut+xr)/2,vi=(Cr+Lr)/2;return{x:vn,y:vi}},ur=function(){Ne(Pt,null,[{key:"compare",value:function(ce,Te){var j=Pt.comparePoints(ce.point,Te.point);return j!==0?j:(ce.point!==Te.point&&ce.link(Te),ce.isLeft!==Te.isLeft?ce.isLeft?1:-1:Br.compare(ce.segment,Te.segment))}},{key:"comparePoints",value:function(ce,Te){return ce.x<Te.x?-1:ce.x>Te.x?1:ce.y<Te.y?-1:ce.y>Te.y?1:0}}]);function Pt(xe,ce){ge(this,Pt),xe.events===void 0?xe.events=[this]:xe.events.push(this),this.point=xe,this.isLeft=ce}return Ne(Pt,[{key:"link",value:function(ce){if(ce.point===this.point)throw new Error("Tried to link already linked events");for(var Te=ce.point.events,j=0,st=Te.length;j<st;j++){var ar=Te[j];this.point.events.push(ar),ar.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ce=this.point.events.length,Te=0;Te<ce;Te++){var j=this.point.events[Te];if(j.segment.consumedBy===void 0)for(var st=Te+1;st<ce;st++){var ar=this.point.events[st];ar.consumedBy===void 0&&j.otherSE.point.events===ar.otherSE.point.events&&j.segment.consume(ar.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ce=[],Te=0,j=this.point.events.length;Te<j;Te++){var st=this.point.events[Te];st!==this&&!st.segment.ringOut&&st.segment.isInResult()&&ce.push(st)}return ce}},{key:"getLeftmostComparator",value:function(ce){var Te=this,j=new Map,st=function(Jr){var tt=Jr.otherSE;j.set(Jr,{sine:X(Te.point,ce.point,tt.point),cosine:ae(Te.point,ce.point,tt.point)})};return function(ar,Jr){j.has(ar)||st(ar),j.has(Jr)||st(Jr);var tt=j.get(ar),Ut=tt.sine,xr=tt.cosine,Cr=j.get(Jr),Lr=Cr.sine,vn=Cr.cosine;return Ut>=0&&Lr>=0?xr<vn?1:xr>vn?-1:0:Ut<0&&Lr<0?xr<vn?-1:xr>vn?1:0:Lr<Ut?-1:Lr>Ut?1:0}}}]),Pt}(),Tt=0,Br=function(){Ne(Pt,null,[{key:"compare",value:function(ce,Te){var j=ce.leftSE.point.x,st=Te.leftSE.point.x,ar=ce.rightSE.point.x,Jr=Te.rightSE.point.x;if(Jr<j)return 1;if(ar<st)return-1;var tt=ce.leftSE.point.y,Ut=Te.leftSE.point.y,xr=ce.rightSE.point.y,Cr=Te.rightSE.point.y;if(j<st){if(Ut<tt&&Ut<xr)return 1;if(Ut>tt&&Ut>xr)return-1;var Lr=ce.comparePoint(Te.leftSE.point);if(Lr<0)return 1;if(Lr>0)return-1;var vn=Te.comparePoint(ce.rightSE.point);return vn!==0?vn:-1}if(j>st){if(tt<Ut&&tt<Cr)return-1;if(tt>Ut&&tt>Cr)return 1;var vi=Te.comparePoint(ce.leftSE.point);if(vi!==0)return vi;var ni=ce.comparePoint(Te.rightSE.point);return ni<0?1:ni>0?-1:1}if(tt<Ut)return-1;if(tt>Ut)return 1;if(ar<Jr){var An=Te.comparePoint(ce.rightSE.point);if(An!==0)return An}if(ar>Jr){var Oi=ce.comparePoint(Te.rightSE.point);if(Oi<0)return 1;if(Oi>0)return-1}if(ar!==Jr){var zi=xr-tt,Pa=ar-j,ia=Cr-Ut,ao=Jr-st;if(zi>Pa&&ia<ao)return 1;if(zi<Pa&&ia>ao)return-1}return ar>Jr?1:ar<Jr||xr<Cr?-1:xr>Cr?1:ce.id<Te.id?-1:ce.id>Te.id?1:0}}]);function Pt(xe,ce,Te,j){ge(this,Pt),this.id=++Tt,this.leftSE=xe,xe.segment=this,xe.otherSE=ce,this.rightSE=ce,ce.segment=this,ce.otherSE=xe,this.rings=Te,this.windings=j}return Ne(Pt,[{key:"replaceRightSE",value:function(ce){this.rightSE=ce,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ce=this.leftSE.point.y,Te=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ce<Te?ce:Te},ur:{x:this.rightSE.point.x,y:ce>Te?ce:Te}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ce){return ce.x===this.leftSE.point.x&&ce.y===this.leftSE.point.y||ce.x===this.rightSE.point.x&&ce.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ce){if(this.isAnEndpoint(ce))return 0;var Te=this.leftSE.point,j=this.rightSE.point,st=this.vector();if(Te.x===j.x)return ce.x===Te.x?0:ce.x<Te.x?1:-1;var ar=(ce.y-Te.y)/st.y,Jr=Te.x+ar*st.x;if(ce.x===Jr)return 0;var tt=(ce.x-Te.x)/st.x,Ut=Te.y+tt*st.y;return ce.y===Ut?0:ce.y<Ut?-1:1}},{key:"getIntersection",value:function(ce){var Te=this.bbox(),j=ce.bbox(),st=Rr(Te,j);if(st===null)return null;var ar=this.leftSE.point,Jr=this.rightSE.point,tt=ce.leftSE.point,Ut=ce.rightSE.point,xr=jt(Te,tt)&&this.comparePoint(tt)===0,Cr=jt(j,ar)&&ce.comparePoint(ar)===0,Lr=jt(Te,Ut)&&this.comparePoint(Ut)===0,vn=jt(j,Jr)&&ce.comparePoint(Jr)===0;if(Cr&&xr)return vn&&!Lr?Jr:!vn&&Lr?Ut:null;if(Cr)return Lr&&ar.x===Ut.x&&ar.y===Ut.y?null:ar;if(xr)return vn&&Jr.x===tt.x&&Jr.y===tt.y?null:tt;if(vn&&Lr)return null;if(vn)return Jr;if(Lr)return Ut;var vi=Ft(ar,this.vector(),tt,ce.vector());return vi===null||!jt(st,vi)?null:Ue.round(vi.x,vi.y)}},{key:"split",value:function(ce){var Te=[],j=ce.events!==void 0,st=new ur(ce,!0),ar=new ur(ce,!1),Jr=this.rightSE;this.replaceRightSE(ar),Te.push(ar),Te.push(st);var tt=new Pt(st,Jr,this.rings.slice(),this.windings.slice());return ur.comparePoints(tt.leftSE.point,tt.rightSE.point)>0&&tt.swapEvents(),ur.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),j&&(st.checkForConsuming(),ar.checkForConsuming()),Te}},{key:"swapEvents",value:function(){var ce=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ce,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var Te=0,j=this.windings.length;Te<j;Te++)this.windings[Te]*=-1}},{key:"consume",value:function(ce){for(var Te=this,j=ce;Te.consumedBy;)Te=Te.consumedBy;for(;j.consumedBy;)j=j.consumedBy;var st=Pt.compare(Te,j);if(st!==0){if(st>0){var ar=Te;Te=j,j=ar}if(Te.prev===j){var Jr=Te;Te=j,j=Jr}for(var tt=0,Ut=j.rings.length;tt<Ut;tt++){var xr=j.rings[tt],Cr=j.windings[tt],Lr=Te.rings.indexOf(xr);Lr===-1?(Te.rings.push(xr),Te.windings.push(Cr)):Te.windings[Lr]+=Cr}j.rings=null,j.windings=null,j.consumedBy=Te,j.leftSE.consumedBy=Te.leftSE,j.rightSE.consumedBy=Te.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ce=this.prev.consumedBy||this.prev;this._beforeState=ce.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ce=this.beforeState();this._afterState={rings:ce.rings.slice(0),windings:ce.windings.slice(0),multiPolys:[]};for(var Te=this._afterState.rings,j=this._afterState.windings,st=this._afterState.multiPolys,ar=0,Jr=this.rings.length;ar<Jr;ar++){var tt=this.rings[ar],Ut=this.windings[ar],xr=Te.indexOf(tt);xr===-1?(Te.push(tt),j.push(Ut)):j[xr]+=Ut}for(var Cr=[],Lr=[],vn=0,vi=Te.length;vn<vi;vn++)if(j[vn]!==0){var ni=Te[vn],An=ni.poly;if(Lr.indexOf(An)===-1)if(ni.isExterior)Cr.push(An);else{Lr.indexOf(An)===-1&&Lr.push(An);var Oi=Cr.indexOf(ni.poly);Oi!==-1&&Cr.splice(Oi,1)}}for(var zi=0,Pa=Cr.length;zi<Pa;zi++){var ia=Cr[zi].multiPoly;st.indexOf(ia)===-1&&st.push(ia)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ce=this.beforeState().multiPolys,Te=this.afterState().multiPolys;switch($i.type){case"union":{var j=ce.length===0,st=Te.length===0;this._isInResult=j!==st;break}case"intersection":{var ar,Jr;ce.length<Te.length?(ar=ce.length,Jr=Te.length):(ar=Te.length,Jr=ce.length),this._isInResult=Jr===$i.numMultiPolys&&ar<Jr;break}case"xor":{var tt=Math.abs(ce.length-Te.length);this._isInResult=tt%2==1;break}case"difference":{var Ut=function(Cr){return Cr.length===1&&Cr[0].isSubject};this._isInResult=Ut(ce)!==Ut(Te);break}default:throw new Error("Unrecognized operation type found ".concat($i.type))}return this._isInResult}}],[{key:"fromRing",value:function(ce,Te,j){var st,ar,Jr,tt=ur.comparePoints(ce,Te);if(tt<0)st=ce,ar=Te,Jr=1;else if(tt>0)st=Te,ar=ce,Jr=-1;else throw new Error("Tried to create degenerate segment at [".concat(ce.x,", ").concat(ce.y,"]"));var Ut=new ur(st,!0),xr=new ur(ar,!1);return new Pt(Ut,xr,[j],[Jr])}}]),Pt}(),Bn=function(){function Pt(xe,ce,Te){if(ge(this,Pt),!Array.isArray(xe)||xe.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ce,this.isExterior=Te,this.segments=[],typeof xe[0][0]!="number"||typeof xe[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var j=Ue.round(xe[0][0],xe[0][1]);this.bbox={ll:{x:j.x,y:j.y},ur:{x:j.x,y:j.y}};for(var st=j,ar=1,Jr=xe.length;ar<Jr;ar++){if(typeof xe[ar][0]!="number"||typeof xe[ar][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var tt=Ue.round(xe[ar][0],xe[ar][1]);tt.x===st.x&&tt.y===st.y||(this.segments.push(Br.fromRing(st,tt,this)),tt.x<this.bbox.ll.x&&(this.bbox.ll.x=tt.x),tt.y<this.bbox.ll.y&&(this.bbox.ll.y=tt.y),tt.x>this.bbox.ur.x&&(this.bbox.ur.x=tt.x),tt.y>this.bbox.ur.y&&(this.bbox.ur.y=tt.y),st=tt)}(j.x!==st.x||j.y!==st.y)&&this.segments.push(Br.fromRing(st,j,this))}return Ne(Pt,[{key:"getSweepEvents",value:function(){for(var ce=[],Te=0,j=this.segments.length;Te<j;Te++){var st=this.segments[Te];ce.push(st.leftSE),ce.push(st.rightSE)}return ce}}]),Pt}(),Sn=function(){function Pt(xe,ce){if(ge(this,Pt),!Array.isArray(xe))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Bn(xe[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var Te=1,j=xe.length;Te<j;Te++){var st=new Bn(xe[Te],this,!1);st.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=st.bbox.ll.x),st.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=st.bbox.ll.y),st.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=st.bbox.ur.x),st.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=st.bbox.ur.y),this.interiorRings.push(st)}this.multiPoly=ce}return Ne(Pt,[{key:"getSweepEvents",value:function(){for(var ce=this.exteriorRing.getSweepEvents(),Te=0,j=this.interiorRings.length;Te<j;Te++)for(var st=this.interiorRings[Te].getSweepEvents(),ar=0,Jr=st.length;ar<Jr;ar++)ce.push(st[ar]);return ce}}]),Pt}(),Li=function(){function Pt(xe,ce){if(ge(this,Pt),!Array.isArray(xe))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof xe[0][0][0]=="number"&&(xe=[xe])}catch(ar){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var Te=0,j=xe.length;Te<j;Te++){var st=new Sn(xe[Te],this);st.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=st.bbox.ll.x),st.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=st.bbox.ll.y),st.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=st.bbox.ur.x),st.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=st.bbox.ur.y),this.polys.push(st)}this.isSubject=ce}return Ne(Pt,[{key:"getSweepEvents",value:function(){for(var ce=[],Te=0,j=this.polys.length;Te<j;Te++)for(var st=this.polys[Te].getSweepEvents(),ar=0,Jr=st.length;ar<Jr;ar++)ce.push(st[ar]);return ce}}]),Pt}(),gi=function(){Ne(Pt,null,[{key:"factory",value:function(ce){for(var Te=[],j=0,st=ce.length;j<st;j++){var ar=ce[j];if(!(!ar.isInResult()||ar.ringOut)){for(var Jr=null,tt=ar.leftSE,Ut=ar.rightSE,xr=[tt],Cr=tt.point,Lr=[];Jr=tt,tt=Ut,xr.push(tt),tt.point!==Cr;)for(;;){var vn=tt.getAvailableLinkedEvents();if(vn.length===0){var vi=xr[0].point,ni=xr[xr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(vi.x,",")+" ".concat(vi.y,"]. Last matching segment found ends at")+" [".concat(ni.x,", ").concat(ni.y,"]."))}if(vn.length===1){Ut=vn[0].otherSE;break}for(var An=null,Oi=0,zi=Lr.length;Oi<zi;Oi++)if(Lr[Oi].point===tt.point){An=Oi;break}if(An!==null){var Pa=Lr.splice(An)[0],ia=xr.splice(Pa.index);ia.unshift(ia[0].otherSE),Te.push(new Pt(ia.reverse()));continue}Lr.push({index:xr.length,point:tt.point});var ao=tt.getLeftmostComparator(Jr);Ut=vn.sort(ao)[0].otherSE;break}Te.push(new Pt(xr))}}return Te}}]);function Pt(xe){ge(this,Pt),this.events=xe;for(var ce=0,Te=xe.length;ce<Te;ce++)xe[ce].segment.ringOut=this;this.poly=null}return Ne(Pt,[{key:"getGeom",value:function(){for(var ce=this.events[0].point,Te=[ce],j=1,st=this.events.length-1;j<st;j++){var ar=this.events[j].point,Jr=this.events[j+1].point;fe(ar,ce,Jr)!==0&&(Te.push(ar),ce=ar)}if(Te.length===1)return null;var tt=Te[0],Ut=Te[1];fe(tt,ce,Ut)===0&&Te.shift(),Te.push(Te[0]);for(var xr=this.isExteriorRing()?1:-1,Cr=this.isExteriorRing()?0:Te.length-1,Lr=this.isExteriorRing()?Te.length:-1,vn=[],vi=Cr;vi!=Lr;vi+=xr)vn.push([Te[vi].x,Te[vi].y]);return vn}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ce=this.enclosingRing();this._isExteriorRing=ce?!ce.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ce=this.events[0],Te=1,j=this.events.length;Te<j;Te++){var st=this.events[Te];ur.compare(ce,st)>0&&(ce=st)}for(var ar=ce.segment.prevInResult(),Jr=ar?ar.prevInResult():null;;){if(!ar)return null;if(!Jr)return ar.ringOut;if(Jr.ringOut!==ar.ringOut)return Jr.ringOut.enclosingRing()!==ar.ringOut?ar.ringOut:ar.ringOut.enclosingRing();ar=Jr.prevInResult(),Jr=ar?ar.prevInResult():null}}}]),Pt}(),on=function(){function Pt(xe){ge(this,Pt),this.exteriorRing=xe,xe.poly=this,this.interiorRings=[]}return Ne(Pt,[{key:"addInterior",value:function(ce){this.interiorRings.push(ce),ce.poly=this}},{key:"getGeom",value:function(){var ce=[this.exteriorRing.getGeom()];if(ce[0]===null)return null;for(var Te=0,j=this.interiorRings.length;Te<j;Te++){var st=this.interiorRings[Te].getGeom();st!==null&&ce.push(st)}return ce}}]),Pt}(),Xa=function(){function Pt(xe){ge(this,Pt),this.rings=xe,this.polys=this._composePolys(xe)}return Ne(Pt,[{key:"getGeom",value:function(){for(var ce=[],Te=0,j=this.polys.length;Te<j;Te++){var st=this.polys[Te].getGeom();st!==null&&ce.push(st)}return ce}},{key:"_composePolys",value:function(ce){for(var Te=[],j=0,st=ce.length;j<st;j++){var ar=ce[j];if(!ar.poly)if(ar.isExteriorRing())Te.push(new on(ar));else{var Jr=ar.enclosingRing();Jr.poly||Te.push(new on(Jr)),Jr.poly.addInterior(ar)}}return Te}}]),Pt}(),ra=function(){function Pt(xe){var ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Br.compare;ge(this,Pt),this.queue=xe,this.tree=new Rt(ce),this.segments=[]}return Ne(Pt,[{key:"process",value:function(ce){var Te=ce.segment,j=[];if(ce.consumedBy)return ce.isLeft?this.queue.remove(ce.otherSE):this.tree.remove(Te),j;var st=ce.isLeft?this.tree.insert(Te):this.tree.find(Te);if(!st)throw new Error("Unable to find segment #".concat(Te.id," ")+"[".concat(Te.leftSE.point.x,", ").concat(Te.leftSE.point.y,"] -> ")+"[".concat(Te.rightSE.point.x,", ").concat(Te.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var ar=st,Jr=st,tt=void 0,Ut=void 0;tt===void 0;)ar=this.tree.prev(ar),ar===null?tt=null:ar.key.consumedBy===void 0&&(tt=ar.key);for(;Ut===void 0;)Jr=this.tree.next(Jr),Jr===null?Ut=null:Jr.key.consumedBy===void 0&&(Ut=Jr.key);if(ce.isLeft){var xr=null;if(tt){var Cr=tt.getIntersection(Te);if(Cr!==null&&(Te.isAnEndpoint(Cr)||(xr=Cr),!tt.isAnEndpoint(Cr)))for(var Lr=this._splitSafely(tt,Cr),vn=0,vi=Lr.length;vn<vi;vn++)j.push(Lr[vn])}var ni=null;if(Ut){var An=Ut.getIntersection(Te);if(An!==null&&(Te.isAnEndpoint(An)||(ni=An),!Ut.isAnEndpoint(An)))for(var Oi=this._splitSafely(Ut,An),zi=0,Pa=Oi.length;zi<Pa;zi++)j.push(Oi[zi])}if(xr!==null||ni!==null){var ia=null;if(xr===null)ia=ni;else if(ni===null)ia=xr;else{var ao=ur.comparePoints(xr,ni);ia=ao<=0?xr:ni}this.queue.remove(Te.rightSE),j.push(Te.rightSE);for(var Ci=Te.split(ia),da=0,J=Ci.length;da<J;da++)j.push(Ci[da])}j.length>0?(this.tree.remove(Te),j.push(ce)):(this.segments.push(Te),Te.prev=tt)}else{if(tt&&Ut){var se=tt.getIntersection(Ut);if(se!==null){if(!tt.isAnEndpoint(se))for(var _e=this._splitSafely(tt,se),ke=0,Ye=_e.length;ke<Ye;ke++)j.push(_e[ke]);if(!Ut.isAnEndpoint(se))for(var ut=this._splitSafely(Ut,se),xt=0,Ie=ut.length;xt<Ie;xt++)j.push(ut[xt])}}this.tree.remove(Te)}return j}},{key:"_splitSafely",value:function(ce,Te){this.tree.remove(ce);var j=ce.rightSE;this.queue.remove(j);var st=ce.split(Te);return st.push(j),ce.consumedBy===void 0&&this.tree.insert(ce),st}}]),Pt}(),Vi=typeof He!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ga=typeof He!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,fi=function(){function Pt(){ge(this,Pt)}return Ne(Pt,[{key:"run",value:function(ce,Te,j){$i.type=ce,Ue.reset();for(var st=[new Li(Te,!0)],ar=0,Jr=j.length;ar<Jr;ar++)st.push(new Li(j[ar],!1));if($i.numMultiPolys=st.length,$i.type==="difference")for(var tt=st[0],Ut=1;Ut<st.length;)Rr(st[Ut].bbox,tt.bbox)!==null?Ut++:st.splice(Ut,1);if($i.type==="intersection"){for(var xr=0,Cr=st.length;xr<Cr;xr++)for(var Lr=st[xr],vn=xr+1,vi=st.length;vn<vi;vn++)if(Rr(Lr.bbox,st[vn].bbox)===null)return[]}for(var ni=new Rt(ur.compare),An=0,Oi=st.length;An<Oi;An++)for(var zi=st[An].getSweepEvents(),Pa=0,ia=zi.length;Pa<ia;Pa++)if(ni.insert(zi[Pa]),ni.size>Vi)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var ao=new ra(ni),Ci=ni.size,da=ni.pop();da;){var J=da.key;if(ni.size===Ci){var se=J.segment;throw new Error("Unable to pop() ".concat(J.isLeft?"left":"right"," SweepEvent ")+"[".concat(J.point.x,", ").concat(J.point.y,"] from segment #").concat(se.id," ")+"[".concat(se.leftSE.point.x,", ").concat(se.leftSE.point.y,"] -> ")+"[".concat(se.rightSE.point.x,", ").concat(se.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(ni.size>Vi)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(ao.segments.length>ga)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var _e=ao.process(J),ke=0,Ye=_e.length;ke<Ye;ke++){var ut=_e[ke];ut.consumedBy===void 0&&ni.insert(ut)}Ci=ni.size,da=ni.pop()}Ue.reset();var xt=gi.factory(ao.segments),Ie=new Xa(xt);return Ie.getGeom()}}]),Pt}(),$i=new fi,hi=function(xe){for(var ce=arguments.length,Te=new Array(ce>1?ce-1:0),j=1;j<ce;j++)Te[j-1]=arguments[j];return $i.run("union",xe,Te)},yi=function(xe){for(var ce=arguments.length,Te=new Array(ce>1?ce-1:0),j=1;j<ce;j++)Te[j-1]=arguments[j];return $i.run("intersection",xe,Te)},os=function(xe){for(var ce=arguments.length,Te=new Array(ce>1?ce-1:0),j=1;j<ce;j++)Te[j-1]=arguments[j];return $i.run("xor",xe,Te)},mo=function(xe){for(var ce=arguments.length,Te=new Array(ce>1?ce-1:0),j=1;j<ce;j++)Te[j-1]=arguments[j];return $i.run("difference",xe,Te)},Ya={union:hi,intersection:yi,xor:os,difference:mo};return Ya})},28660:function(ci,Ae,de){var He=de(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ge;(function(y){(function(Ne){var Q=typeof de.g=="object"?de.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Pe=ve(y);typeof Q.Reflect=="undefined"?Q.Reflect=y:Pe=ve(Q.Reflect,Pe),Ne(Pe);function ve(lt,we){return function(We,St){typeof lt[We]!="function"&&Object.defineProperty(lt,We,{configurable:!0,writable:!0,value:St}),we&&we(We,St)}}})(function(Ne){var Q=Object.prototype.hasOwnProperty,Pe=typeof Symbol=="function",ve=Pe&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",lt=Pe&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",we=typeof Object.create=="function",We={__proto__:[]}instanceof Array,St=!we&&!We,Rt={create:we?function(){return Jr(Object.create(null))}:We?function(){return Jr({__proto__:null})}:function(){return Jr({})},has:St?function(tt,Ut){return Q.call(tt,Ut)}:function(tt,Ut){return Ut in tt},get:St?function(tt,Ut){return Q.call(tt,Ut)?tt[Ut]:void 0}:function(tt,Ut){return tt[Ut]}},tr=Object.getPrototypeOf(Function),qt=typeof He=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Yt=!qt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:j(),Sr=!qt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:st(),fr=!qt&&typeof WeakMap=="function"?WeakMap:ar(),It=new fr;function jt(tt,Ut,xr,Cr){if(Sn(xr)){if(!$i(tt))throw new TypeError;if(!yi(Ut))throw new TypeError;return fe(tt,Ut)}else{if(!$i(tt))throw new TypeError;if(!on(Ut))throw new TypeError;if(!on(Cr)&&!Sn(Cr)&&!Li(Cr))throw new TypeError;return Li(Cr)&&(Cr=void 0),xr=fi(xr),rt(tt,Ut,xr,Cr)}}Ne("decorate",jt);function Rr(tt,Ut){function xr(Cr,Lr){if(!on(Cr))throw new TypeError;if(!Sn(Lr)&&!os(Lr))throw new TypeError;ur(tt,Ut,Cr,Lr)}return xr}Ne("metadata",Rr);function ie(tt,Ut,xr,Cr){if(!on(xr))throw new TypeError;return Sn(Cr)||(Cr=fi(Cr)),ur(tt,Ut,xr,Cr)}Ne("defineMetadata",ie);function _r(tt,Ut,xr){if(!on(Ut))throw new TypeError;return Sn(xr)||(xr=fi(xr)),ae(tt,Ut,xr)}Ne("hasMetadata",_r);function Ot(tt,Ut,xr){if(!on(Ut))throw new TypeError;return Sn(xr)||(xr=fi(xr)),ze(tt,Ut,xr)}Ne("hasOwnMetadata",Ot);function yt(tt,Ut,xr){if(!on(Ut))throw new TypeError;return Sn(xr)||(xr=fi(xr)),At(tt,Ut,xr)}Ne("getMetadata",yt);function Qt(tt,Ut,xr){if(!on(Ut))throw new TypeError;return Sn(xr)||(xr=fi(xr)),Ft(tt,Ut,xr)}Ne("getOwnMetadata",Qt);function Ue(tt,Ut){if(!on(tt))throw new TypeError;return Sn(Ut)||(Ut=fi(Ut)),Tt(tt,Ut)}Ne("getMetadataKeys",Ue);function Ar(tt,Ut){if(!on(tt))throw new TypeError;return Sn(Ut)||(Ut=fi(Ut)),Br(tt,Ut)}Ne("getOwnMetadataKeys",Ar);function an(tt,Ut,xr){if(!on(Ut))throw new TypeError;Sn(xr)||(xr=fi(xr));var Cr=X(Ut,xr,!1);if(Sn(Cr)||!Cr.delete(tt))return!1;if(Cr.size>0)return!0;var Lr=It.get(Ut);return Lr.delete(xr),Lr.size>0||It.delete(Ut),!0}Ne("deleteMetadata",an);function fe(tt,Ut){for(var xr=tt.length-1;xr>=0;--xr){var Cr=tt[xr],Lr=Cr(Ut);if(!Sn(Lr)&&!Li(Lr)){if(!yi(Lr))throw new TypeError;Ut=Lr}}return Ut}function rt(tt,Ut,xr,Cr){for(var Lr=tt.length-1;Lr>=0;--Lr){var vn=tt[Lr],vi=vn(Ut,xr,Cr);if(!Sn(vi)&&!Li(vi)){if(!on(vi))throw new TypeError;Cr=vi}}return Cr}function X(tt,Ut,xr){var Cr=It.get(tt);if(Sn(Cr)){if(!xr)return;Cr=new Yt,It.set(tt,Cr)}var Lr=Cr.get(Ut);if(Sn(Lr)){if(!xr)return;Lr=new Yt,Cr.set(Ut,Lr)}return Lr}function ae(tt,Ut,xr){var Cr=ze(tt,Ut,xr);if(Cr)return!0;var Lr=Te(Ut);return Li(Lr)?!1:ae(tt,Lr,xr)}function ze(tt,Ut,xr){var Cr=X(Ut,xr,!1);return Sn(Cr)?!1:Vi(Cr.has(tt))}function At(tt,Ut,xr){var Cr=ze(tt,Ut,xr);if(Cr)return Ft(tt,Ut,xr);var Lr=Te(Ut);if(!Li(Lr))return At(tt,Lr,xr)}function Ft(tt,Ut,xr){var Cr=X(Ut,xr,!1);if(!Sn(Cr))return Cr.get(tt)}function ur(tt,Ut,xr,Cr){var Lr=X(xr,Cr,!0);Lr.set(tt,Ut)}function Tt(tt,Ut){var xr=Br(tt,Ut),Cr=Te(tt);if(Cr===null)return xr;var Lr=Tt(Cr,Ut);if(Lr.length<=0)return xr;if(xr.length<=0)return Lr;for(var vn=new Sr,vi=[],ni=0,An=xr;ni<An.length;ni++){var Oi=An[ni],zi=vn.has(Oi);zi||(vn.add(Oi),vi.push(Oi))}for(var Pa=0,ia=Lr;Pa<ia.length;Pa++){var Oi=ia[Pa],zi=vn.has(Oi);zi||(vn.add(Oi),vi.push(Oi))}return vi}function Br(tt,Ut){var xr=[],Cr=X(tt,Ut,!1);if(Sn(Cr))return xr;for(var Lr=Cr.keys(),vn=Ya(Lr),vi=0;;){var ni=xe(vn);if(!ni)return xr.length=vi,xr;var An=Pt(ni);try{xr[vi]=An}catch(Oi){try{ce(vn)}finally{throw Oi}}vi++}}function Bn(tt){if(tt===null)return 1;switch(typeof tt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return tt===null?1:6;default:return 6}}function Sn(tt){return tt===void 0}function Li(tt){return tt===null}function gi(tt){return typeof tt=="symbol"}function on(tt){return typeof tt=="object"?tt!==null:typeof tt=="function"}function Xa(tt,Ut){switch(Bn(tt)){case 0:return tt;case 1:return tt;case 2:return tt;case 3:return tt;case 4:return tt;case 5:return tt}var xr=Ut===3?"string":Ut===5?"number":"default",Cr=mo(tt,ve);if(Cr!==void 0){var Lr=Cr.call(tt,xr);if(on(Lr))throw new TypeError;return Lr}return ra(tt,xr==="default"?"number":xr)}function ra(tt,Ut){if(Ut==="string"){var xr=tt.toString;if(hi(xr)){var Cr=xr.call(tt);if(!on(Cr))return Cr}var Lr=tt.valueOf;if(hi(Lr)){var Cr=Lr.call(tt);if(!on(Cr))return Cr}}else{var Lr=tt.valueOf;if(hi(Lr)){var Cr=Lr.call(tt);if(!on(Cr))return Cr}var vn=tt.toString;if(hi(vn)){var Cr=vn.call(tt);if(!on(Cr))return Cr}}throw new TypeError}function Vi(tt){return!!tt}function ga(tt){return""+tt}function fi(tt){var Ut=Xa(tt,3);return gi(Ut)?Ut:ga(Ut)}function $i(tt){return Array.isArray?Array.isArray(tt):tt instanceof Object?tt instanceof Array:Object.prototype.toString.call(tt)==="[object Array]"}function hi(tt){return typeof tt=="function"}function yi(tt){return typeof tt=="function"}function os(tt){switch(Bn(tt)){case 3:return!0;case 4:return!0;default:return!1}}function mo(tt,Ut){var xr=tt[Ut];if(xr!=null){if(!hi(xr))throw new TypeError;return xr}}function Ya(tt){var Ut=mo(tt,lt);if(!hi(Ut))throw new TypeError;var xr=Ut.call(tt);if(!on(xr))throw new TypeError;return xr}function Pt(tt){return tt.value}function xe(tt){var Ut=tt.next();return Ut.done?!1:Ut}function ce(tt){var Ut=tt.return;Ut&&Ut.call(tt)}function Te(tt){var Ut=Object.getPrototypeOf(tt);if(typeof tt!="function"||tt===tr||Ut!==tr)return Ut;var xr=tt.prototype,Cr=xr&&Object.getPrototypeOf(xr);if(Cr==null||Cr===Object.prototype)return Ut;var Lr=Cr.constructor;return typeof Lr!="function"||Lr===tt?Ut:Lr}function j(){var tt={},Ut=[],xr=function(){function vi(ni,An,Oi){this._index=0,this._keys=ni,this._values=An,this._selector=Oi}return vi.prototype["@@iterator"]=function(){return this},vi.prototype[lt]=function(){return this},vi.prototype.next=function(){var ni=this._index;if(ni>=0&&ni<this._keys.length){var An=this._selector(this._keys[ni],this._values[ni]);return ni+1>=this._keys.length?(this._index=-1,this._keys=Ut,this._values=Ut):this._index++,{value:An,done:!1}}return{value:void 0,done:!0}},vi.prototype.throw=function(ni){throw this._index>=0&&(this._index=-1,this._keys=Ut,this._values=Ut),ni},vi.prototype.return=function(ni){return this._index>=0&&(this._index=-1,this._keys=Ut,this._values=Ut),{value:ni,done:!0}},vi}();return function(){function vi(){this._keys=[],this._values=[],this._cacheKey=tt,this._cacheIndex=-2}return Object.defineProperty(vi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),vi.prototype.has=function(ni){return this._find(ni,!1)>=0},vi.prototype.get=function(ni){var An=this._find(ni,!1);return An>=0?this._values[An]:void 0},vi.prototype.set=function(ni,An){var Oi=this._find(ni,!0);return this._values[Oi]=An,this},vi.prototype.delete=function(ni){var An=this._find(ni,!1);if(An>=0){for(var Oi=this._keys.length,zi=An+1;zi<Oi;zi++)this._keys[zi-1]=this._keys[zi],this._values[zi-1]=this._values[zi];return this._keys.length--,this._values.length--,ni===this._cacheKey&&(this._cacheKey=tt,this._cacheIndex=-2),!0}return!1},vi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=tt,this._cacheIndex=-2},vi.prototype.keys=function(){return new xr(this._keys,this._values,Cr)},vi.prototype.values=function(){return new xr(this._keys,this._values,Lr)},vi.prototype.entries=function(){return new xr(this._keys,this._values,vn)},vi.prototype["@@iterator"]=function(){return this.entries()},vi.prototype[lt]=function(){return this.entries()},vi.prototype._find=function(ni,An){return this._cacheKey!==ni&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=ni)),this._cacheIndex<0&&An&&(this._cacheIndex=this._keys.length,this._keys.push(ni),this._values.push(void 0)),this._cacheIndex},vi}();function Cr(vi,ni){return vi}function Lr(vi,ni){return ni}function vn(vi,ni){return[vi,ni]}}function st(){return function(){function tt(){this._map=new Yt}return Object.defineProperty(tt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),tt.prototype.has=function(Ut){return this._map.has(Ut)},tt.prototype.add=function(Ut){return this._map.set(Ut,Ut),this},tt.prototype.delete=function(Ut){return this._map.delete(Ut)},tt.prototype.clear=function(){this._map.clear()},tt.prototype.keys=function(){return this._map.keys()},tt.prototype.values=function(){return this._map.values()},tt.prototype.entries=function(){return this._map.entries()},tt.prototype["@@iterator"]=function(){return this.keys()},tt.prototype[lt]=function(){return this.keys()},tt}()}function ar(){var tt=16,Ut=Rt.create(),xr=Cr();return function(){function An(){this._key=Cr()}return An.prototype.has=function(Oi){var zi=Lr(Oi,!1);return zi!==void 0?Rt.has(zi,this._key):!1},An.prototype.get=function(Oi){var zi=Lr(Oi,!1);return zi!==void 0?Rt.get(zi,this._key):void 0},An.prototype.set=function(Oi,zi){var Pa=Lr(Oi,!0);return Pa[this._key]=zi,this},An.prototype.delete=function(Oi){var zi=Lr(Oi,!1);return zi!==void 0?delete zi[this._key]:!1},An.prototype.clear=function(){this._key=Cr()},An}();function Cr(){var An;do An="@@WeakMap@@"+ni();while(Rt.has(Ut,An));return Ut[An]=!0,An}function Lr(An,Oi){if(!Q.call(An,xr)){if(!Oi)return;Object.defineProperty(An,xr,{value:Rt.create()})}return An[xr]}function vn(An,Oi){for(var zi=0;zi<Oi;++zi)An[zi]=Math.random()*255|0;return An}function vi(An){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(An)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(An)):vn(new Uint8Array(An),An):vn(new Array(An),An)}function ni(){var An=vi(tt);An[6]=An[6]&79|64,An[8]=An[8]&191|128;for(var Oi="",zi=0;zi<tt;++zi){var Pa=An[zi];(zi===4||zi===6||zi===8)&&(Oi+="-"),Pa<16&&(Oi+="0"),Oi+=Pa.toString(16).toLowerCase()}return Oi}}function Jr(tt){return tt.__=void 0,delete tt.__,tt}})})(ge||(ge={}))},69848:function(ci){(function(Ae,de){ci.exports=de()})(this,function(){"use strict";function Ae(Ot,yt,Qt,Ue,Ar,an){if(!(Ar-Ue<=Qt)){var fe=Ue+Ar>>1;de(Ot,yt,fe,Ue,Ar,an%2),Ae(Ot,yt,Qt,Ue,fe-1,an+1),Ae(Ot,yt,Qt,fe+1,Ar,an+1)}}function de(Ot,yt,Qt,Ue,Ar,an){for(;Ar>Ue;){if(Ar-Ue>600){var fe=Ar-Ue+1,rt=Qt-Ue+1,X=Math.log(fe),ae=.5*Math.exp(2*X/3),ze=.5*Math.sqrt(X*ae*(fe-ae)/fe)*(rt-fe/2<0?-1:1),At=Math.max(Ue,Math.floor(Qt-rt*ae/fe+ze)),Ft=Math.min(Ar,Math.floor(Qt+(fe-rt)*ae/fe+ze));de(Ot,yt,Qt,At,Ft,an)}var ur=yt[2*Qt+an],Tt=Ue,Br=Ar;for(He(Ot,yt,Ue,Qt),yt[2*Ar+an]>ur&&He(Ot,yt,Ue,Ar);Tt<Br;){for(He(Ot,yt,Tt,Br),Tt++,Br--;yt[2*Tt+an]<ur;)Tt++;for(;yt[2*Br+an]>ur;)Br--}yt[2*Ue+an]===ur?He(Ot,yt,Ue,Br):(Br++,He(Ot,yt,Br,Ar)),Br<=Qt&&(Ue=Br+1),Qt<=Br&&(Ar=Br-1)}}function He(Ot,yt,Qt,Ue){ge(Ot,Qt,Ue),ge(yt,2*Qt,2*Ue),ge(yt,2*Qt+1,2*Ue+1)}function ge(Ot,yt,Qt){var Ue=Ot[yt];Ot[yt]=Ot[Qt],Ot[Qt]=Ue}function y(Ot,yt,Qt,Ue,Ar,an,fe){for(var rt=[0,Ot.length-1,0],X=[],ae,ze;rt.length;){var At=rt.pop(),Ft=rt.pop(),ur=rt.pop();if(Ft-ur<=fe){for(var Tt=ur;Tt<=Ft;Tt++)ae=yt[2*Tt],ze=yt[2*Tt+1],ae>=Qt&&ae<=Ar&&ze>=Ue&&ze<=an&&X.push(Ot[Tt]);continue}var Br=Math.floor((ur+Ft)/2);ae=yt[2*Br],ze=yt[2*Br+1],ae>=Qt&&ae<=Ar&&ze>=Ue&&ze<=an&&X.push(Ot[Br]);var Bn=(At+1)%2;(At===0?Qt<=ae:Ue<=ze)&&(rt.push(ur),rt.push(Br-1),rt.push(Bn)),(At===0?Ar>=ae:an>=ze)&&(rt.push(Br+1),rt.push(Ft),rt.push(Bn))}return X}function Ne(Ot,yt,Qt,Ue,Ar,an){for(var fe=[0,Ot.length-1,0],rt=[],X=Ar*Ar;fe.length;){var ae=fe.pop(),ze=fe.pop(),At=fe.pop();if(ze-At<=an){for(var Ft=At;Ft<=ze;Ft++)Q(yt[2*Ft],yt[2*Ft+1],Qt,Ue)<=X&&rt.push(Ot[Ft]);continue}var ur=Math.floor((At+ze)/2),Tt=yt[2*ur],Br=yt[2*ur+1];Q(Tt,Br,Qt,Ue)<=X&&rt.push(Ot[ur]);var Bn=(ae+1)%2;(ae===0?Qt-Ar<=Tt:Ue-Ar<=Br)&&(fe.push(At),fe.push(ur-1),fe.push(Bn)),(ae===0?Qt+Ar>=Tt:Ue+Ar>=Br)&&(fe.push(ur+1),fe.push(ze),fe.push(Bn))}return rt}function Q(Ot,yt,Qt,Ue){var Ar=Ot-Qt,an=yt-Ue;return Ar*Ar+an*an}var Pe=function(Ot){return Ot[0]},ve=function(Ot){return Ot[1]},lt=function(yt,Qt,Ue,Ar,an){Qt===void 0&&(Qt=Pe),Ue===void 0&&(Ue=ve),Ar===void 0&&(Ar=64),an===void 0&&(an=Float64Array),this.nodeSize=Ar,this.points=yt;for(var fe=yt.length<65536?Uint16Array:Uint32Array,rt=this.ids=new fe(yt.length),X=this.coords=new an(yt.length*2),ae=0;ae<yt.length;ae++)rt[ae]=ae,X[2*ae]=Qt(yt[ae]),X[2*ae+1]=Ue(yt[ae]);Ae(rt,X,Ar,0,rt.length-1,0)};lt.prototype.range=function(yt,Qt,Ue,Ar){return y(this.ids,this.coords,yt,Qt,Ue,Ar,this.nodeSize)},lt.prototype.within=function(yt,Qt,Ue){return Ne(this.ids,this.coords,yt,Qt,Ue,this.nodeSize)};var we={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ot){return Ot}},We=Math.fround||function(Ot){return function(yt){return Ot[0]=+yt,Ot[0]}}(new Float32Array(1)),St=function(yt){this.options=Rr(Object.create(we),yt),this.trees=new Array(this.options.maxZoom+1)};St.prototype.load=function(yt){var Qt=this.options,Ue=Qt.log,Ar=Qt.minZoom,an=Qt.maxZoom,fe=Qt.nodeSize;Ue&&console.time("total time");var rt="prepare "+yt.length+" points";Ue&&console.time(rt),this.points=yt;for(var X=[],ae=0;ae<yt.length;ae++)!yt[ae].geometry||X.push(tr(yt[ae],ae));this.trees[an+1]=new lt(X,ie,_r,fe,Float32Array),Ue&&console.timeEnd(rt);for(var ze=an;ze>=Ar;ze--){var At=+Date.now();X=this._cluster(X,ze),this.trees[ze]=new lt(X,ie,_r,fe,Float32Array),Ue&&console.log("z%d: %d clusters in %dms",ze,X.length,+Date.now()-At)}return Ue&&console.timeEnd("total time"),this},St.prototype.getClusters=function(yt,Qt){var Ue=((yt[0]+180)%360+360)%360-180,Ar=Math.max(-90,Math.min(90,yt[1])),an=yt[2]===180?180:((yt[2]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,yt[3]));if(yt[2]-yt[0]>=360)Ue=-180,an=180;else if(Ue>an){var rt=this.getClusters([Ue,Ar,180,fe],Qt),X=this.getClusters([-180,Ar,an,fe],Qt);return rt.concat(X)}for(var ae=this.trees[this._limitZoom(Qt)],ze=ae.range(Sr(Ue),fr(fe),Sr(an),fr(Ar)),At=[],Ft=0,ur=ze;Ft<ur.length;Ft+=1){var Tt=ur[Ft],Br=ae.points[Tt];At.push(Br.numPoints?qt(Br):this.points[Br.index])}return At},St.prototype.getChildren=function(yt){var Qt=this._getOriginId(yt),Ue=this._getOriginZoom(yt),Ar="No cluster with the specified id.",an=this.trees[Ue];if(!an)throw new Error(Ar);var fe=an.points[Qt];if(!fe)throw new Error(Ar);for(var rt=this.options.radius/(this.options.extent*Math.pow(2,Ue-1)),X=an.within(fe.x,fe.y,rt),ae=[],ze=0,At=X;ze<At.length;ze+=1){var Ft=At[ze],ur=an.points[Ft];ur.parentId===yt&&ae.push(ur.numPoints?qt(ur):this.points[ur.index])}if(ae.length===0)throw new Error(Ar);return ae},St.prototype.getLeaves=function(yt,Qt,Ue){Qt=Qt||10,Ue=Ue||0;var Ar=[];return this._appendLeaves(Ar,yt,Qt,Ue,0),Ar},St.prototype.getTile=function(yt,Qt,Ue){var Ar=this.trees[this._limitZoom(yt)],an=Math.pow(2,yt),fe=this.options,rt=fe.extent,X=fe.radius,ae=X/rt,ze=(Ue-ae)/an,At=(Ue+1+ae)/an,Ft={features:[]};return this._addTileFeatures(Ar.range((Qt-ae)/an,ze,(Qt+1+ae)/an,At),Ar.points,Qt,Ue,an,Ft),Qt===0&&this._addTileFeatures(Ar.range(1-ae/an,ze,1,At),Ar.points,an,Ue,an,Ft),Qt===an-1&&this._addTileFeatures(Ar.range(0,ze,ae/an,At),Ar.points,-1,Ue,an,Ft),Ft.features.length?Ft:null},St.prototype.getClusterExpansionZoom=function(yt){for(var Qt=this._getOriginZoom(yt)-1;Qt<=this.options.maxZoom;){var Ue=this.getChildren(yt);if(Qt++,Ue.length!==1)break;yt=Ue[0].properties.cluster_id}return Qt},St.prototype._appendLeaves=function(yt,Qt,Ue,Ar,an){for(var fe=this.getChildren(Qt),rt=0,X=fe;rt<X.length;rt+=1){var ae=X[rt],ze=ae.properties;if(ze&&ze.cluster?an+ze.point_count<=Ar?an+=ze.point_count:an=this._appendLeaves(yt,ze.cluster_id,Ue,Ar,an):an<Ar?an++:yt.push(ae),yt.length===Ue)break}return an},St.prototype._addTileFeatures=function(yt,Qt,Ue,Ar,an,fe){for(var rt=0,X=yt;rt<X.length;rt+=1){var ae=X[rt],ze=Qt[ae],At=ze.numPoints,Ft=void 0,ur=void 0,Tt=void 0;if(At)Ft=Yt(ze),ur=ze.x,Tt=ze.y;else{var Br=this.points[ze.index];Ft=Br.properties,ur=Sr(Br.geometry.coordinates[0]),Tt=fr(Br.geometry.coordinates[1])}var Bn={type:1,geometry:[[Math.round(this.options.extent*(ur*an-Ue)),Math.round(this.options.extent*(Tt*an-Ar))]],tags:Ft},Sn=void 0;At?Sn=ze.id:this.options.generateId?Sn=ze.index:this.points[ze.index].id&&(Sn=this.points[ze.index].id),Sn!==void 0&&(Bn.id=Sn),fe.features.push(Bn)}},St.prototype._limitZoom=function(yt){return Math.max(this.options.minZoom,Math.min(Math.floor(+yt),this.options.maxZoom+1))},St.prototype._cluster=function(yt,Qt){for(var Ue=[],Ar=this.options,an=Ar.radius,fe=Ar.extent,rt=Ar.reduce,X=Ar.minPoints,ae=an/(fe*Math.pow(2,Qt)),ze=0;ze<yt.length;ze++){var At=yt[ze];if(!(At.zoom<=Qt)){At.zoom=Qt;for(var Ft=this.trees[Qt+1],ur=Ft.within(At.x,At.y,ae),Tt=At.numPoints||1,Br=Tt,Bn=0,Sn=ur;Bn<Sn.length;Bn+=1){var Li=Sn[Bn],gi=Ft.points[Li];gi.zoom>Qt&&(Br+=gi.numPoints||1)}if(Br>Tt&&Br>=X){for(var on=At.x*Tt,Xa=At.y*Tt,ra=rt&&Tt>1?this._map(At,!0):null,Vi=(ze<<5)+(Qt+1)+this.points.length,ga=0,fi=ur;ga<fi.length;ga+=1){var $i=fi[ga],hi=Ft.points[$i];if(!(hi.zoom<=Qt)){hi.zoom=Qt;var yi=hi.numPoints||1;on+=hi.x*yi,Xa+=hi.y*yi,hi.parentId=Vi,rt&&(ra||(ra=this._map(At,!0)),rt(ra,this._map(hi)))}}At.parentId=Vi,Ue.push(Rt(on/Br,Xa/Br,Vi,Br,ra))}else if(Ue.push(At),Br>1)for(var os=0,mo=ur;os<mo.length;os+=1){var Ya=mo[os],Pt=Ft.points[Ya];Pt.zoom<=Qt||(Pt.zoom=Qt,Ue.push(Pt))}}}return Ue},St.prototype._getOriginId=function(yt){return yt-this.points.length>>5},St.prototype._getOriginZoom=function(yt){return(yt-this.points.length)%32},St.prototype._map=function(yt,Qt){if(yt.numPoints)return Qt?Rr({},yt.properties):yt.properties;var Ue=this.points[yt.index].properties,Ar=this.options.map(Ue);return Qt&&Ar===Ue?Rr({},Ar):Ar};function Rt(Ot,yt,Qt,Ue,Ar){return{x:We(Ot),y:We(yt),zoom:Infinity,id:Qt,parentId:-1,numPoints:Ue,properties:Ar}}function tr(Ot,yt){var Qt=Ot.geometry.coordinates,Ue=Qt[0],Ar=Qt[1];return{x:We(Sr(Ue)),y:We(fr(Ar)),zoom:Infinity,index:yt,parentId:-1}}function qt(Ot){return{type:"Feature",id:Ot.id,properties:Yt(Ot),geometry:{type:"Point",coordinates:[It(Ot.x),jt(Ot.y)]}}}function Yt(Ot){var yt=Ot.numPoints,Qt=yt>=1e4?Math.round(yt/1e3)+"k":yt>=1e3?Math.round(yt/100)/10+"k":yt;return Rr(Rr({},Ot.properties),{cluster:!0,cluster_id:Ot.id,point_count:yt,point_count_abbreviated:Qt})}function Sr(Ot){return Ot/360+.5}function fr(Ot){var yt=Math.sin(Ot*Math.PI/180),Qt=.5-.25*Math.log((1+yt)/(1-yt))/Math.PI;return Qt<0?0:Qt>1?1:Qt}function It(Ot){return(Ot-.5)*360}function jt(Ot){var yt=(180-Ot*360)*Math.PI/180;return 360*Math.atan(Math.exp(yt))/Math.PI-90}function Rr(Ot,yt){for(var Qt in yt)Ot[Qt]=yt[Qt];return Ot}function ie(Ot){return Ot.x}function _r(Ot){return Ot.y}return St})}}]);
